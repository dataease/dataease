// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../geometry/Point ../../../../geometry ../../../../layers/support/rasterFunctions/pixelUtils ../../../../tasks/support/ImageHistogramParameters ./RasterLayerAdapter".split(" "),
function(t,m,f,k,C,D,u,E,v,F,G,H,w,x,I,y,z,A){f=function(n){function l(){var a=n.apply(this,arguments)||this;a._cacheSize=20;a._statsCache=new Map;return a}t._inheritsLoose(l,n);var g=l.prototype;g.generateRasterInfo=function(a){const b=k.unwrap(null==a?void 0:a.renderingRule);return this.layer.generateRasterInfo(b,{signal:null==a?void 0:a.signal})};g.estimateStatisticsHistograms=async function(a){var b,c,d,e=null!=(b=null==(c=k.unwrap(null==a?void 0:a.renderingRule))?void 0:c.functionName)?b:"default";
if(this._statsCache.has(e))return this._statsCache.get(e);let {width:p,height:q,pixelSize:h}=this.layer.rasterInfo;for(b=1;2E3<p||2E3<q;)p/=2,q/=2,b*=2;c=null!=(d=null==a?void 0:a.renderingRule)?d:this.layer.renderingRule;const {fullExtent:r,mosaicRule:B}=this.layer;h=new x(h.x*b,h.y*b,r.spatialReference);d=new z({fullExtent:r,pixelSize:h,renderingRule:c,mosaicRule:B});this.layer.capabilities.operations.supportsComputeStatisticsHistograms?a=await this.layer.computeStatisticsHistograms(d,a):({histograms:a}=
await this.layer.computeHistograms(d,a),a={statistics:y.estimateStatisticsFromHistograms(a),histograms:a});this._statsCache.set(e,a);this._statsCache.size>this._cacheSize&&(e=this._statsCache.keys().next().value,this._statsCache.delete(e));return a};g.supportsMultidirectionalHillshade=function(){return 10.81<=this.layer.version};g.load=function(a){this.addResolvingPromise(this.layer.load(a).then(()=>{var b;this.generateRasterInfo({renderingRule:this.renderingRule,signal:null==(b=k.unwrap(a))?void 0:
b.signal}).then(c=>this.rasterInfo=c)}));return w.resolve(this)};return l}(A);m.__decorate([u.property()],f.prototype,"layer",void 0);return f=m.__decorate([v.subclass("esri.smartMapping.support.adapters.ImageryLayerAdapter")],f)});
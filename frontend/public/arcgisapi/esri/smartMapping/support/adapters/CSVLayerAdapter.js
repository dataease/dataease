// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../tasks/support/generateRendererUtils ../utils ../../statistics/support/utils ./support/utils ./FeatureLayerAdapter".split(" "),
function(v,w,m,E,F,G,H,x,q,I,J,K,y,r,z,A,l,B){function t(h){return"esri.tasks.support.ClassBreaksDefinition"===h.declaredClass}function u(h){return"esri.tasks.support.UniqueValueDefinition"===h.declaredClass}m=function(h){function n(a){return h.call(this,a)||this}v._inheritsLoose(n,h);var p=n.prototype;p._createGenerateRendererResult=async function(a,b,c,g,d){const f=a&&a.features;if(!f||!f.length)throw new q("csv-layer-adapter:insufficient-data","No features are available to calculate statistics");
a=null;if("percent-of-total"===g&&(a=(await l.calculateStatsFromMemory({field:b},f)).sum,null==a))throw new q("csv-layer-adapter:invalid","invalid normalizationTotal");if(t(d))return b=(await l.getDataValues({field:b,normalizationType:g,normalizationField:c,normalizationTotal:a},f)).filter(e=>null!=e&&l.isValidNumber(e)),r.createGenerateRendererClassBreaks({definition:d,values:b,normalizationTotal:a});if(u(d))return d=(await l.getDataValues({field:b},f)).filter(e=>null!=e&&"string"===typeof e&&""!==
e.trim()),r.createGenerateRendererUniqueValues(d)};p.generateRenderer=function(a,b){const c=a.classificationDefinition;let g=null,d=null,f=null;t(c)?(g=c.classificationField,d=c.normalizationField,f=c.normalizationType):u(c)&&(g=c.attributeField);const e=this.layer;return z.getFieldsList({field:g,normalizationField:d}).then(C=>{const k=e.createQuery();k.returnGeometry=!1;k.outFields=C;k.where=A.mergeWhereClauses(k.where,a.where);return e.queryFeatures(k,{signal:b}).then(D=>this._createGenerateRendererResult(D,
g,d,f,c))})};p.load=function(a){a=this.layer.load(a).then(b=>{this.geometryType=b.geometryType;this.objectIdField=b.objectIdField;this.supportsSQLExpression=!0;this._hasLocalSource=!1;this.hasQueryEngine=!0});this.addResolvingPromise(a);return y.resolve(this)};return n}(B);return m=w.__decorate([x.subclass("esri.smartMapping.support.adapters.CSVLayerAdapter")],m)});
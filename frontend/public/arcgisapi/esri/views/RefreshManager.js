// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/Accessor ../core/Handles ./layers/RefreshableLayerView".split(" "),function(l,h,e,u,v,m,w,p,x,y,z,q,r,k){e=function(n){function g(){var b=n.apply(this,arguments)||this;b._handles=new r;b._currentTick=
0;return b}l._inheritsLoose(g,n);var f=g.prototype;f.initialize=function(){this._handles.add([this.view.allLayerViews.on("after-changes",()=>{this.notifyChange("tickInterval");this._handles.remove("layerViewsUpdating");this._handles.add(this._getLayerViewHandles(),"layerViewsUpdating")}),this.watch("tickInterval",()=>this._restartTicking()),this.watch("view.ready",()=>this._restartTicking())]);this._restartTicking()};f.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null,
this._intervalID&&clearInterval(this._intervalID),this._currentTick=0)};f._restartTicking=function(){this._currentTick=0;this._intervalID&&clearInterval(this._intervalID);this.get("view.ready")&&this.tickInterval&&(this._intervalID=setInterval(()=>{const b=Date.now();this._currentTick+=this.tickInterval;this.view.allLayerViews.forEach(c=>{if(k.isRefreshableLayerView(c)){const a=Math.round(6E4*c.refreshInterval),d=0===this._currentTick%a,t=5400>b-c.refreshTimestamp;a&&d&&!t&&c.refresh(b)}})},this.tickInterval))};
f._getLayerViewHandles=function(){const b=[],c=()=>this.notifyChange("tickInterval");this.view.allLayerViews.forEach(a=>{k.isRefreshableLayerView(a)&&a.layer&&b.push(a.watch("refreshInterval",c),a.layer.on("refresh",()=>{a.refresh(Date.now())}))});return b};f._getCommonInterval=function(b){const c=(a,d)=>isNaN(a)||isNaN(d)?0:0>=d?a:c(d,a%d);return b.toArray().reduce((a,d)=>c(Math.round(6E4*d.refreshInterval),a),0)};l._createClass(g,[{key:"tickInterval",get:function(){const b=this.view.allLayerViews.filter(c=>
k.isRefreshableLayerView(c));return this._getCommonInterval(b)}}]);return g}(q);h.__decorate([m.property()],e.prototype,"view",void 0);h.__decorate([m.property({readOnly:!0})],e.prototype,"tickInterval",null);return e=h.__decorate([p.subclass("esri.views.RefreshManager")],e)});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../core/PooledArray ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat3f64 ../../../../../chunks/quatf64 ../../../../../chunks/mat3 ../../../../../chunks/quat ../../../../../chunks/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),function(K,G,u,k,T,U,L,V,M,N,t){function H(b,c,a){return k.set(b,c.data[a+0],c.data[a+1],c.data[a+2])}function e(b,c){b.push(c[0]);b.push(c[1]);b.push(c[2])}function W(b,c,a,f){V.conjugate(O,
b.quaternion);k.sub(n,c,b.center);k.transformQuat(n,n,O);const l=8*((n[0]<-b.halfSize[0]?-1:n[0]>b.halfSize[0]?1:0)+3*(n[1]<-b.halfSize[1]?-1:n[1]>b.halfSize[1]?1:0)+9*(n[2]<-b.halfSize[2]?-1:n[2]>b.halfSize[2]?1:0)+13);c=P[l];if(0===c)return c;L.fromQuat(B,b.quaternion);L.scale(B,B,b.halfSize);const q=(p,d)=>{d=P[l+d+1];k.set(p,((d&1)<<1)-1,(d&2)-1,((d&4)>>1)-1);k.transformMat3(p,p,B);return k.add(p,b.center,p)};a.length=0;e(a,q(I,0));e(a,q(Q,1));e(a,q(n,2));e(a,q(R,3));f(a);if(1===c)return c;a.length=
0;e(a,I);e(a,R);e(a,q(n,4));e(a,q(S,5));f(a);if(2===c)return c;a.length=0;e(a,I);e(a,S);e(a,q(n,6));e(a,Q);f(a);return c}function X(b,c){let a=0;for(let f=0;4>f;f++){const l=N.intersectPlane(b,c[f]);if(0<l)return-1;0===l&&(a|=1<<f)}return a}const C=new G({allocator:b=>b||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:b=>{b.object=null;return b}}),r=t.empty(),g=u.create(),v=u.create(),Y=new G({deallocator:null}),Z=new G({deallocator:null}),P=(()=>{const b=new Int8Array(216);let c=0;const a=
f=>{for(let l=0;l<f.length;l++)b[c+l]=f[l];c+=8};a([3,0,6,2,3,1,5,4]);a([2,0,2,3,1,5,4,0]);a([3,1,0,2,3,7,5,4]);a([2,0,1,3,2,6,4,0]);a([1,0,1,3,2,0,0,0]);a([2,1,5,7,3,2,0,0]);a([3,2,0,1,3,7,6,4]);a([2,2,0,1,3,7,6,0]);a([3,3,0,1,5,7,6,2]);a([2,0,1,5,4,6,2,0]);a([1,0,1,5,4,0,0,0]);a([2,1,3,7,5,4,0,0]);a([1,0,2,6,4,0,0,0]);a([0,0,0,0,0,0,0,0]);a([1,1,3,7,5,0,0,0]);a([2,2,3,7,6,4,0,0]);a([1,2,3,7,6,0,0,0]);a([2,3,1,5,7,6,2,0]);a([3,4,0,1,5,7,6,2]);a([2,5,7,6,4,0,1,0]);a([3,5,0,1,3,7,6,4]);a([2,4,5,7,
6,2,0,0]);a([1,4,5,7,6,0,0,0]);a([2,5,1,3,7,6,4,0]);a([3,6,0,2,3,7,5,4]);a([2,6,2,3,7,5,4,0]);a([3,7,6,2,3,1,5,4]);return b})(),B=T.create(),O=U.create(),n=u.create(),I=u.create(),Q=u.create(),R=u.create(),S=u.create();K.computeDepthRange=function(b,c){const a=t.empty(),f=b.eye,l=b.viewForward,q=b.frustum.planes;for(b=0;b<c.length;b++){var p=c[b].obb;const d=k.dot(k.sub(n,p.center,f),l),h=N.projectedRadius(p,l);if(t.within(a,d-h)&&t.within(a,d+h))continue;p=X(p,q);if(-1===p)continue;if(0===p){r.far=
d+h;r.near=d-h;t.union(a,r);continue}const m=C.pushNew();m.near=d-h;m.far=d+h;m.mask=p;m.object=c[b]}for(c=0;c<C.length;c++){const d=C.data[c];t.within(a,d.near)&&t.within(a,d.far)||(r.far=d.far,r.near=Infinity,0===W(d.object.obb,f,Y,h=>{var m=Z;for(var x=0;4>x&&0<h.length;x++)if(0!==(d.mask&1<<x)){{var D=q[x],E=h,w=m;w.length=0;const J=E.length-3;H(g,E,J);const y=M.signedDistance(D,g);0>=y&&(w.push(g[0]),w.push(g[1]),w.push(g[2]));let F=0,z=y;for(F;F<J;F+=3){H(v,E,F);const A=M.signedDistance(D,v);
0>z*A&&(k.lerp(g,v,g,A/(A-z)),e(w,g));0>=A&&e(w,v);z=A;k.copy(g,v)}0>z*y&&(H(v,E,J),k.lerp(g,v,g,y/(y-z)),e(w,g))}D=h;h=m;m=D}for(m=0;m<h.length;m+=3)k.set(g,h.data[m+0],h.data[m+1],h.data[m+2]),x=k.dot(k.sub(g,g,f),l),r.near=Math.min(r.near,x)})&&(r.near=0),t.union(a,r))}C.length=0;return a};Object.defineProperty(K,"__esModule",{value:!0})});
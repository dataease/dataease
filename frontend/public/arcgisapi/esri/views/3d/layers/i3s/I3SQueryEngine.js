// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/Error ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../geometry/Extent ../../../../core/Handles ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query ../../../../layers/graphics/data/QueryEngine".split(" "),
function(c,l,e,A,p,B,C,f,D,q,m,E,F,G,r,t,u,v,w,x){const y=x["default"];c.I3SQueryEngine=function(n){function h(a){a=n.call(this,a)||this;a._dataQueryEngineInstance=null;a._handles=new u;return a}l._inheritsLoose(h,n);var d=h.prototype;d.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};d.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&
(this._handles.destroy(),this._handles=null);this._set("layerView",null)};d.executeQueryForCount=async function(a,b){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(a),b)};d.executeQueryForExtent=async function(a,b){const {count:g,extent:k}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(a),b);a=t.fromJSON(k);return{count:g,extent:a}};d.executeQueryForIds=async function(a,b){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(a),b)};d.executeQuery=
async function(a,b){a=this._ensureQueryJSON(a);if(a.returnGeometry)throw new m("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(a.returnCentroid)throw new m("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");b=await this.dataQueryEngine.executeQuery(a,b);b=v.fromJSON(b);b.features.forEach(g=>{g.geometry=null});return b};d._ensureQueryJSON=function(a){if(p.isNone(a))return this.defaultQueryJSON;
const b=a.toJSON();b.outSpatialReference||(a.outSpatialReference=this.spatialReference);return b};d.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const a=this.layer.objectIdField||"OBJECTID",b=this.layer.fields.map(z=>z.toJSON()),g=this.layerView.view.resourceController.scheduler,k=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new y({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:b,timeInfo:null,spatialReference:k,
objectIdField:a,featureStore:this.spatialIndex,scheduler:g,task:this.task})};l._createClass(h,[{key:"defaultQueryJSON",get:function(){return(new w({outSpatialReference:this.spatialReference})).toJSON()}},{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}}]);return h}(r);e.__decorate([f.property({constructOnly:!0})],c.I3SQueryEngine.prototype,"layerView",void 0);e.__decorate([f.property({constructOnly:!0})],c.I3SQueryEngine.prototype,"task",void 0);e.__decorate([f.property({constructOnly:!0})],
c.I3SQueryEngine.prototype,"spatialIndex",void 0);e.__decorate([f.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],c.I3SQueryEngine.prototype,"spatialReference",void 0);e.__decorate([f.property({readOnly:!0,aliasOf:"layerView.i3slayer"})],c.I3SQueryEngine.prototype,"layer",void 0);e.__decorate([f.property({readOnly:!0,dependsOn:["spatialReference"]})],c.I3SQueryEngine.prototype,"defaultQueryJSON",null);c.I3SQueryEngine=e.__decorate([q.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],
c.I3SQueryEngine);c.default=c.I3SQueryEngine;Object.defineProperty(c,"__esModule",{value:!0})});
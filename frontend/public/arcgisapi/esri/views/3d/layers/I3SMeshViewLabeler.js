// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../symbols/PointSymbol3D ../../../chunks/symbols ../../../Graphic ../../../chunks/vec3f64 ../../../core/Handles ../../../core/accessorSupport/diffUtils ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap".split(" "),
function(r,h,e,t,J,K,l,L,x,M,N,O,y,z,P,A,B,C,D,E,F,G,H,I){e=function(u){function n(a){a=u.call(this,a)||this;a.loadedGraphics=new I.LimitGraphicsMap(5E4);a.slicePlaneEnabled=!1;a._renderingInfo={symbol:new z};a._handles=new C;a._graphicsByNode=new Map;a._scaleVisibility=null;return a}r._inheritsLoose(n,u);var k=n.prototype;k.initialize=function(){this._graphicsCore=new F.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:1,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,
getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1});var a=this.view.basemapTerrain;this._scaleVisibility=new G({layerScaleEnabled:!1});this._scaleVisibility.setup(this,this.layer,(b,c,f)=>this._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(b,c,f),this._graphicsCore,a);a=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}});
const d=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);this._graphicsCore.setup({labeler:a,deconflictor:d,scaleVisibility:this._scaleVisibility}).then(()=>{this._graphicsCore.startCreateGraphics()}).catch(()=>{});this._handles.add([this.layer.watch("labelingInfo",(b,c)=>{D.diff(b,c)&&this._graphicsCore.updateLabelingInfo()})])};k.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),this._scaleVisibility=
null);null!=this._graphicsCore&&(this._graphicsCore.destroy(),this._graphicsCore=null);this.loadedGraphics.destroy();this.view=null};k.addNodeMeta=function(a,d){let b=0;const c=a.filteredIds,f=a.featureIds.map((m,p)=>{H.boundingBoxTop(p,this.collection,a.objectHandle,v);const w=E.makeDehydratedPoint(0,0,0,this.view.spatialReference);this.view.renderCoordsHelper.fromRenderCoords(v,w);p=d(p,a);let q=!1;t.isNone(c)?q=!0:b<c.length&&m===c[b]&&(q=!0,b++);return{objectId:m,uid:A.generateUID(),attributes:p,
visible:q,geometry:w}});this.loadedGraphics.addMany(f);this._graphicsByNode.set(a.node.index,f)};k.setNodeMetaAttributes=function(a,d){const b=this._graphicsByNode.get(a.node.index),c=Array(b.length);for(let f=0;f<b.length;f++){const m=b[f];m.attributes=d(f,a);c[f]=m.uid}this._graphicsCore.updateLabelingInfo(c)};k.applyFilterChange=function(a){var d=this._graphicsByNode.get(a.node.index);if(d)if(t.isNone(a.filteredIds))for(var b of d)b.visible||(b.visible=!0,g.graphic=b,g.property="visible",g.oldValue=
!1,g.newValue=!0,this._graphicsCore.graphicUpdateHandler(g));else{b=0;for(const c of d)d=c.visible,b<a.filteredIds.length&&c.objectId===a.filteredIds[b]?(c.visible=!0,b++):c.visible=!1,d!==c.visible&&(g.graphic=c,g.property="visible",g.oldValue=d,g.newValue=c.visible,this._graphicsCore.graphicUpdateHandler(g))}};k.removeNodeMeta=function(a){this.loadedGraphics.removeManyByObjectId(a.featureIds)};k.getRenderingInfo=function(){return this._renderingInfo};k.notifyGraphicUpdate=function(){};r._createClass(n,
[{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return n}(y);h.__decorate([l.property()],e.prototype,"view",void 0);h.__decorate([l.property()],e.prototype,"layer",void 0);h.__decorate([l.property()],e.prototype,"collection",void 0);h.__decorate([l.property()],e.prototype,"loadedGraphics",void 0);h.__decorate([l.property({aliasOf:"_graphicsCore.updating"})],
e.prototype,"updating",void 0);h.__decorate([l.property()],e.prototype,"slicePlaneEnabled",void 0);h.__decorate([l.property()],e.prototype,"_graphicsCore",void 0);e=h.__decorate([x.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],e);const g={graphic:null,property:null,oldValue:null,newValue:null},v=B.create();return e});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/mathUtils ../../../../Color ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./graphicUtils ./elevationAlignmentUtils ./featureExpressionInfoUtils ./ElevationContext ./Loadable ./symbolComplexity".split(" "),function(m,u,q,k,x,v,y,z,A,r,t,B,C,D,E){function n(h,l){h=null!=h?l.attributes[h]:0;return null!=h&&isFinite(h)?h:0}const p=x.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");
q=function(h){function l(a,b,c,f){var e=h.call(this)||this;e._elevationInfoOverride=null;e.complexity=null;e.logger=p;e._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};e.symbol=a;e.symbolLayer=b;e._context=c;e._renderPriority=f.renderPriority;e._renderPriorityStep=f.renderPriorityStep;e._elevationContext=new C.ElevationContext;e.complexity=e.computeComplexity();e._updateDrivenProperties(f.ignoreDrivers);e._updateElevationContext();return e}u._inheritsLoose(l,h);var d=l.prototype;
d.getCachedSize=function(){return null};d._logGeometryCreationWarnings=function(a,b,c,f){const e="polygons"in a?a.polygons:null;f=`${f} geometry failed to be created`;let g=null;a.projectionSuccess?!b.length||1===b.length&&!b[0].length?g=`${f} (no ${c} were defined)`:Array.isArray(b)&&Array.isArray(b[0])?e&&0===e.length&&"rings"===c&&0<b.length&&2<b[0].length&&(g=`${f} (filled rings should use clockwise winding - try reversing the order of vertices)`):g=`${f} (${c} should be defined as a 2D array)`:
g=`${f} (failed to project geometry to view spatial reference)`;g&&p.warnOncePerTick(g)};d._validateGeometryType=function(a,b,c){if(b.includes(a.type))return!0;this.logger.warn("unsupported geometry type for "+c+` symbol: ${a.type}`);return!1};d._validateGeometry=function(a){return"point"!==a.type||v.isFinite(a.x)&&v.isFinite(a.y)?!0:(p.warn("point coordinate is not a valid number, graphic skipped"),!1)};d._defaultElevationInfoNoZ=function(){return F};d._defaultElevationInfoZ=function(){return G};
d._updateElevationContext=function(){k.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};d.getDefaultElevationInfo=function(a){return a.hasZ?
this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};d.getGeometryElevationMode=function(a,b=this.getDefaultElevationInfo(a)){return this._elevationContext.mode||b.mode};d.setElevationInfoOverride=function(a){this._elevationInfoOverride=a;this._updateElevationContext()};d.setGraphicElevationContext=function(a,b){var c=k.unwrap(a.geometry);const f=this.getDefaultElevationInfo(c);b.unit=null!=this._elevationContext.unit?this._elevationContext.unit:f.unit;b.mode=this.getGeometryElevationMode(c,
f);b.offsetMeters=k.unwrapOr(this._elevationContext.meterUnitOffset,k.unwrapOr(f.offset,0));if(c=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===b.mode)b.mode="relative-to-ground",b.offsetMeters=0;b.updateFeatureExpressionInfoContext(c?B.zeroContext:this._elevationContext.featureExpressionInfoContext,a,this._context.layer);return b};d.prepareSymbolLayerPatch=function(a){};d.updateGeometry=function(a,b){return!1};d.onRemoveGraphic=function(a){};d._updateDrivenProperties=function(a){const b=
{color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};a||(a=this._context.renderer)&&"visualVariables"in a&&a.visualVariables&&a.visualVariables.forEach(c=>{switch(c.type){case "color":b.color=!0;if(c.stops)for(let f=0;f<c.stops.length;f++){const e=c.stops[f].color;e&&(b.opacity=!0,1>e.a&&(b.opacityAlwaysOpaque=!1))}break;case "opacity":b.opacity=!0;b.opacityAlwaysOpaque=!1;break;case "size":b.size=!0}});this._drivenProperties=b};d._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in
this._context.layerView)return this._context.layerView.fullOpacity;const a=this._context.layer.opacity;return null==a?1:a};d._getCombinedOpacity=function(a,b=w){let c=1;this.draped||(c*=this._getLayerOpacity());if(this._drivenProperties.opacity)return c;k.isSome(a)?c*=a.a:b.hasIntrinsicColor||(c=0);return c};d._getCombinedOpacityAndColor=function(a,b=w){b=this._getCombinedOpacity(a,b);if(this._drivenProperties.color)return r.mixinColorAndOpacity(null,b);a=k.isSome(a)?y.toUnitRGB(a):z.ONES;return r.mixinColorAndOpacity(a,
b)};d._getVertexOpacityAndColor=function(a,b,c){a=r.mixinColorAndOpacity(this._drivenProperties.color?a.color:null,this._drivenProperties.opacity?a.opacity:null);c&&(a[0]*=c,a[1]*=c,a[2]*=c,a[3]*=c);return b?new b(a):a};d._getIdHint=function(a=""){return this._context.layer.id+"_symbol"+a};d.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};d.computeComplexity=function(){return E.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};d.destroy=function(){this.abortLoad()};
d.globalPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged(b,c);case "elevationInfo":return a=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(b,c,a)===t.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(b,c);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return!1}};d.updateGraphics3DGraphicElevationInfo=
function(a,b,c){let f=t.SymbolUpdateType.UPDATE;a.forEach(e=>{const g=b(e);k.isSome(g)?(this.setGraphicElevationContext(e.graphic,g.elevationContext),g.needsElevationUpdates=c(g.elevationContext.mode)):f=t.SymbolUpdateType.RECREATE});return f};d.applyRendererDiff=function(a,b){return!1};d.getFastUpdateAttrValues=function(a){if(!this._fastUpdates.enabled)return null;const b=this._fastUpdates.visualVariables,c=b.size?n(b.size.field,a):0,f=b.color?n(b.color.field,a):0;a=b.opacity?n(b.opacity.field,a):
0;return A.fromValues(c,f,a,0)};d.ensureDrapedStatus=function(a){if(null==this._draped)return this._draped=a,!0;a!==this.draped&&p.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};u._createClass(l,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},
{key:"draped",get:function(){return this._draped}}]);return l}(D.Loadable);const F={mode:"on-the-ground",offset:0,unit:"meters"},G={mode:"absolute-height",offset:0,unit:"meters"},w={hasIntrinsicColor:!1};m.Graphics3DSymbolLayer=q;m.default=q;m.getAttributeValue=n;Object.defineProperty(m,"__esModule",{value:!0})});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Handles ../../../../geometry/projectionEllipsoid ../../../../core/watchUtils ../../../support/Scheduler ../../support/FrustumExtentIntersection".split(" "),
function(h,g,e,w,x,k,y,p,z,A,B,q,r,l,m,t,u){e=function(n){function f(){var a=n.apply(this,arguments)||this;a.suspended=!1;a.extent=null;a.extentIntersectionDirty=!0;a._isVisibleBelowSurface=!1;a.handles=new r;a.layerView=null;a.updating=!0;return a}h._inheritsLoose(f,n);var b=f.prototype;b.setup=function(a){this.layerView=a;this.extentIntersection=new u.FrustumExtentIntersection({renderCoordsHelper:a.view.renderCoordsHelper});a=a.view;const c=a.basemapTerrain,d=a.resourceController.scheduler;this.handles.add([a.on("resize",
()=>this.viewChange()),a.state.watch("camera",()=>this.viewChange(),!0),d.registerTask(t.Task.FRUSTUM_VISIBILITY,()=>this.update(),()=>this.updating),c.on("elevation-bounds-change",()=>this.elevationBoundsChange())]);"local"===a.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([m.init(c,["opacity","wireframe"],()=>this.updateIsVisibleBelowSurface()),m.init(a,"map.ground.navigationConstraint.type",()=>this.updateIsVisibleBelowSurface())])};b.destroy=function(){this.extentIntersection=this.extent=
this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};b._setDirty=function(){this.updating||this._set("updating",!0)};b.setExtent=function(a){this.extent=a;this.extentIntersectionDirty=!0;this._setDirty()};b.viewChange=function(){this._setDirty()};b.elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=!0};b.updateIsVisibleBelowSurface=function(){const a=this.layerView.view,c=a.basemapTerrain,d=a.map.ground&&a.map.ground.navigationConstraint&&"none"===
a.map.ground.navigationConstraint.type;this.isVisibleBelowSurface="local"===a.viewingMode||!c.isOpaque()||d};b.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var a=this.layerView.view;if(this._isVisibleBelowSurface)var c=-.3*l.getReferenceEllipsoid(a.spatialReference).radius;else{const {min:d,max:v}=a.basemapTerrain.elevationBounds;c=d-Math.max(1,(v-d)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,c)}};b.update=function(){this._set("updating",
!1);if(this.extent){this.updateExtentIntersection();var a=this.layerView.view.frustum,c=l.getReferenceEllipsoid(this.layerView.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(a,c))}else this._set("suspended",!1)};h._createClass(f,[{key:"isVisibleBelowSurface",set:function(a){this._isVisibleBelowSurface=a;this._setDirty();this.extentIntersectionDirty=!0}}]);return f}(q);g.__decorate([k.property({readOnly:!0})],e.prototype,"suspended",void 0);g.__decorate([k.property({readOnly:!0})],
e.prototype,"updating",void 0);return e=g.__decorate([p.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],e)});
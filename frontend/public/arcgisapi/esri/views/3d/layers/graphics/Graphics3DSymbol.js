// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/asyncUtils ./Graphics3DObject3DGraphicLayer ./Loadable ./symbolComplexity ./Graphics3DGraphic ./Graphics3DSymbolLayerFactory".split(" "),function(n,f,p,t,u,v,w,x,y){const l={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(q){function m(a,c,e){var b=q.call(this)||this;b._symbol=a;b._context=c;b._backgroundLayers=e;b._destroyed=!1;b.symbolLayers=[];b.referenced=
0;b._extentPadding=0;return b}n._inheritsLoose(m,q);var k=m.prototype;k.doLoad=async function(a){let c=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(c=this._backgroundLayers.concat(c));const e=c.length;for(;this.symbolLayers.length<c.length;)this.symbolLayers.push(null);this.symbolLayers.length=c.length;const b=[];for(let d=0;d<e;d++){const g=c.getItemAt(d);if(!1===g.enabled)continue;l.renderPriority=1-(1+d)/e;l.renderPriorityStep=1/e;l.ignoreDrivers=g._ignoreDrivers;const h=
y.make(this.symbol,g,this._context,l);b.push(p.onAbortOrThrow(a,()=>{this.symbolLayers[d]=null;h.destroy()}));this.symbolLayers[d]=h}await t.forEach(this.symbolLayers,async(d,g)=>{if(f.isSome(d))try{await d.load(),this._extentPadding+=Math.max(this._extentPadding,d.extentPadding)}catch{this.symbolLayers[g]=null}});for(const d of b)null==d?void 0:d.remove();b.length=0;p.throwIfAborted(a);if(this.symbolLayers.length&&!this.symbolLayers.some(d=>!!d))throw Error();};k.getSymbolLayerSize=function(a){a=
this.symbolLayers[a];return f.isSome(a)?a.getCachedSize():null};k.createGraphics3DGraphic=function(a,c){const e=a.graphic,b=Array(this.symbolLayers.length);for(let d=0;d<this.symbolLayers.length;d++){const g=this.symbolLayers[d];b[d]=f.isSome(g)?g.createGraphics3DGraphic(a):null}return new x(e,c||this,b,a.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};k.globalPropertyChanged=
function(a,c){const e=this.symbolLayers.length;for(let b=0;b<e;b++){const d=this.symbolLayers[b],g=h=>{h=h._graphics[b];return h instanceof u?h:null};if(f.isSome(d)&&!d.globalPropertyChanged(a,c,g))return!1}return!0};k.applyRendererDiff=function(a,c){return 1!==this.loadStatus?!1:this.symbolLayers.reduce((e,b)=>e&&(f.isNone(b)||b.applyRendererDiff(a,c)),!0)};k.prepareSymbolPatch=function(a){if(2!==this.loadStatus&&"partial"===a.diff.type){var c=a.diff.diff;if(c.symbolLayers&&"partial"===c.symbolLayers.type){var e=
c.symbolLayers.diff;this.symbolLayers.forEach((b,d)=>{if(!f.isNone(b)){var g=e[d];if(g){const h={diff:g,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};b.prepareSymbolLayerPatch(h);a.symbolStatePatches.push(...h.symbolLayerStatePatches);h.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push((z,A)=>{const r=z._graphics[d];f.isSome(r)&&h.graphics3DGraphicPatches.forEach(B=>B(r,A))})}}})}}};k.updateGeometry=function(a,c){for(let e=0;e<this.symbolLayers.length;e++){const b=this.symbolLayers[e];
if(f.isNone(b))continue;const d=a._graphics[e];if(f.isNone(d)||!b.updateGeometry(d,c))return!1}return!0};k.onRemoveGraphic=function(a){for(let c=0;c<this.symbolLayers.length;c++){const e=this.symbolLayers[c];if(f.isNone(e))continue;const b=a._graphics[c];if(f.isSome(b))e.onRemoveGraphic(b)}};k.getFastUpdateStatus=function(){let a=0,c=0,e=0;this.symbolLayers.forEach(b=>{f.isNone(b)||(0===b.loadStatus?a++:b.isFastUpdatesEnabled()?e++:c++)});return{loading:a,slow:c,fast:e}};k.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");
else{this.abortLoad();for(const a of this.symbolLayers)f.isSome(a)&&a.destroy();this.symbolLayers.length=0;this._destroyed=!0}};n._createClass(m,[{key:"symbol",set:function(a){this._symbol=a;if(this.symbolLayers)for(let c=0;c<a.symbolLayers.length;c++){const e=this.symbolLayers[c];f.isNone(e)||(e.symbol=a,e.symbolLayer=a.symbolLayers.items[c])}},get:function(){return this._symbol}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"complexity",get:function(){return w.totalSymbolComplexities(this.symbolLayers.map(a=>
f.get(a,"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return m}(v.Loadable)});
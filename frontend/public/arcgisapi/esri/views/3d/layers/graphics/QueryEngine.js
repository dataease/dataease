// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../geometry/Extent ../../../../geometry/support/typeUtils ../../../../geometry ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query ../../../../layers/graphics/data/QueryEngine".split(" "),
function(c,l,f,F,p,G,H,g,I,q,J,K,L,r,t,u,M,m,v,w){const x=w["default"];c.QueryEngine=function(n){function h(a){a=n.call(this,a)||this;a._dataQueryEngineInstance=null;return a}l._inheritsLoose(h,n);var d=h.prototype;d.destroy=function(){this.clear()};d.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};d.executeQueryForIdSet=async function(a,b){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(a),
b)};d.executeQueryForCount=async function(a,b){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(a),b)};d.executeQueryForExtent=async function(a,b){const {count:e,extent:k}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(a),b);a=t.fromJSON(k);return{count:e,extent:a}};d.executeQueryForIds=async function(a,b){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(a),b)};d.executeQueryForLatestObservations=async function(a,b){a=await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(a),
b);a=m.fromJSON(a);a.features.forEach(e=>{e.layer=this.layer;e.sourceLayer=this.layer});return a};d.executeQuery=async function(a,b){a=await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(a),b);a=m.fromJSON(a);a.features.forEach(e=>{e.layer=this.layer;e.sourceLayer=this.layer});return a};d._ensureQueryJSON=function(a){if(p.isNone(a))return this.defaultQueryJSON;"outSpatialReference"in a&&!a.outSpatialReference&&(a.outSpatialReference=this.spatialReference);return a.toJSON()};d.ensureDataQueryEngine=
function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const a="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,b=this.layer.objectIdField,e=u.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),k=this.layer.fields.map(y=>y.toJSON()),z=this.layerView.view.resourceController.scheduler,A=this.task,B=this.spatialReference.toJSON(),C=this.layerView.graphics3d.graphicsCore.featureStore,{hasZ:D,hasM:E}=this.layerView;return this._dataQueryEngineInstance=
new x({hasZ:D,hasM:E,geometryType:e,fields:k,timeInfo:a,spatialReference:B,objectIdField:b,featureStore:C,scheduler:z,task:A})};l._createClass(h,[{key:"queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new v({outSpatialReference:this.spatialReference})).toJSON()}},{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}}]);
return h}(r);f.__decorate([g.property({constructOnly:!0})],c.QueryEngine.prototype,"layerView",void 0);f.__decorate([g.property({constructOnly:!0})],c.QueryEngine.prototype,"task",void 0);f.__decorate([g.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],c.QueryEngine.prototype,"spatialReference",void 0);f.__decorate([g.property({readOnly:!0,aliasOf:"layerView.layer"})],c.QueryEngine.prototype,"layer",void 0);f.__decorate([g.property({readOnly:!0,dependsOn:["layer.geometryType"]})],
c.QueryEngine.prototype,"queryGeometryType",null);f.__decorate([g.property({readOnly:!0,dependsOn:["spatialReference"]})],c.QueryEngine.prototype,"defaultQueryJSON",null);c.QueryEngine=f.__decorate([q.subclass("esri.views.3d.layers.graphics.QueryEngine")],c.QueryEngine);c.default=c.QueryEngine;Object.defineProperty(c,"__esModule",{value:!0})});
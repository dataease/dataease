// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/aliasOf ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../tasks/operations/query ../../../../layers/graphics/dehydratedFeatures ../../support/PBFDecoder".split(" "),
function(x,n,d,D,q,E,F,k,A,G,r,H,I,J,t,u,y,z,B){let h=function(b){function a(){return b.apply(this,arguments)||this}n._inheritsLoose(a,b);var f=a.prototype;f.queryFeatureCount=function(c,e){return this.layer.queryFeatureCount(c,e)};f.destroy=function(){this._decoder=q.destroyMaybe(this._decoder)};n._createClass(a,[{key:"queryFeaturesDehydrated",get:function(){var c=this.layer.capabilities;if((c=c&&c.query)&&c.supportsFormatPBF){var e,g;q.isNone(this._decoder)&&(this._decoder=new B.PBFDecoder(this.scheduler));
const v={sourceSpatialReference:null!=(e=null==(g=this.layer.spatialReference)?void 0:g.toJSON())?e:null,applyTransform:!0,maxStringAttributeLength:1024};return(w,l)=>y.runQuery(this.layer.parsedUrl,w,"pbf",l).then(C=>{t.throwIfAborted(l);return q.isSome(this._decoder)?this._decoder.invoke({buffer:C.data,options:v},l.signal):t.reject(t.createAbortError())})}return(v,w)=>y.executeQuery(this.layer.parsedUrl,v,this.layer.spatialReference,w).then(l=>z.fromFeatureSetJSON(l.data))}}]);return a}(u);d.__decorate([k.property({constructOnly:!0})],
h.prototype,"layer",void 0);d.__decorate([k.property({constructOnly:!0})],h.prototype,"scheduler",void 0);d.__decorate([k.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],h.prototype,"queryFeaturesDehydrated",null);h=d.__decorate([r.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],h);let p=function(b){function a(){return b.apply(this,arguments)||this}n._inheritsLoose(a,b);a.prototype.queryFeaturesDehydrated=function(f,c){return this.layer.queryFeatures(f,
c)};return a}(u);d.__decorate([k.property({constructOnly:!0})],p.prototype,"layer",void 0);p=d.__decorate([r.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],p);let m=function(b){function a(){return b.apply(this,arguments)||this}n._inheritsLoose(a,b);var f=a.prototype;f.destroy=function(){};f.queryFeaturesDehydrated=function(c,e){return this.source.queryFeaturesJSON(c,e).then(z.fromFeatureSetJSON,g=>{if(g&&"query-features-json:unsupported"===g.name)return this.layer.queryFeatures(c,
e);throw g;})};f.queryFeatureCount=function(c,e){return this.layer.queryFeatureCount(c,e)};return a}(u);d.__decorate([k.property({constructOnly:!0})],m.prototype,"layer",void 0);d.__decorate([A.aliasOf("layer.source")],m.prototype,"source",void 0);m=d.__decorate([r.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],m);x.createFeatureTileQuery3D=function(b,a){switch(b.source.type){case "feature-layer":return new h({layer:b,scheduler:a});case "memory":case "csv":case "geojson":return new m({layer:b});
case "ogc-feature":return new p({layer:b});case "stream-layer":throw Error("Tile based queries unsupported for stream sources");}};Object.defineProperty(x,"__esModule",{value:!0})});
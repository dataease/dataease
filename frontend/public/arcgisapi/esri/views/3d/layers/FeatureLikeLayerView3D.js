// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/watchUtils ../../support/Scheduler ../../../tasks/support/Query ../../../layers/graphics/hydratedFeatures ../../../renderers/support/renderingInfoUtils ../../../layers/graphics/controllers/FeatureTileController3D ./support/projectExtentUtils ./graphics/QueryEngine ./graphics/Graphics3DFeatureLikeLayerView".split(" "),
function(m,n,e,D,h,E,F,f,G,t,p,H,I,J,q,u,v,w,x,r,y,z,A,B){m.FeatureLikeLayerView3D=d=>{d=function(k){function l(){var a=k.apply(this,arguments)||this;a.controller=null;a.asyncGraphicsUpdates=!1;a.suspendResumeExtentMode="computed";a.slicePlaneEnabled=!1;a.drapeSourceType=1;a.fullExtentInLocalViewSpatialReference=null;a.suspendResumeExtent=null;a._controllerCreated=!1;a.clippingExtent=null;a.supportsHeightUnitConversion=!0;a.pendingController=null;a.queryEngine=null;return a}n._inheritsLoose(l,k);
var c=l.prototype;c.initialize=function(){const a=this.layer;"isTable"in a&&a.isTable?this.addResolvingPromise(q.reject(new p("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:a}))):(this._set("graphics3d",new B({owner:this,layer:a,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,
updateClippingExtent:b=>this.updateClippingExtent(b)})),this.updatingHandles.add(this,"asyncGraphicsUpdates",b=>{this.graphics3d.graphicsCore.preferredUpdatePolicy=b?1:0}),this.updatingHandles.add(this,"suspendResumeExtentMode",b=>{this.graphics3d.suspendResumeExtentMode=b}),this.addResolvingPromise(this.graphics3d.setup().then(()=>this.validateGeometryType()).then(()=>this.queryEngine=new A["default"]({layerView:this,task:v.Task.FEATURE_QUERY_ENGINE})).then(()=>z.toViewIfLocal(this)).then(b=>this.fullExtentInLocalViewSpatialReference=
b).then(()=>this.initializeController())),this.notifyChange("updating"))};c.destroy=function(){this.destroyPendingController();this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this.queryEngine&&(this.queryEngine.destroy(),this.queryEngine=null);this.loadedGraphics=null};c.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};c.notifyGraphicUpdate=
function(a,b){this.graphics3d.graphicsCore.notifyGraphicUpdate(a,b)};c.getRenderingInfo=function(a,b,g){(a=r.getRenderingInfo(a,{renderer:b,arcade:g}))&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};c.getRenderingInfoAsync=async function(a,b,g,C){return r.getRenderingInfoAsync(a,{renderer:b,arcade:g,...C})};c.getGraphicFromGraphicUid=function(a){let b=null;this.loadedGraphics&&this.loadedGraphics.forEach(g=>{g.uid===a&&(b=x.hydrateGraphic(g,this.layer))});return b};c.whenGraphicBounds=
function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(a,b):null};c.computeAttachmentOrigin=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(a,b):null};c.getSymbolLayerSize=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(a,b):null};c.queryFeatures=function(a,b){return this.queryEngine.executeQuery(this._ensureQuery(a),h.get(b,"signal"))};c.queryObjectIds=function(a,b){return this.queryEngine.executeQueryForIds(this._ensureQuery(a),
h.get(b,"signal"))};c.queryFeatureCount=function(a,b){return this.queryEngine.executeQueryForCount(this._ensureQuery(a),h.get(b,"signal"))};c.queryExtent=function(a,b){return this.queryEngine.executeQueryForExtent(this._ensureQuery(a),h.get(b,"signal"))};c._ensureQuery=function(a){return h.isNone(a)?this.createQuery():w.from(a)};c.highlight=function(a){return this.graphics3d.highlight(a,this.layer.objectIdField)};c.maskOccludee=function(a){return this.graphics3d.maskOccludee(a)};c.canResume=function(){return!k.prototype.canResume.call(this)||
this.graphics3d&&this.graphics3d.suspended?!1:!0};c.getSuspendInfo=function(){const a=k.prototype.getSuspendInfo.call(this);return this.graphics3d?{...a,...this.graphics3d.suspendInfo}:a};c.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!(!(!this._controllerCreated||this.controller&&this.controller.updating)&&this.view.basemapTerrain&&this.view.basemapTerrain.ready&&!this.graphics3d.updating)};c.initializeController=async function(){const a=this.createController();this.pendingController=
a;await a.when();this.setControllerWhenInitialized(a)};c.setControllerWhenInitialized=async function(a){try{await this.when()}catch(b){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||this.destroyed?this.destroyPendingController():(await u.whenTrueOnce(this.view,"basemapTerrain.ready"),this.beforeSetController(a),this.pendingController=null,this.controller=a,this.loadedGraphics=a.graphics,this.notifyChange("updating"))};c.updateClippingExtent=function(a){this.clippingExtent=
a;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=a,!0}};c.validateGeometryType=function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":return q.reject(new p("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}};c._getResourceInfo=function(){const a=this.controller&&this.controller instanceof y?this.controller:
null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:a?a.maximumNumberOfFeatures:-1,totalNumberOfFeatures:a?a.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}};n._createClass(l,[{key:"legendEnabled",get:function(){var a,b;return this.canResume()&&!(null!=
(a=this.graphics3d)&&null!=(b=a.frustumVisibility)&&b.suspended)}},{key:"graphics3DGraphics",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}},{key:"symbolUpdateType",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);
return l}(d);e.__decorate([f.property()],d.prototype,"loadedGraphics",void 0);e.__decorate([f.property({dependsOn:["graphics3d.suspended"]})],d.prototype,"suspended",void 0);e.__decorate([f.property({readOnly:!0,dependsOn:["graphics3d.frustumVisibility.suspended"]})],d.prototype,"legendEnabled",null);e.__decorate([f.property({dependsOn:["graphics3d.updating","controller.updating"]})],d.prototype,"updating",void 0);e.__decorate([f.property()],d.prototype,"controller",void 0);e.__decorate([f.property()],
d.prototype,"graphics3d",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"asyncGraphicsUpdates",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"suspendResumeExtentMode",void 0);e.__decorate([f.property({type:Boolean})],d.prototype,"slicePlaneEnabled",void 0);e.__decorate([f.property({readOnly:!0,dependsOn:["graphics3d.suspendInfo"]})],d.prototype,"suspendInfo",void 0);return d=e.__decorate([t.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],d)};Object.defineProperty(m,
"__esModule",{value:!0})});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../geometry/projectionEllipsoid ../../../../../chunks/vec2f64 ../../../../../chunks/vec2 ../../../support/geometryUtils ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils ../../utils/navigationUtils ../InteractiveController".split(" "),
function(g,n,p,q,D,E,w,F,x,G,H,I,y,h,d,z,r,A,k,B,t,f,C){g.ZoomController=function(u){function l(a){a=u.call(this,a)||this;a.view=null;a.pickPoint=h.create();a.tmpP0=r.create();a.panAxisAngle=k.axisAngle.create();a.tmpRayDir=h.create();a.targetOnSphere=h.create();a.tmpRay={origin:h.create(),direction:h.create()};a.dragBeginPoint=y.createScreenPointArray();a.normalizedAnchorPoint=r.create();a.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0};a.sphere=k.sphere.create();a.hasPickPoint=!1;return a}n._inheritsLoose(l,u);var m=l.prototype;m.begin=function(a){if(this.active){A.copy(this.dragBeginPoint,a);f.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint);var b=z.getReferenceEllipsoid(this.view.spatialReference),e=f.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,a,!1,b);this.navMode=f.decideNavigationMode(this.beginCamera,a,e.hasGeometryIntersection,b);if(this.navMode===f.NavigationMode.Horizontal||
q("disable-feature:context-navigation"))this.hasPickPoint=!!e.scenePickPoint,this.pickPoint=e.scenePickPoint,this.sphere=e.sphere;else{k.ray.fromScreenAtEye(this.beginCamera,a,this.tmpRay);d.normalize(this.tmpRay.direction,this.tmpRay.direction);let c;this.view.camera.position.hasZ&&(c=Math.abs(this.view.camera.position.z));b=30*c;a=this.view._stage.renderView.getMinimalDepthForArea(a[0],a[1],this.view._stage.getCamera(),70);b=b>a?a:b;this.hasPickPoint=!0;d.scale(this.tmpRay.direction,this.tmpRay.direction,
b);d.add(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.beginCamera}};m.update=function(a){if(this.active){this.currentCamera.eye=this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;if(this.navMode===f.NavigationMode.Horizontal||q("disable-feature:context-navigation")){d.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var b=d.length(this.tmpRayDir);f.normalizeCoordinate(this.currentCamera,
a,this.tmpP0);var e=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),c=b*Math.pow(2,e);const v=this.view.state.constraints.minimumPoiDistance;0>e&&c<v&&(c=v);if(1E-6>Math.abs(b-c))return;this.hasPickPoint&&c<b&&(e=1-(1-c/b)*(1-this.sphere.radius/d.length(this.currentCamera.center)),d.scale(this.currentCamera.center,this.currentCamera.center,e));d.scale(this.tmpRayDir,this.tmpRayDir,-c/b);d.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir);this.constraintOptions.interactionFactor=
t.pixelDistanceToInteractionFactor(this.dragBeginPoint,a);t.applyAll(this.view,this.currentCamera,this.constraintOptions);this.hasPickPoint&&(f.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),k.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),f.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle))}else{b=d.length(this.tmpRay.direction);f.normalizeCoordinate(this.currentCamera,a,this.tmpP0);a=12*(this.normalizedAnchorPoint[1]-
this.tmpP0[1]);c=b*Math.pow(2,a);e=this.view.state.constraints.minimumPoiDistance;0>a&&c<e&&(c=e);if(1E-6>Math.abs(b-c))return;d.scale(this.tmpRayDir,this.tmpRay.direction,1-c/b);d.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir);d.add(this.currentCamera.center,this.currentCamera.center,this.tmpRayDir)}B.applySurfaceCollisionConstraint(this.view,this.currentCamera)}};m.end=function(){this.active&&this.finishController()};n._createClass(l,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return l}(C.InteractiveController);p.__decorate([w.property({constructOnly:!0})],g.ZoomController.prototype,"view",void 0);g.ZoomController=p.__decorate([x.subclass("esri.views.3d.state.controllers.global.ZoomController")],g.ZoomController);Object.defineProperty(g,"__esModule",{value:!0})});
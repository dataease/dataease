// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/mathUtils ../../../../../geometry/projectionEllipsoid ../../../../../support/featureFlags ../../../../../chunks/vec2 ../../../support/geometryUtils ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../../utils/navigationUtils ../InteractiveController ../../../input/util ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(m,q,r,P,Q,R,x,S,y,T,U,V,z,g,k,e,A,B,C,D,l,f,E,c,F,t,G,H,I,J,K,L,M,N,O){m.PinchAndPanController=function(u){function p(a){a=u.call(this,a)||this;a.view=null;a.smoothRotation=new t.ExponentialFalloff(.05);a.rotationAxis=k.create();a.panningPlane=l.plane.create();a.smoothScaling=new t.ExponentialFalloff(.05);a.zoomCenterScreen=g.createScreenPointArray();a.zoomMomentumEstimator=new O.ZoomMomentumEstimator;a.rotationMomentumEstimator=new N.RotationMomentumEstimator;a.panSphericalMomentumEstimator=
new M.PanSphericalMomentumEstimator;a.panPlanarMomentumEstimator=new L.PanPlanarMomentumEstimator;a.adjustedSphere=l.sphere.create();a.tmp3d=k.create();a.tmpScreenPointArray=g.createScreenPointArray();a.beginScreenPoint=g.createScreenPointArray();a.beginScenePoint=k.create();a.screenPickPoint=g.createScreenPointArray();a.navMode=c.NavigationMode.Horizontal;a.tmpInteractionDirection=k.create();a.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new E,interactionDirection:null,
tiltMode:0};return a}q._inheritsLoose(p,u);var h=p.prototype;h.begin=function(a){if(this.active){var b=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=b;this.rotationMomentumEstimator.enabled=b;this.panPlanarMomentumEstimator.enabled=b;this.panSphericalMomentumEstimator.enabled=b;this.beginHeading=-A.cyclicalPI.normalize(z.deg2rad(this.view.camera.heading));this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();g.screenPointObjectToArray(a.center,
this.screenPickPoint);D.copy(this.beginScreenPoint,this.screenPickPoint);b=B.getReferenceEllipsoid(this.view.spatialReference);var d=c.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0,b);this.scenePickPoint=d.scenePickPoint;this.sphere=d.sphere;e.copy(this.beginScenePoint,this.scenePickPoint);this.navMode=c.decideNavigationMode(this.beginCamera,this.screenPickPoint,d.hasGeometryIntersection,b);this.navMode===c.NavigationMode.Vertical&&this.preparePlanarPanMode(a);
this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};h.preparePlanarPanMode=function(a){var b=e.negate(this.tmp3d,this.beginCamera.viewForward);l.plane.fromPositionAndNormal(this.scenePickPoint,b,this.panningPlane);var d=g.createScreenPointArray(this.screenPickPoint[0],0);b=k.create();var n=e.length(this.beginCamera.eye);this.adjustedSphere.radius=n<this.sphere.radius?n-100:this.sphere.radius;c.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,d,b);d=g.createRenderScreenPointArray3();
this.beginCamera.projectToRenderScreen(b,d);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*d[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&l.plane.fromPositionAndNormal(this.scenePickPoint,l.plane.normal(this.panningPlane),this.panningPlane);if(!C.disableContextNavigation()&&this.view._stage.getCamera()._contextNavigation){b=k.create();d=k.create();n=k.create();e.subtract(b,this.scenePickPoint,this.currentCamera.eye);e.normalize(b,b);const v=5*
Math.max(Math.abs(this.view.camera.position.z),50),w=this.view._stage.renderView.getMinimalDepthForArea(this.screenPickPoint[0],this.screenPickPoint[1],this.view._stage.getCamera(),80);e.copy(n,e.add(d,this.currentCamera.eye,e.scale(d,b,w?Math.min(w,v):v)));this.panningPlane[3]=-e.dot(this.panningPlane,n)}a=g.screenPointObjectToArray(a.center,this.tmpScreenPointArray);c.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,a,this.beginScenePoint)};h.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);
var b=1<a.pointers.size;this.navMode===c.NavigationMode.Horizontal?(b&&this.zoomSpherical(a),this.panningSpherical(a),b&&this.rotateSpherical(a)):(b&&this.zoomPlanar(a),this.panningPlanar(a),b&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};h.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.navMode===c.NavigationMode.Horizontal?new K.ZoomSphericalMomentumController({view:this.view,
momentum:a,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere.radius}):new J.ZoomPlanarMomentumController({view:this.view,momentum:a,zoomCenter:this.beginScenePoint});if(a=this.rotationMomentumEstimator.evaluateMomentum())return new I.RotationMomentumController({view:this.view,momentum:a,center:this.sphere.center,axis:this.rotationAxis});if(this.navMode===c.NavigationMode.Horizontal){if(a=this.panSphericalMomentumEstimator.evaluateMomentum())return new H.PanSphericalMomentumController({view:this.view,
momentum:a})}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new G.PanPlanarMomentumController({view:this.view,momentum:a});return null};h.zoomSpherical=function(a){const b=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(b);c.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);g.screenPointObjectToArray(a.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,
.001*a.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);f.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.panningSpherical=function(a){const b=g.screenPointObjectToArray(a.center,this.tmpScreenPointArray);c.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,b,this.tmp3d);c.preserveHeadingThreshold(this.beginScenePoint,e.dot(this.currentCamera.up,this.beginScenePoint),
this.sphere.radius,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(c.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(b,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(c.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,
!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(b,this.tmp3d,.001*a.timestamp,this.beginCamera,this.sphere.radius,this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(this.screenPickPoint,b);f.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.rotateSpherical=function(a){e.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||e.negate(this.rotationAxis,
this.rotationAxis);var b=this.smoothRotation.value,d=c.normalizeRotationDelta(a.angle-b);b+=d;this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(b);d=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(d,.001*a.timestamp);c.applyRotation(this.currentCamera,this.sphere.center,l.axisAngle.wrapAxisAngle(this.rotationAxis,d));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(a.radius*
b);f.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.panningPlanar=function(a){const b=g.screenPointObjectToArray(a.center,this.tmpScreenPointArray);c.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,b,this.tmp3d)&&(c.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(b,this.tmp3d,.001*a.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(this.beginScreenPoint,
b),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),f.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};h.zoomPlanar=function(a){const b=this.beginRadius/a.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(a.radius,40),120);this.smoothScaling.update(b);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*a.timestamp);c.applyZoomToPoint(this.currentCamera,
this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(a.radius-this.beginRadius);f.applyAll(this.view,this.currentCamera,this.constraintOptions)};h.rotatePlanar=function(a){e.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||e.negate(this.rotationAxis,this.rotationAxis);var b=this.smoothRotation.value;let d=a.angle-
b;d=c.normalizeRotationDelta(d);this.smoothRotation.gain=.00125*Math.min(Math.max(a.radius,40),120);this.smoothRotation.update(b+d);b=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(b,.001*a.timestamp);c.applyRotation(this.currentCamera,this.sphere.center,l.axisAngle.wrapAxisAngle(this.rotationAxis,b));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(a.radius*b);f.applyAll(this.view,this.currentCamera,
this.constraintOptions)};q._createClass(p,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return p}(F.InteractiveController);r.__decorate([x.property({constructOnly:!0})],m.PinchAndPanController.prototype,"view",void 0);m.PinchAndPanController=r.__decorate([y.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],m.PinchAndPanController);Object.defineProperty(m,"__esModule",{value:!0})});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/Handles ../../../../chunks/mat4f64 ../../support/stack ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Geometry ./Object3DVisualElement ../../webgl-engine/materials/MeasurementArrowMaterial".split(" "),function(p,q,g,r,x,y,z,h,A,B,l,C){l=function(t){function k(a){var b=t.call(this,a)||this;b._parameters=D;b._handles=null;b._origin=r.create();
b._originTransform=z.create();b._arrowCenter=r.create();b._renderOccluded=4;b._geometry=null;b._stripeLength=1;b.applyProps(a);return b}q._inheritsLoose(k,t);var d=k.prototype;d.createExternalResources=function(){this._arrowMaterial=new C.MeasurementArrowMaterial({outlineColor:this._parameters.arrowOutlineColor,stripeEvenColor:this._parameters.arrowStripeEvenColor,stripeOddColor:this._parameters.arrowStripeOddColor,renderOccluded:this.renderOccluded,polygonOffset:!0},"arrow");this._handles=new y;
this._handles.add(this.view.state.watch("camera",()=>{this.viewChanged()}))};d.destroyExternalResources=function(){this._arrowMaterial=null;this._handles.destroy();this._handles=null};d.forEachExternalResource=function(a){a(this._arrowMaterial)};d.createGeometries=function(a){if(!(g.isNone(this._geometry)||g.isNone(this._geometry.startRenderSpace)||g.isNone(this._geometry.endRenderSpace))){var b=this._createArrowGeometry(this._geometry.startRenderSpace,this._geometry.endRenderSpace,this._origin,this._geometry);
a.addGeometry(b,this._arrowMaterial,this._originTransform);this.viewChanged()}};d._createArrowGeometry=function(a,b,E,c){const u=this.view.renderCoordsHelper,v=[],w=[],n=(m,e)=>{const f=h.sv3d.get();x.subtract(f,m,E);v.push(f);w.push(e)};if("euclidean"===c.type)c.eval(.5,this._arrowCenter),c=h.sv3d.get(),u.worldUpAtPosition(this._arrowCenter,c),n(a,c),n(b,c);else for(c.eval(.5,this._arrowCenter),a=this._parameters.arrowSubdivisions+1&-2,b=0;b<a;++b){const m=b/(a-1),e=h.sv3d.get(),f=h.sv3d.get();c.eval(m,
e);u.worldUpAtPosition(e,f);n(e,f)}return new B(A.createPolylineGeometry(v,w),"arrow")};d.geometryChanged=function(){this.recreateGeometry()};d.viewChanged=function(){if(this.view.ready&&this.attached&&g.isSome(this._geometry)){const a=this.view._stage.getCamera().computeScreenPixelSizeAt(this._arrowCenter);this._arrowMaterial.setParameterValues({width:this._parameters.arrowWidth*a})}};q._createClass(k,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&
(this._renderOccluded=a,this._arrowMaterial&&this._arrowMaterial.setParameterValues({renderOccluded:a}))}},{key:"geometry",get:function(){return this._geometry},set:function(a){this._geometry=a;this.geometryChanged()}},{key:"stripeLength",get:function(){return this._stripeLength},set:function(a){this._stripeLength=a;this.attached&&this._arrowMaterial.setParameterValues({stripeLength:this._stripeLength})}}]);return k}(l.Object3DVisualElement);const D={arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,
arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128};p.MeasurementArrowVisualElement=l;Object.defineProperty(p,"__esModule",{value:!0})});
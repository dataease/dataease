// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/maybe ../../../../core/handleUtils ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../support/elevationInfoUtils ../../layers/graphics/elevationAlignmentUtils ../../layers/graphics/ElevationContext ../visualElements/LaserlineVisualElement ../visualElements/ExtendedLineVisualElement ../visualElements/PointVisualElement ./settings ./ManipulatorState ../../layers/graphics/GraphicState".split(" "),
function(y,z,p,F,G,H,I,J,v,w,A,K,L,B,M,N,k,O,P){function Q(a,e,d,f){const {view:b,graphic:c}=a,l=new M.ExtendedLineVisualElement({view:b,extensionType:k.settings.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:4});k.settings.visualElements.zVerticalLine.apply(l);const n=new B.LaserlineVisualElement({view:b,intersectsLineInfinite:!0,attached:!1});k.settings.visualElements.pointGraphics.shadowStyle.apply(n);var q=F.deg2rad(k.settings.visualElements.heightPlaneAngleCutoff);
const r=new B.LaserlineVisualElement({view:b,attached:!1,angleCutoff:q});k.settings.visualElements.heightPlane.apply(r);q=A.getGraphicEffectiveElevationInfo(a.graphic);const R=L.ElevationContext.fromElevationInfo(q),S="on-the-ground"===q.mode||!q.offset&&"absolute-height"!==q.mode,x=new O.ManipulatorState;let C=1,D=1;const u=()=>{x.update(a);var m=S&&(e.isDraped||!t(c)||!c.geometry.hasZ);let E=!0;if(!m&&t(c)){var g=c.geometry;const T=K.evaluateElevationAlignmentAtPoint(c.geometry,b.elevationProvider,
R,b.renderCoordsHelper);H.set(h,g.x,g.y,T);v.projectVectorToVector(h,g.spatialReference,h,b.renderCoordsHelper.spatialReference);l.setStartEndFromWorldDownAtLocation(h);n.intersectsWorldUpAtLocation=h}else E=!1;g=x.grabbingState&2?k.settings.visualElements.laserlineAlphaMultiplier:1;g!==C&&(C=g,k.settings.visualElements.heightPlane.apply(r,g));g=w.empty(U);!m&&e.displaying&&f.calculateMapBounds(g)&&v.projectVectorToVector(w.getMin(g,h),b.spatialReference,h,b.renderCoordsHelper.spatialReference)?(r.heightManifoldTarget=
h,r.attached=!0):r.attached=!1;g=x.grabbingState&4?k.settings.visualElements.laserlineAlphaMultiplier:1;g!==D&&(D=g,k.settings.visualElements.pointGraphics.shadowStyle.apply(n,g));m=E&&e.displaying&&!m;n.attached=m;l.attached=m};d.push(e.watch(["displaying","isDraped"],u),e.on("changed",u));a.forEachManipulator(m=>{d.push(m.events.on("grab-changed",u))});d.push(p.destroyHandle(n));d.push(p.destroyHandle(l));d.push(p.destroyHandle(r));u()}function V(a,e,d){const {view:f,graphic:b}=a,c=new N.PointVisualElement({view:f,
geometry:t(b)?b.geometry:null,elevationInfo:A.getGraphicEffectiveElevationInfo(b),attached:!1});W(a,c,e,d);d.push(p.destroyHandle(c));return c}function W(a,e,d,f){X(a,e,d,f);k.settings.visualElements.pointGraphics.outline.apply(e);f.push(I.init(d,"displaying",()=>e.attached=d.displaying))}function X(a,e,d,f){const {view:b,graphic:c}=a;let l=null;const n=()=>{z.isSome(l)&&(l.remove(),l=null);d.isDraped&&t(c)&&(l=Y(b,c.geometry,()=>{e.geometry=c.geometry}))};a=()=>{n();e.geometry=t(c)?c.geometry:null};
f.push(d.on("changed",a),p.refHandle(()=>l));a()}function Y(a,e,d){v.projectPointToVector(e,h,a.elevationProvider.spatialReference);const f=h[0],b=h[1];return a.elevationProvider.on("elevation-change",c=>{J.containsXY(c.extent,f,b)&&d()})}function t(a){return z.isSome(a.geometry)&&"point"===a.geometry.type}const h=G.create(),U=w.create();y.createVisualElements=function(a){const {view:e,graphic:d}=a,f=new P.GraphicState({graphic:d}),b=[],c=V(a,f,b);Q(a,f,b,c);b.push(e.trackGraphicState(f));return{visualElement:c,
remove(){p.handlesGroup(b).remove()}}};Object.defineProperty(y,"__esModule",{value:!0})});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../geometry/projection ../../../chunks/plane ../support/geometryUtils ./PatchGeometryFactory ./Tile".split(" "),function(q,w,r,t,f,x,h,l,u,y,m){m=function(k){function n(b,a,c){var d=k.call(this,z)||this;d.obb=Array(8);d.isWebMercator=!1;for(let e=0;8>e;e++)d.obb[e]=t.create();void 0!==b&&d.init(b,a,c);return d}w._inheritsLoose(n,
k);var g=n.prototype;g.init=function(b,a,c){k.prototype.init.call(this,b,a,c);this.isWebMercator=c.tilingScheme.spatialReference.isWebMercator;a=this.ellipsoid.radius;c=this.extentInRadians[0];const d=this.extentInRadians[1],e=this.extentInRadians[2],v=this.extentInRadians[3];b=b[0];const A=r.lerp(d,v,.5),B=r.lerp(c,e,.5);this._edgeLen=(e-c)*Math.cos(0===b?0:Math.min(Math.abs(d),Math.abs(v)))*a;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=a-Math.sqrt(a*a-this._edgeLen2/4);h.lonLatToSphericalPCPF(this.centerAtSeaLevel,
B,A,this.ellipsoid.radius,0);a=t.fromArray(this.centerAtSeaLevel);f.normalize(a,a);this.up=a;this._updateOBB();this.updateRadiusAndCenter()};g.updateRadiusAndCenter=function(){if(0===this.lij[0])f.set(this._center[0],0,0,0),f.set(this._center[1],0,0,0),f.set(this._center[2],0,0,0),this.ellipsoid||(this.ellipsoid=x.getReferenceEllipsoid(this.surface.tilingScheme.spatialReference)),this._radius=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const b=Math.max(f.squaredDistance(this._center[0],
this.obb[0]),f.squaredDistance(this._center[0],this.obb[1]));this._radius=Math.sqrt(b)}};g._isVisible=function(){if(!this.intersectsClippingArea)return!1;const b=this.surface.frustum.planes;if(10>this.lij[0])return u.frustum.intersectsSphere(b,u.sphere.wrap(this._radius,this._center[0]));const a=this.obb;for(let c=0;6>c;c++){let d=b[c];4===c&&(d=l.copy(d,p),p[3]-=this.surface.view.state.camera.near);let e;for(e=0;8>e&&!l.isPointOutside(d,a[e]);e++);if(8===e)return!1}return!0};g.computeElevationBounds=
function(){k.prototype.computeElevationBounds.call(this);this._updateOBB()};g.createGeometry=function(b,a){const c=this._isPole(this.lij[1],this.lij[0]);y.createSphericalGlobePatch(b,this.extent,a,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,c);this.setMemoryDirty()};g._updateOBB=function(){var b=this.extentInRadians;const a=this.obb;for(let c=0;2>c;c++){const d=this.elevationBounds[c];let e=4*c;h.lonLatToSphericalPCPF(a[e++],b[0],b[1],this.ellipsoid.radius,d);h.lonLatToSphericalPCPF(a[e++],
b[0],b[3],this.ellipsoid.radius,d);h.lonLatToSphericalPCPF(a[e++],b[2],b[3],this.ellipsoid.radius,d);h.lonLatToSphericalPCPF(a[e++],b[2],b[1],this.ellipsoid.radius,d)}this.isWebMercator&&(b=this._isPole(this.lij[1],this.lij[0]),2===b?(f.set(a[1],0,0,this.ellipsoid.radius),f.set(a[2],0,0,this.ellipsoid.radius),f.set(a[5],0,0,this.ellipsoid.radius),f.set(a[6],0,0,this.ellipsoid.radius)):1===b&&(f.set(a[0],0,0,-this.ellipsoid.radius),f.set(a[3],0,0,-this.ellipsoid.radius),f.set(a[4],0,0,-this.ellipsoid.radius),
f.set(a[7],0,0,-this.ellipsoid.radius)))};g._isPole=function(b,a){let c=0;b===(1<<a)-1&&(c+=1);0===b&&(c+=2);return c};return n}(m["default"]);const z=[128,64,32,16,16,8,8,4],p=l.create();q.SphericalPatch=m;Object.defineProperty(q,"__esModule",{value:!0})});
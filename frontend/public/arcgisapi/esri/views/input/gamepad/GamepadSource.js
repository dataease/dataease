// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(l,n,p,q,g){let r=function(){function k(a,b){this.element=a;this.input=b;this._hasEventListeners=!1;this.onConnectGamepad=c=>{this.connectGamepad(c.gamepad)};this.onDisconnectGamepad=c=>{c=c.gamepad;const d=c.index,e=this.inputDevices[d];e&&(this.emitGamepadEvent(c,g.extractState(e),!1),this.inputDevices.splice(d,1),this.latestUpdate.splice(d,1),this.input.gamepad.devices.remove(e),
this.ensurePollingState())};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(this.connectGamepad),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState()}var f=k.prototype;f.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),
window.removeEventListener("gamepaddisconnected",this.onDisconnectGamepad))};f.connectGamepad=function(a){const b=new q(a);"unknown"!==b.deviceType&&(this.inputDevices[a.index]=b,this.input.gamepad.devices.add(b));this.ensurePollingState()};f.ensurePollingState=function(){this.eventsEnabled?this.startPolling():this.stopPolling()};f.startPolling=function(){null==this.frameTask&&(this.frameTask=p.addFrameTask({update:()=>this.readGamepadState()}))};f.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),
this.frameTask=null,this.latestUpdate=[])};f.readGamepadState=function(){const a=document.hasFocus(),b=this.element.contains(document.activeElement),c="document"===this.input.gamepad.enabledFocusMode&&!a||"view"===this.input.gamepad.enabledFocusMode&&!b;this.forEachGamepad(d=>{var e=this.inputDevices[d.index];if(e){var h=this.latestUpdate[d.index];e=g.extractState(e);var m=c||g.stateIdle(e);h&&(h.timestamp===d.timestamp||!h.active&&m||g.stateEqual(h.state,e))||this.emitGamepadEvent(d,e,!m)}})};f.forEachGamepad=
function(a){const b=window.navigator.getGamepads();for(let c=0;c<b.length;c++){const d=b[c];this.validate(d)&&a(d)}};f.emitGamepadEvent=function(a,b,c){var d=this.latestUpdate[a.index];if((d=d&&d.active)||c)this.latestUpdate[a.index]={timestamp:a.timestamp,state:b,active:c},this.callback&&this.callback({device:this.inputDevices[a.index],state:b,action:!d&&c?"start":d&&c?"update":"end"})};f.validate=function(a){if(!a||!a.connected)return!1;for(let b=0;b<a.axes.length;b++)if(isNaN(a.axes[b]))return!1;
return!0};n._createClass(k,[{key:"hasEventListeners",set:function(a){this._hasEventListeners!==a&&(this._hasEventListeners=a,this.ensurePollingState())}},{key:"eventsEnabled",get:function(){return this.supported&&0<this.inputDevices.length&&this._hasEventListeners}},{key:"onEvent",set:function(a){this.callback=a}}]);return k}();l.GamepadSource=r;Object.defineProperty(l,"__esModule",{value:!0})});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ../core/scheduling ../core/Accessor ../geometry/support/spatialReferenceUtils ../geometry/SpatialReference ../geometry/Extent ../core/Evented ../core/Collection ../core/Promise ../core/Loadable ../core/CollectionFlattener ../Map ../TimeExtent ../core/watchUtils ../geometry/HeightModelInfo ../core/HandleOwner ../support/GraphicsCollection ./BasemapView ./LayerViewManager ./Magnifier ./RefreshManager ./input/ViewEvents ./ToolViewManager ./input/Input ./navigation/Navigation ./support/DefaultsFromMap".split(" "),
function(h,d,b,z,A,W,e,r,X,B,C,Y,Z,aa,t,D,E,F,G,u,H,l,I,v,J,K,L,k,M,N,w,O,P,x,Q,R,S,T,y,U){var m;const n=A.getLogger("esri.views.View");b=m=function(q){function p(c){var a=q.call(this,c)||this;a._userSpatialReference=null;a._cursor=null;a.allLayerViews=new J({root:h._assertThisInitialized(a),rootCollectionNames:["basemapView.baseLayerViews","groundView?.layerViews","layerViews","basemapView.referenceLayerViews"],getChildrenFunction:g=>g.layerViews});a.animation=null;a.basemapView=null;a.defaultsFromMap=
new U({view:h._assertThisInitialized(a)});a.fatalError=null;a.extent=null;a.graphics=new w["default"];a.navigating=!1;a.layerViews=new l;a.magnifier=new x;a.padding={left:0,top:0,right:0,bottom:0};a.ready=!1;a.spatialReferenceWarningDelay=1E3;a.supportsGround=!0;a.timeExtent=null;a.type=null;a.scale=null;a.updating=!1;a.initialExtentRequired=!0;a.renderContext=null;a.input=new T;a.navigation=new y;a.layerViewManager=null;a.refreshManager=null;a.isHeightModelInfoRequired=!1;a.width=null;a.height=null;
a.resizing=!1;a.suspended=!1;a.viewEvents=new R.ViewEvents(h._assertThisInitialized(a));a.persistableViewModels=new l;a._isValid=!1;a._readyCycleForced=!1;a.handles.add(a.watch("preconditionsReady",g=>{g?(a._currentSpatialReference=a.spatialReference,m.views.add(h._assertThisInitialized(a))):(a._currentSpatialReference=null,m.views.remove(h._assertThisInitialized(a)));a.notifyChange("spatialReference");!g&&a.ready?(a.layerViewManager.clear(),a.toolViewManager.detach(),a._teardown()):g&&!a.ready&&
(a._startup(),a.toolViewManager.attach())},!0));return a}h._inheritsLoose(p,q);var f=p.prototype;f.initialize=function(){this.addResolvingPromise(this.validate().then(()=>{this._isValid=!0;return k.whenOnce(this,"ready")}));this.basemapView=new O.BasemapView({view:this});this.layerViewManager=new P({view:this,layerViewImporter:{importLayerView:a=>this.importLayerView(a),hasLayerViewModule:a=>this.hasLayerViewModule(a)},supportsGround:this.supportsGround});this.refreshManager=new Q({view:this});this.toolViewManager=
new S({view:this});this._resetInitialViewPropertiesFromContent();let c;k.init(this.defaultsFromMap,"isSpatialReferenceDone",a=>{const g=!!(this.map&&0<this.map.allLayers.length);if((!a||this.spatialReference||!g)&&c)c=null;else if(a&&!this.spatialReference&&g&&!c){const V=c=t.after(this.spatialReferenceWarningDelay);c.then(()=>{V===c&&n.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")}).catch(()=>{})}},!0)};f.destroy=function(){if(!this.destroyed){this.viewEvents.destroy();
this.allLayerViews.destroy();this.navigation&&(this.navigation.destroy(),this._set("navigation",null));this.graphics.destroy();this.graphics=null;this.handles.remove("defaultsFromMap");this.defaultsFromMap.destroy();this._set("defaultsFromMap",null);this.toolViewManager.destroy();this.toolViewManager=null;this.refreshManager.destroy();this.refreshManager=null;this.layerViewManager.destroy();this.layerViewManager=null;this.basemapView.destroy();this.basemapView=null;this.invalidate();this._emitter.clear();
this.handles.removeAll();var c=this.map;this.map=null;null==c?void 0:c.destroy()}};f._startup=function(){this._set("ready",!0)};f._teardown=function(){this._set("ready",!1)};f.whenReady=function(){return t.resolve()};f.toMap=function(){n.error("#toMap()","Not implemented on this instance of View");return null};f.whenLayerView=function(c){return this.layerViewManager.whenLayerView(c)};f.getDefaultSpatialReference=function(){return this.get("defaultsFromMap.spatialReference")};f.getDefaultHeightModelInfo=
function(){return this.get("map.supportsHeightModelInfo")&&this.get("map.heightModelInfo")||this.get("defaultsFromMap.heightModelInfo")||null};f.importLayerView=function(c){throw new C("importLayerView() not implemented");};f.hasLayerViewModule=function(c){return!1};f.validate=async function(){};f.invalidate=function(){this._isValid=!1};f.isSpatialReferenceSupported=function(c,a,g){return!0};f.isTileInfoRequired=function(){return!1};f.when=function(c,a){this.isResolved()&&!this.ready&&n.warn("#when()",
'Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use watchUtils.whenOnce(view, "ready").then(...) instead.');return q.prototype.when.call(this,c,a)};f.forceReadyCycle=function(){this.ready&&(this._readyCycleForced=!0,k.whenFalseOnce(this,"preconditionsReady",()=>this._readyCycleForced=!1))};f.createTool=function(c,a,g){return this.toolViewManager.createTool(c,a,g)};f.tryFatalErrorRecovery=function(){this.fatalError=null};f._resetInitialViewPropertiesFromContent=
function(){if(this.defaultsFromMap){var c=()=>this.defaultsFromMap&&this.defaultsFromMap.start();this.defaultsFromMap.reset();this._currentSpatialReference=null;this.notifyChange("spatialReference");this.handles.remove("defaultsFromMap");this.handles.add([k.watch(this,"spatialReference",(a,g)=>{F.equals(a,g)||c()}),k.watch(this,"initialExtentRequired",c),D.schedule(c)],"defaultsFromMap")}};h._createClass(p,[{key:"heightModelInfo",get:function(){return this.getDefaultHeightModelInfo()}},{key:"interacting",
get:function(){return this.navigating}},{key:"preconditionsReady",get:function(){return!!(!this.fatalError&&this._isValid&&!this._readyCycleForced&&this.map&&(!v.isLoadable(this.map)||this.map.loaded)&&0!==this.width&&0!==this.height&&this.spatialReference&&this.isSpatialReferenceSupported(this.spatialReference)&&(this._currentSpatialReference||!this.initialExtentRequired||this.initialExtent||this.defaultsFromMap&&this.defaultsFromMap.isSpatialReferenceDone)&&this.defaultsFromMap&&this.defaultsFromMap.isTileInfoDone)}},
{key:"map",set:function(c){var a;const g=this._get("map");c!==g&&(null!=(a=c)&&a.destroyed&&(n.warn("#map","The provided map is already destroyed",{map:c}),c=null),v.isLoadable(c)&&c.load().catch(()=>{}),this.initialized&&(this.forceReadyCycle(),this._resetInitialViewPropertiesFromContent()),this._set("map",c))}},{key:"spatialReference",get:function(){let c=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;c&&this.isHeightModelInfoRequired&&this.defaultsFromMap&&
(c=c.clone(),c.vcsWkid=this.defaultsFromMap.vcsWkid,c.latestVcsWkid=this.defaultsFromMap.latestVcsWkid);return c},set:function(c){this._userSpatialReference=c;this._set("spatialReference",c)}},{key:"stationary",get:function(){return!this.animation&&!this.navigating&&!this.resizing}},{key:"initialExtent",get:function(){return this.defaultsFromMap&&this.defaultsFromMap.extent}},{key:"cursor",get:function(){const c=this.toolViewManager?this.toolViewManager.cursor:null;return z.isSome(c)?c:this._cursor||
"default"},set:function(c){this._cursor=c;this.notifyChange("cursor")}},{key:"size",get:function(){return[this.width,this.height]}}]);return p}(N.HandleOwnerMixin(H.EventedMixin(I.EsriPromiseMixin(E))));b.views=new l;d.__decorate([r.aliasOf("toolViewManager.activeTool")],b.prototype,"activeTool",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"allLayerViews",void 0);d.__decorate([e.property()],b.prototype,"animation",void 0);d.__decorate([e.property()],b.prototype,"basemapView",void 0);
d.__decorate([e.property()],b.prototype,"defaultsFromMap",void 0);d.__decorate([e.property()],b.prototype,"fatalError",void 0);d.__decorate([e.property({type:u})],b.prototype,"extent",void 0);d.__decorate([e.property(w.graphicsCollectionProperty())],b.prototype,"graphics",void 0);d.__decorate([e.property({readOnly:!0,type:M,dependsOn:["map.heightModelInfo?","defaultsFromMap.heightModelInfo"],autoTracked:!1})],b.prototype,"heightModelInfo",null);d.__decorate([e.property({readOnly:!0,dependsOn:["navigating"]})],
b.prototype,"interacting",null);d.__decorate([e.property({readOnly:!0})],b.prototype,"navigating",void 0);d.__decorate([e.property({readOnly:!0,dependsOn:"fatalError _isValid _readyCycleForced map map.loaded? width height spatialReference _currentSpatialReference initialExtentRequired initialExtent defaultsFromMap.isSpatialReferenceDone defaultsFromMap.isTileInfoDone".split(" "),autoTracked:!1})],b.prototype,"preconditionsReady",null);d.__decorate([e.property({type:l,readOnly:!0})],b.prototype,"layerViews",
void 0);d.__decorate([e.property({type:x})],b.prototype,"magnifier",void 0);d.__decorate([e.property({value:null,type:K})],b.prototype,"map",null);d.__decorate([e.property()],b.prototype,"padding",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"ready",void 0);d.__decorate([e.property({type:G,dependsOn:["defaultsFromMap.spatialReference","defaultsFromMap.vcsWkid","defaultsFromMap.latestVcsWkid"]})],b.prototype,"spatialReference",null);d.__decorate([e.property()],b.prototype,"spatialReferenceWarningDelay",
void 0);d.__decorate([e.property({dependsOn:["animation","navigating","resizing"]})],b.prototype,"stationary",null);d.__decorate([e.property({readOnly:!0})],b.prototype,"supportsGround",void 0);d.__decorate([e.property({type:L})],b.prototype,"timeExtent",void 0);d.__decorate([r.aliasOf("toolViewManager.tools")],b.prototype,"tools",void 0);d.__decorate([e.property()],b.prototype,"toolViewManager",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"type",void 0);d.__decorate([e.property({type:Number})],
b.prototype,"scale",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"updating",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"initialExtentRequired",void 0);d.__decorate([e.property({readOnly:!0,type:u,dependsOn:["defaultsFromMap.extent"]})],b.prototype,"initialExtent",null);d.__decorate([e.property({dependsOn:["toolViewManager.cursor"]})],b.prototype,"cursor",null);d.__decorate([e.property()],b.prototype,"renderContext",void 0);d.__decorate([e.property({readOnly:!0})],
b.prototype,"input",void 0);d.__decorate([e.property({type:y,nonNullable:!0})],b.prototype,"navigation",void 0);d.__decorate([e.property()],b.prototype,"layerViewManager",void 0);d.__decorate([e.property()],b.prototype,"width",void 0);d.__decorate([e.property()],b.prototype,"height",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"resizing",void 0);d.__decorate([e.property({value:null,dependsOn:["width","height"],readOnly:!0})],b.prototype,"size",null);d.__decorate([e.property({readOnly:!0})],
b.prototype,"suspended",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"viewEvents",void 0);d.__decorate([e.property({readOnly:!0})],b.prototype,"persistableViewModels",void 0);d.__decorate([e.property()],b.prototype,"_isValid",void 0);d.__decorate([e.property()],b.prototype,"_readyCycleForced",void 0);d.__decorate([e.property()],b.prototype,"_currentSpatialReference",void 0);return b=m=d.__decorate([B.subclass("esri.views.View")],b)});
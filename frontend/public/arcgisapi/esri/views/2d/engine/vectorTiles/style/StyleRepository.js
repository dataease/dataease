// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["../../../../../core/has","./StyleLayer"],function(n,h){return function(){function k(a,b){this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;a.layers||(a.layers=[]);this.version=parseFloat(a.version);this.sprite=b?b.spriteUrl:a.sprite;this.glyphs=b?b.glyphsUrl:a.glyphs;if(this.layers=a.layers.map((d,f,e)=>this._create(d,f,e)))for(b=0;b<this.layers.length;b++)a=this.layers[b],this._layerByName[a.id.toLowerCase()]=a,this._uidToLayer.set(a.uid,a),0===
a.type&&this.backgroundBucketIds.push(a.id);this._identifyRefLayers()}var g=k.prototype;g.isPainterDataDriven=function(a){return(a=this._layerByName[a.toLowerCase()])?a.isPainterDataDriven():!1};g.getStyleLayerId=function(a){return a>=this.layers.length?null:this.layers[a].id};g.getStyleLayerByUID=function(a){a=this._uidToLayer.get(a);return null!=a?a:null};g.getStyleLayerIndex=function(a){return(a=this._layerByName[a.toLowerCase()])?this.layers.indexOf(a):-1};g.setStyleLayer=function(a,b){if(a&&
a.id){b&&b>=this.layers.length&&(b=this.layers.length-1);var d=!0,f;if(f=this._layerByName[a.id.toLowerCase()]){const e=this.layers.indexOf(f);b||(b=e);b===e?(d=!1,f=k._recreateLayer(a,f),this.layers[b]=f):(this.layers.splice(e,1),f=this._create(a,b,this.layers),this.layers.splice(b,0,f))}else f=this._create(a,b,this.layers),!b||b>=this.layers.length?this.layers.push(f):this.layers.splice(b,0,f);this._layerByName[a.id.toLowerCase()]=f;this._uidToLayer.set(f.uid,f);d&&this._recomputeZValues();this._identifyRefLayers()}};
g.getStyleLayer=function(a){return(a=this._layerByName[a.toLowerCase()])?{type:a.typeName,id:a.id,source:a.source,"source-layer":a.sourceLayer,minzoom:a.minzoom,maxzoom:a.maxzoom,filter:a.filter,layout:a.layout,paint:a.paint}:null};g.deleteStyleLayer=function(a){const b=this._layerByName[a.toLowerCase()];b&&(delete this._layerByName[a.toLowerCase()],this._uidToLayer.delete(b.uid),a=this.layers.indexOf(b),this.layers.splice(a,1),this._recomputeZValues(),this._identifyRefLayers())};g.getLayerById=function(a){return this._layerByName[a.toLowerCase()]};
g.getLayoutProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?a.layout:null};g.getPaintProperties=function(a){return(a=this._layerByName[a.toLowerCase()])?a.paint:null};g.setPaintProperties=function(a,b){a=this._layerByName[a.toLowerCase()];if(!a)return"";b=k._recreateLayer({type:a.typeName,id:a.id,source:a.source,"source-layer":a.sourceLayer,minzoom:a.minzoom,maxzoom:a.maxzoom,filter:a.filter,layout:a.layout,paint:b},a);const d=this.layers.indexOf(a);this.layers[d]=b;this._layerByName[a.id.toLowerCase()]=
b;this._uidToLayer.set(a.uid,b);return a.id};g.setLayoutProperties=function(a,b){a=this._layerByName[a.toLowerCase()];if(!a)return"";b=k._recreateLayer({type:a.typeName,id:a.id,source:a.source,"source-layer":a.sourceLayer,minzoom:a.minzoom,maxzoom:a.maxzoom,filter:a.filter,layout:b,paint:a.paint},a);const d=this.layers.indexOf(a);this.layers[d]=b;this._layerByName[a.id.toLowerCase()]=b;this._uidToLayer.set(a.uid,b);return a.id};g.setStyleLayerVisibility=function(a,b){if(a=this._layerByName[a.toLowerCase()]){var d=
a.layout||{};d.visibility=b;b=k._recreateLayer({type:a.typeName,id:a.id,source:a.source,"source-layer":a.sourceLayer,minzoom:a.minzoom,maxzoom:a.maxzoom,filter:a.filter,layout:d,paint:a.paint},a);d=this.layers.indexOf(a);this.layers[d]=b;this._layerByName[a.id.toLowerCase()]=b;this._uidToLayer.set(a.uid,b)}};g.getStyleLayerVisibility=function(a){var b;a=this._layerByName[a.toLowerCase()];if(!a)return"none";a=a.layout;return null!=(b=null==a?void 0:a.visibility)?b:"visible"};g._recomputeZValues=function(){const a=
this.layers,b=1/(a.length+1);for(let d=0;d<a.length;d++)a[d].z=1-(1+d)*b};g._identifyRefLayers=function(){const a=[],b=[];let d=0;for(const c of this.layers){if(1===c.type){var f=c,e=c.source+"|"+c.sourceLayer;e+="|"+JSON.stringify(c.layout&&c.layout.visibility);e+="|"+JSON.stringify(c.minzoom);e+="|"+JSON.stringify(c.maxzoom);e+="|"+JSON.stringify(c.filter);if(f.hasDataDrivenFill||f.hasDataDrivenOutline)e+="|"+JSON.stringify(d);a.push({key:e,layer:c})}2===c.type&&(f=c,e=c.source+"|"+c.sourceLayer,
e+="|"+JSON.stringify(c.layout&&c.layout.visibility),e+="|"+JSON.stringify(c.minzoom),e+="|"+JSON.stringify(c.maxzoom),e+="|"+JSON.stringify(c.filter),e+="|"+JSON.stringify(c.layout&&c.layout["line-cap"]),e+="|"+JSON.stringify(c.layout&&c.layout["line-join"]),f.hasDataDrivenLine&&(e+="|"+JSON.stringify(d)),b.push({key:e,layer:c}));++d}this._assignRefLayers(a);this._assignRefLayers(b)};g._assignRefLayers=function(a){a.sort((e,c)=>e.key<c.key?-1:e.key>c.key?1:0);let b,d;const f=a.length;for(let e=0;e<
f;e++){const c=a[e];if(c.key===b)c.layer.refLayerId=d;else if(b=c.key,d=c.layer.id,1===c.layer.type&&!c.layer.getPaintProperty("fill-outline-color"))for(let l=e+1;l<f;l++){const m=a[l];if(m.key===b){if(m.layer.getPaintProperty("fill-outline-color")){a[e]=m;a[l]=c;d=m.layer.id;break}}else break}}};g._create=function(a,b,d){b=1-1/(d.length+1)*(1+b);d=this._runningId++;switch(a.type){case "background":return new h.BackgroundStyleLayer(0,a,b,d);case "fill":return new h.FillStyleLayer(1,a,b,d);case "line":return new h.LineStyleLayer(2,
a,b,d);case "symbol":return new h.SymbolStyleLayer(3,a,b,d);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new h.CircleStyleLayer(4,a,b,d)}throw Error("Unknown vector tile layer");};k._recreateLayer=function(a,b){switch(a.type){case "background":return new h.BackgroundStyleLayer(0,a,b.z,b.uid);case "fill":return new h.FillStyleLayer(1,a,b.z,b.uid);case "line":return new h.LineStyleLayer(2,a,b.z,b.uid);case "symbol":return new h.SymbolStyleLayer(3,a,b.z,b.uid);
case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new h.CircleStyleLayer(4,a,b.z,b.uid)}};return k}()});
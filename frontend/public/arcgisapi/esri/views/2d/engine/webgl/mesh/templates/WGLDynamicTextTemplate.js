// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/screenUtils ../../alignmentUtils ../../materialKey/MaterialKey ../../color ./util ./WGLBaseTextTemplate ./WGLDynamicMeshTemplate ../../../../layers/features/textUtils".split(" "),function(u,h,q,v,n,c,w,x,y){return function(r){function m(a){var b=r.call(this,a)||this;b._horizontalAlignment="center";b._verticalAlignment="middle";b._textToGlyphs=new Map;var d=a.scaleFactor||1;b._cimTextLayer=a;c.isFunction(a.color)?b._dynamicPropertyMap.set("_color",
(e,f,g)=>n.premultiplyAlphaRGBA(a.color(e,f,g))):b._color=n.premultiplyAlphaRGBA(a.color);c.isFunction(a.color)?b._dynamicPropertyMap.set("_haloColor",(e,f,g)=>n.premultiplyAlphaRGBA(a.outlineColor(e,f,g))):b._haloColor=n.premultiplyAlphaRGBA(a.outlineColor);let l;c.isFunction(a.size)||(l=Math.min(Math.round(h.pt2px(a.size*a.sizeRatio)),127));b._dynamicPropertyMap.set("_size",(e,f,g)=>c.isFunction(a.size)?Math.min(Math.round(h.pt2px(a.size(e,f,g)*a.sizeRatio)),127):l);c.isFunction(a.outlineSize)?
b._dynamicPropertyMap.set("_haloSize",(e,f,g)=>Math.min(Math.floor(5*h.pt2px(a.outlineSize(e,f,g)*a.sizeRatio)),127)):b._haloSize=Math.min(Math.floor(5*h.pt2px(a.outlineSize*a.sizeRatio)),127);let k;c.isFunction(a.offsetX)||(k=Math.round(h.pt2px(a.offsetX*a.sizeRatio)));b._dynamicPropertyMap.set("_xOffset",(e,f,g)=>c.isFunction(a.offsetX)?Math.round(h.pt2px(a.offsetX(e,f,g)*a.sizeRatio)):k);let p;c.isFunction(a.offsetY)||(p=Math.round(h.pt2px(a.offsetY*a.sizeRatio)));b._dynamicPropertyMap.set("_yOffset",
(e,f,g)=>c.isFunction(a.offsetY)?Math.round(h.pt2px(a.offsetY(e,f,g)*a.sizeRatio)):p);c.isFunction(a.angle)?b._dynamicPropertyMap.set("_angle",a.angle):b._angle=a.angle;c.isFunction(a.horizontalAlignment)?b._dynamicPropertyMap.set("_horizontalAlignment",a.horizontalAlignment):b._horizontalAlignment=a.horizontalAlignment;c.isFunction(a.verticalAlignment)?b._dynamicPropertyMap.set("_verticalAlignment",a.verticalAlignment):b._verticalAlignment=a.verticalAlignment;b._scaleFactor=d;c.isFunction(a.text)?
b._dynamicPropertyMap.set("_text",a.text):b._text=a.text;d=Math.min(Math.round(h.pt2px(a.referenceSize*a.sizeRatio)),127);b._referenceSize=Math.round(Math.sqrt(256*d));b._materialKey=a.materialKey;d=v.TextMaterialKey.load(b._materialKey);d.sdf=!0;b._bitset=(1===a.alignment?1:0)|(a.colorLocked?1:0)<<1;b._materialKey=d.data;b._decoration="none";b._lineHeight=1;b._lineWidth=512;b._textPlacement=a.markerPlacement;b.effects=a.effects;b._isCIM=!0;return b}u._inheritsLoose(m,r);m.fromCIMText=function(a){return new m(a)};
var t=m.prototype;t.analyze=async function(a,b,d,l){b=b.readLegacyFeature();var k=this._cimTextLayer;d="string"===typeof k.text?k.text:"function"===typeof k.text?k.text(b,d,l):"";a=await a.getMosaicItem(this._cimTextLayer.cim,y.codepoints(d));this._textToGlyphs.set(d,a.glyphMosaicItems);return a};t.bindFeature=function(a,b,d){const l=a.readLegacyFeature();this._dynamicPropertyMap.forEach((k,p)=>{this[p]=k(l,b,d)});this._text&&0!==this._text.length?(this._size*=this._scaleFactor,this._scale=this._size/
24,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=q.getXAnchorDirection(this._horizontalAlignment||"center"),this._yAlignD=q.getYAnchorDirection(this._verticalAlignment||"baseline"),a=this._textToGlyphs.get(this._text),this.bindTextInfo(a,!1)):this._shapingInfo=null};return m}(w(x))});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["../../../../../../chunks/_rollupPluginBabelHelpers","../../../../../webgl/rasterUtils","../../VertexStream","../WGLBrush"],function(n,d,p,q){return function(m){function k(){var a=m.apply(this,arguments)||this;a._desc={lut:{vsPath:"raster/lut",fsPath:"raster/lut",attributes:{a_position:0,a_texcoord:1}},stretch:{vsPath:"raster/stretch",fsPath:"raster/stretch",attributes:{a_position:0,a_texcoord:1}},hillshade:{vsPath:"raster/hillshade",fsPath:"raster/hillshade",attributes:{a_position:0,a_texcoord:1}}};
a._rendererUniformInfos=new Map;return a}n._inheritsLoose(k,m);var f=k.prototype;f.dispose=function(){this._quad&&this._quad.dispose()};f.prepareState=function({context:a},c){a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(1,771,1,771);a.setColorMask(!0,!0,!0,!0);a.setStencilWriteMask(0);a.setStencilTestEnabled(!0);a.setStencilFunction(514,c.stencilRef,255)};f.draw=function(a,c){var b;if(c.source&&!c.suspended){a.timeline.begin(this.name);var g=!(null!=(b=a.context.capabilities.textureFloat)&&
b.textureFloatLinear);c.updateTexture(a);b=this.getShaderVariations(c,g);b=a.painter.materialManager.getProgram(a,this._desc[c.symbolizerParameters.type],b);this.drawWithProgram(a.context,b,c);a.timeline.end(this.name)}};f.drawWithProgram=function(a,c,b,g=1,r=[0,0],l=!1){this._quad||(this._quad=new p(a,[0,0,1,0,0,1,1,1]));const {symbolizerParameters:e,transformGrid:t,width:u,height:v,opacity:w}=b;var h=e.type;a.bindProgram(c);const x=this.getShaderVariations(b);h=this.getUniformInfos(h,a,c,x);const {names:y,
textures:z}=b.getTextures();d.setTextures(a,c,y,z);a=d.getBasicGridUniforms(g,r);l=d.getCommonUniforms(t,[u,v],[b.source.width,b.source.height],w,l);d.setUniforms(c,h,{u_coordScale:b.coordScale,u_dvsMat3:b.transforms.dvs,...a,...l});if(e.colormap){const {colormap:A,colormapOffset:B}=e;b=d.getColormapUniforms(A,B);d.setUniforms(c,h,b)}"stretch"===e.type?(b=d.getStretchUniforms(e),d.setUniforms(c,h,b)):"hillshade"===e.type&&(b=d.getShadedReliefUniforms(e),d.setUniforms(c,h,b));this._quad.draw()};f.getUniformInfos=
function(a,c,b,g){a=0<g.length?a+"-"+g.join("-"):a;if(this._rendererUniformInfos.has(a))return this._rendererUniformInfos.get(a);c=d.getUniformLocationInfos(c,b);this._rendererUniformInfos.set(a,c);return c};f.getShaderVariations=function(a,c=!1){const b=[];"cubic"===a.interpolation?b.push("bicubic"):c&&"bilinear"===a.interpolation&&b.push("bilinear");a.isRendereredSource?b.push("noop"):a.symbolizerParameters.colormap&&b.push("applyColormap");a.transformGrid&&b.push("applyProjection");return b};return k}(q)});
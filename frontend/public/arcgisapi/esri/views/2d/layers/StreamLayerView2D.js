// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../tasks/support/FeatureSet ./support/util ./FeatureLayerView2D".split(" "),function(n,k,h,l,
y,z,m,A,r,p,B,C,D,t,u,v){function q(d,f){if(l.isNone(d)&&l.isNone(f))return null;const b={};l.isSome(f)&&(b.geometry=f.toJSON());l.isSome(d)&&(b.where=d);return b}h=function(d){function f(){var a=d.apply(this,arguments)||this;a._enabledDataReceived=!1;a.errorString=null;a.connectionStatus="disconnected";return a}n._inheritsLoose(f,d);var b=f.prototype;b.initialize=function(){this.handles.add([this.layer.watch("purgeOptions",()=>this._update())])};b.destroy=function(){this.connectionStatus="disconnected"};
b.on=function(a,e){"data-received"===a&&(this._enabledDataReceived=!0,this._proxy.enableEvent("data-received",!0));const c=d.prototype.on.call(this,a,e),g=this;return{remove(){c.remove();"data-received"===a&&(g._proxy.closed||g.hasEventListener("data-received")||g._proxy.enableEvent("data-received",!1))}}};b.queryLatestObservations=function(a,e){if(!this.layer.timeInfo.endField&&!this.layer.timeInfo.startField)throw new p("streamlayer-no-timeField","queryLatestObservation can only be used with services that define a TrackIdField");
return this._proxy.queryLatestObservations(this._cleanUpQuery(a),e).then(c=>{c=t.fromJSON(c);c.features.forEach(g=>{g.layer=this.layer;g.sourceLayer=this.layer});return c})};b._createClientOptions=function(){return{...d.prototype._createClientOptions.call(this),setProperty:a=>{this.set(a.propertyName,a.value)}}};b._createTileRendererHash=function(a){var e=JSON.stringify(this.layer.purgeOptions);const c=JSON.stringify(q(this.layer.definitionExpression,this.layer.geometryDefinition));e=`${e}.${c})`;
return d.prototype._createTileRendererHash.call(this,a)+e};b._createServiceOptions=async function(){var a=this.layer;const {objectIdField:e}=a,c=a.fields.map(w=>w.toJSON()),g=u.toJSONGeometryType(a.geometryType),x=a.timeInfo&&a.timeInfo.toJSON()||null;a=a.spatialReference?a.spatialReference.toJSON():null;return{type:"stream",fields:c,geometryType:g,objectIdField:e,timeInfo:x,source:this.layer.parsedUrl,serviceFilter:q(this.layer.definitionExpression,this.layer.geometryDefinition),purgeOptions:this.layer.purgeOptions.toJSON(),
enableDataReceived:this._enabledDataReceived,spatialReference:a,maxReconnectionAttempts:this.layer.maxReconnectionAttempts,maxReconnectionInterval:this.layer.maxReconnectionInterval,updateInterval:this.layer.updateInterval}};n._createClass(f,[{key:"connectionError",get:function(){if(this.errorString)return new p("stream-controller",this.errorString)}}]);return f}(v);k.__decorate([m.property()],h.prototype,"errorString",void 0);k.__decorate([m.property({dependsOn:["errorString"],readOnly:!0})],h.prototype,
"connectionError",null);k.__decorate([m.property()],h.prototype,"connectionStatus",void 0);return h=k.__decorate([r.subclass("esri.views.2d.layers.StreamLayerView2D")],h)});
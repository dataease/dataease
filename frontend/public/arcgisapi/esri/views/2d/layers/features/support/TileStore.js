// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/has ../../../../../core/Evented ../../../tiling/TileKey ../../../tiling/TileCoverage ../../../../../chunks/rbush ./Tile".split(" "),function(t,u,v,w,x,y,q){const h={added:[],removed:[]},n=new Set,z=new w(0,0,0,0);return function(r){function p(a){var c=r.call(this)||this;c._tiles=new Map;c._index=y.rbush(9,u("csp-restrictions")?b=>({minX:b.bounds[0],minY:b.bounds[1],maxX:b.bounds[2],maxY:b.bounds[3]}):[".bounds[0]",".bounds[1]",
".bounds[2]",".bounds[3]"]);c.tiles=[];c.tileScheme=a;return c}t._inheritsLoose(p,r);var g=p.prototype;g.destroy=function(){this.clear()};g.clear=function(){this.tiles.length=0;this._tiles.clear();this._index.clear()};g.has=function(a){return this._tiles.has(a)};g.get=function(a){return this._tiles.get(a)};g.findByKey=function(a){return this._tiles.get(a.id)};g.intersections=function(a,c){var b="string"===typeof a?this.get(a):a;if(!b)return[];var d=c*b.resolution;c=b.bounds[0]-d;a=b.bounds[1]-d;const f=
b.bounds[2]+d;b=b.bounds[3]+d;d=[];for(const k of this._index.search({minX:c,minY:a,maxX:f,maxY:b})){const e=k.bounds.slice();e[0]=Math.max(e[0],c);e[1]=Math.max(e[1],a);e[2]=Math.min(e[2],f);e[3]=Math.min(e[3],b);0<e[2]-e[0]&&0<e[3]-e[1]&&d.push({bounds:e,tile:k})}return d};g.boundsIntersections=function(a){return this._index.search({minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]})};g.updateTiles=function(a){const c={added:[],removed:[]};for(const b of a.added)if(!this.has(b)){const d=new q.Tile(this.tileScheme,
b);this._tiles.set(b,d);this._index.insert(d);c.added.push(d)}for(const b of a.removed)this.has(b)&&(a=this.get(b),this._tiles.delete(b),this._index.remove(a),c.removed.push(a));this.tiles.length=0;this._tiles.forEach(b=>this.tiles.push(b));(c.added.length||c.removed.length)&&this.emit("update",c)};g.setViewState=function(a){if(a=this.tileScheme.getTileCoverage(a,0)){var {spans:c,lodInfo:b}=a,{level:d}=b;if(0<c.length)for(const {row:k,colFrom:e,colTo:A}of c)for(var f=e;f<=A;f++){const l=z.set(d,k,
b.normalizeCol(f),b.getWorldForColumn(f)).id;n.add(l);if(!this.has(l)){const m=new q.Tile(this.tileScheme,l);this._tiles.set(l,m);this._index.insert(m);this.tiles.push(m);h.added.push(m)}}for(d=this.tiles.length-1;0<=d;d--)f=this.tiles[d],n.has(f.id)||(this._tiles.delete(f.id),this.tiles.splice(d,1),this._index.remove(f),h.removed.push(f));(h.added.length||h.removed.length)&&this.emit("update",h);x.pool.release(a);n.clear();h.added.length=0;h.removed.length=0}};return p}(v)});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/aaBoundingRect":function(){define(["exports","../../core/has","../Extent"],function(b,k,a){function r(n=p){return[n[0],n[1],n[2],n[3]]}function l(n){return n[0]>=n[2]?0:n[2]-n[0]}function h(n){return n[1]>=n[3]?0:n[3]-n[1]}function d(n,w,q){return w>=n[0]&&q>=n[1]&&w<=n[2]&&q<=n[3]}function c(n,w){n[0]=w[0];n[1]=w[1];n[2]=w[2];n[3]=w[3];return n}function e(n){return 4===n.length}function f(n,w,q){return n<w?w:n>q?q:n}const g=[Infinity,Infinity,-Infinity,-Infinity],
p=[0,0,0,0];b.NEGATIVE_INFINITY=g;b.POSITIVE_INFINITY=[-Infinity,-Infinity,Infinity,Infinity];b.UNIT=[0,0,1,1];b.ZERO=p;b.allFinite=function(n){for(let w=0;4>w;w++)if(!isFinite(n[w]))return!1;return!0};b.area=function(n){return l(n)*h(n)};b.center=function(n,w=[0,0]){w[0]=(n[0]+n[2])/2;w[1]=(n[1]+n[3])/2;return w};b.clone=function(n){return[n[0],n[1],n[2],n[3]]};b.contains=function(n,w){return w[0]>=n[0]&&w[2]<=n[2]&&w[1]>=n[1]&&w[3]<=n[3]};b.containsPoint=function(n,w){return d(n,w[0],w[1])};b.containsPointObject=
function(n,w){return d(n,w.x,w.y)};b.containsPointWithMargin=function(n,w,q){return w[0]>=n[0]-q&&w[1]>=n[1]-q&&w[0]<=n[2]+q&&w[1]<=n[3]+q};b.containsXY=d;b.create=r;b.diameter=function(n){const w=l(n);n=h(n);return Math.sqrt(w*w+n*n)};b.distance=function(n,w){const q=(n[1]+n[3])/2,m=Math.max(Math.abs(w[0]-(n[0]+n[2])/2)-l(n)/2,0);n=Math.max(Math.abs(w[1]-q)-h(n)/2,0);return Math.sqrt(m*m+n*n)};b.empty=function(n){return n?c(n,g):r(g)};b.equals=function(n,w,q){if(null==n||null==w)return n===w;if(!e(n)||
!e(w))return!1;if(q)for(let m=0;m<n.length;m++){if(!q(n[m],w[m]))return!1}else for(q=0;q<n.length;q++)if(n[q]!==w[q])return!1;return!0};b.expand=function(n,w,q=n){if("length"in w)if(e(w))q[0]=Math.min(n[0],w[0]),q[1]=Math.min(n[1],w[1]),q[2]=Math.max(n[2],w[2]),q[3]=Math.max(n[3],w[3]);else{if(2===w.length||3===w.length)q[0]=Math.min(n[0],w[0]),q[1]=Math.min(n[1],w[1]),q[2]=Math.max(n[2],w[0]),q[3]=Math.max(n[3],w[1])}else switch(w.type){case "extent":q[0]=Math.min(n[0],w.xmin);q[1]=Math.min(n[1],
w.ymin);q[2]=Math.max(n[2],w.xmax);q[3]=Math.max(n[3],w.ymax);break;case "point":q[0]=Math.min(n[0],w.x),q[1]=Math.min(n[1],w.y),q[2]=Math.max(n[2],w.x),q[3]=Math.max(n[3],w.y)}return q};b.expandPointInPlace=function(n,w){w[0]<n[0]&&(n[0]=w[0]);w[0]>n[2]&&(n[2]=w[0]);w[1]<n[1]&&(n[1]=w[1]);w[1]>n[3]&&(n[3]=w[1])};b.expandWithNestedArray=function(n,w,q=n){const m=w.length;let u=n[0],v=n[1],y=n[2];n=n[3];for(let B=0;B<m;B++){const x=w[B];u=Math.min(u,x[0]);v=Math.min(v,x[1]);y=Math.max(y,x[0]);n=Math.max(n,
x[1])}q[0]=u;q[1]=v;q[2]=y;q[3]=n;return q};b.fromExtent=function(n,w=r()){w[0]=n.xmin;w[1]=n.ymin;w[2]=n.xmax;w[3]=n.ymax;return w};b.fromValues=function(n,w,q,m,u=r()){u[0]=n;u[1]=w;u[2]=q;u[3]=m;return u};b.height=h;b.intersection=function(n,w,q=n){const m=w[0],u=w[1],v=w[2];w=w[3];q[0]=f(n[0],m,v);q[1]=f(n[1],u,w);q[2]=f(n[2],m,v);q[3]=f(n[3],u,w);return q};b.intersects=function(n,w){return Math.max(w[0],n[0])<=Math.min(w[2],n[2])&&Math.max(w[1],n[1])<=Math.min(w[3],n[3])};b.is=e;b.isPoint=function(n){return(0===
l(n)||!isFinite(n[0]))&&(0===h(n)||!isFinite(n[1]))};b.offset=function(n,w,q,m=n){m[0]=n[0]+w;m[1]=n[1]+q;m[2]=n[2]+w;m[3]=n[3]+q;return m};b.pad=function(n,w,q=n){q[0]=n[0]-w;q[1]=n[1]-w;q[2]=n[2]+w;q[3]=n[3]+w;return q};b.set=c;b.setMax=function(n,w,q=n){q[2]=w[0];q[3]=w[1];q!==n&&(q[0]=n[0],q[1]=n[1]);return n};b.setMin=function(n,w,q=n){q[0]=w[0];q[1]=w[1];q!==n&&(q[2]=n[2],q[3]=n[3]);return q};b.size=function(n,w){w[0]=n[2]-n[0];w[1]=n[3]-n[1]};b.toExtent=function(n,w){return new a({xmin:n[0],
ymin:n[1],xmax:n[2],ymax:n[3],spatialReference:w})};b.width=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/geometry/projection":function(){define("require exports ../chunks/_rollupPluginBabelHelpers ../core/maybe ../core/Error ../core/promiseUtils ./support/spatialReferenceUtils ./support/Ellipsoid ./Point ./Extent ./Multipoint ./Polygon ./Polyline ../core/mathUtils ../chunks/vec3f64 ../chunks/vec3 ./projectionEllipsoid ../core/unitUtils ../chunks/mat4 ../chunks/pe ./support/aaBoundingRect ./support/geodesicConstants ./support/GeographicTransformation".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){function A(){return!!Fa&&B.isLoaded()}function t(xa){r.isNone(Sa)&&(Sa=h.all([B.load(),(new Promise(function(wa,ma){b(["../chunks/geometryEngineBase"],wa,ma)})).then(function(wa){return wa.geometryEngineBase}),new Promise(function(wa,ma){b(["./geometryAdapters/hydrated"],wa,ma)})]));return Sa.then(([,wa,{hydratedAdapter:ma}])=>{h.throwIfAborted(xa);La=ma;Fa=wa.default;Fa._enableProjection(B.pe)})}function D(xa,wa,ma,ta,Da=null){if(r.isNone(ma)||
r.isNone(ta))return wa;if(G(ma,ta,Da))return wa.map(Oa=>H(Oa,ma,ta));if(r.isNone(Da)){const Oa=z.cacheKey(ma,ta);void 0!==Ia[Oa]?Da=Ia[Oa]:(Da=E(ma,ta,null),r.isNone(Da)&&(Da=new z),Ia[Oa]=Da)}if(r.isNone(Fa))throw new Qa;return Fa._project(xa,wa,ma,ta,Da)}function E(xa,wa,ma=null){if(r.isNone(Fa))throw new Qa;if(r.isNone(xa)||r.isNone(wa))return null;xa=Fa._getTransformation(La,xa,wa,ma,null==ma?void 0:ma.spatialReference);return null!==xa?z.fromGE(xa):null}function G(xa,wa,ma){return ma?!1:d.equals(xa,
wa)?!0:d.isValid(xa)&&d.isValid(wa)&&!!oa(xa,wa,Ra)}function H(xa,wa,ma){if(!xa)return xa;if("x"in xa){var ta=new e;return I(xa,wa,ta,ma)?ta:null}return"xmin"in xa?(ta=new f,S(xa,wa,ta,ma)?ta:null):"rings"in xa?(ta=new p,L(xa,wa,ta,ma)?ta:null):"paths"in xa?(ta=new n,K(xa,wa,ta,ma)?ta:null):"points"in xa?(ta=new g,J(xa,wa,ta,ma)?ta:null):null}function I(xa,wa,ma,ta,Da=0){Ea[0]=xa.x;Ea[1]=xa.y;const Oa=xa.z;Ea[2]=void 0!==Oa?Oa:Da;if(!Q(Ea,wa,0,Ea,ta,0,1))return!1;ma.x=Ea[0];ma.y=Ea[1];ma.spatialReference=
ta;void 0===Oa?(ma.z=void 0,ma.hasZ=!1):(ma.z=Ea[2],ma.hasZ=!0);void 0===xa.m?(ma.m=void 0,ma.hasM=!1):(ma.m=xa.m,ma.hasM=!0);return!0}function J(xa,wa,ma,ta,Da=0){const {points:Oa,hasZ:Ja,hasM:ra}=xa;xa=[];const Ca=Oa.length,Ma=[];for(var Ta of Oa)Ma.push(Ta[0],Ta[1],Ja?Ta[2]:Da);if(!Q(Ma,wa,0,Ma,ta,0,Ca))return!1;for(wa=0;wa<Ca;++wa){Da=3*wa;Ta=Ma[Da];const Xa=Ma[Da+1];Ja&&ra?xa.push([Ta,Xa,Ma[Da+2],Oa[wa][3]]):Ja?xa.push([Ta,Xa,Ma[Da+2]]):ra?xa.push([Ta,Xa,Oa[wa][2]]):xa.push([Ta,Xa])}ma.points=
xa;ma.spatialReference=ta;ma.hasZ=Ja;ma.hasM=ra;return!0}function K(xa,wa,ma,ta,Da=0){const {paths:Oa,hasZ:Ja,hasM:ra}=xa;xa=[];if(!F(Oa,Ja,ra,wa,xa,ta,Da))return!1;ma.paths=xa;ma.spatialReference=ta;ma.hasZ=Ja;ma.hasM=ra;return!0}function L(xa,wa,ma,ta,Da=0){const {rings:Oa,hasZ:Ja,hasM:ra}=xa;xa=[];if(!F(Oa,Ja,ra,wa,xa,ta,Da))return!1;ma.rings=xa;ma.spatialReference=ta;ma.hasZ=Ja;ma.hasM=ra;return!0}function S(xa,wa,ma,ta,Da=0){const {xmin:Oa,ymin:Ja,xmax:ra,ymax:Ca,hasZ:Ma,hasM:Ta}=xa;if(!M(Oa,
Ja,Ma?xa.zmin:Da,wa,Ea,ta))return!1;ma.xmin=Ea[0];ma.ymin=Ea[1];Ma&&(ma.zmin=Ea[2]);if(!M(ra,Ca,Ma?xa.zmax:Da,wa,Ea,ta))return!1;ma.xmax=Ea[0];ma.ymax=Ea[1];Ma&&(ma.zmax=Ea[2]);Ta&&(ma.mmin=xa.mmin,ma.mmax=xa.mmax);ma.spatialReference=ta;return!0}function M(xa,wa,ma,ta,Da,Oa){Wa[0]=xa;Wa[1]=wa;Wa[2]=ma;return Q(Wa,ta,0,Da,Oa,0,1)}function T(xa,wa,ma,ta){if(r.isNone(wa)||r.isNone(ta)||2>xa.length)return!1;2===xa.length&&(Wa[0]=xa[0],Wa[1]=xa[1],Wa[2]=0,xa=Wa);return Q(xa,wa,0,ma,ta,0,1)}function O(xa,
wa,ma){r.isNone(wa)?xa=!1:(wa=P(wa,sa),wa=Pa[wa][6],r.isNone(wa)?xa=!1:(wa(xa,0,Wa,0),ma!==Wa&&(ma[0]=Wa[0],ma[1]=Wa[1],2<ma.length&&(ma[2]=Wa[2])),xa=!0));return xa}function Q(xa,wa,ma,ta,Da,Oa,Ja=1){wa=oa(wa,Da,Ra);if(r.isNone(wa))return!1;if(wa===U){if(xa===ta&&ma===Oa)return!0;Ja=ma+3*Ja;for(let ra=ma,Ca=Oa;ra<Ja;ra++,Ca++)ta[Ca]=xa[ra];return!0}Ja=ma+3*Ja;for(let ra=ma,Ca=Oa;ra<Ja;ra+=3,Ca+=3)wa(xa,ra,ta,Ca);return!0}function F(xa,wa,ma,ta,Da,Oa,Ja=0){const ra=[];for(const Ca of xa)for(const Ma of Ca)ra.push(Ma[0],
Ma[1],wa?Ma[2]:Ja);if(!Q(ra,ta,0,ra,Oa,0,ra.length/3))return!1;ta=0;Da.length=0;for(const Ca of xa){xa=[];for(const Ma of Ca)wa&&ma?xa.push([ra[ta++],ra[ta++],ra[ta++],Ma[3]]):wa?xa.push([ra[ta++],ra[ta++],ra[ta++]]):(ma?xa.push([ra[ta++],ra[ta++],Ma[2]]):xa.push([ra[ta++],ra[ta++]]),ta++);Da.push(xa)}return!0}function N(xa,wa,ma){const ta=Math.sin(wa);wa=Math.cos(wa);const Da=Math.sin(xa);xa=Math.cos(xa);ma[0]=-ta;ma[4]=-Da*wa;ma[8]=xa*wa;ma[12]=0;ma[1]=wa;ma[5]=-Da*ta;ma[9]=xa*ta;ma[13]=0;ma[2]=
0;ma[6]=xa;ma[10]=Da;ma[14]=0;ma[3]=0;ma[7]=0;ma[11]=0;ma[15]=1;return ma}function P(xa,wa){if(wa.spatialReference===xa)return wa.spatialReferenceId;wa.spatialReference=xa;"metersPerUnit"in wa&&(wa.metersPerUnit=v.getMetersPerUnitForSR(xa,1));return xa.wkt===u.SphericalECEFSpatialReference.wkt?wa.spatialReferenceId=1:d.isWGS84(xa)?wa.spatialReferenceId=2:d.isWebMercator(xa)?wa.spatialReferenceId=3:xa.wkt===u.WGS84ECEFSpatialReference.wkt?wa.spatialReferenceId=4:4490===xa.wkid?wa.spatialReferenceId=
5:xa.wkt===u.SphericalPCPFMars.wkt?wa.spatialReferenceId=7:xa.wkt===u.SphericalPCPFMoon.wkt?wa.spatialReferenceId=9:d.isMars(xa)?wa.spatialReferenceId=8:d.isMoon(xa)?wa.spatialReferenceId=10:wa.spatialReferenceId=0}function U(xa,wa,ma,ta){xa!==ma&&(ma[ta++]=xa[wa++],ma[ta++]=xa[wa++],ma[ta]=xa[wa])}function V(xa,wa,ma,ta){ma[ta++]=Ya*(xa[wa++]/c.earth.radius);ma[ta++]=Ya*(Math.PI/2-2*Math.atan(Math.exp(-1*xa[wa++]/c.earth.radius)));ma[ta]=xa[wa]}function W(xa,wa,ma,ta){V(xa,wa,ma,ta);da(ma,ta,ma,
ta)}function X(xa,wa,ma,ta){V(xa,wa,ma,ta);ja(ma,ta,ma,ta)}function ca(xa,wa,ma,ta){var Da=.4999999*Math.PI;Da=w.clamp(ha*xa[wa+1],-Da,Da);Da=Math.sin(Da);ma[ta++]=ha*xa[wa]*c.earth.radius;ma[ta++]=c.earth.halfSemiMajorAxis*Math.log((1+Da)/(1-Da));ma[ta]=xa[wa+2]}function R(xa,wa,ma,ta,Da){Da+=xa[wa+2];const Oa=ha*xa[wa+1];xa=ha*xa[wa];wa=Math.cos(Oa);ma[ta++]=Math.cos(xa)*wa*Da;ma[ta++]=Math.sin(xa)*wa*Da;ma[ta]=Math.sin(Oa)*Da}function aa(xa,wa,ma,ta){R(xa,wa,ma,ta,c.moon.radius)}function ka(xa,
wa,ma,ta){R(xa,wa,ma,ta,c.mars.radius)}function da(xa,wa,ma,ta){R(xa,wa,ma,ta,c.earth.radius)}function fa(xa,wa,ma,ta,Da){var Oa=xa[wa];const Ja=xa[wa+1];wa=xa[wa+2];xa=Math.sqrt(Oa*Oa+Ja*Ja+wa*wa);wa=w.asinClamped(wa/(0===xa?1:xa));Oa=Math.atan2(Ja,Oa);ma[ta++]=Ya*Oa;ma[ta++]=Ya*wa;ma[ta]=xa-Da}function ea(xa,wa,ma,ta){fa(xa,wa,ma,ta,c.moon.radius)}function Y(xa,wa,ma,ta){fa(xa,wa,ma,ta,c.mars.radius)}function Z(xa,wa,ma,ta){fa(xa,wa,ma,ta,c.earth.radius)}function ba(xa,wa,ma,ta){Z(xa,wa,ma,ta);
ca(ma,ta,ma,ta)}function ia(xa,wa,ma,ta){Z(xa,wa,ma,ta);ja(ma,ta,ma,ta)}function ja(xa,wa,ma,ta){{var Da=c.earth;const Ja=ha*xa[wa];var Oa=ha*xa[wa+1];xa=xa[wa+2];wa=Math.sin(Oa);Oa=Math.cos(Oa);const ra=Da.radius/Math.sqrt(1-Da.eccentricitySquared*wa*wa);ma[ta++]=(ra+xa)*Oa*Math.cos(Ja);ma[ta++]=(ra+xa)*Oa*Math.sin(Ja);ma[ta++]=(ra*(1-Da.eccentricitySquared)+xa)*wa}}function la(xa,wa,ma,ta){var Da=C.earthEllipsoidConstants,Oa=xa[wa],Ja=xa[wa+1];xa=xa[wa+2];let ra;wa=Math.abs(xa);var Ca=Oa*Oa+Ja*
Ja;var Ma=Math.sqrt(Ca);var Ta=Ca+xa*xa;var Xa=Math.sqrt(Ta);Oa=Math.atan2(Ja,Oa);var ab=xa*xa/Ta;Ta=Ca/Ta;Ja=Da.a2/Xa;Ca=Da.a3-Da.a4/Xa;.3<Ta?(ab=wa/Xa*(1+Ta*(Da.a1+Ja+ab*Ca)/Xa),Xa=Math.asin(ab),Ja=ab*ab,Ta=Math.sqrt(1-Ja)):(Ta=Ma/Xa*(1-ab*(Da.a5-Ja-Ta*Ca)/Xa),Xa=Math.acos(Ta),Ja=1-Ta*Ta,ab=Math.sqrt(Ja));ra=1-c.earth.eccentricitySquared*Ja;Ja=c.earth.radius/Math.sqrt(ra);Da=Da.a6*Ja;Ja=Ma-Ja*Ta;Ca=wa-Da*ab;wa=Ta*Ja+ab*Ca;Ma=Ta*Ca-ab*Ja;Da=Ma/(Da/ra+wa);Xa+=Da;0>xa&&(Xa=-Xa);ma[ta++]=Ya*Oa;ma[ta++]=
Ya*Xa;ma[ta]=wa+Ma*Da/2}function qa(xa,wa,ma,ta){la(xa,wa,ma,ta);da(ma,ta,ma,ta)}function na(xa,wa,ma,ta){la(xa,wa,ma,ta);ca(ma,ta,ma,ta)}function oa(xa,wa,ma=za()){return r.isNone(xa)||r.isNone(wa)?null:ua(xa,wa,ma).projector}function ua(xa,wa,ma){if(r.isNone(xa)||r.isNone(wa)||ma.source.spatialReference===xa&&ma.dest.spatialReference===wa)return ma;const ta=P(xa,ma.source),Da=P(wa,ma.dest);0===ta&&0===Da?d.equals(xa,wa)?ma.projector=U:ma.projector=null:ma.projector=Pa[ta][Da];return ma}function za(){return{source:{spatialReference:null,
spatialReferenceId:0,metersPerUnit:1},dest:{spatialReference:null,spatialReferenceId:0,metersPerUnit:1},projector:U}}let Fa=null,La=null,Sa=null,Ia={},Qa=function(xa){function wa(){return xa.call(this,"projection:not-loaded","projection engine not fully loaded yet, please call load()")||this}a._inheritsLoose(wa,xa);return wa}(l);(function(xa){xa.x2lon=function(wa){return wa/c.earth.radius};xa.y2lat=function(wa){return Math.PI/2-2*Math.atan(Math.exp(-1*wa/c.earth.radius))};xa.lon2x=function(wa){return wa*
c.earth.radius};xa.lat2y=function(wa){wa=Math.sin(wa);return c.earth.radius/2*Math.log((1+wa)/(1-wa))}})(k.webMercator||(k.webMercator={}));const Pa={[2]:{[5]:null,[8]:null,[10]:null,[6]:U,[1]:da,[7]:null,[9]:null,[0]:null,[3]:ca,[2]:U,[4]:ja},[5]:{[5]:U,[8]:null,[10]:null,[6]:U,[1]:da,[7]:null,[9]:null,[0]:null,[3]:null,[2]:null,[4]:ja},[8]:{[5]:null,[8]:U,[10]:null,[6]:null,[1]:null,[7]:ka,[9]:null,[0]:null,[3]:null,[2]:null,[4]:null},[10]:{[5]:null,[8]:null,[10]:U,[6]:null,[1]:null,[7]:null,[9]:aa,
[0]:null,[3]:null,[2]:null,[4]:null},[3]:{[5]:null,[8]:null,[10]:null,[6]:V,[1]:W,[7]:null,[9]:null,[0]:null,[3]:U,[2]:V,[4]:X},[4]:{[5]:la,[8]:null,[10]:null,[6]:la,[1]:qa,[7]:null,[9]:null,[0]:null,[3]:na,[2]:la,[4]:U},[1]:{[5]:Z,[8]:null,[10]:null,[6]:Z,[1]:U,[7]:null,[9]:null,[0]:null,[3]:ba,[2]:Z,[4]:ia},[7]:{[5]:null,[8]:Y,[10]:null,[6]:null,[1]:null,[7]:U,[9]:null,[0]:null,[3]:null,[2]:null,[4]:null},[9]:{[5]:null,[8]:null,[10]:ea,[6]:null,[1]:null,[7]:null,[9]:U,[0]:null,[3]:null,[2]:null,
[4]:null},[0]:{[5]:null,[8]:null,[10]:null,[6]:null,[1]:null,[7]:null,[9]:null,[0]:U,[3]:null,[2]:null,[4]:null},[6]:{[5]:null,[8]:null,[10]:null,[6]:U,[1]:da,[7]:null,[9]:null,[0]:null,[3]:null,[2]:U,[4]:ja}},sa={spatialReference:null,spatialReferenceId:0},Ga={spatialReference:null,spatialReferenceId:0},Ra=za(),Ua=za(),ha=w.deg2rad(1),Ya=w.rad2deg(1),Wa=q.create(),db=q.create(),mb=q.create(),Ea=q.create(),ya=q.create();k.canProjectToWGS84ComparableLonLat=function(xa){if(r.isNone(xa))return!1;xa=
P(xa,sa);return!!Pa[xa][6]};k.canProjectWithoutEngine=G;k.computeLatLonToENURotation=N;k.computeLinearTransformation=function(xa,wa,ma,ta){if(r.isNone(xa)||r.isNone(ta))return!1;var Da=P(xa,sa),Oa=P(ta,Ga);if(Da===Oa&&1!==Oa&&(0!==Da||d.equals(xa,ta)))return y.identity(ma),y.translate(ma,ma,wa),!0;if(1===Oa||7===Oa||9===Oa){ta=xa=0;if(1===Oa){Da=Pa[Da][6];Oa=Pa[6][Oa];if(r.isNone(Da)||r.isNone(Oa))return!1;Da(wa,0,db,0);Oa(db,0,mb,0);xa=ha*db[0];ta=ha*db[1]}else if(7===Oa||9===Oa){Oa=Pa[Da][Oa];if(r.isNone(Oa))return!1;
Oa(wa,0,mb,0);xa=ha*wa[0];ta=ha*wa[1]}N(ta,xa,ma);ma[12]=mb[0];ma[13]=mb[1];ma[14]=mb[2];return!0}if(3===Oa&&(2===Da||1===Da)){Oa=Pa[Da][6];if(r.isNone(Oa))return!1;Oa(wa,0,db,0);wa=ha*db[1];ca(db,0,mb,0);y.identity(ma);y.translate(ma,ma,mb);wa=1/Math.cos(wa);y.scale(ma,ma,[wa,wa,1]);return!0}return!1};k.getProjectorName=function(xa,wa){switch(oa(xa,wa,Ra)){case U:return"copy3";case da:return"wgs84ToSphericalECEF";case ca:return"wgs84ToWebMercator";case ja:return"wgs84ToWGS84ECEF";case V:return"webMercatorToWGS84";
case W:return"webMercatorToSphericalECEF";case X:return"webMercatorToWGS84ECEF";case la:return"wgs84ECEFToWGS84";case qa:return"wgs84ECEFToSphericalECEF";case na:return"wgs84ECEFToWebMercator";case Z:return"sphericalECEFToWGS84";case ba:return"sphericalECEFToWebMercator";case Y:return"sphericalECEFToMars2000";case ea:return"sphericalECEFToMoon2000";case ia:return"sphericalECEFToWGS84ECEF";case ka:return"mars2000ToSphericalPCPF";case aa:return"moon2000ToSphericalPCPF";default:return null}};k.getTransformation=
E;k.getTransformations=function(xa,wa,ma=null){if(r.isNone(Fa))throw new Qa;xa=Fa._getTransformationBySuitability(La,xa,wa,ma,null==ma?void 0:ma.spatialReference);if(null!==xa){wa=[];for(const ta of xa)wa.push(z.fromGE(ta));return wa}return[]};k.initializeProjection=async function(xa,wa){if(!A())for(const {source:ma,dest:ta,geographicTransformation:Da}of xa)if(!G(ma,ta,Da))return t(wa)};k.isLoaded=A;k.isSupported=function(){return!0};k.load=t;k.localLinearScaleFactors=function(xa,wa,ma,ta){if(r.isNone(wa)||
r.isNone(ta))return!1;const Da=P(wa,sa);var Oa=P(ta,Ga);if(Da===Oa&&0!==Da||d.equals(wa,ta))return ma[0]=1,ma[1]=1,ma[2]=1,!0;if(1===Da){wa=m.length(xa);xa=wa/Math.sqrt(xa[0]*xa[0]+xa[1]*xa[1]);wa/=c.earth.radius;if(3===Oa)return ma[0]=xa*wa,ma[1]=xa*wa,ma[2]=1,!0;if(2===Oa||5===Oa)return Oa=180/(c.earth.radius*Math.PI),ma[0]=Oa*xa*wa,ma[1]=Oa*wa,ma[2]=1,!0}return!1};k.lonLatToSphericalPCPF=function(xa,wa,ma,ta,Da=0){ta+=Da;Da=Math.cos(ma);xa[0]=Math.cos(wa)*Da*ta;xa[1]=Math.sin(wa)*Da*ta;xa[2]=Math.sin(ma)*
ta};k.project=function(xa,wa,ma=null){return Array.isArray(xa)?0===xa.length?[]:D(La,xa,xa[0].spatialReference,wa,ma):D(La,[xa],xa.spatialReference,wa,ma)[0]};k.projectBoundingRect=function(xa,wa,ma,ta){if(null==xa)return!1;if(d.equals(wa,ta))return x.set(ma,xa),!0;Wa[0]=xa[0];Wa[1]=xa[1];Wa[2]=0;if(!Q(Wa,wa,0,Wa,ta,0,1))return!1;ma[0]=Wa[0];ma[1]=Wa[1];Wa[0]=xa[2];Wa[1]=xa[3];Wa[2]=0;if(!Q(Wa,wa,0,Wa,ta,0,1))return!1;ma[2]=Wa[0];ma[3]=Wa[1];return!0};k.projectBoundingSphere=function(xa,wa,ma,ta){if(r.isNone(wa)||
r.isNone(ta))return!1;wa=ua(wa,ta,Ua);if(wa.projector===U)return ma[0]=xa[0],ma[1]=xa[1],ma[2]=xa[2],ma[3]=xa[3],!0;if(r.isNone(wa.projector))return!1;const {source:Da,dest:Oa}=wa;if(3===Oa.spatialReferenceId){wa=Pa[Da.spatialReferenceId][2];if(r.isNone(wa))return!1;wa(xa,0,db,0);wa=Math.abs(ha*db[1])+Math.asin(xa[3]/(c.earth.radius+xa[2]));ca(db,0,ma,0);ma[3]=wa>.9999*Math.PI?Number.MAX_VALUE:1/Math.cos(wa)*xa[3];return!0}wa.projector(xa,0,ma,0);ma[3]=xa[3]*Da.metersPerUnit/Oa.metersPerUnit;return!0};
k.projectBuffer=Q;k.projectDirection=function(xa,wa,ma,ta,Da){m.copy(Ea,xa);m.add(ya,xa,wa);T(Ea,ma,Ea,Da);T(ya,ma,ya,Da);m.subtract(ta,ya,Ea);m.normalize(ta,ta)};k.projectExtent=function(xa,wa,ma=wa.spatialReference,ta=0){return r.isNone(ma)?!1:S(xa,xa.spatialReference,wa,ma,ta)};k.projectMany=D;k.projectMultipoint=function(xa,wa,ma=wa.spatialReference,ta=0){return r.isNone(ma)?!1:J(xa,xa.spatialReference,wa,ma,ta)};k.projectPoint=function(xa,wa,ma=wa.spatialReference,ta=0){return r.isNone(ma)?!1:
I(xa,xa.spatialReference,wa,ma,ta)};k.projectPointToVector=function(xa,wa,ma,ta=0){Ea[0]=xa.x;Ea[1]=xa.y;const Da=xa.z;Ea[2]=void 0!==Da?Da:ta;return Q(Ea,xa.spatialReference,0,wa,ma,0,1)};k.projectPointToWGS84ComparableLonLat=function(xa,wa){Ea[0]=xa.x;Ea[1]=xa.y;const ma=xa.z;Ea[2]=void 0!==ma?ma:0;return O(Ea,xa.spatialReference,wa)};k.projectPolygon=function(xa,wa,ma=wa.spatialReference,ta=0){return r.isNone(ma)?!1:L(xa,xa.spatialReference,wa,ma,ta)};k.projectPolyline=function(xa,wa,ma=wa.spatialReference,
ta=0){return r.isNone(ma)?!1:K(xa,xa.spatialReference,wa,ma,ta)};k.projectVectorToDehydratedPoint=function(xa,wa,ma,ta){r.isNone(ta)&&(ta=ma.spatialReference);return Q(xa,wa,0,Ea,ta,0,1)?(ma.x=Ea[0],ma.y=Ea[1],ma.z=Ea[2],ma.spatialReference=ta,ma):null};k.projectVectorToPoint=function(xa,wa,ma,ta){if(r.isNone(wa)||r.isNone(ma))return null;ta=r.isSome(ta)?ta:new e({spatialReference:ma});return Q(xa,wa,0,Ea,ma,0,1)?(ta.x=Ea[0],ta.y=Ea[1],ta.z=Ea[2],ta.spatialReference=ma,ta):null};k.projectVectorToVector=
T;k.projectVectorToWGS84ComparableLonLat=O;k.projectXYZToVector=M;k.sphericalECEFToSphericalPCPF=fa;k.unload=function(){Sa=La=Fa=null;Ia={}};Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/mat4":function(){define(["exports","./vec3f64","./common"],function(b,k,a){function r(R,aa){R[0]=aa[0];R[1]=aa[1];R[2]=aa[2];R[3]=aa[3];R[4]=aa[4];R[5]=aa[5];R[6]=aa[6];R[7]=aa[7];R[8]=aa[8];R[9]=aa[9];R[10]=aa[10];R[11]=aa[11];R[12]=aa[12];R[13]=aa[13];R[14]=aa[14];R[15]=aa[15];return R}function l(R,
aa,ka,da,fa,ea,Y,Z,ba,ia,ja,la,qa,na,oa,ua,za){R[0]=aa;R[1]=ka;R[2]=da;R[3]=fa;R[4]=ea;R[5]=Y;R[6]=Z;R[7]=ba;R[8]=ia;R[9]=ja;R[10]=la;R[11]=qa;R[12]=na;R[13]=oa;R[14]=ua;R[15]=za;return R}function h(R){R[0]=1;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=1;R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[10]=1;R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function d(R,aa){if(R===aa){const ka=aa[1],da=aa[2],fa=aa[3],ea=aa[6],Y=aa[7],Z=aa[11];R[1]=aa[4];R[2]=aa[8];R[3]=aa[12];R[4]=ka;R[6]=aa[9];R[7]=aa[13];R[8]=da;R[9]=ea;R[11]=
aa[14];R[12]=fa;R[13]=Y;R[14]=Z}else R[0]=aa[0],R[1]=aa[4],R[2]=aa[8],R[3]=aa[12],R[4]=aa[1],R[5]=aa[5],R[6]=aa[9],R[7]=aa[13],R[8]=aa[2],R[9]=aa[6],R[10]=aa[10],R[11]=aa[14],R[12]=aa[3],R[13]=aa[7],R[14]=aa[11],R[15]=aa[15];return R}function c(R,aa){const ka=aa[0],da=aa[1],fa=aa[2],ea=aa[3],Y=aa[4],Z=aa[5],ba=aa[6],ia=aa[7],ja=aa[8],la=aa[9],qa=aa[10],na=aa[11],oa=aa[12],ua=aa[13],za=aa[14];aa=aa[15];const Fa=ka*Z-da*Y,La=ka*ba-fa*Y,Sa=ka*ia-ea*Y,Ia=da*ba-fa*Z,Qa=da*ia-ea*Z,Pa=fa*ia-ea*ba,sa=ja*
ua-la*oa,Ga=ja*za-qa*oa,Ra=ja*aa-na*oa,Ua=la*za-qa*ua,ha=la*aa-na*ua,Ya=qa*aa-na*za;let Wa=Fa*Ya-La*ha+Sa*Ua+Ia*Ra-Qa*Ga+Pa*sa;if(!Wa)return null;Wa=1/Wa;R[0]=(Z*Ya-ba*ha+ia*Ua)*Wa;R[1]=(fa*ha-da*Ya-ea*Ua)*Wa;R[2]=(ua*Pa-za*Qa+aa*Ia)*Wa;R[3]=(qa*Qa-la*Pa-na*Ia)*Wa;R[4]=(ba*Ra-Y*Ya-ia*Ga)*Wa;R[5]=(ka*Ya-fa*Ra+ea*Ga)*Wa;R[6]=(za*Sa-oa*Pa-aa*La)*Wa;R[7]=(ja*Pa-qa*Sa+na*La)*Wa;R[8]=(Y*ha-Z*Ra+ia*sa)*Wa;R[9]=(da*Ra-ka*ha-ea*sa)*Wa;R[10]=(oa*Qa-ua*Sa+aa*Fa)*Wa;R[11]=(la*Sa-ja*Qa-na*Fa)*Wa;R[12]=(Z*Ga-Y*
Ua-ba*sa)*Wa;R[13]=(ka*Ua-da*Ga+fa*sa)*Wa;R[14]=(ua*La-oa*Ia-za*Fa)*Wa;R[15]=(ja*Ia-la*La+qa*Fa)*Wa;return R}function e(R,aa){const ka=aa[0],da=aa[1],fa=aa[2],ea=aa[3],Y=aa[4],Z=aa[5],ba=aa[6],ia=aa[7],ja=aa[8],la=aa[9],qa=aa[10],na=aa[11],oa=aa[12],ua=aa[13],za=aa[14];aa=aa[15];R[0]=Z*(qa*aa-na*za)-la*(ba*aa-ia*za)+ua*(ba*na-ia*qa);R[1]=-(da*(qa*aa-na*za)-la*(fa*aa-ea*za)+ua*(fa*na-ea*qa));R[2]=da*(ba*aa-ia*za)-Z*(fa*aa-ea*za)+ua*(fa*ia-ea*ba);R[3]=-(da*(ba*na-ia*qa)-Z*(fa*na-ea*qa)+la*(fa*ia-ea*
ba));R[4]=-(Y*(qa*aa-na*za)-ja*(ba*aa-ia*za)+oa*(ba*na-ia*qa));R[5]=ka*(qa*aa-na*za)-ja*(fa*aa-ea*za)+oa*(fa*na-ea*qa);R[6]=-(ka*(ba*aa-ia*za)-Y*(fa*aa-ea*za)+oa*(fa*ia-ea*ba));R[7]=ka*(ba*na-ia*qa)-Y*(fa*na-ea*qa)+ja*(fa*ia-ea*ba);R[8]=Y*(la*aa-na*ua)-ja*(Z*aa-ia*ua)+oa*(Z*na-ia*la);R[9]=-(ka*(la*aa-na*ua)-ja*(da*aa-ea*ua)+oa*(da*na-ea*la));R[10]=ka*(Z*aa-ia*ua)-Y*(da*aa-ea*ua)+oa*(da*ia-ea*Z);R[11]=-(ka*(Z*na-ia*la)-Y*(da*na-ea*la)+ja*(da*ia-ea*Z));R[12]=-(Y*(la*za-qa*ua)-ja*(Z*za-ba*ua)+oa*(Z*
qa-ba*la));R[13]=ka*(la*za-qa*ua)-ja*(da*za-fa*ua)+oa*(da*qa-fa*la);R[14]=-(ka*(Z*za-ba*ua)-Y*(da*za-fa*ua)+oa*(da*ba-fa*Z));R[15]=ka*(Z*qa-ba*la)-Y*(da*qa-fa*la)+ja*(da*ba-fa*Z);return R}function f(R){const aa=R[0],ka=R[1],da=R[2],fa=R[3],ea=R[4],Y=R[5],Z=R[6],ba=R[7],ia=R[8],ja=R[9],la=R[10],qa=R[11],na=R[12],oa=R[13],ua=R[14];R=R[15];return(aa*Y-ka*ea)*(la*R-qa*ua)-(aa*Z-da*ea)*(ja*R-qa*oa)+(aa*ba-fa*ea)*(ja*ua-la*oa)+(ka*Z-da*Y)*(ia*R-qa*na)-(ka*ba-fa*Y)*(ia*ua-la*na)+(da*ba-fa*Z)*(ia*oa-ja*na)}
function g(R,aa,ka){const da=aa[0],fa=aa[1],ea=aa[2],Y=aa[3],Z=aa[4],ba=aa[5],ia=aa[6],ja=aa[7],la=aa[8],qa=aa[9],na=aa[10],oa=aa[11],ua=aa[12],za=aa[13],Fa=aa[14];aa=aa[15];let La=ka[0],Sa=ka[1],Ia=ka[2],Qa=ka[3];R[0]=La*da+Sa*Z+Ia*la+Qa*ua;R[1]=La*fa+Sa*ba+Ia*qa+Qa*za;R[2]=La*ea+Sa*ia+Ia*na+Qa*Fa;R[3]=La*Y+Sa*ja+Ia*oa+Qa*aa;La=ka[4];Sa=ka[5];Ia=ka[6];Qa=ka[7];R[4]=La*da+Sa*Z+Ia*la+Qa*ua;R[5]=La*fa+Sa*ba+Ia*qa+Qa*za;R[6]=La*ea+Sa*ia+Ia*na+Qa*Fa;R[7]=La*Y+Sa*ja+Ia*oa+Qa*aa;La=ka[8];Sa=ka[9];Ia=ka[10];
Qa=ka[11];R[8]=La*da+Sa*Z+Ia*la+Qa*ua;R[9]=La*fa+Sa*ba+Ia*qa+Qa*za;R[10]=La*ea+Sa*ia+Ia*na+Qa*Fa;R[11]=La*Y+Sa*ja+Ia*oa+Qa*aa;La=ka[12];Sa=ka[13];Ia=ka[14];Qa=ka[15];R[12]=La*da+Sa*Z+Ia*la+Qa*ua;R[13]=La*fa+Sa*ba+Ia*qa+Qa*za;R[14]=La*ea+Sa*ia+Ia*na+Qa*Fa;R[15]=La*Y+Sa*ja+Ia*oa+Qa*aa;return R}function p(R,aa,ka){const da=ka[0],fa=ka[1];ka=ka[2];let ea=void 0,Y=void 0,Z=void 0,ba=void 0,ia=void 0,ja=void 0,la=void 0,qa=void 0,na=void 0,oa=void 0,ua=void 0,za=void 0;aa===R?(R[12]=aa[0]*da+aa[4]*fa+aa[8]*
ka+aa[12],R[13]=aa[1]*da+aa[5]*fa+aa[9]*ka+aa[13],R[14]=aa[2]*da+aa[6]*fa+aa[10]*ka+aa[14],R[15]=aa[3]*da+aa[7]*fa+aa[11]*ka+aa[15]):(ea=aa[0],Y=aa[1],Z=aa[2],ba=aa[3],ia=aa[4],ja=aa[5],la=aa[6],qa=aa[7],na=aa[8],oa=aa[9],ua=aa[10],za=aa[11],R[0]=ea,R[1]=Y,R[2]=Z,R[3]=ba,R[4]=ia,R[5]=ja,R[6]=la,R[7]=qa,R[8]=na,R[9]=oa,R[10]=ua,R[11]=za,R[12]=ea*da+ia*fa+na*ka+aa[12],R[13]=Y*da+ja*fa+oa*ka+aa[13],R[14]=Z*da+la*fa+ua*ka+aa[14],R[15]=ba*da+qa*fa+za*ka+aa[15]);return R}function n(R,aa,ka){const da=ka[0],
fa=ka[1];ka=ka[2];R[0]=aa[0]*da;R[1]=aa[1]*da;R[2]=aa[2]*da;R[3]=aa[3]*da;R[4]=aa[4]*fa;R[5]=aa[5]*fa;R[6]=aa[6]*fa;R[7]=aa[7]*fa;R[8]=aa[8]*ka;R[9]=aa[9]*ka;R[10]=aa[10]*ka;R[11]=aa[11]*ka;R[12]=aa[12];R[13]=aa[13];R[14]=aa[14];R[15]=aa[15];return R}function w(R,aa,ka,da){let fa=da[0],ea=da[1];da=da[2];let Y=Math.sqrt(fa*fa+ea*ea+da*da);var Z=void 0,ba=void 0;let ia=void 0,ja=void 0,la=void 0,qa=void 0,na=void 0,oa=void 0,ua=void 0,za=void 0,Fa=void 0,La=void 0,Sa=void 0,Ia=void 0,Qa=void 0,Pa=void 0,
sa=void 0,Ga=void 0,Ra=void 0,Ua=void 0,ha=void 0,Ya=void 0;ba=Z=void 0;if(Y<a.EPSILON)return null;Y=1/Y;fa*=Y;ea*=Y;da*=Y;Z=Math.sin(ka);ba=Math.cos(ka);ia=1-ba;ja=aa[0];la=aa[1];qa=aa[2];na=aa[3];oa=aa[4];ua=aa[5];za=aa[6];Fa=aa[7];La=aa[8];Sa=aa[9];Ia=aa[10];Qa=aa[11];Pa=fa*fa*ia+ba;sa=ea*fa*ia+da*Z;Ga=da*fa*ia-ea*Z;Ra=fa*ea*ia-da*Z;Ua=ea*ea*ia+ba;ha=da*ea*ia+fa*Z;Ya=fa*da*ia+ea*Z;Z=ea*da*ia-fa*Z;ba=da*da*ia+ba;R[0]=ja*Pa+oa*sa+La*Ga;R[1]=la*Pa+ua*sa+Sa*Ga;R[2]=qa*Pa+za*sa+Ia*Ga;R[3]=na*Pa+Fa*
sa+Qa*Ga;R[4]=ja*Ra+oa*Ua+La*ha;R[5]=la*Ra+ua*Ua+Sa*ha;R[6]=qa*Ra+za*Ua+Ia*ha;R[7]=na*Ra+Fa*Ua+Qa*ha;R[8]=ja*Ya+oa*Z+La*ba;R[9]=la*Ya+ua*Z+Sa*ba;R[10]=qa*Ya+za*Z+Ia*ba;R[11]=na*Ya+Fa*Z+Qa*ba;aa!==R&&(R[12]=aa[12],R[13]=aa[13],R[14]=aa[14],R[15]=aa[15]);return R}function q(R,aa,ka){const da=Math.sin(ka);ka=Math.cos(ka);const fa=aa[4],ea=aa[5],Y=aa[6],Z=aa[7],ba=aa[8],ia=aa[9],ja=aa[10],la=aa[11];aa!==R&&(R[0]=aa[0],R[1]=aa[1],R[2]=aa[2],R[3]=aa[3],R[12]=aa[12],R[13]=aa[13],R[14]=aa[14],R[15]=aa[15]);
R[4]=fa*ka+ba*da;R[5]=ea*ka+ia*da;R[6]=Y*ka+ja*da;R[7]=Z*ka+la*da;R[8]=ba*ka-fa*da;R[9]=ia*ka-ea*da;R[10]=ja*ka-Y*da;R[11]=la*ka-Z*da;return R}function m(R,aa,ka){const da=Math.sin(ka);ka=Math.cos(ka);const fa=aa[0],ea=aa[1],Y=aa[2],Z=aa[3],ba=aa[8],ia=aa[9],ja=aa[10],la=aa[11];aa!==R&&(R[4]=aa[4],R[5]=aa[5],R[6]=aa[6],R[7]=aa[7],R[12]=aa[12],R[13]=aa[13],R[14]=aa[14],R[15]=aa[15]);R[0]=fa*ka-ba*da;R[1]=ea*ka-ia*da;R[2]=Y*ka-ja*da;R[3]=Z*ka-la*da;R[8]=fa*da+ba*ka;R[9]=ea*da+ia*ka;R[10]=Y*da+ja*ka;
R[11]=Z*da+la*ka;return R}function u(R,aa,ka){const da=Math.sin(ka);ka=Math.cos(ka);const fa=aa[0],ea=aa[1],Y=aa[2],Z=aa[3],ba=aa[4],ia=aa[5],ja=aa[6],la=aa[7];aa!==R&&(R[8]=aa[8],R[9]=aa[9],R[10]=aa[10],R[11]=aa[11],R[12]=aa[12],R[13]=aa[13],R[14]=aa[14],R[15]=aa[15]);R[0]=fa*ka+ba*da;R[1]=ea*ka+ia*da;R[2]=Y*ka+ja*da;R[3]=Z*ka+la*da;R[4]=ba*ka-fa*da;R[5]=ia*ka-ea*da;R[6]=ja*ka-Y*da;R[7]=la*ka-Z*da;return R}function v(R,aa){R[0]=1;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=1;R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[10]=
1;R[11]=0;R[12]=aa[0];R[13]=aa[1];R[14]=aa[2];R[15]=1;return R}function y(R,aa){R[0]=aa[0];R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=aa[1];R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[10]=aa[2];R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function B(R,aa,ka){let da=ka[0],fa=ka[1];ka=ka[2];let ea=Math.sqrt(da*da+fa*fa+ka*ka),Y=void 0,Z=void 0,ba=void 0;if(ea<a.EPSILON)return null;ea=1/ea;da*=ea;fa*=ea;ka*=ea;Y=Math.sin(aa);Z=Math.cos(aa);ba=1-Z;R[0]=da*da*ba+Z;R[1]=fa*da*ba+ka*Y;R[2]=ka*da*ba-fa*Y;R[3]=0;R[4]=da*fa*ba-
ka*Y;R[5]=fa*fa*ba+Z;R[6]=ka*fa*ba+da*Y;R[7]=0;R[8]=da*ka*ba+fa*Y;R[9]=fa*ka*ba-da*Y;R[10]=ka*ka*ba+Z;R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function x(R,aa){const ka=Math.sin(aa);aa=Math.cos(aa);R[0]=1;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=aa;R[6]=ka;R[7]=0;R[8]=0;R[9]=-ka;R[10]=aa;R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function C(R,aa){const ka=Math.sin(aa);aa=Math.cos(aa);R[0]=aa;R[1]=0;R[2]=-ka;R[3]=0;R[4]=0;R[5]=1;R[6]=0;R[7]=0;R[8]=ka;R[9]=0;R[10]=aa;R[11]=0;R[12]=0;R[13]=0;R[14]=
0;R[15]=1;return R}function z(R,aa){const ka=Math.sin(aa);aa=Math.cos(aa);R[0]=aa;R[1]=ka;R[2]=0;R[3]=0;R[4]=-ka;R[5]=aa;R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[10]=1;R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function A(R,aa,ka){var da=aa[0],fa=aa[1],ea=aa[2],Y=aa[3],Z=da+da,ba=fa+fa;const ia=ea+ea;aa=da*Z;const ja=da*ba;da*=ia;const la=fa*ba;fa*=ia;ea*=ia;Z*=Y;ba*=Y;Y*=ia;R[0]=1-(la+ea);R[1]=ja+Y;R[2]=da-ba;R[3]=0;R[4]=ja-Y;R[5]=1-(aa+ea);R[6]=fa+Z;R[7]=0;R[8]=da+ba;R[9]=fa-Z;R[10]=1-(aa+la);R[11]=
0;R[12]=ka[0];R[13]=ka[1];R[14]=ka[2];R[15]=1;return R}function t(R,aa){const ka=ca,da=-aa[0],fa=-aa[1],ea=-aa[2],Y=aa[3],Z=aa[4],ba=aa[5],ia=aa[6],ja=aa[7],la=da*da+fa*fa+ea*ea+Y*Y;0<la?(ka[0]=2*(Z*Y+ja*da+ba*ea-ia*fa)/la,ka[1]=2*(ba*Y+ja*fa+ia*da-Z*ea)/la,ka[2]=2*(ia*Y+ja*ea+Z*fa-ba*da)/la):(ka[0]=2*(Z*Y+ja*da+ba*ea-ia*fa),ka[1]=2*(ba*Y+ja*fa+ia*da-Z*ea),ka[2]=2*(ia*Y+ja*ea+Z*fa-ba*da));A(R,aa,ka);return R}function D(R,aa){R[0]=aa[12];R[1]=aa[13];R[2]=aa[14];return R}function E(R,aa){const ka=aa[0],
da=aa[1],fa=aa[2],ea=aa[4],Y=aa[5],Z=aa[6],ba=aa[8],ia=aa[9];aa=aa[10];R[0]=Math.sqrt(ka*ka+da*da+fa*fa);R[1]=Math.sqrt(ea*ea+Y*Y+Z*Z);R[2]=Math.sqrt(ba*ba+ia*ia+aa*aa);return R}function G(R,aa){const ka=aa[0]+aa[5]+aa[10];let da=0;0<ka?(da=2*Math.sqrt(ka+1),R[3]=.25*da,R[0]=(aa[6]-aa[9])/da,R[1]=(aa[8]-aa[2])/da,R[2]=(aa[1]-aa[4])/da):aa[0]>aa[5]&&aa[0]>aa[10]?(da=2*Math.sqrt(1+aa[0]-aa[5]-aa[10]),R[3]=(aa[6]-aa[9])/da,R[0]=.25*da,R[1]=(aa[1]+aa[4])/da,R[2]=(aa[8]+aa[2])/da):aa[5]>aa[10]?(da=2*Math.sqrt(1+
aa[5]-aa[0]-aa[10]),R[3]=(aa[8]-aa[2])/da,R[0]=(aa[1]+aa[4])/da,R[1]=.25*da,R[2]=(aa[6]+aa[9])/da):(da=2*Math.sqrt(1+aa[10]-aa[0]-aa[5]),R[3]=(aa[1]-aa[4])/da,R[0]=(aa[8]+aa[2])/da,R[1]=(aa[6]+aa[9])/da,R[2]=.25*da);return R}function H(R,aa,ka,da){var fa=aa[0],ea=aa[1],Y=aa[2],Z=aa[3],ba=fa+fa,ia=ea+ea,ja=Y+Y;aa=fa*ba;const la=fa*ia;fa*=ja;const qa=ea*ia;ea*=ja;Y*=ja;ba*=Z;ia*=Z;Z*=ja;ja=da[0];const na=da[1];da=da[2];R[0]=(1-(qa+Y))*ja;R[1]=(la+Z)*ja;R[2]=(fa-ia)*ja;R[3]=0;R[4]=(la-Z)*na;R[5]=(1-
(aa+Y))*na;R[6]=(ea+ba)*na;R[7]=0;R[8]=(fa+ia)*da;R[9]=(ea-ba)*da;R[10]=(1-(aa+qa))*da;R[11]=0;R[12]=ka[0];R[13]=ka[1];R[14]=ka[2];R[15]=1;return R}function I(R,aa,ka,da,fa){var ea=aa[0],Y=aa[1],Z=aa[2],ba=aa[3],ia=ea+ea,ja=Y+Y,la=Z+Z;aa=ea*ia;var qa=ea*ja,na=ea*la;ea=Y*ja;Y*=la;var oa=Z*la;Z=ba*ia;ja*=ba;const ua=ba*la;var za=da[0],Fa=da[1];la=da[2];da=fa[0];ba=fa[1];fa=fa[2];ia=(1-(ea+oa))*za;const La=(qa+ua)*za;za*=na-ja;qa=(qa-ua)*Fa;oa=(1-(aa+oa))*Fa;Fa*=Y+Z;na=(na+ja)*la;Y=(Y-Z)*la;aa=(1-(aa+
ea))*la;R[0]=ia;R[1]=La;R[2]=za;R[3]=0;R[4]=qa;R[5]=oa;R[6]=Fa;R[7]=0;R[8]=na;R[9]=Y;R[10]=aa;R[11]=0;R[12]=ka[0]+da-(ia*da+qa*ba+na*fa);R[13]=ka[1]+ba-(La*da+oa*ba+Y*fa);R[14]=ka[2]+fa-(za*da+Fa*ba+aa*fa);R[15]=1;return R}function J(R,aa){var ka=aa[0],da=aa[1],fa=aa[2];aa=aa[3];var ea=ka+ka,Y=da+da;const Z=fa+fa;ka*=ea;const ba=da*ea;da*=Y;const ia=fa*ea,ja=fa*Y;fa*=Z;ea*=aa;Y*=aa;aa*=Z;R[0]=1-da-fa;R[1]=ba+aa;R[2]=ia-Y;R[3]=0;R[4]=ba-aa;R[5]=1-ka-fa;R[6]=ja+ea;R[7]=0;R[8]=ia+Y;R[9]=ja-ea;R[10]=
1-ka-da;R[11]=0;R[12]=0;R[13]=0;R[14]=0;R[15]=1;return R}function K(R,aa,ka,da,fa,ea,Y){const Z=1/(ka-aa),ba=1/(fa-da),ia=1/(ea-Y);R[0]=2*ea*Z;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=2*ea*ba;R[6]=0;R[7]=0;R[8]=(ka+aa)*Z;R[9]=(fa+da)*ba;R[10]=(Y+ea)*ia;R[11]=-1;R[12]=0;R[13]=0;R[14]=Y*ea*2*ia;R[15]=0;return R}function L(R,aa,ka,da,fa){aa=1/Math.tan(aa/2);let ea=void 0;R[0]=aa/ka;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=aa;R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[11]=-1;R[12]=0;R[13]=0;R[15]=0;null!=fa&&Infinity!==fa?(ea=1/
(da-fa),R[10]=(fa+da)*ea,R[14]=2*fa*da*ea):(R[10]=-1,R[14]=-2*da);return R}function S(R,aa,ka,da){const fa=Math.tan(aa.upDegrees*Math.PI/180),ea=Math.tan(aa.downDegrees*Math.PI/180),Y=Math.tan(aa.leftDegrees*Math.PI/180);aa=Math.tan(aa.rightDegrees*Math.PI/180);const Z=2/(Y+aa),ba=2/(fa+ea);R[0]=Z;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=ba;R[6]=0;R[7]=0;R[8]=-((Y-aa)*Z*.5);R[9]=(fa-ea)*ba*.5;R[10]=da/(ka-da);R[11]=-1;R[12]=0;R[13]=0;R[14]=da*ka/(ka-da);R[15]=0;return R}function M(R,aa,ka,da,fa,ea,Y){const Z=
1/(aa-ka),ba=1/(da-fa),ia=1/(ea-Y);R[0]=-2*Z;R[1]=0;R[2]=0;R[3]=0;R[4]=0;R[5]=-2*ba;R[6]=0;R[7]=0;R[8]=0;R[9]=0;R[10]=2*ia;R[11]=0;R[12]=(aa+ka)*Z;R[13]=(fa+da)*ba;R[14]=(Y+ea)*ia;R[15]=1;return R}function T(R,aa,ka,da){let fa=void 0,ea=void 0;var Y=void 0,Z=void 0;let ba=void 0,ia=void 0;var ja=void 0,la=void 0;let qa=void 0,na=void 0;const oa=aa[0],ua=aa[1];aa=aa[2];Y=da[0];Z=da[1];da=da[2];ja=ka[0];la=ka[1];ka=ka[2];if(Math.abs(oa-ja)<a.EPSILON&&Math.abs(ua-la)<a.EPSILON&&Math.abs(aa-ka)<a.EPSILON)return h(R);
ja=oa-ja;la=ua-la;qa=aa-ka;na=1/Math.sqrt(ja*ja+la*la+qa*qa);ja*=na;la*=na;qa*=na;fa=Z*qa-da*la;ea=da*ja-Y*qa;Y=Y*la-Z*ja;(na=Math.sqrt(fa*fa+ea*ea+Y*Y))?(na=1/na,fa*=na,ea*=na,Y*=na):Y=ea=fa=0;Z=la*Y-qa*ea;ba=qa*fa-ja*Y;ia=ja*ea-la*fa;(na=Math.sqrt(Z*Z+ba*ba+ia*ia))?(na=1/na,Z*=na,ba*=na,ia*=na):ia=ba=Z=0;R[0]=fa;R[1]=Z;R[2]=ja;R[3]=0;R[4]=ea;R[5]=ba;R[6]=la;R[7]=0;R[8]=Y;R[9]=ia;R[10]=qa;R[11]=0;R[12]=-(fa*oa+ea*ua+Y*aa);R[13]=-(Z*oa+ba*ua+ia*aa);R[14]=-(ja*oa+la*ua+qa*aa);R[15]=1;return R}function O(R,
aa,ka,da){const fa=aa[0],ea=aa[1];aa=aa[2];var Y=da[0];const Z=da[1];var ba=da[2];da=fa-ka[0];let ia=ea-ka[1];ka=aa-ka[2];let ja=da*da+ia*ia+ka*ka;0<ja&&(ja=1/Math.sqrt(ja),da*=ja,ia*=ja,ka*=ja);let la=Z*ka-ba*ia;ba=ba*da-Y*ka;Y=Y*ia-Z*da;ja=la*la+ba*ba+Y*Y;0<ja&&(ja=1/Math.sqrt(ja),la*=ja,ba*=ja,Y*=ja);R[0]=la;R[1]=ba;R[2]=Y;R[3]=0;R[4]=ia*Y-ka*ba;R[5]=ka*la-da*Y;R[6]=da*ba-ia*la;R[7]=0;R[8]=da;R[9]=ia;R[10]=ka;R[11]=0;R[12]=fa;R[13]=ea;R[14]=aa;R[15]=1;return R}function Q(R){return"mat4("+R[0]+
", "+R[1]+", "+R[2]+", "+R[3]+", "+R[4]+", "+R[5]+", "+R[6]+", "+R[7]+", "+R[8]+", "+R[9]+", "+R[10]+", "+R[11]+", "+R[12]+", "+R[13]+", "+R[14]+", "+R[15]+")"}function F(R){return Math.sqrt(Math.pow(R[0],2)+Math.pow(R[1],2)+Math.pow(R[2],2)+Math.pow(R[3],2)+Math.pow(R[4],2)+Math.pow(R[5],2)+Math.pow(R[6],2)+Math.pow(R[7],2)+Math.pow(R[8],2)+Math.pow(R[9],2)+Math.pow(R[10],2)+Math.pow(R[11],2)+Math.pow(R[12],2)+Math.pow(R[13],2)+Math.pow(R[14],2)+Math.pow(R[15],2))}function N(R,aa,ka){R[0]=aa[0]+
ka[0];R[1]=aa[1]+ka[1];R[2]=aa[2]+ka[2];R[3]=aa[3]+ka[3];R[4]=aa[4]+ka[4];R[5]=aa[5]+ka[5];R[6]=aa[6]+ka[6];R[7]=aa[7]+ka[7];R[8]=aa[8]+ka[8];R[9]=aa[9]+ka[9];R[10]=aa[10]+ka[10];R[11]=aa[11]+ka[11];R[12]=aa[12]+ka[12];R[13]=aa[13]+ka[13];R[14]=aa[14]+ka[14];R[15]=aa[15]+ka[15];return R}function P(R,aa,ka){R[0]=aa[0]-ka[0];R[1]=aa[1]-ka[1];R[2]=aa[2]-ka[2];R[3]=aa[3]-ka[3];R[4]=aa[4]-ka[4];R[5]=aa[5]-ka[5];R[6]=aa[6]-ka[6];R[7]=aa[7]-ka[7];R[8]=aa[8]-ka[8];R[9]=aa[9]-ka[9];R[10]=aa[10]-ka[10];R[11]=
aa[11]-ka[11];R[12]=aa[12]-ka[12];R[13]=aa[13]-ka[13];R[14]=aa[14]-ka[14];R[15]=aa[15]-ka[15];return R}function U(R,aa,ka){R[0]=aa[0]*ka;R[1]=aa[1]*ka;R[2]=aa[2]*ka;R[3]=aa[3]*ka;R[4]=aa[4]*ka;R[5]=aa[5]*ka;R[6]=aa[6]*ka;R[7]=aa[7]*ka;R[8]=aa[8]*ka;R[9]=aa[9]*ka;R[10]=aa[10]*ka;R[11]=aa[11]*ka;R[12]=aa[12]*ka;R[13]=aa[13]*ka;R[14]=aa[14]*ka;R[15]=aa[15]*ka;return R}function V(R,aa,ka,da){R[0]=aa[0]+ka[0]*da;R[1]=aa[1]+ka[1]*da;R[2]=aa[2]+ka[2]*da;R[3]=aa[3]+ka[3]*da;R[4]=aa[4]+ka[4]*da;R[5]=aa[5]+
ka[5]*da;R[6]=aa[6]+ka[6]*da;R[7]=aa[7]+ka[7]*da;R[8]=aa[8]+ka[8]*da;R[9]=aa[9]+ka[9]*da;R[10]=aa[10]+ka[10]*da;R[11]=aa[11]+ka[11]*da;R[12]=aa[12]+ka[12]*da;R[13]=aa[13]+ka[13]*da;R[14]=aa[14]+ka[14]*da;R[15]=aa[15]+ka[15]*da;return R}function W(R,aa){return R[0]===aa[0]&&R[1]===aa[1]&&R[2]===aa[2]&&R[3]===aa[3]&&R[4]===aa[4]&&R[5]===aa[5]&&R[6]===aa[6]&&R[7]===aa[7]&&R[8]===aa[8]&&R[9]===aa[9]&&R[10]===aa[10]&&R[11]===aa[11]&&R[12]===aa[12]&&R[13]===aa[13]&&R[14]===aa[14]&&R[15]===aa[15]}function X(R,
aa){const ka=R[0],da=R[1],fa=R[2],ea=R[3],Y=R[4],Z=R[5],ba=R[6],ia=R[7],ja=R[8],la=R[9],qa=R[10],na=R[11],oa=R[12],ua=R[13],za=R[14];R=R[15];const Fa=aa[0],La=aa[1],Sa=aa[2],Ia=aa[3],Qa=aa[4],Pa=aa[5],sa=aa[6],Ga=aa[7],Ra=aa[8],Ua=aa[9],ha=aa[10],Ya=aa[11],Wa=aa[12],db=aa[13],mb=aa[14];aa=aa[15];return Math.abs(ka-Fa)<=a.EPSILON*Math.max(1,Math.abs(ka),Math.abs(Fa))&&Math.abs(da-La)<=a.EPSILON*Math.max(1,Math.abs(da),Math.abs(La))&&Math.abs(fa-Sa)<=a.EPSILON*Math.max(1,Math.abs(fa),Math.abs(Sa))&&
Math.abs(ea-Ia)<=a.EPSILON*Math.max(1,Math.abs(ea),Math.abs(Ia))&&Math.abs(Y-Qa)<=a.EPSILON*Math.max(1,Math.abs(Y),Math.abs(Qa))&&Math.abs(Z-Pa)<=a.EPSILON*Math.max(1,Math.abs(Z),Math.abs(Pa))&&Math.abs(ba-sa)<=a.EPSILON*Math.max(1,Math.abs(ba),Math.abs(sa))&&Math.abs(ia-Ga)<=a.EPSILON*Math.max(1,Math.abs(ia),Math.abs(Ga))&&Math.abs(ja-Ra)<=a.EPSILON*Math.max(1,Math.abs(ja),Math.abs(Ra))&&Math.abs(la-Ua)<=a.EPSILON*Math.max(1,Math.abs(la),Math.abs(Ua))&&Math.abs(qa-ha)<=a.EPSILON*Math.max(1,Math.abs(qa),
Math.abs(ha))&&Math.abs(na-Ya)<=a.EPSILON*Math.max(1,Math.abs(na),Math.abs(Ya))&&Math.abs(oa-Wa)<=a.EPSILON*Math.max(1,Math.abs(oa),Math.abs(Wa))&&Math.abs(ua-db)<=a.EPSILON*Math.max(1,Math.abs(ua),Math.abs(db))&&Math.abs(za-mb)<=a.EPSILON*Math.max(1,Math.abs(za),Math.abs(mb))&&Math.abs(R-aa)<=a.EPSILON*Math.max(1,Math.abs(R),Math.abs(aa))}const ca=k.create();k=Object.freeze({__proto__:null,copy:r,set:l,identity:h,transpose:d,invert:c,adjoint:e,determinant:f,multiply:g,translate:p,scale:n,rotate:w,
rotateX:q,rotateY:m,rotateZ:u,fromTranslation:v,fromScaling:y,fromRotation:B,fromXRotation:x,fromYRotation:C,fromZRotation:z,fromRotationTranslation:A,fromQuat2:t,getTranslation:D,getScaling:E,getRotation:G,fromRotationTranslationScale:H,fromRotationTranslationScaleOrigin:I,fromQuat:J,frustum:K,perspective:L,perspectiveFromFieldOfView:S,ortho:M,lookAt:T,targetTo:O,str:Q,frob:F,add:N,subtract:P,multiplyScalar:U,multiplyScalarAndAdd:V,exactEquals:W,equals:X,mul:g,sub:P});b.add=N;b.adjoint=e;b.copy=
r;b.determinant=f;b.equals=X;b.exactEquals=W;b.frob=F;b.fromQuat=J;b.fromQuat2=t;b.fromRotation=B;b.fromRotationTranslation=A;b.fromRotationTranslationScale=H;b.fromRotationTranslationScaleOrigin=I;b.fromScaling=y;b.fromTranslation=v;b.fromXRotation=x;b.fromYRotation=C;b.fromZRotation=z;b.frustum=K;b.getRotation=G;b.getScaling=E;b.getTranslation=D;b.identity=h;b.invert=c;b.lookAt=T;b.mat4=k;b.mul=g;b.multiply=g;b.multiplyScalar=U;b.multiplyScalarAndAdd=V;b.ortho=M;b.perspective=L;b.perspectiveFromFieldOfView=
S;b.rotate=w;b.rotateX=q;b.rotateY=m;b.rotateZ=u;b.scale=n;b.set=l;b.str=Q;b.sub=P;b.subtract=P;b.targetTo=O;b.translate=p;b.transpose=d})},"esri/chunks/pe":function(){define("require exports ./_rollupPluginBabelHelpers ../core/has ../core/promiseUtils ../assets".split(" "),function(b,k,a,r,l,h){function d(){return!!k._pe}function c(){return!!r("esri-wasm")}function e(){return q?q:q=l.create((u,v)=>{(new Promise(function(y,B){b(["./pe-wasm"],y,B)})).then(function(y){return y.peWasm}).then(({default:y})=>
{y({locateFile:B=>h.getAssetUrl(`esri/geometry/support/${B}`),onAbort:B=>{v(Error(B))}}).then(B=>{f(B);u()})})})}function f(u){function v(x,C,z){x[C]=z(x[C])}k._pe=u;k.PeDefs.init();k.PeGTlistExtended.init();k.PeNotationMgrs.init();k.PeNotationUtm.init();k.PePCSInfo.init();k.PeGCSExtent=function(x){function C(){return x.apply(this,arguments)||this}a._inheritsLoose(C,x);C.prototype.destroy=function(){k._pe.destroy(this)};return C}(k._pe.PeGCSExtent);u=[k._pe.PeDatum,k._pe.PeGeogcs,k._pe.PeGeogtran,
k._pe.PeObject,k._pe.PeParameter,k._pe.PePrimem,k._pe.PeProjcs,k._pe.PeSpheroid,k._pe.PeUnit];for(var y of u)v(y.prototype,"getName",x=>function(){return x.call(this,Array(k.PeDefs.PE_NAME_MAX))});for(const x of[k._pe.PeGeogtran,k._pe.PeProjcs])v(x.prototype,"getParameters",C=>function(){const z=Array(k.PeDefs.PE_PARM_MAX);let A=C.call(this);for(let t=0;t<z.length;t++){const D=k._pe.getValue(A,"*");z[t]=D?k._pe.wrapPointer(D,k._pe.PeParameter):null;A+=Int32Array.BYTES_PER_ELEMENT}return z});v(k._pe.PeHorizon.prototype,
"getCoord",x=>function(){const C=this.getSize();if(!C)return null;const z=[],A=x.call(this);w(z,C,A);return z});v(k._pe.PeGTlistExtendedEntry.prototype,"getEntries",x=>{const C=k._pe._pe_getPeGTlistExtendedGTsSize();return function(){let z=null;var A=x.call(this);if(!k._pe.compare(A,k._pe.NULL)){z=[A];const t=this.getSteps();if(1<t){A=k._pe.getPointer(A);for(let D=1;D<t;D++)z.push(k._pe.wrapPointer(A+C*D,k._pe.PeGTlistExtendedGTs))}}return z}});const B=k._pe._pe_getPeHorizonSize();y=x=>function(){let C=
this._cache;C||(this._cache=C=new Map);if(C.has(x))return C.get(x);let z=null;var A=x.call(this);if(!k._pe.compare(A,k._pe.NULL)){z=[A];const t=A.getNump();if(1<t){A=k._pe.getPointer(A);for(let D=1;D<t;D++)z.push(k._pe.wrapPointer(A+B*D,k._pe.PeHorizon))}}C.set(x,z);return z};v(k._pe.PeProjcs.prototype,"horizonGcsGenerate",y);v(k._pe.PeProjcs.prototype,"horizonPcsGenerate",y);k._pe.PeObject.prototype.toString=function(x=k.PeDefs.PE_STR_OPTS_NONE){k._pe.ensureCache.prepare();const C=k._pe.getPointer(this),
z=k._pe.ensureInt8(Array(k.PeDefs.PE_BUFFER_MAX));return k._pe.UTF8ToString(k._pe._pe_object_to_string_ext(C,x,z))}}function g(u){if(u){var v=k._pe.getClass(u);v&&(v=k._pe.getCache(v))&&(u=k._pe.getPointer(u))&&delete v[u]}}function p(u,v){const y=[];v=Array(v);for(let B=0;B<u;B++)y.push(k._pe.ensureInt8(v));return y}function n(u){let v;Array.isArray(u[0])?(v=[],u.forEach(y=>{v.push(y[0],y[1])})):v=u;return v}function w(u,v,y,B=!1){if(B)for(B=0;B<2*v;B++)u[B]=k._pe.getValue(y+B*Float64Array.BYTES_PER_ELEMENT,
"double");else{B=0===u.length;for(let x=0;x<v;x++)B&&(u[x]=Array(2)),u[x][0]=k._pe.getValue(y,"double"),u[x][1]=k._pe.getValue(y+Float64Array.BYTES_PER_ELEMENT,"double"),y+=2*Float64Array.BYTES_PER_ELEMENT}}let q;k._pe=null;(function(u){function v(x,C,z){k._pe.ensureCache.prepare();var A=n(z);const t=z===A;A=k._pe.ensureFloat64(A);(x=k._pe._pe_geog_to_proj(k._pe.getPointer(x),C,A))&&w(z,C,A,t);return x}function y(x,C,z){return B(x,C,z,0)}function B(x,C,z,A){k._pe.ensureCache.prepare();var t=n(z);
const D=z===t;t=k._pe.ensureFloat64(t);(x=k._pe._pe_proj_to_geog_center(k._pe.getPointer(x),C,t,A))&&w(z,C,t,D);return x}u.geogToProj=v;u.projGeog=function(x,C,z,A){switch(A){case k.PeDefs.PE_TRANSFORM_P_TO_G:return y(x,C,z);case k.PeDefs.PE_TRANSFORM_G_TO_P:return v(x,C,z)}return 0};u.projToGeog=y;u.projToGeogCenter=B})(k.PeCSTransformations||(k.PeCSTransformations={}));(function(u){u.init=function(){u.PE_BUFFER_MAX=k._pe.PeDefs.prototype.PE_BUFFER_MAX;u.PE_NAME_MAX=k._pe.PeDefs.prototype.PE_NAME_MAX;
u.PE_MGRS_MAX=k._pe.PeDefs.prototype.PE_MGRS_MAX;u.PE_USNG_MAX=k._pe.PeDefs.prototype.PE_USNG_MAX;u.PE_DD_MAX=k._pe.PeDefs.prototype.PE_DD_MAX;u.PE_DDM_MAX=k._pe.PeDefs.prototype.PE_DDM_MAX;u.PE_DMS_MAX=k._pe.PeDefs.prototype.PE_DMS_MAX;u.PE_UTM_MAX=k._pe.PeDefs.prototype.PE_UTM_MAX;u.PE_PARM_MAX=k._pe.PeDefs.prototype.PE_PARM_MAX;u.PE_TYPE_NONE=k._pe.PeDefs.prototype.PE_TYPE_NONE;u.PE_TYPE_GEOGCS=k._pe.PeDefs.prototype.PE_TYPE_GEOGCS;u.PE_TYPE_PROJCS=k._pe.PeDefs.prototype.PE_TYPE_PROJCS;u.PE_TYPE_GEOGTRAN=
k._pe.PeDefs.prototype.PE_TYPE_GEOGTRAN;u.PE_TYPE_COORDSYS=k._pe.PeDefs.prototype.PE_TYPE_COORDSYS;u.PE_TYPE_UNIT=k._pe.PeDefs.prototype.PE_TYPE_UNIT;u.PE_STR_OPTS_NONE=k._pe.PeDefs.prototype.PE_STR_OPTS_NONE;u.PE_STR_AUTH_NONE=k._pe.PeDefs.prototype.PE_STR_AUTH_NONE;u.PE_STR_AUTH_TOP=k._pe.PeDefs.prototype.PE_STR_AUTH_TOP;u.PE_STR_NAME_CANON=k._pe.PeDefs.prototype.PE_STR_NAME_CANON;u.PE_PARM_X0=k._pe.PeDefs.prototype.PE_PARM_X0;u.PE_PARM_ND=k._pe.PeDefs.prototype.PE_PARM_ND;u.PE_TRANSFORM_1_TO_2=
k._pe.PeDefs.prototype.PE_TRANSFORM_1_TO_2;u.PE_TRANSFORM_2_TO_1=k._pe.PeDefs.prototype.PE_TRANSFORM_2_TO_1;u.PE_TRANSFORM_P_TO_G=k._pe.PeDefs.prototype.PE_TRANSFORM_P_TO_G;u.PE_TRANSFORM_G_TO_P=k._pe.PeDefs.prototype.PE_TRANSFORM_G_TO_P;u.PE_HORIZON_RECT=k._pe.PeDefs.prototype.PE_HORIZON_RECT;u.PE_HORIZON_POLY=k._pe.PeDefs.prototype.PE_HORIZON_POLY;u.PE_HORIZON_LINE=k._pe.PeDefs.prototype.PE_HORIZON_LINE;u.PE_HORIZON_DELTA=k._pe.PeDefs.prototype.PE_HORIZON_DELTA}})(k.PeDefs||(k.PeDefs={}));(function(u){function v(C,
z){let A=null,t=B[C];t||(t={},B[C]=t);t.hasOwnProperty(String(z))?A=t[z]:(C=k._pe.PeFactory.prototype.factoryByType(C,z),k._pe.compare(C,k._pe.NULL)||(A=C,t[z]=A));return A=y(A)}function y(C){if(C){const z=C.getType();switch(z){case k.PeDefs.PE_TYPE_GEOGCS:C=k._pe.castObject(C,k._pe.PeGeogcs);break;case k.PeDefs.PE_TYPE_PROJCS:C=k._pe.castObject(C,k._pe.PeProjcs);break;case k.PeDefs.PE_TYPE_GEOGTRAN:C=k._pe.castObject(C,k._pe.PeGeogtran);break;default:z&k.PeDefs.PE_TYPE_UNIT&&(C=k._pe.castObject(C,
k._pe.PeUnit))}}return C}const B={},x={};u.initialize=function(){k._pe.PeFactory.prototype.initialize(null)};u.coordsys=function(C){return v(k.PeDefs.PE_TYPE_COORDSYS,C)};u.factoryByType=v;u.fromString=function(C,z){let A=null,t=x[C];t||(t={},x[C]=t);t.hasOwnProperty(z)?A=t[z]:(C=k._pe.PeFactory.prototype.fromString(C,z),k._pe.compare(C,k._pe.NULL)||(A=C,t[z]=A));return A=y(A)};u.geogcs=function(C){return v(k.PeDefs.PE_TYPE_GEOGCS,C)};u.geogtran=function(C){return v(k.PeDefs.PE_TYPE_GEOGTRAN,C)};
u.getCode=function(C){return k._pe.PeFactory.prototype.getCode(C)};u.projcs=function(C){return v(k.PeDefs.PE_TYPE_PROJCS,C)};u.unit=function(C){return v(k.PeDefs.PE_TYPE_UNIT,C)}})(k.PeFactory||(k.PeFactory={}));k.PeGCSExtent=null;(function(u){let v;u.init=function(){u.PE_GTLIST_OPTS_COMMON=k._pe.PeGTlistExtended.prototype.PE_GTLIST_OPTS_COMMON;v=k._pe._pe_getPeGTlistExtendedEntrySize()};u.getGTlist=function(y,B,x,C,z,A){let t=null;const D=new k._pe.PeInteger(A);try{const E=k._pe.PeGTlistExtended.prototype.getGTlist(y,
B,x,C,z,D);if(A=D.val)if(t=[E],1<A){const G=k._pe.getPointer(E);for(y=1;y<A;y++)t.push(k._pe.wrapPointer(G+v*y,k._pe.PeGTlistExtendedEntry))}}finally{k._pe.destroy(D)}return t}})(k.PeGTlistExtended||(k.PeGTlistExtended={}));(function(u){u.destroy=function(v){if(v&&v.length){for(const y of v)g(y),y.getEntries().forEach(B=>{g(B);B=B.getGeogtran();g(B);B.getParameters().forEach(g);[B.getGeogcs1(),B.getGeogcs2()].forEach(x=>{g(x);const C=x.getDatum();g(C);g(C.getSpheroid());g(x.getPrimem());g(x.getUnit())})});
k._pe.PeGTlistExtendedEntry.prototype.Delete(v[0])}}})(k.PeGTlistExtendedEntry||(k.PeGTlistExtendedEntry={}));(function(u){u.geogToGeog=function(v,y,B,x,C){k._pe.ensureCache.prepare();var z=n(B);const A=B===z;z=k._pe.ensureFloat64(z);let t=0;x&&(t=k._pe.ensureFloat64(x));(v=k._pe._pe_geog_to_geog(k._pe.getPointer(v),y,z,t,C))&&w(B,y,z,A);return v}})(k.PeGTTransformations||(k.PeGTTransformations={}));(function(u){function v(B,x,C,z,A,t){k._pe.ensureCache.prepare();switch(B){case "dd":var D=k._pe._pe_geog_to_dd;
var E=k.PeDefs.PE_DD_MAX;break;case "ddm":D=k._pe._pe_geog_to_ddm;E=k.PeDefs.PE_DDM_MAX;break;case "dms":D=k._pe._pe_geog_to_dms,E=k.PeDefs.PE_DMS_MAX}B=0;x&&(B=k._pe.getPointer(x));x=n(z);x=k._pe.ensureFloat64(x);E=p(C,E);z=k._pe.ensureInt32(E);if(A=D(B,C,x,A,z))for(D=0;D<C;D++)t[D]=k._pe.UTF8ToString(E[D]);return A}function y(B,x,C,z,A){k._pe.ensureCache.prepare();switch(B){case "dd":var t=k._pe._pe_dd_to_geog;break;case "ddm":t=k._pe._pe_ddm_to_geog;break;case "dms":t=k._pe._pe_dms_to_geog}B=0;
x&&(B=k._pe.getPointer(x));x=z.map(D=>k._pe.ensureString(D));z=k._pe.ensureInt32(x);x=k._pe.ensureFloat64(Array(2*C));(t=t(B,C,z,x))&&w(A,C,x);return t}u.geog_to_dms=function(B,x,C,z,A){return v("dms",B,x,C,z,A)};u.dms_to_geog=function(B,x,C,z){return y("dms",B,x,C,z)};u.geog_to_ddm=function(B,x,C,z,A){return v("ddm",B,x,C,z,A)};u.ddm_to_geog=function(B,x,C,z){return y("ddm",B,x,C,z)};u.geog_to_dd=function(B,x,C,z,A){return v("dd",B,x,C,z,A)};u.dd_to_geog=function(B,x,C,z){return y("dd",B,x,C,z)}})(k.PeNotationDms||
(k.PeNotationDms={}));(function(u){u.init=function(){u.PE_MGRS_STYLE_NEW=k._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_NEW;u.PE_MGRS_STYLE_OLD=k._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_OLD;u.PE_MGRS_STYLE_AUTO=k._pe.PeNotationMgrs.prototype.PE_MGRS_STYLE_AUTO;u.PE_MGRS_180_ZONE_1_PLUS=k._pe.PeNotationMgrs.prototype.PE_MGRS_180_ZONE_1_PLUS;u.PE_MGRS_ADD_SPACES=k._pe.PeNotationMgrs.prototype.PE_MGRS_ADD_SPACES};u.geog_to_mgrs_extended=function(v,y,B,x,C,z,A){k._pe.ensureCache.prepare();let t=0;v&&
(t=k._pe.getPointer(v));v=n(B);B=k._pe.ensureFloat64(v);v=p(y,k.PeDefs.PE_MGRS_MAX);const D=k._pe.ensureInt32(v);if(x=k._pe._pe_geog_to_mgrs_extended(t,y,B,x,C,z,D))for(C=0;C<y;C++)A[C]=k._pe.UTF8ToString(v[C]);return x};u.mgrs_to_geog_extended=function(v,y,B,x,C){k._pe.ensureCache.prepare();let z=0;v&&(z=k._pe.getPointer(v));v=B.map(A=>k._pe.ensureString(A));B=k._pe.ensureInt32(v);v=k._pe.ensureFloat64(Array(2*y));(x=k._pe._pe_mgrs_to_geog_extended(z,y,B,x,v))&&w(C,y,v);return x}})(k.PeNotationMgrs||
(k.PeNotationMgrs={}));(function(u){u.geog_to_usng=function(v,y,B,x,C,z,A){k._pe.ensureCache.prepare();let t=0;v&&(t=k._pe.getPointer(v));v=n(B);B=k._pe.ensureFloat64(v);v=p(y,k.PeDefs.PE_MGRS_MAX);const D=k._pe.ensureInt32(v);if(x=k._pe._pe_geog_to_usng(t,y,B,x,C,z,D))for(C=0;C<y;C++)A[C]=k._pe.UTF8ToString(v[C]);return x};u.usng_to_geog=function(v,y,B,x){k._pe.ensureCache.prepare();var C=0;v&&(C=k._pe.getPointer(v));v=B.map(z=>k._pe.ensureString(z));B=k._pe.ensureInt32(v);v=k._pe.ensureFloat64(Array(2*
y));(C=k._pe._pe_usng_to_geog(C,y,B,v))&&w(x,y,v);return C}})(k.PeNotationUsng||(k.PeNotationUsng={}));(function(u){u.init=function(){u.PE_UTM_OPTS_NONE=k._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NONE;u.PE_UTM_OPTS_ADD_SPACES=k._pe.PeNotationUtm.prototype.PE_UTM_OPTS_ADD_SPACES;u.PE_UTM_OPTS_NS=k._pe.PeNotationUtm.prototype.PE_UTM_OPTS_NS};u.geog_to_utm=function(v,y,B,x,C){k._pe.ensureCache.prepare();var z=0;v&&(z=k._pe.getPointer(v));v=n(B);B=k._pe.ensureFloat64(v);v=p(y,k.PeDefs.PE_UTM_MAX);const A=
k._pe.ensureInt32(v);if(x=k._pe._pe_geog_to_utm(z,y,B,x,A))for(z=0;z<y;z++)C[z]=k._pe.UTF8ToString(v[z]);return x};u.utm_to_geog=function(v,y,B,x,C){k._pe.ensureCache.prepare();let z=0;v&&(z=k._pe.getPointer(v));v=B.map(A=>k._pe.ensureString(A));B=k._pe.ensureInt32(v);v=k._pe.ensureFloat64(Array(2*y));(x=k._pe._pe_utm_to_geog(z,y,B,x,v))&&w(C,y,v);return x}})(k.PeNotationUtm||(k.PeNotationUtm={}));(function(u){const v=new Map;u.init=function(){u.PE_PCSINFO_OPTION_NONE=k._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_NONE;
u.PE_PCSINFO_OPTION_DOMAIN=k._pe.PePCSInfo.prototype.PE_PCSINFO_OPTION_DOMAIN;u.PE_POLE_OUTSIDE_BOUNDARY=k._pe.PePCSInfo.prototype.PE_POLE_OUTSIDE_BOUNDARY;u.PE_POLE_POINT=k._pe.PePCSInfo.prototype.PE_POLE_POINT};u.generate=function(y,B=u.PE_PCSINFO_OPTION_DOMAIN){let x,C;v.has(y)&&(C=v.get(y),C[B]&&(x=C[B]));x||(x=k._pe.PePCSInfo.prototype.generate(y,B),C||(C=[],v.set(y,C)),C[B]=x);return x}})(k.PePCSInfo||(k.PePCSInfo={}));(function(u){u.version_string=function(){return k._pe.PeVersion.prototype.version_string()}})(k.PeVersion||
(k.PeVersion={}));var m=Object.freeze({__proto__:null,get _pe(){return k._pe},isLoaded:d,isSupported:c,load:e,get PeCSTransformations(){return k.PeCSTransformations},get PeDefs(){return k.PeDefs},get PeFactory(){return k.PeFactory},get PeGCSExtent(){return k.PeGCSExtent},get PeGTlistExtended(){return k.PeGTlistExtended},get PeGTlistExtendedEntry(){return k.PeGTlistExtendedEntry},get PeGTTransformations(){return k.PeGTTransformations},get PeNotationDms(){return k.PeNotationDms},get PeNotationMgrs(){return k.PeNotationMgrs},
get PeNotationUsng(){return k.PeNotationUsng},get PeNotationUtm(){return k.PeNotationUtm},get PePCSInfo(){return k.PePCSInfo},get PeVersion(){return k.PeVersion},_init:f});k._init=f;k.isLoaded=d;k.isSupported=c;k.load=e;k.pe=m})},"esri/geometry/support/geodesicConstants":function(){define(["exports","./Ellipsoid"],function(b,k){const a=Math.PI/180;var r=k.earth.radius;const l=k.earth.eccentricitySquared;r={a1:r*l,a2:r*l*r*l,a3:r*l*l/2,a4:r*l*r*l*2.5,a5:r*l+r*l*l/2,a6:1-l};k={4326:{a:k.earth.radius,
f:k.earth.flattening},104900:{a:2439700,f:0},104901:{a:6051E3,f:0},104902:{a:6051800,f:0},104903:{a:k.moon.radius,f:k.moon.flattening},104904:{a:3393400,f:.005207166853303471},104905:{a:k.mars.radius,f:k.mars.flattening},104906:{a:6200,f:0},104907:{a:11100,f:0},104908:{a:71492E3,f:.06487439154031222},104909:{a:8200,f:0},104910:{a:83500,f:0},104911:{a:1E4,f:0},104912:{a:2409300,f:0},104913:{a:15E3,f:0},104914:{a:4E4,f:0},104915:{a:1562090,f:0},104916:{a:2632345,f:0},104917:{a:85E3,f:0},104918:{a:1821460,
f:0},104919:{a:5E3,f:0},104920:{a:12E3,f:0},104921:{a:3E4,f:3},104922:{a:18E3,f:0},104923:{a:14E3,f:0},104924:{a:49300,f:0},104925:{a:60268E3,f:.09796243445941462},104926:{a:16E3,f:0},104927:{a:9500,f:0},104928:{a:56E4,f:0},104929:{a:249400,f:0},104930:{a:59500,f:0},104931:{a:16E3,f:0},104932:{a:133E3,f:0},104933:{a:718E3,f:0},104934:{a:888E3,f:0},104935:{a:1986300,f:0},104936:{a:1E4,f:0},104937:{a:41900,f:0},104938:{a:11E4,f:0},104939:{a:50100,f:0},104940:{a:764E3,f:0},104941:{a:11E3,f:0},104942:{a:529800,
f:0},104943:{a:2575E3,f:0},104944:{a:25559E3,f:.022927344575296365},104945:{a:578900,f:0},104946:{a:33E3,f:0},104947:{a:21E3,f:0},104948:{a:13E3,f:0},104949:{a:31E3,f:0},104950:{a:27E3,f:0},104951:{a:42E3,f:0},104952:{a:235800,f:0},104953:{a:761400,f:0},104954:{a:15E3,f:0},104955:{a:54E3,f:0},104956:{a:77E3,f:0},104957:{a:27E3,f:0},104958:{a:788900,f:0},104959:{a:584700,f:0},104960:{a:24764E3,f:.01708124697141011},104961:{a:74E3,f:0},104962:{a:79E3,f:0},104963:{a:104E3,f:.14423076923076922},104964:{a:29E3,
f:0},104965:{a:17E4,f:0},104966:{a:208E3,f:0},104967:{a:4E4,f:0},104968:{a:1352600,f:0},104969:{a:1195E3,f:0},104970:{a:593E3,f:0},104971:{a:k.mars.radius,f:0},104972:{a:47E4,f:0},104973:{a:255E3,f:0},104974:{a:2439400,f:0}};b.WKT_SPHEROID_REGEX=/SPHEROID\[([^\]]+)]/i;b.earthEllipsoidConstants=r;b.spheroids=k;b.toRadians=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/geometry/support/GeographicTransformation":function(){define(["./GeographicTransformationStep"],function(b){return function(){function k(r){this.steps=
[];this._cached_projection={};this._chain="";this._gtlistentry=null;if(r&&r.steps)for(const l of r.steps)l instanceof b?this.steps.push(l):this.steps.push(new b({wkid:l.wkid,wkt:l.wkt,isInverse:l.isInverse}))}k.cacheKey=function(r,l){return[void 0!==r.wkid&&null!==r.wkid?r.wkid.toString():"-1",void 0!==r.wkt&&null!==r.wkt?r.wkt.toString():"",void 0!==l.wkid&&null!==l.wkid?l.wkid.toString():"-1",void 0!==l.wkt&&null!==l.wkt?l.wkt.toString():""].join()};k.fromGE=function(r){const l=new k;let h="";for(const d of r.steps)r=
b.fromGE(d),l.steps.push(r),h+=r.uid.toString()+",";l._cached_projection={};l._gtlistentry=null;l._chain=h;return l};var a=k.prototype;a.getInverse=function(){const r=new k;r.steps=[];for(let l=this.steps.length-1;0<=l;l--)r.steps.push(this.steps[l].getInverse());return r};a.getGTListEntry=function(){let r="";for(const l of this.steps)r+=l.uid.toString()+",";r!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=r);return this._gtlistentry};a.assignCachedGe=function(r,l,h){this._cached_projection[k.cacheKey(r,
l)]=h};a.getCachedGeTransformation=function(r,l){let h="";for(const d of this.steps)h+=d.uid.toString()+",";h!==this._chain&&(this._gtlistentry=null,this._cached_projection={},this._chain=h);r=this._cached_projection[k.cacheKey(r,l)];return void 0===r?null:r};return k}()})},"esri/geometry/support/GeographicTransformationStep":function(){define(["../../chunks/_rollupPluginBabelHelpers"],function(b){let k=0;return function(){function a(r=null){this.uid=k++;r?(this._wkt=void 0!==r.wkt?r.wkt:null,this._wkid=
void 0!==r.wkid?r.wkid:-1,this._isInverse=void 0!==r.isInverse?!0===r.isInverse:!1):(this._wkt=null,this._wkid=-1,this._isInverse=!1)}a.fromGE=function(r){const l=new a;l._wkt=r.wkt;l._wkid=r.wkid;l._isInverse=r.isInverse;return l};a.prototype.getInverse=function(){const r=new a;r._wkt=this.wkt;r._wkid=this._wkid;r._isInverse=!this.isInverse;return r};b._createClass(a,[{key:"wkt",get:function(){return this._wkt},set:function(r){this._wkt=r;this.uid=k++}},{key:"wkid",get:function(){return this._wkid},
set:function(r){this._wkid=r;this.uid=k++}},{key:"isInverse",get:function(){return this._isInverse},set:function(r){this._isInverse=r;this.uid=k++}}]);return a}()})},"esri/views/support/spatialReferenceSupport":function(){define(["exports"],function(b){b.isSpatialReferenceSupported=function(k,a){return null==k?!1:"2d"===a?!0:"local"===a?!k.isGeographic:k.isWebMercator||k.isWGS84||4490===k.wkid||104971===k.wkid||104905===k.wkid||104903===k.wkid};Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport ./Lighting ./background/utils".split(" "),function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){var m;a=(u,v,y)=>({enabled:!y||!y.isPresentation});
n=m=function(u){function v(B){B=u.call(this,B)||this;B.lighting=new w;B.background=null;B.atmosphereEnabled=!0;B.starsEnabled=!0;return B}b._inheritsLoose(v,u);var y=v.prototype;y.clone=function(){return new m(this.cloneConstructProperties())};y.cloneConstructProperties=function(){return{lighting:w.prototype.clone.call(this.lighting),background:r.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled}};return v}(n.JSONSupport);k.__decorate([d.property({type:w,
json:{write:!0}})],n.prototype,"lighting",void 0);k.__decorate([d.property(q.backgroundProperty)],n.prototype,"background",void 0);k.__decorate([d.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],n.prototype,"atmosphereEnabled",void 0);k.__decorate([d.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:a}}})],n.prototype,"starsEnabled",void 0);return n=m=k.__decorate([e.subclass("esri.webscene.Environment")],n)})},"esri/webscene/Lighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){var q;a=q=function(m){function u(y){y=m.call(this,y)||this;y.date=null;y.directShadowsEnabled=!1;y.displayUTCOffset=null;return y}b._inheritsLoose(u,m);var v=u.prototype;v.readDate=function(y,B){return null!=B.datetime&&new Date(B.datetime)||null};v.writeDate=function(y,B,x){B[x]=y.getTime()};v.readDirectShadowsEnabled=function(y,B){return!!B.directShadows};v.writedirectShadowsEnabled=function(y,B,x){y&&(B[x]=y)};v.writeDisplayUTCOffset=function(y,B){null!=y&&
(B.displayUTCOffset=y)};v.clone=function(){return new q(this.cloneConstructProperties())};v.cloneConstructProperties=function(){const y={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(y.date=new Date(this.date.getTime()));return y};return u}(w.JSONSupport);k.__decorate([h.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],a.prototype,"date",void 0);k.__decorate([c.reader("date",["datetime"])],
a.prototype,"readDate",null);k.__decorate([f.writer("date")],a.prototype,"writeDate",null);k.__decorate([h.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],a.prototype,"directShadowsEnabled",void 0);k.__decorate([c.reader("directShadowsEnabled",["directShadows"])],a.prototype,"readDirectShadowsEnabled",null);k.__decorate([f.writer("directShadowsEnabled")],a.prototype,"writedirectShadowsEnabled",null);k.__decorate([h.property({type:Number,json:{write:!0}})],a.prototype,"displayUTCOffset",
void 0);k.__decorate([f.writer("displayUTCOffset")],a.prototype,"writeDisplayUTCOffset",null);return a=q=k.__decorate([e.subclass("esri.webscene.Lighting")],a)})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(b,k,a){k={base:k,key:"type",typeMap:{color:a}};k={types:k,json:{read:function(r){return(l,h,d)=>{if(!l)return l;for(const c in r.typeMap)if(l.type===c)return h=new r.typeMap[c],h.read(l,d),h}}(k),write:{overridePolicy:(r,l,h)=>({enabled:!h||
!h.isPresentation})}}};b.backgroundProperty=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p){a=function(n){function w(q){return n.call(this,q)||this}b._inheritsLoose(w,n);w.prototype.clone=function(){};return w}(p.JSONSupport);k.__decorate([h.property({readOnly:!0,json:{read:!1}})],a.prototype,"type",void 0);return a=k.__decorate([c.subclass("esri.webscene.background.Background")],a)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../Color ../../symbols/support/materialUtils ./Background".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){var q;a={...n.colorAndTransparencyProperty,nonNullable:!0};w=q=function(m){function u(y){y=m.call(this,y)||this;y.type="color";y.color=new p([0,0,0,1]);return y}b._inheritsLoose(u,m);var v=u.prototype;v.clone=function(){return new q(this.cloneProperties())};v.cloneProperties=function(){return{color:this.color.clone()}};return u}(w);k.__decorate([d.enumeration({color:"color"},{readOnly:!0})],w.prototype,"type",void 0);k.__decorate([h.property(a)],w.prototype,"color",
void 0);return w=q=k.__decorate([c.subclass("esri.webscene.background.ColorBackground")],w)})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils"],function(b,k,a){function r(q,m){const {format:u,quality:v,rotation:y,disableDecorations:B}=q||{};var x=e(q,m.padding);var C=m.width-x.left-x.right;m=m.height-x.top-x.bottom;x={x:0,y:0,width:C,height:m};if(q&&q.area){null!=q.area.x&&(x.x=Math.floor(q.area.x));null!=q.area.y&&(x.y=Math.floor(q.area.y));
var z=null!=q.area.width?Math.floor(q.area.width):null,A=null!=q.area.height?Math.floor(q.area.height):null;x.width=C-x.x;x.height=m-x.y;null!=z&&null!=A?(x.width=Math.min(x.width,z),x.height=Math.min(x.height,A)):null==z&&null!=A?(z=Math.min(x.width,z),x.height*=z/x.width,x.width=z):null!=z&&null==A&&(z=Math.min(x.height,A),x.width*=z/x.height,x.height=z)}x=c(x,q);z=Math.floor(Math.max(x.x,0));A=Math.floor(Math.max(x.y,0));C={x:z,y:A,width:Math.floor(Math.min(x.width,C-z)),height:Math.floor(Math.min(x.height,
m-A))};m=C.width/C.height;x=x.width/x.height;x!==m&&(x>m?(m=Math.floor(C.width/x),C={x:C.x,y:Math.floor(C.y+(C.height-m)/2),width:C.width,height:m}):(m=Math.floor(C.height*x),C={x:Math.floor(C.x+(C.width-m)/2),y:C.y,width:m,height:C.height}));const {width:t,height:D}=d(q,C);a:switch(u){case "png":case "jpg":case "jpeg":m=u;break a;case null:case void 0:m="png";break a;default:m="png"}x=n[m];x=a.clamp(null!=v?v:x,0,100);return{format:m,quality:x,area:C,width:t,height:D,rotation:y,disableDecorations:!!B,
ignoreBackground:!(!q||!q.ignoreBackground),ignorePadding:!(!q||!q.ignorePadding)}}function l(q,m){return q.toDataURL(p[m.format],m.quality/100)}function h(q,m,u){u||(f||(f=document.createElement("canvas"),f.width=1,f.height=1),u=f);return u.getContext("2d").createImageData(q,m)}function d(q,m){if(!q)return m;const u=q.width;q=q.height;if(null!=u&&null!=q)return{width:Math.floor(u),height:Math.floor(q)};if(null==u&&null==q)return m;m=m.width/m.height;return null==q?{width:Math.floor(u),height:Math.floor(u/
m)}:{width:Math.floor(q*m),height:Math.floor(q)}}function c(q,m){if(!m||null==m.width||null==m.height)return q;m=m.width/m.height;const u=q.width/q.height;if(u===m)return q;if(u<m)return m=Math.floor(q.height*m),q.x-=(m-q.width)/2,q.width=m,q;m=Math.floor(q.width/m);q.y-=(m-q.height)/2;q.height=m;return q}function e(q,m){return!m||q&&q.ignorePadding?w:m}let f=null,g=!0;const p={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},n={png:100,jpg:98,jpeg:98},w={top:0,right:0,bottom:0,left:0};b.completeUserSettings=
r;b.createEmptyImageData=function(q,m,u){if(!q||!m)throw Error("Cannot construct image data without dimensions");if(g)try{return new ImageData(q,m)}catch(v){g=!1}return h(q,m,u)};b.encodeResult=function(q,m,u,v){if(v.premultipliedAlpha){{var y=q.data;const x=y.length;for(let C=0;C<x;C+=4){var B=y[C+3];0<B&&(B/=255,y[C+0]/=B,y[C+1]/=B,y[C+2]/=B)}}}u.width=q.width;u.height=q.height;y=u.getContext("2d");y.putImageData(q,0,0);v.flipY&&(y.save(),y.globalCompositeOperation="copy",y.scale(1,-1),y.translate(0,
-y.canvas.height),y.drawImage(y.canvas,0,0),y.restore());q=y.getImageData(0,0,q.width,q.height);m=l(u,m);u.width=0;u.height=0;return{dataUrl:m,data:q}};b.resampleHermite=function(q,m,u,v=0,y=0,B=q.width-v,x=q.height-y,C=!1){const {data:z}=q,{width:A,height:t,data:D}=m;B/=A;x/=t;const E=Math.ceil(B/2),G=Math.ceil(x/2);q=q.width;for(let J=0;J<t;J++)for(let K=0;K<A;K++){const L=4*(K+(C?t-J-1:J)*A);let S=0,M=0,T=0,O=0,Q=0,F=0;const N=(J+.5)*x;for(let P=Math.floor(J*x);P<(J+1)*x;P++){var H=Math.abs(N-
(P+.5))/G;const U=(K+.5)*B;H*=H;for(let V=Math.floor(K*B);V<(K+1)*B;V++){var I=Math.abs(U-(V+.5))/E;I=Math.sqrt(H+I*I);if(1<=I)continue;I=2*I*I*I-3*I*I+1;const W=4*(v+V+(y+P)*q);F+=I*z[W+3];M+=I;!u&&255>z[W+3]&&(I=I*z[W+3]/255);T+=I*z[W];O+=I*z[W+1];Q+=I*z[W+2];S+=I}}D[L]=T/S;D[L+1]=O/S;D[L+2]=Q/S;D[L+3]=F/M}return m};b.screenshotSuperSampleSettings=function(q,m,u){if(!m)return q;const {framebufferWidth:v,framebufferHeight:y,pixelRatio:B,region:x}=q;m=e(q,u);u=m.left+m.right;const C=m.top+m.bottom,
z=v-u,A=y-C,t=Math.min(8,Math.min((2048-u)/z,(2048-C)/A));return 1.5>t?q:{...q,framebufferWidth:Math.round(z*t)+u,framebufferHeight:Math.round(A*t)+C,pixelRatio:B*t,resample:{region:{x:Math.round((x.x-m.left)*t)+m.left,y:Math.round((x.y-m.top)*t)+m.top,width:Math.round(x.width*t),height:Math.round(x.height*t)},width:v,height:y}}};b.toDataUrl=l;b.toRenderSettings=function(q,m){const u=r(q,m),v=u.area,y=u.width/v.width,B=e(u,m.padding),x=B.left+B.right,C=B.top+B.bottom;return{framebufferWidth:Math.floor((m.width-
x)*y+x),framebufferHeight:Math.floor((m.height-C)*y+C),region:{x:Math.floor(v.x*y)+B.left,y:Math.floor(v.y*y)+B.top,width:u.width,height:u.height},format:u.format,quality:u.quality,rotation:u.rotation,pixelRatio:y,layers:q&&q.layers?q.layers:[],disableDecorations:u.disableDecorations,ignoreBackground:u.ignoreBackground,ignorePadding:u.ignorePadding}};b.wrapImageData=function(q,m,u,v){if(!m||!u)throw Error("Cannot construct image data without dimensions");if(g)try{return new ImageData(q,m,u)}catch(y){g=
!1}m=h(m,u,v);m.data.set(q,0);return m};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/unitUtils"],function(b,k){function a(r,l){l=k.getMetersPerUnitForSR(l);return r/(l*k.inchesPerMeter*96)}b.getExtentForScale=function(r,l){const h=r.extent;r=r.width;l=a(l,h.spatialReference);return h.clone().expand(l*r/h.width)};b.getResolutionForScale=a;b.getScale=function(r,l){l=l||r.extent;r=r.width;const h=k.getMetersPerUnitForSR(l&&
l.spatialReference);return l&&r?l.width/r*h*k.inchesPerMeter*96:0};b.getScaleForResolution=function(r,l){l=k.getMetersPerUnitForSR(l);return r*l*k.inchesPerMeter*96};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/support/layerUtils":function(){define(["exports"],function(b){b.areLabelsVisible=function(k){return!0===k.labelsVisible&&null!=k.labelingInfo&&0<k.labelingInfo.length};b.getLayersForScale=function(k,a){const r=[];if(0<k&&a)for(let l=0;l<a.length;l++)if(!(0<=a[l].parentLayerId&&
-1===r.indexOf(a[l].parentLayerId)&&a.some(function(h){return h.id===a[l].parentLayerId}))&&0<=a[l].id){let h=!0;const d=a[l].maxScale,c=a[l].minScale;if(0<d||0<c)0<d&&0<c?h=d<=k&&k<=c:0<d?h=d<=k:0<c&&(h=k<=c);h&&r.push(a[l].id)}return r};b.isBaseLayer=function(k){return k.parent&&"esri.Basemap"===k.parent.declaredClass&&-1<k.parent.baseLayers.indexOf(k)};b.isTiledLayer=function(k){return k&&"base-tile"===k.type||"tile"===k.type||"elevation"===k.type||"imagery-tile"===k.type||"base-elevation"===k.type||
"open-street-map"===k.type||"wcs"===k.type||"web-tile"===k.type||"wmts"===k.type||"vector-tile"===k.type};b.serializeLayerDefinitions=function(k){const a=/[:;]/,r=[];let l=!1;if(k&&(k.forEach(function(h,d){r.push([d,h]);!l&&a.test(h)&&(l=!0)}),0<r.length)){if(l){const h={};r.forEach(d=>{h[d[0]]=d[1]});k=JSON.stringify(h)}else{const h=[];r.forEach(d=>{h.push(d[0]+":"+d[1])});k=h.join(";")}return k}return null};b.serializeTimeOptions=function(k){if(k){var a=[];k.forEach(function(r,l){a.push('"'+l+'":'+
JSON.stringify(r))});if(a.length)return"{"+a.join(",")+"}"}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/ArrayPool ../core/Handles ../core/watchUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){function m(y,B){return B?u[y].valueToClassName[B].split(" "):[]}const u={widthBreakpoint:{getValue(y){const B=y.viewSize[0];y=y.breakpoints;const x=this.values;return B<=y.xsmall?x.xsmall:B<=y.small?x.small:B<=y.medium?x.medium:B<=y.large?x.large:x.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",
xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue(y){const B=y.viewSize[1];y=y.breakpoints;const x=this.values;return B<=y.xsmall?x.xsmall:B<=y.small?x.small:B<=y.medium?x.medium:B<=y.large?x.large:x.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",
xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue(y){y=y.viewSize;const B=this.values;return y[1]>=y[0]?B.portrait:B.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},v={xsmall:544,small:768,medium:992,large:1200};b.BreakpointsOwner=
y=>{y=function(B){function x(...z){z=B.call(this,...z)||this;z._breakpointsHandles=new w;z.orientation=null;z.widthBreakpoint=null;z.heightBreakpoint=null;z.breakpoints=v;return z}k._inheritsLoose(x,B);var C=x.prototype;C.initialize=function(){this._breakpointsHandles.add(q.init(this,["breakpoints","size"],this._updateClassNames))};C.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};C._updateClassNames=function(){if(this.container){var z=
n.acquire(),A=n.acquire(),t=!1,D;for(D in u){const E=this[D],G=u[D].getValue({viewSize:this.size,breakpoints:this.breakpoints});E!==G&&(t=!0,this[D]=G,m(D,E).forEach(H=>A.push(H)),m(D,G).forEach(H=>z.push(H)))}t&&(this._applyClassNameChanges(z,A),n.release(z),n.release(A))}};C._applyClassNameChanges=function(z,A){const t=this.container;t&&(A.forEach(D=>t.classList.remove(D)),z.forEach(D=>t.classList.add(D)))};C._removeActiveClassNames=function(){const z=this.container;if(z)for(var A in u)m(A,this[A]).forEach(t=>
z.classList.remove(t))};k._createClass(x,[{key:"breakpoints",set:function(z){var A=this._get("breakpoints");if(z!==A){A=(A=z)&&A.xsmall<A.small&&A.small<A.medium&&A.medium<A.large;if(!A){const t=JSON.stringify(v,null,2);console.warn("provided breakpoints are not valid, using defaults:"+t)}z=A?z:v;this._set("breakpoints",{...z})}}}]);return x}(y);a.__decorate([d.property()],y.prototype,"breakpoints",null);a.__decorate([d.property()],y.prototype,"orientation",void 0);a.__decorate([d.property()],y.prototype,
"widthBreakpoint",void 0);a.__decorate([d.property()],y.prototype,"heightBreakpoint",void 0);return y=a.__decorate([e.subclass("esri.views.BreakpointsOwner")],y)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../layers/graphics/dehydratedFeatures"],function(b,k){function a(r){return"array"in r}b.SamplePosition=function(r,l=0){this.array=r;this.offset=l};b.getElevationAtPoint=function(r,l,h="ground"){if(k.isDehydratedPoint(l))return r.getElevation(l.x,
l.y,l.z||0,l.spatialReference,h);if(a(l)){let d=l.offset;return r.getElevation(l.array[d++],l.array[d++],l.array[d]||0,r.spatialReference,h)}return r.getElevation(l[0],l[1],l[2]||0,r.spatialReference,h)};b.isSamplePosition=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/has ../../core/typedArrayUtil ../../core/maybe ../../geometry/SpatialReference ../../geometry/support/typeUtils ../../core/uid ../../geometry/support/aaBoundingRect ../support/Field ../../core/byteSizeEstimations ../../geometry/support/aaBoundingBox ../../geometry/support/quantizationUtils ./dehydratedFeatureComparison".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){function w(x,C,z){if(!x)return null;switch(C){case "point":return{x:x.x,y:x.y,z:x.z,m:x.m,hasZ:null!=x.z,hasM:null!=x.m,type:"point",spatialReference:z};case "polyline":return{paths:x.paths,hasZ:!!x.hasZ,hasM:!!x.hasM,type:"polyline",spatialReference:z};case "polygon":return{rings:x.rings,hasZ:!!x.hasZ,hasM:!!x.hasM,type:"polygon",spatialReference:z};case "multipoint":return{points:x.points,hasZ:!!x.hasZ,hasM:!!x.hasM,type:"multipoint",spatialReference:z}}}function q(x){if(!x)return 0;
let C=32;for(const z in x)if(x.hasOwnProperty(z)){const A=x[z];switch(typeof A){case "string":C+=f.estimateStringByteSize(A);break;default:case "number":C+=f.estimateNumberByteSize()}}return C}function m(x){if(r.isNone(x))return 0;let C=32;switch(x.type){case "point":C+=42;break;case "polyline":case "polygon":{var z=0;const A=2+(x.hasZ?1:0)+(x.hasM?1:0);x="polyline"===x.type?x.paths:x.rings;for(const t of x)z+=t.length;C+=8*z*A+64;C+=128*z;C=C+34+32*(x.length+1);break}case "multipoint":z=x.points.length;
C+=8*z*(2+(x.hasZ?1:0)+(x.hasM?1:0))+64;C+=128*z;C=C+34+32;break;case "extent":C+=98;x.hasM&&(C+=32);x.hasZ&&(C+=32);break;case "mesh":C+=a.estimateSize(x.vertexAttributes.position),C+=a.estimateSize(x.vertexAttributes.normal),C+=a.estimateSize(x.vertexAttributes.uv),C+=a.estimateSize(x.vertexAttributes.tangent)}return C}function u(x,C){g.empty(C);"mesh"===x.type&&(x=x.extent);switch(x.type){case "point":C[0]=C[3]=x.x;C[1]=C[4]=x.y;x.hasZ&&(C[2]=C[5]=x.z);break;case "polyline":for(var z=0;z<x.paths.length;z++)g.expandWithNestedArray(C,
x.paths[z],x.hasZ);break;case "polygon":for(z=0;z<x.rings.length;z++)g.expandWithNestedArray(C,x.rings[z],x.hasZ);break;case "multipoint":g.expandWithNestedArray(C,x.points,x.hasZ);break;case "extent":C[0]=x.xmin,C[1]=x.ymin,C[3]=x.xmax,C[4]=x.ymax,null!=x.zmin&&(C[2]=x.zmin),null!=x.zmax&&(C[5]=x.zmax)}}function v(x,C){c.empty(C);"mesh"===x.type&&(x=x.extent);switch(x.type){case "point":C[0]=C[2]=x.x;C[1]=C[3]=x.y;break;case "polyline":for(var z=0;z<x.paths.length;z++)c.expandWithNestedArray(C,x.paths[z]);
break;case "polygon":for(z=0;z<x.rings.length;z++)c.expandWithNestedArray(C,x.rings[z]);break;case "multipoint":c.expandWithNestedArray(C,x.points);break;case "extent":C[0]=x.xmin,C[1]=x.ymin,C[2]=x.xmax,C[3]=x.ymax}}const y=g.create(),B=c.create();b.equals=n.equals;b.DehydratedFeatureClass=function(x,C,z){this.uid=x;this.geometry=C;this.attributes=z;this.visible=!0;this.centroid=this.objectId=null};b.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1;this.features=[];this.fields=
[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null};b.computeAABB=u;b.computeAABR=v;b.estimateAttributesObjectSize=q;b.estimateGeometryObjectSize=m;b.estimateSize=function(x){let C;C=32+q(x.attributes);return C=C+3+(8+m(x.geometry))};b.expandAABB=function(x,C){u(x,y);g.expandWithAABB(C,y)};b.expandAABR=function(x,C){v(x,B);c.expand(C,B)};b.fromFeatureSetJSON=function(x){const C=
h.featureGeometryTypeKebabDictionary.fromJSON(x.geometryType),z=l.fromJSON(x.spatialReference),A=x.transform,t=x.features.map(D=>{var E=x.objectIdFieldName;D={uid:d.generateUID(),objectId:E&&D.attributes?D.attributes[E]:null,attributes:D.attributes,geometry:w(D.geometry,C,z),visible:!0};if((E=D.geometry)&&A)switch(E.type){case "point":D.geometry=p.unquantizePoint(A,E,E,E.hasZ,E.hasM);break;case "multipoint":D.geometry=p.unquantizeMultipoint(A,E,E,E.hasZ,E.hasM);break;case "polygon":D.geometry=p.unquantizePolygon(A,
E,E,E.hasZ,E.hasM);break;case "polyline":D.geometry=p.unquantizePolyline(A,E,E,E.hasZ,E.hasM)}return D});return{geometryType:C,features:t,spatialReference:z,fields:x.fields?x.fields.map(D=>e.fromJSON(D)):null,objectIdFieldName:x.objectIdFieldName,globalIdFieldName:x.globalIdFieldName,geohashFieldName:x.geohashFieldName,geometryProperties:x.geometryProperties,hasZ:x.hasZ,hasM:x.hasM,exceededTransferLimit:x.exceededTransferLimit,transform:null}};b.fromJSONGeometry=w;b.getObjectId=function(x,C){return null!=
x.objectId?x.objectId:x.attributes&&C?x.attributes[C]:null};b.hasGeometry=function(x){return r.isSome(x.geometry)};b.hasVertices=function(x){if(!x)return!1;switch(x.type){case "extent":case "point":return!0;case "polyline":for(const C of x.paths)if(0<C.length)return!0;return!1;case "polygon":for(const C of x.rings)if(0<C.length)return!0;return!1;case "multipoint":return 0<x.points.length;case "mesh":return x.vertexAttributes&&x.vertexAttributes.position&&0<x.vertexAttributes.position.length}};b.isDehydratedPoint=
function(x){return"point"===x.type};b.isFeatureGeometry=function(x){return h.isFeatureGeometryType(x.type)};b.makeDehydratedPoint=function(x,C,z,A){return{x,y:C,z,hasZ:null!=z,hasM:!1,spatialReference:A,type:"point"}};b.numVertices=function(x){if(r.isNone(x))return 0;switch(x.type){case "point":return 1;case "polyline":var C=0;for(var z of x.paths)C+=z.length;return C;case "polygon":z=0;for(C of x.rings)z+=C.length;return z;case "multipoint":return x.points.length;case "extent":return 2;case "mesh":return(x=
x.vertexAttributes&&x.vertexAttributes.position)?x.length/3:0}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/byteSizeEstimations":function(){define(["exports"],function(b){b.estimateNumberByteSize=function(){return 16};b.estimateStringByteSize=function(k){return 32+k.length};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/geometry/support/aaBoundingBox":function(){define(["exports","../../core/maybe","../Extent","./aaBoundingRect"],function(b,k,a,r){function l(m=w){return[m[0],
m[1],m[2],m[3],m[4],m[5]]}function h(m,u,v,y,B,x,C=l()){C[0]=m;C[1]=u;C[2]=v;C[3]=y;C[4]=B;C[5]=x;return C}function d(m){return m[0]>=m[3]?0:m[3]-m[0]}function c(m){return m[1]>=m[4]?0:m[4]-m[1]}function e(m){return m[2]>=m[5]?0:m[5]-m[2]}function f(m,u){return Math.max(u[0],m[0])<=Math.min(u[3],m[3])&&Math.max(u[1],m[1])<=Math.min(u[4],m[4])&&Math.max(u[2],m[2])<=Math.min(u[5],m[5])}function g(m,u){m[0]=u[0];m[1]=u[1];m[2]=u[2];m[3]=u[3];m[4]=u[4];m[5]=u[5];return m}function p(m){return 6===m.length}
const n=[Infinity,Infinity,Infinity,-Infinity,-Infinity,-Infinity],w=[0,0,0,0,0,0],q=l();b.NEGATIVE_INFINITY=n;b.POSITIVE_INFINITY=[-Infinity,-Infinity,-Infinity,Infinity,Infinity,Infinity];b.ZERO=w;b.allFinite=function(m){for(let u=0;6>u;u++)if(!isFinite(m[u]))return!1;return!0};b.center=function(m,u=[0,0,0]){u[0]=m[0]+d(m)/2;u[1]=m[1]+c(m)/2;u[2]=m[2]+e(m)/2;return u};b.contains=function(m,u){return u[0]>=m[0]&&u[1]>=m[1]&&u[2]>=m[2]&&u[3]<=m[3]&&u[4]<=m[4]&&u[5]<=m[5]};b.containsPoint=function(m,
u){return u[0]>=m[0]&&u[1]>=m[1]&&u[2]>=m[2]&&u[0]<=m[3]&&u[1]<=m[4]&&u[2]<=m[5]};b.containsPointWithMargin=function(m,u,v){return u[0]>=m[0]-v&&u[1]>=m[1]-v&&u[2]>=m[2]-v&&u[0]<=m[3]+v&&u[1]<=m[4]+v&&u[2]<=m[5]+v};b.create=l;b.depth=c;b.diameter=function(m){const u=d(m),v=e(m);m=c(m);return Math.sqrt(u*u+v*v+m*m)};b.empty=function(m){return m?g(m,n):l(n)};b.equals=function(m,u,v){if(k.isNone(m)||k.isNone(u))return m===u;if(!p(m)||!p(u))return!1;if(v)for(let y=0;y<m.length;y++){if(!v(m[y],u[y]))return!1}else for(v=
0;v<m.length;v++)if(m[v]!==u[v])return!1;return!0};b.expandWithAABB=function(m,u){m[0]=Math.min(m[0],u[0]);m[1]=Math.min(m[1],u[1]);m[2]=Math.min(m[2],u[2]);m[3]=Math.max(m[3],u[3]);m[4]=Math.max(m[4],u[4]);m[5]=Math.max(m[5],u[5])};b.expandWithBuffer=function(m,u,v=0,y=u.length/3){let B=m[0],x=m[1],C=m[2],z=m[3],A=m[4],t=m[5];for(let D=0;D<y;D++)B=Math.min(B,u[v+3*D]),x=Math.min(x,u[v+3*D+1]),C=Math.min(C,u[v+3*D+2]),z=Math.max(z,u[v+3*D]),A=Math.max(A,u[v+3*D+1]),t=Math.max(t,u[v+3*D+2]);m[0]=B;
m[1]=x;m[2]=C;m[3]=z;m[4]=A;m[5]=t};b.expandWithNestedArray=function(m,u,v){const y=u.length;let B=m[0],x=m[1],C=m[2],z=m[3],A=m[4],t=m[5];if(v)for(v=0;v<y;v++){var D=u[v];B=Math.min(B,D[0]);x=Math.min(x,D[1]);C=Math.min(C,D[2]);z=Math.max(z,D[0]);A=Math.max(A,D[1]);t=Math.max(t,D[2])}else for(v=0;v<y;v++)D=u[v],B=Math.min(B,D[0]),x=Math.min(x,D[1]),z=Math.max(z,D[0]),A=Math.max(A,D[1]);m[0]=B;m[1]=x;m[2]=C;m[3]=z;m[4]=A;m[5]=t};b.expandWithOffset=function(m,u,v,y){m[0]=Math.min(m[0],m[0]+u);m[3]=
Math.max(m[3],m[3]+u);m[1]=Math.min(m[1],m[1]+v);m[4]=Math.max(m[4],m[4]+v);m[2]=Math.min(m[2],m[2]+y);m[5]=Math.max(m[5],m[5]+y)};b.expandWithRect=function(m,u){m[0]=Math.min(m[0],u[0]);m[1]=Math.min(m[1],u[1]);m[3]=Math.max(m[3],u[2]);m[4]=Math.max(m[4],u[3])};b.expandWithVec3=function(m,u){m[0]=Math.min(m[0],u[0]);m[1]=Math.min(m[1],u[1]);m[2]=Math.min(m[2],u[2]);m[3]=Math.max(m[3],u[0]);m[4]=Math.max(m[4],u[1]);m[5]=Math.max(m[5],u[2])};b.fromExtent=function(m,u=l()){u[0]=m.xmin;u[1]=m.ymin;u[2]=
m.zmin;u[3]=m.xmax;u[4]=m.ymax;u[5]=m.zmax;return u};b.fromMinMax=function(m,u,v=l()){v[0]=m[0];v[1]=m[1];v[2]=m[2];v[3]=u[0];v[4]=u[1];v[5]=u[2];return v};b.fromRect=function(m,u){m[0]=u[0];m[1]=u[1];m[2]=Number.NEGATIVE_INFINITY;m[3]=u[2];m[4]=u[3];m[5]=Number.POSITIVE_INFINITY;return m};b.fromValues=h;b.getMax=function(m,u){u[0]=m[3];u[1]=m[4];u[2]=m[5];return u};b.getMin=function(m,u){u[0]=m[0];u[1]=m[1];u[2]=m[2];return u};b.height=e;b.intersects=f;b.intersectsClippingArea=function(m,u){return k.isNone(u)?
!0:f(m,u)};b.is=p;b.isPoint=function(m){return 0===d(m)&&0===c(m)&&0===e(m)};b.maximumDimension=function(m){return Math.max(d(m),e(m),c(m))};b.offset=function(m,u,v,y,B=m){B[0]=m[0]+u;B[1]=m[1]+v;B[2]=m[2]+y;B[3]=m[3]+u;B[4]=m[4]+v;B[5]=m[5]+y;return B};b.scale=function(m,u,v=m){const y=m[0]+d(m)/2,B=m[1]+c(m)/2,x=m[2]+e(m)/2;v[0]=y+(m[0]-y)*u;v[1]=B+(m[1]-B)*u;v[2]=x+(m[2]-x)*u;v[3]=y+(m[3]-y)*u;v[4]=B+(m[4]-B)*u;v[5]=x+(m[5]-x)*u;return v};b.set=g;b.setMax=function(m,u,v=m){v[3]=u[0];v[4]=u[1];
v[5]=u[2];v!==m&&(v[0]=m[0],v[1]=m[1],v[2]=m[2]);return m};b.setMin=function(m,u,v=m){v[0]=u[0];v[1]=u[1];v[2]=u[2];v!==m&&(v[3]=m[3],v[4]=m[4],v[5]=m[5]);return v};b.size=function(m,u=[0,0,0]){u[0]=d(m);u[1]=c(m);u[2]=e(m);return u};b.toExtent=function(m,u){return isFinite(m[2])||isFinite(m[5])?new a({xmin:m[0],xmax:m[3],ymin:m[1],ymax:m[4],zmin:m[2],zmax:m[5],spatialReference:u}):new a({xmin:m[0],xmax:m[3],ymin:m[1],ymax:m[4],spatialReference:u})};b.toRect=function(m,u){u||(u=r.create());u[0]=m[0];
u[1]=m[1];u[2]=m[3];u[3]=m[4];return u};b.width=d;b.wrap=function(m,u,v,y,B,x){return h(m,u,v,y,B,x,q)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","./jsonUtils"],function(b,k){function a({scale:D,translate:E},G){return Math.round((G-E[0])/D[0])}function r({scale:D,translate:E},G){return Math.round((E[1]-G)/D[1])}function l(D,E,G){const H=[];let I,J,K,L;for(let S=0;S<G.length;S++){const M=G[S];if(0<S){if(K=a(D,M[0]),L=
r(D,M[1]),K!==I||L!==J)H.push(E(M,K-I,L-J)),I=K,J=L}else I=a(D,M[0]),J=r(D,M[1]),H.push(E(M,I,J))}return 0<H.length?H:null}function h(D,E,G,H){return l(D,G?H?t:A:H?A:z,E)}function d(D,E,G,H){const I=[];G=G?H?t:A:H?A:z;for(H=0;H<E.length;H++){const J=l(D,G,E[H]);J&&3<=J.length&&I.push(J)}return I.length?I:null}function c(D,E,G,H){const I=[];G=G?H?t:A:H?A:z;for(H=0;H<E.length;H++){const J=l(D,G,E[H]);J&&2<=J.length&&I.push(J)}return I.length?I:null}function e({scale:D,translate:E},G){return G*D[0]+
E[0]}function f({scale:D,translate:E},G){return E[1]-G*D[1]}function g(D,E,G){const H=Array(G.length);if(!G.length)return H;const [I,J]=D.scale;let K=e(D,G[0][0]);D=f(D,G[0][1]);H[0]=E(G[0],K,D);for(let L=1;L<G.length;L++){const S=G[L];K+=S[0]*I;D-=S[1]*J;H[L]=E(S,K,D)}return H}function p(D,E,G){const H=Array(G.length);for(let I=0;I<G.length;I++)H[I]=g(D,E,G[I]);return H}function n(D,E,G,H){return g(D,G?H?t:A:H?A:z,E)}function w(D,E,G,H){return p(D,G?H?t:A:H?A:z,E)}function q(D,E,G,H){return p(D,
G?H?t:A:H?A:z,E)}function m(D,E,G){let [H,I]=G[0],J=Math.min(H,E[0]),K=Math.min(I,E[1]),L=Math.max(H,E[2]);E=Math.max(I,E[3]);for(let S=1;S<G.length;S++){const [M,T]=G[S];H+=M;I+=T;0>M&&(J=Math.min(J,H));0<M&&(L=Math.max(L,H));0>T?K=Math.min(K,I):0<T&&(E=Math.max(E,I))}D[0]=J;D[1]=K;D[2]=L;D[3]=E;return D}function u(D,E){if(!E.length)return null;D[0]=D[1]=Number.POSITIVE_INFINITY;D[2]=D[3]=Number.NEGATIVE_INFINITY;for(let G=0;G<E.length;G++)m(D,D,E[G]);return D}function v(D,E,G,H,I){E.xmin=a(D,G.xmin);
E.ymin=r(D,G.ymin);E.xmax=a(D,G.xmax);E.ymax=r(D,G.ymax);E!==G&&(H&&(E.zmin=G.zmin,E.zmax=G.zmax),I&&(E.mmin=G.mmin,E.mmax=G.mmax));return E}function y(D,E,G,H,I){E.points=h(D,G.points,H,I);return E}function B(D,E,G,H,I){E.x=a(D,G.x);E.y=r(D,G.y);E!==G&&(H&&(E.z=G.z),I&&(E.m=G.m));return E}function x(D,E,G,H,I){D=d(D,G.rings,H,I);if(!D)return null;E.rings=D;return E}function C(D,E,G,H,I){D=c(D,G.paths,H,I);if(!D)return null;E.paths=D;return E}const z=(D,E,G)=>[E,G],A=(D,E,G)=>[E,G,D[2]],t=(D,E,G)=>
[E,G,D[2],D[3]];b.equals=function(D,E){if(D===E||null==D&&null==E)return!0;if(null==D||null==E)return!1;let G,H,I,J;D&&"upperLeft"===D.originPosition?(G=D.translate[0],H=D.translate[1],D=D.scale[0]):(G=D.extent.xmin,H=D.extent.ymax,D=D.tolerance);E&&"upperLeft"===E.originPosition?(I=E.translate[0],J=E.translate[1],E=E.scale[0]):(I=E.extent.xmin,J=E.extent.ymax,E=E.tolerance);return G===I&&H===J&&D===E};b.getQuantizedBoundsCoordsArray=m;b.getQuantizedBoundsCoordsArrayArray=u;b.getQuantizedBoundsPaths=
function(D){return u([0,0,0,0],D)};b.getQuantizedBoundsPoints=function(D){const E=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return m(E,E,D)};b.getQuantizedBoundsRings=function(D){return u([0,0,0,0],D)};b.quantizeBounds=function(D,E,G){E[0]=a(D,G[0]);E[3]=r(D,G[1]);E[2]=a(D,G[2]);E[1]=r(D,G[3]);return E};b.quantizeExtent=v;b.quantizeGeometry=function(D,E){return D&&E?k.isPoint(E)?B(D,{},E,!1,!1):k.isPolyline(E)?C(D,{},E,!1,!1):k.isPolygon(E)?
x(D,{},E,!1,!1):k.isMultipoint(E)?y(D,{},E,!1,!1):k.isExtent(E)?v(D,{},E,!1,!1):null:null};b.quantizeMultipoint=y;b.quantizePaths=c;b.quantizePoint=B;b.quantizePoints=h;b.quantizePolygon=x;b.quantizePolyline=C;b.quantizeRings=d;b.quantizeX=a;b.quantizeY=r;b.toQuantizationTransform=function(D){return D?{originPosition:"upper-left"===D.originPosition?"upperLeft":"lower-left"===D.originPosition?"lowerLeft":D.originPosition,scale:[D.tolerance,D.tolerance],translate:[D.extent.xmin,D.extent.ymax]}:null};
b.unquantizeBounds=function(D,E,G){return G?(E[0]=e(D,G[0]),E[1]=f(D,G[3]),E[2]=e(D,G[2]),E[3]=f(D,G[1]),E):[e(D,E[0]),f(D,E[3]),e(D,E[2]),f(D,E[1])]};b.unquantizeCoordsArray=g;b.unquantizeCoordsArrayArray=p;b.unquantizeExtent=function(D,E,G,H,I){E.xmin=e(D,G.xmin);E.ymin=f(D,G.ymin);E.xmax=e(D,G.xmax);E.ymax=f(D,G.ymax);E!==G&&(H&&(E.zmin=G.zmin,E.zmax=G.zmax),I&&(E.mmin=G.mmin,E.mmax=G.mmax));return E};b.unquantizeMultipoint=function(D,E,G,H,I){E.points=n(D,G.points,H,I);return E};b.unquantizePaths=
w;b.unquantizePoint=function(D,E,G,H,I){E.x=e(D,G.x);E.y=f(D,G.y);E!==G&&(H&&(E.z=G.z),I&&(E.m=G.m));return E};b.unquantizePoints=n;b.unquantizePolygon=function(D,E,G,H,I){E.rings=q(D,G.rings,H,I);return E};b.unquantizePolyline=function(D,E,G,H,I){E.paths=w(D,G.paths,H,I);return E};b.unquantizeRings=q;b.unquantizeX=e;b.unquantizeY=f;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has","../../core/maybe"],
function(b,k,a){function r(e,f){if(e===f)return!0;if(null==e||null==f||e.length!==f.length)return!1;for(let g=0;g<e.length;g++){const p=e[g],n=f[g];if(p.length!==n.length)return!1;for(let w=0;w<p.length;w++)if(p[w]!==n[w])return!1}return!0}function l(e,f){if(e===f)return!0;if(null==e||null==f||e.length!==f.length)return!1;for(let g=0;g<e.length;g++)if(!r(e[g],f[g]))return!1;return!0}function h(e,f){return e===f||e&&f&&e.equals(f)}function d(e,f){if(e===f)return!0;if(a.isNone(e)||a.isNone(f)||e.type!==
f.type)return!1;switch(e.type){case "point":return e=h(e.spatialReference,f.spatialReference)?e.x===f.x&&e.y===f.y&&e.z===f.z&&e.m===f.m:!1,e;case "extent":return e=e.hasZ!==f.hasZ||e.hasM!==f.hasM?!1:h(e.spatialReference,f.spatialReference)?e.xmin===f.xmin&&e.ymin===f.ymin&&e.zmin===f.zmin&&e.xmax===f.xmax&&e.ymax===f.ymax&&e.zmax===f.zmax:!1,e;case "polyline":return e=e.hasZ!==f.hasZ||e.hasM!==f.hasM?!1:h(e.spatialReference,f.spatialReference)?l(e.paths,f.paths):!1,e;case "polygon":return e=e.hasZ!==
f.hasZ||e.hasM!==f.hasM?!1:h(e.spatialReference,f.spatialReference)?l(e.rings,f.rings):!1,e;case "multipoint":return e=e.hasZ!==f.hasZ||e.hasM!==f.hasM?!1:h(e.spatialReference,f.spatialReference)?r(e.points,f.points):!1,e;case "mesh":return!1}}function c(e,f){if(e===f)return!0;if(!e||!f)return!1;const g=Object.keys(e),p=Object.keys(f);if(g.length!==p.length)return!1;for(const n of g)if(e[n]!==f[n])return!1;return!0}b.equals=function(e,f){return e===f?!0:null!=e&&null!=f&&e.objectId===f.objectId&&
d(e.geometry,f.geometry)&&c(e.attributes,f.attributes)?!0:!1};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/Accessor ../core/Collection ../core/Handles ../core/watchUtils ./support/GroundViewElevationSampler".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){a=function(u){function v(B){B=u.call(this,B)||this;B.handles=new w;B.view=null;B.layerViews=new n;return B}b._inheritsLoose(v,u);var y=v.prototype;y.initialize=function(){this.handles.add(q.when(this,"view.map.ground",B=>B.load()));this.handles.add(this.layerViews.on("after-changes",()=>this.layerViewsAfterChangesHandler()))};y.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};y.layerViewsAfterChangesHandler=
function(){this.handles.remove("updating");this.handles.add(this.layerViews.map(B=>B.watch("updating",()=>this.updateUpdating(),!0)).toArray(),"updating");this.updateUpdating()};y.updateUpdating=function(){this.notifyChange("updating")};b._createClass(v,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new m({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?!1:this.layerViews.some(B=>
B.updating)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}}]);return v}(p);k.__decorate([h.property({readOnly:!0,dependsOn:["view.ready","view.basemapTerrain?.ready"]})],a.prototype,"elevationSampler",null);k.__decorate([h.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],a.prototype,"updating",null);k.__decorate([h.property({constructOnly:!0})],a.prototype,"view",void 0);k.__decorate([h.property({type:n,readOnly:!0})],a.prototype,"layerViews",void 0);k.__decorate([h.property({readOnly:!0,
dependsOn:["view.suspended"]})],a.prototype,"suspended",null);return a=k.__decorate([c.subclass("esri.views.GroundView")],a)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../geometry/support/webMercatorUtils ../../geometry/support/contains ../../core/Evented ../../geometry/support/aaBoundingRect ../../layers/support/ElevationSampler ../3d/support/ElevationProvider ../3d/terrain/TerrainConst".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){const y=r.getLogger("esri.views.support.GroundViewElevationSampler");a=function(B){function x(z){z=B.call(this,z)||this;z.demResolution={min:-1,max:-1};z.noDataValue=v.ELEVATION_NODATA_VALUE;return z}b._inheritsLoose(x,B);var C=x.prototype;C.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};C.elevationAt=function(z){var A=z.spatialReference;const t=this.spatialReference;if(!p.canProject(A,t))return y.error(`Cannot sample elevation at a location with spatial reference (${A?
A.wkid:"unknown"}) different from the view (${t.wkid})`),null;n.extentContainsPoint(this.extent,z)||(A=this.extent,y.warn("#elevationAt()",`Point used to sample elevation (${z.x}, ${z.y}) is outside of the sampler extent (${`${A.xmin}, ${A.ymin}, ${A.xmax}, ${A.ymax}`})`));return u.getElevationAtPoint(this.view.elevationProvider,z)};C.queryElevation=function(z){return m.updateGeometryElevation(z.clone(),this)};b._createClass(x,[{key:"extent",get:function(){const z=this.view.basemapTerrain;return z.extent&&
z.spatialReference?q.toExtent(z.extent,z.spatialReference):null}}]);return x}(w.EventedAccessor);k.__decorate([h.property({readOnly:!0})],a.prototype,"demResolution",void 0);k.__decorate([h.property({readOnly:!0,dependsOn:["view.basemapTerrain.extent","view.basemapTerrain.spatialReference"]})],a.prototype,"extent",null);k.__decorate([h.property({readOnly:!0})],a.prototype,"noDataValue",void 0);k.__decorate([h.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],a.prototype,"spatialReference",
void 0);k.__decorate([h.property({constructOnly:!0})],a.prototype,"view",void 0);return a=k.__decorate([c.subclass("esri.views.support.GroundViewElevationSampler")],a)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/Logger ../../geometry/support/webMercatorUtils ../../geometry/Point ../../geometry/support/contains ../../geometry ../../core/unitUtils ../../geometry/support/aaBoundingRect".split(" "),function(b,k,
a,r,l,h,d,c,e,f){function g(u,v){const y=p(u,v.spatialReference);if(!y)return null;switch(u.type){case "point":u.z=v.elevationAt(y)||0;break;case "polyline":q.spatialReference=y.spatialReference;var B=u.hasM&&!u.hasZ;for(var x=0;x<u.paths.length;x++){var C=u.paths[x],z=y.paths[x];for(let t=0;t<C.length;t++){const D=C[t];var A=z[t];q.x=A[0];q.y=A[1];A=v.elevationAt(q)||0;B&&(D[3]=D[2]);D[2]=A}}u.hasZ=!0;break;case "multipoint":q.spatialReference=y.spatialReference;B=u.hasM&&!u.hasZ;for(x=0;x<u.points.length;x++)C=
u.points[x],z=y.points[x],q.x=z[0],q.y=z[1],z=v.elevationAt(q)||0,B&&(C[3]=C[2]),C[2]=z;u.hasZ=!0}return u}function p(u,v){const y=u.spatialReference;return y.equals(v)?u:l.canProject(y,v)?l.project(u,v):(n.error(`Cannot project geometry spatial reference (wkid:${y.wkid}) to elevation sampler spatial reference (wkid:${v.wkid})`),null)}const n=r.getLogger("esri.layers.support.ElevationSampler");a=function(){function u(){}var v=u.prototype;v.queryElevation=function(y){return g(y.clone(),this)};v.on=
function(){return m};v.projectIfRequired=function(y,B){return p(y,B)};return u}();let w=function(u){function v(B,x,C){var z=u.call(this)||this;z.tile=B;z.noDataValue=C;z.extent=f.toExtent(B.tile.extent,x.spatialReference);C=e.getMetersPerUnitForSR(x.spatialReference);B=x.lodAt(B.tile.level).resolution*C;z.demResolution={min:B,max:B};return z}k._inheritsLoose(v,u);var y=v.prototype;y.contains=function(B){B=this.projectIfRequired(B,this.spatialReference);return d.extentContainsPoint(this.extent,B)};
y.elevationAt=function(B){const x=this.projectIfRequired(B,this.spatialReference);if(!x)return null;if(!this.contains(B)){const C=this.extent;n.warn("#elevationAt()",`Point used to sample elevation (${B.x}, ${B.y}) is outside of the sampler extent (${`${C.xmin}, ${C.ymin}, ${C.xmax}, ${C.ymax}`})`)}return this.tile.sample(x.x,x.y)};k._createClass(v,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return v}(a);r=function(u){function v(y,B,x){var C=u.call(this)||this;
let z;"number"===typeof B?(C.noDataValue=B,z=null):(z=B,C.noDataValue=x);C.samplers=z?y.map(A=>new w(A,z,C.noDataValue)):y;if(y=C.samplers[0]){C.extent=y.extent.clone();const {min:A,max:t}=y.demResolution;C.demResolution={min:A,max:t};for(y=1;y<C.samplers.length;y++)B=C.samplers[y],C.extent.union(B.extent),C.demResolution.min=Math.min(C.demResolution.min,B.demResolution.min),C.demResolution.max=Math.max(C.demResolution.max,B.demResolution.max)}else C.extent=f.toExtent(f.create(),z.spatialReference),
C.demResolution={min:0,max:0};return C}k._inheritsLoose(v,u);v.prototype.elevationAt=function(y){const B=this.projectIfRequired(y,this.spatialReference);if(!B)return null;for(const x of this.samplers)if(x.contains(B))return x.elevationAt(B);n.warn("#elevationAt()",`Point used to sample elevation (${y.x}, ${y.y}) is outside of the sampler`);return null};k._createClass(v,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return v}(a);const q=new h,m={remove(){}};b.ElevationSamplerBase=
a;b.MultiTileElevationSampler=r;b.TileElevationSampler=w;b.updateGeometryElevation=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(b,k,a,r){k=k.clampFloat32(k.NUMBER_MAX_FLOAT32/10);const l=a.create();r.WebMercatorAuxiliarySphere.getExtent(0,0,0,l);a=a.create([-180,-90,180,90]);b.DEFAULT_TILE_BACKGROUND="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
b.ELEVATION_DESIRED_RESOLUTION_LEVEL=4;b.ELEVATION_NODATA_VALUE=k;b.GEOGRAPHIC_WORLD_EXTENT=a;b.GEOMETRY_VERTEX_STRIDE=5;b.LOADING_LEVEL_MODULO=2;b.MAX_MEMORY_LOD_BIAS=2.5;b.MAX_PATCH_TESSELATION=512;b.MAX_ROOT_TILES=64;b.TILE_LOADING_DEBUGLOG=!1;b.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";b.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";b.WEBMERCATOR_WORLD_EXTENT=
l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/TilingScheme":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../geometry/support/spatialReferenceUtils ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry ../../../core/mathUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../../layers/support/TileInfo".split(" "),function(b,k,a,r,l,h,d,c,e,f,g){const p=
f.webMercator.x2lon,n=f.webMercator.y2lat;h=function(){function q(u){var v=q.checkUnsupported(u);if(v)throw v;this.spatialReference=u.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=f.canProjectToWGS84ComparableLonLat(this.spatialReference)||a.isMars(this.spatialReference)||a.isMoon(this.spatialReference);this.origin=[u.origin.x,u.origin.y];this.pixelSize=u.size[0];this.dpi=u.dpi;var y=u.lods.reduce(function(C,z,A){z.level<C.min&&(C.min=z.level,C.minIndex=A);C.max=
Math.max(C.max,z.level);return C},{min:Infinity,minIndex:0,max:-Infinity}),B=u.lods[y.minIndex];const x=Math.pow(2,B.level);v=B.resolution*x;B=B.scale*x;this.levels=Array(y.max+1);for(y=0;y<this.levels.length;y++)this.levels[y]={resolution:v,scale:B,tileSize:[v*u.size[0],v*u.size[1]]},v/=2,B/=2}var m=q.prototype;m.clone=function(){return new q(this.toTileInfo())};m.toTileInfo=function(){return new g({dpi:this.dpi,origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,
this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((u,v)=>({level:v,scale:u.scale,resolution:u.resolution}))})};m.getExtent=function(u,v,y,B){var x=this.levels[u];u=x.tileSize[0];x=x.tileSize[1];B[0]=this.origin[0]+y*u;B[2]=B[0]+u;B[3]=this.origin[1]-v*x;B[1]=B[3]-x};m.convertExtentToRadians=function(u,v){this._isWebMercator?(v[0]=p(u[0]),v[1]=n(u[1]),v[2]=p(u[2]),v[3]=n(u[3])):this._isGCS&&(v[0]=d.deg2rad(u[0]),v[1]=d.deg2rad(u[1]),v[2]=d.deg2rad(u[2]),v[3]=d.deg2rad(u[3]))};
m.getExtentGeometry=function(u,v,y,B=new l){this.getExtent(u,v,y,w);B.spatialReference=this.spatialReference;B.xmin=w[0];B.ymin=w[1];B.xmax=w[2];B.ymax=w[3];B.zmin=void 0;B.zmax=void 0;return B};m.ensureMaxLod=function(u){if(null==u)return!1;for(var v=!1;this.levels.length<=u;){v=this.levels[this.levels.length-1];const y=v.resolution/2;this.levels.push({resolution:y,scale:v.scale/2,tileSize:[y*this.pixelSize,y*this.pixelSize]});v=!0}return v};m.capMaxLod=function(u){this.levels.length>u+1&&(this.levels.length=
u+1)};m.getMaxLod=function(){return this.levels.length-1};m.scaleAtLevel=function(u){return this.levels[0].scale/Math.pow(2,u)};m.levelAtScale=function(u){const v=this.levels[0].scale;return u>=v?0:Math.log(v/u)*Math.LOG2E};m.resolutionAtLevel=function(u){return this.levels[0].resolution/Math.pow(2,u)};m.compatibleWith=function(u){if(!(u instanceof q)){if(q.checkUnsupported(u))return!1;u=new q(u)}if(!u.spatialReference.equals(this.spatialReference)||u.pixelSize!==this.pixelSize)return!1;const v=Math.min(this.levels.length,
u.levels.length)-1,y=this.levels[v].resolution;let B=.5*y;if(!d.floatEqualAbsolute(u.origin[0],this.origin[0],B)||!d.floatEqualAbsolute(u.origin[1],this.origin[1],B))return!1;B=.5*y/Math.pow(2,v)/this.pixelSize*12;return d.floatEqualAbsolute(y,u.levels[v].resolution,B)};m.rootTilesInExtent=function(u,v,y){const B=this.levels[0].tileSize;if(0===B[0]||0===B[1])return[];q.computeRowColExtent(u,B,this.origin,w);u=w[1];let x=w[3],C=w[0],z=w[2];var A=z-C,t=x-u;A*t>y&&(y=Math.floor(Math.sqrt(y)),t>y&&(u=
u+Math.floor(.5*t)-Math.floor(.5*y),x=u+y),A>y&&(C=C+Math.floor(.5*A)-Math.floor(.5*y),z=C+y));y=[];for(A=u;A<x;A++)for(t=C;t<z;t++)y.push([0,A,t]);v&&(v[0]=this.origin[0]+C*B[0],v[1]=this.origin[1]-x*B[1],v[2]=this.origin[0]+z*B[0],v[3]=this.origin[1]-u*B[1]);return y};q.computeRowColExtent=function(u,v,y,B){const x=.001*(u[2]-u[0]+(u[3]-u[1]));B[0]=Math.max(0,Math.floor((u[0]+x-y[0])/v[0]));B[2]=Math.max(0,Math.ceil((u[2]-x-y[0])/v[0]));B[1]=Math.max(0,Math.floor((y[1]-u[3]+x)/v[1]));B[3]=Math.max(0,
Math.ceil((y[1]-u[1]-x)/v[1]))};q.isPowerOfTwo=function(u){u=u.lods;const v=u[0].resolution*Math.pow(2,u[0].level);return!u.some(function(y){return!d.floatEqualRelative(y.resolution,v/Math.pow(2,y.level))})};q.hasGapInLevels=function(u){u=u.lods.map(function(v){return v.level});u.sort(function(v,y){return v-y});for(let v=1;v<u.length;v++)if(u[v]!==u[0]+v)return!0;return!1};q.tileSizeSupported=function(u){const v=u.size[1];return v===u.size[0]&&0===(v&v-1)&&128<=v&&512>=v};q.checkUnsupported=function(u){return u?
1>u.lods.length?new k("tilingscheme:generic","Tiling scheme must have at least one level"):q.isPowerOfTwo(u)?q.hasGapInLevels(u)?new k("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):q.tileSizeSupported(u)?null:new k("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new k("tilingscheme:power-of-two","Tiling scheme must be power of two"):new k("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};
q.fromExtent=function(u,v){const y=u[2]-u[0],B=u[3]-u[1],x=c.getMetersPerUnitForSR(v),C=1.2*Math.max(y,B);u=new q(new g({size:[256,256],origin:{x:u[0]-.5*(C-y),y:u[3]+.5*(C-B)},lods:[{level:0,resolution:C/256,scale:1/(256/96*.0254/(C*x))}],spatialReference:v}));u.ensureMaxLod(20);return u};q.makeWebMercatorAuxiliarySphere=function(u){const v=new q(q.WebMercatorAuxiliarySphereTileInfo);v.ensureMaxLod(u);return v};q.makeGCSWithTileSize=function(u,v=256,y=16){const B=256/v;u=new q(new g({size:[v,v],
origin:{x:-180,y:90,spatialReference:u},spatialReference:u,lods:[{level:0,resolution:.703125*B,scale:2.95497598570834E8*B}]}));u.ensureMaxLod(y);return u};b._createClass(q,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return q}();h.WebMercatorAuxiliarySphereTileInfo=new g({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:r.WebMercator},spatialReference:r.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});
h.WebMercatorAuxiliarySphere=h.makeWebMercatorAuxiliarySphere(19);const w=e.create();return h})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../geometry/support/spatialReferenceUtils ../../geometry/SpatialReference ../../geometry/support/webMercatorUtils ../../geometry/Point ../../geometry ../../core/unitUtils ../../geometry/support/aaBoundingRect ./LOD".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C){var z;a=new d.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});w=z=function(A){function t(E){E=A.call(this,E)||this;E.dpi=96;E.format=null;E.origin=null;E.minScale=0;E.maxScale=0;E.size=null;E.spatialReference=null;return E}b._inheritsLoose(t,A);t.create=function(E=
{size:256,spatialReference:m.WebMercator}){var G=E.resolutionFactor||1,H=E.scales;const I=E.size||256,J=E.spatialReference||m.WebMercator;if(!q.isValid(J)){G=[];if(H)for(E=0;E<H.length;E++){var K=H[E];G.push({level:E,scale:K,resolution:K})}else for(H=5E-4,E=23;0<=E;E--)G.unshift({level:E,scale:H,resolution:H}),H*=2;return new z({dpi:96,lods:G,origin:new v(0,0,J),size:[I,I],spatialReference:J})}K=q.getInfo(J);E=E.origin?new v({x:E.origin.x,y:E.origin.y,spatialReference:J}):K?new v({x:K.origin[0],y:K.origin[1],
spatialReference:J}):new v({x:0,y:0,spatialReference:J});K=1/(39.37*B.getMetersPerUnitForSR(J)*96);const L=[];if(H)for(G=0;G<H.length;G++){var S=H[G];L.push({level:G,scale:S,resolution:S*K})}else{var M=q.isGeographic(J)?512/I*5.916575275917094E8:256/I*5.91657527591555E8;H=Math.ceil(24/G);L.push({level:0,scale:M,resolution:M*K});for(S=1;S<H;S++)M/=Math.pow(2,G),L.push({level:S,scale:M,resolution:M*K})}return new z({dpi:96,lods:L,origin:E,size:[I,I],spatialReference:J})};var D=t.prototype;D.readOrigin=
function(E,G){return v.fromJSON({spatialReference:G.spatialReference,...E})};D.readSize=function(E,G){return[G.cols,G.rows]};D.writeSize=function(E,G){G.cols=E[0];G.rows=E[0]};D.zoomToScale=function(E){const G=this.scales;if(0>=E)return G[0];if(E>=G.length)return G[G.length-1];{const H=Math.round(E);return G[H]+(H-E)*(G[Math.round(E-.5)]-G[H])}};D.scaleToZoom=function(E){const G=this.scales,H=G.length-1;let I=0;for(;I<H;I++){const J=G[I],K=G[I+1];if(J<=E)break;if(K===E)return I+1;if(J>E&&K<E)return I+
1-(E-K)/(J-K)}return I};D.snapScale=function(E,G=.95){E=this.scaleToZoom(E);return E%Math.floor(E)>=G?this.zoomToScale(Math.ceil(E)):this.zoomToScale(Math.floor(E))};D.tileAt=function(E,G,H,I){var J=this.lodAt(E);if(!J)return null;let K;if("number"===typeof G)K=G,G=H;else{if(q.equals(G.spatialReference,this.spatialReference))K=G.x,G=G.y;else{I=u.project(G,this.spatialReference);if(!I)return null;K=I.x;G=I.y}I=H}H=J.resolution*this.size[0];J=J.resolution*this.size[1];I||(I={id:null,level:0,row:0,col:0,
extent:x.create()});I.level=E;I.row=Math.floor((this.origin.y-G)/J+.001);I.col=Math.floor((K-this.origin.x)/H+.001);this.updateTileInfo(I);return I};D.updateTileInfo=function(E){var G=this.lodAt(E.level);if(G){var H=G.resolution*this.size[0];G=G.resolution*this.size[1];E.id=`${E.level}/${E.row}/${E.col}`;E.extent||(E.extent=x.create());E.extent[0]=this.origin.x+E.col*H;E.extent[1]=this.origin.y-(E.row+1)*G;E.extent[2]=E.extent[0]+H;E.extent[3]=E.extent[1]+G}};D.upsampleTile=function(E){const G=this._upsampleLevels[E.level];
if(!G||-1===G.parentLevel)return!1;E.level=G.parentLevel;E.row=Math.floor(E.row/G.factor+.001);E.col=Math.floor(E.col/G.factor+.001);this.updateTileInfo(E);return!0};D.getTileBounds=function(E,G){var {resolution:H}=this.lodAt(G.level);const I=H*this.size[0];H*=this.size[1];E[0]=this.origin.x+G.col*I;E[1]=this.origin.y-(G.row+1)*H;E[2]=E[0]+I;E[3]=E[1]+H;return E};D.lodAt=function(E){return this._levelToLOD&&this._levelToLOD[E]||null};D.clone=function(){return z.fromJSON(this.write({}))};D._initializeUpsampleLevels=
function(){const E=this.lods;this._upsampleLevels=[];let G=null;for(let H=0;H<E.length;H++){const I=E[H];this._upsampleLevels[I.level]={parentLevel:G?G.level:-1,factor:G?G.resolution/I.resolution:0};G=I}};b._createClass(t,[{key:"isWrappable",get:function(){const {spatialReference:E,origin:G}=this;if(E&&G){const H=q.getInfo(E);return E.isWrappable&&Math.abs(H.origin[0]-G.x)<=H.dx}return!1}},{key:"lods",set:function(E){let G=0,H=0;const I=[];this._levelToLOD={};E&&(G=-Infinity,H=Infinity,E.forEach(J=>
{I.push(J.scale);G=J.scale>G?J.scale:G;H=J.scale<H?J.scale:H;this._levelToLOD[J.level]=J}));this._set("scales",I);this._set("minScale",G);this._set("maxScale",H);this._set("lods",E);this._initializeUpsampleLevels()}}]);return t}(w.JSONSupport);k.__decorate([h.property({type:Number,json:{write:!0}})],w.prototype,"compressionQuality",void 0);k.__decorate([h.property({type:Number,json:{write:!0}})],w.prototype,"dpi",void 0);k.__decorate([h.property({type:String,json:{read:a.read,write:a.write,origins:{"web-scene":{read:!1,
write:!1}}}})],w.prototype,"format",void 0);k.__decorate([h.property({readOnly:!0,dependsOn:["spatialReference","origin"]})],w.prototype,"isWrappable",null);k.__decorate([h.property({type:v,json:{write:!0}})],w.prototype,"origin",void 0);k.__decorate([c.reader("origin")],w.prototype,"readOrigin",null);k.__decorate([h.property({type:[C],value:null,json:{write:!0}})],w.prototype,"lods",null);k.__decorate([h.property({readOnly:!0})],w.prototype,"minScale",void 0);k.__decorate([h.property({readOnly:!0})],
w.prototype,"maxScale",void 0);k.__decorate([h.property({readOnly:!0})],w.prototype,"scales",void 0);k.__decorate([h.property({cast:A=>Array.isArray(A)?A:"number"===typeof A?[A,A]:[256,256]})],w.prototype,"size",void 0);k.__decorate([c.reader("size",["rows","cols"])],w.prototype,"readSize",null);k.__decorate([f.writer("size",{cols:{type:l.Integer},rows:{type:l.Integer}})],w.prototype,"writeSize",null);k.__decorate([h.property({type:m,json:{write:!0}})],w.prototype,"spatialReference",void 0);return w=
z=k.__decorate([e.subclass("esri.layers.support.TileInfo")],w)})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),function(b,k,a,r,l,h,d,c,e,f,g,p){var n;
a=n=function(w){function q(m){m=w.call(this,m)||this;m.level=0;m.levelValue=null;m.resolution=0;m.scale=0;return m}b._inheritsLoose(q,w);q.prototype.clone=function(){return new n({level:this.level,levelValue:this.levelValue,resolution:this.resolution,scale:this.scale})};return q}(p.JSONSupport);k.__decorate([h.property({type:l.Integer,json:{write:!0}})],a.prototype,"level",void 0);k.__decorate([h.property({type:String,json:{write:!0}})],a.prototype,"levelValue",void 0);k.__decorate([h.property({type:Number,
json:{write:!0}})],a.prototype,"resolution",void 0);k.__decorate([h.property({type:Number,json:{write:!0}})],a.prototype,"scale",void 0);return a=n=k.__decorate([c.subclass("esri.layers.support.LOD")],a)})},"esri/views/PopupView":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/arrayUtils ../core/promiseUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){b.PopupView=m=>{m=function(u){function v(){return u.apply(this,arguments)||this}k._inheritsLoose(v,u);var y=v.prototype;y.fetchPopupFeatures=async function(B,x){await this.when();const {location:C,queryArea:z,layerViewsAndGraphics:A,clientOnlyGraphics:t}=await this._prepareFetchPopupFeatures(B,x);B=q.resolve(t);x=this._queryLayerPopupFeatures({queryArea:z,layerViewsAndGraphics:A,options:x});const D=x.map(E=>E.promise);B=q.eachAlwaysValues([B,...D]).then(w.flatten);
return{location:C,clientOnlyGraphics:t,allGraphicsPromise:B,promisesPerLayerView:x}};y._queryLayerPopupFeatures=function({queryArea:B,layerViewsAndGraphics:x,options:C}){return x.map(({layerView:z,graphics:A})=>{A={clientGraphics:A,event:l.isSome(C)?C.event:null,signal:l.isSome(C)?C.signal:null,defaultPopupTemplateEnabled:l.isSome(C)?!!C.defaultPopupTemplateEnabled:!1};A=z.fetchPopupFeatures(B,A);return{layerView:z,promise:A}})};y._isValidPopupGraphic=function(B,x){return B&&!!B.getEffectivePopupTemplate(l.isSome(x)&&
x.defaultPopupTemplateEnabled)};y._prepareFetchPopupFeatures=async function(B,x){const {clientGraphics:C,queryArea:z,location:A}=await this._popupHitTestGraphics(B,x);B=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:t,clientOnlyGraphics:D}=this._graphicsPerFetchPopupLayerView(C,B);return{clientOnlyGraphics:D,layerViewsAndGraphics:t,queryArea:z,location:A}};y._popupHitTestGraphics=async function(B,x){const {results:C,mapPoint:z}=await this.popupHitTest(B);B=C.filter(t=>this._isValidPopupGraphic(t.graphic,
x));const A=B.length?B[0].mapPoint:null;return{clientGraphics:B.map(t=>t.graphic),queryArea:z,location:z||A}};y._getFetchPopupLayerViews=function(){const B=[];this.allLayerViews.forEach(x=>{this._isValidPopupLayerView(x)&&B.push(x)});l.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&B.push(this.graphicsView);return B.reverse()};y._isValidPopupLayerView=function(B){return l.isSome(B)&&(!("layer"in B)||!B.suspended)&&"fetchPopupFeatures"in B};y._graphicsPerFetchPopupLayerView=
function(B,x){const C=[],z=new Map;x=x.map(A=>{const t=[];"layer"in A?z.set(A.layer,t):z.set(A.graphics,t);return{layerView:A,graphics:t}});for(const A of B)(B=z.get(A.layer)||null)?B.push(A):C.push(A);return{layerViewsAndGraphics:x,clientOnlyGraphics:C}};return v}(m);return m=a.__decorate([f.subclass("esri.views.PopupView")],m)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/support/WebGLRequirements":function(){define(["exports","../../core/Error","../webgl/capabilities"],function(b,
k,a){const r={checkMajorWebPerformanceCaveat:!0};b.check=function(l){l={...r,...l};const h=a();return h.available?l.checkMajorWebPerformanceCaveat&&h.majorPerformanceCaveat?new k("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist."):h.supportsHighPrecisionFragment?h.supportsVertexShaderSamplers?h.supportsElementIndexUint?h.supportsStandardDerivatives?h.supportsInstancedArrays?
null:new k("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new k("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):new k("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new k("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new k("webgl:high-precision-fragment-required",
"WebGL support for high precision fragment shaders is required but not supported."):new k("webgl:required","WebGL is required but not supported.")};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/capabilities":function(){define(["./context-util"],function(b){function k(){const r={available:!1,version:0,majorPerformanceCaveat:!1,maxTextureSize:0,supportsHighPrecisionFragment:!1,supportsVertexShaderSamplers:!1,supportsElementIndexUint:!1,supportsStandardDerivatives:!1,supportsInstancedArrays:!1,
supportsTextureFloat:!1,supportsColorBufferFloat:!1};var l=document.createElement("canvas");if(!l)return r;var h=b.createContext(l,{failIfMajorPerformanceCaveat:!0},"webgl");!h&&(h=b.createContext(l,{},"webgl"))&&(r.majorPerformanceCaveat=!0);if(!h)return r;l=h.getParameter(h.VERSION);if(!l)return r;if(l=l.match(/^WebGL\s+([\d.]*)/)){l=parseFloat(l[1]);r.available=.94<=l;if(l=h.getShaderPrecisionFormat(h.FRAGMENT_SHADER,h.HIGH_FLOAT))r.supportsHighPrecisionFragment=0<l.precision;r.supportsVertexShaderSamplers=
0<h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS);r.supportsElementIndexUint=null!==h.getExtension("OES_element_index_uint");r.supportsStandardDerivatives=null!==h.getExtension("OES_standard_derivatives");r.supportsInstancedArrays=null!==h.getExtension("ANGLE_instanced_arrays");r.supportsTextureFloat=null!==h.getExtension("OES_texture_float");r.supportsColorBufferFloat=null!==h.getExtension("WEBGL_color_buffer_float")}r.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE);h=(h=document.createElement("canvas"))&&
b.createContext(h,{},"webgl2")?!0:!1;r.version=h?2:1;return r}let a;return function(){a||(a=k());return a}})},"esri/views/webgl/context-util":function(){define(["exports"],function(b){function k(r,l={},h){switch(h){case "webgl":h=["webgl","experimental-webgl","webkit-3d","moz-webgl"];break;case "webgl2":h=["webgl2"];break;default:h=["webgl","experimental-webgl","webkit-3d","moz-webgl"]}let d=null;for(const c of h){try{d=r.getContext(c,l)}catch(e){}if(d)break}return d}function a(r,l){(r=r.parentNode)&&
(r.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+l+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}b.createContext=k;b.createContextOrErrorHTML=function(r,l={},h){if(!window.WebGLRenderingContext)return a(r,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),
null;l=k(r,l,h);return l?l:(a(r,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e'),null)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/ViewingMode":function(){define(["exports"],function(b){b.stringFromViewingMode=function(k){return 1===k?"global":"local"};b.viewingModeFromString=function(k){return"global"===k?1:2};Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/maybe","../../core/Error"],function(b,k,a,r){function l(e){return Object.freeze({__proto__:null,"default":e})}const h=()=>new Promise(function(e,f){b(["./layers/TileLayerView3D"],function(g){e(l(g))},f)}),d=()=>new Promise(function(e,f){b(["./layers/ElevationLayerView3D"],function(g){e(l(g))},f)}),c={"base-dynamic":()=>new Promise(function(e,f){b(["./layers/BaseDynamicLayerView3D"],function(g){e(l(g))},f)}),
"base-elevation":d,"base-tile":h,"bing-maps":h,"building-scene":()=>new Promise(function(e,f){b(["./layers/BuildingSceneLayerView3D"],function(g){e(l(g))},f)}),csv:()=>new Promise(function(e,f){b(["./layers/CSVLayerView3D"],function(g){e(l(g))},f)}),elevation:d,feature:()=>new Promise(function(e,f){b(["./layers/FeatureLayerView3D"],function(g){e(l(g))},f)}),geojson:()=>new Promise(function(e,f){b(["./layers/GeoJSONLayerView3D"],function(g){e(l(g))},f)}),graphics:()=>new Promise(function(e,f){b(["./layers/GraphicsLayerView3D"],
function(g){e(l(g))},f)}),group:()=>new Promise(function(e,f){b(["../layers/GroupLayerView"],function(g){e(l(g))},f)}),imagery:()=>new Promise(function(e,f){b(["./layers/ImageryLayerView3D"],function(g){e(l(g))},f)}),"integrated-mesh":()=>new Promise(function(e,f){b(["./layers/IntegratedMeshLayerView3D"],function(g){e(l(g))},f)}),"map-image":()=>new Promise(function(e,f){b(["./layers/MapImageLayerView3D"],function(g){e(l(g))},f)}),"ogc-feature":()=>new Promise(function(e,f){b(["./layers/OGCFeatureLayerView3D"],
function(g){e(l(g))},f)}),"open-street-map":h,"point-cloud":()=>new Promise(function(e,f){b(["./layers/PointCloudLayerView3D"],function(g){e(l(g))},f)}),scene:e=>null==e.profile||"mesh-pyramids"===e.profile?new Promise(function(f,g){b(["./layers/SceneLayerView3D"],function(p){f(l(p))},g)}):new Promise(function(f,g){b(["./layers/SceneLayerGraphicsView3D"],function(p){f(l(p))},g)}),stream:()=>new Promise(function(e,f){b(["./layers/StreamLayerView3D"],function(g){e(l(g))},f)}),tile:h,"imagery-tile":()=>
new Promise(function(e,f){b(["./layers/ImageryTileLayerView3D"],function(g){e(l(g))},f)}),"vector-tile":()=>new Promise(function(e,f){b(["./layers/VectorTileLayerView3D"],function(g){e(l(g))},f)}),wcs:()=>new Promise(function(e,f){b(["./layers/ImageryTileLayerView3D"],function(g){e(l(g))},f)}),"web-tile":h,wms:()=>new Promise(function(e,f){b(["./layers/WMSLayerView3D"],function(g){e(l(g))},f)}),wmts:()=>new Promise(function(e,f){b(["./layers/WMTSLayerView3D"],function(g){e(l(g))},f)}),"geo-rss":null,
kml:null,"map-notes":null,route:null,unknown:null,unsupported:null};k.layerView3DImporter={hasLayerViewModule:e=>a.isSome(c[e.type]),importLayerView:e=>{var f=c[e.type];if(!a.isSome(f))throw e=e.declaredClass?e.declaredClass.slice(e.declaredClass.lastIndexOf(".")+1):"Unknown",f=e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),e=new r(`${f}:view-not-supported`,`${e} is not supported in 3D`),e;return f(e)}};Object.defineProperty(k,"__esModule",{value:!0})})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){b.Constraints=function(v){function y(){var B=v.apply(this,arguments)||this;B.tilt=new u["default"];B.altitude=new w["default"];B.clipDistance=new q["default"];B.collision=new m["default"];return B}k._inheritsLoose(y,v);return y}(n);a.__decorate([d.property({type:u["default"]})],b.Constraints.prototype,"tilt",void 0);a.__decorate([d.property({type:w["default"]})],b.Constraints.prototype,"altitude",void 0);a.__decorate([d.property({type:q["default"]})],b.Constraints.prototype,
"clipDistance",void 0);a.__decorate([d.property({type:m["default"]})],b.Constraints.prototype,"collision",void 0);b.Constraints=a.__decorate([e.subclass("esri.views.3d.constraints.Constraints")],b.Constraints);b.default=b.Constraints;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/deprecate ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../state/Constraints".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){b.AltitudeConstraint=function(m){function u(){var v=m.apply(this,arguments)||this;v.min=q.earthAltitudeConstraint.min;v.max=q.earthAltitudeConstraint.max;return v}k._inheritsLoose(u,m);k._createClass(u,[{key:"mode",set:function(v){c.deprecated(l.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"})},
get:function(){c.deprecated(l.getLogger(this.declaredClass),"esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",{version:"4.6"});return"manual"}}]);return u}(w);a.__decorate([d.property({type:Number})],b.AltitudeConstraint.prototype,"min",void 0);a.__decorate([d.property({type:Number})],b.AltitudeConstraint.prototype,"max",void 0);b.AltitudeConstraint=a.__decorate([f.subclass("esri.views.3d.constraints.AltitudeConstraint")],
b.AltitudeConstraint);b.default=b.AltitudeConstraint;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../geometry/support/Ellipsoid ../../../core/mathUtils ../support/mathUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){const u=l.getLogger("esri.views.3d.state.Constraints");b.Constraints=function(x){function C(A){A=x.call(this,A)||this;A.collision=new B;A.distance=Infinity;A.minimumPoiDistance=4;return A}k._inheritsLoose(C,x);var z=C.prototype;z.clampAltitude=function(A){return this.altitude?q.clamp(A,this.altitude.min,this.altitude.max):A};z.clampTilt=function(A,t){if(!this.tilt)return t;A=this.tilt(A);return q.clamp(t,A.min,A.max)};z.clampDistance=function(A){return Math.min(A,
this.distance)};z.createDefaultTilt=function(){return 2===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};z.createConstantMaxTilt=function(A){return(t,D=y)=>{D.min=v.min;D.max=A;return D}};z.createDefaultTiltLocal=function(){const A=this.collision.enabled?m.makePiecewiseLinearFunction([[4E3,v.max],[1E4,q.deg2rad(88)],[6E6,q.deg2rad(88)]]):()=>v.max;return(t,D=y)=>{D.min=v.min;D.max=A(t);return D}};z.createDefaultTiltGlobal=function(){const A=this.collision.enabled?m.makePiecewiseLinearFunction([[4E3,
v.max],[5E4,q.deg2rad(88)],[6E6,q.deg2rad(88)],[2E7,v.min]]):m.makePiecewiseLinearFunction([[3E5,v.max],[3E6,q.deg2rad(88)],[6E6,q.deg2rad(88)],[2E7,v.min]]);return(t,D=y)=>{D.min=v.min;D.max=A(t);return D}};k._createClass(C,[{key:"altitude",get:function(){return 2===this.mode?null:this._get("altitude")||null},set:function(A){2===this.mode?u.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",A)}}]);return C}(n);a.__decorate([d.property()],b.Constraints.prototype,"altitude",
null);a.__decorate([d.property({readOnly:!0})],b.Constraints.prototype,"collision",void 0);a.__decorate([d.property()],b.Constraints.prototype,"distance",void 0);a.__decorate([d.property({readOnly:!0})],b.Constraints.prototype,"minimumPoiDistance",void 0);a.__decorate([d.property()],b.Constraints.prototype,"tilt",void 0);a.__decorate([d.property({constructOnly:!0})],b.Constraints.prototype,"mode",void 0);b.Constraints=a.__decorate([e.subclass("esri.views.3d.state.Constraints")],b.Constraints);r={min:-2E5,
max:4*w.earth.radius};const v={min:q.deg2rad(.5),max:q.deg2rad(179.5)},y={min:0,max:0};let B=function(x){function C(){var z=x.apply(this,arguments)||this;z.enabled=!0;z.elevationMargin=5;return z}k._inheritsLoose(C,x);return C}(n);a.__decorate([d.property({type:Boolean})],B.prototype,"enabled",void 0);a.__decorate([d.property({type:Number})],B.prototype,"elevationMargin",void 0);B=a.__decorate([e.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],B);a=b.Constraints;b.TiltDefault=v;b.default=
a;b.earthAltitudeConstraint=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){b.ClipDistanceConstraint=function(w){function q(){var u=w.apply(this,arguments)||this;u.mode="auto";return u}k._inheritsLoose(q,w);var m=q.prototype;m.castNear=function(u){return Math.max(1E-8,u)};m.castFar=function(u){return Math.max(1E-8,u)};m.autoUpdate=function(u,v){"auto"===this.mode&&(this._get("near")!==u&&this._set("near",u),this._get("far")!==v&&this._set("far",v))};k._createClass(q,[{key:"near",get:function(){return this._get("near")},set:function(u){this._set("near",
u);u>=this._get("far")&&(this.far=u+1E-9);this.mode="manual"}},{key:"far",get:function(){return this._get("far")},set:function(u){this._set("far",u);u<=this._get("near")&&(this.near=u-1E-9);this.mode="manual"}}]);return q}(n);a.__decorate([h.property({type:Number,value:1E-8})],b.ClipDistanceConstraint.prototype,"near",null);a.__decorate([d.cast("near")],b.ClipDistanceConstraint.prototype,"castNear",null);a.__decorate([h.property({type:Number,value:1E-8})],b.ClipDistanceConstraint.prototype,"far",
null);a.__decorate([d.cast("far")],b.ClipDistanceConstraint.prototype,"castFar",null);a.__decorate([h.property({type:["auto","manual"]})],b.ClipDistanceConstraint.prototype,"mode",void 0);b.ClipDistanceConstraint=a.__decorate([e.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],b.ClipDistanceConstraint);b.default=b.ClipDistanceConstraint;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/constraints/CollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/deprecate ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){b.CollisionConstraint=function(q){function m(){return q.apply(this,arguments)||this}k._inheritsLoose(m,q);k._createClass(m,[{key:"enabled",set:function(u){c.deprecated(l.getLogger(this.declaredClass),"SceneView.constraint.collision.enabled",{replacement:"Map.ground.navigationConstraint",version:"4.8"});this._set("enabled",u)}}]);return m}(w);a.__decorate([d.property({value:!0})],b.CollisionConstraint.prototype,"enabled",null);b.CollisionConstraint=a.__decorate([f.subclass("esri.views.3d.constraints.CollisionConstraint")],
b.CollisionConstraint);b.default=b.CollisionConstraint;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../core/mathUtils ../state/Constraints".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){var m=w.rad2deg(q.TiltDefault.min),u=w.rad2deg(q.TiltDefault.max);b.TiltConstraint=function(v){function y(){var x=v.apply(this,arguments)||this;x.mode="auto";return x}k._inheritsLoose(y,v);var B=y.prototype;B.castMax=function(x){return w.clamp(x,m,u)};B.autoUpdate=function(x){"auto"===this.mode&&this._get("max")!==x&&this._set("max",x)};k._createClass(y,[{key:"max",get:function(){return this._get("max")},set:function(x){this._set("max",x);this.mode="manual"}}]);
return y}(n);a.__decorate([h.property({type:["auto","manual"]})],b.TiltConstraint.prototype,"mode",void 0);a.__decorate([h.property({type:Number,value:u})],b.TiltConstraint.prototype,"max",null);a.__decorate([d.cast("max")],b.TiltConstraint.prototype,"castMax",null);b.TiltConstraint=a.__decorate([e.subclass("esri.views.3d.constraints.TiltConstraint")],b.TiltConstraint);b.default=b.TiltConstraint;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../webscene/Lighting ../../../webscene/Environment ./SceneViewAtmosphere ./SceneViewLighting".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){var v;a=v=function(y){function B(C){C=y.call(this,C)||this;C.atmosphere=new m["default"];return C}b._inheritsLoose(B,y);B.fromWebsceneEnvironment=function(C){C=C.cloneConstructProperties();return new v({...C,lighting:u.SceneViewLighting.fromWebsceneLighting(C.lighting)})};var x=B.prototype;x.castLighting=function(C){return this.convertLighting(C)};x.updateLighting=function(C){this.lighting=this.convertLighting(C)};x.convertLighting=function(C){return C?
C instanceof u.SceneViewLighting?C:C instanceof w?this.lighting?this.lighting.cloneWithWebsceneLighting(C):u.SceneViewLighting.fromWebsceneLighting(C):h.ensureType(u.SceneViewLighting,C):new u.SceneViewLighting};x.clone=function(){return new v({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:r.clone(this.background)})};x.cloneWithWebsceneEnvironment=function(C){return new v({atmosphere:this.atmosphere.clone(),
atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:r.clone(this.background),...C.cloneConstructProperties(),lighting:null!=this.lighting?this.lighting.cloneWithWebsceneLighting(C.lighting):u.SceneViewLighting.fromWebsceneLighting(C.lighting)})};return B}(q);k.__decorate([d.property({type:m["default"],json:{read:!1}})],a.prototype,"atmosphere",void 0);k.__decorate([d.property()],a.prototype,"lighting",void 0);k.__decorate([c.cast("lighting")],a.prototype,"castLighting",
null);return a=v=k.__decorate([f.subclass("esri.views.3d.environment.SceneViewEnvironment")],a)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){var w;b.SceneViewAtmosphere=w=function(q){function m(){return q.apply(this,arguments)||this}k._inheritsLoose(m,q);m.prototype.clone=function(){return new w({quality:this.quality})};k._createClass(m,[{key:"quality",set:function(u){-1!==["low","high"].indexOf(u)&&this._set("quality",u)}}]);return m}(n);a.__decorate([d.property({type:["low","high"],value:"low"})],b.SceneViewAtmosphere.prototype,"quality",null);b.SceneViewAtmosphere=w=a.__decorate([e.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
b.SceneViewAtmosphere);b.default=b.SceneViewAtmosphere;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/environment/SceneViewLighting":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Evented ../../../webscene/Lighting".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){function q({hours:v,minutes:y,seconds:B}){return Math.round(v+y/60+B/3600)}var m;b.SceneViewLighting=m=function(v){function y(x){x=v.call(this,x)||this;x.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};x.cameraTrackingEnabled=!0;x.ambientOcclusionEnabled=!1;x.waterReflectionEnabled=!1;var C=(new Date).getFullYear();C=new Date("March 15, "+C+" 12:00:00 UTC");x._set("defaultDate",C);x._set("date",C);return x}k._inheritsLoose(y,v);y.fromWebsceneLighting=
function(x){return new m({...x.cloneConstructProperties()})};var B=y.prototype;B.autoUpdate=function(x,C){const z=q(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=C.hours;this.positionTimezoneInfo.minutes=C.minutes;this.positionTimezoneInfo.seconds=C.seconds;C=null;null!=x&&(this.positionTimezoneInfo.autoUpdated=!0,C=this.date&&this.date.getTime(),this._set("date",new Date(x.getTime())));const A=q(this.positionTimezoneInfo);z!==A&&(u.target=this,u.timezoneOffset=A,this.emit("timezone-will-change",
u));if(null!=x)return C!==x.getTime()};B.clone=function(){const x=this._get("date")===this._get("defaultDate"),C=new m({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});x&&C._set("date",C._get("defaultDate"));C.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;C.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;
C.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;C.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return C};B.cloneWithWebsceneLighting=function(x){const C=this.clone();null!=x.date&&(C.date=x.date);C.directShadowsEnabled=x.directShadowsEnabled;C.displayUTCOffset=x.displayUTCOffset;return C};k._createClass(y,[{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(x){const C=this._get("date")===this._get("defaultDate");x=
new Date(x.getTime());this._set("defaultDate",x);C&&this._set("date",x)}},{key:"date",set:function(x){null!=x&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(x.getTime())))}}]);return y}(n.EventedMixin(w));a.__decorate([d.property({type:Boolean})],b.SceneViewLighting.prototype,"cameraTrackingEnabled",void 0);a.__decorate([d.property({type:Boolean})],b.SceneViewLighting.prototype,"ambientOcclusionEnabled",void 0);a.__decorate([d.property({type:Boolean})],b.SceneViewLighting.prototype,
"waterReflectionEnabled",void 0);a.__decorate([d.property({type:Date})],b.SceneViewLighting.prototype,"defaultDate",null);a.__decorate([d.property({type:Date})],b.SceneViewLighting.prototype,"date",null);b.SceneViewLighting=m=a.__decorate([e.subclass("esri.views.3d.environment.SceneViewLighting")],b.SceneViewLighting);const u={target:null,timezoneOffset:0};a=b.SceneViewLighting;b.calculateTimezoneOffset=q;b.default=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ./vec3f64 ./vec3 ../views/3d/support/mathUtils ./mat4 ../core/ObjectStack ./mat4f64 ../views/3d/support/stack ./vector ./lineSegment ./plane ./ray".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){function m(Z=ca){return{plane:w.create(Z.plane),origin:l.clone(Z.origin),basis1:l.clone(Z.basis1),basis2:l.clone(Z.basis2)}}function u(Z,ba,ia){const ja=da.get();ja.origin=Z;ja.basis1=ba;ja.basis2=ia;ja.plane=w.wrap(0,0,0,0);B(ja);return ja}function v(Z,ba=m()){return y(Z.origin,Z.basis1,Z.basis2,ba)}function y(Z,ba,ia,ja=m()){h.copy(ja.origin,Z);h.copy(ja.basis1,ba);h.copy(ja.basis2,ia);B(ja);1E-6<Math.abs(h.dot(ja.basis1,ja.basis2)/(h.length(ja.basis1)*h.length(ja.basis2)))&&
X.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(h.dot(ja.basis1,N(ja)))&&X.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-h.dot(N(ja),ja.origin)-ja.plane[3])&&X.warn("fromValues()","Plane offset is not consistent with plane origin");return ja}function B(Z){w.fromVectorsAndPoint(Z.basis2,Z.basis1,Z.origin,Z.plane)}function x(Z,ba,ia){Z!==ia&&v(Z,ia);Z=h.scale(g.sv3d.get(),N(Z),ba);h.add(ia.origin,ia.origin,Z);ia.plane[3]-=
ba;return ia}function C(Z,ba,ia){z(ba,ia);x(ia,M(Z,Z.origin),ia);return ia}function z(Z,ba=m()){const ia=(Z[2]-Z[0])/2,ja=(Z[3]-Z[1])/2;h.set(ba.origin,Z[0]+ia,Z[1]+ja,0);h.set(ba.basis1,ia,0,0);h.set(ba.basis2,0,ja,0);w.fromValues(0,0,1,0,ba.plane);return ba}function A(Z,ba,ia){return w.intersectRay(Z.plane,ba,ia)?P(Z,ia):!1}function t(Z,ba,ia){if(A(Z,ba,ia))return ia;Z=D(Z,ba,g.sv3d.get());h.add(ia,ba.origin,h.scale(g.sv3d.get(),ba.direction,h.distance(ba.origin,Z)/h.length(ba.direction)));return ia}
function D(Z,ba,ia){const ja=R.get();var la=R.get();W(Z,ba,ja,la);la=Number.POSITIVE_INFINITY;for(const na of fa){var qa=V(Z,na,aa.get());const oa=g.sv3d.get();w.intersectLineSegment(ja,qa,oa)&&(qa=d.directionFromTo(g.sv3d.get(),ba.origin,oa),qa=Math.abs(r.acosClamped(h.dot(ba.direction,qa))),qa<la&&(la=qa,h.copy(ia,oa)))}return la===Number.POSITIVE_INFINITY?E(Z,ba,ia):ia}function E(Z,ba,ia){if(A(Z,ba,ia))return ia;const ja=R.get(),la=R.get();W(Z,ba,ja,la);let qa=Number.POSITIVE_INFINITY;for(const oa of fa){var na=
V(Z,oa,aa.get());const ua=g.sv3d.get();w.intersectLineSegmentClamp(ja,na,ua)&&(na=q.distance2(ba,ua),w.isPointInside(la,ua)&&na<qa&&(qa=na,h.copy(ia,ua)))}I(Z,ba.origin)<qa&&G(Z,ba.origin,ia);return ia}function G(Z,ba,ia){var ja=w.projectPoint(Z.plane,ba,g.sv3d.get());ba=n.projectPointClamp(U(Z,Z.basis1),ja,-1,1,g.sv3d.get());ja=n.projectPointClamp(U(Z,Z.basis2),ja,-1,1,g.sv3d.get());h.subtract(ia,h.add(g.sv3d.get(),ba,ja),Z.origin);return ia}function H(Z,ba,ia){const {origin:ja,basis1:la,basis2:qa}=
Z,na=h.subtract(g.sv3d.get(),ba,ja);ba=p.projectPointSignedLength(la,na);const oa=p.projectPointSignedLength(qa,na);Z=p.projectPointSignedLength(N(Z),na);return h.set(ia,ba,oa,Z)}function I(Z,ba){ba=H(Z,ba,g.sv3d.get());const {basis1:ia,basis2:ja}=Z;Z=h.length(ia);var la=h.length(ja);Z=Math.max(Math.abs(ba[0])-Z,0);la=Math.max(Math.abs(ba[1])-la,0);ba=ba[2];return Z*Z+la*la+ba*ba}function J(Z,ba){return Math.sqrt(I(Z,ba))}function K(Z,ba){let ia=Number.NEGATIVE_INFINITY;for(const la of fa){var ja=
V(Z,la,aa.get());ja=n.distance2(ja,ba);ja>ia&&(ia=ja)}return Math.sqrt(ia)}function L(Z,ba){return w.isPointInside(Z.plane,ba)&&P(Z,ba)}function S(Z,ba,ia,ja){switch(ia){case 0:h.copy(ja,Z.basis1);h.normalize(ja,ja);break;case 1:h.copy(ja,Z.basis2);h.normalize(ja,ja);break;case 2:h.copy(ja,N(Z))}return ja}function M(Z,ba){const ia=-Z.plane[3];return p.projectPointSignedLength(N(Z),ba)-ia}function T(Z,ba,ia,ja){const la=M(Z,ba);Z=h.scale(ka,N(Z),ia-la);h.add(ja,ba,Z);return ja}function O(Z,ba){return h.exactEquals(Z.basis1,
ba.basis1)&&h.exactEquals(Z.basis2,ba.basis2)&&h.exactEquals(Z.origin,ba.origin)}function Q(Z,ba,ia){Z!==ia&&v(Z,ia);c.invert(ea,ba);c.transpose(ea,ea);h.transformMat4(ia.basis1,Z.basis1,ea);h.transformMat4(ia.basis2,Z.basis2,ea);h.transformMat4(w.normal(ia.plane),w.normal(Z.plane),ea);h.transformMat4(ia.origin,Z.origin,ba);w.setOffsetFromPoint(ia.plane,ia.origin,ia.plane);return ia}function F(Z,ba,ia,ja){Z!==ja&&v(Z,ja);c.rotate(Y,c.identity(Y),ba,ia);h.transformMat4(ja.basis1,Z.basis1,Y);h.transformMat4(ja.basis2,
Z.basis2,Y);B(ja);return ja}function N(Z){return w.normal(Z.plane)}function P(Z,ba){const ia=h.subtract(g.sv3d.get(),ba,Z.origin);ba=h.squaredLength(Z.basis1);const ja=h.squaredLength(Z.basis2),la=h.dot(Z.basis1,ia);Z=h.dot(Z.basis2,ia);return 0>-la-ba&&0>la-ba&&0>-Z-ja&&0>Z-ja}function U(Z,ba){const ia=aa.get();h.copy(ia.origin,Z.origin);h.copy(ia.vector,ba);return ia}function V(Z,ba,ia){const {basis1:ja,basis2:la,origin:qa}=Z;Z=h.scale(g.sv3d.get(),ja,ba.origin[0]);const na=h.scale(g.sv3d.get(),
la,ba.origin[1]);h.add(ia.origin,Z,na);h.add(ia.origin,ia.origin,qa);Z=h.scale(g.sv3d.get(),ja,ba.direction[0]);ba=h.scale(g.sv3d.get(),la,ba.direction[1]);h.scale(ia.vector,h.add(Z,Z,ba),2);return ia}function W(Z,ba,ia,ja){Z=N(Z);w.fromVectorsAndPoint(Z,ba.direction,ba.origin,ia);w.fromVectorsAndPoint(w.normal(ia),Z,ba.origin,ja)}const X=a.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");k=function(){this.plane=w.create();this.origin=l.create();this.basis1=l.create();this.basis2=l.create()};
const ca={plane:w.create(),origin:l.fromValues(0,0,0),basis1:l.fromValues(1,0,0),basis2:l.fromValues(0,1,0)},R=new e.ObjectStack(w.create),aa=new e.ObjectStack(n.create),ka=l.create(),da=new e.ObjectStack(()=>({origin:null,basis1:null,basis2:null,plane:null})),fa=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ea=f.create(),Y=f.create();e=Object.freeze({__proto__:null,BoundedPlaneClass:k,create:m,wrap:u,copy:v,fromValues:y,
updateUnboundedPlane:B,elevate:x,setExtent:C,fromAABoundingRect:z,intersectRay:A,intersectRayClosestSilhouette:t,closestPointOnSilhouette:D,closestPoint:E,projectPoint:G,projectPointLocal:H,distance2:I,distance:J,distanceToSilhouette:K,extrusionContainsPoint:L,axisAt:S,altitudeAt:M,setAltitudeAt:T,equals:O,transform:Q,rotate:F,normal:N,UP:ca});b.BoundedPlaneClass=k;b.UP=ca;b.altitudeAt=M;b.axisAt=S;b.boundedPlaneModule=e;b.closestPoint=E;b.closestPointOnSilhouette=D;b.copy=v;b.create=m;b.distance=
J;b.distance2=I;b.distanceToSilhouette=K;b.elevate=x;b.equals=O;b.extrusionContainsPoint=L;b.fromAABoundingRect=z;b.fromValues=y;b.intersectRay=A;b.intersectRayClosestSilhouette=t;b.normal=N;b.projectPoint=G;b.projectPointLocal=H;b.rotate=F;b.setAltitudeAt=T;b.setExtent=C;b.transform=Q;b.updateUnboundedPlane=B;b.wrap=u})},"esri/core/ObjectStack":function(){define(["exports","./maybe","./nextTick"],function(b,k,a){let r=function(){function l(d){this.allocator=d;this.items=[];this.itemsPtr=0;this.tickHandle=
a.before(()=>this.reset());this.grow()}var h=l.prototype;h.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=k.nullifyNonnullableForDispose(this.tickHandle));this.items=k.nullifyNonnullableForDispose(this.items)};h.get=function(){0===this.itemsPtr&&a(()=>{});this.itemsPtr===this.items.length&&this.grow();return this.items[this.itemsPtr++]};h.reset=function(){this.items.length=Math.min(Math.min(3*Math.max(8,this.itemsPtr),this.itemsPtr+3072),this.items.length);this.itemsPtr=
0};h.grow=function(){for(let d=0;d<Math.max(8,Math.min(this.items.length,1024));d++)this.items.push(this.allocator())};return l}();b.ObjectStack=r;b.default=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/mat4f64":function(){define(["exports"],function(b){function k(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a(c){return[c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],c[8],c[9],c[10],c[11],c[12],c[13],c[14],c[15]]}function r(c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){return[c,e,f,g,p,n,w,
q,m,u,v,y,B,x,C,z]}function l(c,e){return new Float64Array(c,e,16)}const h=k();var d=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,createView:l,IDENTITY:h});b.IDENTITY=h;b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.mat4f64=d})},"esri/views/3d/support/stack":function(){define(["exports","../../../core/VectorStack"],function(b,k){const a=k.VectorStack.createVec2f64(),r=k.VectorStack.createVec3f64(),l=k.VectorStack.createVec4f64(),h=k.VectorStack.createMat3f64(),d=k.VectorStack.createMat4f64();
k=k.VectorStack.createQuatf64();b.sm3d=h;b.sm4d=d;b.sq4d=k;b.sv2d=a;b.sv3d=r;b.sv4d=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/VectorStack":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./maybe ./nextTick ../chunks/vec3f64 ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec4f64".split(" "),function(b,k,a,r,l,h,d,c,e,f){let g=function(){function p(w,q,m){this.itemByteSize=w;this.itemCreate=q;this.buffers=[];this.items=[];this.itemsPtr=
this.itemsPerBuffer=0;this.itemsPerBuffer=Math.ceil(m/this.itemByteSize);this.tickHandle=r.before(()=>this.reset())}var n=p.prototype;n.destroy=function(){this.tickHandle&&(this.tickHandle.remove(),this.tickHandle=a.nullifyNonnullableForDispose(this.tickHandle));this.itemsPtr=0;this.items=a.nullifyNonnullableForDispose(this.items);this.buffers=a.nullifyNonnullableForDispose(this.buffers)};n.get=function(){0===this.itemsPtr&&r(()=>{});const w=Math.floor(this.itemsPtr/this.itemsPerBuffer);for(;this.buffers.length<=
w;){const q=new ArrayBuffer(this.itemsPerBuffer*this.itemByteSize);for(let m=0;m<this.itemsPerBuffer;++m)this.items.push(this.itemCreate(q,m*this.itemByteSize));this.buffers.push(q)}return this.items[this.itemsPtr++]};n.reset=function(){const w=2*(Math.floor(this.itemsPtr/this.itemsPerBuffer)+1);for(;this.buffers.length>w;)this.buffers.pop(),this.items.length=this.buffers.length*this.itemsPerBuffer;this.itemsPtr=0};p.createVec2f64=function(w=4096){return new p(16,e.createView,w)};p.createVec3f64=
function(w=4096){return new p(24,l.createView,w)};p.createVec4f64=function(w=4096){return new p(32,f.createView,w)};p.createMat3f64=function(w=4096){return new p(72,h.createView,w)};p.createMat4f64=function(w=4096){return new p(128,d.createView,w)};p.createQuatf64=function(w=4096){return new p(32,c.createView,w)};k._createClass(p,[{key:"test",get:function(){return{size:this.buffers.length*this.itemsPerBuffer*this.itemByteSize}}}]);return p}();b.VectorStack=g;Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/chunks/mat3f64":function(){define(["exports"],function(b){function k(){return[1,0,0,0,1,0,0,0,1]}function a(d){return[d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8]]}function r(d,c,e,f,g,p,n,w,q){return[d,c,e,f,g,p,n,w,q]}function l(d,c){return new Float64Array(d,c,9)}var h=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,createView:l});b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.mat3f64=h})},"esri/chunks/quatf64":function(){define(["exports"],function(b){function k(){return[0,
0,0,1]}function a(c){return[c[0],c[1],c[2],c[3]]}function r(c,e,f,g){return[c,e,f,g]}function l(c,e){return new Float64Array(c,e,4)}const h=k();var d=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,createView:l,IDENTITY:h});b.IDENTITY=h;b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.quatf64=d})},"esri/chunks/vec2f64":function(){define(["exports"],function(b){function k(){return[0,0]}function a(m){return[m[0],m[1]]}function r(m,u){return[m,u]}function l(m){const u=[0,0],v=Math.min(2,
m.length);for(let y=0;y<v;++y)u[y]=m[y];return u}function h(m,u){return new Float64Array(m,u,2)}function d(){return[0,0]}function c(){return[1,1]}function e(){return[1,0]}function f(){return[0,1]}const g=[0,0],p=[1,1],n=[1,0],w=[0,1];var q=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,fromArray:l,createView:h,zeros:d,ones:c,unitX:e,unitY:f,ZEROS:g,ONES:p,UNIT_X:n,UNIT_Y:w});b.ONES=p;b.UNIT_X=n;b.UNIT_Y=w;b.ZEROS=g;b.clone=a;b.create=k;b.createView=h;b.fromArray=l;b.fromValues=r;b.ones=
c;b.unitX=e;b.unitY=f;b.vec2f64=q;b.zeros=d})},"esri/chunks/vec4f64":function(){define(["exports"],function(b){function k(){return[0,0,0,0]}function a(B){return[B[0],B[1],B[2],B[3]]}function r(B,x,C,z){return[B,x,C,z]}function l(B){const x=k(),C=Math.min(4,B.length);for(let z=0;z<C;++z)x[z]=B[z];return x}function h(B,x){return new Float64Array(B,x,4)}function d(){return k()}function c(){return[1,1,1,1]}function e(){return[1,0,0,0]}function f(){return[0,1,0,0]}function g(){return[0,0,1,0]}function p(){return[0,
0,0,1]}const n=k(),w=c(),q=e(),m=f(),u=g(),v=p();var y=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,fromArray:l,createView:h,zeros:d,ones:c,unitX:e,unitY:f,unitZ:g,unitW:p,ZEROS:n,ONES:w,UNIT_X:q,UNIT_Y:m,UNIT_Z:u,UNIT_W:v});b.ONES=w;b.UNIT_W=v;b.UNIT_X=q;b.UNIT_Y=m;b.UNIT_Z=u;b.ZEROS=n;b.clone=a;b.create=k;b.createView=h;b.fromArray=l;b.fromValues=r;b.ones=c;b.unitW=p;b.unitX=e;b.unitY=f;b.unitZ=g;b.vec4f64=y;b.zeros=d})},"esri/chunks/vector":function(){define(["exports","../core/mathUtils",
"./vec3f64","./vec3"],function(b,k,a,r){function l(g,p,n){p=r.dot(g,p)/r.dot(g,g);return r.scale(n,g,p)}function h(g,p){return r.dot(g,p)/r.length(g)}function d(g,p){g=r.dot(g,p)/(r.length(g)*r.length(p));return-k.acosClamped(g)}function c(g,p,n){r.normalize(e,g);r.normalize(f,p);g=r.dot(e,f);g=k.acosClamped(g);p=r.cross(e,e,f);return 0>r.dot(p,n)?2*Math.PI-g:g}const e=a.create(),f=a.create();a=Object.freeze({__proto__:null,projectPoint:l,projectPointSignedLength:h,angle:d,angleAroundAxis:c});b.angle=
d;b.angleAroundAxis=c;b.projectPoint=l;b.projectPointSignedLength=h;b.vectorModule=a})},"esri/chunks/lineSegment":function(){define("exports ../core/mathUtils ./vec3f64 ./vec3 ../core/ObjectStack ../views/3d/support/stack".split(" "),function(b,k,a,r,l,h){function d(z){return z?{origin:a.clone(z.origin),vector:a.clone(z.vector)}:{origin:a.create(),vector:a.create()}}function c(z,A){const t=C.get();t.origin=z;t.vector=A;return t}function e(z,A=d()){return f(z.origin,z.vector,A)}function f(z,A,t=d()){r.copy(t.origin,
z);r.copy(t.vector,A);return t}function g(z,A,t=d()){r.copy(t.origin,z);r.subtract(t.vector,A,z);return t}function p(z,A){A=r.subtract(h.sv3d.get(),A,z.origin);var t=r.dot(z.vector,A);const D=r.dot(z.vector,z.vector);t=k.clamp(t/D,0,1);z=r.subtract(h.sv3d.get(),r.scale(h.sv3d.get(),z.vector,t),A);return r.dot(z,z)}function n(z,A){return Math.sqrt(p(z,A))}function w(z,A,t){return m(z,A,0,1,t)}function q(z,A,t){return r.add(t,z.origin,r.scale(t,z.vector,A))}function m(z,A,t,D,E){const {vector:G,origin:H}=
z;A=r.subtract(h.sv3d.get(),A,H);const I=r.length(G);A=r.dot(G,A)/I;r.scale(E,G,k.clamp(A,t,D));return r.add(E,E,z.origin)}function u(z,A){if(B(z,c(A.origin,A.direction),!1,x)){const {tA:t,pB:D,distance2:E}=x;if(0<=t&&1>=t)return E;if(0>t)return r.squaredDistance(z.origin,D);if(1<t)return r.squaredDistance(r.add(h.sv3d.get(),z.origin,z.vector),D)}return null}function v(z,A,t){return B(z,A,!0,x)?(r.copy(t,x.pA),!0):!1}function y(z,A){return B(z,A,!0,x)?x.distance2:null}function B(z,A,t,D){const E=
z.origin;var G=r.add(h.sv3d.get(),E,z.vector);z=A.origin;var H=r.add(h.sv3d.get(),z,A.vector),I=h.sv3d.get();A=h.sv3d.get();I[0]=E[0]-z[0];I[1]=E[1]-z[1];I[2]=E[2]-z[2];A[0]=H[0]-z[0];A[1]=H[1]-z[1];A[2]=H[2]-z[2];if(1E-6>Math.abs(A[0])&&1E-6>Math.abs(A[1])&&1E-6>Math.abs(A[2]))return!1;H=h.sv3d.get();H[0]=G[0]-E[0];H[1]=G[1]-E[1];H[2]=G[2]-E[2];if(1E-6>Math.abs(H[0])&&1E-6>Math.abs(H[1])&&1E-6>Math.abs(H[2]))return!1;G=I[0]*A[0]+I[1]*A[1]+I[2]*A[2];var J=A[0]*H[0]+A[1]*H[1]+A[2]*H[2];const K=A[0]*
A[0]+A[1]*A[1]+A[2]*A[2],L=(H[0]*H[0]+H[1]*H[1]+H[2]*H[2])*K-J*J;if(1E-6>Math.abs(L))return!1;I=(G*J-(I[0]*H[0]+I[1]*H[1]+I[2]*H[2])*K)/L;G=(G+J*I)/K;t&&(I=k.clamp(I,0,1),G=k.clamp(G,0,1));t=h.sv3d.get();J=h.sv3d.get();t[0]=E[0]+I*H[0];t[1]=E[1]+I*H[1];t[2]=E[2]+I*H[2];J[0]=z[0]+G*A[0];J[1]=z[1]+G*A[1];J[2]=z[2]+G*A[2];D.tA=I;D.tB=G;D.pA=t;D.pB=J;D.distance2=r.squaredDistance(t,J);return!0}const x={tA:0,tB:0,pA:a.create(),pB:a.create(),distance2:0},C=new l.ObjectStack(()=>({origin:null,vector:null}));
l=Object.freeze({__proto__:null,create:d,wrap:c,copy:e,fromValues:f,fromPoints:g,distance2:p,distance:n,projectPoint:w,pointAt:q,projectPointClamp:m,closestRayDistance2:u,closestLineSegmentPoint:v,closestLineSegmentDistance2:y});b.closestLineSegmentDistance2=y;b.closestLineSegmentPoint=v;b.closestRayDistance2=u;b.copy=e;b.create=d;b.distance=n;b.distance2=p;b.fromPoints=g;b.fromValues=f;b.lineSegmentModule=l;b.pointAt=q;b.projectPoint=w;b.projectPointClamp=m;b.wrap=c})},"esri/chunks/plane":function(){define("exports ../core/maybe ../core/mathUtils ./vec3f64 ./vec3 ../views/3d/support/stack".split(" "),
function(b,k,a,r,l,h){function d(P=N){return[P[0],P[1],P[2],P[3]]}function c(P,U,V,W){return f(P,U,V,W,h.sv4d.get())}function e(P,U=d()){return f(P[0],P[1],P[2],P[3],U)}function f(P,U,V,W,X=d()){X[0]=P;X[1]=U;X[2]=V;X[3]=W;return X}function g(P,U,V=d()){l.copy(V,P);V[3]=U;return V}function p(P,U,V=d()){l.copy(V,U);U=l.dot(U,U);1E-5<Math.abs(U-1)&&1E-12<U&&l.scale(V,V,1/Math.sqrt(U));m(V,P,V);return V}function n(P,U,V,W=d()){return v(l.subtract(h.sv3d.get(),P,U),l.subtract(h.sv3d.get(),V,U),P,W)}function w(P,
U){return q(P,U,0,1,2)}function q(P,U,V,W,X){if(3>P.count)return!1;P.getVec(V,M);let ca=W,R=!1;for(;ca<P.count-1&&!R;)P.getVec(ca,T),ca++,R=!l.exactEquals(M,T);if(!R)return!1;ca=Math.max(ca,X);for(R=!1;ca<P.count&&!R;)P.getVec(ca,O),ca++,l.subtract(Q,M,T),l.normalize(Q,Q),l.subtract(F,T,O),l.normalize(F,F),R=!l.exactEquals(M,O)&&!l.exactEquals(T,O)&&.99619469809>Math.abs(l.dot(Q,F));if(!R)return 0===V&&1===W&&2===X?!1:q(P,U,0,1,2);n(M,T,O,U);return!0}function m(P,U,V){P!==V&&e(P,V);V[3]=-l.dot(V,
U);return V}function u(P,U){U[0]=-P[0];U[1]=-P[1];U[2]=-P[2];U[3]=-P[3];return U}function v(P,U,V,W=d()){P=l.cross(h.sv3d.get(),U,P);return p(V,P,W)}function y(P,U,V){return k.isSome(U)?L(P,U.origin,U.direction,!0,!1,V):!1}function B(P,U,V){return L(P,U.origin,U.vector,!1,!1,V)}function x(P,U,V){return L(P,U.origin,U.vector,!1,!0,V)}function C(P,U){const {center:V,radius:W}=U;return 0<=K(P,V)-W}function z(P,U){const {center:V,radius:W}=U;return 0>K(P,V)+W}function A(P,U){return 0<=K(P,U)}function t(P,
U){return 0>K(P,U)}function D(P,U){const V=U[0],W=U[1],X=U[2],ca=U[3],R=U[4];U=U[5];return 0<=P[0]*(0<P[0]?V:ca)+P[1]*(0<P[1]?W:R)+P[2]*(0<P[2]?X:U)+P[3]}function E(P,U){const V=l.dot(P,U.ray.direction);P=-K(P,U.ray.origin);if(0>P&&0<=V)return!1;if(-1E-6<V&&1E-6>V)return 0<P;if((0>P||0>V)&&!(0>P&&0>V))return!0;P/=V;0<V?P<U.c1&&(U.c1=P):P>U.c0&&(U.c0=P);return U.c0<=U.c1}function G(P,U){const V=l.dot(P,U.ray.direction);P=-K(P,U.ray.origin);if(-1E-6<V&&1E-6>V)return 0<P;P/=V;0<V?P<U.c1&&(U.c1=P):P>
U.c0&&(U.c0=P);return U.c0<=U.c1}function H(P,U,V){const W=l.scale(h.sv3d.get(),P,-P[3]);U=l.subtract(h.sv3d.get(),U,W);P=I(P,U,h.sv3d.get());l.add(V,P,W);return V}function I(P,U,V){P=l.scale(h.sv3d.get(),P,l.dot(P,U));l.subtract(V,U,P);return V}function J(P,U){return Math.abs(K(P,U))}function K(P,U){return l.dot(P,U)+P[3]}function L(P,U,V,W,X,ca){const R=l.dot(P,V);if(0===R)return!1;P=-(l.dot(P,U)+P[3])/R;X&&(P=W?Math.max(0,P):a.clamp(P,0,1));if(0>P||!W&&1<P)return!1;l.add(ca,U,l.scale(ca,V,P));
return!0}function S(P){return P}const M=r.create(),T=r.create(),O=r.create(),Q=r.create(),F=r.create(),N=[0,0,1,0];r=Object.freeze({__proto__:null,create:d,wrap:c,copy:e,fromValues:f,fromNormalAndOffset:g,fromPositionAndNormal:p,fromPoints:n,fromManyPoints:w,fromManyPointsSampleAt:q,setOffsetFromPoint:m,negate:u,fromVectorsAndPoint:v,intersectRay:y,intersectLineSegment:B,intersectLineSegmentClamp:x,isSphereFullyInside:C,isSphereFullyOutside:z,isPointInside:A,isPointOutside:t,isAABBFullyInside:D,clip:E,
clipInfinite:G,projectPoint:H,projectVector:I,distance:J,signedDistance:K,normal:S,UP:N});b.UP=N;b.clip=E;b.clipInfinite=G;b.copy=e;b.create=d;b.distance=J;b.fromManyPoints=w;b.fromManyPointsSampleAt=q;b.fromNormalAndOffset=g;b.fromPoints=n;b.fromPositionAndNormal=p;b.fromValues=f;b.fromVectorsAndPoint=v;b.intersectLineSegment=B;b.intersectLineSegmentClamp=x;b.intersectRay=y;b.isAABBFullyInside=D;b.isPointInside=A;b.isPointOutside=t;b.isSphereFullyInside=C;b.isSphereFullyOutside=z;b.negate=u;b.normal=
S;b.planeModule=r;b.projectPoint=H;b.projectVector=I;b.setOffsetFromPoint=m;b.signedDistance=K;b.wrap=c})},"esri/chunks/ray":function(){define("exports ../core/maybe ../core/screenUtils ./vec3f64 ./vec3 ../core/ObjectStack ./vec2 ../views/3d/support/stack".split(" "),function(b,k,a,r,l,h,d,c){function e(z){return z?{origin:r.clone(z.origin),direction:r.clone(z.direction)}:{origin:r.create(),direction:r.create()}}function f(z,A){const t=C.get();t.origin=z;t.direction=A;return t}function g(z,A=e()){return n(z.origin,
z.direction,A)}function p(z,A,t=e()){l.copy(t.origin,z);l.subtract(t.direction,A,z);return t}function n(z,A,t=e()){l.copy(t.origin,z);l.copy(t.direction,A);return t}function w(z,A,t=e()){return q(z,z.screenToRender(A,a.castRenderScreenPointArray3(c.sv3d.get())),t)}function q(z,A,t=e()){const D=a.castRenderScreenPointArray3(d.copy(c.sv3d.get(),A));D[2]=0;if(!z.unprojectFromRenderScreen(D,t.origin))return null;A=a.castRenderScreenPointArray3(d.copy(c.sv3d.get(),A));A[2]=1;z=z.unprojectFromRenderScreen(A,
c.sv3d.get());if(k.isNone(z))return null;l.subtract(t.direction,z,t.origin);return t}function m(z,A,t=e()){return u(z,z.screenToRender(A,a.castRenderScreenPointArray3(c.sv3d.get())),t)}function u(z,A,t=e()){l.copy(t.origin,z.eye);A=l.set(c.sv3d.get(),A[0],A[1],1);z=z.unprojectFromRenderScreen(A,c.sv3d.get());if(k.isNone(z))return null;l.subtract(t.direction,z,t.origin);return t}function v(z,A){z=l.cross(c.sv3d.get(),l.normalize(c.sv3d.get(),z.direction),l.subtract(c.sv3d.get(),A,z.origin));return l.dot(z,
z)}function y(z,A){return Math.sqrt(v(z,A))}function B(z,A,t){A=l.dot(z.direction,l.subtract(t,A,z.origin));l.add(t,z.origin,l.scale(t,z.direction,A));return t}function x(){return{origin:null,direction:null}}const C=new h.ObjectStack(x);h=Object.freeze({__proto__:null,create:e,wrap:f,copy:g,fromPoints:p,fromValues:n,fromScreen:w,fromRender:q,fromScreenAtEye:m,fromRenderAtEye:u,distance2:v,distance:y,closestPoint:B,createWrapper:x});b.closestPoint=B;b.copy=g;b.create=e;b.createWrapper=x;b.distance=
y;b.distance2=v;b.fromPoints=p;b.fromRender=q;b.fromRenderAtEye=u;b.fromScreen=w;b.fromScreenAtEye=m;b.fromValues=n;b.rayModule=h;b.wrap=f})},"esri/chunks/vec2":function(){define(["exports","./common"],function(b,k){function a(O,Q){O[0]=Q[0];O[1]=Q[1];return O}function r(O,Q,F){O[0]=Q;O[1]=F;return O}function l(O,Q,F){O[0]=Q[0]+F[0];O[1]=Q[1]+F[1];return O}function h(O,Q,F){O[0]=Q[0]-F[0];O[1]=Q[1]-F[1];return O}function d(O,Q,F){O[0]=Q[0]*F[0];O[1]=Q[1]*F[1];return O}function c(O,Q,F){O[0]=Q[0]/
F[0];O[1]=Q[1]/F[1];return O}function e(O,Q){O[0]=Math.ceil(Q[0]);O[1]=Math.ceil(Q[1]);return O}function f(O,Q){O[0]=Math.floor(Q[0]);O[1]=Math.floor(Q[1]);return O}function g(O,Q,F){O[0]=Math.min(Q[0],F[0]);O[1]=Math.min(Q[1],F[1]);return O}function p(O,Q,F){O[0]=Math.max(Q[0],F[0]);O[1]=Math.max(Q[1],F[1]);return O}function n(O,Q){O[0]=Math.round(Q[0]);O[1]=Math.round(Q[1]);return O}function w(O,Q,F){O[0]=Q[0]*F;O[1]=Q[1]*F;return O}function q(O,Q,F,N){O[0]=Q[0]+F[0]*N;O[1]=Q[1]+F[1]*N;return O}
function m(O,Q){const F=Q[0]-O[0];O=Q[1]-O[1];return Math.sqrt(F*F+O*O)}function u(O,Q){const F=Q[0]-O[0];O=Q[1]-O[1];return F*F+O*O}function v(O){const Q=O[0];O=O[1];return Math.sqrt(Q*Q+O*O)}function y(O){const Q=O[0];O=O[1];return Q*Q+O*O}function B(O,Q){O[0]=-Q[0];O[1]=-Q[1];return O}function x(O,Q){O[0]=1/Q[0];O[1]=1/Q[1];return O}function C(O,Q){var F=Q[0];const N=Q[1];F=F*F+N*N;0<F&&(F=1/Math.sqrt(F),O[0]=Q[0]*F,O[1]=Q[1]*F);return O}function z(O,Q){return O[0]*Q[0]+O[1]*Q[1]}function A(O,
Q,F){Q=Q[0]*F[1]-Q[1]*F[0];O[0]=O[1]=0;O[2]=Q;return O}function t(O,Q,F,N){const P=Q[0];Q=Q[1];O[0]=P+N*(F[0]-P);O[1]=Q+N*(F[1]-Q);return O}function D(O,Q){Q=Q||1;const F=2*k.RANDOM()*Math.PI;O[0]=Math.cos(F)*Q;O[1]=Math.sin(F)*Q;return O}function E(O,Q,F){const N=Q[0];Q=Q[1];O[0]=F[0]*N+F[2]*Q;O[1]=F[1]*N+F[3]*Q;return O}function G(O,Q,F){const N=Q[0];Q=Q[1];O[0]=F[0]*N+F[2]*Q+F[4];O[1]=F[1]*N+F[3]*Q+F[5];return O}function H(O,Q,F){const N=Q[0];Q=Q[1];O[0]=F[0]*N+F[3]*Q+F[6];O[1]=F[1]*N+F[4]*Q+F[7];
return O}function I(O,Q,F){const N=Q[0];Q=Q[1];O[0]=F[0]*N+F[4]*Q+F[12];O[1]=F[1]*N+F[5]*Q+F[13];return O}function J(O,Q,F,N){const P=Q[0]-F[0];Q=Q[1]-F[1];const U=Math.sin(N);N=Math.cos(N);O[0]=P*N-Q*U+F[0];O[1]=P*U+Q*N+F[1];return O}function K(O,Q){var F=O[0];O=O[1];const N=Q[0];Q=Q[1];let P=F*F+O*O;0<P&&(P=1/Math.sqrt(P));let U=N*N+Q*Q;0<U&&(U=1/Math.sqrt(U));F=(F*N+O*Q)*P*U;return 1<F?0:-1>F?Math.PI:Math.acos(F)}function L(O){return"vec2("+O[0]+", "+O[1]+")"}function S(O,Q){return O[0]===Q[0]&&
O[1]===Q[1]}function M(O,Q){const F=O[0];O=O[1];const N=Q[0];Q=Q[1];return Math.abs(F-N)<=k.EPSILON*Math.max(1,Math.abs(F),Math.abs(N))&&Math.abs(O-Q)<=k.EPSILON*Math.max(1,Math.abs(O),Math.abs(Q))}var T=Object.freeze({__proto__:null,copy:a,set:r,add:l,subtract:h,multiply:d,divide:c,ceil:e,floor:f,min:g,max:p,round:n,scale:w,scaleAndAdd:q,distance:m,squaredDistance:u,length:v,squaredLength:y,negate:B,inverse:x,normalize:C,dot:z,cross:A,lerp:t,random:D,transformMat2:E,transformMat2d:G,transformMat3:H,
transformMat4:I,rotate:J,angle:K,str:L,exactEquals:S,equals:M,len:v,sub:h,mul:d,div:c,dist:m,sqrDist:u,sqrLen:y});b.add=l;b.angle=K;b.ceil=e;b.copy=a;b.cross=A;b.dist=m;b.distance=m;b.div=c;b.divide=c;b.dot=z;b.equals=M;b.exactEquals=S;b.floor=f;b.inverse=x;b.len=v;b.length=v;b.lerp=t;b.max=p;b.min=g;b.mul=d;b.multiply=d;b.negate=B;b.normalize=C;b.random=D;b.rotate=J;b.round=n;b.scale=w;b.scaleAndAdd=q;b.set=r;b.sqrDist=u;b.sqrLen=y;b.squaredDistance=u;b.squaredLength=y;b.str=L;b.sub=h;b.subtract=
h;b.transformMat2=E;b.transformMat2d=G;b.transformMat3=H;b.transformMat4=I;b.vec2=T})},"esri/views/3d/support/geometryUtils":function(){define("exports ../../../chunks/vector ../../../chunks/axisAngle ../../../chunks/lineSegment ../../../chunks/plane ../../../chunks/ray ../../../chunks/boundedPlane ../../../chunks/clipRay ../../../chunks/frustum ../../../chunks/sphere ../../../chunks/triangle".split(" "),function(b,k,a,r,l,h,d,c,e,f,g){l=l.planeModule;d=d.boundedPlaneModule;g=g.triangleModule;r=r.lineSegmentModule;
h=h.rayModule;c=c.clipRayModule;f=f.sphereModule;e=e.frustumModule;k=k.vectorModule;b.axisAngle=a.axisAngleModule;b.boundedPlane=d;b.clipRay=c;b.frustum=e;b.lineSegment=r;b.plane=l;b.ray=h;b.sphere=f;b.triangle=g;b.vector=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/axisAngle":function(){define(["exports","./vec3","../views/3d/support/stack","./vector"],function(b,k,a,r){function l(q=n){return[q[0],q[1],q[2],q[3]]}function h(q,m,u,v){return e(q,m,u,v,a.sv4d.get())}function d(q,
m){return e(q[0],q[1],q[2],m,a.sv4d.get())}function c(q,m=l()){return e(q[0],q[1],q[2],q[3],m)}function e(q,m,u,v,y=l()){y[0]=q;y[1]=m;y[2]=u;y[3]=v;return y}function f(q,m,u=l()){k.copy(u,q);u[3]=m;return u}function g(q,m,u=l()){k.cross(u,q,m);k.normalize(u,u);u[3]=r.angle(q,m);return u}function p(q){return q}const n=[0,0,1,0];var w=Object.freeze({__proto__:null,create:l,wrap:h,wrapAxisAngle:d,copy:c,fromValues:e,fromAxisAndAngle:f,fromPoints:g,axis:p,UP:n});b.UP=n;b.axis=p;b.axisAngleModule=w;b.copy=
c;b.create=l;b.fromAxisAndAngle=f;b.fromPoints=g;b.fromValues=e;b.wrap=h;b.wrapAxisAngle=d})},"esri/chunks/clipRay":function(){define(["exports","./vec3","../core/ObjectStack","../views/3d/support/stack","./ray"],function(b,k,a,r,l){function h(u){return u?{ray:l.create(u.ray),c0:u.c0,c1:u.c1}:{ray:l.create(),c0:0,c1:Number.MAX_VALUE}}function d(u,v,y){const B=m.get();B.ray=u;B.c0=v;B.c1=y;return B}function c(u,v=h()){return e(u.ray,u.c0,u.c1,v)}function e(u,v,y,B=h()){l.copy(u,B.ray);B.c0=v;B.c1=
y;return B}function f(u,v=h()){l.copy(u,v.ray);v.c0=0;v.c1=Number.MAX_VALUE;return v}function g(u,v=h()){const y=k.normalize(r.sv3d.get(),u.vector);return p(u,y,v)}function p(u,v,y=h()){const B=k.length(u.vector);l.fromValues(u.origin,v,y.ray);y.c0=0;y.c1=B;return y}function n(u,v){return q(u,u.c0,v)}function w(u,v){return q(u,u.c1,v)}function q(u,v,y){return k.add(y,u.ray.origin,k.scale(y,u.ray.direction,v))}const m=new a.ObjectStack(()=>({c0:0,c1:0,ray:null}));a=Object.freeze({__proto__:null,create:h,
wrap:d,copy:c,fromValues:e,fromRay:f,fromLineSegment:g,fromLineSegmentAndDirection:p,getStart:n,getEnd:w,getAt:q});b.clipRayModule=a;b.copy=c;b.create=h;b.fromLineSegment=g;b.fromLineSegmentAndDirection=p;b.fromRay=f;b.fromValues=e;b.getAt=q;b.getEnd=w;b.getStart=n;b.wrap=d})},"esri/chunks/frustum":function(){define("exports ./vec3f64 ./vec3 ./mat4 ../core/ObjectStack ./vec4f64 ./vec4 ../views/3d/support/stack ./plane ./clipRay".split(" "),function(b,k,a,r,l,h,d,c,e,f){function g(D){if(D){const {planes:E,
points:G}=D;return{planes:[e.create(E[0]),e.create(E[1]),e.create(E[2]),e.create(E[3]),e.create(E[4]),e.create(E[5])],points:[k.clone(G[0]),k.clone(G[1]),k.clone(G[2]),k.clone(G[3]),k.clone(G[4]),k.clone(G[5]),k.clone(G[6]),k.clone(G[7])]}}return{planes:[e.create(),e.create(),e.create(),e.create(),e.create(),e.create()],points:[k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create(),k.create()]}}function p(D,E=g()){return n(D.planes,D.points,E)}function n(D,E,G=g()){for(let H=
0;6>H;H++)e.copy(D[H],G.planes[H]);for(D=0;8>D;D++)a.copy(G.points[D],E[D]);return G}function w(D,E,G=g()){const {points:H}=G;D=r.multiply(c.sm4d.get(),E,D);r.invert(D,D);for(E=0;8>E;++E){const I=d.transformMat4(c.sv4d.get(),A[E],D);a.set(H[E],I[0]/I[3],I[1]/I[3],I[2]/I[3])}q(G);return G}function q(D){const {planes:E,points:G}=D;e.fromPoints(G[4],G[0],G[3],E[0]);e.fromPoints(G[1],G[5],G[6],E[1]);e.fromPoints(G[4],G[5],G[1],E[2]);e.fromPoints(G[3],G[2],G[6],E[3]);e.fromPoints(G[0],G[1],G[2],E[4]);
e.fromPoints(G[5],G[4],G[7],E[5])}function m(D,E){for(let G=0;6>G;G++)if(e.isSphereFullyInside(D[G],E))return!1;return!0}function u(D,E){return C(D,f.fromRay(E,t.get()))}function v(D,E){for(let G=0;6>G;G++)if(!e.clipInfinite(D[G],E))return!1;return!0}function y(D,E,G){return C(D,f.fromLineSegmentAndDirection(E,G,t.get()))}function B(D,E){for(let G=0;6>G;G++)if(0<e.signedDistance(D[G],E))return!1;return!0}function x(D,E){for(let G=0;6>G;G++)if(e.isAABBFullyInside(D[G],E))return!1;return!0}function C(D,
E){for(let G=0;6>G;G++)if(!e.clip(D[G],E))return!1;return!0}const z={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]},A=[h.fromValues(-1,-1,-1,1),h.fromValues(1,-1,-1,1),h.fromValues(1,1,-1,1),h.fromValues(-1,1,-1,1),h.fromValues(-1,-1,1,1),h.fromValues(1,-1,1,1),h.fromValues(1,1,1,1),h.fromValues(-1,1,1,1)],t=new l.ObjectStack(f.create);l=Object.freeze({__proto__:null,create:g,copy:p,fromValues:n,fromMatrix:w,recomputePlanes:q,intersectsSphere:m,intersectsRay:u,
intersectClipRay:v,intersectsLineSegment:y,intersectsPoint:B,intersectsAABB:x,planePointIndices:z});b.copy=p;b.create=g;b.fromMatrix=w;b.fromValues=n;b.frustumModule=l;b.intersectClipRay=v;b.intersectsAABB=x;b.intersectsLineSegment=y;b.intersectsPoint=B;b.intersectsRay=u;b.intersectsSphere=m;b.planePointIndices=z;b.recomputePlanes=q})},"esri/chunks/vec4":function(){define(["exports","./common"],function(b,k){function a(K,L){K[0]=L[0];K[1]=L[1];K[2]=L[2];K[3]=L[3];return K}function r(K,L,S,M,T){K[0]=
L;K[1]=S;K[2]=M;K[3]=T;return K}function l(K,L,S){K[0]=L[0]+S[0];K[1]=L[1]+S[1];K[2]=L[2]+S[2];K[3]=L[3]+S[3];return K}function h(K,L,S){K[0]=L[0]-S[0];K[1]=L[1]-S[1];K[2]=L[2]-S[2];K[3]=L[3]-S[3];return K}function d(K,L,S){K[0]=L[0]*S[0];K[1]=L[1]*S[1];K[2]=L[2]*S[2];K[3]=L[3]*S[3];return K}function c(K,L,S){K[0]=L[0]/S[0];K[1]=L[1]/S[1];K[2]=L[2]/S[2];K[3]=L[3]/S[3];return K}function e(K,L){K[0]=Math.ceil(L[0]);K[1]=Math.ceil(L[1]);K[2]=Math.ceil(L[2]);K[3]=Math.ceil(L[3]);return K}function f(K,
L){K[0]=Math.floor(L[0]);K[1]=Math.floor(L[1]);K[2]=Math.floor(L[2]);K[3]=Math.floor(L[3]);return K}function g(K,L,S){K[0]=Math.min(L[0],S[0]);K[1]=Math.min(L[1],S[1]);K[2]=Math.min(L[2],S[2]);K[3]=Math.min(L[3],S[3]);return K}function p(K,L,S){K[0]=Math.max(L[0],S[0]);K[1]=Math.max(L[1],S[1]);K[2]=Math.max(L[2],S[2]);K[3]=Math.max(L[3],S[3]);return K}function n(K,L){K[0]=Math.round(L[0]);K[1]=Math.round(L[1]);K[2]=Math.round(L[2]);K[3]=Math.round(L[3]);return K}function w(K,L,S){K[0]=L[0]*S;K[1]=
L[1]*S;K[2]=L[2]*S;K[3]=L[3]*S;return K}function q(K,L,S,M){K[0]=L[0]+S[0]*M;K[1]=L[1]+S[1]*M;K[2]=L[2]+S[2]*M;K[3]=L[3]+S[3]*M;return K}function m(K,L){const S=L[0]-K[0],M=L[1]-K[1],T=L[2]-K[2];K=L[3]-K[3];return Math.sqrt(S*S+M*M+T*T+K*K)}function u(K,L){const S=L[0]-K[0],M=L[1]-K[1],T=L[2]-K[2];K=L[3]-K[3];return S*S+M*M+T*T+K*K}function v(K){const L=K[0],S=K[1],M=K[2];K=K[3];return Math.sqrt(L*L+S*S+M*M+K*K)}function y(K){const L=K[0],S=K[1],M=K[2];K=K[3];return L*L+S*S+M*M+K*K}function B(K,L){K[0]=
-L[0];K[1]=-L[1];K[2]=-L[2];K[3]=-L[3];return K}function x(K,L){K[0]=1/L[0];K[1]=1/L[1];K[2]=1/L[2];K[3]=1/L[3];return K}function C(K,L){const S=L[0],M=L[1],T=L[2];L=L[3];let O=S*S+M*M+T*T+L*L;0<O&&(O=1/Math.sqrt(O),K[0]=S*O,K[1]=M*O,K[2]=T*O,K[3]=L*O);return K}function z(K,L){return K[0]*L[0]+K[1]*L[1]+K[2]*L[2]+K[3]*L[3]}function A(K,L,S,M){const T=L[0],O=L[1],Q=L[2];L=L[3];K[0]=T+M*(S[0]-T);K[1]=O+M*(S[1]-O);K[2]=Q+M*(S[2]-Q);K[3]=L+M*(S[3]-L);return K}function t(K,L){L=L||1;let S,M,T,O;let Q;
do{S=2*k.RANDOM()-1;M=2*k.RANDOM()-1;var F=S*S+M*M}while(1<=F);do T=2*k.RANDOM()-1,O=2*k.RANDOM()-1,Q=T*T+O*O;while(1<=Q);F=Math.sqrt((1-F)/Q);K[0]=L*S;K[1]=L*M;K[2]=L*T*F;K[3]=L*O*F;return K}function D(K,L,S){const M=L[0],T=L[1],O=L[2];L=L[3];K[0]=S[0]*M+S[4]*T+S[8]*O+S[12]*L;K[1]=S[1]*M+S[5]*T+S[9]*O+S[13]*L;K[2]=S[2]*M+S[6]*T+S[10]*O+S[14]*L;K[3]=S[3]*M+S[7]*T+S[11]*O+S[15]*L;return K}function E(K,L,S){var M=L[0];const T=L[1],O=L[2],Q=S[0],F=S[1],N=S[2];S=S[3];const P=S*M+F*O-N*T,U=S*T+N*M-Q*O,
V=S*O+Q*T-F*M;M=-Q*M-F*T-N*O;K[0]=P*S+M*-Q+U*-N-V*-F;K[1]=U*S+M*-F+V*-Q-P*-N;K[2]=V*S+M*-N+P*-F-U*-Q;K[3]=L[3];return K}function G(K){return"vec4("+K[0]+", "+K[1]+", "+K[2]+", "+K[3]+")"}function H(K,L){return K[0]===L[0]&&K[1]===L[1]&&K[2]===L[2]&&K[3]===L[3]}function I(K,L){const S=K[0],M=K[1],T=K[2];K=K[3];const O=L[0],Q=L[1],F=L[2];L=L[3];return Math.abs(S-O)<=k.EPSILON*Math.max(1,Math.abs(S),Math.abs(O))&&Math.abs(M-Q)<=k.EPSILON*Math.max(1,Math.abs(M),Math.abs(Q))&&Math.abs(T-F)<=k.EPSILON*
Math.max(1,Math.abs(T),Math.abs(F))&&Math.abs(K-L)<=k.EPSILON*Math.max(1,Math.abs(K),Math.abs(L))}var J=Object.freeze({__proto__:null,copy:a,set:r,add:l,subtract:h,multiply:d,divide:c,ceil:e,floor:f,min:g,max:p,round:n,scale:w,scaleAndAdd:q,distance:m,squaredDistance:u,length:v,squaredLength:y,negate:B,inverse:x,normalize:C,dot:z,lerp:A,random:t,transformMat4:D,transformQuat:E,str:G,exactEquals:H,equals:I,sub:h,mul:d,div:c,dist:m,sqrDist:u,len:v,sqrLen:y});b.add=l;b.ceil=e;b.copy=a;b.dist=m;b.distance=
m;b.div=c;b.divide=c;b.dot=z;b.equals=I;b.exactEquals=H;b.floor=f;b.inverse=x;b.len=v;b.length=v;b.lerp=A;b.max=p;b.min=g;b.mul=d;b.multiply=d;b.negate=B;b.normalize=C;b.random=t;b.round=n;b.scale=w;b.scaleAndAdd=q;b.set=r;b.sqrDist=u;b.sqrLen=y;b.squaredDistance=u;b.squaredLength=y;b.str=G;b.sub=h;b.subtract=h;b.transformMat4=D;b.transformQuat=E;b.vec4=J})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/maybe ../core/Logger ../core/mathUtils ./vec3f64 ./vec3 ../views/3d/support/mathUtils ./mat4 ../core/ObjectStack ../views/3d/support/stack ./vector ./ray".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){function w(Q){return Q?{radius:Q.radius,center:h.clone(Q.center)}:{radius:1,center:h.create()}}function q(Q,F){const N=S.get();N.radius=Q;N.center=F||T;return N}function m(Q,F=w()){return u(Q.radius,Q.center,F)}function u(Q,F,N=w()){d.copy(N.center,F);N.radius=Q;return N}function v(Q,F,N){Q!==N&&d.copy(N.center,Q.center);N.radius=Q.radius+F;return N}function y(Q,F,N){K.error("sphere.setExtent is not yet supported");return Q===N?N:m(Q,N)}function B(Q,F,N){if(a.isNone(F))return!1;
var P=d.subtract(g.sv3d.get(),F.origin,Q.center),U=d.dot(F.direction,F.direction);const V=2*d.dot(F.direction,P);Q=d.dot(P,P)-Q.radius*Q.radius;Q=V*V-4*U*Q;if(0>Q)return!1;P=Math.sqrt(Q);Q=(-V-P)/(2*U);U=(-V+P)/(2*U);if(0>Q||U<Q&&0<U)Q=U;if(0>Q)return!1;N&&d.add(N,F.origin,d.scale(g.sv3d.get(),F.direction,Q));return!0}function x(Q,F,N,P){F=n.fromScreenAtEye(F,N,M);return B(Q,F,P)}function C(Q,F){return B(Q,F,null)}function z(Q,F,N){if(B(Q,F,N))return N;Q=A(Q,F,g.sv3d.get());d.add(N,F.origin,d.scale(g.sv3d.get(),
F.direction,d.distance(F.origin,Q)/d.length(F.direction)));return N}function A(Q,F,N){const P=g.sv3d.get(),U=g.sm4d.get();d.cross(P,F.origin,F.direction);d.cross(N,P,F.origin);d.scale(N,N,1/d.length(N)*Q.radius);Q=G(Q,F.origin);F=p.angle(F.origin,N);e.identity(U);e.rotate(U,U,F+Q,P);d.transformMat4(N,N,U);return N}function t(Q,F,N){if(B(Q,F,N))return N;n.closestPoint(F,Q.center,N);return D(Q,N,N)}function D(Q,F,N){F=d.subtract(g.sv3d.get(),F,Q.center);F=d.scale(g.sv3d.get(),F,Q.radius/d.length(F));
return d.add(N,F,Q.center)}function E(Q,F){F=d.subtract(g.sv3d.get(),F,Q.center);F=d.squaredLength(F);return Math.sqrt(Math.abs(F-Q.radius*Q.radius))}function G(Q,F){F=d.subtract(g.sv3d.get(),F,Q.center);F=d.length(F);return l.acosClamped(Q.radius/(Q.radius+Math.abs(Q.radius-F)))}function H(Q,F,N,P){Q=d.subtract(L,F,Q.center);switch(N){case 0:return N=c.cartesianToSpherical(Q,L)[2],d.set(P,-Math.sin(N),Math.cos(N),0);case 1:return Q=c.cartesianToSpherical(Q,L),N=Q[1],Q=Q[2],F=Math.sin(N),d.set(P,
-F*Math.cos(Q),-F*Math.sin(Q),Math.cos(N));case 2:return d.normalize(P,Q)}}function I(Q,F){F=d.subtract(O,F,Q.center);return d.length(F)-Q.radius}function J(Q,F,N,P){const U=I(Q,F);Q=H(Q,F,2,O);N=d.scale(O,Q,N-U);d.add(P,F,N);return P}const K=r.getLogger("esri.views.3d.support.geometryUtils.sphere"),L=h.create(),S=new f.ObjectStack(()=>({center:null,radius:0})),M=n.create(),T=h.create(),O=h.create();Object.freeze(T);k=Object.freeze({__proto__:null,create:w,wrap:q,copy:m,fromValues:u,elevate:v,setExtent:y,
intersectRay:B,intersectScreen:x,intersectsRay:C,intersectRayClosestSilhouette:z,closestPointOnSilhouette:A,closestPoint:t,projectPoint:D,distanceToSilhouette:E,angleToSilhouette:G,axisAt:H,altitudeAt:I,setAltitudeAt:J});b.altitudeAt=I;b.angleToSilhouette=G;b.axisAt=H;b.closestPoint=t;b.closestPointOnSilhouette=A;b.copy=m;b.create=w;b.distanceToSilhouette=E;b.elevate=v;b.fromValues=u;b.intersectRay=B;b.intersectRayClosestSilhouette=z;b.intersectScreen=x;b.intersectsRay=C;b.projectPoint=D;b.setAltitudeAt=
J;b.setExtent=y;b.sphereModule=k;b.wrap=q})},"esri/chunks/triangle":function(){define("exports ./vec3f64 ./vec3 ../core/ObjectStack ./vec2 ../views/3d/support/stack ./lineSegment".split(" "),function(b,k,a,r,l,h,d){function c(x){return x?{p0:k.clone(x.p0),p1:k.clone(x.p1),p2:k.clone(x.p2)}:{p0:k.create(),p1:k.create(),p2:k.create()}}function e(x,C,z){const A=v.get();A.p0=x;A.p1=C;A.p2=z;return A}function f(x,C=c()){return g(x.p0,x.p1,x.p2,C)}function g(x,C,z,A=c()){a.copy(A.p0,x);a.copy(A.p1,C);a.copy(A.p2,
z);return A}function p(x,C){var z=x.p0,A=x.p1;x=x.p2;const t=a.subtract(h.sv3d.get(),A,z),D=a.subtract(h.sv3d.get(),x,A),E=a.subtract(h.sv3d.get(),z,x),G=a.subtract(h.sv3d.get(),C,z);var H=a.subtract(h.sv3d.get(),C,A),I=a.subtract(h.sv3d.get(),C,x);const J=a.cross(t,t,E),K=a.dot(a.cross(h.sv3d.get(),t,J),G);H=a.dot(a.cross(h.sv3d.get(),D,J),H);I=a.dot(a.cross(h.sv3d.get(),E,J),I);if(0<K&&0<H&&0<I)return C=a.dot(J,G),C*C/a.dot(J,J);z=d.distance2(d.fromValues(z,t,u.get()),C);A=d.distance2(d.fromValues(A,
D,u.get()),C);C=d.distance2(d.fromValues(x,E,u.get()),C);return Math.min(z,A,C)}function n(x,C,z){const {direction:A,origin:t}=C,{p0:D,p1:E,p2:G}=x;var H=E[0]-D[0],I=E[1]-D[1],J=E[2]-D[2];x=G[0]-D[0];C=G[1]-D[1];const K=G[2]-D[2];var L=A[1]*K-C*A[2],S=A[2]*x-K*A[0];const M=A[0]*C-x*A[1];var T=H*L+I*S+J*M;if(-1E-5<T&&1E-5>T)return!1;T=1/T;const O=t[0]-D[0],Q=t[1]-D[1],F=t[2]-D[2];L=T*(O*L+Q*S+F*M);if(0>L||1<L)return!1;S=Q*J-I*F;J=F*H-J*O;H=O*I-H*Q;I=T*(A[0]*S+A[1]*J+A[2]*H);if(0>I||1<L+I)return!1;
z&&(a.scale(z,A,T*(x*S+C*J+K*H)),a.add(z,t,z));return!0}function w(x,C,z){var A=l.distance(x,C);C=l.distance(C,z);x=l.distance(z,x);z=(A+C+x)/2;A=z*(z-A)*(z-C)*(z-x);return 0>=A?0:Math.sqrt(A)}function q(x){return w(x.p0,x.p1,x.p2)}function m(x,C,z){a.subtract(y,C,x);a.subtract(B,z,x);return a.length(a.cross(y,y,B))/2}const u=new r.ObjectStack(d.create),v=new r.ObjectStack(()=>({p0:null,p1:null,p2:null})),y=k.create(),B=k.create();r=Object.freeze({__proto__:null,create:c,wrap:e,copy:f,fromValues:g,
distance2:p,intersectRay:n,areaPoints2d:w,area2d:q,areaPoints3d:m});b.area2d=q;b.areaPoints2d=w;b.areaPoints3d=m;b.copy=f;b.create=c;b.distance2=p;b.fromValues=g;b.intersectRay=n;b.triangleModule=r;b.wrap=e})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../geometry/support/spatialReferenceUtils ../../../core/Evented ../../../Color ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/Handles ../../../core/watchUtils ../../../geometry/projection ../../../webscene/background/ColorBackground ../../../chunks/vec4f64 ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G){const H=v.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258);b.SceneViewEnvironmentManager=function(S){function M(...O){O=S.call(this,...O)||this;O._referencePointUpdateDelay=200;O._referencePointUpdateInterval=3E3;O._referencePointUpdateDistThreshold=1E6;O._referencePosUpdateQuery=null;O._referencePosMapCoordsRequested=null;O._viewHandles=new B;O._preserveAbsoluteDateTime=!1;O._trackingEnabled=!1;O._referencePosResetPreserveAbsoluteTime=
!1;O.referencePosUpdateTimer=null;O._referencePosWGS84Comparable=null;O._referencePosMapCoords=null;O._mainLight=new G.MainLight;O._ambientLight=new G.AmbientLight;O._moonLight=new G.FillLight;O._renderer=null;O._resetReferencePosition();return O}k._inheritsLoose(M,S);var T=M.prototype;T.destroy=function(){this.disconnectView();this._viewHandles.destroy()};T.connectView=function(O){this._renderer||(this._view=O,this._renderer=new t({view:O}),this._viewHandles.add([O.watch("environment.lighting.date",
Q=>this._lightingDateHandler(Q),!0),O.watch("stationary",()=>this._interactingStationaryHandler()),O.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.lighting.waterReflectionEnabled","environment.background.color"],()=>this._updateRenderParamsHandler(),!0),O.watch("spatialReference",()=>this._resetReferencePosition(!0),!0),x.init(O,"viewingMode",()=>this._resetReferencePosition(!0),!0),x.init(O,"environment.lighting.cameraTrackingEnabled",
Q=>this._updateCameraTracking(Q),!0),x.init(O,"state.camera",()=>this._cameraHandler(null),!0),this.watch("disableQueries",()=>this._cameraHandler(null))]),this._updateRenderParamsHandler(),this._updateLightParams(),this._cameraHandler(),this.notifyChange("updating"))};T.disconnectView=function(){this._renderer&&(this._viewHandles.removeAll(),this._resetReferencePosition(),this._renderer.destroy(),this._view=this._renderer=null)};T._updateCameraTracking=function(O){if(this._trackingEnabled=O)this._cameraHandler();
else if(O=this._view.environment.lighting)O.positionTimezoneInfo.autoUpdated=!1};T._lightingDateHandler=function(O){if(O){var Q=this._view.environment.lighting;if(!Q.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!C.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var F=this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(F)){this._requestReferencePositionUpdate(F);return}}this._preupdateTracking(O);this._referencePosWGS84Comparable&&
(F=D.positionToTimezone(this._referencePosWGS84Comparable,J),l.isSome(F)&&(Q.autoUpdate(null,F),this._trackingEnabled&&(Q.positionTimezoneInfo.autoUpdated=!0)))}this._updateLightParams(O)}};T._preupdateTracking=function(O){!this._trackingEnabled&&this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(O)};T._cameraHandler=function(O=null){if(this._view.ready){var Q=this._view.camera;Q&&(this._cameraHandlerClientSide(Q,O)||this._cameraHandlerServerSide(Q))}};T._cameraHandlerClientSide=
function(O,Q){const F=q.isEarth(this._view.spatialReference);if(F&&!C.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;O=O.position;this._referencePosWGS84Comparable||(this._referencePosWGS84Comparable=v.create());F?C.projectPointToWGS84ComparableLonLat(O,this._referencePosWGS84Comparable):y.set(this._referencePosWGS84Comparable,O.longitude,O.latitude,O.z);this._autoUpdateTimezone(this._referencePosWGS84Comparable,Q)||this._updateLightParams(Q);return!0};T._cameraHandlerServerSide=
function(O){O=O.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(O))&&this._requestReferencePositionUpdate(O,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=O.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};T._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};T._updateLightParams=function(O){var Q=
this._view.environment.lighting;O=O||Q.date;Q=this._view._stage;let F;this._referencePosWGS84Comparable?(F=E.computeColorAndIntensity(O,this._referencePosWGS84Comparable),E.computeDirection(O,this._referencePosWGS84Comparable,this._view.viewingMode,F.diffuse.direction)):F={diffuse:{color:[1,1,1],intensity:.55,direction:H},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};y.scale(this._mainLight.intensity,F.diffuse.color,F.diffuse.intensity*Math.PI);y.negate(this._mainLight.direction,
F.diffuse.direction);y.scale(this._ambientLight.intensity,F.ambient.color,F.ambient.intensity);y.lerp(this._moonLight.intensity,K,L,F.globalFactor);y.scale(this._moonLight.intensity,this._moonLight.intensity,(1-.5*F.globalFactor)*(1-.4*F.noonFactor*(1-F.globalFactor)));y.copy(this._moonLight.direction,F.diffuse.direction);Q.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:F.globalFactor,groundLightingFactor:1-F.noonFactor});this._updateRenderParamsHandler()};T._autoUpdateTimezone=
function(O,Q=null){if(!this._view.environment.lighting.cameraTrackingEnabled)return!1;const F=I;F.setTime((Q||this._view.environment.lighting.date).getTime());O=D.positionToTimezone(O,J);if(l.isNone(O))return!1;var N=this._view.environment.lighting.positionTimezoneInfo;if(!N.autoUpdated)N=O;else if(N.hours===O.hours&&N.minutes===O.minutes&&N.seconds===O.seconds)return!1;const P=F.getUTCHours()-(O.hours-N.hours),U=F.getUTCMinutes()-(O.minutes-N.minutes);N=F.getUTCSeconds()-(O.seconds-N.seconds);F.setUTCHours(P);
F.setUTCMinutes(U);F.setUTCSeconds(N);return Q?!1:this._view.environment.lighting.autoUpdate(F,O)};T._updateRenderParamsHandler=function(){const O=this._view._stage;if(O){var Q=this._referencePosWGS84Comparable?E.computeShadowsEnabled(this._referencePosWGS84Comparable,this._view.viewingMode):!0,F=this._view.environment.background;F=F instanceof z?{type:"color",color:A.fromArray(u.toUnitRGBA(F.color))}:{type:"color",color:A.fromValues(0,0,0,1)};O.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&
Q,ssao:this._view.environment.lighting.ambientOcclusionEnabled,waterReflectionEnabled:this._view.environment.lighting.waterReflectionEnabled,background:F})}};T._resetReferencePosition=function(O=!1){const Q=this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");Q&&O&&this._cameraHandler(null)};T._requestReferencePositionUpdate=function(O,Q=!1){if(!this.disableQueries&&
(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(O):this._referencePosMapCoordsRequested=O.clone(),this._referencePosResetPreserveAbsoluteTime=!!Q,!this._referencePosUpdateQuery&&!this.referencePosUpdateTimer&&this._view.stationary)){const F=this._referencePosUpdateQuery=w.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===F)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==F)}).catch(P=>{"mapcoordshelper:missing-geometry-service"===
P.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===F&&(this._referencePosUpdateQuery=null,this.referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),N=this.referencePosUpdateTimer=w.after(this._referencePointUpdateInterval).then(()=>{this.referencePosUpdateTimer===N&&(this.referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};T._doReferencePositionUpdateQuery=
async function(O){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const Q=await this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);O()||isNaN(Q[0])||isNaN(Q[1])||(O=this._referencePosMapCoords.z*
this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=Q[0],this._referencePosWGS84Comparable[1]=Q[1],this._referencePosWGS84Comparable[2]=O):this._referencePosWGS84Comparable=[Q[0],Q[1],O],this._referencePosChanged())};T._executePendingReferencePositionUpdate=function(){const O=this._referencePosMapCoordsRequested;O&&this._requestReferencePositionUpdate(O,this._referencePosResetPreserveAbsoluteTime)};T._referencePosChanged=function(){this._preserveAbsoluteDateTime?
this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLightParams()};T._exceedsReferencePosDistThreshold=function(O){return this._referencePosMapCoords?(O=this._referencePosMapCoords.distance(O),this._view.mapCoordsHelper&&(O*=this._view.mapCoordsHelper.unitInMeters),O>this._referencePointUpdateDistThreshold):!0};T._cancelReferencePosUpdates=function(){const O=!!this._referencePosUpdateQuery;this.referencePosUpdateTimer=this._referencePosUpdateQuery=null;
return O};k._createClass(M,[{key:"updating",get:function(){return!!(!this.disableQueries&&(this._referencePosUpdateQuery||this._referencePosMapCoordsRequested)||this._renderer&&this._renderer.updating)}},{key:"test",get:function(){const O=this;return{renderer:this._renderer,set referencePointUpdateInterval(Q){O._referencePointUpdateInterval=Q},set referencePointUpdateDistThreshold(Q){O._referencePointUpdateDistThreshold=Q},set referencePosUpdateTimer(Q){O.referencePosUpdateTimer=Q},set referencePointUpdateDelay(Q){O._referencePointUpdateDelay=
Q}}}}]);return M}(m.EventedAccessor);b.SceneViewEnvironmentManager.FIXED_LIGHT_DIRECTION=H;a.__decorate([c.property({type:Boolean,dependsOn:["disableQueries","_renderer.updating"],readOnly:!0})],b.SceneViewEnvironmentManager.prototype,"updating",null);a.__decorate([c.property()],b.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);a.__decorate([c.property()],b.SceneViewEnvironmentManager.prototype,"_renderer",void 0);b.SceneViewEnvironmentManager=a.__decorate([f.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],
b.SceneViewEnvironmentManager);const I=new Date,J={hours:0,minutes:0,seconds:0},K=v.fromValues(.22,.22,.33),L=v.fromValues(.22,.22,.22);b.default=b.SceneViewEnvironmentManager;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../geometry/support/spatialReferenceUtils ../../../core/Handles ../../../core/watchUtils ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){const x=[14,15];a=function(C){function z(){var t=C.apply(this,arguments)||this;t._handles=new q;t._initContext=null;t._pendingAtmosphere=null;t._atmosphere=null;t._stars=null;return t}b._inheritsLoose(z,C);var A=z.prototype;A.initialize=function(){this.view._stage.addRenderPlugin(x,this)};A.destroy=function(){this._pendingAtmosphere=r.destroyMaybe(this._pendingAtmosphere);this._atmosphere=r.destroyMaybe(this._atmosphere);this._stars=r.destroyMaybe(this._stars);
this._handles=r.destroyMaybe(this._handles);this.view&&(this.view._stage.removeRenderPlugin(this),this._set("view",null))};A.initializeRenderContext=function(t){this._initContext=t;this._techniqueRepository=this._initContext.shaderTechniqueRep;this.setup()};A.setup=function(){this._handles.add(m.when(this.view,"basemapTerrain",()=>this._updateBasemapTerrain(),!0));this._handles.add([m.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],()=>this._updateAtmosphere(),
!0),m.init(this.view,"environment.starsEnabled",()=>this._updateStars(),!0)])};A.uninitializeRenderContext=function(){r.isSome(this._stars)&&(this._stars.uninitializeRenderContext(),this._stars.destroy(),this._stars=null);r.isSome(this._atmosphere)&&(this._atmosphere.uninitializeRenderContext(),this._atmosphere.destroy(),this._atmosphere=null)};A.render=function(t){let D=!0;r.isSome(this._stars)&&this._stars.canRender&&(D=this._stars.render(t)&&D);r.isSome(this._atmosphere)&&this._atmosphere.canRender&&
(D=this._atmosphere.render(t)&&D);return D};A._setNeedsRender=function(){this._initContext&&this._initContext.requestRender()};A._updateStars=function(){var t,D,E;const G=null!=(t=null==(D=this.view)?void 0:null==(E=D.environment)?void 0:E.starsEnabled)?t:!1;G&&r.isNone(this._stars)?(this._stars=new B.Stars({view:this.view}),this._stars.initializeRenderContext(this._initContext),this._setNeedsRender()):!G&&r.isSome(this._stars)&&(this._stars.destroy(),this._stars=null,this._setNeedsRender())};A._updateAtmosphere=
function(){var t=this._getAtmosphereType();if(this.atmosphereType!==t)if(this.atmosphereType=t,r.isSome(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),t=this._getAtmosphereClass()){var D=new t(this.view,this._techniqueRepository);D.initializeRenderContext(this._initContext);r.isNone(this._atmosphere)&&(this._atmosphere=D,this._setNeedsRender());this._pendingAtmosphere=D;D.when().then(()=>{r.isSome(this._atmosphere)&&
this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere);this._pendingAtmosphere=null;this._setNeedsRender();this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===D&&(this._pendingAtmosphere=null)})}else r.isSome(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),this._updateBasemapTerrain()};A._getAtmosphereClass=function(){const t=this._getAtmosphereType();if(this.atmosphereClassFromType)return this.atmosphereClassFromType(t);
switch(t){case "none":return null;case "realistic":return v.RealisticAtmosphere;case "panoramic":return u;case "simple":return y}};A._getAtmosphereType=function(){const t=this.view.get("environment.atmosphereEnabled"),D=this.view.get("environment.atmosphere.quality"),E=this.view.viewingMode;return!t||null==D||w.isMoon(this.view.spatialReference)?"none":"local"===E?"panoramic":"high"===D&&v.RealisticAtmosphere.isSupported(this._initContext)&&!w.isMars(this.view.spatialReference)?"realistic":"simple"};
A._updateBasemapTerrain=function(){const t=this.view.basemapTerrain;t&&(t.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};b._createClass(z,[{key:"canRender",get:function(){return!(!this.view.basemapTerrain||!this.view.basemapTerrain.renderer.canRender)||"global"!==this.view.viewingMode}},{key:"updating",get:function(){return r.isSome(this._pendingAtmosphere)||r.isSome(this._stars)&&this._stars.updating}},{key:"test",get:function(){return{atmosphere:this._atmosphere}}}]);
return z}(n);k.__decorate([d.property({constructOnly:!0})],a.prototype,"view",void 0);k.__decorate([d.property({constructOnly:!0})],a.prototype,"atmosphereClassFromType",void 0);k.__decorate([d.property({dependsOn:["_pendingAtmosphere","_stars.updating"]})],a.prototype,"updating",null);k.__decorate([d.property()],a.prototype,"_pendingAtmosphere",void 0);k.__decorate([d.property()],a.prototype,"_stars",void 0);return a=k.__decorate([e.subclass("esri.views.3d.environment.EnvironmentRenderer")],a)})},
"esri/views/3d/environment/PanoramicAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/Util ../webgl-engine/lib/GeometryUtil ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){const y=k.getLogger("esri.views.3d.environment.PanoramicAtmosphere");k=function(){function C(A,t){this.slot=14;this._readyResolver=a.createResolver();this._readyController=a.createAbortController();this.view=A;this._techniqueRepository=t;this._atmosphereTechniqueConfig=new c.SimpleAtmosphereTechniqueConfiguration}var z=C.prototype;z.destroy=function(){this._readyResolver.reject();this._texture&&(this._texture.dispose(),this._texture=null);this._readyController&&
(this._readyController.abort(),this._readyController=null)};z.when=function(){return this._readyResolver.promise};z.initializeRenderContext=function(A){const t=A.rctx;this._atmosphereTechniqueConfig.geometry=1;this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(c.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._vao=this._createVertexArrayObject(t);this._vaoCount=u.vertexCount(this._vao,"geometry");h.requestImage(e,{signal:this._readyController.signal}).then(D=>
{this._texture=new m(A.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},D);A.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(D=>{a.isAbortError(D)||y.error("Unable to initialize atmosphere: image request failed",D);this._readyResolver.reject()})};z.uninitializeRenderContext=function(){this.destroy()};z.render=function(A){if(A.slot!==this.slot||0!==A.pass)return!1;const t=A.rctx,D=this._atmosphereTechnique.program;t.bindProgram(D);this._atmosphereTechnique.bindPipelineState(t);
t.bindTexture(this._texture,0);D.setUniform1i("tex",0);p.View.bindProjectionMatrix(D,A.camera.projectionMatrix);var E=B;r.copy(E,A.camera.viewMatrix);E[12]=0;E[13]=0;E[14]=0;E[15]=1;D.setUniformMatrix4fv("view",B);D.setUniform4f("color",1,1,1,1);A.scenelightingData.setLightDirectionUniform(D);t.bindVAO(this._vao);D.assertCompatibleVertexAttributeLocations(this._vao);t.drawArrays(4,0,this._vaoCount);return!0};z._createVertexArrayObject=function(A){var t=w.createPolySphereGeometry(1,2,!1);const D=t.indices[n.VertexAttrConstants.POSITION];
for(var E=0;E<D.length;E+=3){var G=D[E];D[E]=D[E+2];D[E+2]=G}t=t.vertexAttributes[n.VertexAttrConstants.POSITION].data;E=x.createBuffer(D.length);G=E.position;for(let H=0;H<D.length;++H){const I=3*D[H];G.set(H,0,t[I]);G.set(H,1,t[I+1]);G.set(H,2,t[I+2])}return new v(A,d.Default3D,{geometry:f.glLayout(x)},{geometry:q.createVertex(A,35044,E.buffer)})};b._createClass(C,[{key:"canRender",get:function(){return null!=this._texture}}]);return C}();const B=l.create(),x=g.newLayout().vec3f("position");return k})},
"esri/support/requestImageUtils":function(){define(["exports","../request"],function(b,k){b.requestImage=async function(a,r){({data:a}=await k(a,{responseType:"image",...r}));return a};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports"],function(b){b.Default3D={position:0,normal:1,uv0:2,color:3,size:4,tangent:4,uvMapSpace:4,auxpos1:5,symbolColor:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,
instanceColor:7,bound1:5,bound2:6,bound3:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/SimpleAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){d=function(p){function n(){return p.apply(this,arguments)||this}a._inheritsLoose(n,p);var w=n.prototype;w.initializeProgram=function(q){const m=n.shader.get().build({geometry:this.configuration.geometry});return new f(q.rctx,m.generateSource("vertex"),m.generateSource("fragment"),e.Default3D)};w.initializePipeline=function(){return 1===this.configuration.geometry?g.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),culling:g.backFaceCullingParams,depthTest:{func:515},
colorWrite:g.defaultColorWriteParams}):g.makePipelineState({blending:g.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:g.defaultColorWriteParams})};return n}(d.ShaderTechnique);d.shader=new h.ReloadableShaderModule(l.SimpleAtmosphereShader,()=>new Promise(function(p,n){b(["./SimpleAtmosphere.glsl"],p,n)}));l=function(p){function n(){var w=p.apply(this,arguments)||this;w.geometry=0;return w}a._inheritsLoose(n,p);return n}(c.ShaderTechniqueConfiguration);r.__decorate([c.parameter({count:3})],
l.prototype,"geometry",void 0);k.SimpleAtmosphereTechnique=d;k.SimpleAtmosphereTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(b,k,a,r){function l(d){const c=new r.ShaderBuilder;2===d.geometry?(c.attributes.add("position",
"vec2"),c.varyings.add("color","vec4"),c.vertex.uniforms.add("lightingMainDirection","vec3").add("cameraPosition","vec3").add("undergroundFadeAlpha","float"),c.vertex.code.add(k.glsl`
      void main(void) {
          float ndotl = dot(normalize(cameraPosition), -lightingMainDirection);
          float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

          color = vec4(vec3(lighting), undergroundFadeAlpha);

          gl_Position = vec4(position.xy, 1.0, 1.0); // on the far plane
      }
  `),c.fragment.code.add(k.glsl`
      void main() {
          gl_FragColor = color;
      }
  `)):(c.include(a.Transform,{linearDepth:!1}),c.attributes.add("position","vec3"),c.varyings.add("vtc","vec2"),c.varyings.add("falloff","float"),1!==d.geometry&&c.varyings.add("innerFactor","float"),c.vertex.uniforms.add("proj","mat4").add("view","mat4").add("lightingMainDirection","vec3"),1!==d.geometry&&c.vertex.uniforms.add("silCircleCenter","vec3").add("silCircleV1","vec3").add("silCircleV2","vec3").add("texV","vec2").add("innerScale","float"),1!==d.geometry&&c.vertex.code.add(k.glsl`
			const float TWICEPI = 2.0*3.14159265;
			const float ATMOSPHERE_RIM_SEGMENTS = 128.0;
		`),c.vertex.code.add(k.glsl`
		void main(void) {
			vec3 lightDirection = -lightingMainDirection;
	`),1===d.geometry?c.vertex.code.add(k.glsl`
			vec3 pos = position;
			float ndotl = lightDirection.z;
			vtc = vec2(0.0, position.z+0.05);
			`):c.vertex.code.add(k.glsl`
			innerFactor = clamp(-position.z, 0.0, 1.0);
			float scale = position.y * (1.0 + innerFactor * innerScale);
			float phi = position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;
			vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
			float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightDirection);

			vtc.x = position.x / ATMOSPHERE_RIM_SEGMENTS;
			vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
		`),c.vertex.code.add(k.glsl`
		falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		gl_Position = transformPosition(proj, view, pos);
		gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
			}
	`),c.fragment.uniforms.add("tex","sampler2D"),1!==d.geometry&&c.fragment.uniforms.add("altitudeFade","float"),c.fragment.code.add(k.glsl`
		void main() {
			vec4 texColor = texture2D(tex, vtc);
	`),1===d.geometry?c.fragment.code.add(k.glsl`
			gl_FragColor = texColor * falloff;
			}
		`):c.fragment.code.add(k.glsl`
			vec4 atmosphereColor = texColor * falloff;
			vec4 innerColor = vec4(texColor.rgb * falloff, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
		}
		`));return c}var h=Object.freeze({__proto__:null,build:l});b.SimpleAtmosphereShader=h;b.build=l})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(b){function k(a,...r){let l="";for(let h=0;h<r.length;h++)l+=a[h]+r[h];return l+=a[a.length-1]}(function(a){a.int=function(r){return Math.round(r).toString()};a.float=function(r){return r.toPrecision(8)}})(k||(k={}));b.glsl=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports",
"../shaderModules/interfaces"],function(b,k){b.Transform=function(a,r){r.linearDepth?a.vertex.code.add(k.glsl`
    vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
      vec4 eye = view * vec4(pos, 1.0);
      depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
      return proj * eye;
    }
    `):a.vertex.code.add(k.glsl`
    vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
      // Make sure the order of operations is the same as in transformPositionWithDepth.
      return proj * (view * vec4(pos, 1.0));
    }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Logger"],function(b,k,a){const r=a.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");a=function(){function n(){this.includedModules=new Map}n.prototype.include=function(w,q){this.includedModules.has(w)?this.includedModules.get(w)!==q&&r.error("Trying to include shader module multiple times with different sets of options."):
(this.includedModules.set(w,q),w(this.builder,q))};return n}();let l=function(n){function w(){var q=n.apply(this,arguments)||this;q.vertex=new c;q.fragment=new c;q.attributes=new e;q.varyings=new f;q.extensions=new g;q.defines=new p;return q}k._inheritsLoose(w,n);w.prototype.generateSource=function(q){const m=this.extensions.generateSource(q),u=this.attributes.generateSource(q),v=this.varyings.generateSource();var y="vertex"===q?this.vertex:this.fragment;const B=y.uniforms.generateSource(),x=y.code.generateSource();
q="vertex"===q?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";y=this.defines.generateSource().concat(y.defines.generateSource());return`
${m.join("\n")}

${y.join("\n")}

${q}

${B.join("\n")}

${u.join("\n")}

${v.join("\n")}

${x.join("\n")}`};k._createClass(w,[{key:"builder",get:function(){return this}}]);return w}(a),h=function(){function n(){this._entries=[];this._set=new Set}var w=n.prototype;w.add=function(q,m,u){const v=`${q}_${m}_${u}`;this._set.has(v)||(this._entries.push([q,m,u]),this._set.add(v));return this};w.generateSource=function(){return this._entries.map(q=>{var m=q[2];return`uniform ${q[1]} ${q[0]}${m?`[${m}]`:""};`})};return n}(),d=function(){function n(){this._entries=[]}var w=n.prototype;w.add=function(q){this._entries.push(q)};
w.generateSource=function(){return this._entries};return n}(),c=function(n){function w(){var q=n.apply(this,arguments)||this;q.uniforms=new h;q.code=new d;q.defines=new p;return q}k._inheritsLoose(w,n);k._createClass(w,[{key:"builder",get:function(){return this}}]);return w}(a),e=function(){function n(){this._entries=[]}var w=n.prototype;w.add=function(q,m){this._entries.push([q,m])};w.generateSource=function(q){return"fragment"===q?[]:this._entries.map(m=>`attribute ${m[1]} ${m[0]};`)};return n}(),
f=function(){function n(){this._entries=[]}var w=n.prototype;w.add=function(q,m){this._entries.push([q,m])};w.generateSource=function(){return this._entries.map(q=>`varying ${q[1]} ${q[0]};`)};return n}(),g=function(){function n(){this._entries=new Set}var w=n.prototype;w.add=function(q){this._entries.add(q)};w.generateSource=function(q){const m="vertex"===q?n.ALLOWLIST_VERTEX:n.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(u=>m.includes(u)).map(u=>`#extension ${u} : enable`)};return n}();
g.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];g.ALLOWLIST_VERTEX=[];let p=function(){function n(){this._entries=new Map}var w=n.prototype;w.addInt=function(q,m){m=0===m%1?m.toFixed(0):m.toString();this._entries.set(q,m)};w.addFloat=function(q,m){m=0===m%1?m.toFixed(1):m.toString();this._entries.set(q,m)};w.generateSource=function(){return Array.from(this._entries,([q,m])=>`#define ${q} ${m}`)};return n}();b.Code=d;b.Includes=a;b.ShaderBuilder=l;b.Stage=c;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports"],function(b){let k=function(){function a(l,h){this._module=l;this._loadModule=h}var r=a.prototype;r.get=function(){return this._module};r.reload=async function(){return this._module=await this._loadModule()};return a}();b.ReloadableShaderModule=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(h,d){d&&(this._config=d.snapshot());this._program=this.initializeProgram(h);h.commonUniformStore&&(this._commonUniformStore=h.commonUniformStore,this._commonUniformStore.subscribeProgram(this._program));this._pipeline=this.initializePipeline(h)}var l=r.prototype;l.dispose=function(){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose(),
this._program=null)};l.reload=function(h){this._program&&(this._commonUniformStore&&this._commonUniformStore.unsubscribeProgram(this._program),this._program.dispose());this._program=this.initializeProgram(h);this._commonUniformStore&&this._commonUniformStore.subscribeProgram(this._program)};l.bindPass=function(h,d,c){};l.bindMaterial=function(h,d,c){};l.bindDraw=function(h,d,c){};l.bindPipelineState=function(h){h.setPipelineState(this.pipeline)};l.ensureAttributeLocations=function(h){this.program.assertCompatibleVertexAttributeLocations(h)};
k._createClass(r,[{key:"program",get:function(){return this._program}},{key:"pipeline",get:function(){return this._pipeline}},{key:"key",get:function(){return this._config.key}},{key:"configuration",get:function(){return this._config}},{key:"primitiveType",get:function(){return 4}}]);return r}();b.ShaderTechnique=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/mathUtils"],function(b,k,a){let r=function(){function l(){this._key="";this._keyDirty=!1;this._parameterBits=this._parameterBits.map(()=>0)}l.prototype.snapshot=function(){const h=this._parameterNames,d={key:this.key};for(const c of h)d[c]=this[c];return d};k._createClass(l,[{key:"key",get:function(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return l}();b.ShaderTechniqueConfiguration=r;b.parameter=
function(l={}){return(h,d)=>{var c,e;h._parameterNames=null!=(c=h._parameterNames)?c:[];h._parameterNames.push(d);const f=h._parameterNames.length-1;c=Math.ceil(a.log2(l.count||2));const g=null!=(e=h._parameterBits)?e:[0];let p=0;for(;16<g[p]+c;)p++,p>=g.length&&g.push(0);h._parameterBits=g;const n=g[p],w=(1<<c)-1<<n;g[p]+=c;Object.defineProperty(h,d,{get(){return this[f]},set(q){if(this[f]!==q&&(this[f]=q,this._keyDirty=!0,this._parameterBits[p]=this._parameterBits[p]&~w|+q<<n&w,"number"!==typeof q&&
"boolean"!==typeof q))throw"Configuration values must be booleans or numbers!";}})}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/Program":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/has","../../core/maybe","./ShaderTranspiler"],function(b,k,a,r){function l(d,c){if(a.isNone(d)||d.length!==c.length)return!0;for(let e=0;e<d.length;++e)if(d[e]!==c[e])return!0;return!1}let h=0;return function(){function d(e,f,g,p,n={}){this._glName=this._context=null;
this._locations={};this.id=h++;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform1v={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};e||console.error("RenderingContext isn't initialized!");0===f.length&&console.error("Shaders source should not be empty!");e.instanceCounter.increment(3,this);
this._context=e;this._vertexShaderSource=f;this._fragmentShaderSource=g;if(Array.isArray(n))for(const w of n)this._defines[w]="1";else this._defines=n;this._locations=p}var c=d.prototype;c.getDefine=function(e){return this._defines[e]};c.dispose=function(){if(this._context){var e=this._context.gl;this._vShader&&(e.deleteShader(this._vShader),this._vShader=null);this._fShader&&(e.deleteShader(this._fShader),this._fShader=null);this._glName&&(e.deleteProgram(this._glName),this._glName=null);this._context.instanceCounter.decrement(3,
this);this._context=null}};c.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var e=this._context.gl,f=e.createProgram();e.attachShader(f,this._vShader);e.attachShader(f,this._fShader);for(const g in this._locations)e.bindAttribLocation(f,this._locations[g],g);e.linkProgram(f);this._glName=f;this._initialized=!0}};c.getUniformLocation=function(e){this.initialize();
void 0===this._nameToUniformLocation[e]&&(this._nameToUniformLocation[e]=this._context.gl.getUniformLocation(this._glName,e));return this._nameToUniformLocation[e]};c.hasUniform=function(e){return null!==this.getUniformLocation(e)};c.getAttribLocation=function(e){this.initialize();void 0===this._nameToAttribLocation[e]&&(this._nameToAttribLocation[e]=this._context.gl.getAttribLocation(this._glName,e));return this._nameToAttribLocation[e]};c.setUniform1i=function(e,f){const g=this._nameToUniform1[e];
if(void 0===g||f!==g)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(e),f),this._nameToUniform1[e]=f};c.setUniform1iv=function(e,f){const g=this._nameToUniform1v[e];l(g,f)&&(this._context.bindProgram(this),this._context.gl.uniform1iv(this.getUniformLocation(e),f),void 0===g?this._nameToUniform1v[e]=d._arrayCopy(f):d._arrayAssign(f,g))};c.setUniform2iv=function(e,f){const g=this._nameToUniform2[e];l(g,f)&&(this._context.bindProgram(this),this._context.gl.uniform2iv(this.getUniformLocation(e),
f),void 0===g?this._nameToUniform2[e]=d._arrayCopy(f):d._arrayAssign(f,g))};c.setUniform3iv=function(e,f){const g=this._nameToUniform3[e];l(g,f)&&(this._context.bindProgram(this),this._context.gl.uniform3iv(this.getUniformLocation(e),f),void 0===g?this._nameToUniform3[e]=d._arrayCopy(f):d._arrayAssign(f,g))};c.setUniform4iv=function(e,f){const g=this._nameToUniform4[e];l(g,f)&&(this._context.bindProgram(this),this._context.gl.uniform4iv(this.getUniformLocation(e),f),void 0===g?this._nameToUniform4[e]=
d._arrayCopy(f):d._arrayAssign(f,g))};c.setUniform1f=function(e,f){const g=this._nameToUniform1[e];if(void 0===g||f!==g)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(e),f),this._nameToUniform1[e]=f};c.setUniform1fv=function(e,f){const g=this._nameToUniform1v[e];l(g,f)&&(this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(e),f),void 0===g?this._nameToUniform1v[e]=d._arrayCopy(f):d._arrayAssign(f,g))};c.setUniform2f=function(e,f,g){const p=
this._nameToUniform2[e];if(void 0===p||f!==p[0]||g!==p[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(e),f,g),void 0===p?this._nameToUniform2[e]=[f,g]:(p[0]=f,p[1]=g)};c.setUniform2fv=function(e,f){const g=this._nameToUniform2[e];l(g,f)&&(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(e),f),void 0===g?this._nameToUniform2[e]=d._arrayCopy(f):d._arrayAssign(f,g))};c.setUniform3f=function(e,f,g,p){const n=this._nameToUniform3[e];
if(void 0===n||f!==n[0]||g!==n[1]||p!==n[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(e),f,g,p),void 0===n?this._nameToUniform3[e]=[f,g,p]:(n[0]=f,n[1]=g,n[2]=p)};c.setUniform3fv=function(e,f){const g=this._nameToUniform3[e];l(g,f)&&(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(e),f),void 0===g?this._nameToUniform3[e]=d._arrayCopy(f):d._arrayAssign(f,g))};c.setUniform4f=function(e,f,g,p,n){const w=this._nameToUniform4[e];
if(void 0===w||f!==w[0]||g!==w[1]||p!==w[2]||n!==w[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(e),f,g,p,n),void 0===w?this._nameToUniform4[e]=[f,g,p,n]:(w[0]=f,w[1]=g,w[2]=p,w[3]=n)};c.setUniform4fv=function(e,f){const g=this._nameToUniform4[e];l(g,f)&&(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(e),f),void 0===g?this._nameToUniform4[e]=d._arrayCopy(f):d._arrayAssign(f,g))};c.setUniformMatrix3fv=function(e,f,g=!1){const p=
this._nameToUniformMatrix3[e];var n=a.isNone(p)?!0:9!==p.length?l(p,f):9!==p.length||p[0]!==f[0]||p[1]!==f[1]||p[2]!==f[2]||p[3]!==f[3]||p[4]!==f[4]||p[5]!==f[5]||p[6]!==f[6]||p[7]!==f[7]||p[8]!==f[8];n&&(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(e),g,f),void 0===p?this._nameToUniformMatrix3[e]=d._arrayCopy(f):d._arrayAssign(f,p))};c.setUniformMatrix4fv=function(e,f,g=!1){const p=this._nameToUniformMatrix4[e];var n=a.isNone(p)?!0:16!==p.length?l(p,f):
16!==p.length||p[0]!==f[0]||p[1]!==f[1]||p[2]!==f[2]||p[3]!==f[3]||p[4]!==f[4]||p[5]!==f[5]||p[6]!==f[6]||p[7]!==f[7]||p[8]!==f[8]||p[9]!==f[9]||p[10]!==f[10]||p[11]!==f[11]||p[12]!==f[12]||p[13]!==f[13]||p[14]!==f[14]||p[15]!==f[15];n&&(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(e),g,f),void 0===p?this._nameToUniformMatrix4[e]=d._arrayCopy(f):d._arrayAssign(f,p))};c.assertCompatibleVertexAttributeLocations=function(e){(e=e.locations===this.locations)||
console.error("VertexAttributeLocations are incompatible");return e};d._padToThree=function(e){let f=e.toString();1E3>e&&(f=("  "+e).slice(-3));return f};c._addLineNumbers=function(e){let f=2;return e.replace(/\n/g,()=>"\n"+d._padToThree(f++)+":")};c._loadShader=function(e){var f=35633===e,g=f?this._vertexShaderSource:this._fragmentShaderSource;let p="";for(const n in this._defines)p+=`#define ${n} ${this._defines[n]}\n`;g=p+g;"webgl2"===this._context.contextVersion&&(g=r.transpileShader(g,f?"vertex":
"fragment"));f=this._context.gl;e=f.createShader(e);f.shaderSource(e,g);f.compileShader(e);return e};d._arrayCopy=function(e){const f=[];for(let g=0;g<e.length;++g)f.push(e[g]);return f};d._arrayAssign=function(e,f){for(let g=0;g<e.length;++g)f[g]=e[g]};b._createClass(d,[{key:"glName",get:function(){return this._glName}},{key:"locations",get:function(){return this._locations}}]);return d}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["exports","../../chunks/_commonjsHelpers","./reservedWordsGLSL3"],
function(b,k,a){function r(){function m(O){O.length&&H.push({type:w[t],data:O,position:K,line:I,column:J})}function u(){G=G.length?[]:G;if("/"===E&&"*"===D)return K=A+z-1,t=0,E=D,z+1;if("/"===E&&"/"===D)return K=A+z-1,t=1,E=D,z+1;if("#"===D)return t=2,K=A+z,z;if(/\s/.test(D))return t=9,K=A+z,z;L=/\d/.test(D);S=/[^\w_]/.test(D);K=A+z;t=L?4:S?3:9999;return z}function v(){if(("\r"===D||"\n"===D)&&"\\"!==E)return m(G.join("")),t=999,z;G.push(D);E=D;return z+1}function y(){if("."===E&&/\d/.test(D))return t=
5,z;if("/"===E&&"*"===D)return t=0,z;if("/"===E&&"/"===D)return t=1,z;if("."===D&&G.length){for(;B(G););t=5;return z}if(";"===D||")"===D||"("===D){if(G.length)for(;B(G););m(D);t=999;return z+1}var O=2===G.length&&"\x3d"!==D;if(/[\w_\d\s]/.test(D)||O){for(;B(G););t=999;return z}G.push(D);E=D;return z+1}function B(O){var Q=0;do{var F=p.indexOf(O.slice(0,O.length+Q).join(""));var N=p[F];if(-1===F){if(0<Q--+O.length)continue;N=O.slice(0,1).join("")}m(N);K+=N.length;G=G.slice(N.length);return G.length}while(1)}
function x(){if("."===D||/[eE]/.test(D))return G.push(D),t=5,E=D,z+1;if("x"===D&&1===G.length&&"0"===G[0])return t=11,G.push(D),E=D,z+1;if(/[^\d]/.test(D))return m(G.join("")),t=999,z;G.push(D);E=D;return z+1}function C(){"f"===D&&(G.push(D),E=D,z+=1);if(/[eE]/.test(D)||"-"===D&&/[eE]/.test(E))return G.push(D),E=D,z+1;if(/[^\d]/.test(D))return m(G.join("")),t=999,z;G.push(D);E=D;return z+1}var z=0,A=0,t=999,D,E,G=[],H=[],I=1,J=0,K=0,L=!1,S=!1,M="",T;return function(O){H=[];if(null!==O){O=O.replace?
O.replace(/\r\n/g,"\n"):O;z=0;M+=O;for(T=M.length;D=M[z],z<T;){O=z;switch(t){case 0:"/"===D&&"*"===E?(G.push(D),m(G.join("")),t=999):(G.push(D),E=D);z+=1;break;case 1:z=v();break;case 2:z=v();break;case 3:z=y();break;case 4:z=x();break;case 11:/[^a-fA-F0-9]/.test(D)?(m(G.join("")),t=999):(G.push(D),E=D,z+=1);break;case 5:z=C();break;case 9999:if(/[^\d\w_]/.test(D)){var Q=G.join("");t=-1<g.indexOf(Q)?8:-1<n.indexOf(Q)?7:6;m(G.join(""));t=999}else G.push(D),E=D,z+=1;break;case 9:/[^\s]/g.test(D)?(m(G.join("")),
t=999):(G.push(D),E=D,z+=1);break;case 999:z=u()}if(O!==z)switch(M[O]){case "\n":J=0;++I;break;default:++J}}A+=z;M=M.slice(z);return H}G.length&&m(G.join(""));t=10;m("(eof)");return H}}function l(m){return m.map(u=>"eof"!==u.type?u.data:"").join("")}function h(m,u="100",v="300 es"){const y=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const B of m)if("preprocessor"===B.type){const x=y.exec(B.data);if(x){m=x[1].replace(/\s\s+/g," ");if(m===v)return m;if(m===u)return B.data="#version "+v,u;throw Error("unknown glsl version: "+
m);}}m.splice(0,0,{type:"preprocessor",data:"#version "+v},{type:"whitespace",data:"\n"});return null}function d(m,u,v,y){y=y||v;for(const B of m)if("ident"===B.type&&B.data===v)return y in u?u[y]++:u[y]=0,d(m,u,y+"_"+u[y],y);return v}function c(m,u,v="afterVersion"){const y={data:"\n",type:"whitespace"},B=C=>C<m.length?/[^\r\n]$/.test(m[C].data):!1;let x=function(C){let z=-1,A=0,t=-1;for(let E=0;E<C.length;E++){var D=C[E];"preprocessor"===D.type&&(D.data.match(/#(if|ifdef|ifndef)\s+.+/)?++A:D.data.match(/#endif\s*.*/)&&
--A);("afterVersion"===v||"afterPrecision"===v)&&"preprocessor"===D.type&&/^#version/.test(D.data)&&(t=Math.max(t,E));if("afterPrecision"===v&&"keyword"===D.type&&"precision"===D.data){a:{for(D=E;D<C.length;D++){const G=C[D];if("operator"===G.type&&";"===G.data)break a}D=null}if(null===D)throw Error("precision statement not followed by any semicolons!");t=Math.max(t,D)}z<t&&0===A&&(z=E)}return z+1}(m);B(x-1)&&m.splice(x++,0,y);for(const C of u)m.splice(x++,0,C);B(x-1)&&B(x)&&m.splice(x,0,y)}function e(m,
u,v,y="lowp"){c(m,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:y},{type:"whitespace",data:" "},{type:"keyword",data:v},{type:"whitespace",data:" "},{type:"ident",data:u},{type:"operator",data:";"}],"afterPrecision")}function f(m,u,v,y,B="lowp"){c(m,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:y.toString()},{type:"operator",
data:")"},{type:"whitespace",data:" "},{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:B},{type:"whitespace",data:" "},{type:"keyword",data:v},{type:"whitespace",data:" "},{type:"ident",data:u},{type:"operator",data:";"}],"afterPrecision")}var g=k.createCommonjsModule(function(m){(function(u){u=u();void 0!==u&&(m.exports=u)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})}),
p=k.createCommonjsModule(function(m){(function(u){u=u();void 0!==u&&(m.exports=u)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})}),n=k.createCommonjsModule(function(m){(function(u){u=u();void 0!==u&&(m.exports=u)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})}),
w="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const q=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];b.transpileShader=function(m,u){var v=r(),y=[];y=y.concat(v(m));m=y=y.concat(v(null));if("300 es"===h(m,"100","300 es"))throw Error("shader is already glsl 300 es");y=v=null;const B={},x={};for(let t=0;t<m.length;++t){const D=m[t];switch(D.type){case "keyword":"vertex"===
u&&"attribute"===D.data?D.data="in":"varying"===D.data&&(D.data="vertex"===u?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(D.data.trim())&&(D.data=D.data.replace(/(2D|Cube|EXT)/g,""));"fragment"===u&&"gl_FragColor"===D.data&&(v||(v=d(m,B,"fragColor"),e(m,v,"vec4")),D.data=v);if("fragment"===u&&"gl_FragData"===D.data){{var C=void 0;let E=void 0;var z=m;var A=t+1;let G=-1;for(;A<z.length;A++){const H=z[A];if("operator"===H.type&&("["===H.data&&(E=A),"]"===H.data)){C=
A;break}"integer"===H.type&&(G=parseInt(H.data,10))}E&&C&&z.splice(E,C-E+1);z=G}C=d(m,B,"fragData");f(m,C,"vec4",z,"mediump");D.data=C}else"fragment"===u&&"gl_FragDepthEXT"===D.data&&(y||(y=d(m,B,"gl_FragDepth")),D.data=y);break;case "ident":if(0<=a.indexOf(D.data)){if(z="vertex"===u)a:{for(z=t-1;0<=z;z--)if(C=m[z],"whitespace"!==C.type&&"block-comment"!==C.type)if("keyword"===C.type){if("attribute"===C.data||"in"===C.data){z=!0;break a}}else break;z=!1}if(z)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");
D.data in x||(x[D.data]=d(m,B,D.data));D.data=x[D.data]}}}for(u=m.length-1;0<=u;--u)v=m[u],"preprocessor"===v.type&&((y=v.data.match(/#extension\s+(.*):/))&&y[1]&&0<=q.indexOf(y[1].trim())&&(y=m[u+1],m.splice(u,y&&"whitespace"===y.type?2:1)),(y=v.data.match(/#ifdef\s+(.*)/))&&y[1]&&0<=q.indexOf(y[1].trim())&&(v.data="#if 1"),(y=v.data.match(/#ifndef\s+(.*)/))&&y[1]&&0<=q.indexOf(y[1].trim())&&(v.data="#if 0"));return l(m)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/_commonjsHelpers":function(){define(["exports"],
function(b){function k(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs");}b.commonjsGlobal="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};b.commonjsRequire=k;b.createCommonjsModule=function(a,r,l){return l={path:r,exports:{},require:function(h,d){return k(h,void 0===d||null===d?l.path:d)}},a(l,l.exports),l.exports};b.getDefaultExportFromCjs=function(a){return a&&
a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a["default"]:a}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/renderState":function(){define(["exports"],function(b){function k(H){return B.intern(H)}function a(H){return x.intern(H)}function r(H){return C.intern(H)}function l(H){return z.intern(H)}function h(H){return A.intern(H)}function d(H){return t.intern(H)}function c(H){return D.intern(H)}function e(H){return E.intern(H)}function f(H){return"["+H.join(",")+"]"}function g(H){return H?f([H.srcRgb,H.srcAlpha,H.dstRgb,H.dstAlpha,H.opRgb,H.opAlpha,H.color.r,H.color.g,H.color.b,H.color.a]):
null}function p(H){return H?f([H.face,H.mode]):null}function n(H){return H?f([H.factor,H.units]):null}function w(H){return H?f([H.func]):null}function q(H){return H?f([H.function.func,H.function.ref,H.function.mask,H.operation.fail,H.operation.zFail,H.operation.zPass]):null}function m(H){return H?f([H.zNear,H.zFar]):null}function u(H){return H?f([H.r,H.g,H.b,H.a]):null}function v(H){return H?f([H.mask]):null}var y=function(){function H(I,J){this.makeKey=I;this.makeRef=J;this.interns=new Map}H.prototype.intern=
function(I){if(!I)return null;const J=this.makeKey(I),K=this.interns;K.has(J)||K.set(J,this.makeRef(I));return K.get(J)};return H}();const B=new y(g,H=>({__tag:"Blending",...H})),x=new y(p,H=>({__tag:"Culling",...H})),C=new y(n,H=>({__tag:"PolygonOffset",...H})),z=new y(w,H=>({__tag:"DepthTest",...H})),A=new y(q,H=>({__tag:"StencilTest",...H})),t=new y(m,H=>({__tag:"DepthWrite",...H})),D=new y(u,H=>({__tag:"ColorWrite",...H})),E=new y(v,H=>({__tag:"StencilWrite",...H})),G=new y(function(H){return H?
f([g(H.blending),p(H.culling),n(H.polygonOffset),w(H.depthTest),q(H.stencilTest),m(H.depthWrite),u(H.colorWrite),v(H.stencilWrite)]):null},H=>({blending:k(H.blending),culling:a(H.culling),polygonOffset:r(H.polygonOffset),depthTest:l(H.depthTest),stencilTest:h(H.stencilTest),depthWrite:d(H.depthWrite),colorWrite:c(H.colorWrite),stencilWrite:e(H.stencilWrite)}));y=function(){function H(J){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=
this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=J}var I=H.prototype;I.setPipeline=function(J){if(this._pipelineInvalid||J!==this._pipeline)this.setBlending(J.blending),this.setCulling(J.culling),this.setPolygonOffset(J.polygonOffset),this.setDepthTest(J.depthTest),this.setStencilTest(J.stencilTest),this.setDepthWrite(J.depthWrite),this.setColorWrite(J.colorWrite),this.setStencilWrite(J.stencilWrite),this._pipeline=J;this._pipelineInvalid=
!1};I.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};I.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};I.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};I.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};I.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};I.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};
I.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};I.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};I.setBlending=function(J){this._blending=this.setSubState(J,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};I.setCulling=function(J){this._culling=this.setSubState(J,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};I.setPolygonOffset=function(J){this._polygonOffset=
this.setSubState(J,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};I.setDepthTest=function(J){this._depthTest=this.setSubState(J,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};I.setStencilTest=function(J){this._stencilTest=this.setSubState(J,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};I.setDepthWrite=function(J){this._depthWrite=
this.setSubState(J,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};I.setColorWrite=function(J){this._colorWrite=this.setSubState(J,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};I.setStencilWrite=function(J){this._stencilWrite=this.setSubState(J,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};I.setSubState=function(J,K,L,S){if(L||
J!==K)S(J),this._pipelineInvalid=!0;return J};return H}();b.StateTracker=y;b.backFaceCullingParams={face:1029,mode:2305};b.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};b.defaultDepthWriteParams={zNear:0,zFar:1};b.makeBlending=k;b.makeColorWrite=c;b.makeCulling=a;b.makeDepthTest=l;b.makeDepthWrite=d;b.makePipelineState=function(H){return G.intern(H)};b.makePolygonOffset=r;b.makeStencilTest=h;b.makeStencilWrite=e;b.separateBlendingParams=function(H,I,J,K,L=32774,S=32774,M=[0,0,0,0]){return{srcRgb:H,
srcAlpha:I,dstRgb:J,dstAlpha:K,opRgb:L,opAlpha:S,color:{r:M[0],g:M[1],b:M[2],a:M[3]}}};b.simpleBlendingParams=function(H,I,J=32774,K=[0,0,0,0]){return{srcRgb:H,srcAlpha:H,dstRgb:I,dstAlpha:I,opRgb:J,opAlpha:J,color:{r:K[0],g:K[1],b:K[2],a:K[3]}}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/buffer/glUtil":function(){define(["exports"],function(b){const k={divisor:0},a={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126};b.glLayout=function(r,l={}){l={...k,...l};const h=r.stride;return r.fieldNames.filter(d=>{d=r.fields.get(d).optional;return!(d&&d.glPadding)}).map(d=>{const c=r.fields.get(d),e=c.constructor.ElementCount;var f=a[c.constructor.ElementType];if(!f)throw Error("BufferType not supported in WebGL");return{name:d,stride:h,count:e,type:f,offset:c.offset,
normalized:!(!c.optional||!c.optional.glNormalized),divisor:l.divisor}})};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./BufferView","./types"],function(b,k,a,r){let l=function(){function d(e,f){this.layout=e;this.buffer="number"===typeof f?new ArrayBuffer(f*e.stride):f;for(const g of e.fieldNames)f=e.fields.get(g),this[g]=new f.constructor(this.buffer,f.offset,this.stride)}
var c=d.prototype;c.getField=function(e,f){return(e=this[e])&&e.elementCount===f.ElementCount&&e.elementType===f.ElementType?e:null};c.slice=function(e,f){return new d(this.layout,this.buffer.slice(e*this.stride,f*this.stride))};c.copyFrom=function(e,f,g,p){const n=this.stride;0===n%4?(e=new Uint32Array(e.buffer,f*n,p*n/4),(new Uint32Array(this.buffer,g*n,p*n/4)).set(e)):(e=new Uint8Array(e.buffer,f*n,p*n),(new Uint8Array(this.buffer,g*n,p*n)).set(e))};k._createClass(d,[{key:"stride",get:function(){return this.layout.stride}},
{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return d}(),h=function(){function d(){this.stride=0;this.fields=new Map;this.fieldNames=[]}var c=d.prototype;c.vec2f=function(e,f){this.appendField(e,a.BufferViewVec2f,f);return this};c.vec2f64=function(e,f){this.appendField(e,a.BufferViewVec2f64,f);return this};c.vec3f=function(e,f){this.appendField(e,a.BufferViewVec3f,f);return this};c.vec3f64=function(e,f){this.appendField(e,
a.BufferViewVec3f64,f);return this};c.vec4f=function(e,f){this.appendField(e,a.BufferViewVec4f,f);return this};c.vec4f64=function(e,f){this.appendField(e,a.BufferViewVec4f64,f);return this};c.mat3f=function(e,f){this.appendField(e,a.BufferViewMat3f,f);return this};c.mat3f64=function(e,f){this.appendField(e,a.BufferViewMat3f64,f);return this};c.mat4f=function(e,f){this.appendField(e,a.BufferViewMat4f,f);return this};c.mat4f64=function(e,f){this.appendField(e,a.BufferViewMat4f64,f);return this};c.vec4u8=
function(e,f){this.appendField(e,a.BufferViewVec4u8,f);return this};c.f32=function(e,f){this.appendField(e,a.BufferViewFloat,f);return this};c.f64=function(e,f){this.appendField(e,a.BufferViewFloat64,f);return this};c.u8=function(e,f){this.appendField(e,a.BufferViewUint8,f);return this};c.u16=function(e,f){this.appendField(e,a.BufferViewUint16,f);return this};c.i8=function(e,f){this.appendField(e,a.BufferViewInt8,f);return this};c.vec2i8=function(e,f){this.appendField(e,a.BufferViewVec2i8,f);return this};
c.vec2i16=function(e,f){this.appendField(e,a.BufferViewVec2i16,f);return this};c.vec2u8=function(e,f){this.appendField(e,a.BufferViewVec2u8,f);return this};c.vec4u16=function(e,f){this.appendField(e,a.BufferViewVec4u16,f);return this};c.u32=function(e,f){this.appendField(e,a.BufferViewUint32,f);return this};c.appendField=function(e,f,g){const p=f.ElementCount*r.elementTypeSize(f.ElementType);this.fields.set(e,{size:p,constructor:f,offset:this.stride,optional:g});this.stride+=p;this.fieldNames.push(e)};
c.alignTo=function(e){this.stride=Math.floor((this.stride+e-1)/e)*e;return this};c.hasField=function(e){return 0<=this.fieldNames.indexOf(e)};c.createBuffer=function(e){return new l(this,e)};c.createView=function(e){return new l(this,e)};c.clone=function(){const e=new d;e.stride=this.stride;e.fields=new Map;this.fields.forEach((f,g)=>e.fields.set(g,f));e.fieldNames=this.fieldNames.slice();e.BufferType=this.BufferType;return e};return d}();b.InterleavedBuffer=l;b.InterleavedLayout=h;b.newLayout=function(){return new h};
Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/BufferView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(b,k,a,r,l,h,d,c){let e=function(F){function N(P,U=0,V,W){P=F.call(this,Float32Array,P,U,V,W)||this;P.elementType="f32";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,
U,P.byteOffset+P.byteLength)};return N}(l.BufferViewScalarImpl);e.ElementType="f32";let f=function(F){function N(P,U=0,V,W){P=F.call(this,Float32Array,P,U,V,W)||this;P.elementType="f32";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(h.BufferViewVec2Impl);f.ElementType="f32";let g=function(F){function N(P,U=0,V,W){P=F.call(this,Float32Array,P,U,V,W)||this;P.elementType="f32";return P}k._inheritsLoose(N,F);N.fromTypedArray=
function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(d.BufferViewVec3Impl);g.ElementType="f32";let p=function(F){function N(P,U=0,V,W){P=F.call(this,Float32Array,P,U,V,W)||this;P.elementType="f32";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(c.BufferViewVec4Impl);p.ElementType="f32";let n=function(F){function N(P,U=0,V,W){P=F.call(this,Float32Array,P,U,V,W)||this;P.elementType=
"f32";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(a.BufferViewMat3Impl);n.ElementType="f32";a=function(F){function N(P,U=0,V,W){P=F.call(this,Float64Array,P,U,V,W)||this;P.elementType="f64";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(a.BufferViewMat3Impl);a.ElementType="f64";let w=function(F){function N(P,U=0,V,W){P=
F.call(this,Float32Array,P,U,V,W)||this;P.elementType="f32";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(r.BufferViewMat4Impl);w.ElementType="f32";r=function(F){function N(P,U=0,V,W){P=F.call(this,Float64Array,P,U,V,W)||this;P.elementType="f64";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(r.BufferViewMat4Impl);r.ElementType=
"f64";let q=function(F){function N(P,U=0,V,W){P=F.call(this,Float64Array,P,U,V,W)||this;P.elementType="f64";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(l.BufferViewScalarImpl);q.ElementType="f64";let m=function(F){function N(P,U=0,V,W){P=F.call(this,Float64Array,P,U,V,W)||this;P.elementType="f64";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+
P.byteLength)};return N}(h.BufferViewVec2Impl);m.ElementType="f64";let u=function(F){function N(P,U=0,V,W){P=F.call(this,Float64Array,P,U,V,W)||this;P.elementType="f64";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(d.BufferViewVec3Impl);u.ElementType="f64";let v=function(F){function N(P,U=0,V,W){P=F.call(this,Float64Array,P,U,V,W)||this;P.elementType="f64";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,
U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(c.BufferViewVec4Impl);v.ElementType="f64";let y=function(F){function N(P,U=0,V,W){P=F.call(this,Uint8Array,P,U,V,W)||this;P.elementType="u8";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(l.BufferViewScalarImpl);y.ElementType="u8";let B=function(F){function N(P,U=0,V,W){P=F.call(this,Uint8Array,P,U,V,W)||this;P.elementType="u8";return P}
k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(h.BufferViewVec2Impl);B.ElementType="u8";let x=function(F){function N(P,U=0,V,W){P=F.call(this,Uint8Array,P,U,V,W)||this;P.elementType="u8";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(d.BufferViewVec3Impl);x.ElementType="u8";let C=function(F){function N(P,U=0,V,W){P=F.call(this,Uint8Array,
P,U,V,W)||this;P.elementType="u8";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(c.BufferViewVec4Impl);C.ElementType="u8";let z=function(F){function N(P,U=0,V,W){P=F.call(this,Uint16Array,P,U,V,W)||this;P.elementType="u16";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(l.BufferViewScalarImpl);z.ElementType="u16";let A=function(F){function N(P,
U=0,V,W){P=F.call(this,Uint16Array,P,U,V,W)||this;P.elementType="u16";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(h.BufferViewVec2Impl);A.ElementType="u16";let t=function(F){function N(P,U=0,V,W){P=F.call(this,Uint16Array,P,U,V,W)||this;P.elementType="u16";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(d.BufferViewVec3Impl);
t.ElementType="u16";let D=function(F){function N(P,U=0,V,W){P=F.call(this,Uint16Array,P,U,V,W)||this;P.elementType="u16";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(c.BufferViewVec4Impl);D.ElementType="u16";let E=function(F){function N(P,U=0,V,W){P=F.call(this,Uint32Array,P,U,V,W)||this;P.elementType="u32";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+
P.byteLength)};return N}(l.BufferViewScalarImpl);E.ElementType="u32";let G=function(F){function N(P,U=0,V,W){P=F.call(this,Uint32Array,P,U,V,W)||this;P.elementType="u32";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(h.BufferViewVec2Impl);G.ElementType="u32";let H=function(F){function N(P,U=0,V,W){P=F.call(this,Uint32Array,P,U,V,W)||this;P.elementType="u32";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,
U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(d.BufferViewVec3Impl);H.ElementType="u32";let I=function(F){function N(P,U=0,V,W){P=F.call(this,Uint32Array,P,U,V,W)||this;P.elementType="u32";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(c.BufferViewVec4Impl);I.ElementType="u32";let J=function(F){function N(P,U=0,V,W){P=F.call(this,Int8Array,P,U,V,W)||this;P.elementType="i8";return P}
k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(l.BufferViewScalarImpl);J.ElementType="i8";let K=function(F){function N(P,U=0,V,W){P=F.call(this,Int8Array,P,U,V,W)||this;P.elementType="i8";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(h.BufferViewVec2Impl);K.ElementType="i8";let L=function(F){function N(P,U=0,V,W){P=F.call(this,
Int8Array,P,U,V,W)||this;P.elementType="i8";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(d.BufferViewVec3Impl);L.ElementType="i8";let S=function(F){function N(P,U=0,V,W){P=F.call(this,Int8Array,P,U,V,W)||this;P.elementType="i8";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(c.BufferViewVec4Impl);S.ElementType="i8";let M=
function(F){function N(P,U=0,V,W){P=F.call(this,Int16Array,P,U,V,W)||this;P.elementType="i16";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(l.BufferViewScalarImpl);M.ElementType="i16";let T=function(F){function N(P,U=0,V,W){P=F.call(this,Int16Array,P,U,V,W)||this;P.elementType="i16";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};
return N}(h.BufferViewVec2Impl);T.ElementType="i16";let O=function(F){function N(P,U=0,V,W){P=F.call(this,Int16Array,P,U,V,W)||this;P.elementType="i16";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(d.BufferViewVec3Impl);O.ElementType="i16";let Q=function(F){function N(P,U=0,V,W){P=F.call(this,Int16Array,P,U,V,W)||this;P.elementType="i16";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,
P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(c.BufferViewVec4Impl);Q.ElementType="i16";l=function(F){function N(P,U=0,V,W){P=F.call(this,Int32Array,P,U,V,W)||this;P.elementType="i32";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(l.BufferViewScalarImpl);l.ElementType="i32";h=function(F){function N(P,U=0,V,W){P=F.call(this,Int32Array,P,U,V,W)||this;P.elementType="i32";return P}k._inheritsLoose(N,F);N.fromTypedArray=
function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(h.BufferViewVec2Impl);h.ElementType="i32";d=function(F){function N(P,U=0,V,W){P=F.call(this,Int32Array,P,U,V,W)||this;P.elementType="i32";return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(d.BufferViewVec3Impl);d.ElementType="i32";c=function(F){function N(P,U=0,V,W){P=F.call(this,Int32Array,P,U,V,W)||this;P.elementType="i32";
return P}k._inheritsLoose(N,F);N.fromTypedArray=function(P,U){return new N(P.buffer,P.byteOffset,U,P.byteOffset+P.byteLength)};return N}(c.BufferViewVec4Impl);c.ElementType="i32";b.BufferViewFloat=e;b.BufferViewFloat64=q;b.BufferViewInt16=M;b.BufferViewInt32=l;b.BufferViewInt8=J;b.BufferViewMat3f=n;b.BufferViewMat3f64=a;b.BufferViewMat4f=w;b.BufferViewMat4f64=r;b.BufferViewUint16=z;b.BufferViewUint32=E;b.BufferViewUint8=y;b.BufferViewVec2f=f;b.BufferViewVec2f64=m;b.BufferViewVec2i16=T;b.BufferViewVec2i32=
h;b.BufferViewVec2i8=K;b.BufferViewVec2u16=A;b.BufferViewVec2u32=G;b.BufferViewVec2u8=B;b.BufferViewVec3f=g;b.BufferViewVec3f64=u;b.BufferViewVec3i16=O;b.BufferViewVec3i32=d;b.BufferViewVec3i8=L;b.BufferViewVec3u16=t;b.BufferViewVec3u32=H;b.BufferViewVec3u8=x;b.BufferViewVec4f=p;b.BufferViewVec4f64=v;b.BufferViewVec4i16=Q;b.BufferViewVec4i32=c;b.BufferViewVec4i8=S;b.BufferViewVec4u16=D;b.BufferViewVec4u32=I;b.BufferViewVec4u8=C;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(h,d,c=0,e,f){this.TypedArrayConstructor=h;this.elementCount=9;h=this.TypedArrayConstructor;void 0===e&&(e=9*h.BYTES_PER_ELEMENT);const g=0===d.byteLength?0:c;this.typedBuffer=null==f?new h(d,g):new h(d,g,(f-c)/h.BYTES_PER_ELEMENT);this.typedBufferStride=e/h.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var l=r.prototype;l.getMat=function(h,d){h*=this.typedBufferStride;for(let c=0;9>c;c++)d[c]=this.typedBuffer[h+c];return d};l.setMat=function(h,d){h*=this.typedBufferStride;for(let c=0;9>c;c++)this.typedBuffer[h+c]=d[c]};l.get=function(h,d){return this.typedBuffer[h*this.typedBufferStride+d]};l.set=function(h,d,c){this.typedBuffer[h*this.typedBufferStride+d]=c};l.copyFrom=function(h,d,c){const e=this.typedBuffer,f=d.typedBuffer;h*=this.typedBufferStride;d=c*d.typedBufferStride;for(c=0;9>c;++c)e[h+
c]=f[d+c]};k._createClass(r,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return r}();a.ElementCount=9;b.BufferViewMat3Impl=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(h,d,c=0,e,f){this.TypedArrayConstructor=h;this.elementCount=16;h=this.TypedArrayConstructor;void 0===e&&(e=16*h.BYTES_PER_ELEMENT);const g=
0===d.byteLength?0:c;this.typedBuffer=null==f?new h(d,g):new h(d,g,(f-c)/h.BYTES_PER_ELEMENT);this.typedBufferStride=e/h.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var l=r.prototype;l.getMat=function(h,d){h*=this.typedBufferStride;for(let c=0;16>c;c++)d[c]=this.typedBuffer[h+c];return d};l.setMat=function(h,d){h*=this.typedBufferStride;for(let c=0;16>c;c++)this.typedBuffer[h+
c]=d[c]};l.get=function(h,d){return this.typedBuffer[h*this.typedBufferStride+d]};l.set=function(h,d,c){this.typedBuffer[h*this.typedBufferStride+d]=c};l.copyFrom=function(h,d,c){const e=this.typedBuffer,f=d.typedBuffer;h*=this.typedBufferStride;d=c*d.typedBufferStride;for(c=0;16>c;++c)e[h+c]=f[d+c]};k._createClass(r,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return r}();a.ElementCount=16;b.BufferViewMat4Impl=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Scalar":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(h,d,c=0,e,f){this.TypedArrayConstructor=h;this.elementCount=1;h=this.TypedArrayConstructor;void 0===e&&(e=h.BYTES_PER_ELEMENT);const g=0===d.byteLength?0:c;this.typedBuffer=null==f?new h(d,g):new h(d,g,(f-c)/h.BYTES_PER_ELEMENT);this.typedBufferStride=e/h.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var l=r.prototype;l.get=function(h){return this.typedBuffer[h*this.typedBufferStride]};l.set=function(h,d){this.typedBuffer[h*this.typedBufferStride]=d};k._createClass(r,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return r}();a.ElementCount=1;b.BufferViewScalarImpl=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec2"],function(b,
k,a){let r=function(){function l(d,c,e=0,f,g){this.TypedArrayConstructor=d;this.elementCount=2;d=this.TypedArrayConstructor;void 0===f&&(f=2*d.BYTES_PER_ELEMENT);const p=0===c.byteLength?0:e;this.typedBuffer=null==g?new d(c,p):new d(c,p,(g-e)/d.BYTES_PER_ELEMENT);this.typedBufferStride=f/d.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var h=l.prototype;h.getVec=function(d,c){return a.set(c,
this.typedBuffer[d*this.typedBufferStride],this.typedBuffer[d*this.typedBufferStride+1])};h.setVec=function(d,c){this.typedBuffer[d*this.typedBufferStride]=c[0];this.typedBuffer[d*this.typedBufferStride+1]=c[1]};h.get=function(d,c){return this.typedBuffer[d*this.typedBufferStride+c]};h.set=function(d,c,e){this.typedBuffer[d*this.typedBufferStride+c]=e};h.setValues=function(d,c,e){this.typedBuffer[d*this.typedBufferStride]=c;this.typedBuffer[d*this.typedBufferStride+1]=e};h.copyFrom=function(d,c,e){const f=
this.typedBuffer,g=c.typedBuffer;d*=this.typedBufferStride;c=e*c.typedBufferStride;f[d]=g[c];f[d+1]=g[c+1]};k._createClass(l,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return l}();r.ElementCount=2;b.BufferViewVec2Impl=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3"],function(b,k,a){let r=function(){function l(d,c,e=0,
f,g){this.TypedArrayConstructor=d;this.elementCount=3;d=this.TypedArrayConstructor;void 0===f&&(f=3*d.BYTES_PER_ELEMENT);const p=0===c.byteLength?0:e;this.typedBuffer=null==g?new d(c,p):new d(c,p,(g-e)/d.BYTES_PER_ELEMENT);this.typedBufferStride=f/d.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var h=l.prototype;h.getVec=function(d,c){return a.set(c,this.typedBuffer[d*this.typedBufferStride],
this.typedBuffer[d*this.typedBufferStride+1],this.typedBuffer[d*this.typedBufferStride+2])};h.setVec=function(d,c){this.typedBuffer[d*this.typedBufferStride]=c[0];this.typedBuffer[d*this.typedBufferStride+1]=c[1];this.typedBuffer[d*this.typedBufferStride+2]=c[2]};h.get=function(d,c){return this.typedBuffer[d*this.typedBufferStride+c]};h.set=function(d,c,e){this.typedBuffer[d*this.typedBufferStride+c]=e};h.setValues=function(d,c,e,f){this.typedBuffer[d*this.typedBufferStride]=c;this.typedBuffer[d*
this.typedBufferStride+1]=e;this.typedBuffer[d*this.typedBufferStride+2]=f};h.copyFrom=function(d,c,e){const f=this.typedBuffer,g=c.typedBuffer;d*=this.typedBufferStride;c=e*c.typedBufferStride;f[d]=g[c];f[d+1]=g[c+1];f[d+2]=g[c+2]};k._createClass(l,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return l}();r.ElementCount=3;b.BufferViewVec3Impl=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../chunks/vec4"],function(b,k,a){let r=function(){function l(d,c,e=0,f,g){this.TypedArrayConstructor=d;this.elementCount=4;d=this.TypedArrayConstructor;void 0===f&&(f=4*d.BYTES_PER_ELEMENT);const p=0===c.byteLength?0:e;this.typedBuffer=null==g?new d(c,p):new d(c,p,(g-e)/d.BYTES_PER_ELEMENT);this.typedBufferStride=f/d.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var h=
l.prototype;h.getVec=function(d,c){return a.set(c,this.typedBuffer[d*this.typedBufferStride],this.typedBuffer[d*this.typedBufferStride+1],this.typedBuffer[d*this.typedBufferStride+2],this.typedBuffer[d*this.typedBufferStride+3])};h.setVec=function(d,c){this.typedBuffer[d*this.typedBufferStride]=c[0];this.typedBuffer[d*this.typedBufferStride+1]=c[1];this.typedBuffer[d*this.typedBufferStride+2]=c[2];this.typedBuffer[d*this.typedBufferStride+3]=c[3]};h.get=function(d,c){return this.typedBuffer[d*this.typedBufferStride+
c]};h.set=function(d,c,e){this.typedBuffer[d*this.typedBufferStride+c]=e};h.setValues=function(d,c,e,f,g){this.typedBuffer[d*this.typedBufferStride]=c;this.typedBuffer[d*this.typedBufferStride+1]=e;this.typedBuffer[d*this.typedBufferStride+2]=f;this.typedBuffer[d*this.typedBufferStride+3]=g};h.copyFrom=function(d,c,e){const f=this.typedBuffer,g=c.typedBuffer;d*=this.typedBufferStride;c=e*c.typedBufferStride;f[d]=g[c];f[d+1]=g[c+1];f[d+2]=g[c+2];f[d+3]=g[c+3]};k._createClass(l,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);
return l}();r.ElementCount=4;b.BufferViewVec4Impl=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/buffer/types":function(){define(["exports","../../../../core/has"],function(b,k){b.elementTypeSize=function(a){switch(a){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};b.isInteger=function(a){switch(a){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;
case "f32":case "f64":return!1}};b.isSigned=function(a){switch(a){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};b.maximumValue=function(a){switch(a){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define(["exports",
"../../../../../../chunks/mat4","../../../../../../chunks/mat4f32"],function(b,k,a){(function(l){function h(d,c,e){k.translate(r,e,c);d.setUniform3fv("localOrigin",c);d.setUniformMatrix4fv("view",r)}l.bindCamPosition=function(d,c,e){d.setUniform3f("camPos",e[3]-c[0],e[7]-c[1],e[11]-c[2])};l.bindProjectionMatrix=function(d,c){d.setUniformMatrix4fv("proj",c)};l.bindNearFar=function(d,c){d.setUniform2fv("nearFar",c)};l.bindViewCustomOrigin=h;l.bindView=function(d,c){h(d,c.origin,c.camera.viewMatrix)};
l.bindViewport=function(d,c){d.setUniform4fv("viewport",c.camera.fullViewport)}})(b.View||(b.View={}));const r=a.create();Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/mat4f32":function(){define(["exports"],function(b){function k(){const c=new Float32Array(16);c[0]=1;c[5]=1;c[10]=1;c[15]=1;return c}function a(c){const e=new Float32Array(16);e[0]=c[0];e[1]=c[1];e[2]=c[2];e[3]=c[3];e[4]=c[4];e[5]=c[5];e[6]=c[6];e[7]=c[7];e[8]=c[8];e[9]=c[9];e[10]=c[10];e[11]=c[11];e[12]=c[12];e[13]=
c[13];e[14]=c[14];e[15]=c[15];return e}function r(c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){const A=new Float32Array(16);A[0]=c;A[1]=e;A[2]=f;A[3]=g;A[4]=p;A[5]=n;A[6]=w;A[7]=q;A[8]=m;A[9]=u;A[10]=v;A[11]=y;A[12]=B;A[13]=x;A[14]=C;A[15]=z;return A}function l(c,e){return new Float32Array(c,e,16)}const h=k();var d=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,createView:l,IDENTITY:h});b.IDENTITY=h;b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.mat4f32=d})},"esri/views/3d/webgl-engine/lib/Util":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/mat4 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec2 ../../../../chunks/vec4".split(" "),
function(b,k,a,r,l,h,d,c){function e(y,B){if(!y)throw B=B||"assert",y=Error(B),y.stack&&console.log(y.stack),new q(B);}function f(y){for(const B in y)return B}function g(y,B){y[12]=B[0];y[13]=B[1];y[14]=B[2]}function p(y,B=0){let x=0;for(let C=0;4>C;C++)x+=y[B+C]*u[C];return x}function n(y){return y-Math.floor(y)}const w=h.create();let q=function(){function y(B){this.message=B}y.prototype.toString=function(){return`AssertException: ${this.message}`};return y}();const m=[1,256,65536,16777216],u=[1/
256,1/65536,1/16777216,1/4294967296],v=p(new Uint8ClampedArray([255,255,255,255]));b.AssertException=q;b.VertexAttrConstants={POSITION:"position",NORMAL:"normal",UV0:"uv0",UVMAPSPACE:"uvMapSpace",MEANVERTEXPOSITION:"meanVertexPosition",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",BOUND1:"bound1",BOUND2:"bound2",BOUND3:"bound3",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",TANGENT:"tangent"};b.assert=e;b.createTranslationMatrix=function(y,B){y=r.identity(y);g(y,B);return y};b.dec2hex=function(y){y=y.toString(16);
return"00000000".substr(0,8-y.length)+y};b.encodeInt16=function(y){return k.clamp(Math.round(32767*y),-32767,32767)};b.encodeNormal=function(y,B){const x=Math.abs(y[0]),C=Math.abs(y[1]),z=1/(x+C+Math.abs(y[2])),A=Math.min(y[2]*z,0);B[0]=(0>y[0]?-1:1)*(x*z-A);B[1]=(0>y[1]?-1:1)*(C*z-A)};b.fallbackIfUndefined=function(y,B){return void 0===y?B:y};b.fovd2fovx=function(y,B,x){return 2*Math.atan(B*Math.tan(.5*y)/Math.sqrt(B*B+x*x))};b.fovd2fovy=function(y,B,x){return 2*Math.atan(x*Math.tan(.5*y)/Math.sqrt(B*
B+x*x))};b.fovx2fovd=function(y,B,x){return 2*Math.atan(Math.sqrt(B*B+x*x)*Math.tan(.5*y)/B)};b.fovx2fovy=function(y,B,x){return 2*Math.atan(x*Math.tan(.5*y)/B)};b.fovy2fovd=function(y,B,x){return 2*Math.atan(Math.sqrt(B*B+x*x)*Math.tan(.5*y)/x)};b.fovy2fovx=function(y,B,x){return 2*Math.atan(B*Math.tan(.5*y)/x)};b.getFirstObjectKey=f;b.getFirstObjectValue=function(y){return y[f(y)]};b.getMatrixTranslation=function(y,B=a.create()){B[0]=y[12];B[1]=y[13];B[2]=y[14];return B};b.hex2rgb=function(y){y=
Math.floor(y);return[(y>>16&255)/255,(y>>8&255)/255,(y&255)/255]};b.inverseProjectionInfo=function(y,B,x,C,z){0===y[11]?(C[0]=2/(B*y[0]),C[1]=2/(x*y[5]),C[2]=(1+y[12])/y[0],C[3]=(1+y[13])/y[5],d.set(z,0,1)):(C[0]=-2/(B*y[0]),C[1]=-2/(x*y[5]),C[2]=(1-y[8])/y[0],C[3]=(1-y[9])/y[5],d.set(z,1,0))};b.isTranslationMatrix=function(y){return 1===y[0]&&0===y[1]&&0===y[2]&&0===y[3]&&0===y[4]&&1===y[5]&&0===y[6]&&0===y[7]&&0===y[8]&&0===y[9]&&1===y[10]&&0===y[11]&&1===y[15]};b.logWithBase=function(y,B){return Math.log(y)/
Math.log(B)};b.objectEmpty=function(y){for(const B in y)return!1;return!0};b.packFloatRGBA=function(y,B,x=0){y=k.clamp(y,0,v);for(let C=0;4>C;C++)B[x+C]=Math.floor(256*n(y*m[C]))};b.project=function(y,B,x,C,z){z||(z=y);w[0]=y[0];w[1]=y[1];w[2]=y[2];w[3]=1;c.transformMat4(w,w,B);2<z.length&&(z[2]=-w[2]);c.transformMat4(w,w,x);e(0!==w[3]);z[0]=w[0]/w[3];z[1]=w[1]/w[3];z[2]=w[2]/w[3];z[0]=(.5*z[0]+.5)*C[2]+C[0];z[1]=(.5*z[1]+.5)*C[3]+C[1]};b.rayBoxTest=function(y,B,x,C){let z,A=(x[0]-y[0])/B[0],t=(C[0]-
y[0])/B[0];A>t&&(z=A,A=t,t=z);let D=(x[1]-y[1])/B[1],E=(C[1]-y[1])/B[1];D>E&&(z=D,D=E,E=z);if(A>E||D>t)return!1;D>A&&(A=D);E<t&&(t=E);x=(x[2]-y[2])/B[2];y=(C[2]-y[2])/B[2];x>y&&(z=x,x=y,y=z);if(A>y||x>t)return!1;y<t&&(t=y);return 0>t?!1:!0};b.rayRay2D=function(y,B,x,C,z,A=l.create()){const t=(C[z]-x[z])*(B[0]-y[0])-(C[0]-x[0])*(B[z]-y[z]);if(0===t)return!1;x=((C[0]-x[0])*(y[z]-x[z])-(C[z]-x[z])*(y[0]-x[0]))/t;A[0]=y[0]+x*(B[0]-y[0]);A[1]=y[z]+x*(B[z]-y[z]);return!0};b.rayTriangle3D=function(y,B,x,
C,z,A,t,D,E=a.create()){var G=C[t]-x[A];const H=C[t+1]-x[A+1],I=C[t+2]-x[A+2];C=z[D]-x[A];t=z[D+1]-x[A+1];z=z[D+2]-x[A+2];const J=B[1]*z-t*B[2],K=B[2]*C-z*B[0],L=B[0]*t-C*B[1];D=G*J+H*K+I*L;if(-1E-5<D&&1E-5>D)return!1;D=1/D;const S=y[0]-x[A],M=y[1]-x[A+1];y=y[2]-x[A+2];E[1]=D*(S*J+M*K+y*L);if(0>E[1]||1<E[1])return!1;x=M*I-H*y;y=y*G-I*S;G=S*H-G*M;E[2]=D*(B[0]*x+B[1]*y+B[2]*G);if(0>E[2]||1<E[1]+E[2])return!1;E[0]=D*(C*x+t*y+z*G);return!0};b.rgb2hex=function(y){const B=k.clamp(Math.round(255*y[0]),0,
255),x=k.clamp(Math.round(255*y[1]),0,255);y=k.clamp(Math.round(255*y[2]),0,255);return"0x"+((B<<16)+(x<<8)+y).toString(16)};b.setMatrixTranslation=g;b.setMatrixTranslation3=function(y,B,x,C){y[12]=B;y[13]=x;y[14]=C};b.unpackFloatRGBA=p;b.verify=function(y,B){y||console.warn("Verify failed: "+(B||"")+"\n"+Error("verify").stack)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../support/geometryUtils ./BufferVectorMath ./Util ./GeometryData".split(" "),
function(b,k,a,r,l,h,d){const c=l.Vec3Compact;var e;(function(w){const q=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],m=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],u=[0,0,1,0,1,1,0,1],v=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],y=Array(36);for(var B=0;6>B;B++)for(let C=0;6>C;C++)y[6*B+C]=B;const x=Array(36);for(B=0;6>B;B++)x[6*B]=0,x[6*B+1]=1,x[6*B+2]=2,x[6*B+3]=2,x[6*B+4]=3,x[6*B+5]=0;w.createGeometry=function(C){Array.isArray(C)||
(C=[C,C,C]);const z=new Float32Array(24);for(var A=0;8>A;A++)z[3*A]=q[A][0]*C[0],z[3*A+1]=q[A][1]*C[1],z[3*A+2]=q[A][2]*C[2];C={};C[h.VertexAttrConstants.POSITION]=new Uint32Array(v);C[h.VertexAttrConstants.NORMAL]=new Uint32Array(y);C[h.VertexAttrConstants.UV0]=new Uint32Array(x);A={};A[h.VertexAttrConstants.POSITION]={size:3,data:z};A[h.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(m)};A[h.VertexAttrConstants.UV0]={size:2,data:new Float32Array(u)};return new d.GeometryData(A,C)}})(e||
(e={}));var f;(function(w){const q=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],m=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],u=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],v=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];w.createGeometry=function(y){Array.isArray(y)||(y=[y,y,y]);const B=new Float32Array(18);for(var x=0;6>x;x++)B[3*x]=q[x][0]*y[0],B[3*x+1]=q[x][1]*y[1],B[3*x+2]=q[x][2]*y[2];y={};y[h.VertexAttrConstants.POSITION]=new Uint32Array(u);y[h.VertexAttrConstants.NORMAL]=
new Uint32Array(v);x={};x[h.VertexAttrConstants.POSITION]={size:3,data:B};x[h.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(m)};return new d.GeometryData(x,y)}})(f||(f={}));var g;(function(w){const q=a.fromValues(-.5,0,-.5),m=a.fromValues(.5,0,-.5),u=a.fromValues(0,0,.5),v=a.fromValues(0,.5,0),y=a.create(),B=a.create(),x=a.create(),C=a.create(),z=a.create();k.subtract(y,q,v);k.subtract(B,q,m);k.cross(x,y,B);k.normalize(x,x);k.subtract(y,m,v);k.subtract(B,m,u);k.cross(C,y,B);k.normalize(C,
C);k.subtract(y,u,v);k.subtract(B,u,q);k.cross(z,y,B);k.normalize(z,z);const A=[q,m,u,v],t=[0,-1,0,x[0],x[1],x[2],C[0],C[1],C[2],z[0],z[1],z[2]],D=[0,1,2,3,1,0,3,2,1,3,0,2],E=[0,0,0,1,1,1,2,2,2,3,3,3];w.createGeometry=function(G){Array.isArray(G)||(G=[G,G,G]);const H=new Float32Array(12);for(var I=0;4>I;I++)H[3*I]=A[I][0]*G[0],H[3*I+1]=A[I][1]*G[1],H[3*I+2]=A[I][2]*G[2];G={};G[h.VertexAttrConstants.POSITION]=new Uint32Array(D);G[h.VertexAttrConstants.NORMAL]=new Uint32Array(E);I={};I[h.VertexAttrConstants.POSITION]=
{size:3,data:H};I[h.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(t)};return new d.GeometryData(I,G)}})(g||(g={}));var p;(function(w){function q(v,y,B,x,C){if(Math.abs(k.dot(y,v))>C)return!1;k.cross(B,v,y);k.normalize(B,B);k.cross(x,B,v);k.normalize(x,x);return!0}function m(v,y,B,x,C,z,A){return q(v,y,C,z,A)||q(v,B,C,z,A)||q(v,x,C,z,A)}w.createBoxGeometry=e.createGeometry;w.createDiamondGeometry=f.createGeometry;w.createTetrahedronGeometry=g.createGeometry;w.createSphereGeometry=function(v,
y,B,x){const {phiStart:C=-Math.PI,phiLength:z=2*Math.PI,thetaStart:A=-Math.PI/2,thetaLength:t=Math.PI}=x||{},{position:D=h.VertexAttrConstants.POSITION,normal:E=h.VertexAttrConstants.NORMAL,uv:G=h.VertexAttrConstants.UV0}=(null==x?void 0:x.attributes)||{};x=Math.max(3,Math.floor(y));var H=Math.max(2,Math.floor(B)),I=(x+1)*(H+1);B=new Float32Array(3*I);y=new Float32Array(3*I);I=new Float32Array(2*I);const J=[];let K=0;for(var L=0;L<=H;L++){var S=[],M=L/H,T=A+M*t,O=Math.cos(T);for(var Q=0;Q<=x;Q++){const N=
Q/x;var F=C+N*z;const P=Math.cos(F)*O,U=Math.sin(T);F=-Math.sin(F)*O;B[3*K]=P*v;B[3*K+1]=U*v;B[3*K+2]=F*v;y[3*K]=P;y[3*K+1]=U;y[3*K+2]=F;I[2*K]=N;I[2*K+1]=M;S.push(K);++K}J.push(S)}v=new Uint32Array(2*x*(H-1)*3);K=0;for(L=0;L<H;L++)for(S=0;S<x;S++)M=J[L][S],T=J[L][S+1],O=J[L+1][S+1],Q=J[L+1][S],0===L?(v[K++]=M,v[K++]=O,v[K++]=Q):L===H-1?(v[K++]=M,v[K++]=T,v[K++]=O):(v[K++]=M,v[K++]=T,v[K++]=O,v[K++]=O,v[K++]=Q,v[K++]=M);x={};x[D]=v;x[E]=v;H={};H[D]={size:3,data:B};H[E]={size:3,data:y};G&&(H[G]={size:2,
data:I},x[G]=v);return new d.GeometryData(H,x)};w.createPolySphereGeometry=function(v,y,B){function x(t,D){t>D&&([t,D]=[D,t]);const E=t.toString()+"."+D.toString();if(A[E])return A[E];let G=C.length;C.length+=3;c.add(C,3*t,C,3*D,C,G);c.scale(C,G,v/c.length(C,G));G/=3;return A[E]=G}let C;B?(C=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],B=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(B=v*(1+Math.sqrt(5))/2,C=[-v,B,0,v,B,0,-v,-B,0,v,-B,0,0,-v,B,0,v,B,0,-v,-B,0,v,-B,B,0,-v,B,0,v,-B,
0,-v,-B,0,v],B=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var z=0;z<C.length;z+=3)c.scale(C,z,v/c.length(C,z));let A={};for(z=0;z<y;z++){const t=B.length,D=new Uint32Array(4*t);for(let E=0;E<t;E+=3){const G=B[E],H=B[E+1],I=B[E+2],J=x(G,H),K=x(H,I),L=x(I,G),S=4*E;D[S]=G;D[S+1]=J;D[S+2]=L;D[S+3]=H;D[S+4]=K;D[S+5]=J;D[S+6]=I;D[S+7]=L;D[S+8]=K;D[S+9]=J;D[S+10]=K;D[S+11]=L}B=D;A={}}y=new Float32Array(C);
for(z=0;z<y.length;z+=3)c.normalize(y,z);z={};z[h.VertexAttrConstants.POSITION]=B;z[h.VertexAttrConstants.NORMAL]=B;B={};B[h.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(C)};B[h.VertexAttrConstants.NORMAL]={size:3,data:y};return new d.GeometryData(B,z)};w.createPointGeometry=function(v,y,B,x,C,z,A,t){y=y?new Float64Array([y[0],y[1],y[2]]):new Float32Array([0,0,0]);v=v?new Float32Array([v[0],v[1],v[2]]):new Float32Array([0,0,1]);z=z?new Float32Array(z):new Float32Array([0,0]);B=B?new Uint8Array([255*
B[0],255*B[1],255*B[2],3<B.length?255*B[3]:255]):new Uint8Array([255,255,255,255]);const D=null!=x&&2===x.length?new Float32Array(x):new Float32Array([1,1]);x={};x[h.VertexAttrConstants.POSITION]={size:3,data:y};x[h.VertexAttrConstants.NORMAL]={size:3,data:v};x[h.VertexAttrConstants.UV0]={size:z.length,data:z};x[h.VertexAttrConstants.COLOR]={size:4,data:B};x[h.VertexAttrConstants.SIZE]={size:2,data:D};null!=C&&(C=new Float32Array([C[0],C[1],C[2],C[3]]),x[h.VertexAttrConstants.AUXPOS1]={size:4,data:C});
null!=A&&(A=new Float32Array([A[0],A[1],A[2],A[3]]),x[h.VertexAttrConstants.AUXPOS2]={size:4,data:A});return null!=t?(t.initialize(x,d.GeometryData.DefaultIndices,"point"),t):new d.GeometryData(x,d.GeometryData.DefaultIndices,"point")};w.updatePointGeometry=function(v,y,B,x,C,z,A,t){const D=t.vertexAttributes;if(null!=v){const {data:E}=D[h.VertexAttrConstants.NORMAL];E[0]=v[0];E[1]=v[1];E[2]=v[2]}null!=y&&({data:v}=D[h.VertexAttrConstants.POSITION],v[0]=y[0],v[1]=y[1],v[2]=y[2]);null!=B&&({data:y}=
D[h.VertexAttrConstants.COLOR],y[0]=B[0],y[1]=B[1],y[2]=B[2],y[3]=B[3]);null!=x&&({data:B}=D[h.VertexAttrConstants.SIZE],B[0]=x[0],B[1]=x[1]);null!=C&&({data:x}=D[h.VertexAttrConstants.AUXPOS1],x[0]=C[0],x[1]=C[1],x[2]=C[2],x[3]=C[3]);null!=z&&({data:C}=D[h.VertexAttrConstants.UV0],C[0]=z[0],C[1]=z[1]);null!=A&&({data:z}=D[h.VertexAttrConstants.AUXPOS2],z[0]=A[0],z[1]=A[1],z[2]=A[2],z[3]=A[3]);return t};w.createPointArrayGeometry=function(v,y){const B=new Float32Array(3*v.length),x=new Float32Array(y?
3*v.length:3),C=new Uint32Array(v.length),z=new Uint32Array(v.length);for(var A=0;A<v.length;A++)B[3*A]=v[A][0],B[3*A+1]=v[A][1],B[3*A+2]=v[A][2],y&&(x[3*A]=y[A][0],x[3*A+1]=y[A][1],x[3*A+2]=y[A][2]),C[A]=A,z[A]=0;y||(x[0]=0,x[1]=1,x[2]=0);v=new Float32Array(2);v[0]=0;v[1]=0;A={};A[h.VertexAttrConstants.POSITION]=C;A[h.VertexAttrConstants.NORMAL]=y?C:z;A[h.VertexAttrConstants.UV0]=z;y={};y[h.VertexAttrConstants.POSITION]={size:3,data:B};y[h.VertexAttrConstants.NORMAL]={size:3,data:x};y[h.VertexAttrConstants.UV0]=
{size:2,data:v};return new d.GeometryData(y,A,"point")};w.createTriangleGeometry=function(){const v=new Float32Array([0,0,0,0,0,100,100,0,0]);var y=new Uint32Array([0,1,2]);const B=new Float32Array([0,1,0]),x=new Uint32Array([0,0,0]),C=new Float32Array([0,0]),z=new Uint32Array([0,0,0]),A={};A[h.VertexAttrConstants.POSITION]=y;A[h.VertexAttrConstants.NORMAL]=x;A[h.VertexAttrConstants.UV0]=z;y={};y[h.VertexAttrConstants.POSITION]={size:3,data:v};y[h.VertexAttrConstants.NORMAL]={size:3,data:B};y[h.VertexAttrConstants.UV0]=
{size:2,data:C};return new d.GeometryData(y,A)};const u=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];w.createSquareGeometry=function(v=u){const y=new Float64Array(12);for(var B=0;4>B;B++)for(var x=0;3>x;x++)y[3*B+x]=v[B][x];v=new Uint32Array([0,1,2,2,3,0]);B=new Float32Array([0,0,1]);x=new Uint32Array([0,0,0,0,0,0]);const C=new Float32Array([0,0,1,0,1,1,0,1]),z=new Uint8Array([255,255,255,255]);return new d.GeometryData({[h.VertexAttrConstants.POSITION]:{size:3,data:y},[h.VertexAttrConstants.NORMAL]:{size:3,
data:B},[h.VertexAttrConstants.UV0]:{size:2,data:C},[h.VertexAttrConstants.COLOR]:{size:4,data:z}},{[h.VertexAttrConstants.POSITION]:v,[h.VertexAttrConstants.NORMAL]:x,[h.VertexAttrConstants.UV0]:v,[h.VertexAttrConstants.COLOR]:x})};w.createConeGeometry=function(v,y,B,x,C=!0,z=!0){var A=0,t=a.fromValues(0,A,0),D=a.fromValues(0,A+v,0),E=a.fromValues(0,-1,0),G=a.fromValues(0,1,0);x&&(A=v,D=a.fromValues(0,0,0),t=a.fromValues(0,A,0),E=a.fromValues(0,1,0),G=a.fromValues(0,-1,0));t=[D,t];E=[E,G];G=B+2;
D=Math.sqrt(v*v+y*y);if(x)for(x=B-1;0<=x;x--){var H=2*Math.PI/B*x,I=a.fromValues(Math.cos(H)*y,A,Math.sin(H)*y);t.push(I);H=a.fromValues(v*Math.cos(H)/D,-y/D,v*Math.sin(H)/D);E.push(H)}else for(x=0;x<B;x++)H=2*Math.PI/B*x,I=a.fromValues(Math.cos(H)*y,A,Math.sin(H)*y),t.push(I),H=a.fromValues(v*Math.cos(H)/D,y/D,v*Math.sin(H)/D),E.push(H);v=new Uint32Array(6*(B+2));B=new Uint32Array(6*(B+2));A=y=0;if(C){for(C=3;C<t.length;C++)v[y++]=1,v[y++]=C-1,v[y++]=C,B[A++]=0,B[A++]=0,B[A++]=0;v[y++]=t.length-
1;v[y++]=2;v[y++]=1;B[A++]=0;B[A++]=0;B[A++]=0}if(z){for(z=3;z<t.length;z++)v[y++]=z,v[y++]=z-1,v[y++]=0,B[A++]=z,B[A++]=z-1,B[A++]=1;v[y++]=0;v[y++]=2;v[y++]=t.length-1;B[A++]=1;B[A++]=2;B[A++]=E.length-1}z=new Float32Array(3*G);for(C=0;C<G;C++)z[3*C]=t[C][0],z[3*C+1]=t[C][1],z[3*C+2]=t[C][2];t=new Float32Array(3*G);for(C=0;C<G;C++)t[3*C]=E[C][0],t[3*C+1]=E[C][1],t[3*C+2]=E[C][2];E={};E[h.VertexAttrConstants.POSITION]=v;E[h.VertexAttrConstants.NORMAL]=B;G={};G[h.VertexAttrConstants.POSITION]={size:3,
data:z};G[h.VertexAttrConstants.NORMAL]={size:3,data:t};return new d.GeometryData(G,E)};w.createCylinderGeometry=function(v,y,B,x,C,z){x=x?a.clone(x):a.fromValues(1,0,0);C=C?a.clone(C):a.fromValues(0,0,0);var A=void 0===z?!0:z,t=a.create();k.normalize(t,x);const D=a.create();k.scale(D,t,Math.abs(v));const E=a.create();k.scale(E,D,-.5);k.add(E,E,C);const G=a.fromValues(0,1,0);.2>Math.abs(1-k.dot(t,G))&&k.set(G,0,0,1);const H=a.create();k.cross(H,t,G);k.normalize(H,H);k.cross(G,H,t);z=2*B+(A?2:0);const I=
B+(A?2:0);v=new Float32Array(3*z);C=new Float32Array(3*I);x=new Float32Array(2*z);const J=new Uint32Array(3*B*(A?4:2)),K=new Uint32Array(3*B*(A?4:2));A&&(v[3*(z-2)]=E[0],v[3*(z-2)+1]=E[1],v[3*(z-2)+2]=E[2],x[2*(z-2)]=0,x[2*(z-2)+1]=0,v[3*(z-1)]=v[3*(z-2)]+D[0],v[3*(z-1)+1]=v[3*(z-2)+1]+D[1],v[3*(z-1)+2]=v[3*(z-2)+2]+D[2],x[2*(z-1)]=1,x[2*(z-1)+1]=1,C[3*(I-2)]=-t[0],C[3*(I-2)+1]=-t[1],C[3*(I-2)+2]=-t[2],C[3*(I-1)]=t[0],C[3*(I-1)+1]=t[1],C[3*(I-1)+2]=t[2]);t=function(O,Q,F){J[O]=Q;K[O]=F};let L=0;const S=
a.create(),M=a.create();for(let O=0;O<B;O++){var T=2*Math.PI/B*O;k.scale(S,G,Math.sin(T));k.scale(M,H,Math.cos(T));k.add(S,S,M);C[3*O]=S[0];C[3*O+1]=S[1];C[3*O+2]=S[2];k.scale(S,S,y);k.add(S,S,E);v[3*O]=S[0];v[3*O+1]=S[1];v[3*O+2]=S[2];x[2*O]=O/B;x[2*O+1]=0;v[3*(O+B)]=v[3*O]+D[0];v[3*(O+B)+1]=v[3*O+1]+D[1];v[3*(O+B)+2]=v[3*O+2]+D[2];x[2*(O+B)]=O/B;x[2*O+1]=1;T=(O+1)%B;t(L++,O,O);t(L++,O+B,O);t(L++,T,T);t(L++,T,T);t(L++,O+B,O);t(L++,T+B,T)}if(A){for(y=0;y<B;y++)A=(y+1)%B,t(L++,z-2,I-2),t(L++,y,I-2),
t(L++,A,I-2);for(y=0;y<B;y++)A=(y+1)%B,t(L++,y+B,I-1),t(L++,z-1,I-1),t(L++,A+B,I-1)}B={};B[h.VertexAttrConstants.POSITION]=J;B[h.VertexAttrConstants.NORMAL]=K;B[h.VertexAttrConstants.UV0]=J;y={};y[h.VertexAttrConstants.POSITION]={size:3,data:v};y[h.VertexAttrConstants.NORMAL]={size:3,data:C};y[h.VertexAttrConstants.UV0]={size:2,data:x};return new d.GeometryData(y,B)};w.createTubeGeometry=function(v,y,B,x,C){B=B||10;x=null!=x?x:!0;h.assert(1<v.length);const z=[],A=[];for(let t=0;t<B;t++){z.push([0,
-t-1,-((t+1)%B)-1]);const D=t/B*2*Math.PI;A.push([Math.cos(D)*y,Math.sin(D)*y])}return w.createPathExtrusionGeometry(A,v,[[0,0,0]],z,x,C)};w.createPathExtrusionGeometry=function(v,y,B,x,C,z=a.fromValues(0,0,0)){var A=v.length;const t=new Float32Array(y.length*A*3+(6*B.length||0)),D=new Float32Array(y.length*A+(2*B.length||0)),E=new Float32Array(y.length*A*3+(B?6:0));var G=(y.length-1)*A*6+6*x.length,H=new Uint32Array(G);G=new Uint32Array(G);let I=0;var J=0;let K=0,L=0,S=0;const M=a.create(),T=a.create(),
O=a.create(),Q=a.create(),F=a.create(),N=a.create(),P=a.create(),U=b.create(),V=a.create(),W=a.create(),X=a.create(),ca=a.create(),R=a.create(),aa=r.plane.create();k.set(V,0,1,0);k.subtract(T,y[1],y[0]);k.normalize(T,T);C?(k.add(U,y[0],z),k.normalize(O,U)):k.set(O,0,0,1);m(T,O,V,V,F,O,.99619469809);k.copy(Q,O);k.copy(ca,F);for(var ka=0;ka<B.length;ka++)k.scale(N,F,B[ka][0]),k.scale(U,O,B[ka][2]),k.add(N,N,U),k.add(N,N,y[0]),t[I++]=N[0],t[I++]=N[1],t[I++]=N[2],D[K++]=0;E[J++]=-T[0];E[J++]=-T[1];E[J++]=
-T[2];for(ka=0;ka<x.length;ka++)H[L++]=0<x[ka][0]?x[ka][0]:-x[ka][0]-1+B.length,H[L++]=0<x[ka][1]?x[ka][1]:-x[ka][1]-1+B.length,H[L++]=0<x[ka][2]?x[ka][2]:-x[ka][2]-1+B.length,G[S++]=0,G[S++]=0,G[S++]=0;ka=B.length;const da=B.length-1;for(let ea=0;ea<y.length;ea++){let Y=!1;0<ea&&(k.copy(M,T),ea<y.length-1?(k.subtract(T,y[ea+1],y[ea]),k.normalize(T,T)):Y=!0,k.add(W,M,T),k.normalize(W,W),k.add(X,y[ea-1],Q),r.plane.fromPositionAndNormal(y[ea],W,aa),r.plane.intersectRay(aa,r.ray.wrap(X,M),U)?(k.subtract(U,
U,y[ea]),k.normalize(O,U),k.cross(F,W,O),k.normalize(F,F)):m(W,Q,ca,V,F,O,.99619469809),k.copy(Q,O),k.copy(ca,F));C&&(k.add(U,y[ea],z),k.normalize(R,U));for(let Z=0;Z<A;Z++)if(k.scale(N,F,v[Z][0]),k.scale(U,O,v[Z][1]),k.add(N,N,U),k.normalize(P,N),E[J++]=P[0],E[J++]=P[1],E[J++]=P[2],C?D[K++]=k.dot(N,R):D[K++]=N[2],k.add(N,N,y[ea]),t[I++]=N[0],t[I++]=N[1],t[I++]=N[2],!Y){var fa=(Z+1)%A;H[L++]=ka+Z;H[L++]=ka+A+Z;H[L++]=ka+fa;H[L++]=ka+fa;H[L++]=ka+A+Z;H[L++]=ka+A+fa;for(fa=0;6>fa;fa++)G[S++]=H[L-6+
fa]-da}ka+=A}v=y[y.length-1];for(y=0;y<B.length;y++)k.scale(N,F,B[y][0]),k.scale(U,O,B[y][1]),k.add(N,N,U),k.add(N,N,v),t[I++]=N[0],t[I++]=N[1],t[I++]=N[2],D[K++]=0;B=J/3;E[J++]=T[0];E[J++]=T[1];E[J++]=T[2];A=ka-A;for(J=0;J<x.length;J++)H[L++]=0<=x[J][0]?ka+x[J][0]:-x[J][0]-1+A,H[L++]=0<=x[J][2]?ka+x[J][2]:-x[J][2]-1+A,H[L++]=0<=x[J][1]?ka+x[J][1]:-x[J][1]-1+A,G[S++]=B,G[S++]=B,G[S++]=B;x={};x[h.VertexAttrConstants.POSITION]=H;x[h.VertexAttrConstants.NORMAL]=G;H={};H[h.VertexAttrConstants.POSITION]=
{size:3,data:t};H.zOffset={size:1,data:D};H[h.VertexAttrConstants.NORMAL]={size:3,data:E};return new d.GeometryData(H,x)};w.createPolylineGeometry=function(v,y){h.assert(1<v.length,"createPolylineGeometry(): polyline needs at least 2 points");h.assert(3===v[0].length,"createPolylineGeometry(): malformed vertex");h.assert(void 0===y||y.length===v.length,"createPolylineGeometry: need same number of points and normals");h.assert(void 0===y||3===y[0].length,"createPolylineGeometry(): malformed normal");
var B=new Float64Array(3*v.length);const x=new Uint32Array(2*(v.length-1));var C=0,z=0;for(var A=0;A<v.length;A++){for(var t=0;3>t;t++)B[C++]=v[A][t];0<A&&(x[z++]=A-1,x[z++]=A)}C={};z={};C[h.VertexAttrConstants.POSITION]=x;z[h.VertexAttrConstants.POSITION]={size:3,data:B};if(y){B=new Float32Array(3*y.length);A=0;for(t=0;t<v.length;t++)for(let D=0;3>D;D++)B[A++]=y[t][D];C[h.VertexAttrConstants.NORMAL]=x;z[h.VertexAttrConstants.NORMAL]={size:3,data:B}}return new d.GeometryData(z,C,"line")};w.createExtrudedTriangle=
function(v,y,B,x){const C=new Float32Array(18);v=[[-y,0,x/2],[B,0,x/2],[0,v,x/2],[-y,0,-x/2],[B,0,-x/2],[0,v,-x/2]];for(y=0;6>y;y++)C[3*y]=v[y][0],C[3*y+1]=v[y][1],C[3*y+2]=v[y][2];v={[h.VertexAttrConstants.POSITION]:new Uint32Array([0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5])};return new d.GeometryData({[h.VertexAttrConstants.POSITION]:{size:3,data:C}},v)};w.transformInPlace=function(v,y){v=v.vertexAttributes[h.VertexAttrConstants.POSITION].data;for(let B=0;B<v.length;B+=3)k.set(n,v[B],v[B+
1],v[B+2]),k.transformMat4(n,n,y),v[B]=n[0],v[B+1]=n[1],v[B+2]=n[2]};w.cgToGIS=function(v,y=v){var B=v.getVertexAttr();v=B.position.data;var x=B.normal.data,C=y.getVertexAttr();B=C.position.data;C=C.normal.data;if(x)for(let z=0;z<x.length;z+=3){const A=x[z+1];C[z+1]=-x[z+2];C[z+2]=A}if(v)for(x=0;x<v.length;x+=3)C=v[x+1],B[x+1]=-v[x+2],B[x+2]=C;return y};w.makeOrthoBasisDirUp=q;w.makeOrthoBasisDirUpFallback=m})(p||(p={}));const n=a.create();return p})},"esri/chunks/vec3f32":function(){define(["exports"],
function(b){function k(){return new Float32Array(3)}function a(u){const v=new Float32Array(3);v[0]=u[0];v[1]=u[1];v[2]=u[2];return v}function r(u,v,y){const B=new Float32Array(3);B[0]=u;B[1]=v;B[2]=y;return B}function l(u,v){return new Float32Array(u,v,3)}function h(){return k()}function d(){return r(1,1,1)}function c(){return r(1,0,0)}function e(){return r(0,1,0)}function f(){return r(0,0,1)}const g=k(),p=d(),n=c(),w=e(),q=f();var m=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,createView:l,
zeros:h,ones:d,unitX:c,unitY:e,unitZ:f,ZEROS:g,ONES:p,UNIT_X:n,UNIT_Y:w,UNIT_Z:q});b.ONES=p;b.UNIT_X=n;b.UNIT_Y=w;b.UNIT_Z=q;b.ZEROS=g;b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.ones=d;b.unitX=c;b.unitY=e;b.unitZ=f;b.vec3f32=m;b.zeros=h})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(b){(function(k){k.length=function(a,r){const l=a[r],h=a[r+1];a=a[r+2];return Math.sqrt(l*l+h*h+a*a)};k.normalize=function(a,r){var l=a[r];const h=a[r+1],d=a[r+2];
l=1/Math.sqrt(l*l+h*h+d*d);a[r]*=l;a[r+1]*=l;a[r+2]*=l};k.scale=function(a,r,l){a[r]*=l;a[r+1]*=l;a[r+2]*=l};k.add=function(a,r,l,h,d,c=r){d=d||a;d[c]=a[r]+l[h];d[c+1]=a[r+1]+l[h+1];d[c+2]=a[r+2]+l[h+2]};k.subtract=function(a,r,l,h,d,c=r){d=d||a;d[c]=a[r]-l[h];d[c+1]=a[r+1]-l[h+1];d[c+2]=a[r+2]-l[h+2]}})(b.Vec3Compact||(b.Vec3Compact={}));Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"./geometryDataUtils","./Util"],function(b,k,a,r){let l=function(){function h(c,e=h.DefaultIndices,f="triangle"){this.initialize(c,e,f)}var d=h.prototype;d.getVertexAttr=function(){return this.vertexAttributes};d.initialize=function(c,e=h.DefaultIndices,f="triangle"){const g={};for(const p in c){const {data:n,size:w}=c[p];g[p]={data:n,size:w,offsetIdx:0,strideIdx:w}}if(e===h.DefaultIndices){e=r.getFirstObjectValue(g);e=null==e?0:e.data.length/e.size;c=a.generateDefaultIndexArray(e);e={};for(const p in g)e[p]=
c}this._id=a.getNewId();this._vertexAttributes=g;this._indices=e;this._primitiveType=f};d.toRenderData=function(){return{id:this._id.toString(),indices:this._indices,vertexAttr:this._vertexAttributes}};d.getIndices=function(c){return this._indices[c]};d.getAttribute=function(c){return this._vertexAttributes[c]};d.estimateGpuMemoryUsage=function(){let c=0;this._indices[r.VertexAttrConstants.POSITION]&&(c+=12*this._indices[r.VertexAttrConstants.POSITION].length);this._indices[r.VertexAttrConstants.NORMAL]&&
(c+=12*this._indices[r.VertexAttrConstants.NORMAL].length);this._indices[r.VertexAttrConstants.UV0]&&(c+=8*this._indices[r.VertexAttrConstants.UV0].length);this._indices[r.VertexAttrConstants.COLOR]&&(c+=4*this._indices[r.VertexAttrConstants.COLOR].length);return c};k._createClass(h,[{key:"id",get:function(){return this._id}},{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const c=r.getFirstObjectValue(this._indices);
return null==c?0:c.length}},{key:"primitiveType",get:function(){return this._primitiveType}}]);return h}();l.DefaultIndices={};b.GeometryData=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../chunks/triangle"],function(b,k,a,r){let l=1,h=null;const d=new Uint32Array([0]);let c=0;const e=k.create(),f=k.create(),g=k.create(),p=k.create();b.computeAttachmentOriginLines=
function(n,w,q,m){if(!n)return!1;const {strideIdx:u,offsetIdx:v,data:y}=n;a.set(m,0,0,0);a.set(p,0,0,0);let B=n=0;const x=w?w.length-1:y.length/u-1;q=x+(q?2:0);for(let A=0;A<q;A+=2){var C=A<x?A:x,z=A<x?A+1:0;C=(w?w[C]:C)*u+v;z=(w?w[z]:z)*u+v;e[0]=y[C+0];e[1]=y[C+1];e[2]=y[C+2];f[0]=y[z+0];f[1]=y[z+1];f[2]=y[z+2];a.scale(e,a.add(e,e,f),.5);z=a.dist(e,f);0<z?(a.add(m,m,a.scale(e,e,z)),n+=z):(a.add(p,p,e),B++)}return 0!==n?(a.scale(m,m,1/n),!0):0!==B?(a.scale(m,p,1/B),!0):!1};b.computeAttachmentOriginPoints=
function(n,w,q){if(!n||!w)return!1;const {strideIdx:m,offsetIdx:u,data:v}=n;a.set(q,0,0,0);n=-1;let y=0;for(let B=0;B<w.length;B++){const x=w[B]*m+u;n!==x&&(q[0]+=v[x+0],q[1]+=v[x+1],q[2]+=v[x+2],y++);n=x}1<y&&a.scale(q,q,1/y);return 0<y};b.computeAttachmentOriginTriangles=function(n,w,q){if(!n)return!1;const {strideIdx:m,offsetIdx:u,data:v}=n;a.set(q,0,0,0);a.set(p,0,0,0);let y=n=0;for(let x=0;x<w.length-2;x+=3){var B=w[x+0]*m+u;const C=w[x+1]*m+u,z=w[x+2]*m+u;a.set(e,v[B+0],v[B+1],v[B+2]);a.set(f,
v[C+0],v[C+1],v[C+2]);a.set(g,v[z+0],v[z+1],v[z+2]);(B=r.areaPoints3d(e,f,g))?(a.add(e,e,f),a.add(e,e,g),a.scale(e,e,1/3*B),a.add(q,q,e),n+=B):(a.add(p,p,e),a.add(p,p,f),a.add(p,p,g),y+=3)}return 0===y&&0===n?!1:0!==n?(a.scale(q,q,1/n),!0):0!==y?(a.scale(q,p,1/y),!0):!1};b.generateDefaultIndexArray=function(n){if(1===n)return d;if(n>l||null==h){for(;n>l;)l*=2;h=new Uint32Array(l);for(let w=0;w<l;w++)h[w]=w}return new Uint32Array(h.buffer,0,n)};b.getNewId=function(){return c++};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/webgl/BufferObject":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/typedArrayUtil"],function(b,k){let a=0;return function(){function r(h,d,c,e,f){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this.id=a++;h.instanceCounter.increment(1,this);this._context=h;this._bufferType=d;this._usage=c;this._glName=this._context.gl.createBuffer();e&&this.setData(e,f)}r.createIndex=function(h,
d,c,e){return new r(h,34963,d,c,e)};r.createVertex=function(h,d,c){return new r(h,34962,d,c)};var l=r.prototype;l.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(1,this),this._context=null)};l.setData=function(h,d){if(h){if("number"===typeof h){if(0>h&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&d)switch(this._indexType=d,this._size=h,d){case 5123:h*=2;break;case 5125:h*=
4}}else d=h.byteLength,k.isUint16Array(h)&&(d/=2,this._indexType=5123),k.isUint32Array(h)&&(d/=4,this._indexType=5125),this._size=d;d=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,h,this._usage);this._context.bindVAO(d)}};l.setSubData=function(h,d=0,c=0,e){if(h){(0>d||d>=this._size)&&console.error("offset is out of range!");var f=d,g=c,p=e,n=h.byteLength;k.isUint16Array(h)&&(n/=2,f*=2,g*=2,p*=2);k.isUint32Array(h)&&
(n/=4,f*=4,g*=4,p*=4);void 0===e&&(e=n-1);c>=e&&console.error("end must be bigger than start!");d+c-e>this._size&&console.error("An attempt to write beyond the end of the buffer!");d=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);c=this._context.gl;h=ArrayBuffer.isView(h)?h.buffer:h;c.bufferSubData(this._bufferType,f,h.slice(g,p));this._context.bindVAO(d)}};b._createClass(r,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},
{key:"usage",get:function(){return this._usage}},{key:"bufferType",get:function(){return this._bufferType}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size}}]);return r}()})},"esri/views/webgl/Texture":function(){define(["../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/mathUtils"],function(b,k,a){let r=0;return function(){function l(d,c,e=null){this._glName=
this._context=null;this.id=r++;this._descriptor=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;d.instanceCounter.increment(0,this);this._context=d;this._descriptor={target:3553,samplingMode:9729,wrapMode:10497,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,...c};this.setData(e)}var h=l.prototype;h.dispose=function(){if(this._context&&this._context.gl){if(this._glName){const d=this._context.gl;this._boundToUnits.forEach(c=>{this._context.bindTexture(null,
c)});d.deleteTexture(this._glName);this._glName=null}this._context.instanceCounter.decrement(0,this);this._context=null}};h.release=function(){this.dispose()};h.resize=function(d,c){const e=this._descriptor;if(e.width!==d||e.height!==c)e.width=d,e.height=c,this.setData(null)};h.setData=function(d){if(this._context&&this._context.gl){var c=this._context.gl;this._glName||(this._glName=c.createTexture());void 0===d&&(d=null);null===d&&(this._descriptor.width=this._descriptor.width||4,this._descriptor.height=
this._descriptor.height||4);var e=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var f=this._descriptor;l._validateTexture(f);c.pixelStorei(c.UNPACK_ALIGNMENT,f.unpackAlignment);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,f.flipped?1:0);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f.preMultiplyAlpha?1:0);var g=f.pixelFormat,p=f.internalFormat?f.internalFormat:g;if(d instanceof ImageData||d instanceof HTMLImageElement||d instanceof HTMLCanvasElement||d instanceof HTMLVideoElement){var n=
d.width,w=d.height;d instanceof HTMLVideoElement&&(n=d.videoWidth,w=d.videoHeight);f.width&&f.height&&console.assert(n===f.width&&w===f.height);c.texImage2D(c.TEXTURE_2D,0,p,g,f.dataType,d);f.hasMipmap&&this.generateMipmap();void 0===f.width&&(f.width=n);void 0===f.height&&(f.height=w)}else{null!=f.width&&null!=f.height||console.error("Width and height must be specified!");c.DEPTH24_STENCIL8&&p===c.DEPTH_STENCIL&&(p=c.DEPTH24_STENCIL8);n=f.width;w=f.height;var q=d;if(k.isSome(q)&&"type"in q&&"compressed"===
q.type)for(g=Math.round(Math.log(Math.max(n,w))/Math.LN2)+1,f.hasMipmap=f.hasMipmap&&g===d.levels.length,g=0;;++g){c.compressedTexImage2D(c.TEXTURE_2D,g,p,n,w,0,d.levels[Math.min(g,d.levels.length-1)]);if(1===n&&1===w||!f.hasMipmap)break;n=Math.max(1,n>>1);w=Math.max(1,w>>1)}else if(k.isSome(d))c.texImage2D(c.TEXTURE_2D,0,p,n,w,0,g,f.dataType,d),f.hasMipmap&&this.generateMipmap();else for(d=0;;++d){c.texImage2D(c.TEXTURE_2D,d,p,n,w,0,g,f.dataType,null);if(1===n&&1===w||!f.hasMipmap)break;n=Math.max(1,
n>>1);w=Math.max(1,w>>1)}}l._applySamplingMode(c,this._descriptor);l._applyWrapMode(c,this._descriptor);l._applyAnisotropicFilteringParameters(this._context,this._descriptor);this._context.bindTexture(e,0)}};h.updateData=function(d,c,e,f,g,p){p||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const n=this._context.gl,w=this._descriptor,q=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>c||0>e||f>
w.width||g>w.height||c+f>w.width||e+g>w.height)&&console.error("An attempt to update out of bounds of the texture!");n.pixelStorei(n.UNPACK_ALIGNMENT,w.unpackAlignment);n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,w.flipped?1:0);n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,w.preMultiplyAlpha?1:0);p instanceof ImageData||p instanceof HTMLImageElement||p instanceof HTMLCanvasElement||p instanceof HTMLVideoElement?n.texSubImage2D(n.TEXTURE_2D,d,c,e,w.pixelFormat,w.dataType,p):n.texSubImage2D(n.TEXTURE_2D,d,
c,e,f,g,w.pixelFormat,w.dataType,p);this._context.bindTexture(q,0)};h.generateMipmap=function(){var d=this._descriptor;d.hasMipmap||(this._samplingModeDirty=d.hasMipmap=!0,l._validateTexture(d));9729===d.samplingMode?(this._samplingModeDirty=!0,d.samplingMode=9985):9728===d.samplingMode&&(this._samplingModeDirty=!0,d.samplingMode=9984);d=this._context.getBoundTexture(0);this._context.bindTexture(this,0);const c=this._context.gl;c.generateMipmap(c.TEXTURE_2D);this._context.bindTexture(d,0)};h.setSamplingMode=
function(d){d!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=d,l._validateTexture(this._descriptor),this._samplingModeDirty=!0)};h.setWrapMode=function(d){d!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=d,l._validateTexture(this._descriptor),this._wrapModeDirty=!0)};h.applyChanges=function(){const d=this._context.gl,c=this._descriptor;this._samplingModeDirty&&(l._applySamplingMode(d,c),this._samplingModeDirty=!1);this._wrapModeDirty&&(l._applyWrapMode(d,c),this._wrapModeDirty=
!1)};h.setBoundToUnit=function(d,c){c?this._boundToUnits.add(d):this._boundToUnits.delete(d)};l._validateTexture=function(d){(0>d.width||0>d.height)&&console.error("Negative dimension parameters are not allowed!");a.isPowerOfTwo(d.width)&&a.isPowerOfTwo(d.height)||("number"===typeof d.wrapMode?33071!==d.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(33071!==d.wrapMode.s||33071!==d.wrapMode.t)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),
d.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};l._applySamplingMode=function(d,c){let e=c.samplingMode,f=c.samplingMode;if(9985===e||9987===e)e=9729,c.hasMipmap||(f=9729);else if(9984===e||9986===e)e=9728,c.hasMipmap||(f=9728);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,e);d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,f)};l._applyWrapMode=function(d,c){"number"===typeof c.wrapMode?(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,c.wrapMode),d.texParameteri(d.TEXTURE_2D,
d.TEXTURE_WRAP_T,c.wrapMode)):(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,c.wrapMode.s),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,c.wrapMode.t))};l._applyAnisotropicFilteringParameters=function(d,c){if(null!=c.maxAnisotropy){var e=d.capabilities.textureFilterAnisotropic;e&&(d=d.gl,d.texParameterf(d.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY,c.maxAnisotropy))}};b._createClass(l,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}}]);return l}()})},
"esri/views/webgl/Util":function(){define(["exports","../../core/has","../../core/maybe"],function(b,k,a){function r(c){return c[0].stride}function l(c){switch(c){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}function h(c){switch(c){case 6406:case 6409:return 1;case 6410:return 2;case 6407:return 3;case 6408:return 4;case 34041:return 4;case 33325:return 2;case 33326:return 4;
case 35898:return 4;case 33327:return 4;case 33328:return 8;case 34842:return 8;case 34836:return 16;case 33189:return 2;case 34041:return 4;case 32854:return 2;case 36168:return 1}return 0}function d(c){if(a.isNone(c))return 0;if("colorAttachment"in c)return c.glName?d(c.colorAttachment)+d(c.depthStencilAttachment):0;if("descriptor"in c)return c.glName?d(c.descriptor):0;const e=c.internalFormat||"pixelFormat"in c&&c.pixelFormat;if(!e)return 0;const f="hasMipmap"in c&&c.hasMipmap?1.3:1;c=c.width*
c.height;return h(e)*c*f}b.addDescriptor=function(c,e,f,g,p,n){const w=l(g);if(0<c.length){const q=c[0].stride,m=q+w*f;c.forEach(u=>u.stride=m);c.push({name:e,count:f,type:g,offset:q,stride:m,normalized:p,divisor:n})}else c.push({name:e,count:f,type:g,offset:0,stride:w*f,normalized:p,divisor:n})};b.bindVertexBufferLayout=function(c,e,f,g,p){const n=c.gl,w=c.capabilities.instancing;c.bindBuffer(f);for(const q of g)if(c=e[q.name],f=(p?p:0+q.baseInstance?q.baseInstance:0)*q.stride,void 0===c&&console.error(`There is no location for vertex attribute '${q.name}' defined.`),
q.baseInstance&&!q.divisor&&console.error(`Vertex attribute '${q.name}' uses baseInstanceOffset without divisor.`),4>=q.count)n.vertexAttribPointer(c,q.count,q.type,q.normalized,q.stride,q.offset+f),n.enableVertexAttribArray(c),q.divisor&&0<q.divisor&&w&&w.vertexAttribDivisor(c,q.divisor);else if(9===q.count)for(g=0;3>g;g++)n.vertexAttribPointer(c+g,3,q.type,q.normalized,q.stride,q.offset+12*g+f),n.enableVertexAttribArray(c+g),q.divisor&&0<q.divisor&&w&&w.vertexAttribDivisor(c+g,q.divisor);else if(16===
q.count)for(g=0;4>g;g++)n.vertexAttribPointer(c+g,4,q.type,q.normalized,q.stride,q.offset+16*g+f),n.enableVertexAttribArray(c+g),q.divisor&&0<q.divisor&&w&&w.vertexAttribDivisor(c+g,q.divisor);else console.error("Unsupported vertex attribute element count: "+q.count)};b.copyFramebufferToTexture=function(c,e,f,g,p=0){const n=c.getBoundFramebufferObject(),w=c.getBoundTexture(0);c.bindFramebuffer(e);c.bindTexture(f,0);c.gl.copyTexImage2D(c.gl.TEXTURE_2D,p,f.descriptor.pixelFormat,g[0],g[1],g[2],g[3],
0);c.gl.flush();c.bindFramebuffer(n);c.bindTexture(w,0)};b.findAttribute=function(c,e){for(let f=0;f<c.length;f++)if(c[f].name===e)return c[f];return null};b.getBytesPerElement=l;b.getBytesPerElementFormat=h;b.getGpuMemoryUsage=d;b.getStride=r;b.getTypedArrayConstructor=function(c){switch(c){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array;default:throw Error("Unknown data type");
}};b.hasAttribute=function(c,e){for(let f=0;f<c.length;f++)if(c[f].name===e)return!0;return!1};b.setBaseInstanceOffset=function(c,e){const f={};for(const g in c)f[g]=c[g].map(p=>p.divisor?{...p,baseInstance:e}:p);return f};b.unbindVertexBufferLayout=function(c,e,f,g){const p=c.gl,n=c.capabilities.instancing;c.bindBuffer(f);for(const w of g)if(f=e[w.name],4>=w.count)p.disableVertexAttribArray(f),w.divisor&&0<w.divisor&&n&&n.vertexAttribDivisor(f,0);else if(9===w.count)for(g=0;3>g;g++)p.disableVertexAttribArray(f+
g),w.divisor&&0<w.divisor&&n&&n.vertexAttribDivisor(f+g,0);else if(16===w.count)for(g=0;4>g;g++)p.disableVertexAttribArray(f+g),w.divisor&&0<w.divisor&&n&&n.vertexAttribDivisor(f+g,0);else console.error("Unsupported vertex attribute element count: "+w.count);c.unbindBuffer(34962)};b.vertexCount=function(c,e){return c.vertexBuffers[e].size/r(c.layout[e])};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/VertexArrayObject":function(){define(["../../chunks/_rollupPluginBabelHelpers",
"./Util"],function(b,k){let a=0;return function(){function r(h,d,c,e,f){this._context=h;this._locations=d;this._layout=c;this._buffers=e;this._indexBuffer=f;this._glName=null;this.id=a++;this._initialized=!1;h.instanceCounter.increment(2,this)}var l=r.prototype;l.dispose=function(h=!0){if(this._context){var d=this._context.capabilities.vao;d&&this._glName&&(d.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(h){for(const c in this._buffers)this._buffers[c].dispose(),
delete this._buffers[c];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context.instanceCounter.decrement(2,this);this._context=null}};l.initialize=function(){if(!this._initialized){var h=this._context.capabilities.vao;if(h){const d=h.createVertexArray();h.bindVertexArray(d);this._bindLayout();h.bindVertexArray(null);this._glName=d}this._initialized=!0}};l.bind=function(){this.initialize();const h=this._context.capabilities.vao;h?h.bindVertexArray(this.glName):(this._context.bindVAO(null),
this._bindLayout())};l._bindLayout=function(){const h=this._buffers,d=!!this._context.capabilities.vao,c=this._layout,e=this._indexBuffer;h||console.error("Vertex buffer dictionary is empty!");const f=this._context.gl;for(const g in h){const p=h[g];p||console.error("Vertex buffer is uninitialized!");const n=c[g];n||console.error("Vertex element descriptor is empty!");k.bindVertexBufferLayout(this._context,this._locations,p,n)}e&&(d?f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,e.glName):this._context.bindBuffer(e))};
l.unbind=function(){this.initialize();const h=this._context.capabilities.vao;h?h.bindVertexArray(null):this._unbindLayout()};l._unbindLayout=function(){var h=this._buffers;const d=this._layout;h||console.error("Vertex buffer dictionary is empty!");for(const c in h){const e=h[c];e||console.error("Vertex buffer is uninitialized!");k.unbindVertexBufferLayout(this._context,this._locations,e,d[c])}(h=this._indexBuffer)&&this._context.unbindBuffer(h.bufferType)};b._createClass(r,[{key:"glName",get:function(){return this._glName}},
{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce((h,d)=>h+this._buffers[d].size,this._indexBuffer?this._indexBuffer.size:0)}},{key:"layout",get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}}]);return r}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("exports ../../../core/promiseUtils ../../../geometry/support/Ellipsoid ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/Handles ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2f64 ../../../chunks/vec4f64 ../../../chunks/vec2 ../../../chunks/vec4 ../webgl-engine/lib/DefaultVertexAttributeLocations ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../../webgl/BufferObject ../../webgl/VertexArrayObject ./atmosphereUtils ./RealisticAtmosphereTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){let x=function(){function G(I,J){this._view=I;this.canRender=!0;this._skyslot=14;this._hazeSlot=15;this._renderData={texDepth:f.create(),cameraPosition:r.create(),projectionInverse:e.create(),viewInverse:e.create(),heightParameters:g.create(),atmosphereParameters1:g.create(),atmosphereParameters2:g.create(),atmosphereParameters3:r.create(),invWavelength:A,invWavelengthScaled:t,radii:f.create(),scale:0,scaleDepth:.25,lowerAlphaBlendBound:0,scaleOverScaleDepth:0,
oneOverScaleDepth:0,scaleDepthBlue:.05,oneOverScaleDepthBlue:20,scaleOverScaleDepthBlue:0,g:-.99999,g2:-.99999*-.99999,miePhaseCoefficients:D,nearFar:f.create(),cameraHeight:0,cameraHeightSq:0,C:0,CSur:0,innerFadeDistance:0,altitudeFade:0};this._lowerElevationBoundRadius=0;this._lowerBoundEarthRadius=a.earth.radius;this._updateRadius(a.earth.radius);this._techniqueRepository=J;this._atmosphereTechniqueConfig=new B.RealisticAtmosphereTechniqueConfiguration}var H=G.prototype;H.destroy=function(){this._handles&&
(this._handles.destroy(),this._handles=null);this._vao&&(this._vao.dispose(),this._vao=null)};H.when=function(){return k.resolve()};H.initializeRenderContext=function(I){I=I.rctx;this._handles=new h;this._updateElevation({spatialReference:this._view.basemapTerrain.spatialReference,tile:this._view.basemapTerrain.rootTiles[0],extent:this._view.basemapTerrain.rootTiles[0].extent,context:"ground"});this._handles.add(d.on(this._view,"basemapTerrain","elevation-change",J=>this._updateElevation(J),()=>this._updateElevation()));
this._handles.add(d.on(this._view,"basemapTerrain","elevation-bounds-change",()=>this._updateVisibleElevationBounds(),()=>this._updateVisibleElevationBounds()));this._atmosphereTechniqueConfig.haze=!1;this._atmosphereTechnique=this._techniqueRepository.acquireAndReleaseExisting(B.RealisticAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereTechnique);this._atmosphereTechniqueConfig.haze=!0;this._atmosphereHazeTechnique=this._techniqueRepository.acquireAndReleaseExisting(B.RealisticAtmosphereTechnique,
this._atmosphereTechniqueConfig,this._atmosphereHazeTechnique);this._vao=this._createVertexArrayObject(I)};H.uninitializeRenderContext=function(){this.destroy()};H.render=function(I){if(I.slot!==this._hazeSlot&&I.slot!==this._skyslot||0!==I.pass)return!1;this._update(I.camera);I.slot===this._skyslot&&this._renderSky(I);I.slot===this._hazeSlot&&this._renderHaze(I);return!0};H._renderSky=function(I){const J=I.rctx,K=this._atmosphereTechnique.program;J.bindProgram(K);this._atmosphereTechnique.bindPipelineState(J);
K.setUniform3fv("atmosphereParameters3",this._renderData.atmosphereParameters3);this._renderCommon(K,I)};H._renderHaze=function(I){const J=I.rctx,K=I.offscreenRenderingHelper,L=this._atmosphereHazeTechnique.program;J.bindProgram(L);this._atmosphereHazeTechnique.bindPipelineState(J);K.renderDepthDetached(()=>{J.bindTexture(K.depthTexture,0);L.setUniform1i("depthTex",0);this._renderCommon(L,I)})};H._renderCommon=function(I,J){const K=J.rctx;I.setUniform3fv("invWavelength",this._renderData.invWavelength);
I.setUniform3fv("invWavelengthScaled",this._renderData.invWavelengthScaled);J.scenelightingData.setLightDirectionUniform(I);I.setUniform4fv("heightParameters",this._renderData.heightParameters);I.setUniform3fv("cameraPosition",this._renderData.cameraPosition);I.setUniformMatrix4fv("projectionInverse",this._renderData.projectionInverse);I.setUniformMatrix4fv("viewInverse",this._renderData.viewInverse);I.setUniform2fv("nearFar",this._renderData.nearFar);I.setUniform2fv("radii",this._renderData.radii);
I.setUniform4fv("atmosphereParameters1",this._renderData.atmosphereParameters1);I.setUniform4fv("atmosphereParameters2",this._renderData.atmosphereParameters2);I.setUniform1f("innerFadeDistance",this._renderData.innerFadeDistance);I.setUniform1f("altitudeFade",this._renderData.altitudeFade);K.bindVAO(this._vao);I.assertCompatibleVertexAttributeLocations(this._vao);K.drawArrays(5,0,4)};H._createVertexArrayObject=function(I){const J=E.createBuffer(4);J.position.setVec(0,[-1,-1]);J.position.setVec(1,
[1,-1]);J.position.setVec(2,[-1,1]);J.position.setVec(3,[1,1]);J.uv0.setVec(0,[0,0]);J.uv0.setVec(1,[1,0]);J.uv0.setVec(2,[0,1]);J.uv0.setVec(3,[1,1]);return new v(I,w.Default3D,{geometry:q.glLayout(E)},{geometry:u.createVertex(I,35044,J.buffer)})};H._adjustRadiusForTesselation=function(I){return I*Math.cos(Math.PI/Math.pow(2,4)/16)};H._updateElevation=function(I){I=I?I.tile:this._view.basemapTerrain.rootTiles[0];0===I.lij[0]&&(I=this._adjustRadiusForTesselation(a.earth.radius+I.elevationBounds[0]),
I!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=I,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds()))};H._updateVisibleElevationBounds=function(){const I=this._adjustRadiusForTesselation(a.earth.radius+this._view.basemapTerrain.elevationBounds.min);(0>this._lowerBoundEarthRadius||I<this._lowerBoundEarthRadius)&&this._updateRadius(I)};H._updateRadius=function(I){this._lowerBoundEarthRadius=I;var J=I/10*10.25;const K=1/(J-I),L=K/.25,S=K/.05,M=.3*(J-I)+I,T=this._renderData;
n.set(T.atmosphereParameters1,K,.25,L,4);n.set(T.atmosphereParameters2,-.99999,.05,S,20);l.set(T.atmosphereParameters3,-.99999*-.99999,D,M);p.set(T.radii,I,J);T.scale=K;T.lowerAlphaBlendBound=M;T.scaleOverScaleDepth=L;T.scaleOverScaleDepthBlue=S;J=y.INNER_ATMOSPHERE_DEPTH;T.innerFadeDistance=2*Math.sqrt((2*I-J)*J)};H._update=function(I){I&&(this._renderData.cameraHeight=l.length(I.eye),this._renderData.cameraHeightSq=this._renderData.cameraHeight*this._renderData.cameraHeight,this._renderData.C=this._renderData.cameraHeightSq-
this._renderData.radii[1]*this._renderData.radii[1],this._renderData.CSur=this._renderData.cameraHeightSq-this._renderData.radii[0]*this._renderData.radii[0],this._renderData.heightParameters=g.fromValues(this._renderData.cameraHeight,this._renderData.cameraHeightSq,this._renderData.C,this._renderData.CSur),l.copy(this._renderData.cameraPosition,I.eye),c.invert(this._renderData.projectionInverse,I.projectionMatrix),c.invert(this._renderData.viewInverse,I.viewMatrix),p.set(this._renderData.nearFar,
I.near,I.far),this._renderData.altitudeFade=y.computeInnerAltitudeFade(this._renderData.cameraHeight-this._lowerBoundEarthRadius))};G.isSupported=function(I){return I.rctx.capabilities.depthTexture};return G}();const C=.02*Math.PI,z=.004*Math.PI,A=r.fromValues(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),t=r.clone(A);l.scale(t,t,C);l.add(t,t,r.fromValues(z,z,z));const D=(1- -.99999*-.99999)/(2+-.99999*-.99999)*1.5,E=m.newLayout().vec2f("position").vec2f("uv0");b.RealisticAtmosphere=x;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports"],function(b){b.INNER_ATMOSPHERE_DEPTH=1E4;b.computeInnerAltitudeFade=function(k){return Math.min(1,Math.max(0,(k-1E5)/9E5))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/environment/RealisticAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState ../../../chunks/RealisticAtmosphere.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){h=function(p){function n(){return p.apply(this,arguments)||this}a._inheritsLoose(n,p);var w=n.prototype;w.initializeProgram=function(q){const m=n.shader.get().build({haze:this.configuration.haze});return new e(q.rctx,m.generateSource("vertex"),m.generateSource("fragment"),c.Default3D)};w.initializePipeline=function(){return this.configuration.haze?f.makePipelineState({blending:f.separateBlendingParams(1,0,769,1),colorWrite:f.defaultColorWriteParams}):f.makePipelineState({blending:f.separateBlendingParams(770,
1,771,771),depthTest:{func:515},colorWrite:f.defaultColorWriteParams})};return n}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(g.RealisticAtmosphereShader,()=>new Promise(function(p,n){b(["./RealisticAtmosphere.glsl"],p,n)}));l=function(p){function n(){var w=p.apply(this,arguments)||this;w.haze=!1;return w}a._inheritsLoose(n,p);return n}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter()],l.prototype,"haze",void 0);k.RealisticAtmosphereTechnique=h;k.RealisticAtmosphereTechniqueConfiguration=
l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/RealisticAtmosphere.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl"],function(b,k,a,r){function l(d){const c=new a.ShaderBuilder;c.attributes.add("position","vec2");c.attributes.add("uv0","vec2");c.varyings.add("worldRay","vec3");c.varyings.add("vtc","vec2");
d.haze&&c.varyings.add("eyeDir","vec3");c.vertex.uniforms.add("projectionInverse","mat4");c.vertex.uniforms.add("viewInverse","mat4");c.vertex.code.add(k.glsl`
    void main(void) {
      vec3 posViewNear = (projectionInverse * vec4(position, -1, 1)).xyz;

      worldRay = (viewInverse * vec4(posViewNear, 0)).xyz;
      vtc = uv0;

      ${d.haze?k.glsl`eyeDir = posViewNear;`:""}

      gl_Position = vec4(position, 1, 1);
    }
  `);c.fragment.uniforms.add("lightingMainDirection","vec3").add("invWavelength","vec3").add("invWavelengthScaled","vec3").add("radii","vec2").add("atmosphereParameters1","vec4").add("atmosphereParameters2","vec4").add("cameraPosition","vec3").add("nearFar","vec2").add("heightParameters","vec4");d.haze?c.fragment.uniforms.add("depthTex","sampler2D"):c.fragment.uniforms.add("atmosphereParameters3","vec3").add("innerFadeDistance","float").add("altitudeFade","float");c.fragment.include(r.ColorConversion);
c.fragment.code.add(k.glsl`
  // Atmosphere
  const float krESun = 0.075;        // Kr * ESun = 0.005 * 15.0
  const float kmESun = 0.015;        // Km * ESun = 0.005 * 15

  // The inner (planetary) radius
  #define innerRadius radii[0]
  // The outer (atmosphere) radius
  #define outerRadius radii[1]

  // Atmosphere parameters:

  // shellScale:               1.0 / (outerRadius - innerRadius)
  #define shellScale atmosphereParameters1.x

  // shellDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)
  // scaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)
  #define shellDepth vec2(atmosphereParameters1.y, atmosphereParameters2.y)

  // scaleOverScaleDepth:      scale / shellDepth
  // scaleOverScaleDepthBlue:  scale / scaleDepthBlue
  #define scaleOverScaleDepth vec2(atmosphereParameters1.z, atmosphereParameters2.z)

  // oneOverScaleDepth:        1.0 / shellDepth
  // oneOverScaleDepthBlue;    1.0 / scaleDepthBlue
  #define oneOverScaleDepth vec2(atmosphereParameters1.w, atmosphereParameters2.w)
  `);d.haze||c.fragment.code.add(k.glsl`
      #define g atmosphereParameters2.x
      #define gSq atmosphereParameters3.x
      #define miePhaseCoefficients atmosphereParameters3.y
      #define lowerAlphaBlendBound atmosphereParameters3.z
    `);c.fragment.code.add(k.glsl`
  // The camera's current height
  #define cameraHeight heightParameters[0]
  // cameraHeight^2
  #define cameraHeightSq heightParameters[1]
  // cameraHeightSq - outerRadiusSq; // C = ||o-c||^2 - r^2
  #define C heightParameters[2]
  // cameraHeightSq - (innerRadiusSq - 63756370000.0); // C = ||o-c||^2 - r^2
  #define CSur heightParameters[3]

  ${d.haze?"// Camera HDR\n        const float exposure \x3d 1.5;\n        const vec3 oneOverGamma \x3d vec3(1.0); //Gamma \x3d 1.0":"const float exposure \x3d 2.0;\n        const vec3 oneOverGamma \x3d vec3(0.454545); // Gamma \x3d 2.2\n        vec3 reinhardTM(vec3 inputColor, float _exposure) {\n          vec3 intermediate \x3d inputColor * _exposure;\n          intermediate /\x3d ( 1.0 + intermediate );\n          return pow(intermediate, oneOverGamma);\n        }\n        "}
    // Loop constants for integral approximation
    const float samples = 5.0;
    const int maxSamples = 5;

    // ToneMapping operators
    vec3 expTM(vec3 inputColor,float _exposure) {
        return pow(1.0 - exp(inputColor * -_exposure), oneOverGamma);
    }

    // Approximation for inner integral based on a radii ratio of 10.25:10
    float scale(float _cos) {
      float x = 1.0 - _cos;
      return exp( -0.00287 + x * ( 0.459 + x * ( 3.83 + x * (-6.80 + x * 5.25 ))));
    }

    void main() {
      // Obtain ray from Camera
      vec3 worldSpaceRay = normalize(worldRay);

      // Compute Atmosphere intersection; i.e. ray/sphere intersection
      float B = 2.0 * dot(cameraPosition, worldSpaceRay); // B = 2(l * (o-c))
      float det = B * B - 4.0 * C; // det = B^2 - 4.0* C

      // idealized sphere intersection to discard early some pixels
      float detSur = B * B - 4.0 * CSur; // det = B^2 - 4.0* C

      // the minimal sample start position:
      // at the camera by default, on the earth radius surface if the camera is underground.
      float minRayStart = 0.0;
  `);d.haze||c.fragment.code.add(k.glsl`
      float surfaceBlend = 0.0;
      vec4 surfaceColor = vec4(0.0);
      if (detSur >= 0.0) {
        float nearSurface = max(0.0, 0.5 *(-B - sqrt(detSur)));
        float farSurface = max(0.0, 0.5 *(-B + sqrt(detSur)));

        if (nearSurface == 0.0) {
          minRayStart = farSurface;
        }

        // Compute lighting at the point where the ray enters the earth surface
        // Lighting computation is copied from the terrain shader.
        vec3 vPos = cameraPosition + worldSpaceRay * nearSurface;
        float lightAngle = dot(-lightingMainDirection, normalize(vPos));
        float brightness = max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)));

        // Make the surface transparent based on altitude
        surfaceColor = vec4(brightness, brightness, brightness, 1.0 - altitudeFade);

        // Fade based on the distance the ray travels below the earth surface
        float relDist = (farSurface - nearSurface) / innerFadeDistance;

        // early exit
        if (relDist > 1.0) {
          gl_FragColor = surfaceColor;
          return;
        }

        surfaceBlend = smoothstep(0.0, 1.0, relDist * relDist);
      }
    `);c.fragment.code.add(k.glsl`
    if (det >= 0.0) {
    ${d.haze?"\n          float depthSample \x3d texture2D(depthTex, vtc).r;\n\n          float zNear \x3d nearFar[0];\n          float zFar \x3d nearFar[1];\n\n          // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\n          float zNorm \x3d 2.0 * depthSample - 1.0;\n          float linDepth \x3d 2.0 * zNear * zFar /\n            (zFar + zNear - zNorm * (zFar - zNear));\n\n          float rayEnd;\n          float altitudeAlpha \x3d 1.0;\n\n          // find intersections with ground, but only between the near and far\n          // clipping planes.\n          if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\n            vec3 cameraSpaceRay \x3d normalize(eyeDir);\n            cameraSpaceRay /\x3d cameraSpaceRay.z;\n            cameraSpaceRay *\x3d linDepth;\n\n            float cameraSpaceRayLength \x3d length(cameraSpaceRay);\n\n            vec3 world \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\n            float worldRadiusSq \x3d dot(world, world);\n\n            // Handle tall structures:\n            // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\n            float transitionStart \x3d innerRadius + 20000.0;\n            float transitionHeight \x3d 25000.0;\n            float transitionEnd \x3d transitionStart + transitionHeight;\n\n            float edge0 \x3d transitionStart * transitionStart;\n            float edge1 \x3d transitionEnd * transitionEnd;\n\n            altitudeAlpha \x3d 1.0 - clamp((worldRadiusSq - edge0) / (edge1 - edge0), 0.0, 1.0);\n            rayEnd \x3d cameraSpaceRayLength;\n\n            if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\n              float nearSurface \x3d 0.5 * ( -B - sqrt(detSur) );\n              float interp \x3d clamp(((cameraHeight - innerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\n              rayEnd \x3d mix(cameraSpaceRayLength, nearSurface, interp);\n            }\n          }":
""}
    float rayStart = 0.5 *(-B - sqrt(det)); //near intersection with atmosphere
    ${d.haze?"float near \x3d abs(rayStart);\n        float far \x3d abs(rayEnd);":"float rayEnd \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere"}

    float scatterDistance; // calculate its scattering offset
    // Calculate the ray's starting position
    if (rayStart < minRayStart)
    { // ray starts from camera or inner radius sphere to far
      rayStart = minRayStart;
      ${d.haze?"":"// clamp to value at inner radius altitude\n          scatterDistance \x3d shellScale * min(0.0, innerRadius - cameraHeight);"}
    }
    ${d.haze?"":"else { // outside atmosphere\n          scatterDistance \x3d -1.0;\n        }"}
    // Initialize the scattering loop variables
    vec3 start = cameraPosition + worldSpaceRay * rayStart;
  `);d.haze&&c.fragment.code.add(k.glsl`
      vec3 end = cameraPosition + worldSpaceRay * rayEnd;

      float endLength = length(end);
      //altitudeStart, altitudeEnd
      vec2 altitudeInterval = vec2(length(start) - innerRadius, endLength - innerRadius);

      // for camera positions below altitude 0, invert the altitudes, to achieve
      // a similar haze as above ground. Note that there is a small but visible change
      // when the camera passes altitude 0.
      if (altitudeInterval.x < 0.0) {
        altitudeInterval = -altitudeInterval;
      }

      // computed for the original end point to get consistent light angles after possible inversions
      float lightAngle = dot(-lightingMainDirection, end) / endLength;

      if (near > far)
      {
        if (altitudeInterval.x < altitudeInterval.y)
        {
          // Switch positive slopes for flipped rays
          end = cameraPosition + worldSpaceRay * rayStart;
          start = cameraPosition + worldSpaceRay * rayEnd;
          worldSpaceRay *= -1.0;
          float tmp = altitudeInterval.x;
          altitudeInterval.x = altitudeInterval.y;
          altitudeInterval.y = tmp;
        }
        else if (altitudeInterval.x == altitudeInterval.y)
        { // create minuscule fake slope for integration if the slope is zero
          altitudeInterval.x += 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get
          // slope for the camera function
        }
      }

      // Calculate its scattering offset
      // Assumes camera constrains of WSV 3.8
      if (altitudeInterval.x > outerRadius - innerRadius)
      { // outside atmosphere
        scatterDistance = innerRadius - outerRadius;
      } else
      {
        scatterDistance = altitudeInterval.y - altitudeInterval.x;
      }
    `);c.fragment.code.add(k.glsl`
    vec2 opticalStartDepth = exp(scatterDistance * oneOverScaleDepth);

    float rayLength = rayEnd - rayStart;
    float sampleLength = rayLength / samples;
    float scaledLength = sampleLength * shellScale;
    vec3 sampleRay = worldSpaceRay * sampleLength;
    vec3 samplePoint = start + sampleRay * 0.5;
  `);d.haze?c.fragment.code.add(k.glsl`
      float cameraAngle = dot(-worldSpaceRay, end) / length(end);
      float scaleCameraAngle = scale(cameraAngle);
      vec2 cameraOffset = scaleCameraAngle * opticalStartDepth;

      float scaledValues = scale(lightAngle) + scaleCameraAngle;
      vec2 scaledValuesDepth = scaledValues * shellDepth;
    `):c.fragment.code.add(k.glsl`
      float cameraAngle = dot(worldSpaceRay, start / length(start));
      float angleMultiplier = cameraAngle > 0.0 ? cameraAngle : 0.0;

      float scaleCameraAngle = scale(cameraAngle);
      vec2 cameraOffset = scaleCameraAngle * opticalStartDepth * shellDepth;
    `);c.fragment.code.add(k.glsl`
    // Loop variables
    vec3 frontColor = vec3(0.0);
    vec3 frontColorBlue = vec3(0.0);
    vec3 attenuate = vec3(0.0);
    vec3 attenuateBlue = vec3(0.0);

    // Now loop through the sample rays
    for(int i=0; i<maxSamples; i++) {
      float height = length(samplePoint);
      float altitude = abs(height - innerRadius);

      vec2 depth = exp(-altitude * scaleOverScaleDepth);
  `);d.haze?c.fragment.code.add(k.glsl`
      vec2 scatter = depth * scaledValuesDepth - cameraOffset;
    `):c.fragment.code.add(k.glsl`
      float lightAngle = dot(-lightingMainDirection, samplePoint) / height;
      float cameraAngle = dot(worldSpaceRay, samplePoint) / height;
      float tmpScaledValues = scale(lightAngle) - scale(cameraAngle);
      vec2 scatter = cameraOffset + tmpScaledValues * depth * shellDepth;
    `);c.fragment.code.add(k.glsl`
      attenuate = exp(-scatter.x * invWavelengthScaled);
      attenuateBlue = exp(-scatter.y * invWavelengthScaled);

      frontColor += attenuate * depth.x;
      frontColorBlue += attenuateBlue * depth.y;

      samplePoint += sampleRay;
    }

    // Phase computation
    // clamp to avoid numerical instability at fCos == -1.0 (and close values) to display fake sun
    float LdotR = clamp(dot(-lightingMainDirection, -worldSpaceRay ),-0.9999999,1.0);
    float LdotRSq = LdotR * LdotR + 1.0;
  `);d.haze?c.fragment.code.add(k.glsl`
      // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader
      vec3 colorCoefficients = (scaledLength * 0.75 * LdotRSq) * (krESun * invWavelength + kmESun );

      // Scaled Length is only applied afterwards to save multiplications
      vec3 color = colorCoefficients * frontColor;
      vec3 colorBlue = colorCoefficients * frontColorBlue;
    `):c.fragment.code.add(k.glsl`
      vec3 rayleighCoefficients = (scaledLength * 0.75 * LdotRSq * krESun) * invWavelength;
      float mieCoefficients = scaledLength * kmESun * miePhaseCoefficients * LdotRSq / pow(1.0 + gSq - 2.0 * g * LdotR, 1.5);

      // Calculate the attenuation factor for the ground
      vec3 color = rayleighCoefficients * frontColor + mieCoefficients * frontColor;
      vec3 colorBlue = rayleighCoefficients * frontColorBlue + mieCoefficients * frontColorBlue;
    `);c.fragment.code.add(k.glsl`
    // HDR to LDR conversion
    vec3 ldrBlue = expTM(colorBlue, 2.0 * exposure);
    vec3 ldrRed = expTM(color, exposure);

    // mix reddish and blueish atmosphere
    vec3 LDR = mix(ldrBlue, ldrRed, 0.2);
  `);d.haze?c.fragment.code.add(k.glsl`
      LDR *= (1.0 - cameraAngle);
      vec3 hsv = rgb2hsv(LDR);
      hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0); // boost haze saturation by 50%
      LDR = hsv2rgb(hsv);
      vec3 finalColor = LDR;
      // when rendering we specify the blend functions such that
      // newDestColor = oldDestColor*(1.0-finalColor) + finalColor
    `):c.fragment.code.add(k.glsl`
      // reinhard tonemapper for looking upwards
      vec3 ldrReinhard = reinhardTM(color, exposure);
      LDR += angleMultiplier * ldrReinhard;

      // height dependent parameter to smooth out reddish atmosphere
      float side = (rayEnd + rayStart) * 0.5;
      float atmoHeight = sqrt(cameraHeightSq - side * side);
      float h2 = clamp(1.0 - ( atmoHeight - lowerAlphaBlendBound ) / ( outerRadius - lowerAlphaBlendBound ), 0.0, 1.0);

      vec3 finalColor = LDR * h2;
      vec3 hsv = rgb2hsv(finalColor);
      hsv.y = clamp(hsv.y * 1.5, 0.0, 1.0); // boost sky saturation by 50%
      finalColor = hsv2rgb(hsv);
    `);c.fragment.code.add(k.glsl`
    ${d.haze?"gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;":"float atmosStrength \x3d clamp((length(ldrRed) - 0.05) * 1.05, 0.0, 1.0);\n          gl_FragColor \x3d vec4(finalColor, atmosStrength * clamp(1.0 - ( atmoHeight - innerRadius ) / (outerRadius - innerRadius), 0.0, 1.0));\n          if (surfaceBlend \x3e 0.0) {\n            gl_FragColor \x3d mix(gl_FragColor, surfaceColor, surfaceBlend);\n          }"}
      } else { // Outside Atmosphere
        gl_FragColor = vec4(0.0);
      }
    }
  `);return c}var h=Object.freeze({__proto__:null,build:l});b.RealisticAtmosphereShader=h;b.build=l})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.ColorConversion=function(a){a.code.add(k.glsl`
    vec4 premultiplyAlpha(vec4 v) {
      return vec4(v.rgb * v.a, v.a);
    }

    // Note: the min in the last line has been added to fix an instability in chrome.
    // See https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/23911
    // With proper floating point handling, the value could never be >1.
    vec3 rgb2hsv(vec3 c) {
      vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
      vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
      vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);

      float d = q.x - min(q.w, q.y);
      float e = 1.0e-10;
      return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
    }

    vec3 hsv2rgb(vec3 c) {
      vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
      vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
      return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
    }

    float rgb2v(vec3 c) {
      return max(c.x, max(c.y, c.z));
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/promiseUtils ../../../geometry/support/spatialReferenceUtils ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../support/mathUtils ../../../geometry/projectionEllipsoid ../../../core/watchUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2f64 ../../../chunks/vec2 ../../../support/requestImageUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ./SimpleAtmosphereTechnique ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/Util ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject ./atmosphereUtils ./resources/MarsAtmosphereTexture ../webgl-engine/lib/glUtil3D".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G){function H(O,Q,F,N,P){const U=d.length(O),V=N*Math.sqrt(U*U-N*N)/U,W=P.silCircleV1,X=P.silCircleV2;d.scale(P.silCircleCenter,O,Math.sqrt(N*N-V*V)/U);d.cross(W,O,Q);1>d.squaredLength(W)&&d.cross(W,O,F);d.scale(W,W,V/d.length(W));d.cross(X,W,O);d.scale(X,X,V/d.length(X));return V}const I=k.getLogger("esri.views.3d.environment.SimpleAtmosphere"),J=-D.INNER_ATMOSPHERE_DEPTH,K=c.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,
.51171875],[5E4,.4140625]]);k=function(){function O(F,N){this.slot=14;this._renderData={texV:n.create(),silCircleCenter:h.create(),silCircleV1:h.create(),silCircleV2:h.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this._readyResolver=a.createResolver();this._readyController=a.createAbortController();this.texV1=1;this.isOnMars=r.isMars(F.spatialReference);const P=e.getReferenceEllipsoid(F.spatialReference);this.planetRadius=P.radius;this.outerRimWidth=P.outerAtmosphereRimWidth;
this.innerRimFactor=(this.planetRadius+J)/this.planetRadius;this.middleRimFactor=(this.planetRadius+0)/this.planetRadius;this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius;this.texV0=0/this.outerRimWidth;this.texVScale=this.texV1-this.texV0;this._techniqueRepository=N;this._atmosphereTechniqueConfig=new u.SimpleAtmosphereTechniqueConfiguration;this.view=F}var Q=O.prototype;Q.when=function(){return this._readyResolver.promise};Q.initializeRenderContext=function(F){const N=
F.rctx;this._cameraChangeHandle=f.init(this.view,"state.camera",()=>F.requestRender(),!0);this._atmosphereTechniqueConfig.geometry=0;this._atmosphereConeTechnique=this._techniqueRepository.acquireAndReleaseExisting(u.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereConeTechnique);this._atmosphereTechniqueConfig.geometry=2;this._atmosphereUndergroundTechnique=this._techniqueRepository.acquireAndReleaseExisting(u.SimpleAtmosphereTechnique,this._atmosphereTechniqueConfig,this._atmosphereUndergroundTechnique);
this._vao=this._createRibbon(N);this._vaoCount=A.vertexCount(this._vao,"geometry");this._fadeVao=G.createQuadVAO(N);this._fadeVaoCount=A.vertexCount(this._fadeVao,"geometry");q.requestImage(this.isOnMars?E:v,{signal:this._readyController.signal}).then(P=>{this._texture=new z(N,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},P);F.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(P=>{a.isAbortError(P)||I.error("Unable to initialize simple atmosphere: image request failed",
P);this._readyResolver.reject()})};Q.uninitializeRenderContext=function(){this.destroy()};Q.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&(this._texture.dispose(),this._texture=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null);this._vao&&(this._vao.dispose(),this._vao=null);this._readyController&&(this._readyController.abort(),this._readyController=null)};Q.render=function(F){if(F.slot!==
this.slot||0!==F.pass)return!1;this._update(F.camera);const N=F.rctx;this._atmosphereConeTechnique.bindPipelineState(N);if(1>this._renderData.undergroundFadeAlpha){var P=this._atmosphereConeTechnique.program;N.bindProgram(P);P.setUniformMatrix4fv("proj",F.camera.projectionMatrix);P.setUniformMatrix4fv("view",F.camera.viewMatrix);P.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);P.setUniform3fv("silCircleV1",this._renderData.silCircleV1);P.setUniform3fv("silCircleV2",this._renderData.silCircleV2);
P.setUniform2fv("texV",this._renderData.texV);N.bindTexture(this._texture,0);P.setUniform1i("tex",0);F.scenelightingData.setLightDirectionUniform(P);P.setUniform1f("altitudeFade",this._renderData.altitudeFade);P.setUniform1f("innerScale",this._renderData.innerScale);N.bindVAO(this._vao);N.drawArrays(4,0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(P=this._atmosphereUndergroundTechnique.program,N.bindProgram(P),P.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),
F.scenelightingData.setLightDirectionUniform(P),P.setUniform3fv("cameraPosition",F.camera.eye),N.bindVAO(this._fadeVao),N.drawArrays(5,0,this._fadeVaoCount));return!0};Q._update=function(F){var N=h.create();const P=this.planetRadius;var U=d.length(F.eye);const V=U-P;this._renderData.undergroundFadeAlpha=0>V?Math.min(-V/5E3,1):0;var W=P+J,X=P+Math.max(50,V);this._renderData.innerScale=X*X/(Math.sqrt(X*X-P*P)*Math.sqrt(X*X-W*W)+P*W)-1;this._renderData.altitudeFade=D.computeInnerAltitudeFade(V);d.scale(N,
F.eye,(P+50)/U);H(N,F.center,F.up,P,this._renderData);N=this._computeScreenRimWidth(F,N,F.up,this._renderData);U=K(V);W=this.texV0+.001953125*this.texVScale;X=this.texV0+N*U*this.texVScale;50<V&&(H(F.eye,F.center,F.up,P,this._renderData),F=this._computeScreenRimWidth(F,F.eye,F.up,this._renderData),F=l.clamp((F-1.5)/(N-1.5),0,1),W=this.texV0+.001953125*F*this.texVScale,X=this.texV0+l.lerp(this.texV1,N*U,F)*this.texVScale);w.set(this._renderData.texV,W,X)};Q._createRibbon=function(F){const N=new Float32Array(1155),
P=new Uint32Array(1920);N[0]=0;N[1]=0;N[2]=-1;for(var U=0;128>U;U++){var V=9*U+3;N[V+0]=U;N[V+1]=this.innerRimFactor;N[V+2]=-1;N[V+3]=U;N[V+4]=this.middleRimFactor;N[V+5]=0;N[V+6]=U;N[V+7]=this.outerRimFactor;N[V+8]=1;V=3*U+1;var W=127===U?1:V+3,X=15*U;P[X+0]=V;P[X+1]=V+1;P[X+2]=W+1;P[X+3]=W+1;P[X+4]=W;P[X+5]=V;P[X+6]=V+1;P[X+7]=V+2;P[X+8]=W+2;P[X+9]=W+2;P[X+10]=W+1;P[X+11]=V+1;P[X+12]=V;P[X+13]=W;P[X+14]=0}U=T.createBuffer(P.length);V=U.position;for(W=0;W<P.length;++W)X=3*P[W],V.set(W,0,N[X]),V.set(W,
1,N[X+1]),V.set(W,2,N[X+2]);return new t(F,m.Default3D,{geometry:y.glLayout(T)},{geometry:C.createVertex(F,35044,U.buffer)})};Q._computeScreenRimWidth=function(F,N,P,U){d.add(S,U.silCircleCenter,U.silCircleV2);d.scale(M,S,this.outerRimFactor);g.lookAt(L,N,S,P);x.project(S,L,F.projectionMatrix,F.viewport);x.project(M,L,F.projectionMatrix,F.viewport);return d.distance(S,M)/F.height};b._createClass(O,[{key:"canRender",get:function(){return null!=this._texture}}]);return O}();const L=p.create(),S=h.create(),
M=h.create(),T=B.newLayout().vec3f("position");return k})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ./DefaultVertexBufferLayouts".split(" "),function(b,k,a,r,l,h){b.createColorTexture=function(d,c,e=4){const f=new Uint8Array(e*e*4);for(let g=0;g<f.length;g+=4)f[g+0]=255*c[0],f[g+1]=255*c[1],f[g+2]=255*c[2],f[g+3]=255*c[3];return new r(d,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:e,height:e},
f)};b.createEmptyDepthTexture=function(d){return new r(d,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255]))};b.createEmptyTexture=function(d,c=4){return new r(d,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:c,height:c})};b.createQuadVAO=function(d,c=h.Pos2,e=k.Default3D,f=-1,g=1){let p=null;switch(c){case h.Pos2Tex:p=new Float32Array([f,f,0,0,g,f,1,0,f,g,0,1,g,g,1,1]);break;default:p=new Float32Array([f,f,g,f,f,
g,g,g])}return new l(d,e,{geometry:c},{geometry:a.createVertex(d,35044,p)})};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports"],function(b){b.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];b.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}];b.Pos3=[{name:"position",count:3,type:5126,offset:0,
stride:12,normalized:!1}];b.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];b.Pos3NormalTex=[{name:"position",count:3,type:5126,offset:0,stride:32,normalized:!1},{name:"normal",count:3,type:5126,offset:12,stride:32,normalized:!1},{name:"uv0",count:2,type:5126,offset:24,stride:32,normalized:!1}];b.Pos3Tex=[{name:"position",count:3,type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,
offset:12,stride:20,normalized:!1}];Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/Accessor ../../../assets ../../../chunks/mat4 ../../support/WatchUpdatingTracking ../../../chunks/mat4f64 ../webgl-engine/lib/DefaultVertexAttributeLocations ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../../webgl/BufferObject ../../webgl/VertexArrayObject ./StarsTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D){const E=h.getLogger("esri.views.3d.environment.Stars");b.Stars=function(L){function S(T){T=L.call(this,T)||this;T.slot=14;T._loadDataTask=null;T._resources=null;T._modelMatrix=B.create();T._updatingTracking=new y.WatchUpdatingTracking;T._requestRender=()=>{};return T}k._inheritsLoose(S,L);var M=S.prototype;M.initialize=function(){this._loadDataTask=this._createLoadDataTask()};M.destroy=function(){l.isSome(this._loadDataTask)&&(this._loadDataTask.abort(),
this._loadDataTask=null);this._updatingTracking.destroy();l.isSome(this._resources)&&(this._resources.vao.dispose(),this._resources.technique.dispose(),this._resources=null);this._requestRender=null};M.initializeRenderContext=function(T){this._requestRender=T.requestRender};M.uninitializeRenderContext=function(){this.destroy()};M.render=function(T){if(T.slot!==this.slot||0!==T.pass)return!1;this._ensureResources(T);if(l.isNone(this._resources))return!0;const {technique:O,vao:Q,num:F}=this._resources,
N=T.rctx,P=O.program;N.bindProgram(P);O.bindPass(N,{camera:T.camera,modelMatrix:this._modelMatrix});O.bindPipelineState(N);N.bindVAO(Q);P.assertCompatibleVertexAttributeLocations(Q);N.drawArrays(0,0,F);return!0};M._ensureResources=function(T){if(!l.isSome(this._resources)&&!l.isNone(K)){var O=new D.StarsTechnique({rctx:T.rctx,viewingMode:this.view.state.mode},null),Q=K.byteLength/9,F=new Float32Array(K,0,2*Q),N=new Uint8Array(K,8*Q,Q);this._resources={vao:this._createVertexArrayObject(T.rctx,F,N,
Q),technique:O,num:Q};this._updatingTracking.add(this.view,"environment.lighting.date",P=>this._update(P),2)}};M._computeDayDuration=function(T){const O=new Date(T.getFullYear(),0,1,11,58,56),Q=new Date(T.getFullYear()+1,0,1,11,58,55);return(+T-+O)/(+Q-+O)};M._update=function(T){if(T){var O=T.getHours()/12,Q=T.getMinutes()/60*(2/24),F=T.getSeconds()/60*(2/1440);O=(O+Q+F-.9972222)%2;T=2*this._computeDayDuration(T);Q=this._modelMatrix;v.copy(Q,I);v.rotateZ(Q,Q,-T*Math.PI);v.multiply(Q,H,Q);v.rotateZ(Q,
Q,-O*Math.PI);this._requestRender()}};M._hexToRGB=function(T){return[parseInt(T.substring(0,2),16),parseInt(T.substring(2,4),16),parseInt(T.substring(4,6),16)]};M._unpackUint8Attributes=function(T){return 192<=T?[2.9,T-192]:160<=T?[2.5,T-160]:128<=T?[2,T-128]:96<=T?[1.5,T-96]:64<=T?[1,T-64]:32<=T?[.7,T-32]:[.4,T]};M._createVertexArrayObject=function(T,O,Q,F){const N=J.createBuffer(F),P=N.position,U=N.color,V=N.size;for(let ca=0;ca<F;ca++){var W=O[2*ca],X=O[2*ca+1];P.set(ca,0,-Math.cos(W)*Math.sin(X));
P.set(ca,1,-Math.sin(W)*Math.sin(X));P.set(ca,2,-Math.cos(X));W=this._unpackUint8Attributes(Q[ca]);X=this._hexToRGB(G[W[1]]);U.set(ca,0,255*X[0]);U.set(ca,1,255*X[1]);U.set(ca,2,255*X[2]);U.set(ca,3,255);V.set(ca,W[0])}return new t(T,x.Default3D,{geometry:C.glLayout(J)},{geometry:A.createVertex(T,35044,N.buffer)})};M._createLoadDataTask=function(){if(l.isSome(K))return null;const T=q.createTask(async O=>{({data:O}=await u.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",
signal:O}));this._verifyStarData(O);K=O});T.promise.catch(O=>{q.isAbortError(O)||E.error(O)}).then(()=>{this.destroyed||(this._requestRender(),this.notifyChange("updating"))});return T};M._verifyStarData=function(T){if(!T)throw new g("stars:no-data-received","Failed to create stars because star catalogue is missing");T=T.byteLength/9;if(0!==T%1||5E4<T||5E3>T)throw new g("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};k._createClass(S,[{key:"updating",get:function(){return this._updatingTracking.updating||
this.loading}},{key:"loading",get:function(){return l.isSome(this._loadDataTask)&&!this._loadDataTask.finished}},{key:"canRender",get:function(){return!this.loading}}]);return S}(m);a.__decorate([c.property({constructOnly:!0})],b.Stars.prototype,"view",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["_updatingTracking.updating"]})],b.Stars.prototype,"updating",null);a.__decorate([c.property()],b.Stars.prototype,"_loadDataTask",void 0);a.__decorate([c.property()],b.Stars.prototype,"_updatingTracking",
void 0);b.Stars=a.__decorate([f.subclass("esri.views.3d.environment.Stars")],b.Stars);const G="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),H=B.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),I=B.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,
0,0,0,0,1),J=z.newLayout().vec3f("position").vec4u8("color").f32("size");let K=null;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4 ../../../chunks/mat4f64 ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState ../../../chunks/Stars.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){d=function(n){function w(){return n.apply(this,arguments)||this}a._inheritsLoose(w,n);var q=w.prototype;q.initializeProgram=function(m){const u=w.shader.get().build();return new e(m.rctx,u.generateSource("vertex"),u.generateSource("fragment"),c.Default3D)};q.initializePipeline=function(){return f.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),depthTest:{func:515},colorWrite:f.defaultColorWriteParams})};q.bindPass=function(m,{camera:u,modelMatrix:v}){m=
this.makeInfiniteProjectionMatrix(u.projectionMatrix,u.near,p);r.multiply(m,m,u.viewMatrix);r.multiply(m,m,v);this.program.setUniformMatrix4fv("transform",m);this.program.setUniform4fv("viewport",u.fullViewport);this.program.setUniform1f("pixelRatio",u.pixelRatio)};q.makeInfiniteProjectionMatrix=function(m,u,v){r.copy(v,m);v[10]=2.4E-7-1;v[11]=-1;v[14]=(2.4E-7-2)*u;return v};return w}(d.ShaderTechnique);d.shader=new h.ReloadableShaderModule(g.StarsShader,()=>new Promise(function(n,w){b(["./Stars.glsl"],
n,w)}));const p=l.create();k.StarsTechnique=d;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/Stars.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl"],function(b,k,a,r){function l(){const d=new a.ShaderBuilder;d.attributes.add("position","vec3");d.attributes.add("color","vec4");d.attributes.add("size","float");d.varyings.add("vcolor",
"vec4");d.varyings.add("vsize","float");d.vertex.uniforms.add("transform","mat4").add("viewport","vec4").add("pixelRatio","float");d.include(r.AlignPixel);d.vertex.code.add(k.glsl`
    void main(void) {
      vec4 posProj = transform * vec4(position, 0);
      gl_Position = alignToPixelCenter(posProj, viewport.zw);
      vcolor = color / 1.2;
      vsize = size * 5.0 * pixelRatio;
      gl_PointSize = vsize;
    }
  `);d.fragment.code.add(k.glsl`
    void main() {
      float cap = 0.7;
      float scale = 1.0 / cap;
      float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
      float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
      float intensity = alpha * alpha * alpha;
      if (vsize < 3.0) {
        intensity *= 0.5;
      }
      gl_FragColor = vec4(vcolor.xyz, intensity);
    }
  `);return d}var h=Object.freeze({__proto__:null,build:l});b.StarsShader=h;b.build=l})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.AlignPixel=function(a){const r=k.glsl`
    vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
      vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
      vec2 pixelSz = vec2(1.0) / widthHeight;
      vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
      return vec4(result, clipCoord.zw);
    }
  `,l=k.glsl`

    vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
      vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
      vec2 pixelSz = vec2(1.0) / widthHeight;
      vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
      vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
      return vec4(result, clipCoord.zw);
    }
  `;a.vertex.code.add(r);a.vertex.code.add(l);a.fragment.code.add(r);a.fragment.code.add(l)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../geometry/Point","../../../core/mathUtils","../../../geometry/projectionEllipsoid"],function(b,k,a,r){function l(c,e,f){return h(c,e.longitude,e.latitude,f.longitude,f.latitude)}function h(c,e,f,g,p){f=a.deg2rad(f);p=a.deg2rad(p);e=a.deg2rad(e);const n=a.deg2rad(g);g=Math.sin((f-p)/
2);e=Math.sin((e-n)/2);f=2*a.asinClamped(Math.sqrt(g*g+Math.cos(f)*Math.cos(p)*e*e));return Math.round(f*c*1E4)/1E4}function d(c,e){c/=15;e||(c=Math.round(c));return c}b.getGreatCircleDistance=h;b.getGreatCircleDistanceFromPoints=l;b.getGreatCircleSpanAt=function(c,e,f){const g=e.spatialReference,p=r.getReferenceEllipsoid(g),n=new k(e.x,c.y,g),w=new k(f.x,c.y,g);e=new k(c.x,e.y,g);c=new k(c.x,f.y,g);return{lon:l(p.radius,n,w),lat:l(p.radius,e,c)}};b.getLatDeltaForDistance=function(c,e){return a.rad2deg(c/
e)};b.getLonDeltaForDistance=function(c,e,f){e/=f;c=a.deg2rad(c);e=Math.sin(e/2);c=Math.cos(c);c=2*a.asinClamped(Math.sqrt(e*e/(c*c)));return a.rad2deg(c)};b.getMaxCameraAltitude=function(c,e){c=a.deg2rad(c/2);return(1-Math.sin(c))*e/Math.sin(c)};b.longitudeToTimezone=d;b.positionToTimezone=function(c,e){e||(e={hours:0,minutes:0,seconds:0});e.hours=d(c[0],!0);c=e.hours%1;e.hours-=c;e.minutes=60*c;c=e.minutes%1;e.minutes-=c;e.seconds=Math.round(60*c);return e};Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/SunCalc".split(" "),function(b,k,a,r,l,h,d){function c(n,w,q,m){const u=[];for(let v=0;v<q.length;v++)u[v]=(m[v]-q[v])*n/w+q[v];return u}const e={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,
diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},f=h.create(),g={azimuth:0,altitude:0},p={ambient:{color:a.create(),intensity:0},diffuse:{color:a.create(),intensity:0,direction:a.create()},globalFactor:0,noonFactor:0};b.computeColorAndIntensity=function(n,w){var q=w[2];r.set(p.ambient.color,1,1,1);p.ambient.intensity=e.global.ambient;r.set(p.diffuse.color,1,1,1);p.diffuse.intensity=e.global.diffuse;q=(Math.abs(q)-e.local.altitude)/
(e.global.altitude-e.local.altitude);q=k.clamp(q,0,1);p.globalFactor=q;w=d.SunCalc.getTimes(n,w[1],w[0]);if(1>q){{var m=n.valueOf();if(w.polarException===d.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN){var u=m-36E5*(n.getHours()+48)-6E4*n.getMinutes();var v=u+432E6}else w.polarException===d.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(u=m-2,v=m-1):(u=w.sunrise.valueOf(),v=w.sunset.valueOf());var y=v-u;var B=u+y/2;var x=y/4;var C=B-x;x=B+x;var z=.06*y;y=u-z/2;u+=z/2;const A=v-z/2,t=v+z/2;v=e.local;const D=[.01,v.ambientAtNight],
E=[.8,.8,1],G=[.01,.01,.01],H=[v.diffuseAtTwilight,v.ambientAtTwilight],I=[1,.75,.75],J=[.8,.8,1],K=[.9*v.diffuseAtNoon,v.ambientAtNoon],L=[1,.98,.98],S=[.98,.98,1],M=[v.diffuseAtNoon,v.ambientAtNoon],T=[1,1,1],O=[1,1,1];v=[0,0];let Q=[0,0,0];z=[0,0,0];m<y||m>t?(v=D,Q=G,z=E):m<u?(z=u-y,v=c(m-y,z,D,H),Q=c(m-y,z,G,I),z=c(m-y,z,E,J)):m<C?(z=C-u,v=c(m-u,z,H,K),Q=c(m-u,z,I,L),z=c(m-u,z,J,S)):m<B?(z=B-C,v=c(m-C,z,K,M),Q=c(m-C,z,L,T),z=c(m-C,z,S,O)):m<x?(z=x-B,v=c(m-B,z,M,K),Q=c(m-B,z,T,L),z=c(m-B,z,O,S)):
m<A?(z=A-x,v=c(m-x,z,K,H),Q=c(m-x,z,L,I),z=c(m-x,z,S,J)):m<t&&(z=t-A,v=c(m-A,z,H,D),Q=c(m-A,z,I,G),z=c(m-A,z,J,E));m=v[0];B=a.fromValues(Q[0],Q[1],Q[2]);C=v[1];x=a.fromValues(z[0],z[1],z[2])}r.lerp(p.ambient.color,x,p.ambient.color,q);p.ambient.intensity=k.lerp(C,p.ambient.intensity,q);r.lerp(p.diffuse.color,B,p.diffuse.color,q);p.diffuse.intensity=k.lerp(m,p.diffuse.intensity,q)}q=n.valueOf();w.polarException===d.SunCalc.POLAR_EXCEPTION.MIDNIGHT_SUN?(n=q-36E5*(n.getHours()+48)-6E4*n.getMinutes(),
w=n+432E6):w.polarException===d.SunCalc.POLAR_EXCEPTION.POLAR_NIGHT?(n=q-2,w=q-1):(n=w.sunrise.valueOf(),w=w.sunset.valueOf());n=1-k.clamp(Math.abs(q-(n+(w-n)/2))/432E5,0,1);p.noonFactor=n;return p};b.computeDirection=function(n,w,q,m){m||(m=a.create());const u=l.identity(f);if("global"===q)d.SunCalc.getPosition(n,0,0,g),r.set(m,0,0,-1),l.rotateX(u,u,-g.azimuth),l.rotateY(u,u,-g.altitude);else{var v=e.planarDirection;q=v.globalAngles;v=(Math.abs(w[2])-v.localAltitude)/(v.globalAltitude-v.localAltitude);
v=k.clamp(v,0,1);1>v?(d.SunCalc.getPosition(n,w[1],w[0],g),g.azimuth=(1-v)*g.azimuth+v*q.azimuth,g.altitude=(1-v)*g.altitude+v*q.altitude):(g.azimuth=q.azimuth,g.altitude=q.altitude);r.set(m,0,-1,0);l.rotateZ(u,u,-g.azimuth);l.rotateX(u,u,-g.altitude)}r.transformMat4(m,m,u);return m};b.computeShadowsEnabled=function(n,w){return"global"===w?!0:Math.abs(n[2])<e.planarDirection.localAltitude};b.settings=e;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/SunCalc":function(){define(["exports",
"./_commonjsHelpers"],function(b,k){k=k.createCommonjsModule(function(a){(function(r){r=r();void 0!==r&&(a.exports=r)})(function(){function r(t){return new Date(864E5*(t+.5-2440588))}function l(t,D){return v(w(t)*q(C)-m(D)*w(C),q(t))}function h(t,D){return u(w(D)*q(C)+q(D)*w(C)*w(t))}function d(t,D,E){return v(w(t),q(t)*w(D)-m(E)*q(D))}function c(t,D,E){return u(w(D)*w(E)+q(D)*q(E)*q(t))}function e(t){return B*(1.9148*w(t)+.02*w(2*t)+3E-4*w(3*t))}function f(t,D){t=B*(357.5291+.98560028*t);var E=e(t);
t=t+E+102.9372*B+n;D||(D={dec:0,ra:0});D.dec=h(t,0);D.ra=l(t,0);return D}function g(t,D,E){return 2451545+t+.0053*w(D)-.0069*w(2*E)}function p(t){var D=B*(134.963+13.064993*t),E=B*(93.272+13.22935*t);t=B*(218.316+13.176396*t)+6.289*B*w(D);E=5.128*B*w(E);D=385001-20905*q(D);return{ra:l(t,E),dec:h(t,E),dist:D}}var n=Math.PI,w=Math.sin,q=Math.cos,m=Math.tan,u=Math.asin,v=Math.atan2,y=Math.acos,B=n/180,x={dec:0,ra:0},C=23.4397*B,z={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,
D,E,G){E=B*-E;D*=B;var H=t.valueOf()/864E5-.5+2440588-2451545;t=f(H,x);E=B*(280.16+360.9856235*H)-E-t.ra;G||(G={azimuth:0,altitude:0});G.azimuth=d(E,D,t.dec);G.altitude=c(E,D,t.dec);return G}},A=[[-.83,"sunrise","sunset"]];z.addTime=function(t,D,E){A.push([t,D,E])};z.getTimes=function(t,D,E){function G(F){var N=I,P=S;F=y((w(F)-w(N)*w(P))/(q(N)*q(P)));return g(9E-4+(F+H)/(2*n)+J,K,L)}var H=B*-E,I=B*D,J=Math.round(t.valueOf()/864E5-.5+2440588-2451545-9E-4-H/(2*n));t=9E-4+(0+H)/(2*n)+J;var K=B*(357.5291+
.98560028*t);D=e(K);var L=K+D+102.9372*B+n,S=h(L,0);t=g(t,K,L);D={solarNoon:r(t),nadir:r(t-.5),polarException:z.POLAR_EXCEPTION.NORMAL};var M;E=0;for(M=A.length;E<M;E+=1){var T=A[E];var O=G(T[0]*B);var Q=t-(O-t);D[T[1]]=r(Q);D[T[2]]=r(O)}D.polarException=function(F){F=(w(F)-w(I)*w(S))/(q(I)*q(S));return-1>F?z.POLAR_EXCEPTION.MIDNIGHT_SUN:1<F?z.POLAR_EXCEPTION.POLAR_NIGHT:z.POLAR_EXCEPTION.NORMAL}(A[0][0]*B);return D};z.getMoonPosition=function(t,D,E){E=B*-E;D*=B;var G=t.valueOf()/864E5-.5+2440588-
2451545;t=p(G);E=B*(280.16+360.9856235*G)-E-t.ra;G=c(E,D,t.dec);G+=.017*B/m(G+10.26*B/(G+5.1*B));return{azimuth:d(E,D,t.dec),altitude:G,distance:t.dist}};z.getMoonFraction=function(t){var D=t.valueOf()/864E5-.5+2440588-2451545;t=f(D);D=p(D);t=y(w(t.dec)*w(D.dec)+q(t.dec)*q(D.dec)*q(t.ra-D.ra));t=v(149598E3*w(t),D.dist-149598E3*q(t));return(1+q(t))/2};return z})});b.SunCalc=k})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/vec3f64"],function(b,
k){b.AmbientLight=function(a=k.create()){this.intensity=a};b.FillLight=function(a=k.create(),r=k.fromValues(.57735,.57735,.57735)){this.intensity=k.create();this.direction=k.create();this.intensity=a;this.direction=r};b.MainLight=function(a=k.create(),r=k.fromValues(.57735,.57735,.57735),l=!0){this.intensity=a;this.direction=r;this.castShadows=l};b.SphericalHarmonicsLight=function(){this.sh={r:[0],g:[0],b:[0]}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/quatf64 ../../../../chunks/vec4f64 ../../../../chunks/mat3 ../../../../chunks/vec4 ../../../../chunks/quat ../../../../chunks/vec3f32 ../../../../chunks/boundedPlane ../../../../chunks/sphere ../../support/geometryUtils ./Object3D".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){function y(T,O){return a.isNone(T)||null==T.layerUid?null:a.isSome(O.graphicsView)&&T.layerUid===O.graphicsView.mockLayerId?O.graphics:O.map.findLayerByUid(T.layerUid)}function B(T,O){if(a.isNone(T))return null;const Q=y(T,O);return a.isNone(Q)?null:Q===O.graphics?a.isSome(O.graphicsView)?a.unwrap(O.graphicsView.getGraphicFromGraphicUid(T.graphicUid)):null:(O=O.allLayerViews.find(F=>F.layer===Q))?x(O,T):null}function x(T,O){return!T||T.suspended?null:
"getGraphicFromIntersectorMetadata"in T&&O?T.getGraphicFromIntersectorMetadata(O):"getGraphicFromGraphicUid"in T&&null!=O.graphicUid?T.getGraphicFromGraphicUid(O.graphicUid):null}let C=function(){function T(){this._transform=c.create();this._transformInverse=new z({value:this._transform},h.invert,c.create);this._transformInverseTranspose=new z(this._transformInverse,h.transpose,c.create);this._transformTranspose=new z({value:this._transform},h.transpose,c.create);this._transformInverseRotation=new z({value:this._transform},
g.normalFromMat4Legacy,d.create)}var O=T.prototype;O.invalidateLazyTransforms=function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};O.setTransformMatrix=function(Q){h.copy(this._transform,Q)};O.multiplyTransform=function(Q){h.multiply(this._transform,this._transform,Q)};O.set=function(Q){h.copy(this._transform,Q);this.invalidateLazyTransforms()};O.setAndInvalidateLazyTransforms=
function(Q,F){this.setTransformMatrix(Q);this.multiplyTransform(F);this.invalidateLazyTransforms()};k._createClass(T,[{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);return T}(),z=
function(){function T(O,Q,F){this.original=O;this.update=Q;this.dirty=!0;this.transform=F()}T.prototype.invalidate=function(){this.dirty=!0};k._createClass(T,[{key:"value",get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform}}]);return T}(),A=function(){function T(){this.min=new t;this.max=new t;this.hud=new t;this.ground=new t}T.prototype.init=function(O){this.min.init(O);this.max.init(O);this.hud.init(O);this.ground.init(O);this.all=[]};
return T}(),t=function(){function T(Q){this.normal=r.create();this.transformation=c.create();this._ray=u.ray.create();this.init(Q)}var O=T.prototype;O.getIntersectionPoint=function(Q){if(!this.hasIntersectionPoint)return!1;l.scale(L,this.ray.direction,this.dist);l.add(Q,this.ray.origin,L);return!0};O.getTransformedNormal=function(Q){l.copy(S,this.normal);S[3]=0;p.transformMat4(S,S,this.transformation);l.copy(Q,S);l.normalize(Q,Q);return Q};O.init=function(Q){this.drapedLayerGraphicOrder=this.drapedLayerOrder=
this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";Q?u.ray.copy(Q,this._ray):this._ray=u.ray.create()};O.set=function(Q,F,N,P,U,V,W,X,ca,R){Q instanceof v&&(Q={type:"stage",obj:Q});this.dist=N;l.copy(this.normal,P);h.copy(this.transformation,U);this.target=Q;this.name=F;this.drapedLayerOrder=V;this.center=W?r.clone(W):null;this.geometryId=X;this.triangleNr=ca;this.drapedLayerGraphicOrder=R};O.copyFrom=function(Q){u.ray.copy(Q._ray,this._ray);
this.dist=Q.dist;this.target=Q.target;this.name=Q.name;this.drapedLayerOrder=Q.drapedLayerOrder;this.center=Q.center?r.clone(Q.center):null;this.geometryId=Q.geometryId;this.triangleNr=Q.triangleNr;this.intersector=Q.intersector;this.drapedLayerGraphicOrder=Q.drapedLayerGraphicOrder;l.copy(this.normal,Q.normal);h.copy(this.transformation,Q.transformation)};O.toOwner=function(Q){if(!this.target)return null;switch(this.target.type){case "stage":return y(this.target.obj.metadata,Q);case "external":switch(this.intersector){case "PointRenderer":{const F=
this.target.metadata.layerUid;Q=null!=F?Q.map.findLayerByUid(F):null}return Q;case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return y(this.target.metadata,Q);case "TerrainRenderer":return Q.map&&Q.map.ground}}return null};O.toGraphic=function(Q){if(!this.target)return null;switch(this.target.type){case "stage":return B(this.target.obj.metadata,Q);case "external":switch(this.intersector){case "PointRenderer":return this.target.metadata.createGraphic();case "I3S":case "IM":case "LodRenderer":case "OverlayRenderer":return B(this.target.metadata,
Q)}}return null};k._createClass(T,[{key:"ray",get:function(){return this._ray}},{key:"hasIntersectionPoint",get:function(){return null!=this.dist}},{key:"distanceInRenderSpace",get:function(){if(null!=this.dist)return l.scale(L,this.ray.direction,this.dist),l.length(L)}}]);return T}(),D=function(){function T(Q=0){this.offset=Q;this.tmpVertex=r.create()}var O=T.prototype;O.applyToVertex=function(Q,F,N){const P=Q+this.localOrigin[0],U=F+this.localOrigin[1],V=N+this.localOrigin[2],W=this.offset/Math.sqrt(P*
P+U*U+V*V);this.tmpVertex[0]=Q+P*W;this.tmpVertex[1]=F+U*W;this.tmpVertex[2]=N+V*W;return this.tmpVertex};O.applyToAabb=function(Q){var F=Q[0]+this.localOrigin[0];const N=Q[1]+this.localOrigin[1],P=Q[2]+this.localOrigin[2],U=Q[3]+this.localOrigin[0],V=Q[4]+this.localOrigin[1],W=Q[5]+this.localOrigin[2],X=this.offset/Math.sqrt(F*F+N*N+P*P);Q[0]+=F*X;Q[1]+=N*X;Q[2]+=P*X;F=this.offset/Math.sqrt(U*U+V*V+W*W);Q[3]+=U*F;Q[4]+=V*F;Q[5]+=W*F;return Q};return T}(),E=function(){function T(Q=0){this.offset=
Q;this.componentLocalOriginLength=0;this.tmpVertex=r.create();this.mbs=f.create();this.obb={center:r.create(),halfSize:w.create(),quaternion:null}}var O=T.prototype;O.applyToVertex=function(Q,F,N){const P=N+this.componentLocalOriginLength,U=this.offset/Math.sqrt(Q*Q+F*F+P*P);this.tmpVertex[0]=Q+Q*U;this.tmpVertex[1]=F+F*U;this.tmpVertex[2]=N+P*U;return this.tmpVertex};O.applyToAabb=function(Q){var F=Q[0];const N=Q[1],P=Q[2]+this.componentLocalOriginLength,U=Q[3],V=Q[4],W=Q[5]+this.componentLocalOriginLength,
X=this.offset/Math.sqrt(F*F+N*N+P*P);Q[0]+=F*X;Q[1]+=N*X;Q[2]+=P*X;F=this.offset/Math.sqrt(U*U+V*V+W*W);Q[3]+=U*F;Q[4]+=V*F;Q[5]+=W*F;return Q};O.applyToMbs=function(Q){const F=Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2]),N=this.offset/F;this.mbs[0]=Q[0]+Q[0]*N;this.mbs[1]=Q[1]+Q[1]*N;this.mbs[2]=Q[2]+Q[2]*N;this.mbs[3]=Q[3]+Q[3]*this.offset/F;return this.mbs};O.applyToObb=function(Q){var F=Q.center;const N=this.offset/Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]);this.obb.center[0]=F[0]+F[0]*N;this.obb.center[1]=
F[1]+F[1]*N;this.obb.center[2]=F[2]+F[2]*N;l.transformQuat(this.obb.halfSize,Q.halfSize,Q.quaternion);l.add(this.obb.halfSize,this.obb.halfSize,Q.center);F=this.offset/Math.sqrt(this.obb.halfSize[0]*this.obb.halfSize[0]+this.obb.halfSize[1]*this.obb.halfSize[1]+this.obb.halfSize[2]*this.obb.halfSize[2]);this.obb.halfSize[0]+=this.obb.halfSize[0]*F;this.obb.halfSize[1]+=this.obb.halfSize[1]*F;this.obb.halfSize[2]+=this.obb.halfSize[2]*F;l.subtract(this.obb.halfSize,this.obb.halfSize,Q.center);n.conjugate(M,
Q.quaternion);l.transformQuat(this.obb.halfSize,this.obb.halfSize,M);this.obb.halfSize[0]*=0>this.obb.halfSize[0]?-1:1;this.obb.halfSize[1]*=0>this.obb.halfSize[1]?-1:1;this.obb.halfSize[2]*=0>this.obb.halfSize[2]?-1:1;this.obb.quaternion=Q.quaternion;return this.obb};k._createClass(T,[{key:"localOrigin",set:function(Q){this.componentLocalOriginLength=Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2])}}]);return T}(),G=function(){function T(Q=0){this.offset=Q;this.sphere=m.create();this.tmpVertex=r.create()}
var O=T.prototype;O.applyToVertex=function(Q,F,N){const P=this.objectTransform.transform;let U=P[0]*Q+P[4]*F+P[8]*N+P[12],V=P[1]*Q+P[5]*F+P[9]*N+P[13];Q=P[2]*Q+P[6]*F+P[10]*N+P[14];F=this.offset/Math.sqrt(U*U+V*V+Q*Q);U+=U*F;V+=V*F;Q+=Q*F;F=this.objectTransform.inverse;this.tmpVertex[0]=F[0]*U+F[4]*V+F[8]*Q+F[12];this.tmpVertex[1]=F[1]*U+F[5]*V+F[9]*Q+F[13];this.tmpVertex[2]=F[2]*U+F[6]*V+F[10]*Q+F[14];return this.tmpVertex};O.applyToMinMax=function(Q,F){const N=this.offset/Math.sqrt(Q[0]*Q[0]+Q[1]*
Q[1]+Q[2]*Q[2]);Q[0]+=Q[0]*N;Q[1]+=Q[1]*N;Q[2]+=Q[2]*N;Q=this.offset/Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]);F[0]+=F[0]*Q;F[1]+=F[1]*Q;F[2]+=F[2]*Q};O.applyToAabb=function(Q){var F=this.offset/Math.sqrt(Q[0]*Q[0]+Q[1]*Q[1]+Q[2]*Q[2]);Q[0]+=Q[0]*F;Q[1]+=Q[1]*F;Q[2]+=Q[2]*F;F=this.offset/Math.sqrt(Q[3]*Q[3]+Q[4]*Q[4]+Q[5]*Q[5]);Q[3]+=Q[3]*F;Q[4]+=Q[4]*F;Q[5]+=Q[5]*F;return Q};O.applyToBoundingSphere=function(Q,F){const N=Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]),P=this.offset/N;this.sphere.center[0]=
F[0]+F[0]*P;this.sphere.center[1]=F[1]+F[1]*P;this.sphere.center[2]=F[2]+F[2]*P;this.sphere.radius=Q+Q*this.offset/N;return this.sphere};return T}();const H=new G,I=new E,J=new D,K=r.create(),L=r.create(),S=f.create(),M=e.create();b.I3SVerticalOffsetGlobalViewingMode=E;b.IntersectorOptions=function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=2};b.IntersectorResult=t;b.IntersectorResults=
A;b.IntersectorTransform=C;b.Object3DVerticalOffsetGlobalViewingMode=G;b.TERRAIN_ID="terrain";b.TerrainVerticalOffsetGlobalViewingMode=D;b.getVerticalOffsetI3S=function(T){return a.isSome(T)?(I.offset=T,I):null};b.getVerticalOffsetObject3D=function(T){return a.isSome(T)?(H.offset=T,H):null};b.getVerticalOffsetTerrain=function(T){return a.isSome(T)?(J.offset=T,J):null};b.sliceFilterPredicate=function(T){return(O,Q,F)=>{l.lerp(K,O,Q,F);return!q.extrusionContainsPoint(T,K)}};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/chunks/mat3":function(){define(["exports","./common"],function(b,k){function a(L,S){L[0]=S[0];L[1]=S[1];L[2]=S[2];L[3]=S[4];L[4]=S[5];L[5]=S[6];L[6]=S[8];L[7]=S[9];L[8]=S[10];return L}function r(L,S){L[0]=S[0];L[1]=S[1];L[2]=S[2];L[3]=S[3];L[4]=S[4];L[5]=S[5];L[6]=S[6];L[7]=S[7];L[8]=S[8];return L}function l(L,S,M,T,O,Q,F,N,P,U){L[0]=S;L[1]=M;L[2]=T;L[3]=O;L[4]=Q;L[5]=F;L[6]=N;L[7]=P;L[8]=U;return L}function h(L){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=1;L[5]=0;L[6]=0;L[7]=
0;L[8]=1;return L}function d(L,S){if(L===S){const M=S[1],T=S[2],O=S[5];L[1]=S[3];L[2]=S[6];L[3]=M;L[5]=S[7];L[6]=T;L[7]=O}else L[0]=S[0],L[1]=S[3],L[2]=S[6],L[3]=S[1],L[4]=S[4],L[5]=S[7],L[6]=S[2],L[7]=S[5],L[8]=S[8];return L}function c(L,S){const M=S[0],T=S[1],O=S[2],Q=S[3],F=S[4],N=S[5],P=S[6],U=S[7];S=S[8];const V=S*F-N*U,W=-S*Q+N*P,X=U*Q-F*P;let ca=M*V+T*W+O*X;if(!ca)return null;ca=1/ca;L[0]=V*ca;L[1]=(-S*T+O*U)*ca;L[2]=(N*T-O*F)*ca;L[3]=W*ca;L[4]=(S*M-O*P)*ca;L[5]=(-N*M+O*Q)*ca;L[6]=X*ca;L[7]=
(-U*M+T*P)*ca;L[8]=(F*M-T*Q)*ca;return L}function e(L,S){const M=S[0],T=S[1],O=S[2],Q=S[3],F=S[4],N=S[5],P=S[6],U=S[7];S=S[8];L[0]=F*S-N*U;L[1]=O*U-T*S;L[2]=T*N-O*F;L[3]=N*P-Q*S;L[4]=M*S-O*P;L[5]=O*Q-M*N;L[6]=Q*U-F*P;L[7]=T*P-M*U;L[8]=M*F-T*Q;return L}function f(L){const S=L[3],M=L[4],T=L[5],O=L[6],Q=L[7],F=L[8];return L[0]*(F*M-T*Q)+L[1]*(-F*S+T*O)+L[2]*(Q*S-M*O)}function g(L,S,M){const T=S[0],O=S[1],Q=S[2],F=S[3],N=S[4],P=S[5],U=S[6],V=S[7];S=S[8];const W=M[0],X=M[1],ca=M[2],R=M[3],aa=M[4],ka=M[5],
da=M[6],fa=M[7];M=M[8];L[0]=W*T+X*F+ca*U;L[1]=W*O+X*N+ca*V;L[2]=W*Q+X*P+ca*S;L[3]=R*T+aa*F+ka*U;L[4]=R*O+aa*N+ka*V;L[5]=R*Q+aa*P+ka*S;L[6]=da*T+fa*F+M*U;L[7]=da*O+fa*N+M*V;L[8]=da*Q+fa*P+M*S;return L}function p(L,S,M){const T=S[0],O=S[1],Q=S[2],F=S[3],N=S[4],P=S[5],U=S[6],V=S[7];S=S[8];const W=M[0];M=M[1];L[0]=T;L[1]=O;L[2]=Q;L[3]=F;L[4]=N;L[5]=P;L[6]=W*T+M*F+U;L[7]=W*O+M*N+V;L[8]=W*Q+M*P+S;return L}function n(L,S,M){const T=S[0],O=S[1],Q=S[2],F=S[3],N=S[4],P=S[5],U=S[6],V=S[7];S=S[8];const W=Math.sin(M);
M=Math.cos(M);L[0]=M*T+W*F;L[1]=M*O+W*N;L[2]=M*Q+W*P;L[3]=M*F-W*T;L[4]=M*N-W*O;L[5]=M*P-W*Q;L[6]=U;L[7]=V;L[8]=S;return L}function w(L,S,M){const T=M[0],O=M[1];M=M[2];L[0]=T*S[0];L[1]=T*S[1];L[2]=T*S[2];L[3]=O*S[3];L[4]=O*S[4];L[5]=O*S[5];L[6]=M*S[6];L[7]=M*S[7];L[8]=M*S[8];return L}function q(L,S,M){const T=M[0];M=M[1];L[0]=T*S[0];L[1]=T*S[1];L[2]=T*S[2];L[3]=M*S[3];L[4]=M*S[4];L[5]=M*S[5];return L}function m(L,S){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=1;L[5]=0;L[6]=S[0];L[7]=S[1];L[8]=1;return L}function u(L,
S){const M=Math.sin(S);S=Math.cos(S);L[0]=S;L[1]=M;L[2]=0;L[3]=-M;L[4]=S;L[5]=0;L[6]=0;L[7]=0;L[8]=1;return L}function v(L,S){L[0]=S[0];L[1]=0;L[2]=0;L[3]=0;L[4]=S[1];L[5]=0;L[6]=0;L[7]=0;L[8]=1;return L}function y(L,S){L[0]=S[0];L[1]=S[1];L[2]=0;L[3]=S[2];L[4]=S[3];L[5]=0;L[6]=S[4];L[7]=S[5];L[8]=1;return L}function B(L,S){var M=S[0],T=S[1],O=S[2];S=S[3];var Q=M+M,F=T+T;const N=O+O;M*=Q;const P=T*Q;T*=F;const U=O*Q,V=O*F;O*=N;Q*=S;F*=S;S*=N;L[0]=1-T-O;L[3]=P-S;L[6]=U+F;L[1]=P+S;L[4]=1-M-O;L[7]=V-
Q;L[2]=U-F;L[5]=V+Q;L[8]=1-M-T;return L}function x(L,S){const M=S[0],T=S[1],O=S[2],Q=S[4],F=S[5],N=S[6],P=S[8],U=S[9];S=S[10];const V=S*F-N*U,W=-S*Q+N*P,X=U*Q-F*P;var ca=M*V+T*W+O*X;if(!ca)return null;ca=1/ca;L[0]=V*ca;L[1]=(-S*T+O*U)*ca;L[2]=(N*T-O*F)*ca;L[3]=W*ca;L[4]=(S*M-O*P)*ca;L[5]=(-N*M+O*Q)*ca;L[6]=X*ca;L[7]=(-U*M+T*P)*ca;L[8]=(F*M-T*Q)*ca;return L}function C(L,S){const M=S[0],T=S[1],O=S[2],Q=S[3],F=S[4],N=S[5],P=S[6],U=S[7];var V=S[8],W=S[9],X=S[10],ca=S[11];const R=S[12],aa=S[13],ka=S[14];
S=S[15];const da=M*N-T*F,fa=M*P-O*F,ea=M*U-Q*F,Y=T*P-O*N,Z=T*U-Q*N,ba=O*U-Q*P,ia=V*aa-W*R,ja=V*ka-X*R;V=V*S-ca*R;const la=W*ka-X*aa;W=W*S-ca*aa;X=X*S-ca*ka;ca=da*X-fa*W+ea*la+Y*V-Z*ja+ba*ia;if(!ca)return null;ca=1/ca;L[0]=(N*X-P*W+U*la)*ca;L[1]=(P*V-F*X-U*ja)*ca;L[2]=(F*W-N*V+U*ia)*ca;L[3]=(O*W-T*X-Q*la)*ca;L[4]=(M*X-O*V+Q*ja)*ca;L[5]=(T*V-M*W-Q*ia)*ca;L[6]=(aa*ba-ka*Z+S*Y)*ca;L[7]=(ka*ea-R*ba-S*fa)*ca;L[8]=(R*Z-aa*ea+S*da)*ca;return L}function z(L,S,M){L[0]=2/S;L[1]=0;L[2]=0;L[3]=0;L[4]=-2/M;L[5]=
0;L[6]=-1;L[7]=1;L[8]=1;return L}function A(L){return"mat3("+L[0]+", "+L[1]+", "+L[2]+", "+L[3]+", "+L[4]+", "+L[5]+", "+L[6]+", "+L[7]+", "+L[8]+")"}function t(L){return Math.sqrt(Math.pow(L[0],2)+Math.pow(L[1],2)+Math.pow(L[2],2)+Math.pow(L[3],2)+Math.pow(L[4],2)+Math.pow(L[5],2)+Math.pow(L[6],2)+Math.pow(L[7],2)+Math.pow(L[8],2))}function D(L,S,M){L[0]=S[0]+M[0];L[1]=S[1]+M[1];L[2]=S[2]+M[2];L[3]=S[3]+M[3];L[4]=S[4]+M[4];L[5]=S[5]+M[5];L[6]=S[6]+M[6];L[7]=S[7]+M[7];L[8]=S[8]+M[8];return L}function E(L,
S,M){L[0]=S[0]-M[0];L[1]=S[1]-M[1];L[2]=S[2]-M[2];L[3]=S[3]-M[3];L[4]=S[4]-M[4];L[5]=S[5]-M[5];L[6]=S[6]-M[6];L[7]=S[7]-M[7];L[8]=S[8]-M[8];return L}function G(L,S,M){L[0]=S[0]*M;L[1]=S[1]*M;L[2]=S[2]*M;L[3]=S[3]*M;L[4]=S[4]*M;L[5]=S[5]*M;L[6]=S[6]*M;L[7]=S[7]*M;L[8]=S[8]*M;return L}function H(L,S,M,T){L[0]=S[0]+M[0]*T;L[1]=S[1]+M[1]*T;L[2]=S[2]+M[2]*T;L[3]=S[3]+M[3]*T;L[4]=S[4]+M[4]*T;L[5]=S[5]+M[5]*T;L[6]=S[6]+M[6]*T;L[7]=S[7]+M[7]*T;L[8]=S[8]+M[8]*T;return L}function I(L,S){return L[0]===S[0]&&
L[1]===S[1]&&L[2]===S[2]&&L[3]===S[3]&&L[4]===S[4]&&L[5]===S[5]&&L[6]===S[6]&&L[7]===S[7]&&L[8]===S[8]}function J(L,S){const M=L[0],T=L[1],O=L[2],Q=L[3],F=L[4],N=L[5],P=L[6],U=L[7];L=L[8];const V=S[0],W=S[1],X=S[2],ca=S[3],R=S[4],aa=S[5],ka=S[6],da=S[7];S=S[8];return Math.abs(M-V)<=k.EPSILON*Math.max(1,Math.abs(M),Math.abs(V))&&Math.abs(T-W)<=k.EPSILON*Math.max(1,Math.abs(T),Math.abs(W))&&Math.abs(O-X)<=k.EPSILON*Math.max(1,Math.abs(O),Math.abs(X))&&Math.abs(Q-ca)<=k.EPSILON*Math.max(1,Math.abs(Q),
Math.abs(ca))&&Math.abs(F-R)<=k.EPSILON*Math.max(1,Math.abs(F),Math.abs(R))&&Math.abs(N-aa)<=k.EPSILON*Math.max(1,Math.abs(N),Math.abs(aa))&&Math.abs(P-ka)<=k.EPSILON*Math.max(1,Math.abs(P),Math.abs(ka))&&Math.abs(U-da)<=k.EPSILON*Math.max(1,Math.abs(U),Math.abs(da))&&Math.abs(L-S)<=k.EPSILON*Math.max(1,Math.abs(L),Math.abs(S))}var K=Object.freeze({__proto__:null,fromMat4:a,copy:r,set:l,identity:h,transpose:d,invert:c,adjoint:e,determinant:f,multiply:g,translate:p,rotate:n,scale:w,scaleByVec2:q,fromTranslation:m,
fromRotation:u,fromScaling:v,fromMat2d:y,fromQuat:B,normalFromMat4Legacy:x,normalFromMat4:C,projection:z,str:A,frob:t,add:D,subtract:E,multiplyScalar:G,multiplyScalarAndAdd:H,exactEquals:I,equals:J,mul:g,sub:E});b.add=D;b.adjoint=e;b.copy=r;b.determinant=f;b.equals=J;b.exactEquals=I;b.frob=t;b.fromMat2d=y;b.fromMat4=a;b.fromQuat=B;b.fromRotation=u;b.fromScaling=v;b.fromTranslation=m;b.identity=h;b.invert=c;b.mat3=K;b.mul=g;b.multiply=g;b.multiplyScalar=G;b.multiplyScalarAndAdd=H;b.normalFromMat4=
C;b.normalFromMat4Legacy=x;b.projection=z;b.rotate=n;b.scale=w;b.scaleByVec2=q;b.set=l;b.str=A;b.sub=E;b.subtract=E;b.translate=p;b.transpose=d})},"esri/chunks/quat":function(){define("exports ./vec3f64 ./common ./vec3 ./mat3f64 ./quatf64 ./vec4".split(" "),function(b,k,a,r,l,h,d){function c(U){U[0]=0;U[1]=0;U[2]=0;U[3]=1;return U}function e(U,V,W){W*=.5;const X=Math.sin(W);U[0]=X*V[0];U[1]=X*V[1];U[2]=X*V[2];U[3]=Math.cos(W);return U}function f(U,V){const W=2*Math.acos(V[3]),X=Math.sin(W/2);X>a.EPSILON?
(U[0]=V[0]/X,U[1]=V[1]/X,U[2]=V[2]/X):(U[0]=1,U[1]=0,U[2]=0);return W}function g(U,V,W){const X=V[0],ca=V[1],R=V[2];V=V[3];const aa=W[0],ka=W[1],da=W[2];W=W[3];U[0]=X*W+V*aa+ca*da-R*ka;U[1]=ca*W+V*ka+R*aa-X*da;U[2]=R*W+V*da+X*ka-ca*aa;U[3]=V*W-X*aa-ca*ka-R*da;return U}function p(U,V,W){W*=.5;const X=V[0],ca=V[1],R=V[2];V=V[3];const aa=Math.sin(W);W=Math.cos(W);U[0]=X*W+V*aa;U[1]=ca*W+R*aa;U[2]=R*W-ca*aa;U[3]=V*W-X*aa;return U}function n(U,V,W){W*=.5;const X=V[0],ca=V[1],R=V[2];V=V[3];const aa=Math.sin(W);
W=Math.cos(W);U[0]=X*W-R*aa;U[1]=ca*W+V*aa;U[2]=R*W+X*aa;U[3]=V*W-ca*aa;return U}function w(U,V,W){W*=.5;const X=V[0],ca=V[1],R=V[2];V=V[3];const aa=Math.sin(W);W=Math.cos(W);U[0]=X*W+ca*aa;U[1]=ca*W-X*aa;U[2]=R*W+V*aa;U[3]=V*W-R*aa;return U}function q(U,V){const W=V[0],X=V[1];V=V[2];U[0]=W;U[1]=X;U[2]=V;U[3]=Math.sqrt(Math.abs(1-W*W-X*X-V*V));return U}function m(U,V,W,X){const ca=V[0],R=V[1],aa=V[2];V=V[3];let ka=W[0],da=W[1],fa=W[2];W=W[3];let ea;let Y;var Z=ca*ka+R*da+aa*fa+V*W;0>Z&&(Z=-Z,ka=-ka,
da=-da,fa=-fa,W=-W);1-Z>a.EPSILON?(ea=Math.acos(Z),Y=Math.sin(ea),Z=Math.sin((1-X)*ea)/Y,X=Math.sin(X*ea)/Y):Z=1-X;U[0]=Z*ca+X*ka;U[1]=Z*R+X*da;U[2]=Z*aa+X*fa;U[3]=Z*V+X*W;return U}function u(U){var V=a.RANDOM();const W=a.RANDOM(),X=a.RANDOM(),ca=Math.sqrt(1-V);V=Math.sqrt(V);U[0]=ca*Math.sin(2*Math.PI*W);U[1]=ca*Math.cos(2*Math.PI*W);U[2]=V*Math.sin(2*Math.PI*X);U[3]=V*Math.cos(2*Math.PI*X);return U}function v(U,V){const W=V[0],X=V[1],ca=V[2];V=V[3];var R=W*W+X*X+ca*ca+V*V;R=R?1/R:0;U[0]=-W*R;U[1]=
-X*R;U[2]=-ca*R;U[3]=V*R;return U}function y(U,V){U[0]=-V[0];U[1]=-V[1];U[2]=-V[2];U[3]=V[3];return U}function B(U,V){var W=V[0]+V[4]+V[8];if(0<W)W=Math.sqrt(W+1),U[3]=.5*W,W=.5/W,U[0]=(V[5]-V[7])*W,U[1]=(V[6]-V[2])*W,U[2]=(V[1]-V[3])*W;else{let X=0;V[4]>V[0]&&(X=1);V[8]>V[3*X+X]&&(X=2);const ca=(X+1)%3,R=(X+2)%3;W=Math.sqrt(V[3*X+X]-V[3*ca+ca]-V[3*R+R]+1);U[X]=.5*W;W=.5/W;U[3]=(V[3*ca+R]-V[3*R+ca])*W;U[ca]=(V[3*ca+X]+V[3*X+ca])*W;U[R]=(V[3*R+X]+V[3*X+R])*W}return U}function x(U,V,W,X){var ca=.5*
Math.PI/180;V*=ca;W*=ca;X*=ca;ca=Math.sin(V);V=Math.cos(V);const R=Math.sin(W);W=Math.cos(W);const aa=Math.sin(X);X=Math.cos(X);U[0]=ca*W*X-V*R*aa;U[1]=V*R*X+ca*W*aa;U[2]=V*W*aa-ca*R*X;U[3]=V*W*X+ca*R*aa;return U}function C(U){return"quat("+U[0]+", "+U[1]+", "+U[2]+", "+U[3]+")"}function z(U,V,W){const X=r.dot(V,W);if(-.999999>X)return r.cross(T,O,V),1E-6>r.len(T)&&r.cross(T,Q,V),r.normalize(T,T),e(U,T,Math.PI),U;if(.999999<X)return U[0]=0,U[1]=0,U[2]=0,U[3]=1,U;r.cross(T,V,W);U[0]=T[0];U[1]=T[1];
U[2]=T[2];U[3]=1+X;return S(U,U)}function A(U,V,W,X,ca,R){m(F,V,ca,R);m(N,W,X,R);m(U,F,N,2*R*(1-R));return U}function t(U,V,W,X){const ca=P;ca[0]=W[0];ca[3]=W[1];ca[6]=W[2];ca[1]=X[0];ca[4]=X[1];ca[7]=X[2];ca[2]=-V[0];ca[5]=-V[1];ca[8]=-V[2];return S(U,B(U,ca))}const D=d.copy,E=d.set,G=d.add,H=d.scale,I=d.dot,J=d.lerp,K=d.length,L=d.squaredLength,S=d.normalize,M=d.exactEquals;d=d.equals;const T=k.create(),O=k.fromValues(1,0,0),Q=k.fromValues(0,1,0),F=h.create(),N=h.create(),P=l.create();k=Object.freeze({__proto__:null,
identity:c,setAxisAngle:e,getAxisAngle:f,multiply:g,rotateX:p,rotateY:n,rotateZ:w,calculateW:q,slerp:m,random:u,invert:v,conjugate:y,fromMat3:B,fromEuler:x,str:C,copy:D,set:E,add:G,mul:g,scale:H,dot:I,lerp:J,length:K,len:K,squaredLength:L,sqrLen:L,normalize:S,exactEquals:M,equals:d,rotationTo:z,sqlerp:A,setAxes:t});b.add=G;b.calculateW=q;b.conjugate=y;b.copy=D;b.dot=I;b.equals=d;b.exactEquals=M;b.fromEuler=x;b.fromMat3=B;b.getAxisAngle=f;b.identity=c;b.invert=v;b.len=K;b.length=K;b.lerp=J;b.mul=g;
b.multiply=g;b.normalize=S;b.quat=k;b.random=u;b.rotateX=p;b.rotateY=n;b.rotateZ=w;b.rotationTo=z;b.scale=H;b.set=E;b.setAxes=t;b.setAxisAngle=e;b.slerp=m;b.sqlerp=A;b.sqrLen=L;b.squaredLength=L;b.str=C})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ./Util ./IdGen ./GeometryRecord ./Object3DStateSet ../materials/renderers/utils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p){let n=function(){function m(v={}){this._objectTransformation=d.create();this._bvObjectSpace=new q;this._bvWorldSpace=new q;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._visible=!0;this.id=m._idGen.gen(v.idHint);this.castShadow=null!=v.castShadow?v.castShadow:!0;(this.metadata=v.metadata)&&this.metadata.isElevationSource&&(this.metadata.lastValidElevationBB=new w);this.objectTransformation=d.create();this._initializeGeometryRecords(v.geometries,v.materials,
v.transformations,v.origins)}var u=m.prototype;u.dispose=function(){for(const v of this._geometryRecords)f.pool.release(v);this._geometries=this._geometryRecords=null};u._initializeGeometryRecords=function(v,y,B,x){if(Array.isArray(v)){c.assert(y.length===v.length,"Object3D: materials don't match geometries");c.assert(B.length===v.length,"Object3D: transformations don't match geometries");this._geometryRecords=Array(v.length);this._geometries=v.slice();for(let C=0;C<v.length;C++)this._geometryRecords[C]=
f.pool.acquire(v[C],y[C],d.clone(B[C]),{highlights:null,occludees:null,visible:!0},x&&x[C]);this._hasVolatileTransformation=!1}else this._geometryRecords=[],this._geometries=[]};u.getNumGeometryRecords=function(){return this._geometryRecords.length};u.getGeometryRecord=function(v){c.assert(0<=v&&v<this._geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this._geometryRecords[v]};u.addGeometry=function(v,y,B,x,C,z){B=B?B:d.IDENTITY;this._geometries.push(v);v=f.pool.acquire(v,
y,B,x||{highlights:null,occludees:null,visible:!0},C,z);this._geometryRecords.push(v);this._hasVolatileTransformation=this._geometryRecords.some(A=>!!A.shaderTransformation);this._notifyDirty("objGeometryAdded",v);this._invalidateBoundingVolume();return v};u.removeGeometry=function(v){const y=this._geometryRecords.splice(v,1)[0];f.pool.release(y);this._hasVolatileTransformation=this._geometryRecords.some(B=>!!B.shaderTransformation);this._geometries.splice(v,1);this._notifyDirty("objGeometryRemoved",
y);this._invalidateBoundingVolume();return y};u.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};u.geometryVertexAttrsUpdated=function(v){this._notifyDirty("vertexAttrsUpdated",this._geometryRecords[v]);this._invalidateBoundingVolume()};u.setVisible=function(v){this._visible=v;for(const y of this._geometryRecords)y.instanceParameters.visible=this._visible;this._notifyDirty("visibilityChanged")};u.maskOccludee=function(){const v=g.generateObject3DStateId(1);
for(const y of this._geometryRecords)y.instanceParameters.occludees=p.addObject3DStateID(y.instanceParameters.occludees,v);this._notifyDirty("occlusionChanged");return v};u.removeOcclude=function(v){for(const y of this._geometryRecords)y.instanceParameters.occludees=p.removeObject3DStateID(y.instanceParameters.occludees,v);this._notifyDirty("occlusionChanged")};u.highlight=function(){const v=g.generateObject3DStateId(0);for(const y of this._geometryRecords)y.instanceParameters.highlights=p.addObject3DStateID(y.instanceParameters.highlights,
v);this._notifyDirty("highlightChanged");return v};u.removeHighlight=function(v){for(const y of this._geometryRecords)y.instanceParameters.highlights=p.removeObject3DStateID(y.instanceParameters.highlights,v);this._notifyDirty("highlightChanged")};u.getCombinedStaticTransformation=function(v,y){return h.multiply(k.unwrapOr(y,d.create()),this.objectTransformation,v.getStaticTransformation())};u.getCombinedShaderTransformation=function(v,y){y=y||d.create();h.multiply(y,this.objectTransformation,v.getShaderTransformation());
return y};u.hasVolativeTransformation=function(){return this._hasVolatileTransformation};u.getBBMin=function(v){this._validateBoundingVolume();return v?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};u.getBBMax=function(v){this._validateBoundingVolume();return v?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};u.getCenter=function(v){this._validateBoundingVolume();return v?this._bvObjectSpace.center:this._bvWorldSpace.center};u.getBSRadius=function(v){this._validateBoundingVolume();return v?
this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};u._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var v=0;v<this._geometryRecords.length;++v){var y=this._geometryRecords[v],B=this._geometries[v].boundingInfo;this._calculateTransformedBoundingVolume(B,this._bvObjectSpace,y.getShaderTransformation());this._calculateTransformedBoundingVolume(B,this._bvWorldSpace,this.getCombinedShaderTransformation(y))}r.lerp(this._bvObjectSpace.center,
this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,.5);r.lerp(this._bvWorldSpace.center,this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5);v=a.create();y=a.create();B=l.maxScale(this.objectTransformation);for(let A=0;A<this._geometryRecords.length;++A){var x=this._geometries[A],C=this._geometryRecords[A].getShaderTransformation(),z=l.maxScale(C);x=x.boundingInfo;r.transformMat4(v,x.getCenter(),C);C=r.distance(v,this._bvObjectSpace.center);z*=x.getBSRadius();this._bvObjectSpace.bsRadius=Math.max(this._bvObjectSpace.bsRadius,
C+z);r.transformMat4(y,v,this.objectTransformation);C=r.distance(y,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,C+z*B)}this._bvDirty=!1}};u._calculateTransformedBoundingVolume=function(v,y,B){const x=v.getBBMin();v=v.getBBMax();const C=a.clone(x),z=a.clone(v);r.transformMat4(C,C,B);r.transformMat4(z,z,B);for(var A=0;3>A;++A)y.bbMin[A]=Math.min(y.bbMin[A],C[A],z[A]),y.bbMax[A]=Math.max(y.bbMax[A],C[A],z[A]);for(A=0;3>A;++A){r.copy(C,x);r.copy(z,v);C[A]=
v[A];z[A]=x[A];r.transformMat4(C,C,B);r.transformMat4(z,z,B);for(let t=0;3>t;++t)y.bbMin[t]=Math.min(y.bbMin[t],C[t],z[t]),y.bbMax[t]=Math.max(y.bbMax[t],C[t],z[t])}};u._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};u._notifyDirty=function(v,y,B,x){this._parentLayer&&this._parentLayer.notifyDirty(v,y,B||1,x||this)};b._createClass(m,[{key:"geometryRecords",
get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"objectTransformation",get:function(){return this._objectTransformation},set:function(v){h.copy(this._objectTransformation,v);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(v){c.assert(null==this._parentLayer||null==v,"Object3D can only be added to a single Layer");this._parentLayer=v}},{key:"isVisible",
get:function(){return this._visible}},{key:"test",get:function(){const v=this;return{hasGeometry:y=>-1<v._geometries.indexOf(y),getGeometryIndex:y=>v._geometries.indexOf(y)}}}]);return m}();n._idGen=new e.IdGen;let w=function(){function m(){this.bbMin=a.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.bbMax=a.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}m.prototype.isEmpty=function(){return this.bbMax[0]<this.bbMin[0]&&this.bbMax[1]<this.bbMin[1]&&this.bbMax[2]<
this.bbMin[2]};return m}(),q=function(m){function u(){var y=m.call(this)||this;y.center=a.create();y.bsRadius=0;return y}b._inheritsLoose(u,m);var v=u.prototype;v.init=function(){r.set(this.bbMin,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);r.set(this.bbMax,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);r.set(this.center,0,0,0);this.bsRadius=0};v.getCenter=function(){return this.center};v.getBSRadius=function(){return this.bsRadius};return u}(w);return n})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["exports"],
function(b){let k=function(){function a(){this._count=0}a.prototype.gen=function(r){null==r&&(r="a");return r+"_"+this._count++};return a}();b.IdGen=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["../../../../core/ObjectPool","../../../../chunks/vec3","./IdGen"],function(b,k,a){let r=function(){function l(){}var h=l.prototype;h.acquire=function(d,c,e,f,g,p){this.id=l._idGen.gen(d&&d.id);this.geometry=d;this.material=c;this.transformation=
e;this.instanceParameters=f;this.origin=g;this.shaderTransformation=p};h.getStaticTransformation=function(){return this.transformation};h.getShaderTransformation=function(){return this.shaderTransformation?this.shaderTransformation(this.transformation):this.transformation};h.computeAttachmentOrigin=function(d){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,d):this.geometry.computeAttachmentOrigin(d))?(k.transformMat4(d,d,this.getStaticTransformation()),
!0):!1};return l}();r._idGen=new a.IdGen;r.pool=new b(r);return r})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports","./IdGen"],function(b,k){const a=new k.IdGen;k=function(){function r(){this.items=[]}var l=r.prototype;l.addObject=function(h,d){this.items.push({type:0,objectStateId:d,object:h})};l.addRenderGeometry=function(h,d,c){this.items.push({type:1,objectStateId:d,renderGeometry:h,owner:c})};l.addExternal=function(h,d){this.items.push({type:2,objectStateId:d,
remove:h})};l.remove=function(h){for(let d=this.items.length-1;0<=d;--d){const c=this.items[d];c.objectStateId===h&&(this._removeObjectStateItem(c),this.items.splice(d,1))}};l.removeObject=function(h){for(let d=this.items.length-1;0<=d;--d){const c=this.items[d];0===c.type&&c.object===h&&(this._removeObjectStateItem(c),this.items.splice(d,1))}};l.removeRenderGeometry=function(h){for(let d=this.items.length-1;0<=d;--d){const c=this.items[d];1===c.type&&c.renderGeometry===h&&(this._removeObjectStateItem(c),
this.items.splice(d,1))}};l.removeAll=function(){this.items.forEach(h=>{this._removeObjectStateItem(h)});this.items=[]};l._removeObjectStateItem=function(h){switch(h.type){case 0:0===h.objectStateId.channel?h.object.removeHighlight(h.objectStateId):1===h.objectStateId.channel&&h.object.removeOcclude(h.objectStateId);break;case 1:h.owner.removeRenderGeometryObjectState(h.renderGeometry,h.objectStateId);break;case 2:h.remove(h.objectStateId)}};return r}();b.Object3DStateSet=k;b.generateObject3DStateId=
function(r){return{id:a.gen(0===r?"highlight":"occludee"),channel:r}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../lib/Util ../../lib/doublePrecisionUtils".split(" "),function(b,k,a,r,l,h){const d=new Float64Array(3),c=new Float32Array(6),e=r.create();b.acquireMaterials=function(f,g){const p=new Map;p.set(0,g.acquire(f,0));
p.set(1,g.acquire(f,7));p.set(4,g.acquire(f,3));p.set(3,g.acquire(f,2));p.set(2,g.acquire(f,1));p.set(5,g.acquire(f,4));return p};b.addObject3DStateID=function(f,g){k.isNone(f)&&(f=[]);f.push(g);return f};b.calculateTransformRelToOrigin=function(f,g,p){const n=f.origin.vec3;l.setMatrixTranslation3(e,-n[0],-n[1],-n[2]);k.isSome(f.transformation)?a.multiply(g,e,f.transformation):a.copy(g,e);p&&(a.invert(p,g),a.transpose(p,p))};b.encodeDoubleVec3=function(f,g,p,n,w){d[0]=f.get(g,0);d[1]=f.get(g,1);d[2]=
f.get(g,2);h.encodeDoubleArray(d,c,3);p.set(w,0,c[0]);n.set(w,0,c[1]);p.set(w,1,c[2]);n.set(w,1,c[3]);p.set(w,2,c[4]);n.set(w,2,c[5])};b.isInstanceHidden=function(f){return k.isSome(f)?!f.visible:!1};b.releaseMaterials=function(f,g){g.release(f,0);g.release(f,7);g.release(f,3);g.release(f,2);g.release(f,1);g.release(f,4)};b.removeObject3DStateID=function(f,g){if(k.isNone(f))return f;f=f.filter(p=>p!==g);return 0===f.length?null:f};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["exports"],
function(b){function k(l,h,d){for(let c=0;c<d;++c)h[2*c]=l[c],h[2*c+1]=l[c]-h[2*c]}const a=new Float64Array(1),r=new Float32Array(2);b.decodeDoubleArray=function(l,h,d){for(let c=0;c<d;++c)h[c]=l[2*c]+l[2*c+1]};b.encodeDouble=function(l,h){r[0]=l;r[1]=l-r[0];h[0]=r[0];h[1]=r[1]};b.encodeDoubleArray=k;b.encodeDoubleArraySplit=function(l,h,d,c){for(let e=0;e<c;++e)a[0]=l[e],k(a,r,1),h[e]=r[0],d[e]=r[1]};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4f64 ../../support/geometryUtils ../materials/renderers/utils ./intersectorUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f){a=function(){function g(n){this.options=new f.IntersectorOptions;this.results=new f.IntersectorResults;this.transform=new f.IntersectorTransform;this.performanceInfo={queryDuration:0,numObjectsTested:0};this.tolerance=1E-5;this.verticalOffset=null;this._ray={origin:l.create(),direction:l.create()};this._rayEndPoint=l.create();this._rayStartPointTransformed=l.create();this._rayEndPointTransformed=l.create();this.viewingMode=null==n?1:n}var p=g.prototype;p.reset=function(n,
w){this.resetWithRay(c.ray.fromPoints(n,w,this._ray))};p.resetWithRay=function(n){n!==this._ray&&c.ray.copy(n,this._ray);0!==this.options.verticalOffset?2===this.viewingMode?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;h.add(this._rayEndPoint,this._ray.origin,this._ray.direction);this._numObjectsTested=0;this.results.init(this._ray)};p.intersect=function(n,w,q,m,u,v){this.point=w;this.camera=q;this.filterPredicate=u;this.tolerance=
null==m?1E-5:m;w=f.getVerticalOffsetObject3D(this.verticalOffset);q=v?y=>{v(y)&&this.intersectObject(y)}:y=>{this.intersectObject(y)};if(n&&0<n.length)for(const y of n)if(n=y.getSpatialQueryAccelerator&&y.getSpatialQueryAccelerator())r.isSome(w)?n.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,q,w):n.forEachAlongRay(this._ray.origin,this._ray.direction,q),this.options.selectionMode&&this.options.hud&&n.forEachDegenerateObject(q);else{n=y.getObjects();for(const B of n)q(B)}this.sortResults()};
p.intersectObject=function(n){this._numObjectsTested++;const w=n.geometryRecords;if(w){var q=n.id,m=n.objectTransformation,u=f.getVerticalOffsetObject3D(this.verticalOffset);for(const y of w){const {geometry:B,material:x,instanceParameters:C}=y;if(e.isInstanceHidden(C))continue;var v=B.id;this.transform.setAndInvalidateLazyTransforms(m,y.getShaderTransformation());h.transformMat4(this._rayStartPointTransformed,this._ray.origin,this.transform.inverse);h.transformMat4(this._rayEndPointTransformed,this._rayEndPoint,
this.transform.inverse);const z=this.transform.transform;r.isSome(u)&&(u.objectTransform=this.transform);x.intersect(B,C,this.transform.transform,this,this._rayStartPointTransformed,this._rayEndPointTransformed,(A,t,D,E,G,H)=>{0<=A&&(!r.isSome(this.filterPredicate)||this.filterPredicate(this._ray.origin,this._rayEndPoint,A))&&(G?(null==this.results.hud.dist||A<this.results.hud.dist)&&this.results.hud.set(n,q,A,t,d.IDENTITY,E,H,v,D):((null==this.results.min.drapedLayerOrder||E>=this.results.min.drapedLayerOrder)&&
(null==this.results.min.dist||A<this.results.min.dist)&&this.results.min.set(n,q,A,t,z,E,null,v,D),0!==this.options.store&&(null==this.results.max.drapedLayerOrder||E<this.results.max.drapedLayerOrder)&&(null==this.results.max.dist||A>this.results.max.dist)&&this.results.max.set(n,q,A,t,z,E,null,v,D),2===this.options.store&&(G=new f.IntersectorResult(this._ray),G.set(n,q,A,t,z,E,null,v,D),this.results.all.push(G))))},y.shaderTransformation)}}};p.sortResults=function(){this.results.all.sort((n,w)=>
n.dist!==w.dist?n.dist-w.dist:n.drapedLayerOrder!==w.drapedLayerOrder?(void 0!==n.drapedLayerOrder?n.drapedLayerOrder:Number.MAX_VALUE)-(void 0!==w.drapedLayerOrder?w.drapedLayerOrder:Number.MAX_VALUE):(void 0!==w.drapedLayerGraphicOrder?w.drapedLayerGraphicOrder:Number.MIN_VALUE)-(void 0!==n.drapedLayerGraphicOrder?n.drapedLayerGraphicOrder:Number.MIN_VALUE))};k._createClass(g,[{key:"ray",get:function(){return this._ray}},{key:"rayBeginPoint",get:function(){return this._ray.origin}},{key:"rayEndPoint",
get:function(){return this._rayEndPoint}}]);return g}();a.DEFAULT_TOLERANCE=1E-5;b.Intersector=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../input/InputManager ../../input/BrowserEventSource ../../input/handlers/PreventContextMenu ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/recognizers/VerticalTwoFingerDrag".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L){a=function(M){function T(){var Q=M.apply(this,arguments)||this;Q._handles=new n;return Q}b._inheritsLoose(T,M);var O=T.prototype;O.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};O.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};O.connect=
function(){const Q=this.view;this._source=new m.BrowserEventSource(this.view.surface,Q.input);var F=[new B.ImmediateDoubleClick,new x.PointerClickHoldAndDrag,new v.SingleAndDoubleClick,new y.Drag(this.view.navigation),new L.VerticalTwoFingerDrag];this._inputManager=F=new q.InputManager({eventSource:this._source,recognizers:F});F.installHandlers("prevent-context-menu",[new u.PreventContextMenu],q.ViewEventPriorities.INTERNAL);this._modeDragPan=new G.PinchAndPanNavigation(Q,"primary");this._modeDragRotate=
new z.DragRotate(Q,"secondary","center");this._modeDragZoom=new A.DragZoom(Q,"tertiary");F.installHandlers("navigation",[new H.PointerDownCancelAnimation(Q),new C.DoubleClickZoom(Q),new t.GamepadNavigation(Q),new D.KeyboardNavigation(Q,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new E.MouseWheelZoom(Q),new J.SingleKeyResetTilt(Q,"p"),new I.SingleKeyResetHeading(Q,"n"),
new z.DragRotate(Q,"primary","eye",["b"]),new z.DragRotate(Q,"secondary","center",["b"]),new G.PinchAndPanNavigation(Q,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new K.TwoFingerTilt(Q)],q.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(F);this._updateMode();w.init(this.view.navigation,"browserTouchPanEnabled",N=>{this._source.browserTouchPanningEnabled=!N})};O._updateMode=function(){var Q=this.primaryDragAction;Q=S.get(this.mode).get(Q);this._modeDragPan&&
(this._modeDragPan.pointerAction=Q.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=Q.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=Q.zoom)};b._createClass(T,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(Q){"pan"!==Q&&"rotate"!==Q||Q===this._get("primaryDragAction")||(this._set("primaryDragAction",Q),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},set:function(Q){"default"!==Q&&"pro"!==Q||Q===this._get("mode")||
(this._set("mode",Q),this._updateMode())}},{key:"test",get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}}]);return T}(p);k.__decorate([h.property()],a.prototype,"view",void 0);k.__decorate([h.property({value:"pan"})],a.prototype,"primaryDragAction",null);k.__decorate([h.property({value:"default"})],a.prototype,"mode",null);k.__decorate([h.property({readOnly:!0,aliasOf:"_inputManager.hasPendingInputs"})],
a.prototype,"hasPendingInputs",void 0);k.__decorate([h.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],a.prototype,"latestPointerType",void 0);k.__decorate([h.property()],a.prototype,"_inputManager",void 0);a=k.__decorate([c.subclass("esri.views.3d.input.SceneInputManager")],a);const S=new Map;k=new Map;h=new Map;k.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});k.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});h.set("pan",{pan:"primary",rotate:"tertiary",
zoom:"secondary"});h.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});S.set("default",k);S.set("pro",h);return a})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ./keys ../support/screenUtils ./gamepad/GamepadSource".split(" "),function(b,k,a,r,l,h){const d=a("trident"),c=a("edge"),e=a("chrome"),f=a("ff"),g=a("safari");a=function(){function n(q,m){this.input=m;this._active={};this._activePointerCaptures=new Set;
this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=q;q.getAttribute("tabindex")||q.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,
"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new h.GamepadSource(q,this.input);this._gamepadSource.onEvent=u=>this._callback("gamepad",u)}var w=n.prototype;w.destroy=function(){this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(q=>{this._releasePointerCaptureSafe(q)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=
null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};w.setPointerCapture=function(q,m){m?(this._element.setPointerCapture(q.pointerId),this._activePointerCaptures.add(q.pointerId)):(this._releasePointerCaptureSafe(q.pointerId),this._activePointerCaptures.delete(q.pointerId))};w._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?
"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};w._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};w._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};
w._releasePointerCaptureSafe=function(q){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(q)||this._element.releasePointerCapture(q)}catch(m){}};w._updateNormalizedPointerLikeEvent=function(q,m){q=l.createScreenPointFromNativeEvent(this._element,q);n.test.disableSubpixelCoordinates&&(q.x=Math.round(q.x),q.y=Math.round(q.y));m.x=q.x;m.y=q.y;return m};w._handleKey=function(q,m){const u=r.eventKey(m);u&&"key-up"===q&&this._keyDownState.delete(u);m={native:m,key:u,repeat:u&&this._keyDownState.has(u)};
u&&"key-down"===q&&this._keyDownState.add(m.key);this._callback(q,m)};w._handlePointer=function(q,m){m=this._updateNormalizedPointerLikeEvent(m,{native:m,x:0,y:0,pointerType:m.pointerType,button:m.button,buttons:m.buttons,eventId:this._eventId++});this._callback(q,m)};w._handlePointerPreventDefault=function(q,m){const u=this._updateNormalizedPointerLikeEvent(m,{native:m,x:0,y:0,pointerType:m.pointerType,button:m.button,buttons:m.buttons,eventId:this._eventId++});m.preventDefault();this._callback(q,
u)};w._handleMouseWheel=function(q,m){let u=m.deltaY;switch(m.deltaMode){case 0:if(d||c)u=u/document.documentElement.clientHeight*600;break;case 1:u*=30;break;case 2:u*=900}d||c?u*=.7:e||g?u*=.6:f&&(u*=1.375);const v=Math.abs(u);100<v&&(u=u/v*200/(1+Math.exp(-.02*(v-100))));m=this._updateNormalizedPointerLikeEvent(m,{native:m,x:0,y:0,deltaY:u});this._callback(q,m)};w._handlePointerCaptureLost=function(q,m){this._activePointerCaptures.delete(m.pointerId);this._handleDefault(q,m)};w._handleDefault=
function(q,m){const u={native:m};m.preventDefault();this._callback(q,u)};w._preventAltKeyDefault=function(q){"Alt"===q.key&&q.preventDefault()};w._preventMultiTouchPanning=function(q){1<q.touches.length&&q.preventDefault()};k._createClass(n,[{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(q){this._browserTouchPanningEnabled=q;this._updateTouchAction();this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(q){this._callback=q}},
{key:"activeEvents",set:function(q){for(const m in this._active)q&&q.has(m)||(this._element.removeEventListener(p[m],this._active[m]),delete this._active[m]);q&&q.forEach(m=>{if(!this._active[m]&&p[m]){const u=(this._eventHandlers[m]||this._handleDefault).bind(this,m);this._element.addEventListener(p[m],u);this._active[m]=u}});this._gamepadSource.hasEventListeners=q&&q.has("gamepad")}}]);return n}();a.test={disableSubpixelCoordinates:!1};const p={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown",
"pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};b.BrowserEventSource=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(b,k,a,r,l){let h=function(){function d(e,f){this.element=e;this.input=f;this._hasEventListeners=!1;this.onConnectGamepad=g=>{this.connectGamepad(g.gamepad)};this.onDisconnectGamepad=g=>{g=g.gamepad;const p=g.index,n=this.inputDevices[p];n&&(this.emitGamepadEvent(g,l.extractState(n),!1),this.inputDevices.splice(p,1),this.latestUpdate.splice(p,1),this.input.gamepad.devices.remove(n),this.ensurePollingState())};this.frameTask=
null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(this.connectGamepad),window.addEventListener("gamepadconnected",this.onConnectGamepad),window.addEventListener("gamepaddisconnected",this.onDisconnectGamepad),this.ensurePollingState()}var c=d.prototype;c.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.onConnectGamepad),window.removeEventListener("gamepaddisconnected",
this.onDisconnectGamepad))};c.connectGamepad=function(e){const f=new r(e);"unknown"!==f.deviceType&&(this.inputDevices[e.index]=f,this.input.gamepad.devices.add(f));this.ensurePollingState()};c.ensurePollingState=function(){this.eventsEnabled?this.startPolling():this.stopPolling()};c.startPolling=function(){null==this.frameTask&&(this.frameTask=a.addFrameTask({update:()=>this.readGamepadState()}))};c.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=
[])};c.readGamepadState=function(){const e=document.hasFocus(),f=this.element.contains(document.activeElement),g="document"===this.input.gamepad.enabledFocusMode&&!e||"view"===this.input.gamepad.enabledFocusMode&&!f;this.forEachGamepad(p=>{var n=this.inputDevices[p.index];if(n){var w=this.latestUpdate[p.index];n=l.extractState(n);var q=g||l.stateIdle(n);w&&(w.timestamp===p.timestamp||!w.active&&q||l.stateEqual(w.state,n))||this.emitGamepadEvent(p,n,!q)}})};c.forEachGamepad=function(e){const f=window.navigator.getGamepads();
for(let g=0;g<f.length;g++){const p=f[g];this.validate(p)&&e(p)}};c.emitGamepadEvent=function(e,f,g){var p=this.latestUpdate[e.index];if((p=p&&p.active)||g)this.latestUpdate[e.index]={timestamp:e.timestamp,state:f,active:g},this.callback&&this.callback({device:this.inputDevices[e.index],state:f,action:!p&&g?"start":p&&g?"update":"end"})};c.validate=function(e){if(!e||!e.connected)return!1;for(let f=0;f<e.axes.length;f++)if(isNaN(e.axes[f]))return!1;return!0};k._createClass(d,[{key:"hasEventListeners",
set:function(e){this._hasEventListeners!==e&&(this._hasEventListeners=e,this.ensurePollingState())}},{key:"eventsEnabled",get:function(){return this.supported&&0<this.inputDevices.length&&this._hasEventListeners}},{key:"onEvent",set:function(e){this.callback=e}}]);return d}();b.GamepadSource=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports","../../../core/mathUtils"],function(b,k){b.extractState=function(a){const r=a.native;
return r?{buttons:r.buttons.map(l=>l.pressed?l.value?l.value:1:0),axes:r.axes.map(l=>{{var h=a.axisThreshold;const d=Math.abs(l);l=d<h?0:k.sign(l)*(d-h)/(1-h)}return l})}:{buttons:[],axes:[]}};b.stateEqual=function(a,r){if(a.axes.length!==r.axes.length||a.buttons.length!==r.buttons.length)return!1;for(var l=0;l<a.axes.length;l++)if(a.axes[l]!==r.axes[l])return!1;for(l=0;l<a.buttons.length;l++)if(a.buttons[l]!==r.buttons[l])return!1;return!0};b.stateIdle=function(a){for(var r=0;r<a.axes.length;r++)if(0!==
a.axes[r])return!1;for(r=0;r<a.buttons.length;r++)if(0!==a.buttons[r])return!1;return!0};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../InputHandler"],function(b,k,a){a=function(r){function l(){var h=r.call(this,!0)||this;h.registerIncoming("context-menu",d=>{d.data.native.preventDefault()});return h}k._inheritsLoose(l,r);return l}(a.InputHandler);b.PreventContextMenu=a;
b.default=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../InputHandler ./support".split(" "),function(b,k,a,r,l,h){const d={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};l=function(c){function e(g=d.maximumDoubleClickDelay,p=d.maximumDoubleClickDistance,n=d.maximumDoubleTouchDelay,
w=d.maximumDoubleTouchDistance,q=a["default"]){var m=c.call(this,!1)||this;m.maximumDoubleClickDelay=g;m.maximumDoubleClickDistance=p;m.maximumDoubleTouchDelay=n;m.maximumDoubleTouchDistance=w;m._clock=q;m._pointerState=new Map;m._click=m.registerOutgoing("click");m._doubleClick=m.registerOutgoing("double-click");m.registerIncoming("immediate-click",m._handleImmediateClick.bind(k._assertThisInitialized(m)));m.registerIncoming("pointer-drag",m._handlePointerDrag.bind(k._assertThisInitialized(m)));
m.registerIncoming("drag",m._handleDrag.bind(k._assertThisInitialized(m)));return m}k._inheritsLoose(e,c);var f=e.prototype;f.onUninstall=function(){this._pointerState.forEach(g=>{null!=g.doubleClickTimeout&&(g.doubleClickTimeout.remove(),g.doubleClickTimeout=null)})};f._pointerId=function(g){g=g.native;return"mouse"===g.pointerType?`${g.pointerId}:${g.button}`:`${g.pointerType}`};f._handleImmediateClick=function(g){const p=g.data,n=this._pointerId(p),w=this._pointerState.get(n);if(w){const q="touch"===
p.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;h.manhattanDistance(w.event.data,p)>q?(this._clearDoubleClickTimeout(n,!0),this._startClick(g)):(this._clearDoubleClickTimeout(n,!1),this._doubleClick.emit(w.event.data,void 0,w.event.modifiers))}else this._startClick(g)};f._startClick=function(g){const p=this._pointerId(g.data);this._pointerState.set(p,{event:g,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(p),"touch"===g.data.native.pointerType?
this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};f._handlePointerDrag=function(g){g=this._pointerId(g.data.currentEvent);this._clearDoubleClickTimeout(g,!0)};f._handleDrag=function(g){g=this._pointerId(g.data.pointer);this._clearDoubleClickTimeout(g,!0)};f._clearDoubleClickTimeout=function(g,p){const n=this._pointerState.get(g);n&&(n.doubleClickTimeout.remove(),n.doubleClickTimeout=null,p&&this._doubleClickTimeoutExceeded(g),this._pointerState.delete(g),
this.refreshHasPendingInputs())};f._doubleClickTimeoutExceeded=function(g){const p=this._pointerState.get(g);this._click.emit(p.event.data,void 0,p.event.modifiers);p.doubleClickTimeout=null;this._pointerState.delete(g);this.refreshHasPendingInputs()};k._createClass(e,[{key:"hasPendingInputs",get:function(){return r.someMap(this._pointerState,g=>null!=g.doubleClickTimeout)}}]);return e}(l.InputHandler);b.DefaultParameters=d;b.SingleAndDoubleClick=l;Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(b,k){b.euclideanDistance=function(a,r){const l=r.x-a.x;a=r.y-a.y;return Math.sqrt(l*l+a*a)};b.fitCircleLSQ=function(a,r){r?(r.radius=0,r.center.x=0,r.center.y=0):r={radius:0,center:k.createScreenPoint()};if(0===a.length)return r;if(1===a.length)return r.center.x=a[0].x,r.center.y=a[0].y,r;if(2===a.length){const [m,u]=a,[v,y]=[u.x-m.x,u.y-m.y];r.radius=Math.sqrt(v*v+y*y)/2;r.center.x=(m.x+u.x)/
2;r.center.y=(m.y+u.y)/2;return r}let l=0,h=0;for(r=0;r<a.length;r++)l+=a[r].x,h+=a[r].y;l/=a.length;h/=a.length;var d=a.map(m=>m.x-l),c=a.map(m=>m.y-h);let e=r=0;var f=0,g=0,p=0,n=0,w=0;for(var q=0;q<d.length;q++){const m=d[q],u=c[q],v=m*m,y=u*u;r+=v;e+=y;f+=m*u;g+=v*m;p+=y*u;n+=m*y;w+=u*v}d=r;c=f;q=e;g=.5*(g+n);p=.5*(p+w);w=d*q-f*c;n=(g*q-p*c)/w;p=(d*p-f*g)/w;w=k.createScreenPoint(n+l,p+h);return{radius:Math.sqrt(n*n+p*p+(r+e)/a.length),center:w}};b.manhattanDistance=function(a,r){return Math.abs(r.x-
a.x)+Math.abs(r.y-a.y)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../layers/support/timeUtils ../InputHandler ./support".split(" "),function(b,k,a,r,l,h){function d(g){const p=[];g.forEach(n=>{p.push(a.createScreenPoint(n.event.x,n.event.y))});return h.fitCircleLSQ(p)}function c(g){const p=d(g);let n=0;g.forEach(w=>{var q=f(w,p);for(q-=w.lastAngle;q>Math.PI;)q-=
2*Math.PI;for(;q<-Math.PI;)q+=2*Math.PI;q=w.lastAngle+q;w.lastAngle=q;n+=q-w.initialAngle});n/=g.size||1;return{angle:n,radius:p.radius,center:p.center}}function e(g){const p=new Map;g.forEach((n,w)=>p.set(w,n.event));return p}function f(g,p){g=g.event;return Math.atan2(g.y-p.center.y,g.x-p.center.x)}l=function(g){function p(w){var q=g.call(this,!1)||this;q.navigationTouch=w;q.startStateModifiers=new Set;q.activePointerMap=new Map;q.isDragging=!1;q.isCurrentDragSuppressed=!1;q.drag=q.registerOutgoing("drag");
q.registerIncoming("pointer-drag",q.handlePointerDrag.bind(k._assertThisInitialized(q)));q.registerIncoming("pointer-up",q.handlePointerUpAndPointerLost.bind(k._assertThisInitialized(q)));q.registerIncoming("pointer-capture-lost",q.handlePointerUpAndPointerLost.bind(k._assertThisInitialized(q)));q.registerIncoming("pointer-cancel",q.handlePointerUpAndPointerLost.bind(k._assertThisInitialized(q)));return q}k._inheritsLoose(p,g);var n=p.prototype;n.createPayload=function(w,q,m,u){return{action:w,pointerType:this.pointerType,
button:this.mouseButton,buttons:q.buttons,timestamp:u,pointers:e(this.activePointerMap),pointer:q,angle:m.angle,radius:m.radius,center:m.center}};n.addPointer=function(w){var q=w.native.pointerId;const m=c(this.activePointerMap).angle;w={event:w,initialAngle:0,lastAngle:0};this.activePointerMap.set(q,w);q=f(w,d(this.activePointerMap));w.initialAngle=q;w.lastAngle=q;this.updatePointerAngles(m)};n.updatePointer=function(w){if(!w||null!=w.x||null!=w.y){var q=this.activePointerMap.get(w.native.pointerId);
q?q.event=w:this.addPointer(w)}};n.removePointer=function(w){const q=c(this.activePointerMap).angle;this.activePointerMap.delete(w);this.updatePointerAngles(q)};n.updatePointerAngles=function(w){const q=c(this.activePointerMap);this.activePointerMap.forEach(m=>{m.initialAngle=f(m,q)-w;m.lastAngle=f(m,q)-w})};n.emitEvent=function(w,q,m){const u=c(this.activePointerMap);this.drag.emit(this.createPayload(w,q,u,m),void 0,this.startStateModifiers)};n.handlePointerUpAndPointerLost=function(w){const q=w.data.native.pointerId,
m=r.Milliseconds(w.timestamp);this.activePointerMap.get(q)&&(1===this.activePointerMap.size?(this.updatePointer(w.data),!this.isCurrentDragSuppressed&&this.emitEvent("end",w.data,m),this.isCurrentDragSuppressed=this.isDragging=!1,this.removePointer(q)):(this.removePointer(q),this.emitEvent("removed",w.data,r.Milliseconds(w.timestamp))))};n.handlePointerDrag=function(w){const q=w.data,m=q.currentEvent,u=r.Milliseconds(w.timestamp);switch(q.action){case "start":case "update":this.isDragging?this.activePointerMap.has(m.native.pointerId)?
(this.updatePointer(m),!this.isCurrentDragSuppressed&&this.emitEvent("update",m,u)):(this.addPointer(m),this.emitEvent("added",m,u),this.isCurrentDragSuppressed=this.isSuppressed):(this.updatePointer(m),this.pointerType=w.data.startEvent.pointerType,this.mouseButton=w.data.startEvent.button,this.startStateModifiers=w.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this.emitEvent("start",m,u))}};k._createClass(p,[{key:"isSuppressed",get:function(){return this.navigationTouch&&
!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}]);return p}(l.InputHandler);(function(g){g[g.Left=0]="Left";g[g.Middle=1]="Middle";g[g.Right=2]="Right";g[g.Back=3]="Back";g[g.Forward=4]="Forward";g[g.Undefined=-1]="Undefined"})(b.Button||(b.Button={}));b.Drag=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./support ./SingleAndDoubleClick".split(" "),
function(b,k,a,r,l,h){r=function(d){function c(f=h.DefaultParameters.maximumDoubleClickDelay,g=h.DefaultParameters.maximumDoubleClickDistance,p=h.DefaultParameters.maximumDoubleTouchDelay,n=h.DefaultParameters.maximumDoubleTouchDistance,w=a["default"]){var q=d.call(this,!1)||this;q.maximumDoubleClickDelay=f;q.maximumDoubleClickDistance=g;q.maximumDoubleTouchDelay=p;q.maximumDoubleTouchDistance=n;q._clock=w;q._pointerState=new Map;q._immediateDoubleClick=q.registerOutgoing("immediate-double-click");
q.registerIncoming("pointer-down",q._handlePointerDown.bind(k._assertThisInitialized(q)));q.registerIncoming("pointer-up",m=>{q._handlePointerLoss(m,"pointer-up")});q.registerIncoming("pointer-capture-lost",m=>{q._handlePointerLoss(m,"pointer-capture-lost")});q.registerIncoming("pointer-cancel",m=>{q._handlePointerLoss(m,"pointer-cancel")});return q}k._inheritsLoose(c,d);var e=c.prototype;e.onUninstall=function(){this._pointerState.forEach(f=>{f.immediateDoubleClick&&f.immediateDoubleClick.timeoutHandle.remove()});
d.prototype.onUninstall.call(this)};e._handlePointerDown=function(f){f=f.data;const g=this._pointerId(f);this._pointerState.has(g)||(this._pointerState.set(g,{downButton:f.native.button,immediateDoubleClick:null}),this.startCapturingPointer(f.native))};e._handlePointerLoss=function(f,g){const p=f.data;var n=this._pointerId(p);if((n=this._pointerState.get(n))&&"pointer-up"===g&&n.downButton===p.native.button)if(g=n.immediateDoubleClick){g.timeoutHandle.remove();const w="touch"===f.data.native.pointerType?
this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;l.manhattanDistance(g,f.data)>w?this._startImmediateDoubleClick(f,n):(this._immediateDoubleClick.emit(f.data,void 0,g.modifiers),this._removeState(p))}else this._startImmediateDoubleClick(f,n)};e._startImmediateDoubleClick=function(f,g){g.immediateDoubleClick={x:f.data.x,y:f.data.y,modifiers:f.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(f.data),"touch"===f.data.native.pointerType?this.maximumDoubleTouchDelay:
this.maximumDoubleClickDelay)}};e._pointerId=function(f){f=f.native;return"mouse"===f.pointerType?`${f.pointerId}:${f.button}`:`${f.pointerType}`};e._removeState=function(f){const g=this._pointerId(f);this._pointerState.delete(g);this.stopCapturingPointer(f.native);this.refreshHasPendingInputs()};return c}(r.InputHandler);b.ImmediateDoubleClick=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/clock","../InputHandler","./support"],function(b,k,a,r,l){const h={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};r=function(d){function c(f=h.maximumClickDelay,g=h.movementUntilMouseDrag,p=h.movementUntilPenDrag,n=h.movementUntilTouchDrag,w=h.holdDelay,q=a["default"]){var m=d.call(this,!1)||this;m.maximumClickDelay=f;m.movementUntilMouseDrag=g;m.movementUntilPenDrag=p;m.movementUntilTouchDrag=n;m.holdDelay=w;m._clock=
q;m._pointerState=new Map;m._pointerDrag=m.registerOutgoing("pointer-drag");m._immediateClick=m.registerOutgoing("immediate-click");m._pointerHold=m.registerOutgoing("hold");m.registerIncoming("pointer-down",m._handlePointerDown.bind(k._assertThisInitialized(m)));m.registerIncoming("pointer-up",u=>{m._handlePointerLoss(u,"pointer-up")});m.registerIncoming("pointer-capture-lost",u=>{m._handlePointerLoss(u,"pointer-capture-lost")});m.registerIncoming("pointer-cancel",u=>{m._handlePointerLoss(u,"pointer-cancel")});
m._moveHandle=m.registerIncoming("pointer-move",m._handlePointerMove.bind(k._assertThisInitialized(m)));m._moveHandle.pause();return m}k._inheritsLoose(c,d);var e=c.prototype;e.onUninstall=function(){this._pointerState.forEach(f=>{null!=f.holdTimeout&&(f.holdTimeout.remove(),f.holdTimeout=null)});d.prototype.onUninstall.call(this)};e._handlePointerDown=function(f){const g=f.data,p=g.native.pointerId;var n=null;0===this._pointerState.size&&(n=this._clock.setTimeout(()=>{const w=this._pointerState.get(p);
w&&(w.isDragging||(this._pointerHold.emit(w.previousEvent,void 0,f.modifiers),w.holdEmitted=!0),w.holdTimeout=null)},this.holdDelay));n={startEvent:g,previousEvent:g,startTimestamp:f.timestamp,isDragging:!1,downButton:g.native.button,holdTimeout:n,modifiers:new Set};this._pointerState.set(p,n);this.startCapturingPointer(g.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(f)};e._createPointerDragData=function(f,g,p){return{action:f,startEvent:g.startEvent,previousEvent:g.previousEvent,
currentEvent:p}};e._handlePointerMove=function(f){const g=f.data,p=this._pointerState.get(g.native.pointerId);if(p){if(p.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",p,g),void 0,p.modifiers);else{const n=l.euclideanDistance(g,p.startEvent),w=this._getDragThreshold(g.native.pointerType);n>w&&this.startDragging(f)}p.previousEvent=g}};e._getDragThreshold=function(f){switch(f){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}};
e.startDragging=function(f){const g=f.data,p=g.native.pointerId;this._pointerState.forEach(n=>{null!=n.holdTimeout&&(n.holdTimeout.remove(),n.holdTimeout=null);n.isDragging||(n.modifiers=f.modifiers,n.isDragging=!0,p===n.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",n,g)):this._pointerDrag.emit(this._createPointerDragData("start",n,n.previousEvent),f.timestamp))})};e._handlePointerLoss=function(f,g){const p=f.data,n=p.native.pointerId,w=this._pointerState.get(n);
w&&(null!=w.holdTimeout&&(w.holdTimeout.remove(),w.holdTimeout=null),w.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",w,"pointer-up"===g?p:w.previousEvent),void 0,w.modifiers):"pointer-up"===g&&w.downButton===p.native.button&&f.timestamp-w.startTimestamp<=this.maximumClickDelay&&!w.holdEmitted&&this._immediateClick.emit(p),this._pointerState.delete(n),this.stopCapturingPointer(p.native),0===this._pointerState.size&&this._moveHandle.pause())};return c}(r.InputHandler);b.DefaultParameters=
h;b.PointerClickHoldAndDrag=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../input/InputHandler ../../../input/handlers/support ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController".split(" "),function(b,k,a,r,l,h,d){r=function(c){function e(f,g){var p=c.call(this,!0)||this;p.view=f;p.registerIncoming("double-click",
g,n=>p.handleDoubleClick(n));return p}k._inheritsLoose(e,c);e.prototype.handleDoubleClick=function(f){const g=f.data;if(l.eventMatchesPointerAction(g,"primary")){const p=this.view.state.isGlobal?new h.ZoomStepController({view:this.view,mode:"animation"}):new d.ZoomStepController({view:this.view,mode:"animation"});this.view.state.switchCameraController(p);p.zoomStep(Math.log(.5)/Math.log(.6),a.createScreenPointArray(g.x,g.y));f.stopPropagation()}};return e}(r.InputHandler);b.DoubleClickZoom=r;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/input/handlers/support":function(){define(["exports"],function(b){b.eventMatchesMousePointerAction=function(k,a){if("touch"===k.pointerType)return!1;switch(a){case "primary":return 0===k.button;case "secondary":return 2===k.button;case "tertiary":return 1===k.button}};b.eventMatchesPointerAction=function(k,a){switch(a){case "primary":return"touch"===k.pointerType||0===k.button;case "secondary":return"touch"!==k.pointerType&&2===k.button;case "tertiary":return"touch"!==
k.pointerType&&1===k.button}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../geometry/projectionEllipsoid ../../../support/geometryUtils ../../../webgl-engine/lib/Intersector ../../../camera/constraintUtils/surfaceCollision ../../../../animation/easing ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../PointToPointAnimationController ../../utils/navigationUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){b.ZoomStepController=function(A){function t(){var E=A.apply(this,arguments)||this;E.zoomLocation=n.create();E.tmpCamera=new x;E.tmpViewDir=n.create();E.tmpRayDir={origin:n.create(),direction:n.create()};E.targetOnSphere=n.create();E.tmpCenter=n.create();E.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new x,interactionDirection:null,tiltMode:0};E.sphere=m.sphere.create();return E}k._inheritsLoose(t,
A);var D=t.prototype;D.initialize=function(){this.intersector=new u.Intersector(this.view.state.mode)};D.zoomStep=function(E,G){if(this.active){var H=this.view.state,{interactionStartCamera:I}=this.constraintOptions;this.animation.finished?I.copyFrom(H.camera):this.animation.cameraAt(1,I);var J=I=!1;this.intersectionHelper.intersectScreen(G,this.zoomLocation)&&(I=0<E?!0:!1,J=!0);this.tmpCamera.copyFrom(H.camera);I?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&
(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:w.copy(this.zoomLocation,this.tmpCamera.center);this.updateCamera(this.tmpCamera,E,this.zoomLocation,G,J);this.begin(this.tmpCamera)}};D.animationSettings=function(){return{apex:null,duration:.6,easing:y.outExpo}};D.updateCamera=function(E,G,H,I,J){var K=q.getReferenceEllipsoid(this.view.spatialReference);if(z.decideNavigationMode(E,
I,J,K)===z.NavigationMode.Horizontal||r("disable-feature:context-navigation")){G=Math.pow(.6,G);this.sphere.radius=w.length(H);w.subtract(this.tmpViewDir,E.center,E.eye);J=w.length(this.tmpViewDir);K=J*G;1>=G&&4>K&&(K=4,G=K/J);if(1E-6>Math.abs(J-K))return;J=w.length(E.center);this.sphere.radius!==J&&w.scale(E.center,E.center,(this.sphere.radius+G*(J-this.sphere.radius))/J);w.scale(this.tmpViewDir,this.tmpViewDir,-G);w.add(E.eye,E.center,this.tmpViewDir);B.applyAll(this.view,E,this.constraintOptions);
1E-12<w.squaredDistance(H,E.center)&&m.sphere.intersectScreen(this.sphere,E,I,this.targetOnSphere)&&z.panToPosition(this.sphere,E,H,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{J=Math.pow(.6,Math.abs(G));K=0<G?1:-1;m.ray.fromScreenAtEye(E,I,this.tmpRayDir);w.normalize(this.tmpRayDir.direction,this.tmpRayDir.direction);var L;this.view.camera.position.hasZ&&(L=Math.abs(this.view.camera.position.z));L=Math.max(12*L,20);I=this.view._stage.renderView.getMinimalDepthForArea(I[0],
I[1],this.view._stage.getCamera(),60);L=L>I?I:L;w.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,L);w.add(H,this.tmpRayDir.origin,this.tmpRayDir.direction);H=L*J;0<G&&4>H&&(H=4,J=H/L);if(1E-6>Math.abs(L-H))return;w.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,K*(1-J));w.add(E.eye,E.eye,this.tmpRayDir.direction);w.add(E.center,E.center,this.tmpRayDir.direction)}v.applySurfaceCollisionConstraint(this.view,E)};return t}(C.PointToPointAnimationController);b.ZoomStepController=a.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],
b.ZoomStepController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports","../../../../chunks/vec3f64","../../../../chunks/vec3","../intersectionUtils"],function(b,k,a,r){const l=k.create();b.applySurfaceCollisionConstraint=function(h,d,c=0){var e=h.state.constraints;if(!e.collision.enabled)return!1;var f=r.surfaceElevationBelowRenderLocation(h,d.eye);const g=h.renderCoordsHelper.getAltitude(d.eye);e=f+e.collision.elevationMargin;
if(g>=e)return!1;f=a.length(d.eye);a.subtract(l,d.center,d.eye);h.renderCoordsHelper.setAltitude(e,d.eye);1===c?a.add(d.center,d.eye,l):2===c&&a.scale(d.center,d.center,(f-g+e)/f);d.markViewDirty();return!0};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),function(b,
k,a,r,l,h){function d(q,m){return q.elevationProvider?q.elevationProvider.getElevation(m[0],m[1],m[2],q.renderCoordsHelper.spatialReference,"ground")||0:0}function c(q,m,u){if(!q.state.isGlobal)return!1;const v=d(q,m);({far:q}=q.stateManager.constraintsManager.nearFarHeuristic.compute(m,u,q.dataExtent,v,w));q*=q;return a.squaredDistance(m,u)>q}function e(q,m,u=k.create()){let v=f[q.viewingMode];v||(v=new h.Intersector(q.state.mode),v.options.backfacesTerrain=!q.state.isGlobal,v.options.invisibleTerrain=
!0,f[q.viewingMode]=v);const {isGlobal:y}=q.state;return q.sceneIntersectionHelper.intersectRay(m,v,u)&&!c(q,m.origin,u)?!0:!q.renderCoordsHelper.intersectManifold(m,0,u)||c(q,m.origin,u)?y?(q=r.getReferenceEllipsoid(q.spatialReference).radius,q=a.dot(m.origin,m.origin)-q*q,a.scale(u,m.direction,(0<q?Math.sqrt(q)/3:1)/a.length(m.direction)),a.add(u,u,m.origin),!0):!1:!0}const f={},g=k.create(),p=k.create(),n=k.create(),w={near:0,far:0};b.cameraOnContentAlongViewDirection=function(q,m,u,v){const y=
q.state.camera.clone();m&&(y.eye=m);u&&(y.center=u);v&&(y.up=v);e(q,y.ray,p)||a.copy(p,y.center);u=q.state.constraints;v=u.minimumPoiDistance;a.squaredDistance(y.eye,p)<v&&(m=u.collision.enabled,a.copy(n,y.viewForward),a.scale(n,n,v),m?a.subtract(y.eye,p,n):a.add(p,y.eye,n),q=q.renderCoordsHelper,v=q.getAltitude(y.eye),u=u.collision.elevationMargin,m&&v<u&&(a.subtract(n,p,y.eye),q.setAltitude(u,y.eye),a.add(p,y.eye,n)));y.center=p;return y};b.eyeWithinExtent=function(q,m,u,v){return q.renderCoordsHelper.fromRenderCoords(m.eye,
g,v)&&l.containsPoint(u,g)};b.surfaceElevationBelowRenderLocation=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/animation/easing":function(){define(["exports"],function(b){function k(F){return F}function a(F){const N=2*(F-Math.sqrt((F-1)*F)),P=N/2/F;return U=>U<P?F*U*U:N*U-N+1}function r(F,N){return P=>P<N?N*F(P/N):1-F((1-P)/(1-N))*(1-N)}const l=F=>F*F,h=F=>1-l(1-F),d=F=>.5>F?l(2*F)/2:(1-l(1-2*(F-.5))+1)/2,c=F=>F*F*F,e=F=>1-c(1-F),f=F=>.5>F?c(2*F)/2:(1-c(1-2*(F-.5))+1)/2,g=F=>
F*F*F*F,p=F=>1-g(1-F),n=F=>.5>F?g(2*F)/2:(1-g(1-2*(F-.5))+1)/2,w=F=>F*F*F*F*F,q=F=>1-w(1-F),m=F=>.5>F?w(2*F)/2:(1-w(1-2*(F-.5))+1)/2,u=F=>-Math.cos(F*Math.PI/2)+1,v=F=>1-u(1-F),y=F=>.5>F?u(2*F)/2:(1-u(1-2*(F-.5))+1)/2,B=F=>Math.pow(2,10*(F-1)),x=F=>1-Math.pow(2,10*(1-F-1)),C=F=>.5>F?Math.pow(2,10*(2*F-1))/2:(1-Math.pow(2,10*(1-2*(F-.5)-1))+1)/2,z=F=>-(Math.sqrt(1-F*F)-1),A=F=>1-z(1-F),t=F=>.5>F?z(2*F)/2:(1-z(1-2*(F-.5))+1)/2,D=r(a(1),1),E=r(a(1),0),G=r(a(1),.5),H=r(a(2),1),I=r(a(2),0),J=r(a(2),.5),
K=r(a(3),1),L=r(a(3),0),S=r(a(3),.5),M=r(a(4),1),T=r(a(4),0),O=r(a(4),.5),Q={linear:k,"in-quad":l,"out-quad":h,"in-out-quad":d,"in-coast-quad":D,"out-coast-quad":E,"in-out-coast-quad":G,"in-cubic":c,"out-cubic":e,"in-out-cubic":f,"in-coast-cubic":H,"out-coast-cubic":I,"in-out-coast-cubic":J,"in-quart":g,"out-quart":p,"in-out-quart":n,"in-coast-quart":K,"out-coast-quart":L,"in-out-coast-quart":S,"in-quint":w,"out-quint":q,"in-out-quint":m,"in-coast-quint":M,"out-coast-quint":T,"in-out-coast-quint":O,
"in-sine":u,"out-sine":v,"in-out-sine":y,"in-expo":B,"out-expo":x,"in-out-expo":C,"in-circ":z,"out-circ":A,"in-out-circ":t};b.inCirc=z;b.inCoastCubic=H;b.inCoastQuad=D;b.inCoastQuart=K;b.inCoastQuint=M;b.inCubic=c;b.inExpo=B;b.inOutCirc=t;b.inOutCoastCubic=J;b.inOutCoastQuad=G;b.inOutCoastQuart=S;b.inOutCoastQuint=O;b.inOutCubic=f;b.inOutExpo=C;b.inOutQuad=d;b.inOutQuart=n;b.inOutQuint=m;b.inOutSine=y;b.inQuad=l;b.inQuart=g;b.inQuint=w;b.inSine=u;b.linear=k;b.named=Q;b.outCirc=A;b.outCoastCubic=I;
b.outCoastQuad=E;b.outCoastQuart=L;b.outCoastQuint=T;b.outCubic=e;b.outExpo=x;b.outQuad=h;b.outQuart=p;b.outQuint=q;b.outSine=v;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ../../../chunks/vec2 ./constraintUtils/common ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing".split(" "),function(b,k,a,r,l,h,d,c){const e=[{type:1,error:function(g,p,
n){return d.getTiltConstraintError(g,p,n)*p.distance},apply:d.applyTiltConstraint},{type:2,error:r.getAltitudeConstraintError,apply:r.applyAltitudeConstraint},{type:4,error:l.getDistanceConstraintError,apply:l.applyDistanceConstraint}],f={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};b.applyAltitudeConstraint=r.applyAltitudeConstraint;b.getAltitudeConstraintError=r.getAltitudeConstraintError;b.applyDistanceConstraint=l.applyDistanceConstraint;
b.getDistanceConstraintError=l.getDistanceConstraintError;b.applySurfaceCollisionConstraint=h.applySurfaceCollisionConstraint;b.applyTiltConstraint=d.applyTiltConstraint;b.getTiltConstraintError=d.getTiltConstraintError;b.applyAll=function(g,p,n=f,w=p){let q=!1;w!==p&&w.copyFrom(p);w.markViewDirty();w.computeUp(g.state.mode);for(p=0;5>p;p++){let u=0;for(var m of e)if(a.hasConstraintType(n.selection,m.type)){const v=Math.abs(m.error(g,w,n));m.apply(g,w,n)&&(q=!0,u+=v)}if(0===u)break}m=a.hasConstraintType(n.selection,
8);a:switch(n.interactionType){case 4:n=1;break a;case 5:n=g.state.isGlobal?2:1;break a;default:n=0}m&&h.applySurfaceCollisionConstraint(g,w,n)&&(q=!0);q&&w.computeUp(g.state.mode);return q};b.pixelDistanceToInteractionFactor=function(g,p){g="number"===typeof g?g:k.distance(g,p);return c.inOutCubic(Math.min(1,g/150))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3"],
function(b,k,a){b.adjustRangeForInteraction=function(r,l,h,d,c,e){0!==r&&(h?(e.min=Math.min(e.min,l),e.max=Math.max(e.max,l)):null!=d?(e.min-=Math.max(0,(l-e.min)*(1-d)),e.max+=Math.max(0,(l-e.max)*(1-d))):c&&(e.min-=Math.max(0,l-e.min-c),e.max+=Math.max(0,l-e.max-c)))};b.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};b.hasConstraintType=function(r,l){return 0!==(r&l)};b.interactionDirectionTowardsConstraintMinimization=
function(r,l,h,d){l=l||r.viewForward;a.copy(d,l);a.scale(d,d,k.sign(a.dot(l,h)));return d};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/geometryUtils ./common ../../support/intersectionUtils".split(" "),function(b,k,a,r,l,h,d){function c(w,q,m=h.defaultApplyOptions){var u=w.state.constraints.altitude;u=w.state.isGlobal&&u?2===
m.interactionType&&h.hasConstraintType(m.selection,1)?!1:!0:!1;if(!u)return 0;var v=w.state.constraints.altitude;u=f;u.min=v.min;u.max=v.max;v=m.interactionType;if(0!==v){var {min:y,max:B}=u,{interactionStartCamera:x,interactionFactor:C}=m;m=2===v||1===v;v=c(w,x);var z=0===v?0:w.renderCoordsHelper.getAltitude(x.eye);u.min=y;u.max=B;h.adjustRangeForInteraction(v,z,m,C,.05*z,u)}w=w.renderCoordsHelper.getAltitude(q.eye);w=k.clamp(w,u.min,u.max)-w;return 1E-6>=Math.abs(w)?0:w}function e(w,q,m,u){w.renderCoordsHelper.worldUpAtPosition(q.eye,
u);r.scale(u,u,m);return u}const f={min:0,max:0},g=a.create(),p=a.create(),n=a.create();b.applyAltitudeConstraint=function(w,q,m=h.defaultApplyOptions){const u=c(w,q,m);if(0===u)return!1;const v=w.renderCoordsHelper,y=v.getAltitude(q.eye)+u;w=h.interactionDirectionTowardsConstraintMinimization(q,m.interactionDirection,e(w,q,k.sign(u),p),g);m=r.copy(n,q.viewForward);v.intersectInfiniteManifold(l.ray.wrap(q.eye,w),y,q.eye)||v.setAltitude(y,q.eye);d.closestPointOnRay(q.eye,m,q.center,q.center);q.markViewDirty();
return!0};b.getAltitudeConstraintError=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec3f64","../../../chunks/vec3","../../../chunks/vec2f64","./geometryUtils"],function(b,k,a,r,l){function h(e,f,g,p){const n=c;e?(g&&p&&(n.len=a.distance(f,g)),a.copy(n.dir,e)):p?(n.len=a.distance(f,g),a.subtract(n.dir,g,f),a.scale(n.dir,n.dir,1/n.len)):(a.subtract(n.dir,g,f),a.normalize(n.dir,n.dir));return n}function d(e,
f,g,p){p.clip[0]=0;p.clip[1]=g?p.len:Number.MAX_VALUE;for(g=0;g<e.length;g++){{var n=e[g],w=f;var q=p;const m=a.dot(l.plane.normal(n),q.dir);n=-l.plane.signedDistance(n,w);0>n&&0<=m?q=!1:-1E-6<m&&1E-6>m?q=0<n:!(0>n||0>m)||0>n&&0>m?(n/=m,0<m?n<q.clip[1]&&(q.clip[1]=n):n>q.clip[0]&&(q.clip[0]=n),q=q.clip[0]<=q.clip[1]):q=!0}if(!q)return!1}return!0}const c={dir:k.create(),len:0,clip:r.create()};b.closestPointOnRay=function(e,f,g,p){g=a.dot(f,a.subtract(p,g,e));a.add(p,e,a.scale(p,f,g));return p};b.frustumLineSegment=
function(e,f,g,p){p=h(p,f,g,!0);return d(e,f,g,p)};b.frustumPoint=function(e,f){for(let g=0;6>g;g++)if(0<l.plane.signedDistance(e[g],f))return!1;return!0};b.frustumRay=function(e,f,g,p){g=h(p,f,g,!1);return d(e,f,null,g)};b.frustumSphere=function(e,f,g){const p=f[0],n=f[1];f=f[2];return e[0][0]*p+e[0][1]*n+e[0][2]*f+e[0][3]>g||e[1][0]*p+e[1][1]*n+e[1][2]*f+e[1][3]>g||e[2][0]*p+e[2][1]*n+e[2][2]*f+e[2][3]>g||e[3][0]*p+e[3][1]*n+e[3][2]*f+e[3][3]>g||e[4][0]*p+e[4][1]*n+e[4][2]*f+e[4][3]>g||e[5][0]*
p+e[5][1]*n+e[5][2]*f+e[5][3]>g?!1:!0};b.planeSphere=function(e,f,g){return e[0]*f[0]+e[1]*f[1]+e[2]*f[2]+e[3]<g};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../support/geometryUtils ./common".split(" "),function(b,k,a,r,l,h){function d(n,w,q=h.defaultApplyOptions){if(!n.state.isLocal)return 0;var m=n.state.constraints.distance;if(!n.pointsOfInterest.surfaceOrigin.renderLocation||
Infinity===m)return 0;c.min=0;c.max=m;m=c;var u=q.interactionType;if(0!==u){var {min:v,max:y}=m,{interactionStartCamera:B,interactionFactor:x}=q;q=1===u||4===u;u=d(n,B);var C=0===u?0:a.distance(B.eye,n.pointsOfInterest.surfaceOrigin.renderLocation);m.min=v;m.max=y;h.adjustRangeForInteraction(u,C,q,x,.05*C,m)}n=a.distance(w.eye,n.pointsOfInterest.surfaceOrigin.renderLocation);n=c.max-n;return-1E-6<=n?0:n}const c={min:0,max:0},e=k.create(),f=k.create(),g=k.create(),p=k.create();b.applyDistanceConstraint=
function(n,w,q=h.defaultApplyOptions){var m=d(n,w,q);if(0===m)return!1;var u=n.pointsOfInterest.surfaceOrigin;m=a.distance(w.eye,n.pointsOfInterest.surfaceOrigin.renderLocation)+m;const v=a.copy(e,w.eye);q=h.interactionDirectionTowardsConstraintMinimization(w,q.interactionDirection,r.directionFromTo(p,w.eye,n.pointsOfInterest.surfaceOrigin.renderLocation),g);return l.sphere.intersectRay(l.sphere.wrap(m,u.renderLocation),l.ray.wrap(w.eye,q),w.eye)?(u=a.subtract(f,w.eye,v),a.add(w.center,w.center,u),
w.markViewDirty(),u=n.renderCoordsHelper.getAltitude(w.center),n.renderCoordsHelper.intersectInfiniteManifold(w.ray,u,w.center),w.markViewDirty(),!0):!1};b.getDistanceConstraintError=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../support/geometryUtils ./common ../../state/utils/viewUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){function p(z,A,t=f.defaultApplyOptions,D=!0){C.eyeCenterDistance=0;C.requiresTwoSteps=!1;const E=n(z,A,t,void 0,C);if(0===E)return!1;d.identity(u);d.rotate(u,u,-E,A.viewRight);switch(t.tiltMode){case 1:l.transformMat4(m,A.viewForward,u);l.scale(m,m,C.eyeCenterDistance);l.add(A.center,A.eye,m);break;case 0:l.subtract(m,A.center,A.eye);l.transformMat4(m,m,u);l.subtract(A.eye,A.center,m);break;default:k.neverReached(t.tiltMode)}l.transformMat4(A.up,A.up,u);A.markViewDirty();
return C.requiresTwoSteps&&D?p(z,A,t,!1):!0}function n(z,A,t=f.defaultApplyOptions,D=f.defaultApplyOptions,E){if(!z.state.constraints.tilt)return 0;var G=z.state.constraints.tilt(A.distance,B);if(0!==t.interactionType){var {interactionStartCamera:H,interactionFactor:I}=t,{min:J,max:K}=G,L=n(z,H,f.defaultApplyOptions,t),S=0===L?0:g.viewAngle(z.renderCoordsHelper,H.center,H.eye);G.min=J;G.max=K;2===t.interactionType?(f.hasConstraintType(t.selection,2)&&q(z,H,G),f.adjustRangeForInteraction(L,S,!0,I,
y,G)):f.adjustRangeForInteraction(L,S,!1,I,y,G)}2===D.interactionType&&f.hasConstraintType(D.selection,2)&&q(z,D.interactionStartCamera,G);if(1===t.tiltMode||1===D.tiltMode){a:switch(E&&(E.requiresTwoSteps=!1),z.viewingMode){case "global":t=x;L=z.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;D=L+h.getReferenceEllipsoid(z.spatialReference).radius;L=z.renderCoordsHelper.intersectManifold(A.ray,L,v);t.eyeCenterDistance=A.distance;L?(t.eyeCenterDistance=l.distance(A.eye,v),t.tiltAtCenter=
g.viewAngle(z.renderCoordsHelper,v,A.eye)):z.state.isLocal?t.tiltAtCenter=g.viewAngle(z.renderCoordsHelper,A.center,A.eye):(e.sphere.closestPointOnSilhouette(e.sphere.wrap(D),A.ray,v),t.eyeCenterDistance=l.distance(A.eye,v),t.tiltAtCenter=a.acosClamped(-l.dot(A.viewForward,l.normalize(v,v))));t.radius=D;t.eyeRadius=l.length(A.eye);t.constraints=z.state.constraints;t.centerIsOnSurface=L;A=a.clamp(t.tiltAtCenter,G.min,G.max);if(1E-9<Math.abs(t.tiltAtCenter-A)){if(t.centerIsOnSurface){{const {constraints:M,
eyeCenterDistance:T,tiltAtCenter:O}=t;A=O;z=M.clampTilt(T,O);G=w(t,z);if(M.clampTilt(G,O)!==z)for(G=0;10>G&&1E-9<Math.abs(z-A);)D=(A+z)/2,L=w(t,D),L=M.clampTilt(L,D),1E-9<Math.abs(L-D)?A=D:z=D,G++;A=z}G=A;z=a.asinClamped(t.radius/t.eyeRadius*Math.sin(t.tiltAtCenter));G=a.asinClamped(t.radius/t.eyeRadius*Math.sin(G));z=t.eyeRadius>t.radius?z-G:G-z}else A=t.constraints.clampTilt(t.eyeCenterDistance,t.tiltAtCenter),E&&A<Math.PI/2&&(E.requiresTwoSteps=!0,A=Math.PI/2-1E-5),z=t.tiltAtCenter-Math.PI/2-(A-
Math.PI/2);E&&(E.eyeCenterDistance=w(t,A));E=z}else E=0;break a;case "local":D=g.viewAngle(z.renderCoordsHelper,A.center,A.eye);t=a.clamp(D,G.min,G.max);G=D-t;1E-9<Math.abs(G)?(E&&(D=z.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,z=z.renderCoordsHelper.getAltitude(A.eye)-D,t=Math.cos(t),E.eyeCenterDistance=1E-4<Math.abs(t)?z/t:A.distance),E=G):E=0;break a;default:k.neverReached(z.viewingMode),E=void 0}return E}E=g.viewAngle(z.renderCoordsHelper,A.center,A.eye);t=a.clamp(E,G.min,
G.max);E-=t;E=1E-9<Math.abs(E)?E:0;return E}function w(z,A){if(!z.centerIsOnSurface)return z.eyeCenterDistance;A=Math.PI-a.clamp(A,0,Math.PI);const t=a.asinClamped(z.radius/z.eyeRadius*Math.sin(A)),D=Math.sin(Math.PI-A-t)/Math.sin(A);return z.eyeRadius<z.radius&&1<D?Math.sin(Math.PI-A-(Math.PI-t))/Math.sin(A)*z.eyeRadius:D*z.eyeRadius}function q(z,A,t){if(!z.state.isLocal){var D=z.state.constraints;if(D.altitude){var E=l.squaredLength(A.center),G=Math.sqrt(E);A=A.distance;var H=h.getReferenceEllipsoid(z.spatialReference).radius;
z=D.altitude.min+H;D=D.altitude.max+H;z=(z*z-A*A-E)/(-2*G*A);t.min=Math.max(t.min,Math.min(Math.PI-a.acosClamped((D*D-A*A-E)/(-2*G*A)),t.max));t.max=Math.min(t.max,Math.PI-a.acosClamped(z))}}}const m=r.create(),u=c.create(),v=r.create(),y=a.deg2rad(5),B={min:0,max:0},x={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},C={eyeCenterDistance:0,requiresTwoSteps:!1};b.applyTiltConstraint=p;b.getTiltConstraintError=n;Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3f64","../../../../chunks/vec3"],function(b,k,a,r){const l=a.create(),h=a.create();b.viewAngle=function(d,c,e){d.worldUpAtPosition(c,l);r.subtract(h,e,c);d=r.length(h);return 0===d?0:k.acosClamped(r.dot(h,l)/d)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec2 ../../../../chunks/vec4 ../../../../chunks/vector ../../support/geometryUtils ./Util".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){let u=function(){function z(t=null,D=null,E=null){this._viewUp=l.create();this._viewForward=l.create();this._viewRight=l.create();this._ray=q.ray.createWrapper();this._viewport=g.fromValues(0,0,1,1);this._padding=g.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=f.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=e.create();this._projectionDirty=!0;this._projectionMatrix=e.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=e.create();
this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=e.create();this._frustumDirty=!0;this._frustum=q.frustum.create();this._fullViewport=g.create();this._contextNavigation=!0;this.pixelRatio=1;this.relativeElevation=0;this._eye=k.isSome(t)?l.clone(t):l.create();this._center=k.isSome(D)?l.clone(D):l.create();this._up=k.isSome(E)?l.clone(E):l.fromValues(0,0,1)}var A=z.prototype;A.depthNDCToWorld=function(t){return 2*this.near*this.far/(this.far+this.near-(2*t-1)*(this.far-this.near))};
A.copyFrom=function(t){h.copy(this._eye,t._eye);h.copy(this._center,t._center);h.copy(this._up,t._up);n.copy(this._viewport,t._viewport);n.copy(this._padding,t._padding);p.copy(this._nearFar,t._nearFar);this._fov=t._fov;this.relativeElevation=t.relativeElevation;this._viewDirty=t._viewDirty;this._viewDirty||(c.copy(this._viewMatrix,t._viewMatrix),h.copy(this._viewRight,t._viewRight),h.copy(this._viewUp,t._viewUp),h.copy(this._viewForward,t._viewForward));t._projectionDirty?this._projectionDirty=!0:
(c.copy(this._projectionMatrix,t._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;this._frustumDirty=t._frustumDirty;this._frustumDirty||(q.frustum.copy(t._frustum,this._frustum),this._frustumDirty=!1);t._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(c.copy(this._viewInverseTransposeMatrix,t._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);n.copy(this._fullViewport,t._fullViewport);this.pixelRatio=t.pixelRatio;return this};
A.copyViewFrom=function(t){this.eye=t.eye;this.center=t.center;this.up=t.up};A.clone=function(){return(new z).copyFrom(this)};A.equals=function(t){return h.exactEquals(this._eye,t._eye)&&h.exactEquals(this._center,t._center)&&h.exactEquals(this._up,t._up)&&n.exactEquals(this._viewport,t._viewport)&&n.exactEquals(this._padding,t._padding)&&p.exactEquals(this._nearFar,t._nearFar)&&this._fov===t._fov&&this.pixelRatio===t.pixelRatio&&this.relativeElevation===t.relativeElevation};A.almostEquals=function(t){if(this.pixelRatio!==
t.pixelRatio||.001<=Math.abs(t._fov-this._fov))return!1;const D=1-1E-10;h.sub(B,t._eye,t._center);h.sub(x,this._eye,this._center);const E=h.dot(B,x),G=h.sqrLen(B),H=h.sqrLen(x);return E*E>=D*G*H&&h.sqrDist(t._eye,this._eye)<2.5E-7*Math.max(G,H)&&.5>n.squaredDistance(t._padding,this._padding)&&.5>n.squaredDistance(t._viewport,this._viewport)};A.markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};A.computeRenderPixelSizeAt=function(t){return this.computeRenderPixelSizeAtDist(this.viewDirectionDistance(t))};
A.computeRenderPixelSizeAtDist=function(t){return t*this.perRenderPixelRatio};A.computeScreenPixelSizeAt=function(t){return this.computeScreenPixelSizeAtDist(this.viewDirectionDistance(t))};A.viewDirectionDistance=function(t){return Math.abs(w.projectPointSignedLength(this.viewForward,h.subtract(B,t,this._eye)))};A.computeScreenPixelSizeAtDist=function(t){return t*this.perScreenPixelRatio};A.computeDistanceFromRadius=function(t,D){return t/Math.tan(Math.min(this.fovX,this.fovY)/(2*(D||1)))};A.getScreenCenter=
function(t=r.createScreenPointArray()){t[0]=(this.padding[3]+this.width/2)/this.pixelRatio;t[1]=(this.padding[0]+this.height/2)/this.pixelRatio;return t};A.getRenderCenter=function(t,D=.5,E=.5){t||(t=r.createRenderScreenPointArray3());t[0]=this.padding[3]+this.width*D;t[1]=this.padding[2]+this.height*E;2<t.length&&(t[2]=.5);return t};A.setGLViewport=function(t){const D=this.viewport,E=this.padding;t.setViewport(D[0]-E[3],D[1]-E[2],D[2]+E[1]+E[3],D[3]+E[0]+E[2])};A.applyProjection=function(t,D,E=!1){t!==
v&&h.copy(v,t);v[3]=1;E&&(D[2]=-v[2]);n.transformMat4(v,v,this.projectionMatrix);h.scale(v,v,1/Math.abs(v[3]));t=this.fullViewport;D[0]=a.lerp(0,t[0]+t[2],.5+.5*v[0]);D[1]=a.lerp(0,t[1]+t[3],.5+.5*v[1]);E||(D[2]=.5*(v[2]+1));return D};A.projectToScreen=function(t,D){this.projectToRenderScreen(t,C);return this.renderToScreen(C,D)};A.projectToRenderScreen=function(t,D){v[0]=t[0];v[1]=t[1];v[2]=t[2];v[3]=1;n.transformMat4(v,v,this.viewProjectionMatrix);if(0===v[3])return null;h.scale(v,v,1/Math.abs(v[3]));
t=this.fullViewport;"x"in D?(D.x=a.lerp(0,t[0]+t[2],.5+.5*v[0]),D.y=a.lerp(0,t[1]+t[3],.5+.5*v[1])):(D[0]=a.lerp(0,t[0]+t[2],.5+.5*v[0]),D[1]=a.lerp(0,t[1]+t[3],.5+.5*v[1]),2<D.length&&(D[2]=.5*(v[2]+1)));return D};A.unprojectFromScreen=function(t,D){return this.unprojectFromRenderScreen(this.screenToRender(t,C),D)};A.unprojectFromRenderScreen=function(t,D){c.multiply(y,this.projectionMatrix,this.viewMatrix);if(!c.invert(y,y))return null;const E=this.fullViewport;v[0]=2*(t[0]-E[0])/E[2]-1;v[1]=2*
(t[1]-E[1])/E[3]-1;v[2]=2*t[2]-1;v[3]=1;n.transformMat4(v,v,y);if(0===v[3])return null;D[0]=v[0]/v[3];D[1]=v[1]/v[3];D[2]=v[2]/v[3];return D};A.constrainWindowSize=function(t,D,E,G=1){t*=this.pixelRatio;D*=this.pixelRatio;return[Math.max(t-E*G/2,0),Math.max(this.fullHeight-D-E/2,0),E*G- -Math.min(t-E*G/2,0)- -Math.min(this.fullWidth-t-E*G/2,0),E- -Math.min(this.fullHeight-D-E/2,0)- -Math.min(D-E/2,0)]};A.computeUp=function(t){1===t?this.computeUpGlobal():this.computeUpLocal()};A.screenToRender=function(t,
D){const E=this.fullHeight-t[1]*this.pixelRatio;D[0]=t[0]*this.pixelRatio;D[1]=E;return D};A.renderToScreen=function(t,D){const E=(this.fullHeight-t[1])/this.pixelRatio;D[0]=t[0]/this.pixelRatio;D[1]=E;return D};A.computeUpGlobal=function(){h.subtract(B,this.center,this.eye);const t=h.length(this.center);1>t?(h.set(this.up,0,0,1),this.markViewDirty()):Math.abs(h.dot(B,this.center))>.9999*h.length(B)*t||(h.cross(this.up,B,this.center),h.cross(this.up,this.up,B),h.normalize(this.up,this.up),this.markViewDirty())};
A.computeUpLocal=function(){d.directionFromTo(B,this.eye,this.center);.9999>=Math.abs(B[2])&&(h.scale(B,B,B[2]),h.set(this.up,-B[0],-B[1],1-B[2]),h.normalize(this.up,this.up),this.markViewDirty())};A._compareAndSetView=function(t,D){h.exactEquals(t,D)||(h.copy(D,t),this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0)};A._recomputeFrustum=function(){this._frustumDirty&&(q.frustum.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};A._ensureViewClean=
function(){this._viewDirty&&(c.lookAt(this._viewMatrix,this._eye,this._center,this._up),h.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),h.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),h.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};b._createClass(z,[{key:"eye",get:function(){return this._eye},set:function(t){this._compareAndSetView(t,
this._eye)}},{key:"center",get:function(){return this._center},set:function(t){this._compareAndSetView(t,this._center)}},{key:"ray",get:function(){this._ray.origin=this.eye;this._ray.direction||(this._ray.direction=l.create());h.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(t){this._compareAndSetView(t,this._up)}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},set:function(t){c.copy(this._viewMatrix,
t);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(t){this._nearFar[0]!==t&&(this._nearFar[0]=
t,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(t){this._nearFar[1]!==t&&(this._nearFar[1]=t,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(t){this.x=t[0];this.y=t[1];this.width=t[2];this.height=t[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(t){t+=this._padding[3];this._viewport[0]!==t&&(this._viewport[0]=
t,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(t){t+=this._padding[2];this._viewport[1]!==t&&(this._viewport[1]=t,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(t){this._viewport[2]!==t&&(this._viewport[2]=t,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},
set:function(t){this._viewport[3]!==t&&(this._viewport[3]=t,this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(t){this.width=t-(this._padding[1]+this._padding[3])}},{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},set:function(t){this.height=t-(this._padding[0]+this._padding[2])}},{key:"fullViewport",get:function(){this._fullViewport[0]=
this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}},{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(t){if(this._padding[0]!==t[0]||this._padding[1]!==t[1]||this._padding[2]!==t[2]||this._padding[3]!==t[3])this._viewport[0]+=t[3]-this._padding[3],this._viewport[1]+=t[2]-this._padding[2],
this._viewport[2]-=t[1]+t[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=t[0]+t[2]-(this._padding[0]+this._padding[2]),n.copy(this._padding,t),this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&(c.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){const t=
this.width,D=this.height,E=this.near*Math.tan(this.fovY/2),G=E*this.aspect;c.frustum(this._projectionMatrix,-G*(1+2*this._padding[3]/t),G*(1+2*this._padding[1]/t),-E*(1+2*this._padding[2]/D),E*(1+2*this._padding[0]/D),this.near,this.far);this._projectionDirty=!1}return this._projectionMatrix},set:function(t){c.copy(this._projectionMatrix,t);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t;this._frustumDirty=
this._viewProjectionDirty=this._projectionDirty=!0}},{key:"fovX",get:function(){return m.fovd2fovx(this._fov,this.width,this.height)},set:function(t){this._fov=m.fovx2fovd(t,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"fovY",get:function(){return m.fovd2fovy(this._fov,this.width,this.height)},set:function(t){this._fov=m.fovy2fovd(t,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._projectionDirty=!0}},{key:"distance",
get:function(){return h.distance(this._center,this._eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)c.invert(this._viewInverseTransposeMatrix,this.viewMatrix),c.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/
2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&0<=this.relativeElevation}}]);return z}();const v=g.create(),y=e.create(),B=l.create(),x=l.create(),C=r.createRenderScreenPointArray3();return u})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../chunks/vec3f64 ../../../ViewAnimation ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/Camera ../../animation/pointToPoint/Animation ./AnimationController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){b.PointToPointAnimationController=function(x){function C(A){A=x.call(this,A)||this;A.view=null;A.mode="interaction";A.hasTarget=!1;return A}k._inheritsLoose(C,x);var z=C.prototype;z.initialize=function(){this.animation=new u.Animation(this.view.state.mode);this.viewAnimation="interaction"===this.mode?null:new w};z.begin=function(A,t){this.hasTarget=!0;t=this.animationSettings(t);y.copyFrom(this.view.state.camera);const D=new q.Intersector(this.view.state.mode);
this.intersectionHelper.intersectRay(y.ray,D,B)&&(y.center=B);this.animation.update(y,A,t);this.animation.finished&&this.finish()};z.finish=function(){this.animation.currentTime=this.animation.time;x.prototype.finish.call(this)};z.stepController=function(A,t){this.hasTarget&&this.animation.step(A,t)};z.onControllerEnd=function(A){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,A),this.animation.currentTime=this.animation.time);x.prototype.onControllerEnd.call(this,
A)};z.animationSettings=function(A={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:A.speedFactor,duration:A.duration,maxDuration:A.maxDuration,easing:A.easing}};k._createClass(C,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}},{key:"isInteractive",get:function(){return"interaction"===this.mode}},{key:"steppingFinished",get:function(){return this.hasTarget&&this.animation.finished}}]);
return C}(v.AnimationController);a.__decorate([d.property({constructOnly:!0})],b.PointToPointAnimationController.prototype,"view",void 0);a.__decorate([d.property({constructOnly:!0})],b.PointToPointAnimationController.prototype,"mode",void 0);b.PointToPointAnimationController=a.__decorate([e.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],b.PointToPointAnimationController);const y=new m,B=n.create();Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3f64 ../../../../chunks/vec3 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(b,k,a,r,l,h,d){const c=a.create();a=function(){function e(g){this.currentTime=0;this.animation=new d.Animation(()=>new l(g));this._current=new l(g)}var f=e.prototype;f.update=function(g,p,n){const w=this.animation.definition.source,q=this.animation.definition.target,m=r.subtract(c,p.center,g.center),u=r.length(m);1E-5<=u?(m[0]/=u,m[1]/=u,m[2]/=u):(m[0]=0,m[1]=1,m[0]=0);r.copy(w.lookAtDirection,m);r.copy(q.lookAtDirection,m);w.copyFromRenderCamera(g);q.copyFromRenderCamera(p);this._current.copyFrom(w);
this.animation.update(w,q,n);this.currentTime=0;g.almostEquals(p)&&(this.currentTime=this.animation.time)};f.cameraAt=function(g,p){this.animation.cameraAt(g,this._current);p=p||new h;this._current.copyToRenderCamera(p);return p};f.step=function(g,p){this.finished||(this.currentTime+=g,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,p)};k._createClass(e,[{key:"finished",get:function(){return this.currentTime>=this.animation.time}},{key:"time",
get:function(){return this.animation.time}}]);return e}();b.Animation=a;b.default=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat3f64 ../../../../chunks/mat3".split(" "),function(b,k,a,r,l,h){const d=k.create(),c=k.create(),e=k.create(),f=k.create(),g=k.create(),p=k.create();var n=k.fromValues(0,0,1),w=k.fromValues(0,
1,0),q=k.fromValues(1,0,0);const m=l.create();return function(){function u(y=1){this.viewingMode=y;this.center=k.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=k.clone(w)}var v=u.prototype;v.pixelsPerPanAtZoom=function(y){return this.size/2/(this._zoomToPanScale*y)};v.zoomAtPixelsPerPan=function(y){return this.size/2/(this._zoomToPanScale*y)};v.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};v.compareTo=function(y,B){B||(B={pan:0,
rotate:0,sourceZoom:0,targetZoom:0});if(1===this.viewingMode){var x=a.length(this.center);const C=a.length(y.center);x=(x+C)/2;B.pan=r.angle(this.center,y.center)*x}else B.pan=a.distance(this.center,y.center);x=Math.abs(y.yaw-this.yaw);x>=Math.PI&&(x=2*Math.PI-x);B.rotate=Math.max(x,Math.abs(y.pitch-this.pitch));B.sourceZoom=this.distance;B.targetZoom=y.distance;return B};v.interpolate=function(y,B,x){1===this.viewingMode?r.slerp(y.center,B.center,x.pan,this.center):a.lerp(this.center,y.center,B.center,
x.pan);this.distance=b.lerp(y.distance,B.distance,x.zoom);this.pitch=b.lerp(y.pitch,B.pitch,x.rotate);y=y.yaw;B=B.yaw;Math.abs(B-y)>=Math.PI&&(y+=2*(y<B?1:-1)*Math.PI);this.yaw=b.lerp(y,B,x.rotate)};v.copyFrom=function(y){a.copy(this.center,y.center);this.pitch=y.pitch;this.yaw=y.yaw;this.distance=y.distance;a.copy(this.lookAtDirection,y.lookAtDirection);this.size=y.size;this.copyFromCommon(y);this.viewingMode=y.viewingMode};v.copyFromRenderCamera=function(y){const B=this._lookAtOrientation(y.center,
m);a.copy(this.center,y.center);a.subtract(f,y.center,y.eye);a.transformMat3(f,f,B);a.transformMat3(g,y.up,B);this.distance=a.length(f);f[0]/=this.distance;f[1]/=this.distance;f[2]/=this.distance;this.pitch=this._eyeUpToPitch(f);this.yaw=this._eyeUpToYaw(f,g);this.size=Math.sqrt(y.width*y.width+y.height*y.height);this.copyFromCommon(y)};v.copyFromCommon=function(y){this.fov=y.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};v.copyToRenderCamera=function(y){const B=this._lookAtOrientation(this.center,
m);h.transpose(B,B);this._axisAngleVec3(q,this.pitch-Math.PI/2,w,f);this._axisAngleVec3(n,this.yaw,f);this._axisAngleVec3(q,this.pitch-Math.PI/2,n,g);this._axisAngleVec3(n,this.yaw,g);a.scale(f,f,this.distance);a.transformMat3(f,f,B);a.transformMat3(g,g,B);y.center=this.center;y.eye=a.subtract(f,this.center,f);y.up=g};v._axisAngleVec3=function(y,B,x,C=x){const z=Math.cos(B);B=Math.sin(B);a.scale(d,x,z);a.cross(c,y,x);a.scale(c,c,B);a.scale(e,y,(1-z)*a.dot(y,x));return a.add(C,a.add(C,d,c),e)};v._lookAtOrientation=
function(y,B){this._upAtLookAt(y,e);a.cross(d,this.lookAtDirection,e);a.normalize(d,d);0===d[0]&&0===d[1]&&0===d[2]&&a.copy(d,q);a.cross(c,e,d);a.normalize(c,c);B||(B=l.create());B[0]=d[0];B[1]=c[0];B[2]=e[0];B[3]=d[1];B[4]=c[1];B[5]=e[1];B[6]=d[2];B[7]=c[2];B[8]=e[2];return B};v._upAtLookAt=function(y,B){return 2===this.viewingMode?a.copy(B,n):a.normalize(B,y)};v._eyeUpToPitch=function(y){return Math.PI-r.angle(n,y)};v._eyeUpToYaw=function(y,B){.5>Math.abs(B[2])?(a.copy(p,B),0<y[2]&&a.scale(p,p,
-1)):a.copy(p,y);a.cross(c,p,n);a.normalize(c,c);return r.angle(q,c,n)};return u}()})},"esri/views/animation/pointToPoint/Animation":function(){define(["exports","../easing","./Settings","./Definition","./apex/Path"],function(b,k,a,r,l){const h={zoom:0,pan:0,rotate:0};let d=function(){function c(f){this.createCamera=f;this.time=0;this.definition=new r.Definition(f);this.path=new l.Path}var e=c.prototype;e.update=function(f,g,p){this.definition.update(f,g,p);this.path.update(this.definition,p);this.time=
this._applyTimeSettings(this.path.time,p);this.settings=p};e.cameraAt=function(f,g){g=g||this.createCamera();f=Math.min(Math.max(0,f),1);f=this.settings.easing?this.normalizedEasing(this.settings.easing,f):1<=this.time?this.normalizedEasing(k.inOutCoastQuad,f):this.normalizedEasing(k.outExpo,f);f=this.path.interpolateComponentsAt(f,h);g.interpolate(this.definition.source,this.definition.target,f);return g};e.normalizedEasing=function(f,g){const p=f(0),n=f(1);return(f(g)-p)/(n-p)};e._applyTimeSettings=
function(f,g){const p=null!=g.speedFactor?g.speedFactor:1;null!=g.duration?f=g.duration:null!=g.speedFactor&&(f/=p);return f=Math.min(Math.max(null!=g.minDuration?g.minDuration:a.defaultSettings.minDuration/p,f),null!=g.maxDuration?g.maxDuration:a.defaultSettings.maxDuration/p)};return c}();b.Animation=d;b.default=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports"],function(b){b.defaultSettings={desiredScreenFlow:2,minDuration:.5,
maxDuration:8};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./Settings"],function(b,k,a){let r=function(){function l(d){this.createCamera=d;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:a.defaultSettings.desiredScreenFlow};this.source=d();this.target=d()}var h=l.prototype;h.clone=function(){const d=new l(this.createCamera);d.copyFrom(this);
return d};h.copyFrom=function(d){this.update(d.source,d.target,d.settings)};h.update=function(d,c,e){this.source!==d&&this.source.copyFrom(d);this.target!==c&&this.target.copyFrom(c);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=e.desiredScreenFlow?e.desiredScreenFlow:a.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};h.halfWindowPanAtZoom=function(d){d=
this.target.pixelsPerPanAtZoom(d);return this.halfWindowSize/d};k._createClass(l,[{key:"hasZoom",get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}},{key:"hasPan",get:function(){return 1E-9<this.compared.pan}},{key:"hasRotate",get:function(){return 1E-9<this.compared.rotate}}]);return l}();b.Definition=r;b.default=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/Path":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../easing ../Path ../Segment ./planning".split(" "),
function(b,k,a,r,l,h){r=function(d){function c(f,g){var p=d.call(this)||this;p._preallocSegments=[new l.Segment,new l.Segment,new l.Segment];p.update(f,g);return p}k._inheritsLoose(c,d);var e=c.prototype;e.update=function(f,g){if(f){this.definition?this.definition.copyFrom(f):this.definition=f.clone();var p=null;g&&g.apex&&(p=h.optimalDistance(f,g.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==p?this._updateWithoutApex():this._updateWithApex(p,g.apex)}};e.segmentInterpolateComponentsAt=
function(f,g,p){p=f.interpolateComponentsAt(g,p);f===this._ascensionSegment?p.zoom=a.outQuad(p.zoom):f===this._descensionSegment&&(p.zoom=a.inQuad(p.zoom));return p};e._updateWithApex=function(f,g){const [p,n,w]=this._preallocSegments,q=null!=g.ascensionFactor?g.ascensionFactor:.5;g=Math.min(1-q,null!=g.ascensionFactor?g.descensionFactor:.5);const m=1-q-g;p.definition?p.definition.copyFrom(this.definition):p.definition=this.definition.clone();p.definition.compared.targetZoom=f;p.definition.compared.pan=
this.definition.compared.pan*q;p.definition.compared.rotate=this.definition.compared.rotate*q;p.update();this._ascensionSegment=p;this.segments.push(p);0<m&&(n.definition?n.definition.copyFrom(this.definition):n.definition=this.definition.clone(),n.definition.copyFrom(this.definition),n.definition.compared.sourceZoom=f,n.definition.compared.targetZoom=f,n.definition.compared.pan=this.definition.compared.pan*m,n.definition.compared.rotate=this.definition.compared.rotate*m,n.update(),this.segments.push(n));
w.definition?w.definition.copyFrom(this.definition):w.definition=this.definition.clone();w.definition.compared.sourceZoom=f;w.definition.compared.pan=this.definition.compared.pan*g;w.definition.compared.rotate=this.definition.compared.rotate*g;w.update();this._descensionSegment=w;this.segments.push(w)};e._updateWithoutApex=function(){const [f]=this._preallocSegments;f.update(this.definition);this.segments.push(f)};return c}(r.Path);b.Path=r;b.default=r;Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(){this.segments=[]}var l=r.prototype;l.interpolateComponentsAt=function(h,d){h=Math.min(Math.max(h,0),1);h*=this.time;var c=0,e=0;const f=this.definition;for(let g=0;g<this.segments.length;g++){const p=this.segments[g],n=p.definition;if(h<=p.time||g===this.segments.length-1)return d=this.segmentInterpolateComponentsAt(p,h/p.time,d),d.pan=f.hasPan?
(c+n.compared.pan*d.pan)/f.compared.pan:1,d.rotate=f.hasRotate?(e+n.compared.rotate*d.rotate)/f.compared.rotate:1,h=d.zoom*(n.compared.targetZoom-n.compared.sourceZoom)+n.compared.sourceZoom,c=this.segments[0].definition.compared.sourceZoom,e=this.segments[this.segments.length-1].definition.compared.targetZoom,d.zoom=f.hasZoom?(h-c)/(e-c):1,d;h-=p.time;c+=n.compared.pan;e+=n.compared.rotate}};l.segmentInterpolateComponentsAt=function(h,d,c){return h.interpolateComponentsAt(d,c)};k._createClass(r,
[{key:"time",get:function(){return this.segments.reduce((h,d)=>h+d.time,0)}}]);return r}();b.Path=a;b.default=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(h){h&&this.update(h)}var l=r.prototype;l.update=function(h){h&&(this.definition?this.definition.copyFrom(h):this.definition=h.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};
l._updatePrecomputedVariables=function(){var h=this.definition;const d=h.compared,c=d.sourceZoom,e=d.targetZoom;this._zoomSign=c>e?1:-1;this._panPixelsAtSource=d.pan*h.source.pixelsPerPanAtZoom(c);h=(h.source.pixelsPerRotateAtZoom(c)+h.target.pixelsPerRotateAtZoom(e))/2;this._rotatePixels=d.rotate*h};l._updatePixelFlow=function(){var h=this.definition.compared.sourceZoom,d=this.definition.compared.targetZoom;const {hasZoom:c,hasPan:e,hasRotate:f}=this.definition;var g=0,p=0;c&&(e&&(g=(d/h-1)/(-1/
(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),f&&(p=Math.log(h/d)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;h=this.definition.desiredPixelFlow;c&&e&&f?(d=g+p+g*p,this._zoomPixelFlow=g*p/d*h,this._panPixelFlow=p/d*h,this._rotatePixelFlow=g/d*h):c&&e?(p=1+g,this._zoomPixelFlow=g/p*h,this._panPixelFlow=1/p*h):c&&f?(g=1+p,this._zoomPixelFlow=p/g*h,this._rotatePixelFlow=
1/g*h):e&&f?(g=this._panPixelsAtSource/this._rotatePixels,p=1+g,this._panPixelFlow=g/p*h,this._rotatePixelFlow=1/p*h):e?this._panPixelFlow=h:c?this._zoomPixelFlow=h:f&&(this._rotatePixelFlow=h);this.time=f?this.rotateTime:c?this.zoomTime:e?this.panTime:0};l._interpolateComponentsZoom=function(h){if(0===h||1===h)return h;if(this.definition.hasZoom){const d=this.definition.compared.sourceZoom,c=this.definition.compared.targetZoom;return(d*Math.pow(d/c,-h)-d)/(c-d)}return h};l._interpolateComponentsPan=
function(h){if(0===h||1===h)return h;if(this.definition.hasPan&&this.definition.hasZoom){const d=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(Math.pow(2,d*h*this.time)-1)/(d*Math.LN2)}return h};l._interpolateComponentsRotate=function(h){return h};l.interpolateComponentsAt=function(h,d){h=Math.min(Math.max(h,0),1);const c=this._interpolateComponentsZoom(h),e=this._interpolateComponentsPan(h);h=this._interpolateComponentsRotate(h);
d?(d.zoom=c,d.pan=e,d.rotate=h):d={zoom:c,pan:e,rotate:h};return d};k._createClass(r,[{key:"zoomTime",get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow:0}},{key:"panTime",get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){const h=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*
this._panPixelsAtSource*h+1)/(h*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0}},{key:"rotateTime",get:function(){return this.definition.hasRotate?this._rotatePixels/this._rotatePixelFlow:0}}]);return r}();b.Segment=a;b.default=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports","./functions"],function(b,k){function a(r,l){const h=Math.max(r.compared.sourceZoom,r.compared.targetZoom);
r=r.source.zoomAtPixelsPerPan(r.desiredPixelFlow/r.compared.pan)/2;return r<h?null!=l.maximumDistance?h+(l.maximumDistance-h)/2:1.5*h:l.maximumDistance?Math.min(l.maximumDistance,r):r}b.optimalDistance=function(r,l){let h=a(r,l);const d={ascensionFactor:null!=l.ascensionFactor?l.ascensionFactor:.5,descensionFactor:null!=l.descensionFactor?l.descensionFactor:.5};var c=0===d.ascensionFactor,e=0===d.descensionFactor;const f=c?k.tAscensionZoomOnly:k.tAscensionZoomPan,g=c?k.dtAscensionZoomOnly:k.dtAscensionZoomPan,
p=c?k.ddtAscensionZoomOnly:k.ddtAscensionZoomPan,n=e?k.tDescensionZoomOnly:k.tDescensionZoomPan,w=e?k.dtDescensionZoomOnly:k.dtDescensionZoomPan,q=e?k.ddtDescensionZoomOnly:k.ddtDescensionZoomPan;c=C=>f(r,C,d)+k.tPanion(r,C,d)+n(r,C,d);e=C=>g(r,C,d)+k.dtPanion(r,C,d)+w(r,C,d);const m=C=>p(r,C,d)+k.ddtPanion(r,C,d)+q(r,C,d);let u=c(h);const v=k.tBaseLine(r),y=l.maximumIterations||20,B=null!=l.maximumDistance?l.maximumDistance:Infinity;for(l=0;l<y;l++){var x=(e(h)+1E-6)/m(h);if(isNaN(x)||h>=B&&0>x){if(!isFinite(B))return null;
h=B;u=c(h);break}h-=x;if(h<r.compared.sourceZoom||h<r.compared.targetZoom)return null;x=c(h);if(.005>=Math.abs(x-u)/u)break;u=x}return u>.7*v||h<r.compared.sourceZoom||h<r.compared.targetZoom?null:h};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(b){b.ddtAscensionZoomOnly=function(k,a){return-k.halfWindowSize/(a*a*k.desiredPixelFlow*Math.LN2)};b.ddtAscensionZoomPan=function(k,a,r){const l=a-k.compared.sourceZoom,
h=1/l,d=1/a,c=Math.log(k.compared.sourceZoom*d);r=(r.ascensionFactor*Math.LN2*k.compared.pan+k.halfWindowPanAtZoom(l))/k.halfWindowPanAtZoom(1);return k.halfWindowSize*h*(-2*h*d*r+2*h*c+2*d-2*c*r/(l*l)-r/(a*a))/(k.desiredPixelFlow*Math.LN2)};b.ddtDescensionZoomOnly=function(k,a){return-k.halfWindowSize/(a*a*k.desiredPixelFlow*Math.LN2)};b.ddtDescensionZoomPan=function(k,a,r){const l=a-k.compared.targetZoom,h=1/l,d=1/a,c=Math.log(a/k.compared.targetZoom);r=(k.halfWindowPanAtZoom(a)+r.descensionFactor*
Math.LN2*k.compared.pan-k.halfWindowPanAtZoom(k.compared.targetZoom))/k.halfWindowPanAtZoom(1);return k.halfWindowSize*h*(-2*h*d*r-2*h*c+2*d+2*c*r/(l*l)-r/(a*a))/(k.desiredPixelFlow*Math.LN2)};b.ddtPanion=function(k,a,r){return-2*k.compared.pan*k.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(k.desiredPixelFlow*k.halfWindowPanAtZoom(a*a*a))};b.dtAscensionZoomOnly=function(k,a){return k.halfWindowSize/(a*k.desiredPixelFlow*Math.LN2)};b.dtAscensionZoomPan=function(k,a,r){const l=1/a,h=Math.log(k.compared.sourceZoom*
l),d=1/k.desiredPixelFlow,c=1/Math.LN2;a-=k.compared.sourceZoom;const e=1/a;r=(r.ascensionFactor*Math.LN2*k.compared.pan+k.halfWindowPanAtZoom(a))/k.halfWindowPanAtZoom(1);return k.halfWindowSize*l*d*c*e*r-k.halfWindowSize*h*d*c*e+k.halfWindowSize*h*d*c*r/(a*a)};b.dtDescensionZoomOnly=function(k,a){return k.halfWindowSize/(a*k.desiredPixelFlow*Math.LN2)};b.dtDescensionZoomPan=function(k,a,r){const l=Math.log(a/k.compared.targetZoom),h=1/k.desiredPixelFlow,d=1/Math.LN2,c=-a+k.compared.targetZoom,e=
1/c;r=(-k.halfWindowPanAtZoom(a)-r.descensionFactor*Math.LN2*k.compared.pan+k.halfWindowPanAtZoom(k.compared.targetZoom))/k.halfWindowPanAtZoom(1);return-k.halfWindowSize*l*h*d*e+k.halfWindowSize*l*h*d*r/(c*c)+k.halfWindowSize*h*d*e*r/a};b.dtPanion=function(k,a,r){return k.compared.pan*k.halfWindowSize*(r.ascensionFactor+r.descensionFactor-1)/(k.desiredPixelFlow*k.halfWindowPanAtZoom(a*a))};b.tAscensionZoomOnly=function(k,a){return-k.halfWindowSize*Math.log(k.compared.sourceZoom/a)/(k.desiredPixelFlow*
Math.LN2)};b.tAscensionZoomPan=function(k,a,r){const l=k.halfWindowPanAtZoom(a-k.compared.sourceZoom);return-k.halfWindowSize*(r.ascensionFactor*Math.LN2*k.compared.pan+l)*Math.log(k.compared.sourceZoom/a)/(k.desiredPixelFlow*Math.LN2*l)};b.tBaseLine=function(k){const a=Math.LN2*k.compared.pan,r=k.halfWindowPanAtZoom(k.compared.sourceZoom-k.compared.targetZoom),l=k.halfWindowSize*Math.log(k.compared.sourceZoom/k.compared.targetZoom)/(k.desiredPixelFlow*Math.LN2*r);return k.compared.sourceZoom<=k.compared.targetZoom?
l*(a-r):l*(a+r)};b.tDescensionZoomOnly=function(k,a){return k.halfWindowSize*Math.log(a/k.compared.targetZoom)/(k.desiredPixelFlow*Math.LN2)};b.tDescensionZoomPan=function(k,a,r){return k.halfWindowSize*(-k.halfWindowPanAtZoom(a)-r.descensionFactor*Math.LN2*k.compared.pan+k.halfWindowPanAtZoom(k.compared.targetZoom))*Math.log(a/k.compared.targetZoom)/(k.desiredPixelFlow*Math.LN2*k.halfWindowPanAtZoom(-a+k.compared.targetZoom))};b.tPanion=function(k,a,r){return-k.compared.pan*k.halfWindowSize*(r.ascensionFactor+
r.descensionFactor-1)/(k.desiredPixelFlow*k.halfWindowPanAtZoom(a))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../ViewAnimation ./CameraController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){b.AnimationController=function(u){function v(){return u.apply(this,arguments)||this}k._inheritsLoose(v,u);var y=v.prototype;y.onControllerStart=function(){this.state=m.State.Running;l.isSome(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())};y.updateStateFromViewAnimation=function(){!l.isSome(this.viewAnimation)||this.state!==m.State.Ready&&this.state!==m.State.Running||(this.viewAnimation.state===
q.State.FINISHED?this.finish():this.viewAnimation.state===q.State.STOPPED&&(this.state=m.State.Stopped))};y.onControllerEnd=function(){l.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===m.State.Finished?this.viewAnimation.finish():this.state===m.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===m.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(w.createAbortError()))};y.finish=function(){this.finishController()};k._createClass(v,[{key:"canStop",
get:function(){return!0}},{key:"asyncResult",set:function(B){this._asyncResult&&(this._asyncResult.reject(w.createAbortError()),this._asyncResult=null);this.state===m.State.Finished||this.state===m.State.Stopped?this.state===m.State.Finished?B.resolve():B.reject(w.createAbortError()):this._asyncResult=B},get:function(){return this._asyncResult}}]);return v}(m.CameraController);b.AnimationController=a.__decorate([f.subclass("esri.views.3d.state.controllers.AnimationController")],b.AnimationController);
Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){(function(w){w.Ready="ready";w.Rejected="rejected";w.Running="running";w.Stopped="stopped";w.Finished="finished"})(b.State||(b.State={}));b.CameraController=function(w){function q(){var u=w.apply(this,arguments)||this;u.state=b.State.Ready;return u}k._inheritsLoose(q,w);var m=q.prototype;m.stopController=function(){return this.canStop?(this.state=b.State.Stopped,!0):!1};m.finishController=function(){this.state=b.State.Finished};k._createClass(q,[{key:"active",get:function(){return this.state===
b.State.Running}},{key:"isInteractive",get:function(){return!1}},{key:"canStop",get:function(){return!1}},{key:"steppingFinished",get:function(){return!1}}]);return q}(n);a.__decorate([d.property({readOnly:!0,dependsOn:["state"]})],b.CameraController.prototype,"active",null);a.__decorate([d.property()],b.CameraController.prototype,"state",void 0);b.CameraController=a.__decorate([e.subclass("esri.views.3d.state.controllers.CameraController")],b.CameraController);Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/maybe ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../../support/stack ../../../../chunks/vector ../../support/geometryUtils ../../webgl-engine/lib/Camera ../../support/geometryUtils/coordinateSystem".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){function u(na,oa,ua){const za=p.sm4d.get();c.identity(za);c.rotate(za,za,ua[3],w.axisAngle.axis(ua));h.subtract(na.eye,na.eye,oa);h.transformMat4(na.eye,na.eye,za);h.add(na.eye,na.eye,oa);h.subtract(na.center,na.center,oa);h.transformMat4(na.center,na.center,za);h.add(na.center,na.center,oa);h.transformMat4(na.up,na.up,za);na.markViewDirty()}function v(na,oa){h.set(oa,0,0,0);for(const ua of na)h.add(oa,oa,ua);h.scale(oa,oa,1/na.length)}function y(na,oa,ua,
za){return Math.sin(na/h.length(oa))*(ua+za.radius)}function B(na,oa,ua,za){ua=w.ray.fromScreenAtEye(oa,ua,la);if(k.isNone(ua))return!1;w.sphere.closestPointOnSilhouette(na,ua,M);return w.sphere.intersectRay(na,ua,za)?h.squaredDistance(M,ua.origin)<h.squaredDistance(za,ua.origin)?(h.copy(za,M),!1):!0:(h.subtract(T,oa.eye,oa.center),h.normalize(T,T),w.plane.fromNormalAndOffset(T,-h.dot(h.normalize(T,T),M),O),w.plane.intersectRay(O,ua,za),!1)}function x(na,oa,ua,za,Fa,La){h.cross(ia,na,oa);h.subtract(Z,
na,oa);h.length(na)<=Fa||!za.aboveGround?(h.cross(ua,Z,za.eye),na=h.dot(na,oa)/(h.length(na)*h.length(oa)),La=Math.cos(a.clamp(d.cyclicalPI.normalize(a.deg2rad(La)),0,L)),oa=-a.acosClamped(na)-Math.max(0,h.length(oa)-Fa)/(La*Fa)):(h.subtract(Q,za.eye,za.center),h.cross(ua,Z,Q),oa=-h.length(Z)/Fa);h.normalize(ua,ua);h.scale(ua,ua,h.length(ia));return oa}function C(na,oa,ua,za){za=Math.cos(a.clamp(d.cyclicalPI.normalize(a.deg2rad(za)),0,L));oa=oa>ua?-(oa-ua)/(za*ua):oa<-ua?Math.PI-(oa+ua)/(za*ua):a.acosClamped(oa/
ua);return((na>ua?-(na-ua)/(za*ua):na<-ua?Math.PI-(na+ua)/(za*ua):a.acosClamped(na/ua))-oa)*ua}function z(na,oa,ua,za,Fa,La,Sa,Ia,Qa,Pa){Qa=C(na[2],oa[2],Sa.radius,Qa);oa=Pa?C(na[0],oa[0],Sa.radius,180):oa[0]-na[0];na=Math.sin(Ia)*oa-Math.cos(Ia)*Qa;Ia=Math.cos(Ia)*oa+Math.sin(Ia)*Qa;h.normalize(Y,Fa);Fa=Pa?na/Math.sqrt(Math.abs(Math.pow(Sa.radius,2)-Math.pow(h.dot(ua,Y),2))):na/Sa.radius;ua=Ia/Math.sqrt(Math.abs(Math.pow(Sa.radius,2)-Math.pow(h.dot(ua,za),2)));g.set(La,Fa,ua)}function A(na,oa,ua,
za,Fa,La,Sa,Ia,Qa,Pa){h.cross(ia,na,oa);m.coordinateSystemFromOneAxisAndNormalVector(La.up,La.eye,U,V,W);m.coordinateSystemFromOneAxisAndNormalVector([0,0,1],La.eye,F,N,P);h.copy(ua,N);h.copy(za,F);h.normalize(ua,ua);h.scale(ua,ua,h.length(ia));m.vectorCoordinates(na,h.normalize(V,V),h.normalize(W,W),h.normalize(U,U),X);m.vectorCoordinates(oa,V,W,U,ca);z(X,ca,na,F,N,Fa,Sa,Ia,Qa,Pa)}function t(na,oa,ua,za,Fa,La,Sa){c.identity(ka);c.identity(da);c.identity(fa);c.rotate(ka,ka,Fa,za);c.rotate(da,da,Sa,
La);c.multiply(fa,ka,da);h.subtract(oa,na,ua);h.transformMat4(oa,oa,fa);h.add(oa,oa,ua)}function D(na,oa,ua,za,Fa,La){c.identity(ka);c.identity(da);c.identity(fa);c.rotate(ka,ka,za,ua);c.rotate(da,da,La,Fa);c.multiply(fa,ka,da);h.subtract(na.eye,na.eye,oa);h.transformMat4(na.eye,na.eye,fa);h.add(na.eye,na.eye,oa);h.subtract(na.center,na.center,oa);h.transformMat4(na.center,na.center,fa);h.add(na.center,na.center,oa);h.subtract(na.up,na.up,oa);h.transformMat4(na.up,na.up,fa);h.add(na.up,na.up,oa);
na.markViewDirty()}function E(na,oa,ua,za,Fa,La,Sa=K.Pole,Ia=K.Angle){na=Math.abs(na[2])<ua*Sa||Math.abs(oa)>ua;return(Math.abs(za)>Math.PI-Ia||Math.abs(za)<Ia)&&na&&La.aboveGround&&Fa<K.Tilt?!0:!1}function G(na,oa,ua,za,Fa,La){La?(w.axisAngle.fromPoints(ua,za,aa),u(oa,na.center,aa)):(ua=x(ua,za,ja,oa,na.radius,Fa),u(oa,na.center,w.axisAngle.wrapAxisAngle(ja,ua)))}function H(na,oa,ua,za,Fa,La,Sa){const Ia=Sa?20:1;h.copy(ea,za);ba.copyFrom(oa);let Qa;for(let Pa=0;Pa<Ia&&1E-12<h.squaredDistance(ua,
ea);Pa++)if(za=h.squaredDistance(ua,ea),A(ua,ea,N,F,R,ba,na,Fa,La,Sa),D(ba,na.center,F,R[1],N,R[0]),t(ea,ea,na.center,F,R[1],N,R[0]),Qa=h.squaredDistance(ua,ea),Qa<za||0===Pa)oa.copyFrom(ba);else break}const I=r.createScreenPointArray();(function(na){na[na.Vertical=0]="Vertical";na[na.Horizontal=1]="Horizontal"})(b.NavigationMode||(b.NavigationMode={}));const J={Elevation:3E4,Angle:a.deg2rad(6)},K={Pole:.95,Angle:a.deg2rad(18),Tilt:45},L=a.deg2rad(80),S=l.create(),M=l.create(),T=l.create(),O=w.plane.create(),
Q=l.create(),F=l.create(),N=l.create(),P=l.create(),U=l.create(),V=l.create(),W=l.create(),X=l.create(),ca=l.create(),R=f.create(),aa=w.axisAngle.create(),ka=e.create(),da=e.create(),fa=e.create(),ea=l.create(),Y=l.create(),Z=l.create(),ba=new q,ia=l.create(),ja=l.create(),la={origin:l.create(),direction:l.create()},qa={origin:l.create(),direction:l.create()};b.PreservingHeadingThreshold=K;b.TiltThresholdPanningSpeed=L;b.VerticalPanTresholds=J;b.applyPanPlanar=function(na,oa,ua){h.subtract(S,ua,oa);
h.subtract(na.eye,na.eye,S);h.subtract(na.center,na.center,S);na.markViewDirty()};b.applyPanSphericalDirectRotation=G;b.applyPanSphericalPreserveHeading=H;b.applyRotation=u;b.applyRotationWithTwoAxes=D;b.applyZoomOnSphere=function(na,oa,ua){oa.getScreenCenter(I);w.sphere.intersectScreen(na,oa,I,oa.center);oa.markViewDirty();na=oa.distance;ua*=na;1E-6>Math.abs(na-ua)||(ua=h.scale(p.sv3d.get(),oa.viewForward,ua),h.subtract(oa.eye,oa.center,ua),oa.markViewDirty())};b.applyZoomToPoint=function(na,oa,
ua,za){const Fa=p.sv3d.get();ua=1-ua;h.subtract(Fa,oa,na.eye);const La=h.length(Fa);let Sa=La*(1-ua);0<=ua&&Sa<za&&(Sa=za,ua=-(Sa-La)/La);1E-6>Math.abs(La-Sa)||(h.scale(Fa,Fa,ua),h.add(na.eye,na.eye,Fa),h.lerp(na.center,na.center,oa,ua))};b.centroid=v;b.centroidOnSphere=function(na,oa,ua){v(oa,ua);h.normalize(ua,ua);h.scale(ua,ua,na)};b.decideNavigationMode=function(na,oa,ua,za){if(h.length(na.eye)-za.radius>J.Elevation)return b.NavigationMode.Horizontal;if(!ua)return b.NavigationMode.Vertical;w.ray.fromScreenAtEye(na,
oa,qa);return-a.sign(na.relativeElevation)*(.5*Math.PI+n.angle(na.eye,qa.direction))<J.Angle?b.NavigationMode.Vertical:b.NavigationMode.Horizontal};b.intersectPlaneFromScreenPoint=function(na,oa,ua,za){return w.plane.intersectRay(na,w.ray.fromScreen(oa,ua,la),za)};b.lengthFromPoints=C;b.normalizeCoordinate=function(na,oa,ua){ua[0]=oa[0]/(na.fullWidth/na.pixelRatio);ua[1]=oa[1]/(na.fullHeight/na.pixelRatio);return ua};b.normalizeRotationDelta=function(na){for(;na>Math.PI;)na-=2*Math.PI;for(;na<-Math.PI;)na+=
2*Math.PI;return na};b.offSurfaceTiltToEyeTiltGlobal=function(na,oa,ua,za){return y(Math.PI/2,oa,ua,za)+(na-Math.PI/2)};b.onSurfaceTiltToEyeTiltGlobal=y;b.panMotionToRotationMatrix=function(na,oa,ua,za,Fa,La,Sa,Ia,Qa){if(E(na.center,h.dot(na.up,na.center),h.length(na.center),-d.cyclicalPI.normalize(a.deg2rad(La)),Sa,oa))switch(na=-d.cyclicalPI.normalize(a.deg2rad(Fa)),{eye:Fa}=oa,m.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Fa,F,N,P),Fa=ua.translation[0]*za.pan,La=ua.translation[1]*za.pan,
oa=Math.max(Math.sqrt(Math.abs(1-Math.pow(h.dot(oa.center,F),2)/Math.pow(h.length(oa.center),2))),.5),Sa=-Math.cos(na)*La+Math.sin(na)*Fa,c.rotate(Ia.pan.matrix,Ia.pan.matrix,(Math.sin(na)*La+Math.cos(na)*Fa)/oa,F),Ia.pan.enabled=!0,Qa.mode){case "pan":c.rotate(Ia.pan.matrix,Ia.pan.matrix,Sa,N);Ia.pan.enabled=!0;break;case "zoom":Ia.zoom=-ua.translation[1]*za.zoom}else{{const {eye:Pa,viewRight:sa}=oa;oa=h.cross(p.sv3d.get(),sa,Pa);na=ua.translation[0]*za.pan;0!==na&&(c.rotate(Ia.pan.matrix,Ia.pan.matrix,
-na,oa),Ia.pan.enabled=!0);switch(Qa.mode){case "pan":ua=ua.translation[1]*za.pan;0!==ua&&(c.rotate(Ia.pan.matrix,Ia.pan.matrix,ua,sa),Ia.pan.enabled=!0);break;case "zoom":Ia.zoom=-ua.translation[1]*za.zoom}}}};b.panToPosition=function(na,oa,ua,za,Fa,La,Sa){E(ua,h.dot(oa.up,ua),na.radius,-d.cyclicalPI.normalize(a.deg2rad(Fa)),La,oa,K.Pole,K.Angle)?H(na,oa,ua,za,-d.cyclicalPI.normalize(a.deg2rad(Fa)),La,Sa):G(na,oa,ua,za,La,Sa)};b.pickPointAndInitSphere=function(na,oa,ua,za,Fa){const La=l.create(),
Sa=w.sphere.create();let Ia=!0,Qa=!0;na.intersectScreen(ua,La)?Sa.radius=h.length(La):(Qa=!1,Sa.radius=oa.aboveGround?Math.max(h.length(oa.center),.9*Fa.radius):h.length(oa.eye)-oa.relativeElevation,za?B(Sa,oa,ua,La):Ia=w.sphere.intersectScreen(Sa,oa,ua,La));return{sphere:Sa,scenePickPoint:Ia?La:null,hasGeometryIntersection:Qa}};b.preserveHeadingThreshold=E;b.rotatePointAroundTwoAxes=t;b.rotationAngleAndAxisDirectRotation=x;b.rotationAnglesAndAxesHeadingPreserving=A;b.rotationAnglesHeadingPreserving=
z;b.rotationFromPointsAroundAxis=function(na,oa,ua){const za=p.sv3d.get(),Fa=p.sv3d.get(),La=p.sv3d.get();h.copy(Fa,na);h.copy(La,oa);na=h.dot(Fa,ua);oa=h.dot(La,ua);h.scale(za,ua,na);h.subtract(Fa,Fa,za);h.normalize(Fa,Fa);h.scale(za,ua,oa);h.subtract(La,La,za);h.normalize(La,La);na=h.dot(Fa,La);h.cross(za,ua,Fa);ua=h.dot(La,za);return Math.atan2(ua,na)};b.sphereOrPlanePointFromScreenPoint=B;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/geometryUtils/coordinateSystem":function(){define(["exports",
"../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../chunks/mat4"],function(b,k,a,r){function l(f){return{operations:f,value:f.create()}}function h(f,g,p,n){return f.operations.setAltitudeAt(f.value,g,p,n)}const d=k.create(),c={operations:null,value:null},e=k.create();b.altitudeAt=function(f,g){return f.operations.altitudeAt(f.value,g)};b.axisAt=function(f,g,p,n){return f.operations.axisAt(f.value,g,p,n)};b.closestPoint=function(f,g,p){return f.operations.closestPoint(f.value,g,p)};
b.closestPointOnSilhouette=function(f,g,p){return f.operations.closestPointOnSilhouette(f.value,g,p)};b.coordinateSystemFromOneAxisAndNormalVector=function(f,g,p,n,w){a.copy(p,f);a.copy(e,g);a.normalize(e,e);a.cross(n,e,p);a.cross(w,n,p)};b.create=function(f){const {value:g,operations:p}=f;return{operations:p,value:p.create(g)}};b.createFromOperations=l;b.distanceToSilhouette=function(f,g){return f.operations.distanceToSilhouette(f.value,g)};b.elevate=function(f,g,p){return f.operations.elevate(f.value,
g,p.value)};b.fromValues=function(f,g,p=l(f)){p.operations=f;f.copy(g,p.value);return p};b.intersectRay=function(f,g,p){return f.operations.intersectRay(f.value,g,p)};b.intersectRayClosestSilhouette=function(f,g,p){return f.operations.intersectRayClosestSilhouette(f.value,g,p)};b.intersectsRay=function(f,g){return f.operations.intersectRay(f.value,g,null)};b.normalAt=function(f,g,p){return f.operations.axisAt(f.value,g,2,p)};b.setAltitudeAt=h;b.setAltitudeOfTransformation=function(f,g,p,n){g!==n&&
r.copy(n,g);a.set(d,n[12],n[13],n[14]);h(f,d,p,d);n[12]=d[0];n[13]=d[1];n[14]=d[2];return n};b.setExtent=function(f,g,p){f.operations.setExtent(f.value,g,p.value);return p};b.vectorCoordinates=function(f,g,p,n,w){w[0]=a.dot(f,g);w[1]=a.dot(f,p);w[2]=a.dot(f,n);return w};b.wrap=function(f,g){c.operations=f;c.value=g;return c};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../support/featureFlags ../../../webgl-engine/lib/Intersector ../../../../animation/easing ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../PointToPointAnimationController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){b.ZoomStepController=function(x){function C(){var A=x.apply(this,arguments)||this;A.zoomLocation=n.create();A.tmpCamera=new y;A.tmpRayDir=n.create();A.tmpCenter=n.create();A.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new y,interactionDirection:null,tiltMode:0};return A}k._inheritsLoose(C,x);var z=C.prototype;z.zoomStep=function(A,t){if(this.active){var D=this.view.state,{interactionStartCamera:E}=
this.constraintOptions;this.animation.finished?E.copyFrom(D.camera):this.animation.cameraAt(1,E);this.tmpCamera.copyFrom(D.camera);D=new m.Intersector(this.view.state.mode);0<A?(this.intersectionHelper.intersectScreenFreePointFallback(t,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,D,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,D,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:w.copy(this.zoomLocation,
this.tmpCamera.center);A=Math.pow(.6,A);!q.disableContextNavigation()&&this.view._stage.getCamera()._contextNavigation&&(t=this.view._stage.renderView.getMinimalDepthForArea(t[0],t[1],this.view._stage.getCamera(),60),D=Math.max(14*Math.abs(this.view.camera.position.z),20),t=t?Math.min(t,D):D)&&(D=n.create(),w.subtract(D,this.zoomLocation,this.tmpCamera.eye),t<w.length(D)&&(w.normalize(D,D),w.add(this.zoomLocation,this.tmpCamera.eye,w.scale(D,D,t))));this.updateCamera(this.tmpCamera,A,this.zoomLocation);
this.begin(this.tmpCamera)}};z.animationSettings=function(){return{apex:null,duration:.6,easing:u.outExpo}};z.updateCamera=function(A,t,D){w.subtract(this.tmpRayDir,D,A.eye);const E=w.length(this.tmpRayDir);let G=E*t;1>=t&&4>G&&(G=4,t=G/E);1E-6>Math.abs(E-G)||(w.scale(this.tmpRayDir,this.tmpRayDir,t),w.subtract(A.eye,D,this.tmpRayDir),w.lerp(A.center,A.center,D,1-t),v.applyAll(this.view,A,this.constraintOptions))};return C}(B.PointToPointAnimationController);b.ZoomStepController=a.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],
b.ZoomStepController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../input/InputHandler ../../../input/handlers/support ../../state/controllers/RotateController".split(" "),function(b,k,a,r,l,h){r=function(d){function c(e,f,g,p){var n=d.call(this,!0)||this;n.view=e;n.pointerAction=f;n.pivotPoint=g;n.registerIncoming("drag",p,w=>n.handleDrag(w));
return n}k._inheritsLoose(c,d);c.prototype.handleDrag=function(e){const f=e.data;if(!(1<f.pointers.size)&&l.eventMatchesMousePointerAction(e.data,this.pointerAction)){var g=a.createScreenPointArray(f.center.x,f.center.y);switch(f.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=new h.RotateController({view:this.view,pivot:this.pivotPoint});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(g);
break;case "update":this.cameraController&&this.cameraController.update(g);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}e.stopPropagation()}};return c}(r.InputHandler);b.DragRotate=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../Constraints ../../camera/constraintUtils ../utils/navigationUtils ./InteractiveController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t){b.RotateController=function(D){function E(H){H=D.call(this,H)||this;H.view=null;H.pivot="center";H.lastPoint=B.create();H.tmpWorldUp=q.create();H.tmpViewDir=q.create();H.tmpRotCurPoint=B.create();H.tmpTransf=y.create();H.tmpAxis=q.create();H.tmpPivotPoint=q.create();H.pivotPos=q.create();H.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};return H}k._inheritsLoose(E,
D);var G=E.prototype;G.initialize=function(){this.rotScale="center"===this.pivot?3:1.5};G.begin=function(H){if(this.active){switch(this.pivot){case "eye":m.copy(this.pivotPos,this.beginCamera.eye);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.intersectRayFreePointFallback(this.beginCamera.ray,this.pivotPos)||m.copy(this.pivotPos,this.beginCamera.center),r("disable-feature:context-navigation")||
this.constrainPivotPoint(H),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;A.normalizeCoordinate(this.beginCamera,H,this.lastPoint)}};G.constrainPivotPoint=function(H){const I=this.beginCamera,J=q.create();var K;m.subtract(J,this.pivotPos,I.eye);this.view.camera.position.hasZ&&(K=Math.abs(this.view.camera.position.z));let L=m.length(J);
this.view.camera.position.hasZ&&L>7*K&&(L=7*K);K=u.getReferenceEllipsoid(this.view.spatialReference);var S=w.createScreenPointArray(I.width/I.pixelRatio*.5,I.height/I.pixelRatio*.5);K=A.decideNavigationMode(this.beginCamera,S,!0,K);S=this.view._stage.renderView.getMinimalDepthForArea(I.fullWidth/I.pixelRatio*.5,I.fullHeight/I.pixelRatio*.5,I,90,2.5);H=this.view._stage.renderView.getMinimalDepthForArea(H[0],H[1],I,90);if(void 0!==S||void 0!==H)S=void 0===S?H:S,H=void 0===H||K===A.NavigationMode.Horizontal?
S:H,L=S>H?H:S;m.normalize(J,J);m.copy(this.pivotPos,m.add(this.tmpPivotPoint,I.eye,m.scale(this.tmpPivotPoint,J,L)))};G.update=function(H){if(this.active){switch(this.pivot){case "eye":var I=this.currentCamera.center;break;case "center":this.currentCamera.center=this.pivotPos,I=this.currentCamera.eye}this.applyRotation(this.currentCamera,H,I,this.pivotPos);z.applyAll(this.view,this.currentCamera,this.constraintOptions)}};G.end=function(){this.active&&this.finishController()};G.applyRotation=function(H,
I,J,K){this.view.renderCoordsHelper.worldUpAtPosition(K,this.tmpWorldUp);A.normalizeCoordinate(H,I,this.tmpRotCurPoint);I=(this.lastPoint[1]-this.tmpRotCurPoint[1])*this.rotScale;let L=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;m.subtract(this.tmpViewDir,J,K);var S=m.length(this.tmpViewDir);S=n.acosClamped(m.dot(this.tmpViewDir,this.tmpWorldUp)/S);if("eye"===this.pivot){const M=.5*Math.PI-S,T=.495*Math.PI;I=M-Math.max(-T,Math.min(T,M+-.5*I))}I=n.clamp(I+S,C.TiltDefault.min,C.TiltDefault.max)-
S;v.identity(this.tmpTransf);m.cross(this.tmpAxis,H.up,this.tmpViewDir);"center"===this.pivot&&(L=-L);v.rotate(this.tmpTransf,this.tmpTransf,L,this.tmpWorldUp);v.rotate(this.tmpTransf,this.tmpTransf,I,this.tmpAxis);m.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);m.add(J,K,this.tmpViewDir);m.transformMat4(H.up,H.up,this.tmpTransf);x.copy(this.lastPoint,this.tmpRotCurPoint);H.markViewDirty()};k._createClass(E,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return E}(t.InteractiveController);a.__decorate([d.property({constructOnly:!0})],b.RotateController.prototype,"view",void 0);a.__decorate([d.property()],b.RotateController.prototype,"pivot",void 0);b.RotateController=a.__decorate([e.subclass("esri.views.3d.state.controllers.RotateController")],b.RotateController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../webgl-engine/lib/Camera ./CameraController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){b.InteractiveController=function(q){function m(){var v=q.apply(this,arguments)||this;v.beginCamera=new n;v.currentCamera=new n;return v}k._inheritsLoose(m,q);var u=m.prototype;u.stepController=function(v,y){y.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(y)};u.onControllerStart=function(v){this.state=w.State.Running;this.beginCamera.copyFrom(v);this.currentCamera.copyFrom(v)};u.onControllerEnd=function(v){v.copyViewFrom(this.currentCamera)};k._createClass(m,
[{key:"isInteractive",get:function(){return!0}}]);return m}(w.CameraController);b.InteractiveController=a.__decorate([e.subclass("esri.views.3d.state.controllers.InteractiveController")],b.InteractiveController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../input/InputHandler ../../../input/handlers/support ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController".split(" "),
function(b,k,a,r,l,h,d){r=function(c){function e(f,g,p){var n=c.call(this,!0)||this;n.view=f;n.pointerAction=g;n.registerIncoming("drag",p,w=>n.handleDrag(w));return n}k._inheritsLoose(e,c);e.prototype.handleDrag=function(f){const g=f.data;if(!(1<g.pointers.size)&&l.eventMatchesMousePointerAction(f.data,this.pointerAction)){var p=a.createScreenPointArray(g.center.x,g.center.y);switch(g.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
this.view.state.isGlobal?new h.ZoomController({view:this.view}):new d.ZoomController({view:this.view});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(p);break;case "update":this.cameraController&&this.cameraController.update(p);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}f.stopPropagation()}};return e}(r.InputHandler);b.DragZoom=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../geometry/projectionEllipsoid ../../../../../chunks/vec2f64 ../../../../../chunks/vec2 ../../../support/geometryUtils ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils ../../utils/navigationUtils ../InteractiveController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){b.ZoomController=function(A){function t(E){E=A.call(this,E)||this;E.view=null;E.pickPoint=w.create();E.tmpP0=u.create();E.panAxisAngle=y.axisAngle.create();E.tmpRayDir=w.create();E.targetOnSphere=w.create();E.tmpRay={origin:w.create(),direction:w.create()};E.dragBeginPoint=n.createScreenPointArray();E.normalizedAnchorPoint=u.create();E.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0};E.sphere=y.sphere.create();E.hasPickPoint=!1;return E}k._inheritsLoose(t,A);var D=t.prototype;D.begin=function(E){if(this.active){v.copy(this.dragBeginPoint,E);C.normalizeCoordinate(this.beginCamera,E,this.normalizedAnchorPoint);var G=m.getReferenceEllipsoid(this.view.spatialReference),H=C.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,E,!1,G);this.navMode=C.decideNavigationMode(this.beginCamera,E,H.hasGeometryIntersection,G);if(this.navMode===C.NavigationMode.Horizontal||
r("disable-feature:context-navigation"))this.hasPickPoint=!!H.scenePickPoint,this.pickPoint=H.scenePickPoint,this.sphere=H.sphere;else{y.ray.fromScreenAtEye(this.beginCamera,E,this.tmpRay);q.normalize(this.tmpRay.direction,this.tmpRay.direction);let I;this.view.camera.position.hasZ&&(I=Math.abs(this.view.camera.position.z));G=30*I;E=this.view._stage.renderView.getMinimalDepthForArea(E[0],E[1],this.view._stage.getCamera(),70);G=G>E?E:G;this.hasPickPoint=!0;q.scale(this.tmpRay.direction,this.tmpRay.direction,
G);q.add(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.beginCamera}};D.update=function(E){if(this.active){this.currentCamera.eye=this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;if(this.navMode===C.NavigationMode.Horizontal||r("disable-feature:context-navigation")){q.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var G=q.length(this.tmpRayDir);C.normalizeCoordinate(this.currentCamera,
E,this.tmpP0);var H=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),I=G*Math.pow(2,H);const J=this.view.state.constraints.minimumPoiDistance;0>H&&I<J&&(I=J);if(1E-6>Math.abs(G-I))return;this.hasPickPoint&&I<G&&(H=1-(1-I/G)*(1-this.sphere.radius/q.length(this.currentCamera.center)),q.scale(this.currentCamera.center,this.currentCamera.center,H));q.scale(this.tmpRayDir,this.tmpRayDir,-I/G);q.add(this.currentCamera.eye,this.currentCamera.center,this.tmpRayDir);this.constraintOptions.interactionFactor=
x.pixelDistanceToInteractionFactor(this.dragBeginPoint,E);x.applyAll(this.view,this.currentCamera,this.constraintOptions);this.hasPickPoint&&(C.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),y.axisAngle.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),C.applyRotation(this.currentCamera,this.sphere.center,this.panAxisAngle))}else{G=q.length(this.tmpRay.direction);C.normalizeCoordinate(this.currentCamera,E,this.tmpP0);E=12*(this.normalizedAnchorPoint[1]-
this.tmpP0[1]);I=G*Math.pow(2,E);H=this.view.state.constraints.minimumPoiDistance;0>E&&I<H&&(I=H);if(1E-6>Math.abs(G-I))return;q.scale(this.tmpRayDir,this.tmpRay.direction,1-I/G);q.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir);q.add(this.currentCamera.center,this.currentCamera.center,this.tmpRayDir)}B.applySurfaceCollisionConstraint(this.view,this.currentCamera)}};D.end=function(){this.active&&this.finishController()};k._createClass(t,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return t}(z.InteractiveController);a.__decorate([d.property({constructOnly:!0})],b.ZoomController.prototype,"view",void 0);b.ZoomController=a.__decorate([e.subclass("esri.views.3d.state.controllers.global.ZoomController")],b.ZoomController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/vec2f64 ../../../../../chunks/vec2 ../../../support/geometryUtils ../../../camera/constraintUtils ../../utils/navigationUtils ../InteractiveController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C){b.ZoomController=function(z){function A(D){D=z.call(this,D)||this;D.view=null;D.tmpP=q.create();D.tmpDir=q.create();D.tmpN=q.create();D.tmpP0=u.create();D.tmpPoi=q.create();D.tmpRayDir=q.create();D.dragBeginPoint=w.createScreenPointArray();D.normalizedAnchorPoint=u.create();D.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:q.create(),tiltMode:0};D.plane=y.plane.create();return D}
k._inheritsLoose(A,z);var t=A.prototype;t.begin=function(D){if(this.active){v.copy(this.dragBeginPoint,D);x.normalizeCoordinate(this.beginCamera,D,this.normalizedAnchorPoint);this.intersectionHelper.intersectScreenFreePointFallback(D,this.tmpP);m.subtract(this.tmpDir,this.tmpP,this.beginCamera.eye);m.normalize(this.tmpDir,this.tmpDir);var E;this.view.camera.position.hasZ&&(E=Math.abs(this.view.camera.position.z));E*=30;D=this.view._stage.renderView.getMinimalDepthForArea(D[0],D[1],this.view._stage.getCamera(),
70);m.scale(this.tmpDir,this.tmpDir,E>D?D:E);m.add(this.tmpP,this.beginCamera.eye,this.tmpDir);m.subtract(this.tmpN,this.beginCamera.eye,this.beginCamera.center);m.normalize(this.tmpN,this.tmpN);0>this.tmpN[1]&&m.negate(this.tmpN,this.tmpN);y.plane.fromPositionAndNormal(this.tmpP,this.tmpN,this.plane);this.constraintOptions.interactionStartCamera=this.beginCamera}};t.update=function(D){if(this.active){x.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||
m.copy(this.tmpPoi,this.currentCamera.center);x.normalizeCoordinate(this.currentCamera,D,this.tmpP0);var E=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);v.copy(this.normalizedAnchorPoint,this.tmpP0);m.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var G=m.length(this.tmpRayDir),H=G*(1-E);m.copy(this.constraintOptions.interactionDirection,this.tmpRayDir);m.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,n.sign(E)/G);var I=this.view.state.constraints.minimumPoiDistance;
0<=E&&H<I&&(H=I,E=-(H-G)/G);1E-6>Math.abs(G-H)||(m.scale(this.tmpRayDir,this.tmpRayDir,E),m.add(this.currentCamera.eye,this.currentCamera.eye,this.tmpRayDir),m.lerp(this.currentCamera.center,this.currentCamera.center,this.tmpPoi,E),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=
B.pixelDistanceToInteractionFactor(this.dragBeginPoint,D),B.applyAll(this.view,this.currentCamera,this.constraintOptions))}};t.end=function(){this.active&&this.finishController()};k._createClass(A,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return A}(C.InteractiveController);a.__decorate([d.property({constructOnly:!0})],b.ZoomController.prototype,"view",void 0);b.ZoomController=a.__decorate([e.subclass("esri.views.3d.state.controllers.local.ZoomController")],
b.ZoomController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/watchUtils ../../../input/InputHandler ../../state/controllers/GamepadKeyboardController".split(" "),function(b,k,a,r,l,h){l=function(d){function c(f){var g=d.call(this,!0)||this;g.view=f;g.watchHandles=new a;g.handle=g.registerIncoming("gamepad",p=>g.handleEventGamepad(p));
g.handle.pause();return g}k._inheritsLoose(c,d);var e=c.prototype;e.onInstall=function(f){d.prototype.onInstall.call(this,f);this.watchHandles.add([r.init(this.view.navigation.gamepad,"enabled",g=>{g?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null))}),this.view.navigation.gamepad.watch("device",g=>{this.cameraControllerGamepad&&g&&this.cameraControllerGamepad.gamepadDevice!==g&&(this.cameraControllerGamepad.finishController(),
this.cameraControllerGamepad=null)})])};e.onUninstall=function(){this.watchHandles.removeAll();d.prototype.onUninstall.call(this)};e.handleEventGamepad=function(f){var g=this.view.navigation.gamepad.device;if(!g||f.data.device===g)if((g=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||h.GamepadKeyboardController.activatesFor(this.view,f.data))g||(g=new h.GamepadKeyboardController({view:this.view,gamepadDevice:f.data.device}),this.view.state.switchCameraController(g)&&(this.cameraControllerGamepad=
g)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===f.data.device&&this.cameraControllerGamepad.handleEventGamepad(f.data)};return c}(l.InputHandler);b.GamepadNavigation=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/compilerUtils ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../navigation/gamepadAndKeyboardUtils ../Constraints ../../support/stack ../../support/geometryUtils ../utils/viewUtils ../../camera/constraintUtils ../../webgl-engine/lib/Camera ../utils/navigationUtils ./InteractiveController ../../support/cameraUtilsInternal ../../support/cameraUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K){b.GamepadKeyboardController=function(N){function P(V){V=N.call(this,V)||this;V.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};V.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];V.tmpCamera=new G;V.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new G,interactionFactor:0,interactionDirection:null,tiltMode:1};return V}k._inheritsLoose(P,N);var U=P.prototype;U.handleEventGamepad=function(V){const W=
C.extractTransformation(V,this.view.navigation.gamepad,this.transformation);("end"===V.action||C.isZeroTransformation(W))&&this.finishController()};U.activateDirection=function(V){this.keysButtonState[V]=1;C.extractTransformationKeyboard(this.keysButtonState,this.transformation)};U.deactivateDirection=function(V){this.keysButtonState[V]=0;V=C.extractTransformationKeyboard(this.keysButtonState,this.transformation);C.isZeroTransformation(V)&&this.finishController()};U.onControllerStart=function(V){this.filteredSurfaceElevation=
this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;N.prototype.onControllerStart.call(this,V)};U.updateFilteredSurfaceElevation=function(V){this.filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*V};U.stepController=function(V,W){this.updateStartHeading();this.updateFilteredSurfaceElevation(V);this.currentCamera.copyViewFrom(W);this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);
this.calculateControlTransformation(V,this.currentCamera,O);this.applyDisabledMovementTypes(O);this.applyPan(O.pan);this.applyRotate(O.rotate);this.applyZoom(O.zoom);this.applyAscend(O.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;E.applyAll(this.view,this.currentCamera,this.constraintOptions);N.prototype.stepController.call(this,V,W)};U.updateStartHeading=function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};U.applyRotate=
function(V){if(V.enabled){var W=this.currentCamera,{center:X,up:ca,eye:R}=W;u.subtract(X,X,R);u.transformMat4(X,X,V.matrix);u.add(X,X,R);u.transformMat4(ca,ca,V.matrix);W.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;E.applyAll(this.view,W,this.constraintOptions)}};U.applyPan=function(V,W=this.currentCamera){if(V.enabled){var {center:X,eye:ca,up:R}=W;u.transformMat4(ca,ca,V.matrix);u.transformMat4(X,X,V.matrix);this.view.state.isGlobal&&u.transformMat4(R,
R,V.matrix);W.markViewDirty();this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;E.applyAll(this.view,W,this.constraintOptions)}};U.applyZoom=function(V){if(V){var {eye:W,viewForward:X}=this.currentCamera;u.add(W,W,u.scale(A.sv3d.get(),X,V));this.currentCamera.markViewDirty();u.copy(Q,X);u.negate(Q,Q);this.constraintOptions.interactionDirection=Q;this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;E.applyAll(this.view,this.currentCamera,this.constraintOptions);
this.constraintOptions.interactionDirection=null}};U.applyAscend=function(V){if(V){var {center:W,eye:X}=this.currentCamera,ca=this.view.renderCoordsHelper.worldUpAtPosition(X,A.sv3d.get());this.constraintOptions.interactionDirection=u.copy(Q,ca);this.view.state.isGlobal?(ca=u.length(X),V=(ca+V)/ca,u.scale(X,X,V),u.scale(W,W,V)):(V=u.scale(A.sv3d.get(),ca,V),u.add(X,X,V),u.add(W,W,V));this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=
8;E.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;E.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};U.calculateControlTransformation=function(V,W,X){X.zoom=0;X.ascend=0;X.pan.enabled=!1;B.identity(X.pan.matrix);X.rotate.enabled=!1;B.identity(X.rotate.matrix);V=this.computeVelocities(V);this.view.state.isLocal?this.calculateControlTransformationLocal(V,W,X):
this.calculateControlTransformationGlobal(V,W,X)};U.updateCameraCenter=function(){const {ray:V,center:W}=this.currentCamera;this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(V,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,W);this.currentCamera.markViewDirty()};U.calculateControlTransformationLocal=function(V,W,X){const {viewRight:ca,viewForward:R}=W,aa=this.transformation;var ka=this.view.navigation.gamepad,da=u.set(A.sv3d.get(),R[0],R[1],0);u.normalize(da,
da);var fa=aa.translation[0]*V.pan;0!==fa&&(fa=u.scale(A.sv3d.get(),ca,fa),B.translate(X.pan.matrix,X.pan.matrix,fa),X.pan.enabled=!0);switch(ka.mode){case "pan":ka=-aa.translation[1]*V.pan;0!==ka&&(da=u.scale(A.sv3d.get(),da,ka),B.translate(X.pan.matrix,X.pan.matrix,da),X.pan.enabled=!0);X.zoom=aa.zoom*V.zoom;break;case "zoom":X.zoom=(-aa.translation[1]+aa.zoom)*V.zoom;break;default:l.neverReached(ka.mode)}X.ascend=aa.translation[2]*V.ascend;da=-aa.heading*V.rotate;0!==da&&(B.rotate(X.rotate.matrix,
X.rotate.matrix,da,this.view.renderCoordsHelper.worldUpAtPosition(W.eye,A.sv3d.get())),X.rotate.enabled=!0);V=aa.tilt*V.rotate;W=D.viewAngle(this.view.renderCoordsHelper,W.center,W.eye);if(W=q.clamp(W+V,z.TiltDefault.min,z.TiltDefault.max)-W)B.rotate(X.rotate.matrix,X.rotate.matrix,W,ca),X.rotate.enabled=!0};U.calculateControlTransformationGlobal=function(V,W,X){const {eye:ca,viewRight:R}=W,aa=this.transformation;var ka=this.view.navigation.gamepad,da=u.cross(A.sv3d.get(),R,ca);u.normalize(da,da);
u.negate(da,da);H.panMotionToRotationMatrix(this.beginCamera,W,aa,V,this.view.camera.heading,this.headingStart,this.view.camera.tilt,X,ka);this.tmpCamera.copyFrom(this.currentCamera);this.applyPan(O.pan,this.tmpCamera);ka=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;X.ascend=aa.translation[2]*V.ascend;da=-aa.heading*V.rotate;0!==da&&(B.rotate(X.rotate.matrix,X.rotate.matrix,da,this.tmpCamera.eye),X.rotate.enabled=!0);W=this.clampTiltDeltaGlobalToValidRange(aa.tilt*V.rotate,
W.ray,ka);0!==W&&(B.rotate(X.rotate.matrix,X.rotate.matrix,W,this.tmpCamera.viewRight),X.rotate.enabled=!0);X.zoom=aa.zoom*V.zoom};U.clampTiltDeltaGlobalToValidRange=function(V,W,X){const ca=y.getReferenceEllipsoid(this.view.spatialReference),R=H.onSurfaceTiltToEyeTiltGlobal(z.TiltDefault.min,W.origin,X,ca);var aa=0;let ka=0;aa=A.sv3d.get();this.view.renderCoordsHelper.intersectManifold(W,X,aa)?(aa=D.viewAngle(this.view.renderCoordsHelper,aa,W.origin),aa=H.onSurfaceTiltToEyeTiltGlobal(aa,W.origin,
X,ca),ka=H.onSurfaceTiltToEyeTiltGlobal(z.TiltDefault.max,W.origin,X,ca)):(t.sphere.closestPointOnSilhouette(t.sphere.wrap(X+ca.radius),W,aa),aa=q.acosClamped(-u.dot(W.direction,u.normalize(aa,aa))),aa=H.offSurfaceTiltToEyeTiltGlobal(aa,W.origin,X,ca),ka=H.offSurfaceTiltToEyeTiltGlobal(z.TiltDefault.max,W.origin,X,ca));return q.clamp(aa+V,R,ka)-aa};U.getPointAbsoluteSurfaceElevation=function(V,W,X){const {renderCoordsHelper:ca}=this.view,R=ca.getAltitude(V);W+=Math.abs(R-W);u.copy(X,V);ca.setAltitude(W,
X);return W};U.clampedDistanceToSurface=function(V,W){const {renderCoordsHelper:X}=this.view,{camera:ca}=this.view.state;var {direction:R}=K.headingTiltToDirectionUp(this.view,W,0,80,F);R=X.intersectManifoldClosestSilhouette(t.ray.wrap(W,R),V,A.sv3d.get());R=u.distance(W,R);V=X.intersectManifoldClosestSilhouette(t.ray.wrap(W,v.directionFromTo(A.sv3d.get(),W,ca.center)),V,A.sv3d.get());W=u.distance(W,V);return Math.min(R,W)};U.computeHeadingRotateRadius=function(V){const {renderCoordsHelper:W,state:X}=
this.view,{camera:ca,isGlobal:R}=X;var aa=W.intersectManifoldClosestSilhouette(ca.ray,this.filteredSurfaceElevation,A.sv3d.get());if(R){const ka=u.subtract(A.sv3d.get(),V,aa);aa=u.length(ka);u.scale(ka,ka,1/aa);V=u.normalize(A.sv3d.get(),V);V=q.acosClamped(u.dot(V,ka));return aa*Math.sin(Math.min(S,V))}V=u.copy(A.sv3d.get(),V);W.setAltitude(this.filteredSurfaceElevation,V);return u.distance(aa,V)};U.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:5};U.computeVelocities=
function(V){var W=this.filteredSurfaceElevation,X=W+y.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:ca,isGlobal:R}=this.view.state;var aa=A.sv3d.get();const ka=this.getPointAbsoluteSurfaceElevation(ca.eye,W,aa);var da=this.clampedDistanceToSurface(W,aa);const fa=ca.width/2,ea=.75*ca.width,Y=.75*ca.width;var Z=da*Math.tan(.5*ca.fovX)/fa;X=Z/X;aa=Z/this.computeHeadingRotateRadius(aa);Z=(R?X:Z)*ea*V;W=ka-W;W=Math.max(this.minimumAscendVelocity()*V,Math.pow(2,ea*V/fa)*W-W);da=
Math.pow(2,ea*V/fa)*da-da;V*=q.clamp(aa*Y,M,T);return{pan:Z,ascend:W,zoom:da,rotate:V}};U.applyDisabledMovementTypes=function(V){!h.isSome(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.mode!==this.disableMovements.mode||(V.zoom=this.disableMovements.zoom?0:V.zoom,V.ascend=this.disableMovements.ascend?0:V.ascend,V.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&B.identity(V.pan.matrix),V.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&
B.identity(V.rotate.matrix))};P.activatesFor=function(V,W){V=C.extractTransformation(W,V.navigation.gamepad,L);return!("end"===W.action||C.isZeroTransformation(V))};return P}(I.InteractiveController);a.__decorate([e.property({constructOnly:!0})],b.GamepadKeyboardController.prototype,"view",void 0);a.__decorate([e.property({constructOnly:!0})],b.GamepadKeyboardController.prototype,"gamepadDevice",void 0);a.__decorate([e.property({constructOnly:!0})],b.GamepadKeyboardController.prototype,"disableMovements",
void 0);b.GamepadKeyboardController=a.__decorate([g.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],b.GamepadKeyboardController);const L={translation:[0,0,0],heading:0,tilt:0,zoom:0},S=q.deg2rad(80),M=q.deg2rad(30),T=q.deg2rad(80),O={zoom:0,ascend:0,pan:{enabled:!1,matrix:x.create()},rotate:{enabled:!1,matrix:x.create()}},Q=m.create(),F=J.createDirectionUp();Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports",
"../../chunks/vec3"],function(b,k){function a(r){let l=r*r;0>r&&(l*=-1);return l}b.extractTransformation=function(r,l,h){const d=r.state;r=r.device;l="forward-down"===l.tiltDirection?1:-1;"standard"===r.deviceType?(h.translation[0]=a(d.axes[0]),h.translation[1]=a(d.axes[1]),h.translation[2]=a(d.buttons[7])-a(d.buttons[6]),h.heading=a(d.axes[2]),h.tilt=a(d.axes[3])):"spacemouse"===r.deviceType&&(h.translation[0]=1.2*a(d.axes[0]),h.translation[1]=1.2*a(d.axes[1]),h.translation[2]=2*-a(d.axes[2]),h.heading=
1.2*a(d.axes[5]),h.tilt=1.2*a(d.axes[3]));h.tilt*=l;k.scale(h.translation,h.translation,1);return h};b.extractTransformationKeyboard=function(r,l){l.translation[0]=r[1]-r[0];l.translation[1]=r[3]-r[2];l.translation[2]=r[4]-r[5];l.heading=r[7]-r[6];l.tilt=r[8]-r[9];l.zoom=r[10]-r[11];return l};b.isZeroTransformation=function(r){return 0===r.translation[0]&&0===r.translation[1]&&0===r.translation[2]&&0===r.heading&&0===r.tilt&&0===r.zoom};b.quadraticAccentuation=a;b.resetTransformation=function(r){r.translation[0]=
0;r.translation[1]=0;r.translation[2]=0;r.heading=0;r.tilt=0;return r};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3f64","../../../chunks/vec3"],function(b,k,a,r){const l=a.create(),h=a.create();b.createDirectionUp=function(){return{direction:a.create(),up:a.create()}};b.directionToHeadingTilt=function(d,c,e,f,g){let p=l;r.normalize(p,d);let n=r.dot(p,f);const w=0<n;n=Math.abs(n);
.99<n&&(n=Math.abs(r.dot(c,f)),.99>n?(r.copy(p,c),w&&r.scale(p,p,-1)):p=null);c=0;p&&(r.scale(h,f,r.dot(f,p)),r.subtract(p,p,h),c=r.dot(p,g)/(r.length(p)*r.length(g)),r.cross(h,p,g),c=(0<r.dot(h,f)?1:-1)*k.rad2deg(k.acosClamped(c)));d=k.rad2deg(k.acosClamped(-r.dot(f,d)/r.length(d)));if(!e)return{heading:c,tilt:d};e.heading=c;e.tilt=d;return e};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../core/maybe ../../../core/Logger ../../../core/promiseUtils ../../../geometry/SpatialReference ../../../geometry/Point ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ./mathUtils ../../../Camera ../../../geometry/projectionEllipsoid ../../../geometry/projection ../../support/spatialReferenceSupport ../../../geometry/support/scaleUtils ./ElevationProvider ./earthUtils ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){function x(X){return"global"===X.viewingMode?B.cameraUtilsSpherical:y.cameraUtilsPlanar}function C(X,ca,R){var aa=X.state.camera;const ka=aa.fovX;aa=aa.width/2/aa.pixelRatio;"global"===X.viewingMode&&null!=R&&(ca*=Math.cos(d.deg2rad(R)));ca/=X.renderCoordsHelper.unitInMeters;return aa/(96*39.37/ca)/Math.tan(ka/2)}function z(X,ca,R){const aa=X.state.camera;ca=96*39.37/(aa.width/2/aa.pixelRatio/(ca*Math.tan(aa.fovX/2)));"global"===X.viewingMode&&(ca/=
Math.cos(d.deg2rad(R)));return ca*=X.renderCoordsHelper.unitInMeters}function A(X,ca,R,aa,ka,da){if(S(da)){const fa=new W(da.signal);I(X,aa.heading,aa.tilt,ca,R,ka,fa);fa.resolver.promise.then(ea=>{ea=L(X,ea,aa.fov);if(k.isNone(ea))da.resolver.reject();else return da.resolver.resolve(ea)},ea=>da.resolver.reject(ea))}else return ca=I(X,aa.heading,aa.tilt,ca,R,ka),L(X,ca,aa.fov,da)}function t(X,ca,R,aa,ka){return x(X).directionToHeadingTilt(ca,R,aa,ka)}function D(X,ca){return!!(X.basemapTerrain&&X.renderCoordsHelper.fromRenderCoords(ca,
N,X.spatialReference)&&m.getElevationAtPoint(X.elevationProvider,N)>N.z-1)}async function E(X,ca,R){return X.renderCoordsHelper.fromRenderCoords(ca,N,X.spatialReference)?await X.elevationProvider.queryElevation(N.x,N.y,N.z,N.spatialReference,"ground",R)>N.z-1:!1}async function G(X,ca,R){const aa=c.create();ca?ca instanceof h?(n.projectPointToVector(ca,aa,X.renderSpatialReference),null==ca.z&&null!=X.basemapTerrain&&(ca=await X.elevationProvider.queryElevation(ca.x,ca.y,ca.z,ca.spatialReference,"ground",
R),null!=ca&&X.renderCoordsHelper.setAltitude(ca,aa))):e.copy(aa,ca):e.copy(aa,X.state.camera.center);return aa}function H(X,ca){const R=c.create();ca&&ca instanceof h?(n.projectPointToVector(ca,R,X.renderSpatialReference),null==ca.z&&null!=X.basemapTerrain&&(ca=m.getElevationAtPoint(X.elevationProvider,ca),null!=ca&&X.renderCoordsHelper.setAltitude(ca,R))):ca?e.copy(R,ca):e.copy(R,X.state.camera.center);return R}function I(X,ca,R,aa,ka,da,fa){const ea=aa&&aa instanceof h?aa:null;if(S(fa))return G(X,
aa,fa.signal).then(Y=>{J(X,ca,R,ea,Y,ka,da,fa)},Y=>fa.resolver.reject(Y)),null;aa=H(X,aa);return J(X,ca,R,ea,aa,ka,da,fa)}function J(X,ca,R,aa,ka,da,fa,ea){if(!aa&&(aa=n.projectVectorToPoint(ka,X.renderSpatialReference,X.spatialReference||l.WGS84),!aa))return null;da=Math.max(da,X.state.constraints.minimumPoiDistance);var Y=K(X,ca,R,ka,da,fa);const Z=x(X).eyeForCenterWithHeadingTilt,ba=Z(ka,da,Y.heading,Y.tilt);if(1===fa&&"global"===X.viewingMode&&0<R){const ia=()=>{var ja=da,la=da;var qa=X.state.constraints.tilt(la);
la=x(X).eyeTiltToLookAtTilt(R,ka,la);la=Math.min(la,.5*Math.PI);qa=qa.min*(1-.7)+.7*la;ja=x(X).lookAtTiltToEyeTilt(qa,ka,ja);fa=1>R-ja?0:1;return J(X,ca,ja,aa,ka,da,fa,ea)};Y=X.map.ground.navigationConstraint;if(!Y||"stay-above"===Y.type){if(D(X,ba.eye))return ia();if(S(ea))return E(X,ba.eye,ea.signal).then(ja=>{if(ja)return ia();ea.resolver.resolve({eye:ba.eye,up:ba.up,center:c.clone(ka),heading:ba.heading,tilt:ba.tilt});return null}),null}}Y=!ea||S(ea)?{center:c.create(),eye:c.create(),up:c.create(),
tilt:0,heading:0}:ea;Y.eye=ba.eye;Y.up=ba.up;Y.center=c.clone(ka);Y.heading=ba.heading;Y.tilt=ba.tilt;S(ea)&&ea.resolver.resolve(Y);return Y}function K(X,ca,R,aa,ka,da){var fa=0;if(da=1===da)if(fa=X.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(ka/fa)/Math.LN2)da=!0;else{var ea=X.renderSpatialReference,Y=X.spatialReference||l.WGS84;da=n.projectVectorToPoint(aa,ea,Y);ea=n.projectVectorToPoint(X.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,ea,Y);k.isNone(da)||k.isNone(ea)?
da=!1:(fa*=Math.tan(.5*X.state.camera.fov),da=5<ea.distance(da)/fa)}da?(ca=0,da=X.state.constraints.tilt(ka),da.max=Math.min(da.max,.5*Math.PI),da=da.min*(1-.7)+.7*da.max,R=x(X).eyeTiltToLookAtTilt(R,aa,ka),fa=Math.min(R,da)):fa=x(X).eyeTiltToLookAtTilt(R,aa,ka);R=fa=X.state.constraints.clampTilt(ka,fa);R=x(X).lookAtTiltToEyeTilt(R,aa,ka);return{heading:ca,tilt:R}}function L(X,ca,R,aa){if(k.isNone(ca))return null;X=n.projectVectorToPoint(ca.eye,X.renderSpatialReference,X.spatialReference||l.WGS84);
return k.isNone(X)?null:k.isSome(aa)?(aa.position=X,aa.heading=ca.heading,aa.tilt=ca.tilt,aa.fov=R,aa):new g(X,ca.heading,ca.tilt,R)}function S(X){return X&&"resolver"in X}const M=a.getLogger("esri.views.3d.support.cameraUtils"),T=c.create(),O=c.create(),Q=c.create(),F={heading:0,tilt:0},N=new h,P=new f.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),U=new f.Cyclical(-180,180),V=c.create();let W=function(X){this.signal=X;this.resolver=r.createResolver()};b.AsyncContext=W;b.computeScale=function(X,
ca,R){const aa=X.renderSpatialReference;ca||(ca=X.state.camera);var ka=l.WGS84;ca instanceof g?(ka=ca.position.latitude,n.projectPointToVector(ca.position,T,aa),n.projectPointToVector(R,O,aa),ca=e.distance(T,O)):(n.projectVectorToVector(ca.center,aa,O,ka),ka=O[1],ca=ca.distance);return z(X,ca,ka)};b.directionToHeadingTilt=t;b.distanceToScale=z;b.externalToInternal=function(X,ca){var R=X.renderSpatialReference;const aa=x(X).headingTiltToDirectionUp,ka=c.create();if(!n.projectPointToVector(ca.position,
ka,R))return null;R=aa(ka,ca.heading,ca.tilt);e.scale(R.direction,R.direction,X.state.camera.distance);e.add(R.direction,R.direction,ka);X=v.cameraOnContentAlongViewDirection(X,ka,R.direction,R.up);X.fov=d.deg2rad(ca.fov);return X};b.fromCenterDistance=A;b.fromCenterScale=function(X,ca,R,aa,ka,da){R=C(X,R,ca.latitude);return A(X,ca,R,aa,ka,da)};b.fromExtent=function(X,ca,R,aa,ka,da=null){let fa;var ea=0;null!=ca.zmax&&null!=ca.zmin&&(fa=(ca.zmax+ca.zmin)/2,ea=ca.zmax-ca.zmin);if("global"===X.viewingMode){if(!w.isSpatialReferenceSupported(ca.spatialReference,
"global"))return S(da)&&da.resolver.reject(),null;var Y=new h(ca.xmin,ca.ymin,ca.spatialReference);const ja=new h(ca.xmax,ca.ymax,ca.spatialReference),la=ca.spatialReference.isGeographic?U:P;var Z=new h(la.center(Y.x,ja.x),(ja.y+Y.y)/2,ca.spatialReference);null!=fa&&(Z.z=fa);ca=p.getReferenceEllipsoid(ca.spatialReference);var ba=u.getGreatCircleSpanAt(Z,Y,ja);var ia=ba.lon;ba=ba.lat;la.diff(Y.x,ja.x)>la.range/2&&(ia+=ca.halfCircumference);ia=Math.min(ia,ca.halfCircumference);ba=Math.min(ba,ca.halfCircumference)}else Z=
X.spatialReference||l.WGS84,ia=ca.xmax-ca.xmin,ba=ca.ymax-ca.ymin,Z=new h({x:ca.xmin+.5*ia,y:ca.ymin+.5*ba,z:fa,spatialReference:Z});Y=X.state.camera;ea=Math.max(1/Math.tan(Y.fovX/2)*ia*.5,1/Math.tan(Y.fovY/2)*ba*.5,1/Math.tan(Y.fov/2)*ea*.5)/1;if(S(da))ia=new W(da.signal),I(X,R,aa,Z,ea,ka,ia),ia.resolver.promise.then(ja=>{ja=L(X,ja,X.camera.fov);if(k.isNone(ja))da.resolver.reject();else return da.resolver.resolve(ja)},ja=>da.resolver.reject(ja));else return R=I(X,R,aa,Z,ea,ka),L(X,R,X.camera.fov,
da)};b.getObserverForPointAtDistance=I;b.headingTiltToDirectionUp=function(X,ca,R,aa,ka){return x(X).headingTiltToDirectionUp(ca,R,aa,ka)};b.internalToExternal=function(X,ca,R){const aa=X.renderSpatialReference;var ka=e.copy(Q,ca.viewForward);ka=t(X,ca.eye,ka,ca.up,F);X=X.spatialReference||l.WGS84;n.projectVectorToVector(ca.eye,aa,V,X)||(X=l.WGS84,n.projectVectorToVector(ca.eye,aa,V,X));if(k.isNone(R))return new g(new h(V,X),ka.heading,ka.tilt,d.rad2deg(ca.fov));R.position.x=V[0];R.position.y=V[1];
R.position.z=V[2];R.position.spatialReference=X;R.heading=ka.heading;R.tilt=ka.tilt;R.fov=d.rad2deg(ca.fov);return R};b.observerToCamera=L;b.scaleToDistance=C;b.scaleToResolution=function(X,ca){return X.spatialReference?q.getResolutionForScale(ca,X.spatialReference):void 0};b.scaleToZoom=function(X,ca){if(X=X.basemapTerrain&&X.basemapTerrain.tilingScheme)return X.levelAtScale(ca);M.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};b.toExtent=function(X,ca,R){var aa=
X.renderSpatialReference;const ka=e.dist(ca.eye,R);R=n.projectVectorToPoint(R,aa,X.spatialReference||l.WGS84);if(k.isNone(R))return null;aa=2*ka*Math.tan(ca.fovX/2);ca=2*ka*Math.tan(ca.fovY/2);return"global"===X.viewingMode?B.toExtent(X,R,aa,ca):y.toExtent(X,R,aa,ca)};b.zoomToScale=function(X,ca){if(X=X.basemapTerrain&&X.basemapTerrain.tilingScheme)return X.scaleAtLevel(ca);M.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/chunks/cameraUtilsPlanar":function(){define("exports ../geometry/Extent ../core/mathUtils ./vec3f64 ./vec3 ./mat4 ../geometry/projection ./mat4f64 ../views/3d/support/cameraUtilsInternal".split(" "),function(b,k,a,r,l,h,d,c,e){function f(x,C,z,A=e.createDirectionUp()){h.identity(v);const {direction:t,up:D}=A;h.rotateZ(v,v,-a.deg2rad(C));h.rotateX(v,v,a.deg2rad(z));l.transformMat4(t,u,v);l.scale(t,t,-1);l.transformMat4(D,m,v);return A}function g(x,C,z,A){return e.directionToHeadingTilt(C,z,A,
u,m)}function p(x,C,z,A){const t=f(x,z,A),D=r.create();l.scale(D,t.direction,-C);l.add(D,D,x);return{up:t.up,eye:D,heading:z,tilt:A}}function n(x){return a.rad2deg(x)}function w(x){return a.deg2rad(x)}function q(x,C,z,A,t){const D=x.renderSpatialReference;x=x.map&&x.spatialReference||C.spatialReference;d.projectPointToVector(C,y,D);d.projectPointToVector(C,B,D);y[0]-=z/2;B[0]+=z/2;y[1]-=A/2;B[1]+=A/2;d.projectVectorToVector(y,D,y,x);d.projectVectorToVector(B,D,B,x);t?(t.xmin=y[0],t.ymin=y[1],t.xmax=
B[0],t.ymax=B[1],t.spatialReference=x):t=new k(y[0],y[1],B[0],B[1],x);return t}const m=r.fromValues(0,1,0),u=r.fromValues(0,0,1),v=c.create(),y=r.create(),B=r.create();c=Object.freeze({__proto__:null,headingTiltToDirectionUp:f,directionToHeadingTilt:g,eyeForCenterWithHeadingTilt:p,lookAtTiltToEyeTilt:n,eyeTiltToLookAtTilt:w,toExtent:q});b.cameraUtilsPlanar=c;b.directionToHeadingTilt=g;b.eyeForCenterWithHeadingTilt=p;b.eyeTiltToLookAtTilt=w;b.headingTiltToDirectionUp=f;b.lookAtTiltToEyeTilt=n;b.toExtent=
q})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../geometry/Extent ../core/mathUtils ./vec3f64 ./vec3 ../views/3d/support/mathUtils ../geometry/projectionEllipsoid ./mat4 ./mat4f64 ../views/3d/support/earthUtils ../views/3d/support/cameraUtilsInternal".split(" "),function(b,k,a,r,l,h,d,c,e,f,g,p,n){function w(G,H,I,J=n.createDirectionUp()){d.cross(D,G,C);0===d.dot(D,D)&&d.cross(D,G,z);f.identity(t);f.rotate(t,t,-l.deg2rad(H),
G);f.rotate(t,t,-l.deg2rad(I),D);const {up:K,direction:L}=J;d.cross(K,D,G);d.normalize(K,K);d.transformMat4(K,K,t);d.normalize(L,G);d.negate(L,L);d.transformMat4(L,L,t);return J}function q(G,H,I,J){const K=D,L=E;d.normalize(K,G);d.cross(E,K,C);0===d.dot(E,E)&&d.cross(E,K,z);d.cross(L,E,K);return n.directionToHeadingTilt(H,I,J,K,L)}function m(G,H,I,J){const K={eye:h.create(),up:null,tilt:J,heading:I},L=D;L[0]=G[0];L[1]=G[2];L[2]=-G[1];I=l.deg2rad(I);var S=l.deg2rad(J);J=Math.sin(I);I=Math.cos(I);var M=
Math.sin(S),T=Math.cos(S);const O=d.length(L);if(1E-8>Math.abs(S))S=H+O;else{var Q=O/M,F=l.asinClamped(H/Q);S=Q*Math.sin(Math.PI-S-F)}T*=H;Q=H*H*M*M;F=I*I*Q;const N=S-T,P=N*N;var U=F*(F+P-L[1]*L[1]);if(0>U)return d.scale(K.eye,L,S/O),K.tilt=0,K;var V=Math.sqrt(U);const W=L[1]*N;U=F+P;V=0<I?-V+W:V+W;if(1E-8>Math.abs(U))return 1E-8>O?(K.eye[0]=0,K.eye[1]=0,K.eye[2]=H):d.scale(K.eye,L,S/O),K.tilt=0,u(K.eye),v(K,G);K.eye[1]=V/U;H*=M;V=K.eye[1]*K.eye[1];M=1-V;U=Math.sqrt(M);Q=F*V+J*J*Q-2*I*H*K.eye[1]*
U*N+M*P;if(1E-8>Math.abs(Q))return d.scale(K.eye,L,S/O),K.tilt=0,u(K.eye),v(K,G);K.eye[0]=(M*(S*L[0]-T*L[0])-H*U*(L[0]*K.eye[1]*I+L[2]*J))/Q;K.eye[2]=(M*(S*L[2]-T*L[2])-H*U*(L[2]*K.eye[1]*I-L[0]*J))/Q;d.scale(K.eye,K.eye,S);u(K.eye);return v(K,G)}function u(G){const H=G[1];G[1]=-G[2];G[2]=H}function v(G,H){H=w(H,G.heading,G.tilt);G.up=H.up;return G}function y(G,H,I){H=d.length(H);I=l.asinClamped(I/(Math.sqrt(I*I+H*H-2*I*H*Math.cos(Math.PI-G))/Math.sin(G)));return l.rad2deg(G-I)}function B(G,H,I){G=
l.deg2rad(G);H=d.length(H);return l.asinClamped(I/(H/Math.sin(G)))+G}function x(G,H,I,J,K){function L(O){const Q=Math.PI/2;O=c.cyclical2PI.normalize(O,-Q);O>Q&&(O=Math.PI-O);return O}var S=H.latitude;H=H.longitude;var M=p.getLonDeltaForDistance(S,I,e.getReferenceEllipsoid(G.spatialReference).radius)/2;I=H-M;H+=M;S=l.deg2rad(S);M=e.getReferenceEllipsoid(G.spatialReference).radius;S=(1+Math.sin(S))/(1-Math.sin(S));const T=(S+1)*Math.tan(J/M/2);S=1.5*Math.PI-2*Math.atan(.5*(T+Math.sqrt(4*S+T*T)));J=
S+J/M;S=L(S);J=L(J);J<S&&(M=J,J=S,S=M);S=Math.max(l.rad2deg(S),-90);J=Math.min(l.rad2deg(J),90);H=A.monotonic(I,H);180<H-I&&(M=(H-I-180)/2,I+=M,H-=M);M=G.spatialReference&&G.spatialReference.isGeographic?G.spatialReference:k.WGS84;K?(K.xmin=I,K.ymin=S,K.xmax=H,K.ymax=J,K.spatialReference=M):K=new r(I,S,H,J,M);G.spatialReference&&G.spatialReference.isWebMercator&&a.geographicToWebMercator(K,!1,K);return K}const C=h.fromValues(0,0,1),z=d.normalize(h.create(),h.fromValues(1,1,1)),A=new c.Cyclical(-180,
180),t=g.create(),D=h.create(),E=h.create();g=Object.freeze({__proto__:null,headingTiltToDirectionUp:w,directionToHeadingTilt:q,eyeForCenterWithHeadingTilt:m,lookAtTiltToEyeTilt:y,eyeTiltToLookAtTilt:B,toExtent:x});b.cameraUtilsSpherical=g;b.directionToHeadingTilt=q;b.eyeForCenterWithHeadingTilt=m;b.eyeTiltToLookAtTilt=B;b.headingTiltToDirectionUp=w;b.lookAtTiltToEyeTilt=y;b.toExtent=x})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../input/InputHandler","../../state/controllers/GamepadKeyboardController"],function(b,k,a,r){a=function(l){function h(c,e){var f=l.call(this,!0)||this;f.view=c;f.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:2};f.keyToNumber={[e.left]:0,[e.right]:1,[e.forward]:2,[e.backward]:3,[e.up]:4,[e.down]:5,[e.headingLeft]:6,[e.headingRight]:7,[e.tiltUp]:8,[e.tiltDown]:9,[e.zoomIn]:10,[e.zoomOut]:11};f.registerIncoming("key-down",null,g=>f.handleKeyDown(g));f.registerIncoming("key-up",null,
g=>f.handleKeyUp(g));f.registerIncoming("blur",null,()=>f.handleBlur());return f}k._inheritsLoose(h,l);var d=h.prototype;d.handleKeyDown=function(c){if(!c.data.native.ctrlKey&&!c.data.native.metaKey){var e=this.keyToNumber[c.data.key];null!=e&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new r.GamepadKeyboardController({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),
this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(e),c.stopPropagation()))}};d.handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};d.handleKeyUp=function(c){if(!c.data.native.ctrlKey&&!c.data.native.metaKey){var e=this.keyToNumber[c.data.key];null!=e&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(e),
c.stopPropagation())}};return h}(a.InputHandler);b.KeyboardNavigation=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../input/InputHandler ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController".split(" "),function(b,k,a,r,l,h){r=function(d){function c(e,f){var g=d.call(this,!0)||this;g.view=e;g.registerIncoming("mouse-wheel",
f,p=>g.handleMouseWheel(p));return g}k._inheritsLoose(c,d);c.prototype.handleMouseWheel=function(e){if(this.view.navigation.mouseWheelZoomEnabled){var f=e.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new l.ZoomStepController({view:this.view,mode:"interaction"}):new h.ZoomStepController({view:this.view,mode:"interaction"}),this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*f.deltaY,a.createScreenPointArray(f.x,
f.y));e.preventDefault();e.stopPropagation()}};return c}(r.InputHandler);b.MouseWheelZoom=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../input/InputHandler ../../../input/handlers/support ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController".split(" "),function(b,k,a,r,l,h){a=function(d){function c(f,g,p){var n=
d.call(this,!0)||this;n.view=f;n.pointerAction=g;n.lastEndTimestamp=0;n.lastTimestamp=0;n.registerIncoming("drag",p,w=>n.handleDrag(w));return n}k._inheritsLoose(c,d);var e=c.prototype;e.handleDrag=function(f){if("mouse"!==f.data.pointerType||r.eventMatchesMousePointerAction(f.data,this.pointerAction)){var g=f.timestamp-this.lastEndTimestamp;g=this.momentum&&this.momentum.active&&40>g;switch(f.data.action){case "start":case "update":if(g)break;this.controller&&this.controller.active?2<f.data.timestamp-
this.lastTimestamp&&(this.controller.update(f.data),this.lastTimestamp=f.timestamp):this.startController(f);break;case "end":case "removed":this.endController(f,!0);break;case "added":this.endController(f,!1),this.startController(f)}f.stopPropagation()}};e.endController=function(f,g){this.controller&&this.controller.active&&(this.lastEndTimestamp=f.timestamp,f=this.controller.end(f.data),g&&f&&(this.momentum=f,this.view.state.switchCameraController(this.momentum)));this.controller=null};e.startController=
function(f){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(f.data);this.lastTimestamp=f.timestamp};e.createController=function(){return this.view.state.isGlobal?new l.PinchAndPanController({view:this.view}):new h.PinchAndPanController({view:this.view})};return c}(a.InputHandler);b.PinchAndPanNavigation=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/mathUtils ../../../../../geometry/projectionEllipsoid ../../../../../support/featureFlags ../../../../../chunks/vec2 ../../../support/geometryUtils ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../../utils/navigationUtils ../InteractiveController ../../../input/util ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M){b.PinchAndPanController=function(T){function O(F){F=T.call(this,F)||this;F.view=null;F.smoothRotation=new D.ExponentialFalloff(.05);F.rotationAxis=q.create();F.panningPlane=x.plane.create();F.smoothScaling=new D.ExponentialFalloff(.05);F.zoomCenterScreen=w.createScreenPointArray();F.zoomMomentumEstimator=new M.ZoomMomentumEstimator;F.rotationMomentumEstimator=new S.RotationMomentumEstimator;F.panSphericalMomentumEstimator=
new L.PanSphericalMomentumEstimator;F.panPlanarMomentumEstimator=new K.PanPlanarMomentumEstimator;F.adjustedSphere=x.sphere.create();F.tmp3d=q.create();F.tmpScreenPointArray=w.createScreenPointArray();F.beginScreenPoint=w.createScreenPointArray();F.beginScenePoint=q.create();F.screenPickPoint=w.createScreenPointArray();F.navMode=A.NavigationMode.Horizontal;F.tmpInteractionDirection=q.create();F.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new z,interactionDirection:null,
tiltMode:0};return F}k._inheritsLoose(O,T);var Q=O.prototype;Q.begin=function(F){if(this.active){var N=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=N;this.rotationMomentumEstimator.enabled=N;this.panPlanarMomentumEstimator.enabled=N;this.panSphericalMomentumEstimator.enabled=N;this.beginHeading=-u.cyclicalPI.normalize(n.deg2rad(this.view.camera.heading));this.beginRadius=F.radius;this.pointerCount=F.pointers.size;this.beginAngle=F.angle;this.smoothRotation.reset();w.screenPointObjectToArray(F.center,
this.screenPickPoint);B.copy(this.beginScreenPoint,this.screenPickPoint);N=v.getReferenceEllipsoid(this.view.spatialReference);var P=A.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0,N);this.scenePickPoint=P.scenePickPoint;this.sphere=P.sphere;m.copy(this.beginScenePoint,this.scenePickPoint);this.navMode=A.decideNavigationMode(this.beginCamera,this.screenPickPoint,P.hasGeometryIntersection,N);this.navMode===A.NavigationMode.Vertical&&this.preparePlanarPanMode(F);
this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};Q.preparePlanarPanMode=function(F){var N=m.negate(this.tmp3d,this.beginCamera.viewForward);x.plane.fromPositionAndNormal(this.scenePickPoint,N,this.panningPlane);var P=w.createScreenPointArray(this.screenPickPoint[0],0);N=q.create();var U=m.length(this.beginCamera.eye);this.adjustedSphere.radius=U<this.sphere.radius?U-100:this.sphere.radius;A.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.beginCamera,P,N);P=w.createRenderScreenPointArray3();
this.beginCamera.projectToRenderScreen(N,P);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*P[1]);this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint)&&x.plane.fromPositionAndNormal(this.scenePickPoint,x.plane.normal(this.panningPlane),this.panningPlane);if(!y.disableContextNavigation()&&this.view._stage.getCamera()._contextNavigation){N=q.create();P=q.create();U=q.create();m.subtract(N,this.scenePickPoint,this.currentCamera.eye);m.normalize(N,N);const V=5*
Math.max(Math.abs(this.view.camera.position.z),50),W=this.view._stage.renderView.getMinimalDepthForArea(this.screenPickPoint[0],this.screenPickPoint[1],this.view._stage.getCamera(),80);m.copy(U,m.add(P,this.currentCamera.eye,m.scale(P,N,W?Math.min(W,V):V)));this.panningPlane[3]=-m.dot(this.panningPlane,U)}F=w.screenPointObjectToArray(F.center,this.tmpScreenPointArray);A.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,F,this.beginScenePoint)};Q.update=function(F){if(this.active){this.currentCamera.copyFrom(this.beginCamera);
var N=1<F.pointers.size;this.navMode===A.NavigationMode.Horizontal?(N&&this.zoomSpherical(F),this.panningSpherical(F),N&&this.rotateSpherical(F)):(N&&this.zoomPlanar(F),this.panningPlanar(F),N&&this.rotatePlanar(F));this.currentCamera.markViewDirty()}};Q.end=function(F){F.pointers.size===this.pointerCount&&this.update(F);this.finishController();if(F=this.zoomMomentumEstimator.evaluateMomentum())return this.navMode===A.NavigationMode.Horizontal?new J.ZoomSphericalMomentumController({view:this.view,
momentum:F,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere.radius}):new I.ZoomPlanarMomentumController({view:this.view,momentum:F,zoomCenter:this.beginScenePoint});if(F=this.rotationMomentumEstimator.evaluateMomentum())return new H.RotationMomentumController({view:this.view,momentum:F,center:this.sphere.center,axis:this.rotationAxis});if(this.navMode===A.NavigationMode.Horizontal){if(F=this.panSphericalMomentumEstimator.evaluateMomentum())return new G.PanSphericalMomentumController({view:this.view,
momentum:F})}else if(F=this.panPlanarMomentumEstimator.evaluateMomentum())return new E.PanPlanarMomentumController({view:this.view,momentum:F});return null};Q.zoomSpherical=function(F){const N=this.beginRadius/F.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(F.radius,40),120);this.smoothScaling.update(N);A.applyZoomOnSphere(this.sphere,this.currentCamera,this.smoothScaling.value);w.screenPointObjectToArray(F.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,
.001*F.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(F.radius-this.beginRadius);C.applyAll(this.view,this.currentCamera,this.constraintOptions)};Q.panningSpherical=function(F){const N=w.screenPointObjectToArray(F.center,this.tmpScreenPointArray);A.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,N,this.tmp3d);A.preserveHeadingThreshold(this.beginScenePoint,m.dot(this.currentCamera.up,this.beginScenePoint),
this.sphere.radius,this.beginHeading,this.view.camera.tilt,this.beginCamera)?(A.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(N,this.tmp3d,.001*F.timestamp,this.beginCamera,this.sphere,this.beginHeading,this.view.camera.tilt)):(A.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,
!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(N,this.tmp3d,.001*F.timestamp,this.beginCamera,this.sphere.radius,this.view.camera.tilt));this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(this.screenPickPoint,N);C.applyAll(this.view,this.currentCamera,this.constraintOptions)};Q.rotateSpherical=function(F){m.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||m.negate(this.rotationAxis,
this.rotationAxis);var N=this.smoothRotation.value,P=A.normalizeRotationDelta(F.angle-N);N+=P;this.smoothRotation.gain=.00125*Math.min(Math.max(F.radius,40),120);this.smoothRotation.update(N);P=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(P,.001*F.timestamp);A.applyRotation(this.currentCamera,this.sphere.center,x.axisAngle.wrapAxisAngle(this.rotationAxis,P));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(F.radius*
N);C.applyAll(this.view,this.currentCamera,this.constraintOptions)};Q.panningPlanar=function(F){const N=w.screenPointObjectToArray(F.center,this.tmpScreenPointArray);A.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,N,this.tmp3d)&&(A.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(N,this.tmp3d,.001*F.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(this.beginScreenPoint,
N),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),C.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};Q.zoomPlanar=function(F){const N=this.beginRadius/F.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(F.radius,40),120);this.smoothScaling.update(N);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*F.timestamp);A.applyZoomToPoint(this.currentCamera,
this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(F.radius-this.beginRadius);C.applyAll(this.view,this.currentCamera,this.constraintOptions)};Q.rotatePlanar=function(F){m.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||m.negate(this.rotationAxis,this.rotationAxis);var N=this.smoothRotation.value;let P=F.angle-
N;P=A.normalizeRotationDelta(P);this.smoothRotation.gain=.00125*Math.min(Math.max(F.radius,40),120);this.smoothRotation.update(N+P);N=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(N,.001*F.timestamp);A.applyRotation(this.currentCamera,this.sphere.center,x.axisAngle.wrapAxisAngle(this.rotationAxis,N));this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=C.pixelDistanceToInteractionFactor(F.radius*N);C.applyAll(this.view,this.currentCamera,
this.constraintOptions)};k._createClass(O,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return O}(t.InteractiveController);a.__decorate([d.property({constructOnly:!0})],b.PinchAndPanController.prototype,"view",void 0);b.PinchAndPanController=a.__decorate([e.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],b.PinchAndPanController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/util":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(h){this._gain=h}var l=r.prototype;l.reset=function(h){this._value=h};l.update=function(h){this._value=void 0===this._value?h:this._gain*h+(1-this._gain)*this._value};k._createClass(r,[{key:"gain",set:function(h){this._gain=h}},{key:"value",get:function(){return void 0===this._value?0:this._value}}]);return r}();b.ExponentialFalloff=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ./MomentumController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){b.PanPlanarMomentumController=function(m){function u(v){v=m.call(this,v)||this;v.interactionType=4;v.tmpPan=n.create();return v}k._inheritsLoose(u,m);u.prototype.momentumStep=function(v,y){v=this.momentum.value(v);w.scale(this.tmpPan,this.momentum.direction,v);w.subtract(y.eye,y.eye,this.tmpPan);w.subtract(y.center,y.center,this.tmpPan);y.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return u}(q.MomentumController);a.__decorate([d.property({constructOnly:!0})],
b.PanPlanarMomentumController.prototype,"momentum",void 0);b.PanPlanarMomentumController=a.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],b.PanPlanarMomentumController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../ViewAnimation ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../AnimationController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){b.MomentumController=function(u){function v(B){B=u.call(this,B)||this;B.view=null;B.beginCamera=new q;B.elapsedTimeSec=0;B.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new q,interactionDirection:null,tiltMode:0};return B}k._inheritsLoose(v,u);var y=v.prototype;y.initialize=function(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=new n};y.onControllerStart=function(B){this.beginCamera.copyFrom(B);
this.constraintOptions.interactionStartCamera=this.beginCamera;u.prototype.onControllerStart.call(this,B)};y.stepController=function(B,x){x.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=B;this.momentumStep(this.elapsedTimeSec,x);w.applyAll(this.view,x,this.constraintOptions)};k._createClass(v,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this.elapsedTimeSec)}}]);return v}(m.AnimationController);a.__decorate([d.property({constructOnly:!0})],b.MomentumController.prototype,
"view",void 0);b.MomentumController=a.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],b.MomentumController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../utils/navigationUtils ./MomentumController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){const u=n.create(),v=n.create();b.PanSphericalMomentumController=function(y){function B(x){x=y.call(this,x)||this;x.interactionType=4;return x}k._inheritsLoose(B,y);B.prototype.momentumStep=function(x,C){const z=this.momentum.value1(x);x=this.momentum.value2(x);w.copy(v,C.eye);w.normalize(v,v);w.cross(this.momentum.axis2,v,this.momentum.axis1);q.applyRotationWithTwoAxes(C,u,this.momentum.axis1,z,this.momentum.axis2,x)};return B}(m.MomentumController);a.__decorate([d.property({constructOnly:!0})],
b.PanSphericalMomentumController.prototype,"momentum",void 0);b.PanSphericalMomentumController=a.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],b.PanSphericalMomentumController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../support/geometryUtils ../../utils/navigationUtils ./MomentumController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){b.RotationMomentumController=function(u){function v(y){y=u.call(this,y)||this;y.interactionType=2;return y}k._inheritsLoose(v,u);v.prototype.momentumStep=function(y,B){y=this.momentum.value(y);q.applyRotation(B,this.center,w.axisAngle.wrapAxisAngle(this.axis,y))};k._createClass(v,[{key:"center",set:function(y){this._set("center",n.clone(y))}},{key:"axis",set:function(y){this._set("axis",n.clone(y))}}]);return v}(m.MomentumController);a.__decorate([d.property({constructOnly:!0})],
b.RotationMomentumController.prototype,"momentum",void 0);a.__decorate([d.property({constructOnly:!0})],b.RotationMomentumController.prototype,"center",null);a.__decorate([d.property({constructOnly:!0})],b.RotationMomentumController.prototype,"axis",null);b.RotationMomentumController=a.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],b.RotationMomentumController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/mathUtils ../../utils/navigationUtils ./MomentumController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){b.ZoomPlanarMomentumController=function(v){function y(B){B=v.call(this,B)||this;B.interactionType=1;B.constraintOptions.interactionDirection=n.create();return B}k._inheritsLoose(y,v);y.prototype.momentumStep=function(B,x){w.copy(this.constraintOptions.interactionDirection,x.eye);B=this.momentum.valueDelta(0,B);m.applyZoomToPoint(x,this.zoomCenter,B,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=q.directionFromTo(this.constraintOptions.interactionDirection,
x.eye,this.constraintOptions.interactionDirection)};k._createClass(y,[{key:"zoomCenter",set:function(B){this._set("zoomCenter",n.clone(B))}}]);return y}(u.MomentumController);a.__decorate([d.property({constructOnly:!0})],b.ZoomPlanarMomentumController.prototype,"momentum",void 0);a.__decorate([d.property({constructOnly:!0})],b.ZoomPlanarMomentumController.prototype,"zoomCenter",null);b.ZoomPlanarMomentumController=a.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],
b.ZoomPlanarMomentumController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../support/geometryUtils ../../../camera/constraintUtils ../../utils/navigationUtils ./MomentumController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){b.ZoomSphericalMomentumController=function(y){function B(C){C=y.call(this,C)||this;C.interactionType=1;C.radius=0;C.tmpSceneCenter=w.create();C.tmpZoomAxisAngle=q.axisAngle.create();C.sphere=q.sphere.create();return C}k._inheritsLoose(B,y);var x=B.prototype;x.initialize=function(){this.sphere.radius=this.radius};x.momentumStep=function(C,z){C=this.momentum.valueDelta(0,C);u.applyZoomOnSphere(this.sphere,z,C);this.constraintOptions.interactionType=1;m.applyAll(this.view,
z,this.constraintOptions);u.sphereOrPlanePointFromScreenPoint(this.sphere,z,this.screenCenter,this.tmpSceneCenter);q.axisAngle.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);u.applyRotation(z,this.sphere.center,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=4};k._createClass(B,[{key:"screenCenter",set:function(C){this._set("screenCenter",n.createScreenPointArray(C[0],C[1]))}},{key:"sceneCenter",set:function(C){this._set("sceneCenter",w.clone(C))}}]);return B}(v.MomentumController);
a.__decorate([d.property({constructOnly:!0})],b.ZoomSphericalMomentumController.prototype,"momentum",void 0);a.__decorate([d.property({constructOnly:!0})],b.ZoomSphericalMomentumController.prototype,"screenCenter",null);a.__decorate([d.property({constructOnly:!0})],b.ZoomSphericalMomentumController.prototype,"sceneCenter",null);a.__decorate([d.property({constructOnly:!0})],b.ZoomSphericalMomentumController.prototype,"radius",void 0);b.ZoomSphericalMomentumController=a.__decorate([e.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],
b.ZoomSphericalMomentumController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3f64 ../../chunks/vec3 ./FilteredFiniteDifference ./Momentum".split(" "),function(b,k,a,r,l,h){let d=function(c){function e(f,g,p,n,w){f=c.call(this,f,g,p)||this;f.sceneVelocity=n;f.direction=w;return f}k._inheritsLoose(e,c);e.prototype.value=function(f){return c.prototype.valueFromInitialVelocity.call(this,
this.sceneVelocity,f)};return e}(h.Momentum);h=function(){function c(f=300,g=12,p=.84){this.minimumInitialVelocity=f;this.stopVelocity=g;this.friction=p;this.enabled=!0;this.time=new l.FilteredFiniteDifference(.6);this.screen=[new l.FilteredFiniteDifference(.4),new l.FilteredFiniteDifference(.4)];this.scene=[new l.FilteredFiniteDifference(.6),new l.FilteredFiniteDifference(.6),new l.FilteredFiniteDifference(.6)];this.tmpDirection=a.create()}var e=c.prototype;e.add=function(f,g,p){!this.enabled||this.time.hasLastValue&&
.015>this.time.computeDelta(p)||(this.screen[0].update(f[0]),this.screen[1].update(f[1]),this.scene[0].update(g[0]),this.scene[1].update(g[1]),this.scene[2].update(g[2]),this.time.update(p))};e.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};e.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var f=this.screen[0].filteredDelta;const g=this.screen[1].filteredDelta;
f=Math.sqrt(f*f+g*g)/this.time.filteredDelta;return Math.abs(f)<this.minimumInitialVelocity?null:this.createMomentum(f,this.stopVelocity,this.friction)};e.createMomentum=function(f,g,p){r.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const n=r.length(this.tmpDirection);0<n&&r.scale(this.tmpDirection,this.tmpDirection,1/n);return new d(f,g,p,n/this.time.filteredDelta,this.tmpDirection)};return c}();b.PanPlanarMomentum=d;b.PanPlanarMomentumEstimator=
h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(h){this.gain=h}var l=r.prototype;l.update=function(h){if(this.hasLastValue){const d=this.computeDelta(h);this.updateDelta(d)}this.lastValue=h};l.reset=function(){this.filteredDelta=this.lastValue=void 0};l.computeDelta=function(h){return h-this.lastValue};l.updateDelta=function(h){this.filteredDelta=
this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*h:h};k._createClass(r,[{key:"hasLastValue",get:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",get:function(){return void 0!==this.filteredDelta}}]);return r}();b.FilteredFiniteDifference=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/navigation/Momentum":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(h,d,c){this._initialVelocity=
h;this._stopVelocity=d;this._friction=c;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}var l=r.prototype;l.isFinished=function(h){return h>this.duration};l.value=function(h){return this.valueFromInitialVelocity(this._initialVelocity,h)};l.valueDelta=function(h,d){const c=this.value(h);return this.value(h+d)-c};l.valueFromInitialVelocity=function(h,d){d=Math.min(d,this.duration);const c=1-this.friction;return h*(Math.pow(c,d)-1)/Math.log(c)};
k._createClass(r,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);return r}();b.Momentum=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3f64 ../../chunks/vec3 ../../chunks/vec2f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./Momentum ./FilteredValue".split(" "),function(b,k,a,
r,l,h,d,c,e){let f=function(g){function p(w,q,m,u,v,y=0,B){w=g.call(this,w,q,m)||this;w.angularVelocity1=u;w.axis1=v;w.angularVelocity2=y;w.axis2=B;return w}k._inheritsLoose(p,g);var n=p.prototype;n.value1=function(w){return g.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,w)};n.value2=function(w){return g.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,w)};return p}(c.Momentum);c=function(){function g(n=300,w=12,q=.84){this.minimumInitialVelocity=n;this.stopVelocity=
w;this.friction=q;this.enabled=!0;this.tmpAxis1=a.create();this.tmpAxis2=a.create();this.tmpAngles=l.create();this.time=new d.FilteredFiniteDifference(.3);this.screen=[new d.FilteredFiniteDifference(.4),new d.FilteredFiniteDifference(.4)];this.angle1=new e.FilteredValue(.6);this.angle2=new e.FilteredValue(.6);this.axis1=a.create();this.axis2=a.create();this.lastScene=a.create()}var p=g.prototype;p.addMomentumDirectRotation=function(n,w,q,m,u,v){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(q))return;
m=h.rotationAngleAndAxisDirectRotation(this.lastScene,w,this.tmpAxis2,m,u,v);this.angle2.update(0);1E-5>r.squaredLength(this.tmpAxis2)?m=0:r.normalize(this.axis1,this.tmpAxis2);this.angle1.update(m);r.copy(this.lastScene,w)}this.screen[0].update(n[0]);this.screen[1].update(n[1]);this.time.update(q)}};p.addMomentumPreserveHeading=function(n,w,q,m,u,v,y){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(q))return;h.rotationAnglesAndAxesHeadingPreserving(this.lastScene,w,this.tmpAxis2,
this.tmpAxis1,this.tmpAngles,m,u,v,y,!1);1E-5>r.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),r.normalize(this.axis1,this.tmpAxis1),r.normalize(this.axis2,this.tmpAxis2));r.copy(this.lastScene,w)}this.screen[0].update(n[0]);this.screen[1].update(n[1]);this.time.update(q)}};p.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();this.time.reset()};
p.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var n=this.screen[0].filteredDelta;const w=this.screen[1].filteredDelta;n=Math.sqrt(n*n+w*w)/this.time.filteredDelta;return Math.abs(n)<this.minimumInitialVelocity?null:this.createMomentum(n,this.stopVelocity,this.friction)};p.createMomentum=function(n,w,q){return new f(n,w,q,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};return g}();
b.PanSphericalMomentum=f;b.PanSphericalMomentumEstimator=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(h){this.gain=h}var l=r.prototype;l.update=function(h){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*h:h};l.reset=function(){this.filteredValue=void 0};k._createClass(r,[{key:"hasFilteredValue",get:function(){return void 0!==
this.filteredValue}}]);return r}();b.FilteredValue=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(b,k,a){a=function(r){function l(h=3,d=.01,c=.95,e=12){return r.call(this,h,d,c,e)||this}k._inheritsLoose(l,r);l.prototype.add=function(h,d){if(this.value.hasLastValue){const c=this.value.lastValue;for(h-=c;h>Math.PI;)h-=2*Math.PI;for(;h<-Math.PI;)h+=
2*Math.PI;h=c+h}r.prototype.add.call(this,h,d)};return l}(a.MomentumEstimator);b.RotationMomentumEstimator=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(b,k,a,r){let l=function(){function h(c=2.5,e=.01,f=.95,g=12){this.minimumInitialVelocity=c;this.stopVelocity=e;this.friction=f;this.maxVelocity=g;this.enabled=!0;this.value=new a.FilteredFiniteDifference(.8);
this.time=new a.FilteredFiniteDifference(.3)}var d=h.prototype;d.add=function(c,e){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(e))return;if(this.value.hasFilteredDelta){const f=this.value.computeDelta(c);0>this.value.filteredDelta*f&&this.value.reset()}}this.time.update(e);this.value.update(c)}};d.reset=function(){this.value.reset();this.time.reset()};d.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let c=this.value.filteredDelta/
this.time.filteredDelta;c=k.clamp(c,-this.maxVelocity,this.maxVelocity);return Math.abs(c)<this.minimumInitialVelocity?null:this.createMomentum(c,this.stopVelocity,this.friction)};d.createMomentum=function(c,e,f){return new r.Momentum(c,e,f)};return h}();b.MomentumEstimator=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],function(b,k,a,r){let l=
function(h){function d(e,f,g){return h.call(this,e,f,g)||this}k._inheritsLoose(d,h);var c=d.prototype;c.value=function(e){e=h.prototype.value.call(this,e);return Math.exp(e)};c.valueDelta=function(e,f){const g=h.prototype.value.call(this,e);e=h.prototype.value.call(this,e+f);return Math.exp(e-g)};return d}(a.Momentum);a=function(h){function d(e=2.5,f=.01,g=.95,p=12){return h.call(this,e,f,g,p)||this}k._inheritsLoose(d,h);var c=d.prototype;c.add=function(e,f){h.prototype.add.call(this,Math.log(e),
f)};c.createMomentum=function(e,f,g){return new l(e,f,g)};return d}(r.MomentumEstimator);b.ZoomMomentum=l;b.ZoomMomentumEstimator=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../support/featureFlags ../../../support/geometryUtils ../../../camera/constraintUtils ../../../webgl-engine/lib/Camera ../../utils/navigationUtils ../InteractiveController ../../../input/util ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H){const I=q.fromValues(0,0,1);var J=16/180*Math.PI;b.PinchAndPanController=function(K){function L(M){M=K.call(this,M)||this;M.view=null;M.rotationValueSmooth=new z.ExponentialFalloff(.05);M.scalingValueSmooth=new z.ExponentialFalloff(.05);M.planeHorizontal=v.plane.create();M.planeVertical=v.plane.create();M.rotationMomentumEstimator=new G.RotationMomentumEstimator;M.panMomentumEstimator=new E.PanPlanarMomentumEstimator(300,12,.9);M.zoomMomentumEstimator=
new H.ZoomMomentumEstimator;M.beginCenter=q.create();M.tmpPoints=[];M.beginCenterScreen=w.createScreenPointArray();M.tmpCentroid3d=q.create();M.tmpCentroid2d=w.createScreenPointArray();M.tmp2d=w.createScreenPointArray();M.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new B,interactionDirection:null,tiltMode:0};return M}k._inheritsLoose(L,K);var S=L.prototype;S.begin=function(M){if(this.active){var T=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=
T;this.rotationMomentumEstimator.enabled=T;this.panMomentumEstimator.enabled=T;this.beginRadius=M.radius;this.pointerCount=M.pointers.size;this.beginAngle=M.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();w.screenPointObjectToArray(M.center,this.beginCenterScreen);v.plane.fromNormalAndOffset(I,0,this.planeHorizontal);T=q.create();this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,T);var O=q.create();m.negate(O,this.beginCamera.viewForward);var Q=
q.create();m.copy(Q,I);var F=m.dot(O,Q);this.panMode=n.asinClamped(0>F?-F:F)>=J?x.NavigationMode.Horizontal:x.NavigationMode.Vertical;v.plane.setOffsetFromPoint(this.planeHorizontal,T,this.planeHorizontal);this.beginCamera.aboveGround||v.plane.negate(this.planeHorizontal,this.planeHorizontal);if(this.panMode===x.NavigationMode.Vertical){m.scale(Q,Q,F);m.subtract(this.planeVertical,O,Q);m.normalize(this.planeVertical,this.planeVertical);v.plane.setOffsetFromPoint(this.planeVertical,T,this.planeVertical);
if(!u.disableContextNavigation()&&this.view._stage.getCamera()._contextNavigation){O=q.create();Q=q.create();F=q.create();m.subtract(O,T,this.currentCamera.eye);m.normalize(O,O);T=5*Math.max(Math.abs(this.view.camera.position.z),50);const N=this.view._stage.renderView.getMinimalDepthForArea(this.beginCenterScreen[0],this.beginCenterScreen[1],this.view._stage.getCamera(),80);m.copy(F,m.add(Q,this.currentCamera.eye,m.scale(Q,O,N?Math.min(N,T):T)));this.planeVertical[3]=-m.dot(this.planeVertical,F)}this.computePlanePoints(M.pointers,
this.planeVertical,this.beginCamera,this.tmpPoints)}else this.computePlanePoints(M.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);x.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};S.update=function(M){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var T=1<M.pointers.size,O=this.panMode===x.NavigationMode.Horizontal?this.planeHorizontal:this.planeVertical,Q=this.beginCenter;if(T){var F=this.beginRadius/
M.radius;this.scalingValueSmooth.gain=.001875*Math.min(Math.max(M.radius,40),120);this.scalingValueSmooth.update(F);x.applyZoomToPoint(this.currentCamera,Q,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*M.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=y.pixelDistanceToInteractionFactor(Math.abs(M.radius-this.beginRadius));y.applyAll(this.view,this.currentCamera,
this.constraintOptions)}this.computePlanePoints(M.pointers,O,this.currentCamera,this.tmpPoints);x.centroid(this.tmpPoints,this.tmpCentroid3d);w.screenPointObjectToArray(M.center,this.tmpCentroid2d);x.applyPanPlanar(this.currentCamera,Q,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*M.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=y.pixelDistanceToInteractionFactor(this.beginCenterScreen,this.tmpCentroid2d);
y.applyAll(this.view,this.currentCamera,this.constraintOptions);T&&(T=this.planeHorizontal,O=this.rotationValueSmooth.value,F=x.normalizeRotationDelta(M.angle-O),O+=F,this.rotationValueSmooth.gain=.00125*Math.min(Math.max(M.radius,40),120),this.rotationValueSmooth.update(O),O=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(O,.001*M.timestamp),x.applyRotation(this.currentCamera,Q,v.axisAngle.wrapAxisAngle(T,O)),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=
y.pixelDistanceToInteractionFactor(Math.abs(M.radius*O)),y.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};S.end=function(M){M.pointers.size===this.pointerCount&&this.update(M);this.finishController();return(M=this.zoomMomentumEstimator.evaluateMomentum())?new D.ZoomPlanarMomentumController({view:this.view,momentum:M,zoomCenter:this.beginCenter}):(M=this.rotationMomentumEstimator.evaluateMomentum())?new t.RotationMomentumController({view:this.view,
momentum:M,center:this.beginCenter,axis:v.plane.normal(this.planeHorizontal)}):(M=this.panMomentumEstimator.evaluateMomentum())?new A.PanPlanarMomentumController({view:this.view,momentum:M}):null};S.computePlanePoints=function(M,T,O,Q){Q.length=M.size;const F=this.tmp2d;let N=0;M.forEach(P=>{F[0]=P.x;F[1]=P.y;void 0===Q[N]&&(Q[N]=q.create());x.intersectPlaneFromScreenPoint(T,O,F,Q[N]);N+=1});return Q};k._createClass(L,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return L}(C.InteractiveController);a.__decorate([d.property({constructOnly:!0})],b.PinchAndPanController.prototype,"view",void 0);b.PinchAndPanController=a.__decorate([e.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],b.PinchAndPanController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(b,k,a){a=
function(r){function l(h,d){var c=r.call(this,!0)||this;c.view=h;c.registerIncoming("pointer-down",d,()=>c.view.state.stopActiveCameraController());return c}k._inheritsLoose(l,r);return l}(a.InputHandler);b.PointerDownCancelAnimation=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(b,k,a){a=function(r){function l(h,d,c){c=r.call(this,d,c)||this;
c.view=h;c.key=d;return c}k._inheritsLoose(l,r);l.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>{})};return l}(a.SingleKey);b.SingleKeyResetHeading=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(b,k,a){a=function(r){function l(h,d){var c=r.call(this,!0)||this;c.key=h;c.registerIncoming("key-down",d,e=>c._handleKeyDown(e));
return c}k._inheritsLoose(l,r);l.prototype._handleKeyDown=function(h){h.data.key===this.key&&(this.activate(),h.stopPropagation())};return l}(a.InputHandler);b.SingleKey=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(b,k,a){a=function(r){function l(h,d,c){c=r.call(this,d,c)||this;c.view=h;c.key=d;return c}k._inheritsLoose(l,r);l.prototype.activate=
function(){this.view.goTo({tilt:0}).catch(()=>{})};return l}(a.SingleKey);b.SingleKeyResetTilt=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils","../../../input/InputHandler","../../state/controllers/RotateController"],function(b,k,a,r,l){r=function(h){function d(c,e=!1){var f=h.call(this,!0)||this;f.view=c;f.invert=e;f.registerIncoming("vertical-two-finger-drag",
g=>f.handleTwoFinger(g));return f}k._inheritsLoose(d,h);d.prototype.handleTwoFinger=function(c){const e=a.createScreenPointArray(0,c.data.delta*(this.invert?-1:1));switch(c.data.action){case "begin":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=new l.RotateController({view:this.view,pivot:"center"});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(e);break;case "update":this.cameraController&&this.cameraController.update(e);
break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}};return d}(r.InputHandler);b.TwoFingerTilt=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../InputHandler","../DragEventSeparator"],function(b,k,a,r){a=function(l){function h(c=20,e=40){var f=l.call(this,!1)||this;f._threshold=c;f._maxDelta=e;f.state="ready";f.emittedArtificalEnd2=
!1;f._vertical=f.registerOutgoing("vertical-two-finger-drag");f._artificalDrag=f.registerOutgoing("drag");f.dragEventSeparator=new r.DragEventSeparator({start:(g,p)=>f.observeStart(g,p),update:(g,p,n)=>f.observeUpdate(g,p,n),end:(g,p)=>f.observeEnd(p)});f.registerIncoming("drag",g=>f.dragEventSeparator.handle(g));return f}k._inheritsLoose(h,l);var d=h.prototype;d.observeStart=function(c,e){1===c&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:e.data.button,
buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center,artifical:!0}),e.stopPropagation());this.state=2===c?"ready":"failed"};d.observeUpdate=function(c,e,f){"failed"!==this.state&&2===c&&("active"===this.state?(this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"update"}),e.stopPropagation()):this.checkMovementWithinLimits(e.data,f.data)?
this.checkVerticalThresholdReached(e.data,f.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=e.data.center,this._artificalDrag.emit({action:"end",button:e.data.button,buttons:e.data.buttons,pointerType:e.data.pointerType,timestamp:e.data.timestamp,pointers:e.data.pointers,pointer:e.data.pointer,angle:e.data.angle,radius:e.data.radius,center:e.data.center,artifical:!0}),this._vertical.emit({delta:e.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),e.stopPropagation()):
this.state="failed")};d.observeEnd=function(c){"active"===this.state&&(this._vertical.emit({delta:c.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",c.stopPropagation())};d.checkMovementWithinLimits=function(c,e){let f=-Infinity,g=Infinity,p=-Infinity,n=Infinity;e.pointers.forEach(v=>{f=Math.max(f,v.x);g=Math.min(g,v.x);p=Math.max(p,v.y);n=Math.min(n,v.y)});let w=-Infinity,q=Infinity,m=-Infinity,u=Infinity;c.pointers.forEach(v=>{w=Math.max(w,v.x);q=Math.min(q,v.x);m=
Math.max(m,v.y);u=Math.min(u,v.y)});return Math.abs(c.center.x-e.center.x)<this._threshold&&Math.abs(w-q-(f-g))<=this._maxDelta&&Math.abs(m-u-(p-n))<=this._maxDelta};d.checkVerticalThresholdReached=function(c,e){let f=Math.abs(c.center.y-e.center.y);c.pointers.forEach((g,p)=>{p=e.pointers.get(p);f=Math.min(f,Math.abs(g.y-p.y))});return f>=this._threshold};k._createClass(h,[{key:"failed",get:function(){return"failed"===this.state}}]);return h}(a.InputHandler);b.VerticalTwoFingerDrag=a;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(b){let k=function(){function a(l){this.callbacks=l;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=()=>!0)}var r=a.prototype;r.handle=function(l){const h=l.data,d=h.pointers.size;switch(h.action){case "start":this.currentCount=d;this.emitStart(l);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=d;this.emitStart(l);break;case "update":this.emitUpdate(l);
break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=d;this.emitStart(l);break;case "end":this.emitEnd(l),this.currentCount=0}this.previousEvent=l};r.emitStart=function(l){this.startEvent=l;this.callbacks.condition(this.currentCount,l)&&this.callbacks.start(this.currentCount,l,this.startEvent)};r.emitUpdate=function(l){this.callbacks.condition(this.currentCount,l)&&this.callbacks.update(this.currentCount,l,this.startEvent)};r.emitEnd=function(l){this.callbacks.condition(this.currentCount,
l)&&this.callbacks.end(this.currentCount,l,this.startEvent);this.startEvent=null};return a}();b.DragEventSeparator=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/debugFlags":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p){a=function(n){function w(){var q=n.apply(this,arguments)||this;q.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;q.SCENEVIEW_LOCKING_LOG=!1;q.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;q.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;q.DECONFLICTOR_SHOW_VISIBLE=!1;q.DECONFLICTOR_SHOW_INVISIBLE=!1;q.DECONFLICTOR_SHOW_GRID=!1;q.LABELS_SHOW_BORDER=!1;q.OVERLAY_DRAW_DEBUG_TEXTURE=!1;q.OVERLAY_SHOW_CENTER=!1;q.SHOW_POI=!1;q.TERRAIN_DEBUG_POPUP=!1;q.TESTS_DISABLE_UPDATE_THRESHOLDS=!1;q.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET=
!1;q.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;q.DRAW_MESH_GEOMETRY_NORMALS=!1;q.FEATURE_TILE_FETCH_SHOW_TILES=!1;q.FEATURE_TILE_TREE_SHOW_TILES=!1;q.I3S_TREE_SHOW_TILES=!1;q.I3S_SHOW_MODIFICATIONS=!1;q.ENABLE_PROFILE_DEPTH_RANGE=!1;q.DISABLE_FAST_UPDATES=!1;q.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;q.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;q.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;return q}b._inheritsLoose(w,n);return w}(p);k.__decorate([h.property()],a.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",
void 0);k.__decorate([h.property()],a.prototype,"SCENEVIEW_LOCKING_LOG",void 0);k.__decorate([h.property()],a.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);k.__decorate([h.property()],a.prototype,"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);k.__decorate([h.property()],a.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);k.__decorate([h.property()],a.prototype,"DECONFLICTOR_SHOW_INVISIBLE",void 0);k.__decorate([h.property()],a.prototype,"DECONFLICTOR_SHOW_GRID",void 0);k.__decorate([h.property()],
a.prototype,"LABELS_SHOW_BORDER",void 0);k.__decorate([h.property()],a.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);k.__decorate([h.property()],a.prototype,"OVERLAY_SHOW_CENTER",void 0);k.__decorate([h.property()],a.prototype,"SHOW_POI",void 0);k.__decorate([h.property()],a.prototype,"TERRAIN_DEBUG_POPUP",void 0);k.__decorate([h.property()],a.prototype,"TESTS_DISABLE_UPDATE_THRESHOLDS",void 0);k.__decorate([h.property()],a.prototype,"DISABLE_DECONFLICTOR_VISIBILITY_OFFSET",void 0);k.__decorate([h.property()],
a.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);k.__decorate([h.property()],a.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);k.__decorate([h.property()],a.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);k.__decorate([h.property()],a.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);k.__decorate([h.property()],a.prototype,"I3S_TREE_SHOW_TILES",void 0);k.__decorate([h.property()],a.prototype,"I3S_SHOW_MODIFICATIONS",void 0);k.__decorate([h.property()],a.prototype,"ENABLE_PROFILE_DEPTH_RANGE",
void 0);k.__decorate([h.property()],a.prototype,"DISABLE_FAST_UPDATES",void 0);k.__decorate([h.property()],a.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);k.__decorate([h.property()],a.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);k.__decorate([h.property()],a.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);a=k.__decorate([c.subclass("esri.views.3d.support.DebugFlags")],a);return new a})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Handles ../../../../core/watchUtils ../../../support/Scheduler ../../../../core/MapUtils ../../support/geometryUtils ./Deconflictor ./LabelDeconflictor".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){function x(z){z=z.layer;return!(!z||!z.featureReduction||"selection"!==z.featureReduction.type)}function C(z){(z=z.graphics3DGraphics)&&z.forEach(A=>A.clearVisibilityFlag(3))}b.GraphicsDeconflictor=function(z){function A(){var D=z.apply(this,arguments)||this;D._handles=new w;D._contexts=new Map;D._viewState=new y.DeconflictorViewState;D.visibilityGroup=0;D._iconMarginFactor=-.1;return D}k._inheritsLoose(A,z);var t=A.prototype;t.initialize=function(){this._handles.add([this.view.watch("state.camera",
()=>{this.updateViewState();this.setDirty()}),this.view.watch("map.ground.opacity",(D,E)=>{1!==D&&1!==E||this.setDirty()}),q.init(this.view,"slicePlane",()=>{this.updateSlicePlane();this.slicePlaneChanged()})]);this._frameTask=this.view.resourceController.scheduler.registerTask(m.Task.GRAPHICS_DECONFLICTOR,D=>this.update(D),()=>this.needsUpdate());this._labels=new B.LabelDeconflictor({view:this.view,parent:this})};t.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();
this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};t.setDirty=function(){0<this._contexts.size&&(z.prototype.setDirty.call(this),this._labels.setDirty())};t.update=function(D){z.prototype.update.call(this,D);this.needsUpdate()||this._labels.setDirty()};t.setInitialIconVisibilityFlag=function(D,E){D=!(this._graphicSupportsDeconfliction(E)&&x(D));E.setVisibilityFlag(3,D,0)};t.updateViewState=function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),
this.updateSlicePlane())};t.updateSlicePlane=function(){const D=this.view?this.view.slicePlane:null;l.isSome(D)&&v.boundedPlane.transform(D,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=l.isSome(D)};t.slicePlaneChanged=function(){u.someMap(this._contexts,(D,E)=>E.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()};t.addGraphicsOwner=function(D){let E=this._contexts.get(D);null==E&&(E=new Map,this._contexts.set(D,E),this.setDirty());return{addGraphic:G=>
this.addGraphic(D,E,G),removeGraphic:G=>this.removeGraphic(E,G),labelingInfoChange:()=>this._labels.enabledChanged(D,E),featureReductionChange:()=>this.enabledChanged(D,E),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(D,E),clear:()=>E.forEach(G=>this.removeGraphic(E,G.graphics3DGraphic))}};t.removeGraphicsOwner=function(D){const E=this._contexts.get(D);E&&(E.forEach(G=>this.removeGraphic(E,G.graphics3DGraphic)),this._contexts.delete(D),this.setDirty())};t.addGraphic=function(D,E,G){const H=
G.graphic.uid;G=new y.DeconflictorGraphic(G,D.symbolCreationContext.slicePlaneEnabled);E.set(H,G);x(D)&&this.addToActiveGraphics(G);D.labelsEnabled&&this._labels.addToActiveGraphics(G)};t.removeGraphic=function(D,E){E=E.graphic.uid;const G=D.get(E);G&&(this.removeFromActiveGraphics(G),this._labels.removeFromActiveGraphics(G),D.delete(E),this.setDirty())};t.enabledChanged=function(D,E){const G=x(D);G||C(D);this.modifyGraphics(E,G)};t._slicePlaneEnabledChanged=function(D,E){const G=D.symbolCreationContext.slicePlaneEnabled;
E.forEach(H=>H.slicePlaneEnabled=G);this.setDirty()};t.getGraphicsLayers=function(D){return D._graphics};t._graphicSupportsDeconfliction=function(D){if(D.isDraped)return!1;D=D._graphics;if(!D||!D.length)return!1;for(const E of D)if(this.layerSupportsDeconfliction(E))return!0;return!1};k._createClass(A,[{key:"labels",get:function(){return this._labels}},{key:"viewState",get:function(){return this._viewState}},{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(D){this._iconMarginFactor=
D;this.setDirty()}}]);return A}(y.Deconflictor);b.GraphicsDeconflictor=a.__decorate([f.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],b.GraphicsDeconflictor);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/PooledArray ../../../../core/Accessor ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec4 ../../../../chunks/sphere ../../support/geometryUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/Camera ../../support/debugFlags ./deconflictorDebug ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L){function*S(ea){if(Map.prototype.entries){ea=ea.entries();for(let Y=ea.next();!Y.done;Y=ea.next())yield Y.value[1]}else yield*ea.values()}function*M(ea,Y,Z){Y.clear();ea.forEach((ia,ja)=>{const la=Y.pushNew();la.id=ja;la.prio=ia.info?-ia.info[Z].distance:Number.MAX_VALUE});yield;const ba=Y.iterableSort((ia,ja)=>ja.prio-ia.prio);for(let ia=ba.next();!ia.done;ia=ba.next())yield;Y.forAll(ia=>{const ja=ea.get(ia.id);ja&&(ea.delete(ia.id),
ea.set(ia.id,ja))});Y.clear()}const T=u.create(),O=A.create(),Q=A.create(),F=u.create(),N=C.create(),P=E.sphere.create(),U=E.ray.create(),V=u.create(),W=x.create();let X=function(){this.aabr=x.create();this.distance=0;this.visible=this.culled=!1},ca=function(){function ea(){this.active=new Map;this.visible=new Map}ea.prototype.clear=function(){this.active.clear();this.visible.clear()};return ea}(),R=function(){},aa=function(){this.sortArray=new w({allocator:ea=>ea||new R})},ka=function(){function ea(){this.camera=
new H;this.slicePlane=E.boundedPlane.create();this.slicePlaneEnabled=!1}ea.prototype.copyFrom=function(Y){this.camera.copyFrom(Y.camera);E.boundedPlane.copy(Y.slicePlane,this.slicePlane);this.slicePlaneEnabled=Y.slicePlaneEnabled};return ea}();b.Deconflictor=function(ea){function Y(){var ba=ea.apply(this,arguments)||this;ba._dirty=!1;ba._runningViewState=new ka;ba._state=0;ba.graphics=new ca;ba.iterators=new aa;ba.accBinsNumX=15;ba.accBinsNumY=20;ba.accBinsSizeX=0;ba.accBinsSizeY=0;ba.accBins=null;
ba.accNumTests=0;return ba}k._inheritsLoose(Y,ea);var Z=Y.prototype;Z.destroy=function(){this.graphics.clear();this.iterators=null};Z.setDirty=function(){!this._dirty&&0<this.graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};Z.needsUpdate=function(){return this.view.ready&&null!=this.view.state&&this.updating};Z.update=function(ba){switch(this._state){case 0:this.startUpdate(),ba.madeProgress();case 1:if(this._state=1,!this.processActiveGraphics(ba))break;case 2:if(this._state=
2,!this.sortVisibleGraphics(ba))break;case 3:if(this._state=3,!this.deconflictVisibleGraphics(ba))break;default:J.drawAccelerationStruct(this,this.graphics.visible),this._state=0,this.notifyChange("updating")}};Z.modifyGraphics=function(ba,ia){ia?ba.forEach(ja=>this.addToActiveGraphics(ja)):ba.forEach(ja=>this.removeFromActiveGraphics(ja));this.setDirty()};Z.layerSupportsDeconfliction=function(ba){if(l.isNone(ba)||"object3d"!==ba.type)return!1;ba=ba.stageObject;return 1===(ba?ba.getNumGeometryRecords():
0)&&ba.getGeometryRecord(0).material instanceof L.HUDMaterial?!0:!1};Z.startUpdate=function(){J.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);const {fullWidth:ba,fullHeight:ia}=this._runningViewState.camera;this.initBins(ba,ia);this.resetIterators()};Z.addToActiveGraphics=function(ba){ba.info[this.visibilityGroup]=new X;this.graphics.active.set(ba.graphics3DGraphic.graphic.uid,ba);this.setDirty()};Z.removeFromActiveGraphics=function(ba){this.removeFromVisibleGraphics(ba);
{const ia=ba.graphics3DGraphic;ia.destroyed||ia.clearVisibilityFlag(3,this.visibilityGroup)}delete ba.info[this.visibilityGroup];this.graphics.active.delete(ba.graphics3DGraphic.graphic.uid);this.setDirty()};Z.addToVisibleGraphics=function(ba){this.graphics.visible.set(ba.graphics3DGraphic.graphic.uid,ba)};Z.removeFromVisibleGraphics=function(ba){this.graphics.visible.delete(ba.graphics3DGraphic.graphic.uid)};Z.processActiveGraphics=function(ba){const ia=this.ensureActiveGraphicsIterator(),ja=B.invert(N,
this._runningViewState.camera.projectionMatrix),la="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?P:null;let qa=0;l.isSome(la)&&(v.transformMat4(la.center,u.ZEROS,this._runningViewState.camera.viewMatrix),la.radius=y.getReferenceEllipsoid(this.view.spatialReference).radius,qa=E.sphere.distanceToSilhouette(la,u.ZEROS));for(;!ba.done;){ba.madeProgress();var na=ia.next();if(na.done)return this.resetActiveGraphicsIterator(),!0;const oa=
(na=na.value)&&na.info[this.visibilityGroup];oa&&(this.collectGraphics3DGraphics(na,ja,la,qa),oa.culled?this.removeFromVisibleGraphics(na):this.addToVisibleGraphics(na))}return!1};Z.sortVisibleGraphics=function(ba){const ia=this.ensureSortGraphicsIterator();for(;!ba.done;){const ja=ia.next();ba.madeProgress();if(ja.done)return this.resetSortGraphicsIterator(),!0}return!1};Z.deconflictVisibleGraphics=function(ba){const ia=this.ensureVisibleGraphicsIterator(),ja=1===this.visibilityGroup;for(;!ba.done;){ba.madeProgress();
var la=ia.next();if(la.done)return this.resetVisibleGraphicsIterator(),!0;la=la.value;const na=la.info[this.visibilityGroup];if(na&&!na.culled){var qa=la.graphics3DGraphic;(qa=(!ja||qa.isVisible())&&!this.isConflicted(la))&&this.addToBins(la);na.visible=qa;this.setGraphicVisibility(la,qa);J.drawPoly(na,qa)}}return!1};Z.resetIterators=function(){this.iterators.active=null;this.iterators.visible=null;this.iterators.sort=null};Z.ensureActiveGraphicsIterator=function(){this.iterators.active||(this.iterators.active=
S(this.graphics.active));return this.iterators.active};Z.resetActiveGraphicsIterator=function(){this.iterators.active=null};Z.ensureVisibleGraphicsIterator=function(){this.iterators.visible||(this.iterators.visible=S(this.graphics.visible));return this.iterators.visible};Z.resetVisibleGraphicsIterator=function(){this.iterators.visible=null};Z.ensureSortGraphicsIterator=function(){this.iterators.sort||(this.iterators.sort=M(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup));return this.iterators.sort};
Z.resetSortGraphicsIterator=function(){this.iterators.sort=null};Z.collectGraphics3DGraphics=function(ba,ia,ja,la){var qa=ba.graphics3DGraphic;if(!qa.destroyed){var na=ba.info[this.visibilityGroup];if(qa.isVisible(0,3)){var oa=this.getGraphicsLayers(qa);x.empty(na.aabr);qa=null;for(const ua of oa)if(this.layerSupportsDeconfliction(ua)){oa=ua.stageObject.getGeometryRecord(0).material;if(l.isNone(qa)){qa=this.getProjectionInfo(ua,ia,fa);if(qa.isOutsideScreen||this.isCulledBySlice(ba,T)||l.isSome(ja)&&
this.isCulledByHorizon(qa,ja,la)){na.culled=!0;return}!I.DISABLE_DECONFLICTOR_VISIBILITY_OFFSET&&na.visible&&(qa.distance*=.7)}this.expandBoundingRect(na,ua,oa,qa)}l.isNone(qa)?na.culled=!0:(na.distance=qa.distance,na.culled=!1)}else na.culled=!0}};Z.getProjectionInfo=function(ba,ia,ja){const la=this._runningViewState.camera;ba=ba.stageObject;var qa=ba.getGeometryRecord(0);const na=qa.material;var oa=ba.getCenter();v.transformMat4(T,oa,la.viewMatrix);qa=qa.geometry.data.getVertexAttr();oa=qa[G.VertexAttrConstants.AUXPOS1].data;
na.applyShaderOffsetsView(T,qa[G.VertexAttrConstants.NORMAL].data,ba.objectTransformation,oa,la,ja.scaleInfo,T);t.set(O,T[0],T[1],T[2],1);t.transformMat4(Q,O,la.projectionMatrix);v.scale(ja.positionNDC,Q,1/Q[3]);na.applyShaderOffsetsNDC(ja.positionNDC,oa,la,ja.positionNDC,F);ja.distanceWithoutPolygonOffset=la.depthNDCToWorld(F[2]);ja.distance=F[2]===ja.positionNDC[2]?ja.distanceWithoutPolygonOffset:la.depthNDCToWorld(ja.positionNDC[2]);t.set(Q,ja.positionNDC[0],ja.positionNDC[1],ja.positionNDC[2],
1);t.transformMat4(O,Q,ia);t.scale(O,O,1/O[3]);v.set(ja.positionView,T[0],T[1],T[2]);return ja};Z.isCulledByHorizon=function(ba,ia,ja){v.copy(U.direction,ba.positionView);v.set(U.origin,0,0,0);return D.intersectRay(ia,U,V)?ba.distanceWithoutPolygonOffset>ja:!1};Z.isCulledBySlice=function(ba,ia){return ba.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&E.boundedPlane.extrusionContainsPoint(this._runningViewState.slicePlane,ia)};Z.expandBoundingRect=function(ba,ia,ja,{positionNDC:la,scaleInfo:qa}){const na=
this._runningViewState.camera;ia=ia.getScreenSize(da);K.applyPrecomputedScaleFactor(ia,qa.factor,ia);ia[0]*=na.pixelRatio;ia[1]*=na.pixelRatio;ja=x.offset(ja.calculateRelativeScreenBounds(ia,qa.factorAlignment.scale,W),m.lerp(0,na.fullWidth,.5+.5*la[0]),m.lerp(0,na.fullHeight,.5+.5*la[1]));la=this.iconMarginFactor;0!==la&&(la*=Math.min(x.width(ja),x.height(ja)),ja[0]-=la,ja[1]-=la,ja[2]+=la,ja[3]+=la);x.expand(ba.aabr,ja)};Z.isConflicted=function(ba){const ia=ba.graphics3DGraphic.graphic.uid;ba=ba.info[this.visibilityGroup];
for(let ja=Math.floor(ba.aabr[0]/this.accBinsSizeX);ja<=Math.floor(ba.aabr[2]/this.accBinsSizeX);ja++)if(!(0>ja||ja>=this.accBinsNumX))for(let la=Math.floor(ba.aabr[1]/this.accBinsSizeY);la<=Math.floor(ba.aabr[3]/this.accBinsSizeY);la++){if(0>la||la>=this.accBinsNumY)continue;const qa=this.accBins[ja][la];for(let na=0;na<qa.length;na++){const oa=qa.data[na],ua=oa.info[this.visibilityGroup];if(ua&&ua.visible&&oa.graphics3DGraphic.graphic.uid!==ia&&(this.accNumTests++,x.intersects(ua.aabr,ba.aabr)))return!0}}return!1};
Z.initBins=function(ba,ia){if(null==this.accBins){this.accBins=[];for(var ja=0;ja<this.accBinsNumX;ja++){this.accBins.push([]);var la=this.accBins[this.accBins.length-1];for(let qa=0;qa<this.accBinsNumY;qa++)la.push(new w)}}else for(ja=0;ja<this.accBinsNumX;ja++)for(la=0;la<this.accBinsNumY;la++)this.accBins[ja][la].clear();this.accBinsSizeX=ba/this.accBinsNumX;this.accBinsSizeY=ia/this.accBinsNumY;this.accNumTests=0};Z.addToBins=function(ba){var ia=ba.info[this.visibilityGroup],ja=Math.floor(ia.aabr[0]/
this.accBinsSizeX);const la=Math.floor(ia.aabr[2]/this.accBinsSizeX),qa=Math.floor(ia.aabr[1]/this.accBinsSizeY);for(ia=Math.floor(ia.aabr[3]/this.accBinsSizeY);ja<=la;ja++)if(!(0>ja||ja>=this.accBinsNumX))for(let na=qa;na<=ia;na++)0>na||na>=this.accBinsNumY||this.accBins[ja][na].push(ba)};Z.setGraphicVisibility=function(ba,ia){ba=ba.graphics3DGraphic;ba.destroyed||(ba.setVisibilityFlag(3,ia,this.visibilityGroup),1===this.visibilityGroup&&this.view.labeler.setLabelGraphicVisibility(ba,ia))};k._createClass(Y,
[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},{key:"updating",get:function(){return 0!==this._state||this._dirty}},{key:"updatingProgress",get:function(){if(!this.updating)return 1;const ba=this._state/4;return this._dirty?.5*ba:ba}}]);return Y}(q);a.__decorate([c.property({constructOnly:!0})],b.Deconflictor.prototype,"view",void 0);a.__decorate([c.property({type:Boolean,readOnly:!0})],b.Deconflictor.prototype,"updating",null);b.Deconflictor=a.__decorate([f.subclass("esri.views.3d.layers.graphics.Deconflictor")],
b.Deconflictor);const da=z.create(),fa=new (function(){function ea(){this.positionView=u.create();this.positionNDC=u.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}k._createClass(ea,[{key:"isOutsideScreen",get:function(){const Y=this.positionNDC;return-1>Y[0]||-1>Y[1]||-1>Y[2]||1<=Y[0]||1<=Y[1]}}]);return ea}());b.DeconflictorGraphic=function(ea,Y,
Z={}){this.graphics3DGraphic=ea;this.slicePlaneEnabled=Y;this.info=Z};b.DeconflictorViewState=ka;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(b,k){function a(g,p,n,w,q){c&&(c(),c=null);const m=e.height,u=f;u.beginPath();u.lineWidth=1;u.strokeStyle=q;u.moveTo(g,m-n);u.lineTo(p,m-n);u.stroke();u.lineTo(p,m-w);u.stroke();u.lineTo(p,m-n);u.stroke();u.lineTo(g,m-n);u.stroke();u.lineTo(g,
m-n);u.stroke();u.closePath()}let r=!1,l=!1,h=!1,d=!1,c=null,e,f;b.drawAccelerationStruct=function(g,p){if(l&&f){c&&(c(),c=null);var n=f,w=0;for(let q=0;q<g.accBinsNumX;q++)for(let m=0;m<g.accBinsNumY;m++){const u=g.accBins[q][g.accBinsNumY-1-m];w+=u.length;const v=q*g.accBinsSizeX,y=(q+1)*g.accBinsSizeX,B=m*g.accBinsSizeY,x=(m+1)*g.accBinsSizeY;n.fillText(u.length.toFixed(),v+5,B+15);a(v,y,B,x,"blue")}n.fillText("total totalShownLabels: "+w,70,40);n.fillText("total visible labels: "+p.size,70,50);
n.fillText("total numTests: "+g.accNumTests,70,30)}};b.drawPoly=function(g,p){r&&(p&&h||!p&&d)&&a(g.aabr[0],g.aabr[2],g.aabr[1],g.aabr[3],p?"green":"red")};b.prepare=function(g){h=k.DECONFLICTOR_SHOW_VISIBLE;d=k.DECONFLICTOR_SHOW_INVISIBLE;r=h||d;l=k.DECONFLICTOR_SHOW_GRID;c=null;r||l?c=()=>{{null==e&&(e=document.createElement("canvas"),e.setAttribute("id","canvas2d"),g.surface.parentElement.style.position="relative",g.surface.parentElement.appendChild(e));const p=g.height*g.pixelRatio;e.setAttribute("width",
`${g.width*g.pixelRatio}px`);e.setAttribute("height",`${p}px`);e.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${g.width}px;height:${g.height}px`);f=e.getContext("2d");f.clearRect(0,0,g.width,g.height);f.font="12px Arial"}}:e&&(e.parentElement.removeChild(e),e=null)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/mathUtils"],function(b,k,a){function r(g,p,n){const w=n.parameters;n=n.paddingPixelsOverride;e.scale=Math.min(w.divisor/(p-w.offset),1);e.factor=Math.abs(g*g*g);e.minPixelSize=w.minPixelSize;e.paddingPixels=n;return e}function l(g,p){return 0===g?p.minPixelSize:p.minPixelSize*(1+2*p.paddingPixels/g)}function h(g,p){return Math.max(a.lerp(g*p.scale,g,p.factor),l(g,p))}let d=function(){function g(n,w,q,m={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},
u){this.viewingMode=n;this.description=w;this.ellipsoidRadius=q;this.parameters=m;this._paddingPixelsOverride=u;2===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}var p=g.prototype;p.update=function(n){if(this.parameters&&
this.parameters.camera.fovY===n.fovY&&this.parameters.camera.distance===n.distance)return!1;this.calculateParameters(n,this.ellipsoidRadius,this.parameters);return!0};p.overridePadding=function(n){return n!==this.paddingPixelsOverride?new g(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,n):this};p.calculateParameters=function(n,w,q){const {scaleStart:m,scaleFallOffRange:u,minPixelSize:v}=this.description,{fovY:y,distance:B}=n;var x=this.calculateCurvatureDependentParameters(n,
w);w=this.coverageCompensation(n,w,x);const {tiltAngle:C,scaleFallOffFactor:z}=x,A=Math.sin(C)*B,t=.5*Math.PI-C-y*(.5-m*w);x=A/Math.cos(t);w=(x-A/Math.cos(t+y*u*w)*z)/(1-z);q.camera.fovY=n.fovY;q.camera.distance=n.distance;q.offset=w;q.divisor=x-w;q.minPixelSize=v;return q};p.calculateCurvatureDependentParametersLocal=function(n,w,q=f){q.tiltAngle=this.description.curvatureDependent.min.tiltAngle;q.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return q};p.calculateCurvatureDependentParametersGlobal=
function(n,w,q=f){const m=this.description.curvatureDependent;n=1+n.distance/w;n=Math.sqrt(n*n-1);const [u,v]=[m.min.curvature,m.max.curvature];n=a.clamp((n-u)/(v-u),0,1);const [y,B]=[m.min,m.max];q.tiltAngle=a.lerp(y.tiltAngle,B.tiltAngle,n);q.scaleFallOffFactor=a.lerp(y.scaleFallOffFactor,B.scaleFallOffFactor,n);return q};p.surfaceCoverageCompensationLocal=function(n,w,q){return(n.fovY-q.tiltAngle)/n.fovY};p.surfaceCoverageCompensationGlobal=function(n,w,q){const m=w*w;q=q.tiltAngle+.5*Math.PI;
const {fovY:u,distance:v}=n;n=v*v+m-2*Math.cos(q)*v*w;const y=Math.sqrt(n);return(Math.acos(Math.sqrt(n-m)/y)-Math.asin(w/(y/Math.sin(q)))+.5*u)/u};k._createClass(g,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]);return g}();const c={curvatureDependent:{min:{curvature:a.deg2rad(10),tiltAngle:a.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:a.deg2rad(70),tiltAngle:a.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,
minPixelSize:0},e={scale:0,factor:0,minPixelSize:0,paddingPixels:0},f={tiltAngle:0,scaleFallOffFactor:0};b.applyPrecomputedScaleFactor=function(g,p,n=[0,0]){p=Math.min(Math.max(p.scale,l(g[1],p)/g[1]),1);n[0]=g[0]*p;n[1]=g[1]*p;return n};b.applyScaleFactor=h;b.applyScaleFactorVec2=function(g,p,n=[0,0]){const w=Math.min(Math.max(p.scale,l(g[1],p)/g[1]),1);n[0]=a.lerp(g[0]*w,g[0],p.factor);n[1]=a.lerp(g[1]*w,g[1],p.factor);return n};b.getLabelSettings=function(g,p){const {curvatureDependent:n,scaleStart:w,
scaleFallOffRange:q}=c;return new d(g,{curvatureDependent:{min:{curvature:n.min.curvature,tiltAngle:n.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:n.max.curvature,tiltAngle:n.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:w,scaleFallOffRange:q,minPixelSize:14},p)};b.getSettings=function(g,p){return new d(g,c,p)};b.precomputeScaleFactor=function(g,p,n,w){g=r(g,p,n);g.minPixelSize=0;g.paddingPixels=0;g=h(1,g);w.scale=g;w.factor=0;w.minPixelSize=n.parameters.minPixelSize;w.paddingPixels=n.paddingPixelsOverride};
b.scale=function(g,p,n,w){return h(g,r(p,n,w))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/mat3 ../../../../chunks/vec2 ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/Util ./renderers/utils ../lib/screenSizePerspectiveUtils ../../../../core/libs/gl-matrix-2/types/mat4 ../lib/GLMaterialTexture ./internal/MaterialUtil ../lib/Material ./internal/bufferWriterUtils ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D){function E(da,fa,ea,Y=L){w.copy(Y,da.anchorPos);Y[0]*=-fa[0];Y[1]*=-fa[1];Y[0]+=da.screenOffset[0]*ea;Y[1]+=da.screenOffset[1]*ea;return Y}function G(da,fa,ea,Y,Z,ba,ia,ja){fa=fa-Z-(0<ja[0]?Y[0]*ja[0]:0);let la=fa+Y[0]+2*Z;ea=ea-Z-(0<ja[1]?Y[1]*ja[1]:0);Z=ea+Y[1]+2*Z;ia.textureIsSignedDistanceField&&(ia=ia.distanceFieldBoundingBox,fa+=Y[0]*ia[0],ea+=Y[1]*ia[1],la-=Y[0]*(1-ia[2]),Z-=Y[1]*(1-ia[3]),fa-=ba,la+=ba,ea-=ba,Z+=ba);return da[0]>
fa&&da[0]<la&&da[1]>ea&&da[1]<Z}let H=function(da){function fa(Y,Z){Y=da.call(this,Z,Y,R)||this;Y.techniqueConfig=new D.HUDMaterialTechniqueConfiguration;return Y}k._inheritsLoose(fa,da);var ea=fa.prototype;ea.getTechniqueConfig=function(Y,Z){this.techniqueConfig.output=Y;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.screenCenterOffsetUnitsEnabled=
"screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.polygonOffsetEnabled=this.params.polygonOffset;this.techniqueConfig.isDraped=this.params.isDraped;this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.pixelSnappingEnabled=this.params.pixelSnappingEnabled;this.techniqueConfig.sdf=this.params.textureIsSignedDistanceField;this.techniqueConfig.vvSize=!!this.params.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.params.vvColorEnabled;0===Y&&(this.techniqueConfig.debugDrawBorder=
!!this.params.debugDrawBorder);4===Y&&(this.techniqueConfig.binaryHighlightOcclusion=this.params.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.params.depthEnabled;this.techniqueConfig.transparencyPassType=Z?Z.transparencyPassType:3;return this.techniqueConfig};ea.intersect=function(Y,Z,ba,ia,ja,la,qa,na,oa){oa?this.intersectDrapedHudGeometry(Y,la,qa,na):this.intersectHudGeometry(Y,Z,ba,ia,qa,na)};ea.intersectDrapedHudGeometry=function(Y,Z,ba,ia){const ja=Y.getAttribute(u.VertexAttrConstants.POSITION),
la=Y.getAttribute(u.VertexAttrConstants.SIZE),qa=this.params,na=t.calculateAnchorPosForRendering(qa);let oa=1;var ua=1;ia&&(ua=ia(W),oa=ua[0],ua=ua[5]);oa*=Y.screenToWorldRatio;ua*=Y.screenToWorldRatio;ia=2*Y.screenToWorldRatio;for(let Fa=0;Fa<ja.data.length/ja.size;Fa++){var za=Fa*ja.size;const La=ja.data[za];za=ja.data[za+1];const Sa=Fa*la.size;X[0]=la.data[Sa]*oa;X[1]=la.data[Sa+1]*ua;let Ia;qa.textureIsSignedDistanceField&&(Ia=qa.outlineSize*Y.screenToWorldRatio/2);G(Z,La,za,X,ia,Ia,qa,na)&&ba()}};
ea.intersectHudGeometry=function(Y,Z,ba,ia,ja,la){if(ia.options.selectionMode&&ia.options.hud&&!v.isInstanceHidden(Z)){var qa=Y.data;Y=this.params;var na=Z=1;n.fromMat4(F,ba);if(la){na=la(W);Z=na[0];na=na[5];{la=F;var oa=la[0],ua=la[1],za=la[2],Fa=la[3],La=la[4],Sa=la[5],Ia=la[6],Qa=la[7],Pa=la[8],sa=1/Math.sqrt(oa*oa+ua*ua+za*za);const Ga=1/Math.sqrt(Fa*Fa+La*La+Sa*Sa),Ra=1/Math.sqrt(Ia*Ia+Qa*Qa+Pa*Pa);la[0]=oa*sa;la[1]=ua*sa;la[2]=za*sa;la[3]=Fa*Ga;la[4]=La*Ga;la[5]=Sa*Ga;la[6]=Ia*Ra;la[7]=Qa*Ra;
la[8]=Pa*Ra}}la=qa.getVertexAttr()[u.VertexAttrConstants.POSITION];oa=qa.getVertexAttr()[u.VertexAttrConstants.SIZE];ua=qa.getVertexAttr()[u.VertexAttrConstants.NORMAL];qa=qa.getVertexAttr()[u.VertexAttrConstants.AUXPOS1];u.assert(3<=la.size);za=ia.point;Fa=ia.camera;La=t.calculateAnchorPosForRendering(Y);Z*=Fa.pixelRatio;na*=Fa.pixelRatio;Sa="screen"===this.params.centerOffsetUnits;for(Ia=0;Ia<la.data.length/la.size;Ia++)if(Qa=Ia*la.size,d.set(S,la.data[Qa],la.data[Qa+1],la.data[Qa+2]),d.transformMat4(S,
S,ba),Qa=Ia*oa.size,X[0]=oa.data[Qa]*Z,X[1]=oa.data[Qa+1]*na,d.transformMat4(S,S,Fa.viewMatrix),Qa=Ia*qa.size,d.set(U,qa.data[Qa+0],qa.data[Qa+1],qa.data[Qa+2]),Sa||(S[0]+=U[0],S[1]+=U[1],0!==U[2]&&(Qa=U[2],d.normalize(U,S),d.subtract(S,S,d.scale(U,U,Qa)))),Qa=Ia*ua.size,d.set(M,ua.data[Qa],ua.data[Qa+1],ua.data[Qa+2]),this.normalAndViewAngle(M,F,Fa,V),this.applyVerticalOffsetTransformationView(S,V,Fa,K),Fa.applyProjection(S,T),-1<T[0]){Qa=Math.floor(T[0])+this.params.screenOffset[0];Pa=Math.floor(T[1])+
this.params.screenOffset[1];Sa&&(Qa+=U[0],0!==U[1]&&(Pa+=y.applyScaleFactor(U[1],K.factorAlignment)));y.applyPrecomputedScaleFactor(X,K.factor,X);sa=1*Fa.pixelRatio;let Ga;Y.textureIsSignedDistanceField&&(Ga=Y.outlineSize*Fa.pixelRatio/2);G(za,Qa,Pa,X,sa,Ga,Y,La)&&(Pa=ia.ray,d.transformMat4(Q,S,c.invert(P,Fa.viewMatrix)),T[0]=za[0],T[1]=za[1],Fa.unprojectFromRenderScreen(T,S)&&(Qa=h.create(),d.copy(Qa,Pa.direction),sa=1/d.length(Qa),d.scale(Qa,Qa,sa),Pa=d.distance(Pa.origin,S)*sa,ja(Pa,Qa,-1,1,!0,
Q)))}}};ea.computeAttachmentOrigin=function(Y,Z){Y=Y.data;var ba="getVertexAttr"in Y?Y.getVertexAttr():"vertexAttr"in Y?Y.vertexAttr:null;if(!ba)return null;const ia=u.VertexAttrConstants.POSITION;ba=ba[ia];Y="getIndices"in Y?Y.getIndices(ia):"indices"in Y?Y.indices[ia]:null;return m.computeAttachmentOriginPoints(ba,Y,Z)};ea.createBufferWriter=function(){return new ka(this)};ea.normalAndViewAngle=function(Y,Z,ba,ia){B.isMat4(Z)&&(Z=n.fromMat4(N,Z));d.transformMat3(ia.normal,Y,Z);d.transformMat4(ia.normal,
ia.normal,ba.viewInverseTransposeMatrix);ia.cosAngle=d.dot(O,ca);return ia};ea.updateScaleInfo=function(Y,Z,ba){const ia=this.params;ia.screenSizePerspective?y.precomputeScaleFactor(ba,Z,ia.screenSizePerspective,Y.factor):(Y.factor.scale=1,Y.factor.factor=0,Y.factor.minPixelSize=0,Y.factor.paddingPixels=0);ia.screenSizePerspectiveAlignment?y.precomputeScaleFactor(ba,Z,ia.screenSizePerspectiveAlignment,Y.factorAlignment):(Y.factorAlignment.factor=Y.factor.factor,Y.factorAlignment.scale=Y.factor.scale,
Y.factorAlignment.minPixelSize=Y.factor.minPixelSize,Y.factorAlignment.paddingPixels=Y.factor.paddingPixels)};ea.applyShaderOffsetsView=function(Y,Z,ba,ia,ja,la,qa){Z=this.normalAndViewAngle(Z,ba,ja,V);this.applyVerticalGroundOffsetView(Y,Z,ja,qa);this.applyVerticalOffsetTransformationView(qa,Z,ja,la);this.applyPolygonOffsetView(qa,Z,ia[3],ja,qa);this.applyCenterOffsetView(qa,ia,qa);return qa};ea.applyShaderOffsetsNDC=function(Y,Z,ba,ia,ja){this.applyCenterOffsetNDC(Y,Z,ba,ia);a.isSome(ja)&&d.copy(ja,
ia);this.applyPolygonOffsetNDC(ia,Z,ba,ia);return ia};ea.applyPolygonOffsetView=function(Y,Z,ba,ia,ja){var la=ia.aboveGround?1:-1;ba=r.sign(ba);0===ba&&(ba=la);la*=ba;if(0>=this.params.shaderPolygonOffset)return d.copy(ja,Y);Z=r.clamp(Math.abs(Z.cosAngle),.01,1);ia=1-Math.sqrt(1-Z*Z)/Z/ia.viewport[2];0<la?d.scale(ja,Y,ia):d.scale(ja,Y,1/ia);return ja};ea.applyVerticalGroundOffsetView=function(Y,Z,ba,ia){const ja=d.length(Y),la=ba.aboveGround?1:-1;ba=.5*ba.computeRenderPixelSizeAtDist(ja);Z=d.scale(S,
Z.normal,la*ba);d.add(ia,Y,Z);return ia};ea.applyVerticalOffsetTransformationView=function(Y,Z,ba,ia){const ja=this.params;if(!ja.verticalOffset||!ja.verticalOffset.screenLength){if(ja.screenSizePerspective||ja.screenSizePerspectiveAlignment){var la=d.length(Y);this.updateScaleInfo(ia,la,Z.cosAngle)}else ia.factor.scale=1,ia.factorAlignment.scale=1;return Y}la=d.length(Y);ba=C.verticalOffsetAtDistance(ba,la,ja.verticalOffset,Z.cosAngle,ja.screenSizePerspectiveAlignment||ja.screenSizePerspective);
this.updateScaleInfo(ia,la,Z.cosAngle);d.scale(Z.normal,Z.normal,ba);return d.add(Y,Y,Z.normal)};ea.applyCenterOffsetView=function(Y,Z,ba){const ia="screen"!==this.params.centerOffsetUnits;ba!==Y&&d.copy(ba,Y);ia&&(ba[0]+=Z[0],ba[1]+=Z[1],Z[2]&&(d.normalize(M,ba),d.add(ba,ba,d.scale(M,M,Z[2]))));return ba};ea.applyCenterOffsetNDC=function(Y,Z,ba,ia){const ja="screen"!==this.params.centerOffsetUnits;ia!==Y&&d.copy(ia,Y);ja||(ia[0]+=Z[0]/ba.fullWidth*2,ia[1]+=Z[1]/ba.fullHeight*2);return ia};ea.applyPolygonOffsetNDC=
function(Y,Z,ba,ia){const ja=this.params.shaderPolygonOffset;Y!==ia&&d.copy(ia,Y);ja&&(Y=ba.aboveGround?1:-1,Z=Y*r.sign(Z[3]),ia[2]-=(Z||Y)*ja);return ia};ea.getGLMaterial=function(Y){if(0===Y.output||7===Y.output)return new I(Y);if(4===Y.output)return new J(Y)};ea.calculateRelativeScreenBounds=function(Y,Z,ba=e.create()){E(this.params,Y,Z,ba);ba[2]=ba[0]+Y[0];ba[3]=ba[1]+Y[1];return ba};return fa}(z.Material);x=function(da){function fa(Y){Y=da.call(this,{...Y,...Y.material.params})||this;Y.updateParameters();
return Y}k._inheritsLoose(fa,da);var ea=fa.prototype;ea.beginSlot=function(Y){return Y===(this.material.params.drawInSecondSlot?19:18)};ea.updateParameters=function(Y){this.updateTexture(this.material.params.textureId);this.selectProgram(Y)};ea.selectProgram=function(Y){this.technique=this.techniqueRep.acquireAndReleaseExisting(D.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output,Y),this.technique)};ea.ensureParameters=function(Y){this.updateParameters(Y)};ea.bind=function(Y,Z){Y.bindProgram(this.technique.program);
this.bindTexture(Y,this.technique.program);this.bindTextureScale(Y,this.technique.program);this.technique.bindPass(Y,this.material.params,Z)};return fa}(x);let I=function(da){function fa(Y){Y=da.call(this,Y)||this;Y.isOcclusionSlot=!1;return Y}k._inheritsLoose(fa,da);var ea=fa.prototype;ea.beginSlot=function(Y){const Z=this.material.params.drawInSecondSlot?19:18;if(this.material.params.occlusionTest)return this.isOcclusionSlot=12===Y,12===Y||Y===Z;this.isOcclusionSlot=!1;return Y===Z};ea.getTechnique=
function(){return this.isOcclusionSlot?this.occlusionTechnique:this.technique};ea.selectProgram=function(Y){this.technique=this.techniqueRep.acquireAndReleaseExisting(D.HUDMaterialTechnique,this.material.getTechniqueConfig(this.output,Y),this.technique);this.occlusionTechnique=this.techniqueRep.acquireAndReleaseExisting(D.HUDMaterialTechnique,this.material.getTechniqueConfig(6,Y),this.occlusionTechnique)};ea.bind=function(Y,Z){const ba=this.getTechnique();Y.bindProgram(ba.program);this.isOcclusionSlot||
(this.bindTexture(Y,ba.program),this.bindTextureScale(Y,ba.program));ba.bindPass(Y,this.material.params,Z)};return fa}(x),J=function(da){function fa(ea){return da.call(this,{...ea,output:4})||this}k._inheritsLoose(fa,da);return fa}(x);const K={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},L=p.create(),S=h.create(),M=h.create(),T=l.createRenderScreenPointArray3(),O=h.create(),Q=h.create(),F=f.create(),N=f.create(),P=g.create(),
U=h.create(),V={normal:O,cosAngle:0},W=g.create(),X=[0,0],ca=h.fromValues(0,0,1),R={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,
0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:p.fromValues(.5,.5),shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",depthEnabled:!0,pixelSnappingEnabled:!0,debugDrawBorder:!1,isDraped:!1,...z.materialParametersDefaults},aa=q.newLayout().vec3f(u.VertexAttrConstants.POSITION).vec3f(u.VertexAttrConstants.NORMAL).vec2f(u.VertexAttrConstants.UV0).vec4u8(u.VertexAttrConstants.COLOR).vec2f(u.VertexAttrConstants.SIZE).vec4f(u.VertexAttrConstants.AUXPOS1).vec4f(u.VertexAttrConstants.AUXPOS2);
let ka=function(){function da(ea){this.material=ea;this.vertexBufferLayout=aa}var fa=da.prototype;fa.allocate=function(ea){return this.vertexBufferLayout.createBuffer(ea)};fa.elementCount=function(ea){return 6*ea.indices[u.VertexAttrConstants.POSITION].length};fa.write=function(ea,Y,Z,ba){A.writePosition(Y.indices[u.VertexAttrConstants.POSITION],Y.vertexAttr[u.VertexAttrConstants.POSITION].data,ea.transformation,Z.position,ba,6);A.writeNormal(Y.indices[u.VertexAttrConstants.NORMAL],Y.vertexAttr[u.VertexAttrConstants.NORMAL].data,
ea.invTranspTransformation,Z.normal,ba,6);var ia=Y.vertexAttr[u.VertexAttrConstants.UV0].data;if(null==ia||4>ia.length){ia=this.material.params;var ja=ea=0;var la=ia.texCoordScale[0];ia=ia.texCoordScale[1]}else ea=ia[0],ja=ia[1],la=ia[2],ia=ia[3];la=Math.min(1.99999,la+1);ia=Math.min(1.99999,ia+1);var qa=Y.indices[u.VertexAttrConstants.POSITION].length,na=Z.uv0,oa=ba;for(var ua=0;ua<qa;++ua)na.set(oa,0,ea),na.set(oa,1,ja),oa+=1,na.set(oa,0,la),na.set(oa,1,ja),oa+=1,na.set(oa,0,la),na.set(oa,1,ia),
oa+=1,na.set(oa,0,la),na.set(oa,1,ia),oa+=1,na.set(oa,0,ea),na.set(oa,1,ia),oa+=1,na.set(oa,0,ea),na.set(oa,1,ja),oa+=1;A.writeColor(Y.indices[u.VertexAttrConstants.COLOR],Y.vertexAttr[u.VertexAttrConstants.COLOR].data,4,Z.color,ba,6);ea=Y.indices[u.VertexAttrConstants.SIZE];ja=Y.vertexAttr[u.VertexAttrConstants.SIZE].data;la=ea.length;ia=Z.size;qa=ba;for(na=0;na<la;++na){oa=ja[2*ea[na]];ua=ja[2*ea[na]+1];for(let za=0;6>za;++za)ia.set(qa,0,oa),ia.set(qa,1,ua),qa+=1}Y.indices[u.VertexAttrConstants.AUXPOS1]&&
Y.vertexAttr[u.VertexAttrConstants.AUXPOS1]&&A.writeBufferVec4(Y.indices[u.VertexAttrConstants.AUXPOS1],Y.vertexAttr[u.VertexAttrConstants.AUXPOS1].data,Z.auxpos1,ba,6);Y.indices[u.VertexAttrConstants.AUXPOS2]&&Y.vertexAttr[u.VertexAttrConstants.AUXPOS2]&&A.writeBufferVec4(Y.indices[u.VertexAttrConstants.AUXPOS2],Y.vertexAttr[u.VertexAttrConstants.AUXPOS2].data,Z.auxpos2,ba,6)};return da}();b.HUDMaterial=H;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],
function(b){function k(r){return r instanceof Float32Array&&16<=r.length}function a(r){return Array.isArray(r)&&16<=r.length}b.isMat4=function(r){return k(r)||a(r)};b.isMat4f32=k;b.isMat4f64=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./DefaultTextureUnits","./GLMaterial"],function(b,k,a,r){return function(l){function h(c){var e=l.call(this,c)||this;
e._textureIDs=new Set;e._textureRepository=c.textureRep;e._textureId=c.textureId;e._initTransparent=!!c.initTextureTransparent;e._texture=e._acquireIfNotUndefined(e._textureId);e._textureNormal=e._acquireIfNotUndefined(c.normalTextureId);e._textureEmissive=e._acquireIfNotUndefined(c.emissiveTextureId);e._textureOcclusion=e._acquireIfNotUndefined(c.occlusionTextureId);e._textureMetallicRoughness=e._acquireIfNotUndefined(c.metallicRoughnessTextureId);return e}b._inheritsLoose(h,l);var d=h.prototype;
d.dispose=function(){this._textureIDs.forEach(c=>this._textureRepository.release(c));this._textureIDs.clear()};d.updateTexture=function(c){c!==this._textureId&&(this._releaseIfNotUndefined(this._textureId),this._textureId=c,this._texture=this._acquireIfNotUndefined(this._textureId))};d.bindTexture=function(c,e){k.isSome(this._texture)&&(e.setUniform1i("tex",a.DefaultTextureUnits.DIFFUSE),c.bindTexture(this._texture.glTexture,a.DefaultTextureUnits.DIFFUSE));k.isSome(this._textureNormal)&&(e.setUniform1i("normalTexture",
a.DefaultTextureUnits.NORMAL),c.bindTexture(this._textureNormal.glTexture,a.DefaultTextureUnits.NORMAL));k.isSome(this._textureEmissive)&&(e.setUniform1i("texEmission",a.DefaultTextureUnits.EMISSION),c.bindTexture(this._textureEmissive.glTexture,a.DefaultTextureUnits.EMISSION));k.isSome(this._textureOcclusion)&&(e.setUniform1i("texOcclusion",a.DefaultTextureUnits.OCCLUSION),c.bindTexture(this._textureOcclusion.glTexture,a.DefaultTextureUnits.OCCLUSION));k.isSome(this._textureMetallicRoughness)&&(e.setUniform1i("texMetallicRoughness",
a.DefaultTextureUnits.METALLIC_ROUGHNESS),c.bindTexture(this._textureMetallicRoughness.glTexture,a.DefaultTextureUnits.METALLIC_ROUGHNESS))};d.bindTextureScale=function(c,e){(c=k.isSome(this._texture)&&this._texture.glTexture)&&c.descriptor.textureCoordinateScaleFactor?e.setUniform2fv("textureCoordinateScaleFactor",c.descriptor.textureCoordinateScaleFactor):e.setUniform2f("textureCoordinateScaleFactor",1,1)};d._acquireIfNotUndefined=function(c){if(!k.isNone(c))return this._textureIDs.add(c),this._textureRepository.acquire(c,
this._initTransparent)};d._releaseIfNotUndefined=function(c){void 0!==c&&(this._textureIDs.delete(c),this._textureRepository.release(c))};return h}(r)})},"esri/views/3d/webgl-engine/lib/DefaultTextureUnits":function(){define(["exports"],function(b){b.DefaultTextureUnits={DIFFUSE:0,NORMAL:1,EMISSION:2,OCCLUSION:3,METALLIC_ROUGHNESS:4,SSAO:6,SHADOW_MAP:7};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"./AutoDisposable"],function(b,k){return function(a){function r(h){var d=a.call(this)||this;d.material=h.material;d.techniqueRep=h.techniqueRep;d.output=h.output;return d}b._inheritsLoose(r,a);var l=r.prototype;l.getTechnique=function(){return this.technique};l.getPipelineState=function(h,d){return this.getTechnique().pipeline};l.ensureResources=function(h){return 2};l.ensureParameters=function(h){};return r}(k.AutoDisposable)})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers"],function(b,k){const a=l=>function(h){function d(){var c=h.apply(this,arguments)||this;c._isDisposed=!1;return c}k._inheritsLoose(d,h);d.prototype.dispose=function(){for(const e of null!=(c=this._managedDisposables)?c:[]){var c;c=this[e];this[e]=null;c&&"function"===typeof c.dispose&&c.dispose()}this._isDisposed=!0};k._createClass(d,[{key:"isDisposed",get:function(){return this._isDisposed}}]);return d}(l);let r=function(l){function h(){return l.apply(this,
arguments)||this}k._inheritsLoose(h,l);return h}(a(function(){return function(){}}()));b.AutoDisposable=r;b.AutoDisposableMixin=a;b.autoDispose=function(){return(l,h)=>{if(!l.hasOwnProperty("_managedDisposables")){var d,c;l._managedDisposables=null!=(d=null==(c=l._managedDisposables)?void 0:c.slice())?d:[]}l._managedDisposables.unshift(h)}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/maybe ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../geometry/support/aaBoundingBox ../../lib/Util ../renderers/utils ../../lib/screenSizePerspectiveUtils".split(" "),
function(b,k,a,r,l,h,d,c,e){function f(t,D,E,G,H,I){var J=n(D,E,B);h.setMin(v,t.getBBMin());h.setMax(v,t.getBBMax());k.isSome(H)&&H.applyToAabb(v);if(w(v,D,J,G)){J=t.getPrimitiveIndices();const K=t.getIndices(),L=t.getPosition(),S=J?J.length:K.length/3;if(1E3<S&&(t=t.getChildren(),void 0!==t)){for(J=0;8>J;++J)void 0!==t[J]&&f(t[J],D,E,G,H,I);return}g(D,E,0,S,K,L,J,H,I)}}function g(t,D,E,G,H,I,J,K,L){if(J){{const {data:Y,offsetIdx:Z,strideIdx:ba}=I;I=t[0];var S=t[1];t=t[2];var M=D[0]-I,T=D[1]-S;for(D=
D[2]-t;E<G;++E){var O=J[E],Q=3*O,F=Z+ba*H[Q++],N=Y[F++],P=Y[F++],U=Y[F];F=Z+ba*H[Q++];var V=Y[F++],W=Y[F++],X=Y[F];F=Z+ba*H[Q];Q=Y[F++];var ca=Y[F++];F=Y[F];k.isSome(K)&&([N,P,U]=K.applyToVertex(N,P,U,E),[V,W,X]=K.applyToVertex(V,W,X,E),[Q,ca,F]=K.applyToVertex(Q,ca,F,E));V-=N;W-=P;X-=U;Q-=N;ca-=P;F-=U;var R=T*F-ca*D,aa=D*Q-F*M;const ia=M*ca-Q*T;var ka=V*R+W*aa+X*ia;if(!(Math.abs(ka)<=x)){N=I-N;P=S-P;U=t-U;R=N*R+P*aa+U*ia;if(0<ka){if(0>R||R>ka)continue}else if(0<R||R<ka)continue;aa=P*X-W*U;U=U*V-
X*N;P=N*W-V*P;N=M*aa+T*U+D*P;if(0<ka){if(0>N||R+N>ka)continue}else if(0<N||R+N<ka)continue;U=(Q*aa+ca*U+F*P)/ka;0<=U&&(V=p(V,W,X,Q,ca,F,C),L(U,V,O))}}}}else{var {data:da,offsetIdx:fa,strideIdx:ea}=I;J=t[0];I=t[1];S=t[2];t=D[0]-J;M=D[1]-I;T=D[2]-S;for(let Y=E,Z=3*E;Y<G;++Y)if(Q=fa+ea*H[Z++],P=da[Q++],U=da[Q++],X=da[Q],Q=fa+ea*H[Z++],D=da[Q++],E=da[Q++],O=da[Q],Q=fa+ea*H[Z++],V=da[Q++],W=da[Q++],Q=da[Q],k.isSome(K)&&([P,U,X]=K.applyToVertex(P,U,X,Y),[D,E,O]=K.applyToVertex(D,E,O,Y),[V,W,Q]=K.applyToVertex(V,
W,Q,Y)),D-=P,E-=U,O-=X,V-=P,W-=U,Q-=X,F=M*Q-W*T,N=T*V-Q*t,ka=t*W-V*M,ca=D*F+E*N+O*ka,!(Math.abs(ca)<=x)){P=J-P;U=I-U;X=S-X;F=P*F+U*N+X*ka;if(0<ca){if(0>F||F>ca)continue}else if(0<F||F<ca)continue;N=U*O-E*X;X=X*D-O*P;U=P*E-D*U;P=t*N+M*X+T*U;if(0<ca){if(0>P||F+P>ca)continue}else if(0<P||F+P<ca)continue;X=(V*N+W*X+Q*U)/ca;0<=X&&(D=p(D,E,O,V,W,Q,C),L(X,D,Y))}}}function p(t,D,E,G,H,I,J){l.set(z,t,D,E);l.set(A,G,H,I);l.cross(J,z,A);l.normalize(J,J);return J}function n(t,D,E){return l.set(E,1/(D[0]-t[0]),
1/(D[1]-t[1]),1/(D[2]-t[2]))}function w(t,D,E,G){return q(t,D,E,G,Infinity)}function q(t,D,E,G,H){var I=(t[0]-G-D[0])*E[0],J=(t[3]+G-D[0])*E[0];let K=Math.min(I,J);I=Math.max(I,J);J=(t[1]-G-D[1])*E[1];const L=(t[4]+G-D[1])*E[1];I=Math.min(I,Math.max(J,L));if(0>I)return!1;K=Math.max(K,Math.min(J,L));if(K>I)return!1;J=(t[2]-G-D[2])*E[2];t=(t[5]+G-D[2])*E[2];I=Math.min(I,Math.max(J,t));if(0>I)return!1;K=Math.max(K,Math.min(J,t));return K>I?!1:K<H}function m(t,D){D=D?m(D):{};for(const E in t){let G=t[E];
G&&G.forEach&&(G=u(G));null==G&&E in D||(D[E]=G)}return D}function u(t){const D=[];t.forEach(E=>D.push(E));return D}const v=h.create(),y=d.VertexAttrConstants,B=r.create(),x=2**-52,C=r.create(),z=r.create(),A=r.create();b.bindScreenSizePerspective=function(t,D,E){if(t){var G=t.parameters;D.setUniform4f(E,G.divisor,G.offset,G.minPixelSize,t.paddingPixelsOverride)}};b.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};b.computeInvDir=n;b.computeNormal=p;b.copyParameters=m;b.intersectAabbInvDir=w;
b.intersectAabbInvDirBefore=q;b.intersectDrapedRenderLineGeometry=function(t,D,E,G,H){if(D.options.selectionMode){D=t.getAttribute(y.POSITION).data;var I=t.getAttribute(y.SIZE),J=E[0];E=E[1];t=(((I&&I.data[0])+G)/2+4)*t.screenToWorldRatio;G=Number.MAX_VALUE;for(I=0;I<D.length-5;I+=3){var K=D[I],L=D[I+1],S=J-K,M=E-L;K=D[I+3]-K;L=D[I+4]-L;const T=a.clamp((K*S+L*M)/(K*K+L*L),0,1);S=K*T-S;M=L*T-M;M=S*S+M*M;M<G&&(G=M)}G<t*t&&H()}};b.intersectTriangleGeometry=function(t,D,E,G,H,I,J){D=c.isInstanceHidden(D);
E=E.tolerance;D||(t.boundingInfo?(d.assert("triangle"===t.data.primitiveType),f(t.boundingInfo,G,H,E,I,J)):(E=t.getIndices(y.POSITION),t=t.getAttribute(y.POSITION),g(G,H,0,E.length/3,E,t,void 0,I,J)))};b.intersectTriangles=g;b.updateParameters=function(t,D){let E=!1;for(const G in D){const H=D[G];void 0!==H&&(E=!0,Array.isArray(H)?t[G]=H.slice():t[G]=H)}return E};b.verticalOffsetAtDistance=function(t,D,E,G,H){let I=(E.screenLength||0)*t.pixelRatio;H&&(I=e.scale(I,G,D,H));return a.glClamp(I*Math.tan(.5*
t.fovY)/(.5*t.fullHeight)*D,E.minWorldLength||0,null!=E.maxWorldLength?E.maxWorldLength:Infinity)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./DefaultVertexAttributeLocations ./IdGen ../materials/internal/MaterialUtil".split(" "),function(b,k,a,r,l,h){let d=function(){function c(f,g,p){this.supportsEdges=!1;this._visible=!0;this._insertOrder=this._renderPriority=
0;this._vertexAttributeLocations=r.Default3D;this.id=c._idGen.gen(f);this._params=h.copyParameters(g,p);this.validateParameterValues(this._params)}var e=c.prototype;e.dispose=function(){};e.update=function(){return!1};e.setParameterValues=function(f){h.updateParameters(this._params,f)&&(this.validateParameterValues(this._params),this.parametersChanged())};e.validateParameterValues=function(){};e.isVisibleInPass=function(f){return!0};e.isVisible=function(){return this._visible};e.parametersChanged=
function(){a.isSome(this.materialRepository)&&this.materialRepository.materialChanged(this)};k._createClass(c,[{key:"params",get:function(){return this._params}},{key:"visible",get:function(){return this._visible},set:function(f){f!==this._visible&&(this._visible=f,this.parametersChanged())}},{key:"renderOccluded",get:function(){return this.params.renderOccluded}},{key:"renderPriority",get:function(){return this._renderPriority},set:function(f){f!==this._renderPriority&&(this._renderPriority=f,this.parametersChanged())}},
{key:"insertOrder",get:function(){return this._insertOrder},set:function(f){f!==this._insertOrder&&(this._insertOrder=f,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);return c}();d._idGen=new l.IdGen;b.Material=d;b.materialParametersDefaults={renderOccluded:1};b.materialPredicate=function(c,e){return c.isVisible()&&c.isVisibleInPass(e.pass)&&0!==(c.renderOccluded&e.renderOccludedMask)};Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../support/buffer/BufferView","../../lib/Util"],function(b,k,a){function r(f,g,p,n,w){const q=p.typedBuffer;p=p.typedBufferStride;const m=f.length;n*=p;if(null==w||1===w)for(w=0;w<m;++w){var u=2*f[w];q[n]=g[u];q[n+1]=g[u+1];n+=p}else for(u=0;u<m;++u){const v=2*f[u];for(let y=0;y<w;++y)q[n]=g[v],q[n+1]=g[v+1],n+=p}}function l(f,g,p,n,w){const q=p.typedBuffer;p=p.typedBufferStride;const m=f.length;
n*=p;if(null==w||1===w)for(w=0;w<m;++w){var u=3*f[w];q[n]=g[u];q[n+1]=g[u+1];q[n+2]=g[u+2];n+=p}else for(u=0;u<m;++u){const v=3*f[u];for(let y=0;y<w;++y)q[n]=g[v],q[n+1]=g[v+1],q[n+2]=g[v+2],n+=p}}function h(f,g,p,n,w){const q=p.typedBuffer;p=p.typedBufferStride;const m=f.length;n*=p;if(null==w||1===w)for(w=0;w<m;++w){var u=4*f[w];q[n]=g[u];q[n+1]=g[u+1];q[n+2]=g[u+2];q[n+3]=g[u+3];n+=p}else for(u=0;u<m;++u){const v=4*f[u];for(let y=0;y<w;++y)q[n]=g[v],q[n+1]=g[v+1],q[n+2]=g[v+2],q[n+3]=g[v+3],n+=
p}}function d(f,g,p,n,w,q){if(p){const x=n.typedBuffer;n=n.typedBufferStride;const C=f.length;w*=n;if(null==q||1===q)for(q=0;q<C;++q){var m=3*f[q],u=g[m],v=g[m+1];m=g[m+2];x[w]=p[0]*u+p[4]*v+p[8]*m+p[12];x[w+1]=p[1]*u+p[5]*v+p[9]*m+p[13];x[w+2]=p[2]*u+p[6]*v+p[10]*m+p[14];w+=n}else for(u=0;u<C;++u){v=3*f[u];var y=g[v],B=g[v+1];const z=g[v+2];v=p[0]*y+p[4]*B+p[8]*z+p[12];m=p[1]*y+p[5]*B+p[9]*z+p[13];y=p[2]*y+p[6]*B+p[10]*z+p[14];for(B=0;B<q;++B)x[w]=v,x[w+1]=m,x[w+2]=y,w+=n}}else l(f,g,n,w,q)}function c(f,
g,p,n,w,q){if(p){const x=n.typedBuffer;n=n.typedBufferStride;const C=f.length,z=p[0],A=p[1],t=p[2],D=p[4],E=p[5],G=p[6],H=p[8],I=p[9];p=p[10];const J=1E-5<Math.abs(1-z*z+D*D+H*H)||1E-5<Math.abs(1-A*A+E*E+I*I)||1E-5<Math.abs(1-t*t+G*G+p*p);w*=n;if(null==q||1===q)for(q=0;q<C;++q){var m=3*f[q],u=g[m],v=g[m+1],y=g[m+2];m=z*u+D*v+H*y;var B=A*u+E*v+I*y;u=t*u+G*v+p*y;J&&(v=m*m+B*B+u*u,.999999>v&&1E-6<v&&(v=Math.sqrt(v),m/=v,B/=v,u/=v));x[w+0]=m;x[w+1]=B;x[w+2]=u;w+=n}else for(m=0;m<C;++m){B=3*f[m];v=g[B];
y=g[B+1];const K=g[B+2];B=z*v+D*y+H*K;u=A*v+E*y+I*K;v=t*v+G*y+p*K;J&&(y=B*B+u*u+v*v,.999999>y&&1E-6<y&&(y=Math.sqrt(y),B/=y,u/=y,v/=y));for(y=0;y<q;++y)x[w+0]=B,x[w+1]=u,x[w+2]=v,w+=n}}else l(f,g,n,w,q)}function e(f,g,p,n,w,q){const m=n.typedBuffer;n=n.typedBufferStride;const u=f.length;w*=n;if(null==q||1===q)if(4===p)for(q=0;q<u;++q)p=4*f[q],m[w]=g[p],m[w+1]=g[p+1],m[w+2]=g[p+2],m[w+3]=g[p+3],w+=n;else{if(3===p)for(q=0;q<u;++q)p=3*f[q],m[w]=g[p],m[w+1]=g[p+1],m[w+2]=g[p+2],m[w+3]=255,w+=n}else if(4===
p)for(p=0;p<u;++p){var v=4*f[p];for(var y=0;y<q;++y)m[w]=g[v],m[w+1]=g[v+1],m[w+2]=g[v+2],m[w+3]=g[v+3],w+=n}else if(3===p)for(p=0;p<u;++p)for(v=3*f[p],y=0;y<q;++y)m[w]=g[v],m[w+1]=g[v+1],m[w+2]=g[v+2],m[w+3]=255,w+=n}b.writeBufferMat3f=function(f,g,p,n){const w=p.typedBuffer;p=p.typedBufferStride;const q=f.length;n*=p;for(let m=0;m<q;++m){const u=9*f[m];for(let v=0;9>v;++v)w[n+v]=g[u+v];n+=p}};b.writeBufferMat4f=function(f,g,p,n){const w=p.typedBuffer;p=p.typedBufferStride;const q=f.length;n*=p;
for(let m=0;m<q;++m){const u=16*f[m];for(let v=0;16>v;++v)w[n+v]=g[u+v];n+=p}};b.writeBufferVec2=r;b.writeBufferVec3=l;b.writeBufferVec4=h;b.writeColor=e;b.writeDefaultAttributes=function(f,g,p,n,w,q){for(const u of g.fieldNames){g=f.vertexAttr[u];const v=f.indices[u];if(g&&v)switch(u){case a.VertexAttrConstants.POSITION:a.assert(3===g.size);var m=w.getField(u,k.BufferViewVec3f);m&&d(v,g.data,p,m,q);break;case a.VertexAttrConstants.NORMAL:a.assert(3===g.size);(m=w.getField(u,k.BufferViewVec3f))&&
c(v,g.data,n,m,q);break;case a.VertexAttrConstants.UV0:a.assert(2===g.size);(m=w.getField(u,k.BufferViewVec2f))&&r(v,g.data,m,q);break;case a.VertexAttrConstants.UVMAPSPACE:a.assert(4===g.size);(m=w.getField(u,k.BufferViewVec4f))&&h(v,g.data,m,q);break;case a.VertexAttrConstants.MEANVERTEXPOSITION:a.assert(3===g.size);(m=w.getField(u,k.BufferViewVec3f))&&d(v,g.data,p,m,q);break;case a.VertexAttrConstants.BOUND1:case a.VertexAttrConstants.BOUND2:case a.VertexAttrConstants.BOUND3:a.assert(3===g.size);
(m=w.getField(u,k.BufferViewVec3f))&&d(v,g.data,p,m,q);break;case a.VertexAttrConstants.COLOR:a.assert(3===g.size||4===g.size);(m=w.getField(u,k.BufferViewVec4u8))&&e(v,g.data,g.size,m,q);break;case a.VertexAttrConstants.SYMBOLCOLOR:a.assert(3===g.size||4===g.size);(m=w.getField(u,k.BufferViewVec4u8))&&e(v,g.data,g.size,m,q);break;case a.VertexAttrConstants.TANGENT:a.assert(4===g.size),(m=w.getField(u,k.BufferViewVec4f))&&h(v,g.data,m,q)}}};b.writeMultipliedColor=function(f,g,p,n,w,q,m){const u=w.typedBuffer;
w=w.typedBufferStride;const v=f.length;q*=w;if(null==m||1===m)if(4===p)for(m=0;m<v;++m)p=4*f[m],u[q]=g[p]*n[0],u[q+1]=g[p+1]*n[1],u[q+2]=g[p+2]*n[2],u[q+3]=g[p+3]*n[3],q+=w;else{if(3===p)for(m=255*n[3],p=0;p<v;++p){var y=3*f[p];u[q]=g[y]*n[0];u[q+1]=g[y+1]*n[1];u[q+2]=g[y+2]*n[2];u[q+3]=m;q+=w}}else if(4===p)for(p=0;p<v;++p){y=4*f[p];for(var B=0;B<m;++B)u[q]=g[y]*n[0],u[q+1]=g[y+1]*n[1],u[q+2]=g[y+2]*n[2],u[q+3]=g[y+3]*n[3],q+=w}else if(3===p)for(p=255*n[3],y=0;y<v;++y){B=3*f[y];for(let x=0;x<m;++x)u[q]=
g[B]*n[0],u[q+1]=g[B+1]*n[1],u[q+2]=g[B+2]*n[2],u[q+3]=p,q+=w}};b.writeNormal=c;b.writePosition=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ./vec2f64 ./vec4f64 ./vec2 ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){function u(B){const x=new h.ShaderBuilder;var C=B.signedDistanceFieldEnabled;x.include(c.AlignPixel);x.include(g.HUD,B);x.include(e.Slice,B);if(6===B.output)return x.include(p.HUDOcclusionPass,B),x;x.include(f.ScreenSizePerspective);x.fragment.include(m.RgbaFloatEncoding);x.fragment.include(d.ColorConversion);x.include(w.VisualVariables,B);x.varyings.add("vcolor","vec4");x.varyings.add("vtc","vec2");x.varyings.add("vsize","vec2");B.binaryHighlightOcclusionEnabled&&
x.varyings.add("voccluded","float");x.vertex.uniforms.add("screenOffset","vec2").add("anchorPos","vec2").add("textureCoordinateScaleFactor","vec2").add("materialColor","vec4");C&&x.vertex.uniforms.add("outlineColor","vec4");B.screenSizePerspectiveEnabled&&x.vertex.uniforms.add("screenSizePerspective","vec4");(B.debugDrawBorder||B.binaryHighlightOcclusionEnabled)&&x.varyings.add("debugBorderCoords","vec4");x.attributes.add("uv0","vec2");x.attributes.add("color","vec4");x.attributes.add("size","vec2");
x.attributes.add("auxpos2","vec4");x.vertex.code.add(l.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${B.screenSizePerspectiveEnabled?l.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:l.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${B.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${B.occlusionTestEnabled||B.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${B.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var z=l.glsl`
      vec2 uv01 = floor(uv0);
      vec2 uv = uv0 - uv01;
      quadOffset.xy = ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;
  `;const A=B.pixelSnappingEnabled?C?l.glsl`
  posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:l.glsl`
  posProj += quadOffset;
  if (inputSize.x == size.x) {
    posProj = alignToPixelOrigin(posProj, viewport.zw);
  }`:l.glsl`posProj += quadOffset;`;x.vertex.code.add(l.glsl`
      ${B.occlusionTestEnabled?"if (visible) {":""}
      ${z}
      ${B.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

      bool alphaDiscard = vcolor.a < ${l.glsl.float(q.symbolAlphaCutoff)};
      ${C?`alphaDiscard = alphaDiscard && outlineColor.a < ${l.glsl.float(q.symbolAlphaCutoff)};`:""}
      if (alphaDiscard) {
        // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      } else {
        ${A}
        gl_Position = posProj;
      }

      vtc = uv * textureCoordinateScaleFactor;

      ${B.debugDrawBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
      vsize = inputSize;
      ${B.occlusionTestEnabled?l.glsl`} else { vtc = vec2(0.0);
        ${B.debugDrawBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
    }
    `);x.fragment.uniforms.add("tex","sampler2D");C&&(x.fragment.uniforms.add("outlineColor","vec4"),x.fragment.uniforms.add("outlineSize","float"));z=B.debugDrawBorder?l.glsl`(isBorder > 0.0 ? 0.0 : ${l.glsl.float(q.defaultMaskAlphaCutoff)})`:l.glsl.float(q.defaultMaskAlphaCutoff);C=l.glsl`
    ${B.debugDrawBorder?l.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${C?l.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = 128.0;
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${z} ||
          fillPixelColor.a + outlinePixelColor.a < ${l.glsl.float(q.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${z}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:l.glsl`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${z}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    ${B.debugDrawBorder?l.glsl`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder);`:""}
  `;7===B.output&&x.fragment.code.add(l.glsl`
      void main() {
        ${C}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `);0===B.output&&x.fragment.code.add(l.glsl`
    void main() {
      ${C}
      ${B.FrontFacePass?"gl_FragColor.rgb /\x3d gl_FragColor.a;":""}
    }
    `);4===B.output&&(x.include(n.OutputHighlight),x.fragment.code.add(l.glsl`
    void main() {
      ${C}
      ${B.binaryHighlightOcclusionEnabled?l.glsl`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return x}function v(B,x=y){if(B.textureIsSignedDistanceField){var C=B.anchorPos;B=B.distanceFieldBoundingBox;x[0]=C[0]*(B[2]-B[0])+B[0];x[1]=C[1]*(B[3]-B[1])+B[1]}else r.copy(x,B.anchorPos);return x}(function(B){B.bindUniforms=function(x,C,z){x.setUniform4fv("materialColor",C.color);C.textureIsSignedDistanceField&&(0>=C.outlineColor[3]||0>=C.outlineSize?(x.setUniform4fv("outlineColor",a.ZEROS),x.setUniform1f("outlineSize",0)):(x.setUniform4fv("outlineColor",C.outlineColor),x.setUniform1f("outlineSize",
C.outlineSize)));x.setUniform2f("screenOffset",2*C.screenOffset[0]*z,2*C.screenOffset[1]*z);x.setUniform2fv("anchorPos",v(C))}})(b.HUDMaterial||(b.HUDMaterial={}));const y=k.create();k=Object.freeze({__proto__:null,build:u,get HUDMaterial(){return b.HUDMaterial},calculateAnchorPosForRendering:v});b.HUDMaterialShader=k;b.build=u;b.calculateAnchorPosForRendering=v})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define(["exports","../../../../../core/maybe","../../../../../chunks/vec3f64",
"../../../../../chunks/vec3","../shaderModules/interfaces"],function(b,k,a,r,l){function h(c,e){if(e.slicePlaneEnabled){c.extensions.add("GL_OES_standard_derivatives");e.sliceEnabledForVertexPrograms&&(c.vertex.uniforms.add("slicePlaneOrigin","vec3"),c.vertex.uniforms.add("slicePlaneBasis1","vec3"),c.vertex.uniforms.add("slicePlaneBasis2","vec3"));c.fragment.uniforms.add("slicePlaneOrigin","vec3");c.fragment.uniforms.add("slicePlaneBasis1","vec3");c.fragment.uniforms.add("slicePlaneBasis2","vec3");
var f=l.glsl`
      struct SliceFactors {
        float front;
        float side0;
        float side1;
        float side2;
        float side3;
      };

      SliceFactors calculateSliceFactors(vec3 pos) {
        vec3 rel = pos - slicePlaneOrigin;

        vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
        float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);

        float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
        float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);

        float basis1Dot = dot(slicePlaneBasis1, rel);
        float basis2Dot = dot(slicePlaneBasis2, rel);

        return SliceFactors(
          dot(slicePlaneNormal, pos) + slicePlaneW,
          -basis1Dot - basis1Len2,
          basis1Dot - basis1Len2,
          -basis2Dot - basis2Len2,
          basis2Dot - basis2Len2
        );
      }

      bool sliceByFactors(SliceFactors factors) {
        return factors.front < 0.0
          && factors.side0 < 0.0
          && factors.side1 < 0.0
          && factors.side2 < 0.0
          && factors.side3 < 0.0;
      }

      bool sliceEnabled() {
        // a slicePlaneBasis1 vector of zero length is used to disable slicing in the shader during draped rendering.
        return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
      }

      bool sliceByPlane(vec3 pos) {
        return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
      }

      #define rejectBySlice(_pos_) sliceByPlane(_pos_)
      #define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }
    `,g=l.glsl`
      vec4 applySliceHighlight(vec4 color, vec3 pos) {
        SliceFactors factors = calculateSliceFactors(pos);

        if (sliceByFactors(factors)) {
          return color;
        }

        const float HIGHLIGHT_WIDTH = 1.0;
        const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);

        factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
        factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
        factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
        factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
        factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);

        float highlightFactor = (1.0 - step(0.5, factors.front))
          * (1.0 - step(0.5, factors.side0))
          * (1.0 - step(0.5, factors.side1))
          * (1.0 - step(0.5, factors.side2))
          * (1.0 - step(0.5, factors.side3));

        return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
      }
    `;g=e.sliceHighlightDisabled?l.glsl`#define highlightSlice(_color_, _pos_) (_color_)`:l.glsl`
        ${g}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `;e.sliceEnabledForVertexPrograms&&c.vertex.code.add(f);c.fragment.code.add(f);c.fragment.code.add(g)}else f=l.glsl`
      #define rejectBySlice(_pos_) false
      #define discardBySlice(_pos_) {}
      #define highlightSlice(_color_, _pos_) (_color_)
    `,e.sliceEnabledForVertexPrograms&&c.vertex.code.add(f),c.fragment.code.add(f)}(function(c){c.bindUniformsWithOrigin=function(e,f,g){c.bindUniforms(e,f,g.slicePlane,g.origin)};c.bindUniforms=function(e,f,g,p){f.slicePlaneEnabled&&(k.isSome(g)?(p?(r.subtract(d,g.origin,p),e.setUniform3fv("slicePlaneOrigin",d)):e.setUniform3fv("slicePlaneOrigin",g.origin),e.setUniform3fv("slicePlaneBasis1",g.basis1),e.setUniform3fv("slicePlaneBasis2",g.basis2)):(e.setUniform3fv("slicePlaneBasis1",a.ZEROS),e.setUniform3fv("slicePlaneBasis2",
a.ZEROS),e.setUniform3fv("slicePlaneOrigin",a.ZEROS)))}})(h||(h={}));const d=a.create();b.Slice=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../materials/internal/MaterialUtil"],function(b,k,a){function r(l){l.vertex.code.add(k.glsl`
    float screenSizePerspectiveMinSize(float size, vec4 factor) {
      float nonZeroSize = 1.0 - step(size, 0.0);

      return (
        factor.z * (
          1.0 +
          // Multiply by nzs ensures if size is 0, then we ignore proportionally scaled padding
          nonZeroSize *
          2.0 * factor.w / (
            size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1
          )
        )
      );
    }
  `);l.vertex.code.add(k.glsl`
    float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
      return absCosAngle * absCosAngle * absCosAngle;
    }
  `);l.vertex.code.add(k.glsl`
    vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
      return vec4(
        min(params.x / (distanceToCamera - params.y), 1.0),
        screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
        params.z,
        params.w
      );
    }
  `);l.vertex.code.add(k.glsl`
    float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
      return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
    }
  `);l.vertex.code.add(k.glsl`
    float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
      return applyScreenSizePerspectiveScaleFactorFloat(
        size,
        screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
      );
    }
  `);l.vertex.code.add(k.glsl`
    vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
      return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);
    }
  `);l.vertex.code.add(k.glsl`
    vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
      return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
    }
  `)}(function(l){l.bindUniforms=function(h,d){d.screenSizePerspective&&(a.bindScreenSizePerspective(d.screenSizePerspective,h,"screenSizePerspective"),a.bindScreenSizePerspective(d.screenSizePerspectiveAlignment||d.screenSizePerspective,h,"screenSizePerspectiveAlignment"))}})(r||(r={}));b.ScreenSizePerspective=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define(["exports","../../shaderModules/interfaces","../util/ScreenSizePerspective.glsl"],
function(b,k,a){function r(l,h){l.include(a.ScreenSizePerspective);l.attributes.add("position","vec3");l.attributes.add("normal","vec3");l.attributes.add("auxpos1","vec4");l.vertex.uniforms.add("proj","mat4");l.vertex.uniforms.add("view","mat4");l.vertex.uniforms.add("viewNormal","mat4");l.vertex.uniforms.add("viewport","vec4");l.vertex.uniforms.add("camPos","vec3");l.vertex.uniforms.add("polygonOffset","float");l.vertex.uniforms.add("cameraGroundRelative","float");l.vertex.uniforms.add("pixelRatio",
"float");l.vertex.uniforms.add("perDistancePixelRatio","float");l.vertex.uniforms.add("uRenderTransparentlyOccludedHUD","float");h.verticalOffsetEnabled&&l.vertex.uniforms.add("verticalOffset","vec4");h.screenSizePerspectiveEnabled&&l.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4");l.vertex.uniforms.add("hudVisibilityTexture","sampler2D");l.vertex.defines.addFloat("SMALL_OFFSET_ANGLE",.984807753012208);l.vertex.code.add(k.glsl`
    struct ProjectHUDAux {
      vec3 posModel;
      vec3 posView;
      vec3 vnormal;

      float distanceToCamera;
      float absCosAngle;
    };
  `);l.vertex.code.add(k.glsl`
    float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
      float pointGroundSign = sign(pointGroundDistance);

      if (pointGroundSign == 0.0) {
        pointGroundSign = cameraGroundRelative;
      }

      // cameraGroundRelative is -1 if camera is below ground, 1 if above ground
      // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise
      float groundRelative = cameraGroundRelative * pointGroundSign;

      // view angle dependent part of polygon offset emulation
      // we take the absolute value because the sign that is dropped is
      // instead introduced using the ground-relative position of the symbol and the camera
      if (polygonOffset > .0) {
        float cosAlpha = clamp(absCosAngle, 0.01, 1.0);

        float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
        float factor = (1.0 - tanAlpha / viewport[2]);

        // same side of the terrain
        if (groundRelative > 0.0) {
          posView *= factor;
        }
        // opposite sides of the terrain
        else {
          posView /= factor;
        }
      }

      return groundRelative;
    }
  `);h.isDraped||l.vertex.code.add(k.glsl`
    void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
      float distanceToCamera = length(posView);

      // Compute offset in world units for a half pixel shift
      float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;

      // Apply offset along normal in the direction away from the ground surface
      vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;

      // Apply the same offset also on the view space position
      vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;

      posModel += modelOffset;
      posView += viewOffset;
    }
  `);l.vertex.code.add(k.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${h.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(camPos - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${h.screenSizePerspectiveEnabled?h.verticalOffsetEnabled||1===h.screenCenterOffsetUnitsEnabled?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${h.verticalOffsetEnabled?h.screenSizePerspectiveEnabled?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${h.verticalOffsetEnabled?k.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${1!==h.screenCenterOffsetUnitsEnabled?k.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${1===h.screenCenterOffsetUnitsEnabled?h.screenSizePerspectiveEnabled?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${1===h.screenCenterOffsetUnitsEnabled?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);l.vertex.code.add(k.glsl`
    bool testVisibilityHUD(vec4 posProj) {
      // For occlusion testing, use the nearest pixel center to avoid
      // subpixel filtering messing up the color we use to test for
      vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);

      // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written
      // the green pixel stores transparency of transparent geometry (1.0 -> fully transparent)
      // note that we also check against green == 0.0, i.e. transparent geometry that has opaque parts

      // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here
      if (uRenderTransparentlyOccludedHUD > 0.5) {
        // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if
        // uRenderTransparentlyOccludedHUD = 0.75
        return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * uRenderTransparentlyOccludedHUD < 1.0;
      }

      // and visible pixels that are not occluded by semi-transparent geometry here
      return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
    }
  `)}(function(l){l.bindUniforms=function(h,d){h.setUniform1f("uRenderTransparentlyOccludedHUD",0===d.renderTransparentlyOccludedHUD?1:1===d.renderTransparentlyOccludedHUD?0:.75)};l.bindVisibilityTexture=function(h,d,c){d.setUniform1i("hudVisibilityTexture",4);h.bindTexture(c.hudVisibilityTexture,4);h.setActiveTexture(0)}})(r||(r={}));b.HUD=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define(["exports","../../shaderModules/interfaces"],
function(b,k){(function(a){a.bindUniforms=function(r){r.setUniform4f("color",1,1,1,1)}})(b.HUDOcclusion||(b.HUDOcclusion={}));b.HUDOcclusionPass=function(a){a.vertex.code.add(k.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }
    }
    else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);a.fragment.uniforms.add("color","vec4");a.fragment.code.add(k.glsl`
  void main() {
    gl_FragColor = color;
  }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){function a(r){r.fragment.uniforms.add("depthTex","sampler2D");r.fragment.uniforms.add("highlightViewportPixelSz","vec4");r.fragment.code.add(k.glsl`
    void outputHighlight() {
      vec4 fragCoord = gl_FragCoord;

      float sceneDepth = texture2D(depthTex, (fragCoord.xy - highlightViewportPixelSz.xy) * highlightViewportPixelSz.zw).r;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
      }
      else {
        gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
      }
    }
  `)}(function(r){r.bindOutputHighlight=function(l,h,d){l.bindTexture(d.highlightDepthTexture,5);h.setUniform1i("depthTex",5);h.setUniform4f("highlightViewportPixelSz",0,0,d.inverseViewport[0],d.inverseViewport[1])}})(a||(a={}));b.OutputHighlight=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){function a(r,l){l.vvInstancingEnabled&&(l.vvSize||
l.vvColor)&&r.attributes.add("instanceFeatureAttribute","vec4");l.vvSize?(r.vertex.uniforms.add("vvSizeMinSize","vec3"),r.vertex.uniforms.add("vvSizeMaxSize","vec3"),r.vertex.uniforms.add("vvSizeOffset","vec3"),r.vertex.uniforms.add("vvSizeFactor","vec3"),r.vertex.uniforms.add("vvSymbolRotationMatrix","mat3"),r.vertex.uniforms.add("vvSymbolAnchor","vec3"),r.vertex.code.add(k.glsl`
      vec3 vvScale(vec4 _featureAttribute) {
        return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
      }

      vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
        return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
      }
    `),r.vertex.code.add(k.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${l.vvInstancingEnabled?k.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):r.vertex.code.add(k.glsl`
      vec4 localPosition() { return vec4(position, 1.0); }

      vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }
    `);l.vvColor?(r.vertex.defines.addInt("VV_COLOR_N",8),r.vertex.code.add(k.glsl`
      uniform float vvColorValues[VV_COLOR_N];
      uniform vec4 vvColorColors[VV_COLOR_N];

      vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < VV_COLOR_N; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[VV_COLOR_N - 1];
      }

      ${l.vvInstancingEnabled?k.glsl`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):r.vertex.code.add(k.glsl`
      vec4 vvColor() { return vec4(1.0); }
    `)}(function(r){function l(h,d){d.vvSizeEnabled&&(h.setUniform3fv("vvSizeMinSize",d.vvSizeMinSize),h.setUniform3fv("vvSizeMaxSize",d.vvSizeMaxSize),h.setUniform3fv("vvSizeOffset",d.vvSizeOffset),h.setUniform3fv("vvSizeFactor",d.vvSizeFactor));d.vvColorEnabled&&(h.setUniform1fv("vvColorValues",d.vvColorValues),h.setUniform4fv("vvColorColors",d.vvColorColors))}r.bindUniforms=l;r.bindUniformsWithOpacity=function(h,d){l(h,d);d.vvOpacityEnabled&&(h.setUniform1fv("vvOpacityValues",d.vvOpacityValues),
h.setUniform1fv("vvOpacityOpacities",d.vvOpacityOpacities))};r.bindUniformsForSymbols=function(h,d){l(h,d);d.vvSizeEnabled&&(h.setUniform3fv("vvSymbolAnchor",d.vvSymbolAnchor),h.setUniformMatrix3fv("vvSymbolRotationMatrix",d.vvSymbolRotationMatrix))}})(a||(a={}));b.VisualVariables=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.DiscardOrAdjustAlpha=
function(a,r){const l=a.fragment;switch(r.alphaDiscardMode){case 0:l.code.add(k.glsl`
        #define discardOrAdjustAlpha(color) { if (color.a < ${k.glsl.float(.001)}) { discard; } }
      `);break;case 1:l.code.add(k.glsl`
        void discardOrAdjustAlpha(inout vec4 color) {
          color.a = 1.0;
        }
      `);break;case 2:l.uniforms.add("textureAlphaCutoff","float");l.code.add(k.glsl`
        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }
      `);break;case 3:a.fragment.uniforms.add("textureAlphaCutoff","float"),a.fragment.code.add(k.glsl`
        #define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }
      `)}};b.defaultMaskAlphaCutoff=.1;b.symbolAlphaCutoff=.001;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.RgbaFloatEncoding=function(a){a.code.add(k.glsl`
    // This is the maximum float value representable as 32bit fixed point,
    // it is rgba2float(vec4(1)) inlined.
    const float MAX_RGBA_FLOAT =
      255.0 / 256.0 +
      255.0 / 256.0 / 256.0 +
      255.0 / 256.0 / 256.0 / 256.0 +
      255.0 / 256.0 / 256.0 / 256.0 / 256.0;

    // Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)
    const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

    vec4 float2rgba(const float value) {
      // Make sure value is in the domain we can represent
      float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

      // Decompose value in 32bit fixed point parts represented as
      // uint8 rgba components. Decomposition uses the fractional part after multiplying
      // by a power of 256 (this removes the bits that are represented in the previous
      // component) and then converts the fractional part to 8bits.
      vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

      // Convert uint8 values (from 0 to 255) to floating point representation for
      // the shader
      const float toU8AsFloat = 1.0 / 255.0;

      return fixedPointU8 * toU8AsFloat;
    }

    // Factors to convert rgba back to float
    const vec4 RGBA_2_FLOAT_FACTORS = vec4(
      255.0 / (256.0),
      255.0 / (256.0 * 256.0),
      255.0 / (256.0 * 256.0 * 256.0),
      255.0 / (256.0 * 256.0 * 256.0 * 256.0)
    );

    float rgba2float(vec4 rgba) {
      // Convert components from 0->1 back to 0->255 and then
      // add the components together with their corresponding
      // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)
      return dot(rgba, RGBA_2_FLOAT_FACTORS);
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/util/ScreenSizePerspective.glsl ../core/shaderLibrary/hud/HUD.glsl ../core/shaderLibrary/hud/HUDOcclusionPass.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../../../../chunks/HUDMaterial.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../lib/OrderIndependentTransparency".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){h=function(z){function A(){return z.apply(this,arguments)||this}a._inheritsLoose(A,z);var t=A.prototype;t.initializeProgram=function(D){var E=A.shader.get();const G=this.configuration;E=E.build({output:G.output,FrontFacePass:2===G.transparencyPassType,viewingMode:D.viewingMode,occlusionTestEnabled:G.occlusionTestEnabled,signedDistanceFieldEnabled:G.sdf,slicePlaneEnabled:G.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,
debugDrawBorder:G.debugDrawBorder,binaryHighlightOcclusionEnabled:G.binaryHighlightOcclusion,screenCenterOffsetUnitsEnabled:G.screenCenterOffsetUnitsEnabled,screenSizePerspectiveEnabled:G.screenSizePerspective,verticalOffsetEnabled:G.verticalOffset,pixelSnappingEnabled:G.pixelSnappingEnabled,vvSize:G.vvSize,vvColor:G.vvColor,vvInstancingEnabled:!1,isDraped:G.isDraped});return new e(D.rctx,E.generateSource("vertex"),E.generateSource("fragment"),c.Default3D)};t.bindPass=function(D,E,G){g.View.bindProjectionMatrix(this.program,
G.camera.projectionMatrix);this.program.setUniform1f("cameraGroundRelative",G.camera.aboveGround?1:-1);this.program.setUniform1f("perDistancePixelRatio",Math.tan(G.camera.fovY/2)/(G.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",G.camera.viewInverseTransposeMatrix);this.program.setUniform1f("polygonOffset",E.shaderPolygonOffset);y.VerticalOffset.bindUniforms(this.program,E,G);n.ScreenSizePerspective.bindUniforms(this.program,E);this.program.setUniform1f("pixelRatio",G.camera.pixelRatio||
1);g.View.bindViewport(this.program,G);6===this.configuration.output?q.HUDOcclusion.bindUniforms(this.program):(w.HUD.bindUniforms(this.program,G),v.HUDMaterial.bindUniforms(this.program,E,G.camera.pixelRatio||1),u.VisualVariables.bindUniforms(this.program,E),this.configuration.occlusionTestEnabled&&w.HUD.bindVisibilityTexture(D,this.program,G));4===this.configuration.output&&m.OutputHighlight.bindOutputHighlight(D,this.program,G)};t.bindDraw=function(D){g.View.bindView(this.program,D);g.View.bindCamPosition(this.program,
D.origin,D.camera.viewInverseTransposeMatrix);p.Slice.bindUniformsWithOrigin(this.program,this.configuration,D)};t.setPipelineState=function(D){const E=this.configuration,G=3===D,H=this.configuration.polygonOffsetEnabled&&x,I=!G&&2!==D||4===E.output?null:(E.depthEnabled||6===E.output)&&f.defaultDepthWriteParams;return f.makePipelineState({blending:0===E.output||7===E.output||4===E.output?G?C:B.OITBlending(D):null,depthTest:{func:515},depthWrite:I,colorWrite:f.defaultColorWriteParams,polygonOffset:H})};
t.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};a._createClass(A,[{key:"primitiveType",get:function(){return 6===this.configuration.output?0:4}}]);return A}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(v.HUDMaterialShader,()=>new Promise(function(z,A){b(["./HUDMaterial.glsl"],z,A)}));const x={factor:0,units:-4},C=f.simpleBlendingParams(1,771);l=function(z){function A(){var t=z.apply(this,arguments)||this;t.output=0;t.occlusionTestEnabled=
!0;t.sdf=!1;t.vvSize=!1;t.vvColor=!1;t.verticalOffset=!1;t.screenSizePerspective=!1;t.screenCenterOffsetUnitsEnabled=0;t.debugDrawBorder=!0;t.binaryHighlightOcclusion=!0;t.slicePlaneEnabled=!1;t.polygonOffsetEnabled=!1;t.depthEnabled=!0;t.transparencyPassType=3;t.pixelSnappingEnabled=!0;t.isDraped=!1;return t}a._inheritsLoose(A,z);return A}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter({count:8})],l.prototype,"output",void 0);r.__decorate([d.parameter()],l.prototype,"occlusionTestEnabled",
void 0);r.__decorate([d.parameter()],l.prototype,"sdf",void 0);r.__decorate([d.parameter()],l.prototype,"vvSize",void 0);r.__decorate([d.parameter()],l.prototype,"vvColor",void 0);r.__decorate([d.parameter()],l.prototype,"verticalOffset",void 0);r.__decorate([d.parameter()],l.prototype,"screenSizePerspective",void 0);r.__decorate([d.parameter({count:2})],l.prototype,"screenCenterOffsetUnitsEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"debugDrawBorder",void 0);r.__decorate([d.parameter()],
l.prototype,"binaryHighlightOcclusion",void 0);r.__decorate([d.parameter()],l.prototype,"slicePlaneEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"polygonOffsetEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"depthEnabled",void 0);r.__decorate([d.parameter({count:4})],l.prototype,"transparencyPassType",void 0);r.__decorate([d.parameter()],l.prototype,"pixelSnappingEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"isDraped",void 0);k.HUDMaterialTechnique=h;k.HUDMaterialTechniqueConfiguration=
l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define(["exports","../../shaderModules/interfaces","../util/ScreenSizePerspective.glsl"],function(b,k,a){function r(d,c){const e=d.vertex.code;c.verticalOffsetEnabled?(d.vertex.uniforms.add("verticalOffset","vec4"),c.screenSizePerspectiveEnabled&&(d.include(a.ScreenSizePerspective),d.vertex.uniforms.add("screenSizePerspectiveAlignment","vec4")),e.add(k.glsl`
    vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
      ${1===c.viewingMode?k.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:k.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
      ${c.screenSizePerspectiveEnabled?k.glsl`
          float cosAngle = dot(worldNormal, normalize(worldPos - camPos));
          float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:k.glsl`
          float verticalOffsetScreenHeight = verticalOffset.x;`}
      // Screen sized offset in world space, used for example for line callouts
      float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
      return worldNormal * worldOffset;
    }

    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
      return worldPos + calculateVerticalOffset(worldPos, localOrigin);
    }
    `)):e.add(k.glsl`
    vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }
    `)}function l(d,c,e,f=h){f.screenLength=d.screenLength;f.perDistance=Math.tan(.5*c)/(.5*e);f.minWorldLength=d.minWorldLength;f.maxWorldLength=d.maxWorldLength;return f}(function(d){d.bindUniforms=function(c,e,f){e.verticalOffset&&(e=l(e.verticalOffset,f.camera.fovY,f.camera.fullViewport[3]),c.setUniform4f("verticalOffset",e.screenLength*(f.camera.pixelRatio||1),e.perDistance,e.minWorldLength,e.maxWorldLength))}})(r||(r={}));const h={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0};
b.VerticalOffset=r;b.calculateVerticalOffsetFactors=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","../../../webgl/renderState"],function(b,k){const a=k.separateBlendingParams(770,1,771,771),r=k.simpleBlendingParams(1,1),l=k.simpleBlendingParams(0,771),h={factor:-1,units:-2};b.OITBlending=function(d){return 2===d?null:1===d?l:r};b.OITDepthTest=function(d){return 3===d||2===d?513:515};b.OITDepthWrite=
function(d){return 2===d?k.defaultDepthWriteParams:null};b.OITPolygonOffset=h;b.OITPolygonOffsetLimit=5E5;b.blendingAlpha=l;b.blendingColor=r;b.blendingDefault=a;b.getOITPolygonOffset=function(d){return d?h:null};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ./Deconflictor".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){b.LabelDeconflictor=function(w){function q(){var u=w.apply(this,arguments)||this;u.visibilityGroup=1;u.iconMarginFactor=0;u._lastDeconfliction=0;return u}k._inheritsLoose(q,w);var m=q.prototype;m.update=function(u){if(!this.parent.needsUpdate()){var v=performance.now();if(2===u.state||2E3<v-this._lastDeconfliction)w.prototype.update.call(this,u),0===this.state&&(this._lastDeconfliction=v)}};m.enabledChanged=function(u,v){this.modifyGraphics(v,u.labelsEnabled)};
m.getGraphicsLayers=function(u){return u.labelGraphics};k._createClass(q,[{key:"viewState",get:function(){return this.parent.viewState}}]);return q}(n.Deconflictor);a.__decorate([d.property({constructOnly:!0})],b.LabelDeconflictor.prototype,"parent",void 0);b.LabelDeconflictor=a.__decorate([e.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],b.LabelDeconflictor);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../symbols/callouts/calloutUtils ../../../../core/asyncUtils ../../../../core/Handles ../../../support/Scheduler ../../../../core/MapUtils ../../../../layers/support/layerUtils ../../support/debugFlags ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DGraphicCreationContext ../../webgl-engine/lib/Layer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextRenderer ./graphicSymbolUtils ./labelPlacement ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextTextureAtlas".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L){const S=h.getLogger("esri.views.3d.layers.graphics.Labeler");b.Labeler=function(T){function O(){var F=T.apply(this,arguments)||this;F.idHint="__labeler";F._dirty=!1;F.labels=new Map;F.labelsToAdd=new Map;F.labelsToRemove=new Map;F.labelingContexts=[];return F}k._inheritsLoose(O,T);var Q=O.prototype;Q.setup=function(){if(l.isNone(this.handles)){const F=this.view.resourceController.scheduler;this.handles=new v;this.handles.add([this.view.watch("state.camera",
()=>this.setDirty()),this.view.watch("pixelRatio",()=>this.resetAllLabels()),F.registerTask(y.Task.LABELER,N=>this.update(N),()=>this.needsUpdate())])}l.isNone(this.textTextureAtlas)&&(this.textTextureAtlas=new L["default"]({idHint:this.idHint+"_atlas",view:this.view}),this.hudMaterialCollection=new K(this.view._stage),this.calloutMaterialCollection=new K(this.view._stage))};Q.dispose=function(){this.handles=l.destroyMaybe(this.handles);this.textTextureAtlas=l.disposeMaybe(this.textTextureAtlas);
this.hudMaterialCollection=l.disposeMaybe(this.hudMaterialCollection);this.calloutMaterialCollection=l.disposeMaybe(this.calloutMaterialCollection);this.labelingContexts=[];this.labels.clear();this.labelsToAdd.clear();this.labelsToRemove.clear()};Q.isActiveLabelingContext=function(F){return F.active&&x.areLabelsVisible(F.layer)};Q.activateLabelingContext=function(F){F.labels.forEach((N,P)=>{this.labels.set(P,N);N.graphics3DGraphic.setVisibilityFlag(0,!0,1)});F.active=!0};Q.deactivateLabelingContext=
function(F){F.labels.forEach((N,P)=>{N.graphics3DGraphic.setVisibilityFlag(0,!1,1);this.setLabelGraphicVisibility(N.graphics3DGraphic,!1);this.labels.delete(P)});F.active=!1};Q.addLabelTextureToAtlas=function(F){for(const N of F.graphics3DGraphic.labelGraphics){if(!N._labelClass)continue;const P=F.textRenderers[N._labelIndex];P&&this.textTextureAtlas.addTextTexture(P,N.stageObject)}F.rendered=!0};Q.removeLabelTextureFromAtlas=function(F){for(const N of F.graphics3DGraphic.labelGraphics){if(!N._labelClass)continue;
const P=F.textRenderers[N._labelIndex];P&&this.textTextureAtlas.removeTextTexture(P,N.stageObject)}F.rendered=!1};Q.needsUpdate=function(){return this.view.ready&&this.isDirty};Q.update=function(F){this._updateLabels(F);!this._dirty&&this.deconflictor.needsUpdate()&&this.deconflictor.update(F)};Q._updateLabels=function(F){if(this._dirty){this._dirty=!1;for(const N of this.labelingContexts)if(this.isActiveLabelingContext(N)){if(!this.hasValidLabelClassContext(N)){if(this.hasInvalidLabelClassContext(N)){this.deactivateLabelingContext(N);
continue}this.createLabelClassContext(N);if(this.hasPendingLabelClassContext(N)){this._dirty=!0;continue}if(!this.hasValidLabelClassContext(N))continue}B.someMap(N.labelsToInitialize,(P,U)=>{this.ensureGraphics3DResources(P)&&(this.labels.set(U,P),this.deconflictor.setDirty(),F.madeProgress());if(P.visible&&P.hasTextTextureResources||!P.visible&&P.hasGraphics3DResources)N.labelsToInitialize.delete(U),F.madeProgress();return F.done})&&(this._dirty=!0)}this.labelsToRemove.forEach(N=>this.removeLabelTextureFromAtlas(N));
this.labelsToRemove.clear();this.labelsToAdd.forEach(N=>this.addLabelTextureToAtlas(N));this.labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};Q.hasPendingLabelClassContext=function(F){return F.labelClassPromise&&!!F.labelClassAbortController};Q.hasValidLabelClassContext=function(F){return F.labelClassContexts&&F.labelClassContexts.length};Q.hasInvalidLabelClassContext=function(F){return null===F.labelClassContexts};Q.createLabelClassContextAsync=async function(F){const N=F.labelClassAbortController.signal;
await F.layer.when();w.throwIfAborted(N);F.scaleVisibility&&F.scaleVisibility.updateScaleRangeActive();const P=F.graphics3DCore;var U=P.layer;if((U=U.labelingInfo&&U.labelingInfo.filter(X=>!!X.symbol))&&0!==U.length){var V=Array(U.length),W=!1;await u.forEach(U,async(X,ca)=>{var R=X.symbol;const aa=I.getGraphics3DSymbol(P.getOrCreateGraphics3DSymbol(R));if(l.isNone(aa))S.error("Failed to create Graphics3DSymbol for label");else{await aa.load();w.throwIfAborted(N);var ka=null;m.isCalloutSupport(R)&&
R.hasVisibleCallout()&&(ka=t.make(R,P.symbolCreationContext),await ka.load(),w.throwIfAborted(N));R=await u.result(A.createLabelFunction(X,F.layer.fields.map(da=>da.toJSON()),this.view.spatialReference));w.throwIfAborted(N);!0===R.ok?V[ca]={labelClass:X,labelFunction:R.value,graphics3DSymbol:aa,graphics3DCalloutSymbolLayer:ka,calloutSymbolLayerIndex:0,textRenderParameters:this.createTextRenderParameters(aa.symbol)}:(S.error(`Label expression failed to evaluate: ${R.error}`),W=!0)}});w.throwIfAborted(N);
W||(F.labelClassContexts=V)}};Q.createLabelClassContext=async function(F){F.labelClassPromise||(F.labelClassPromise=this.createLabelClassContextAsync(F).catch(N=>{if(w.isAbortError(N))throw N;F.labelClassContexts=null}).then(()=>{F.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return F.labelClassPromise};Q.createTextRenderParameters=function(F){return(F=F.symbolLayers.getItemAt(0))&&"text"===F.type?G.TextRenderParameters.fromSymbol(F,this.view.pixelRatio):
null};Q.destroyLabelClassContext=function(F){for(var N of F.labelClassContexts)--N.graphics3DSymbol.referenced,N.graphics3DSymbol=null;N=F.labelClassAbortController;F.labelClassAbortController=w.createAbortController();N&&N.abort();F.labelClassContexts=[];F.labelClassPromise=null;this.notifyChange("updating")};Q.createTextSymbolGraphic=function(F,N,P,U,V){F={text:F.text,centerOffset:P.centerOffset,translation:P.translation,elevationOffset:P.elevationOffset,screenOffset:P.screenOffset,anchor:P.anchor,
centerOffsetUnits:P.centerOffsetUnits,verticalOffset:P.verticalOffset,debugDrawBorder:C.LABELS_SHOW_BORDER,displayWidth:F.displayWidth,displayHeight:F.displayHeight};M.graphic=N;M.renderingInfo=null;M.layer=U;return V.createLabel(M,F,this.hudMaterialCollection,this.textTextureAtlas)};Q.createLineCalloutGraphic=function(F,N,P,U,V){N={symbol:N,translation:U.translation,elevationOffset:U.elevationOffset,screenOffset:U.screenOffset,centerOffset:U.centerOffset,centerOffsetUnits:U.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};
M.graphic=F;M.renderingInfo=N;M.layer=V;return P.createGraphics3DGraphic(M)};Q.ensureGraphics3DResources=function(F){if(F.hasGraphics3DResources)return!1;const N=F.graphics3DGraphic;if(N.destroyed)return!1;this.ensureTextTextureResources(F);const P=F.labelingContext,U=P.labelClassContexts;if(!U||0===U.length||!P.emptySymbolLabelSupported&&0===N._graphics.length)return!1;var V=!1,W=N.graphic;const X=P.layer;var ca=x.areLabelsVisible(P.layer);const R=this.view._stage;for(let ka=0;ka<U.length;ka++){const da=
F.textRenderers[ka];if(!da)continue;const fa=U[ka];var aa=fa.graphics3DSymbol;let ea=null;aa.symbol&&"label-3d"===aa.symbol.type&&(ea=aa.symbol);const Y=aa.symbolLayers[0];if(!Y)continue;const Z=fa.labelClass;aa=J.get({graphics3DGraphic:N,labelSymbol:ea,labelClass:Z,disablePlacement:P.disablePlacement});if(!l.isNone(aa)){Y.setElevationInfoOverride(P.elevationInfoOverride);V=this.createTextSymbolGraphic(da,W,aa,X,Y);if(!V)return!1;V._labelClass=Z;V._labelIndex=ka;N.addLabelGraphic(V,R,P.stageLayer);
N.setVisibilityFlag(0,ca,1);N.clearVisibilityFlag(1,1);N.setVisibilityFlag(3,!1,1);V=!0;(ca=fa.graphics3DCalloutSymbolLayer)&&aa.hasLabelVerticalOffset&&(ca.setElevationInfoOverride(P.elevationInfoOverride),W=this.createLineCalloutGraphic(W,ea,ca,aa,X))&&(fa.calloutSymbolLayerIndex=N.labelGraphics.length,N.addLabelGraphic(W,R,P.stageLayer));break}}P.scaleVisibility&&V&&P.scaleVisibility.updateGraphicLabelScaleVisibility(N);return F.hasGraphics3DResources=!0};Q.destroyGraphics3DResources=function(F){const N=
F.labelingContext.labelClassContexts;for(const P of F.graphics3DGraphic.labelGraphics){if(null==P._labelClass)continue;const U=N[P._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=U)U.onRemoveGraphic(P)}F.graphics3DGraphic.clearLabelGraphics();F.hasGraphics3DResources=!1};Q.ensureTextTextureResources=function(F){if(!F.hasTextTextureResources){var N=F.labelingContext,P=N.labelClassContexts;if(P&&0!==P.length){var U=F.graphics3DGraphic.graphic;for(let V=0;V<P.length;V++){const W=P[V];F.textRenderers[V]=
null;if(!W.textRenderParameters)continue;const X=W.labelFunction;let ca;if("arcade"===X.type)try{const R=X.needsHydrationToEvaluate()?z.hydrateGraphic(U,N.layer):U;ca=X.evaluate(R)}catch(R){ca=null}else ca=X.evaluate(U);l.isNone(ca)||""===ca||/^\s+$/.test(ca)||(F.textRenderers[V]=new H.TextRenderer(ca,W.textRenderParameters))}F.hasTextTextureResources=!0}}};Q.destroyTextTextureResources=function(F){F.textRenderers=[];F.hasTextTextureResources=!1};Q.addGraphic=function(F,N){const P={hasGraphics3DResources:!1,
hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:F,graphics3DGraphic:N,textRenderers:[]};N=N.graphic.uid;F.labels.set(N,P);F.labelsToInitialize.set(N,P);this.setDirty();this.deconflictor.setDirty()};Q.removeGraphic=function(F,N){N=N.graphic.uid;const P=F.labels.get(N);P&&(this.destroyGraphic(P,N),F.labels.delete(N),F.labelsToInitialize.delete(N),this.setDirty(),this.deconflictor.setDirty())};Q.destroyGraphic=function(F,N){this.labels.has(N)&&(this.labels.delete(N),this.labelsToAdd.delete(N),
this.labelsToRemove.delete(N));F.hasTextTextureResources&&(this.removeLabelTextureFromAtlas(F),this.destroyTextTextureResources(F));F.hasGraphics3DResources&&this.destroyGraphics3DResources(F)};Q.labelingInfoChange=async function(F,N){if(N)for(const P of N){if(N=F.labels.get(P))this.removeGraphic(F,N.graphics3DGraphic),this.addGraphic(F,N.graphics3DGraphic)}else return this.visibilityInfoChange(F),this.resetLabels(F),this.createLabelClassContext(F)};Q.globalPropertyChanged=function(F,N){for(const P of N.labelClassContexts){const U=
new Map;N.labels.forEach(V=>{V=V.graphics3DGraphic;U.set(V.graphic.uid,V)});l.unwrap(P.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(F,U,V=>V.labelGraphics[0]);P.graphics3DCalloutSymbolLayer&&P.graphics3DCalloutSymbolLayer.globalPropertyChanged(F,U,V=>V.labelGraphics[P.calloutSymbolLayerIndex])}};Q.visibilityInfoChange=function(F){const N=F.layer.labelsVisible;N&&!F.active&&this.activateLabelingContext(F);!N&&F.active&&this.deactivateLabelingContext(F);this.setDirty()};Q.resetAllLabels=
function(){for(const F of this.labelingContexts)this.resetLabels(F)};Q.resetLabels=function(F){F.labels.forEach((N,P)=>{this.destroyGraphic(N,P);N.visible=!1;N.rendered=!1;F.labelsToInitialize.set(P,N)});this.destroyLabelClassContext(F);this.setDirty();this.deconflictor.setDirty()};Q.findLabelingContext=function(F){for(const N of this.labelingContexts)if(N.graphics3DCore===F)return N;return null};Q.addGraphicsOwner=function(F,N,P){const U=P&&P.emptySymbolLabelSupported||!1,V=P&&P.elevationInfoOverride||
null;P=P&&P.disablePlacement||null;if(!this.findLabelingContext(F)){var W=F.layer,X={graphics3DCore:F,layer:W,scaleVisibility:N,emptySymbolLabelSupported:U,elevationInfoOverride:V,disablePlacement:P,active:W.labelsVisible,labelClassPromise:null,labelClassAbortController:w.createAbortController(),labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new E(`${this.idHint}_${W.uid}`,{isPickable:!0},W.uid)};this.view._stage.add(0,X.stageLayer);this.view._stage.addToViewContent([X.stageLayer.id]);
this.labelingContexts.push(X);this.setDirty();return{addGraphic:ca=>this.addGraphic(X,ca),removeGraphic:ca=>this.removeGraphic(X,ca),featureReductionChange:()=>{},layerLabelsEnabled:()=>x.areLabelsVisible(X.layer),labelingInfoChange:ca=>this.labelingInfoChange(X,ca),elevationInfoChange:()=>this.globalPropertyChanged("elevationInfo",X),slicePlaneEnabledChange:()=>this.globalPropertyChanged("slicePlaneEnabled",X),visibilityInfoChange:()=>this.visibilityInfoChange(X),reset:()=>this.resetLabels(X),clear:()=>
{},processStageDirty:()=>this.view._stage.processDirtyLayer(X.stageLayer.id)}}};Q.removeGraphicsOwner=function(F){const N=this.findLabelingContext(F);N&&(F=this.labelingContexts.indexOf(N),this.labelingContexts.splice(F,1),N.labels.forEach(P=>this.removeGraphic(N,P.graphics3DGraphic)),F=N.stageLayer.id,this.view._stage.removeFromViewContent([F]),this.view._stage.remove(0,F),N.stageLayer=null,this.setDirty())};Q.setLabelGraphicVisibility=function(F,N){F=F.graphic.uid;const P=this.labels.get(F);P&&
P.visible!==N&&(N&&!P.rendered?(this.labelsToAdd.set(F,P),this.labelsToRemove.delete(F),P.hasTextTextureResources||P.labelingContext.labelsToInitialize.set(F,P)):!N&&P.rendered&&(this.labelsToRemove.set(F,P),this.labelsToAdd.delete(F)),P.visible=N,this.setDirty())};Q.setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};k._createClass(O,[{key:"isDirty",get:function(){return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.updating||this.deconflictor.needsUpdate()}},
{key:"updating",get:function(){return this._dirty||this.textTextureAtlas&&this.textTextureAtlas.updating||this.deconflictor.updating||this.labelingContexts.some(F=>this.hasPendingLabelClassContext(F))}},{key:"updatingProgress",get:function(){if(!this.updating||!this.textTextureAtlas)return 1;const F=0<this.labelingContexts.length?this.labelingContexts.reduce((N,P)=>N+(this.hasPendingLabelClassContext(P)?0:1),0)/this.labelingContexts.length:1;return(this._dirty?0:.3)+(this.textTextureAtlas.updating?
0:.1)+.1*F+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this.textTextureAtlas,resetAllLabels:()=>this.resetAllLabels()}}}]);return O}(q);a.__decorate([c.property({constructOnly:!0})],b.Labeler.prototype,"view",void 0);a.__decorate([c.property({constructOnly:!0})],b.Labeler.prototype,"deconflictor",void 0);a.__decorate([c.property()],b.Labeler.prototype,"textTextureAtlas",void 0);a.__decorate([c.property({type:Boolean,readOnly:!0,dependsOn:["textTextureAtlas.updating",
"deconflictor.updating"]})],b.Labeler.prototype,"updating",null);b.Labeler=a.__decorate([f.subclass("esri.views.3d.layers.graphics.Labeler")],b.Labeler);const M=new D(null,null,null);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../core/has ../../core/typedArrayUtil ../../core/lang ../../core/maybe ../../geometry/support/jsonUtils ../../Graphic ./dehydratedFeatures".split(" "),function(b,k,a,r,l,h,d,c){function e(v){return"declaredClass"in
v}function f(v){return"declaredClass"in v}function g(v){return"declaredClass"in v}function p(v){return l.isNone(v)?null:e(v)?v:h.fromJSON(n(v))}function n(v){const y=v.spatialReference.toJSON();switch(v.type){case "point":{const {x:B,y:x,z:C,m:z}=v;return{x:B,y:x,z:C,m:z,spatialReference:y}}case "polygon":{const {rings:B,hasZ:x,hasM:C}=v;return{rings:w(B),hasZ:x,hasM:C,spatialReference:y}}case "polyline":{const {paths:B,hasZ:x,hasM:C}=v;return{paths:w(B),hasZ:x,hasM:C,spatialReference:y}}case "extent":{const {xmin:B,
xmax:x,ymin:C,ymax:z,zmin:A,zmax:t,mmin:D,mmax:E,hasZ:G,hasM:H}=v;return{xmin:B,xmax:x,ymin:C,ymax:z,zmin:A,zmax:t,mmin:D,mmax:E,hasZ:G,hasM:H,spatialReference:y}}case "multipoint":{const {points:B,hasZ:x,hasM:C}=v;return{points:u(B)?q(B):B,hasZ:x,hasM:C,spatialReference:y}}}}function w(v){return m(v)?v.map(y=>q(y)):v}function q(v){return v.map(y=>a.toArray(y))}function m(v){for(const y of v)if(0!==y.length)return u(y);return!1}function u(v){return v.length&&(a.isFloat32Array(v[0])||a.isFloat64Array(v[0]))}
b.clonePoint=function(v,y){if(!v)return null;if(f(v)){if(null==y)return v.clone();if(f(y))return y.copy(v)}null!=y?(y.x=v.x,y.y=v.y,y.spatialReference=v.spatialReference,v.hasZ?(y.z=v.z,y.hasZ=v.hasZ):(y.z=null,y.hasZ=!1),v.hasM?(y.m=v.m,y.hasM=!0):(y.m=null,y.hasM=!1)):(y=c.makeDehydratedPoint(v.x,v.y,v.z,v.spatialReference),v.hasM&&(y.m=v.m,y.hasM=!0));return y};b.hydrateGeometry=p;b.hydrateGraphic=function(v,y){if(!v)return null;if(g(v))return v;y=new d({layer:y,sourceLayer:y});y.visible=v.visible;
y.symbol=r.clone(v.symbol);y.attributes=r.clone(v.attributes);y.geometry=p(v.geometry);return y};b.isHydratedGeometry=e;b.isHydratedGraphic=g;b.isHydratedPoint=f;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../core/Logger ../../core/Error ../../support/arcadeOnDemand ./fieldUtils ../../intl/date ../../intl/number ./FieldsIndex ./labelUtils".split(" "),function(b,k,a,r,l,h,d,c,e,f){function g(q,m){if(null==q)return"";
const u=m.domain;if(u)if("codedValue"===u.type||"coded-value"===u.type)for(var v of u.codedValues){if(v.code===q)return v.name}else if("range"===u.type){v=+q;const y="range"in u?u.range[1]:u.maxValue;if(("range"in u?u.range[0]:u.minValue)<=v&&v<=y)return u.name}"date"===m.type||"esriFieldTypeDate"===m.type?q=d.formatDate(q,d.convertDateFormatToIntlOptions("short-date")):h.isNumericField(m)&&(q=c.formatNumber(+q));return q?q:""}const p=a.getLogger("esri.layers.support.labelFormatUtils"),n={type:"simple",
evaluate(){return null}},w={getAttribute(q,m){return q.field(m)}};k.createLabelFunction=async function(q,m,u){if(!q||!q.symbol)return n;const v=q.where,y=f.getLabelExpression(q);q=v?await new Promise(function(B,x){b(["../../core/sql/WhereClause"],B,x)}):null;if("arcade"===y.type){const B=await l.createLabelExpression(y.expression,u,m);u={type:"arcade",evaluate(x){try{const C=B.evaluate({$feature:"attributes"in x?B.repurposeFeature(x):B.repurposeAdapter(x)});if(null!=C)return C.toString()}catch(C){p.error(new r("bad-arcade-expression",
"Encountered an error when evaluating label expression for feature",{feature:x,expression:y}))}return null},needsHydrationToEvaluate(){return null==f.getSingleFieldArcadeExpression(y.expression)}}}else u={type:"simple",evaluate(B){return y.expression.replace(/{[^}]*}/g,x=>{var C=x.slice(1,-1);C=h.getField(m,C);if(!C)return x;x=null;"attributes"in B?B&&B.attributes&&(x=B.attributes[C.name]):x=B.field(C.name);return null==x?"":g(x,C)})}};if(v){let B;try{B=q.WhereClause.create(v,new e(m))}catch(C){return n}const x=
u.evaluate;u.evaluate=C=>B.testFeature(C,"attributes"in C?void 0:w)?x(C):null}return u};k.formatField=g;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(b,k,a,r){const l=k.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),h={line:r.Graphics3DLineCalloutSymbolLayer};
b.make=function(d,c){if(!a.isCalloutSupport(d))return l.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${d.type}' does not support callouts`),null;if(!d.callout)return null;const e=h[d.callout.type];return e?new e(d,c):(l.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${d.callout.type}`),null)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../Color ../../../../core/screenUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Material ./graphicUtils ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ../../webgl-engine/lib/Geometry ./symbolComplexity ./Graphics3DSymbolLayer ./pointUtils ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){const y=h.VertexAttrConstants;h=function(A){function t(E,G){E=A.call(this,E,null,G,z)||this;E._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};E.ensureDrapedStatus(!1);return E}k._inheritsLoose(t,A);var D=t.prototype;D.doLoad=async function(){this._material=new v.LineCalloutMaterial(this.materialParameters,this._getIdHint("_lineCallout_common"));this._context.stage.add(3,this._material)};D.destroy=function(){A.prototype.destroy.call(this);
a.isSome(this._material)&&(this._context.stage.remove(3,this._material.id),this._material=null)};D.perInstanceMaterialParameters=function(E){const G=this.materialParameters;G.screenOffset=E.screenOffset||[0,0];G.centerOffsetUnits=E.centerOffsetUnits||"world";return G};D._defaultElevationInfoNoZ=function(){return C};D.createGraphics3DGraphic=function(E){const G=E.renderingInfo;E=E.graphic;const H=this.setGraphicElevationContext(E,new p.ElevationContext,G.elevationOffset||0);var I=G.symbol;const J=
"on-the-ground"===this._elevationContext.mode&&("cim"===I.type||!I.symbolLayers.some(K=>"object"===K.type||"text"===K.type));if("label-3d"!==I.type&&J)return null;I=e.computeCentroid(E.geometry);return a.isNone(I)?null:this._createAs3DShape(I,H,G,"graphic"+E.uid,E.uid)};D.layerOpacityChanged=function(){if(a.isNone(this._material))return!0;this._material.setParameterValues(this.materialParameters);return!0};D.layerElevationInfoChanged=function(E,G,H){H=f.elevationModeChangeUpdateType(t.elevationModeChangeTypes,
H,this._elevationContext.mode);if(H!==f.SymbolUpdateType.UPDATE)return H;E.forEach(I=>{const J=G(I);a.isSome(J)&&this.updateGraphicElevationContext(I.graphic,J)});return H};D.slicePlaneEnabledChanged=function(){if(a.isNone(this._material))return!0;this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};D.physicalBasedRenderingChanged=function(){return!0};D.pixelRatioChanged=function(){return!0};D.setGraphicElevationContext=function(E,G,H=0){E=A.prototype.setGraphicElevationContext.call(this,
E,G);E.addOffsetRenderUnits(H);return E};D.updateGraphicElevationContext=function(E,G){this.setGraphicElevationContext(E,G.elevationContext,G.metadata.elevationOffset);G.needsElevationUpdates=f.needsElevationUpdates2D(G.elevationContext.mode)};D.updateGeometry=function(E,G){return!1};D.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:q.emptySymbolComplexity.memory}};D.createVertexData=function(E){const {translation:G,centerOffset:H}=
E;return G||H?{[y.POSITION]:G?{size:3,data:[G[0],G[1],G[2]]}:B[y.POSITION],[y.NORMAL]:B[y.NORMAL],[y.AUXPOS1]:H?{size:4,data:[H[0],H[1],H[2],H[3]]}:B[y.AUXPOS1]}:B};D.getOrCreateMaterial=function(E,G){const H=this.perInstanceMaterialParameters(E),I=v.LineCalloutMaterial.uniqueMaterialIdentifier(H);if(a.isSome(this._material)&&I===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(E.materialCollection){let J=E.materialCollection.getMaterial(I);J||(J=new v.LineCalloutMaterial(H,
`${G}_lineCallout_shared`),E.materialCollection.addMaterial(I,J));return{material:J,isUnique:!1}}return{material:new v.LineCalloutMaterial(H,`${G}_lineCallout_unique`),isUnique:!0}};D._createAs3DShape=function(E,G,H,I,J){var K=new d.GeometryData(this.createVertexData(H),x,"point");K=[new w(K,I)];const L=this.getOrCreateMaterial(H,I);I=u.createStageObjectForHUD(this._context,E,K,[L.material],null,null,G,I,this._context.layer.uid,J);if(null===I)return null;J=new n(this,I.object,K,L.isUnique?[L.material]:
null,null,g.perObjectElevationAligner,G);J.metadata={elevationOffset:H.elevationOffset||0};J.alignedSampledElevation=I.sampledElevation;J.needsElevationUpdates=f.needsElevationUpdates2D(G.mode);u.extendPointGraphicElevationContext(J,E,this._context.elevationProvider);return J};k._createClass(t,[{key:"materialParameters",get:function(){const E=this.symbol;var G=E.callout;const H=a.isSome(G.color)?r.toUnitRGBA(G.color):[0,0,0,0];H[3]*=this._getLayerOpacity();const I=l.pt2px(G.size||0);let J=null;if(E.verticalOffset){const {screenLength:L,
minWorldLength:S,maxWorldLength:M}=E.verticalOffset;J={screenLength:l.pt2px(L),minWorldLength:S||0,maxWorldLength:null!=M?M:Infinity}}G=a.isSome(G.border)&&a.isSome(G.border.color)?r.toUnitRGBA(G.border.color):null;const K="object"===E.symbolLayers.getItemAt(0).type;return{color:H,size:I,verticalOffset:J,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:G,occlusionTest:!K,
shaderPolygonOffset:K?0:void 0,depthHUDAlignStart:"label-3d"===E.type,slicePlaneEnabled:this._context.slicePlaneEnabled,renderOccluded:c.materialParametersDefaults.renderOccluded}}}]);return t}(m.Graphics3DSymbolLayer);h.elevationModeChangeTypes={definedChanged:f.SymbolUpdateType.UPDATE,staysOnTheGround:f.SymbolUpdateType.UPDATE,onTheGroundChanged:f.SymbolUpdateType.RECREATE};const B={[y.POSITION]:{size:3,data:[0,0,0]},[y.NORMAL]:{size:3,data:[0,0,1]},[y.AUXPOS1]:{size:4,data:[0,0,0,1]}};m=new Uint32Array([0]);
const x={[y.POSITION]:m,[y.NORMAL]:m,[y.AUXPOS1]:m},C={mode:"relative-to-ground",offset:0},z={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};b.Graphics3DLineCalloutSymbolLayer=h;b.default=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/maybe ../../../../geometry/support/coordsUtils ../../../../geometry/support/centroid ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){function u(B){var x=B.paths[0];if(!x||0===x.length)return null;x=a.getPointOnPath(x,a.getPathLength(x)/2);return q.makeDehydratedPoint(x[0],x[1],x[2],B.spatialReference)}function v(B,x,C){C=C?B:m.clonePoint(B);return x&&B?e.projectPoint(B,C,x)?C:null:C}function y(B){if(Array.isArray(B)){for(const x of B)if(!y(x))return!1;return!0}return null==B||0<=B}g={"bottom-left":g.fromValues(0,0),bottom:g.fromValues(.5,0),"bottom-right":g.fromValues(1,0),left:g.fromValues(0,
.5),center:g.fromValues(.5,.5),right:g.fromValues(1,.5),"top-left":g.fromValues(0,1),top:g.fromValues(.5,1),"top-right":g.fromValues(1,1)};b.computeCentroid=function(B,x){if("point"===B.type)return v(B,x,!1);if(m.isHydratedGeometry(B))switch(B.type){case "extent":return v(B.center,x,!1);case "polygon":return v(B.centroid,x,!1);case "polyline":return v(u(B),x,!0);case "mesh":return v(B.extent.center,x,!1)}else switch(B.type){case "extent":var C=l.isFinite(B.zmin);B=q.makeDehydratedPoint(.5*(B.xmax+
B.xmin),.5*(B.ymax+B.ymin),C?.5*(B.zmax+B.zmin):void 0,B.spatialReference);return v(B,x,!0);case "polygon":return(C=B.rings[0])&&0!==C.length?(C=r.ringsCentroid(B.rings,B.hasZ),B=q.makeDehydratedPoint(C[0],C[1],C[2],B.spatialReference)):B=null,v(B,x,!0);case "polyline":return v(u(B),x,!0)}};b.computeObjectRotation=function(B,x,C,z=f.create()){B=B||0;x=x||0;C=C||0;0!==B&&d.rotateZ(z,z,-B/180*Math.PI);0!==x&&d.rotateX(z,z,x/180*Math.PI);0!==C&&d.rotateY(z,z,C/180*Math.PI);return z};b.computeObjectScale=
function(B=h.ONES,x,C,z=1){const A=Array(3);if(k.isNone(x)||k.isNone(C))A[0]=1,A[1]=1,A[2]=1;else{let D=0;for(let E=2;0<=E;E--){const G=B[E];let H;const I=null!=G,J=0===E&&!t&&!I,K=C[E];"symbol-value"===G||J?H=0!==K?x[E]/K:1:I&&"proportional"!==G&&isFinite(G)&&(H=0!==K?G/K:1);if(null!=H){var t=A[E]=H;D=Math.max(D,Math.abs(H))}}for(B=2;0<=B;B--)null==A[B]?A[B]=t:0===A[B]&&(A[B]=.001*D)}for(t=2;0<=t;t--)A[t]/=z;return h.fromArray(A)};b.demResolutionForBoundingBox=function(B,x){return null!=x.minDemResolution?
x.minDemResolution:w.isPoint(B)?x.minDemResolutionForPoints:.01*w.maximumDimension(B)};b.enlargeExtent=function(B,x,C,z=0){if(B){x||(x=c.create());let A=.5*B.width*(C-1);C=.5*B.height*(C-1);B.width<1E-7*B.height?A+=C/20:B.height<1E-7*B.width&&(C+=A/20);n.set(x,B.xmin-A-z,B.ymin-C-z,B.xmax+A+z,B.ymax+C+z);return x}return null};b.isValidSize=y;b.mixinColorAndOpacity=function(B,x){const C=p.clone(p.ONES);k.isSome(B)&&(C[0]=B[0],C[1]=B[1],C[2]=B[2]);k.isSome(x)?C[3]=x:k.isSome(B)&&3<B.length&&(C[3]=B[3]);
return C};b.namedAnchorToHUDMaterialAnchorPos=g;b.overrideColor=function(B,x,C,z,A,t=[0,0,0,0]){for(let D=0;3>D;++D)k.isSome(B)&&null!=B[D]?t[D]=B[D]:k.isSome(C)&&null!=C[D]?t[D]=C[D]:t[D]=A[D];k.isSome(x)?t[3]=x:k.isSome(z)?t[3]=z:t[3]=A[3];return t};b.updateVertexAttributeAuxpos1w=function(B,x){for(let C=0;C<B.geometries.length;++C){const z=B.geometries[C].data.vertexAttributes.auxpos1;z&&z.data[3]!==x&&(z.data[3]=x,B.geometryVertexAttrsUpdated(C))}};b.validateSymbolLayerSize=function(B){null!=
B.isPrimitive&&(B=[B.width,B.depth,B.height]);return y(B)?null:"Symbol sizes may not be negative values"};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/compilerUtils ../../../../chunks/vec3f64 ../../../../chunks/mat4 ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../layers/graphics/dehydratedFeatures ../../support/ElevationProvider ./graphicUtils".split(" "),function(b,k,
a,r,l,h,d,c,e){function f(q,m,u,v,y){const B=(d.isDehydratedPoint(q)?q.z:c.isSamplePosition(q)?q.array[q.offset+2]:q[2])||0;switch(u.mode){case "on-the-ground":return u=c.getElevationAtPoint(m,q,"ground")||0,y&&(y.verticalDistanceToGround=0,y.sampledElevation=u),u;case "relative-to-ground":return q=c.getElevationAtPoint(m,q,"ground")||0,u=u.geometryZWithOffset(B,v),y&&(y.verticalDistanceToGround=u,y.sampledElevation=q),u+q;case "relative-to-scene":return q=c.getElevationAtPoint(m,q,"scene")||0,u=
u.geometryZWithOffset(B,v),y&&(y.verticalDistanceToGround=u,y.sampledElevation=q),u+q;case "absolute-height":return u=u.geometryZWithOffset(B,v),y&&(v=c.getElevationAtPoint(m,q,"ground")||0,y.verticalDistanceToGround=u-v,y.sampledElevation=v),u;default:return k.neverReached(u.mode),0}}(function(q){q[q.NONE=0]="NONE";q[q.UPDATE=1]="UPDATE";q[q.RECREATE=2]="RECREATE"})(b.SymbolUpdateType||(b.SymbolUpdateType={}));const g={"absolute-height":{applyElevationAlignmentBuffer:function(q,m,u,v,y,B,x,C){B=
C.calculateOffsetRenderUnits(x);C=C.featureExpressionInfoContext;m*=3;v*=3;for(x=0;x<y;++x){const z=q[m+1],A=q[m+2];u[v+0]=q[m+0];u[v+1]=z;u[v+2]=null==C?A+B:B;m+=3;v+=3}return 0},requiresAlignment:function(q){const m=q.featureExpressionInfoContext;return 0!==q.meterUnitOffset||null!=m}},"on-the-ground":{applyElevationAlignmentBuffer:function(q,m,u,v,y,B){let x=0;const C=B.spatialReference;m*=3;v*=3;for(let z=0;z<y;++z){const A=q[m+0],t=q[m+1],D=B.getElevation(A,t,q[m+2],C,"ground")||0;x+=D;u[v+0]=
A;u[v+1]=t;u[v+2]=D;m+=3;v+=3}return x/y},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(q,m,u,v,y,B,x,C){let z=0;x=C.calculateOffsetRenderUnits(x);C=C.featureExpressionInfoContext;const A=B.spatialReference;m*=3;v*=3;for(let t=0;t<y;++t){const D=q[m+0],E=q[m+1],G=q[m+2],H=B.getElevation(D,E,G,A,"ground")||0;z+=H;u[v+0]=D;u[v+1]=E;u[v+2]=null==C?G+H+x:H+x;m+=3;v+=3}return z/y},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(q,
m,u,v,y,B,x,C){let z=0;x=C.calculateOffsetRenderUnits(x);C=C.featureExpressionInfoContext;const A=B.spatialReference;m*=3;v*=3;for(let t=0;t<y;++t){const D=q[m+0],E=q[m+1],G=q[m+2],H=B.getElevation(D,E,G,A,"scene")||0;z+=H;u[v+0]=D;u[v+1]=E;u[v+2]=null==C?G+H+x:H+x;m+=3;v+=3}return z/y},requiresAlignment:()=>!0}},p=h.create(),n={verticalDistanceToGround:0,sampledElevation:0},w=a.create();b.applyElevationAlignmentForHUD=function(q,m,u,v,y){u=f(m,u,y,v,n);e.updateVertexAttributeAuxpos1w(q,n.verticalDistanceToGround);
y=n.sampledElevation;const B=r.copy(p,q.objectTransformation);w[0]=m.x;w[1]=m.y;w[2]=u;l.computeLinearTransformation(m.spatialReference,w,B,v.spatialReference)?q.objectTransformation=B:console.warn("Could not locate symbol object properly, it might be misplaced");return y};b.applyPerVertexElevationAlignment=function(q,m,u,v,y,B,x,C,z,A,t){const D=g[t.mode];let E=0;if(l.projectBuffer(q,m,u,v,z.spatialReference,y,C)&&(D.requiresAlignment(t)?(E=D.applyElevationAlignmentBuffer(v,y,B,x,C,z,A,t),q=B,y=
x):q=v,l.projectBuffer(q,z.spatialReference,y,B,A.spatialReference,x,C)))return E};b.elevationModeChangeUpdateType=function(q,m,u){return null==m||null==u?q.definedChanged:"on-the-ground"===m&&"on-the-ground"===u?q.staysOnTheGround:m===u||"on-the-ground"!==m&&"on-the-ground"!==u?b.SymbolUpdateType.UPDATE:q.onTheGroundChanged};b.evaluateElevationAlignmentAtPoint=f;b.needsElevationUpdates2D=function(q){return"relative-to-ground"===q||"relative-to-scene"===q};b.needsElevationUpdates3D=function(q){return"absolute-height"!==
q};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/maybe ../../../../geometry/Point ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/projection ../../../../chunks/mat4f64 ../../support/buffer/BufferView ../../webgl-engine/lib/Util ../../support/debugFlags ./graphicUtils ./elevationAlignmentUtils ../support/uvUtils".split(" "),function(b,k,a,r,l,h,d,c,e,f,
g,p,n,w){function q(t,D,E,G){t=t.stageObject;v.spatialReference=E.spatialReference;const H=t.geometryRecords,I=H.length,J="absolute-height"!==D.mode;let K=0;for(let O=0;O<I;O++){var L=H[O].geometry,S=H[O].getShaderTransformation();B[0]=S[12];B[1]=S[13];B[2]=S[14];L.invalidateBoundingInfo();S=L.data.getVertexAttr();var M=S[m.POSITION];L=M.data;S=S.mapPos.data;M=M.size;const Q=L.length/M;let F=0,N=0,P=!1,U=0;for(let V=0;V<Q;V++){v.x=S[N++];v.y=S[N++];v.z=S[N++];x[0]=L[F];x[1]=L[F+1];x[2]=L[F+2];var T=
n.evaluateElevationAlignmentAtPoint(v,E,D,G,J?A:null);J&&(U+=A.sampledElevation);y[0]=L[F]+B[0];y[1]=L[F+1]+B[1];y[2]=L[F+2]+B[2];G.setAltitude(T,y);L[F]=y[0]-B[0];L[F+1]=y[1]-B[1];L[F+2]=y[2]-B[2];if(g.TESTS_DISABLE_UPDATE_THRESHOLDS)P=!0;else if(T=.01/G.unitInMeters,Math.abs(x[0]-L[F])>=T||Math.abs(x[1]-L[F+1])>=T||Math.abs(x[2]-L[F+2])>=T)P=!0;F+=M}K+=U/Q;P&&t.geometryVertexAttrsUpdated(O)}return K/I}const m=f.VertexAttrConstants,u=c.create(),v=new a,y=r.create(),B=r.create(),x=r.create(),C=c.create(),
z=r.create(),A={verticalDistanceToGround:0,sampledElevation:0};b.iterativeUpdatesEnabled=!0;b.perLodInstanceElevationAligner=function(t,D,E,G){const H=t.graphics3DSymbolLayer.lodRenderer;if(k.isNone(H))return 0;const I=D.centerPointInElevationSR;let J=0,K=0;const L="absolute-height"!==D.mode;J=n.evaluateElevationAlignmentAtPoint(I,E,D,G,L?A:null);L&&(K=A.sampledElevation);D=H.instanceData;t=t.instanceIndex;D.getGlobalTransform(t,C);E=l.set(z,C[12],C[13],C[14]);g.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?
(y[0]=I.x,y[1]=I.y,y[2]=J,d.computeLinearTransformation(I.spatialReference,y,C,G.spatialReference)&&D.setGlobalTransform(t,C)):G.setAltitudeOfTransformation(J,C);G=.01/G.unitInMeters;(Math.abs(C[12]-E[0])>=G||Math.abs(C[13]-E[1])>=G||Math.abs(C[14]-E[2])>=G)&&D.setGlobalTransform(t,C);return K};b.perObjectElevationAligner=function(t,D,E,G){t=t.stageObject;const H=D.centerPointInElevationSR;let I=0,J=0;if(t.metadata.usesVerticalDistanceToGround)I=n.evaluateElevationAlignmentAtPoint(H,E,D,G,A),p.updateVertexAttributeAuxpos1w(t,
A.verticalDistanceToGround),J=A.sampledElevation;else{const K="absolute-height"!==D.mode;I=n.evaluateElevationAlignmentAtPoint(H,E,D,G,K?A:null);K&&(J=A.sampledElevation)}D=h.copy(u,t.objectTransformation);E=l.set(z,D[12],D[13],D[14]);g.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(y[0]=H.x,y[1]=H.y,y[2]=I,d.computeLinearTransformation(H.spatialReference,y,D,G.spatialReference)&&(t.objectTransformation=D)):G.setAltitudeOfTransformation(I,D);G=.01/G.unitInMeters;if(Math.abs(D[12]-E[0])>=G||Math.abs(D[13]-
E[1])>=G||Math.abs(D[14]-E[2])>=G)t.objectTransformation=D;return J};b.perVertexElevationAligner=q;b.updateThresholdInMeters=.01;b.uvElevationAligner=function(t,D,E,G){D=q(t,D,E,G);t=t.stageObject.geometryRecords;for(E=0;E<t.length;E++)if(w.requiresUVUpdates(t[E])){const H=t[E].geometry.data.getVertexAttr(),I=H[m.POSITION].data,J=H[m.BOUND1].data,K=H[m.BOUND2].data,L=H[m.BOUND3].data;w.createMapSpaceUVCoords(e.BufferViewVec4f.fromTypedArray(H[m.UVMAPSPACE].data),e.BufferViewVec3f64.fromTypedArray(I),
G,e.BufferViewVec3f64.fromTypedArray(J),e.BufferViewVec3f64.fromTypedArray(K),e.BufferViewVec3f64.fromTypedArray(L))}return D};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../geometry/SpatialReference ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../../support/buffer/BufferView ../../../../chunks/plane ../../webgl-engine/materials/PatternMaterial".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){function p(I,J,K,L,S,M,T){r.set(I,J*S[0]+K*M[0]+L*T[0],J*S[1]+K*M[1]+L*T[1],J*S[2]+K*M[2]+L*T[2])}const n=a.create(),w=a.create(),q=f.create(),m=a.create(),u=a.create(),v=a.create(),y=d.create(),B=d.create(),x=d.create(),C=a.create(),z=a.create(),A=a.create(),t=h.create(),D=a.create(),E=a.create(),G=a.create(),H=a.create();b.createMapSpaceUVCoords=function(I,J,K,L,S,M,T=1){r.set(m,1,0,0);r.set(u,0,1,0);r.set(v,0,0,1);r.set(H,0,0,0);for(var O=0;O<J.count-1;O++)J.getVec(O,
w),r.add(H,H,w);r.scale(n,H,1/(J.count-1));O=J.count-1;if(O=f.fromManyPointsSampleAt(J,q,0,Math.floor(O/3),Math.floor(2/3*O))){K.basisMatrixAtPosition(n,t);r.set(D,t[0],t[1],t[2]);r.set(E,t[4],t[5],t[6]);r.set(G,t[8],t[9],t[10]);K=f.normal(q);0>r.dot(K,G)&&r.scale(K,K,-1);r.copy(v,K);O=r.dot(K,E);var Q=r.dot(K,D);Math.abs(O)<Math.abs(Q)?(r.scaleAndAdd(m,D,K,-Q),r.normalize(m,m),r.cross(u,m,K),r.normalize(u,u),r.scale(u,u,-1)):(r.scaleAndAdd(u,E,K,-O),r.normalize(u,u),r.cross(m,u,K),r.normalize(m,
m))}c.set(y,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);c.set(B,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(K=0;K<J.count;K++)J.getVec(K,w),O=r.dot(m,w),Q=r.dot(u,w),y[0]=Math.min(y[0],O),y[1]=Math.min(y[1],Q),B[0]=Math.max(B[0],O),B[1]=Math.max(B[1],Q);K=r.dot(v,n);p(C,y[0],y[1],K,m,u,v);p(z,B[0],y[1],K,m,u,v);p(A,y[0],B[1],K,m,u,v);K=y[1]%T;x[0]=y[0]-y[0]%T;x[1]=y[1]-K;for(K=0;K<J.count;K++)J.getVec(K,w),I.setValues(K,(r.dot(m,w)-x[0])/T,(r.dot(u,w)-x[1])/T,x[0]/T,x[1]/T),L&&S&&
M&&(L.setVec(K,C),S.setVec(K,z),M.setVec(K,A))};b.createMapSpaceUVCoordsDraped=function(I,J,K,L=1){if(K.isGeographic){const S=new Float64Array(J.typedBuffer.length);l.projectBuffer(J.typedBuffer,K,0,S,k.WebMercator,0,J.count);J=e.BufferViewVec3f64.fromTypedArray(S);K=k.WebMercator}c.set(y,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(K=0;K<J.count;K++)J.getVec(K,w),y[0]=Math.min(y[0],w[0]),y[1]=Math.min(y[1],w[1]);K=y[1]%L;x[0]=y[0]-y[0]%L;x[1]=y[1]-K;for(K=0;K<J.count;K++)J.getVec(K,w),
I.setValues(K,(w[0]-x[0])/L,(w[1]-x[1])/L,x[0]/L,x[1]/L)};b.requiresUVUpdates=function(I){return I.material instanceof g.PatternMaterial&&!I.material.params.draped};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../lib/GLMaterial ./internal/MaterialUtil ../lib/Material ../lib/OrderIndependentTransparency ./internal/DefaultBufferWriter ../shaders/PatternTechnique".split(" "),
function(b,k,a,r,l,h,d,c){let e=function(p){function n(q,m){q=p.call(this,m,q,g)||this;q.supportsEdges=!0;q.techniqueConfig=new c.PatternTechniqueConfiguration;return q}k._inheritsLoose(n,p);var w=n.prototype;w.getTechniqueConfig=function(q,m){this.techniqueConfig.output=q;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.polygonOffset=this.params.polygonOffset;
this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.style=this.params.style;this.techniqueConfig.patternSpacing=this.params.patternSpacing;this.techniqueConfig.lineWidth=this.params.lineWidth;this.techniqueConfig.draped=this.params.draped;this.techniqueConfig.transparencyPassType=m?m.transparencyPassType:3;this.techniqueConfig.enableOffset=m?m.camera.relativeElevation<h.OITPolygonOffsetLimit:!0;return this.techniqueConfig};w.getPassParameters=function(){return this.params};
w.intersect=function(q,m,u,v,y,B,x){r.intersectTriangleGeometry(q,m,v,y,B,void 0,x)};w.getGLMaterial=function(q){return 0===q.output||7===q.output||4===q.output||1===q.output&&this.params.writeLinearDepth?new f(q):void 0};w.createBufferWriter=function(){return new d.DefaultBufferWriter(d.PositionColorMapSpaceUVBoundsLayout)};return n}(l.Material),f=function(p){function n(q){q=p.call(this,q)||this;q.updateParameters();return q}k._inheritsLoose(n,p);var w=n.prototype;w.updateParameters=function(q){this.technique=
this.techniqueRep.acquireAndReleaseExisting(c.PatternTechnique,this.material.getTechniqueConfig(this.output,q),this.technique)};w.beginSlot=function(q){return 4===this.output?3===q:q===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?5:8:3)};w._updateOccludeeState=function(q){q.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:q.hasOccludees})};w.ensureParameters=function(q){0!==this.output&&7!==this.output||this._updateOccludeeState(q);
this.updateParameters(q)};w.bind=function(q,m){q.bindProgram(this.technique.program);this.technique.bindPass(q,this.material.getPassParameters(),m)};w.getPipelineState=function(q,m){return this.technique.getPipelineState(m)};return n}(a);const g={color:[1,1,1,1],writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,style:2,patternSpacing:10,lineWidth:1,draped:!0,...l.materialParametersDefaults};b.PatternMaterial=e;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../lib/Util","./bufferWriterUtils"],function(b,k,a,r){const l=k.newLayout().vec3f(a.VertexAttrConstants.POSITION),h=k.newLayout().vec3f(a.VertexAttrConstants.POSITION).vec2f(a.VertexAttrConstants.UV0),d=k.newLayout().vec3f(a.VertexAttrConstants.POSITION).vec4u8(a.VertexAttrConstants.COLOR),c=k.newLayout().vec3f(a.VertexAttrConstants.POSITION).vec4u8(a.VertexAttrConstants.COLOR).vec4f(a.VertexAttrConstants.UVMAPSPACE).vec3f(a.VertexAttrConstants.MEANVERTEXPOSITION);
k=k.newLayout().vec3f(a.VertexAttrConstants.POSITION).vec4u8(a.VertexAttrConstants.COLOR).vec4f(a.VertexAttrConstants.UVMAPSPACE).vec3f(a.VertexAttrConstants.BOUND1).vec3f(a.VertexAttrConstants.BOUND2).vec3f(a.VertexAttrConstants.BOUND3);let e=function(){function f(p){this.vertexBufferLayout=p}var g=f.prototype;g.allocate=function(p){return this.vertexBufferLayout.createBuffer(p)};g.elementCount=function(p){return p.indices[a.VertexAttrConstants.POSITION].length};g.write=function(p,n,w,q){r.writeDefaultAttributes(n,
this.vertexBufferLayout,p.transformation,p.invTranspTransformation,w,q)};return f}();b.DefaultBufferWriter=e;b.PositionColorLayout=d;b.PositionColorMapSpaceUVBoundsLayout=k;b.PositionColorMapSpaceUVLayout=c;b.PositionLayout=l;b.PositionUVLayout=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../lib/OrderIndependentTransparency ../lib/StencilUtils ../../../../chunks/Pattern.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){h=function(v){function y(){return v.apply(this,arguments)||this}a._inheritsLoose(y,v);var B=y.prototype;B.initializeProgram=function(x){var C=y.shader.get();const z=this.configuration;C=C.build({output:z.output,attributeColor:z.vertexColors,slicePlaneEnabled:z.slicePlaneEnabled,sliceHighlightDisabled:z.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,style:z.style,patternSpacing:z.patternSpacing,lineWidth:z.lineWidth,draped:z.draped,OITEnabled:0===
z.transparencyPassType});return new e(x.rctx,C.generateSource("vertex"),C.generateSource("fragment"),c.Default3D)};B.bindPass=function(x,C,z){g.View.bindProjectionMatrix(this.program,z.camera.projectionMatrix);this.program.setUniform4fv("matColor",C.color);this.configuration.draped?(this.program.setUniform1f("worldToScreenRatio",1/z.screenToWorldRatioGlobalWM),this.program.setUniform1f("texelSize",1/z.camera.pixelRatio)):this.program.setUniform1f("worldToScreenPerDistanceRatio",1/z.camera.perScreenPixelRatio);
4===this.configuration.output&&n.OutputHighlight.bindOutputHighlight(x,this.program,z);1===this.configuration.output&&this.program.setUniform2fv("nearFar",z.camera.nearFar)};B.bindDraw=function(x){g.View.bindView(this.program,x);g.View.bindCamPosition(this.program,x.origin,x.camera.viewInverseTransposeMatrix);p.Slice.bindUniformsWithOrigin(this.program,this.configuration,x)};B.setPipelineState=function(x,C){const z=this.configuration,A=3===x,t=2===x;return f.makePipelineState({blending:0===z.output||
7===z.output?z.transparent&&A?w.blendingDefault:w.OITBlending(x):null,culling:(D=>0!==D&&{face:1===D?1028:1029,mode:2305})(z.cullFace),depthTest:{func:w.OITDepthTest(x)},depthWrite:A?z.writeDepth&&f.defaultDepthWriteParams:w.OITDepthWrite(x),colorWrite:f.defaultColorWriteParams,stencilWrite:z.sceneHasOcludees?q.stencilWriteMaskOn:null,stencilTest:z.sceneHasOcludees?C?q.stencilToolMaskBaseParams:q.stencilBaseAllZerosParams:null,polygonOffset:A||t?z.polygonOffset&&u:w.getOITPolygonOffset(z.enableOffset)})};
B.initializePipeline=function(){this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,!1)};B.getPipelineState=function(x){return x?this._occludeePipelineState:this.pipeline};return y}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(m.PatternShader,()=>new Promise(function(v,y){b(["./Pattern.glsl"],v,y)}));const u={factor:1,units:1};l=function(v){function y(){var B=v.apply(this,arguments)||
this;B.output=0;B.cullFace=0;B.slicePlaneEnabled=!1;B.sliceHighlightDisabled=!1;B.vertexColors=!1;B.transparent=!0;B.polygonOffset=!1;B.writeDepth=!0;B.sceneHasOcludees=!1;B.enableOffset=!0;B.transparencyPassType=3;return B}a._inheritsLoose(y,v);return y}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter({count:8})],l.prototype,"output",void 0);r.__decorate([d.parameter({count:3})],l.prototype,"cullFace",void 0);r.__decorate([d.parameter()],l.prototype,"slicePlaneEnabled",void 0);r.__decorate([d.parameter()],
l.prototype,"sliceHighlightDisabled",void 0);r.__decorate([d.parameter()],l.prototype,"vertexColors",void 0);r.__decorate([d.parameter()],l.prototype,"transparent",void 0);r.__decorate([d.parameter()],l.prototype,"polygonOffset",void 0);r.__decorate([d.parameter()],l.prototype,"writeDepth",void 0);r.__decorate([d.parameter()],l.prototype,"sceneHasOcludees",void 0);r.__decorate([d.parameter({count:6})],l.prototype,"style",void 0);r.__decorate([d.parameter()],l.prototype,"patternSpacing",void 0);r.__decorate([d.parameter()],
l.prototype,"lineWidth",void 0);r.__decorate([d.parameter()],l.prototype,"enableOffset",void 0);r.__decorate([d.parameter()],l.prototype,"draped",void 0);r.__decorate([d.parameter({count:4})],l.prototype,"transparencyPassType",void 0);k.PatternTechnique=h;k.PatternTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports"],function(b){b.depthCompareAlways={func:519};b.depthCompareLess={func:513};b.renderWhenBitIsNotSet=
k=>({function:{func:517,ref:k,mask:k},operation:{fail:7680,zFail:7680,zPass:7680}});b.replaceBitWhenDepthTestPasses=k=>({function:{func:519,ref:k,mask:k},operation:{fail:7680,zFail:7680,zPass:7681}});b.stencilBaseAllZerosParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:0}};b.stencilToolMaskBaseParams={function:{func:519,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7681}};b.stencilToolMaskOccluderParams={function:{func:514,ref:2,mask:2},operation:{fail:7680,zFail:7680,
zPass:7680}};b.stencilToolTransparentOccluderParams={function:{func:517,ref:2,mask:2},operation:{fail:7680,zFail:7680,zPass:7680}};b.stencilWriteMaskOff={mask:0};b.stencilWriteMaskOn={mask:255};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f){function g(w){const q=new r.ShaderBuilder;w.draped||q.extensions.add("GL_OES_standard_derivatives");const m=1===w.output;q.include(a.Transform,{linearDepth:m});q.include(e.VertexColor,w);q.vertex.uniforms.add("proj","mat4");q.vertex.uniforms.add("view","mat4");m&&(q.include(f.OutputDepth,w),q.vertex.uniforms.add("nearFar","vec2"),q.varyings.add("linearDepth","float"));w.draped?q.vertex.uniforms.add("worldToScreenRatio","float"):(q.vertex.uniforms.add("worldToScreenPerDistanceRatio",
"float"),q.vertex.uniforms.add("camPos","vec3"),q.attributes.add("bound1","vec3"),q.attributes.add("bound2","vec3"),q.attributes.add("bound3","vec3"));q.attributes.add("position","vec3");q.attributes.add("uvMapSpace","vec4");q.varyings.add("vpos","vec3");q.varyings.add("vuv","vec2");const u=3===w.style||4===w.style||5===w.style;u&&q.vertex.code.add(k.glsl`
      const mat2 rotate45 = mat2(${k.glsl.float(.70710678118)}, ${k.glsl.float(-.70710678118)},
                                 ${k.glsl.float(.70710678118)}, ${k.glsl.float(.70710678118)});
    `);w.draped||(q.vertex.code.add(k.glsl`
      vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
        float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
        return center + halfVector * clamp(projectedLength, -1.0, 1.0);
      }
    `),q.vertex.code.add(k.glsl`
      vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
        float d = dot(planeNormal, planePoint);
        float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);

        return rayOrigin + t * rayDir;
      }
    `),q.vertex.code.add(k.glsl`
      float boundingRectDistanceToCamera() {
        vec3 halfU = (bound2 - bound1) * 0.5;
        vec3 halfV = (bound3 - bound1) * 0.5;
        vec3 center = bound1 + halfU + halfV;
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${k.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, camPos, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - camPos);
      }
    `));q.vertex.code.add(k.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${u?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${u?" * rotate45":""};

      ${w.draped?k.glsl`
            float ratio = worldToScreenRatio;
          `:k.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float ratio = worldToScreenPerDistanceRatio / distanceToCamera;

            // Logarithmically discretize ratio to avoid jittering
            float step = 0.1;
            ratio = log(ratio);
            ratio = ceil(ratio / step) * step;
            ratio = exp(ratio);
          `}

      vec2 uvOffset = mod(uvCellOrigin * ratio, ${k.glsl.float(w.patternSpacing)});
      return uvOffset + (uv * ratio);
    }
  `);q.vertex.code.add(k.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      forwardNormalizedVertexColor();
      gl_Position = ${m?k.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:k.glsl`transformPosition(proj, view, vpos);`}
    }
  `);q.include(h.Slice,w);q.fragment.include(l.ColorConversion);q.fragment.uniforms.add("matColor","vec4");w.draped&&q.fragment.uniforms.add("texelSize","float");4===w.output&&q.include(d.OutputHighlight);4!==w.output&&(q.fragment.code.add(k.glsl`
      const float lineWidth = ${k.glsl.float(w.lineWidth)};
      const float spacing = ${k.glsl.float(w.patternSpacing)};
      const float spacingINV = ${k.glsl.float(1/w.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),w.draped||q.fragment.code.add(k.glsl`
        const int maxSamples = 5;

        float sample(float p) {
          vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
          float fwidth = dxdy.x + dxdy.y;

          ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
          vec2 invSamples = 1.0 / vec2(samples);

          float accumulator = 0.0;

          for (int j = 0; j < maxSamples; j++) {
            if(j >= samples.y) {
              break;
            }

            for (int i = 0; i < maxSamples; i++) {
              if(i >= samples.x) {
                break;
              }

              vec2 step = vec2(i,j) * invSamples - 0.5;
              accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
            }
          }

          accumulator /= float(samples.x * samples.y);
          return accumulator;
        }
      `));q.fragment.code.add(k.glsl`
    void main() {
      discardBySlice(vpos);
      vec4 color = ${w.attributeColor?"vColor * matColor;":"matColor;"}
      color = highlightSlice(color, vpos);

      ${4!==w.output?k.glsl`color.a *= ${p(w)};`:""}

      if (color.a < ${k.glsl.float(c.symbolAlphaCutoff)}) {
        discard;
      }

      ${7===w.output?k.glsl`gl_FragColor = vec4(color.a);`:""}

      ${0===w.output?k.glsl`gl_FragColor = color; ${w.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
      ${4===w.output?k.glsl`outputHighlight();`:""}
      ${1===w.output?k.glsl`outputDepth(linearDepth);`:""};
    }
  `);return q}function p(w){function q(m){return w.draped?k.glsl`coverage(vuv.${m}, texelSize)`:k.glsl`sample(vuv.${m})`}switch(w.style){case 3:case 0:return q("y");case 4:case 1:return q("x");case 5:case 2:return k.glsl`
        1.0 - (1.0 - ${q("x")}) * (1.0 - ${q("y")})
      `;default:return"0.0"}}var n=Object.freeze({__proto__:null,build:g});b.PatternShader=n;b.build=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.VertexColor=function(a,r){r.attributeColor?(a.attributes.add("color","vec4"),a.varyings.add("vColor","vec4"),a.vertex.code.add(k.glsl`
      void forwardVertexColor() { vColor = color; }
    `),a.vertex.code.add(k.glsl`
      void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }
    `)):a.vertex.code.add(k.glsl`
      void forwardVertexColor() {}
      void forwardNormalizedVertexColor() {}
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../../shaderModules/interfaces","../util/RgbaFloatEncoding.glsl"],function(b,k,a){b.OutputDepth=function(r,l){r.fragment.include(a.RgbaFloatEncoding);3===l.output?(r.extensions.add("GL_OES_standard_derivatives"),r.fragment.code.add(k.glsl`
      float _calculateFragDepth(const in float depth) {
        // calc polygon offset
        const float SLOPE_SCALE = 2.0;
        const float BIAS = 2.0 * .000015259;    // 1 / (2^16 - 1)
        float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
        float result = depth + SLOPE_SCALE * m + BIAS;
        return clamp(result, .0, .999999);
      }

      void outputDepth(float _linearDepth) {
        gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
      }
    `)):1===l.output&&r.fragment.code.add(k.glsl`
      void outputDepth(float _linearDepth) {
        gl_FragColor = float2rgba(_linearDepth);
      }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(b,k,a,r,l){let h=function(){function d(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=
null}var c=d.prototype;c.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};c.addOffsetRenderUnits=function(e){this._renderUnitOffset+=e};c.geometryZWithOffset=function(e,f){f=this.calculateOffsetRenderUnits(f);return null!=this.featureExpressionInfoContext?f:e+f};c.calculateOffsetRenderUnits=function(e){let f=this._meterUnitOffset;const g=this.featureExpressionInfoContext;null!=g&&(f+=l.execute(g)*this._metersPerElevationInfoUnit);
return f/e.unitInMeters+this._renderUnitOffset};c.setFromElevationInfo=function(e){this.mode=e.mode;this.unit=r.supportsUnit(e.unit)?e.unit:"meters";this.offsetElevationInfoUnits=a.unwrapOr(e.offset,0)};c.updateFeatureExpressionInfoContext=function(e,f,g){if(a.isNone(e))this._featureExpressionInfoContext=null;else{var p=e&&e.arcade;p&&a.isSome(f)&&a.isSome(g)?(this._featureExpressionInfoContext=l.clone(e),l.setContextFeature(this._featureExpressionInfoContext,l.createFeature(p.modules,f,g))):this._featureExpressionInfoContext=
e}};d.fromElevationInfo=function(e){const f=new d;a.isSome(e)&&f.setFromElevationInfo(e);return f};k._createClass(d,[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e;this._metersPerElevationInfoUnit=r.getMetersPerUnit(e)}},{key:"offsetMeters",set:function(e){this._meterUnitOffset=e;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",
set:function(e){this._meterUnitOffset=e*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}}]);return d}();b.ElevationContext=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../core/Logger","../../../../support/arcadeOnDemand","../../../../layers/graphics/hydratedFeatures"],function(b,k,a,r){const l=k.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");b.clone=function(h){return{cachedResult:h.cachedResult,
arcade:h.arcade?{func:h.arcade.func,context:h.arcade.modules.arcadeUtils.createExecContext(null,{sr:h.arcade.context.spatialReference}),modules:h.arcade.modules}:null}};b.createContext=async function(h,d,c){h=h&&h.expression;if("string"!==typeof h)return null;var e="0"===h?0:null;if(null!=e)return{cachedResult:e};e=await a.loadArcade();const f=e.arcadeUtils;h=f.createSyntaxTree(h);return f.dependsOnView(h)?(null!=c&&c.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):
{arcade:{func:f.createFunction(h),context:f.createExecContext(null,{sr:d}),modules:e}}};b.createContextWithoutExpressionSupport=function(h){h=h&&h.expression;return"string"===typeof h&&(h="0"===h?0:null,null!=h)?{cachedResult:h}:null};b.createFeature=function(h,d,c){return h.arcadeUtils.createFeature(d.attributes,d.geometry,c)};b.execute=function(h){if(null!=h){if(null!=h.cachedResult)return h.cachedResult;var d=h.arcade;d=h.arcade.modules.arcadeUtils.executeFunction(d.func,d.context);"number"!==
typeof d&&(d=h.cachedResult=0);return d}return 0};b.extractExpressionInfo=function(h,d=!1){const c=(h=h&&h.featureExpressionInfo)&&h.expression;d||"0"===c||(h=null);return h};b.setContextFeature=function(h,d){null!=h&&null==h.cachedResult&&(d&&h.arcade?(d._geometry&&(d._geometry=r.hydrateGeometry(d._geometry)),h.arcade.modules.arcadeUtils.updateExecContext(h.arcade.context,d)):l.errorOncePerTick("Arcade support required but not provided"))};b.zeroContext={cachedResult:0};Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/support/aaBoundingBox ./graphicUtils ./featureExpressionInfoUtils".split(" "),function(b,k,a,r,l,h,d){function c(w){return w.isVisible?w.params.transparent?1:2:0}let e=function(){function w(m,u,v,y,B,x,C,z=null){this.uniqueGeometries=v;this.uniqueMaterials=y;this.uniqueTextures=
B;this.elevationAligner=x;this.elevationContext=C;this._edgeState=z;this.type="object3d";this.stage=this.stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=m;this.stageObject=u}var q=w.prototype;q.initialize=function(m,u){this.stageLayer=u;this.stage=m;if(this.uniqueMaterials)for(u=0;u<this.uniqueMaterials.length;u++)m.add(3,this.uniqueMaterials[u]);if(this.uniqueGeometries)for(u=0;u<this.uniqueGeometries.length;u++)m.add(2,
this.uniqueGeometries[u]);if(this.uniqueTextures)for(u=0;u<this.uniqueTextures.length;u++)m.add(4,this.uniqueTextures[u]);m.add(1,this.stageObject)};q.layerOpacityChanged=function(m,u){if(!k.isNone(this._edgeState)){var v=c(this._edgeState.baseMaterial),y=!1;for(const B of this._edgeState.edgeMaterials)B.objectTransparency!==v&&(B.objectTransparency=v,y=!0);y&&this.resetEdgeObject(u);this.stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[m])}};q.slicePlaneEnabledChanged=
function(m,u){k.isNone(this._edgeState)||(this.stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{slicePlaneEnabled:m},!u),this._edgeState.properties.slicePlaneEnabled=m)};q.setVisibility=function(m){if(null!=this.stage&&this._visible!==m&&((this._visible=m)?this._addedToStage?this.stageObject.setVisible(!0):(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.stageObject.setVisible(!1),k.isSome(this._edgeState))){const u=
this.stage.renderView.ensureEdgeView();u.hasObject(this.stageObject)?u.updateObjectVisibility(this.stageObject,m):m&&this.addOrUpdateEdgeObject(u,!1)}};q.destroy=function(){var m=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var u=0;u<this.uniqueMaterials.length;u++)m.remove(3,this.uniqueMaterials[u].id);if(this.uniqueGeometries)for(u=0;u<this.uniqueGeometries.length;u++)m.remove(2,this.uniqueGeometries[u].id);if(this.uniqueTextures)for(u=0;u<this.uniqueTextures.length;u++)m.remove(4,
this.uniqueTextures[u].id)}m.remove(1,this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);m=this.stage.renderView.ensureEdgeView();m.hasObject(this.stageObject)&&m.removeObject(this.stageObject);this.stageObject.dispose();this._visible=!1;this.stage=this.stageLayer=null};q.alignWithElevation=function(m,u,v,y){null!=this.elevationAligner&&(k.isSome(v)&&d.setContextFeature(this.elevationContext.featureExpressionInfoContext,v),m=this.elevationAligner(this,
this.elevationContext,m,u),null!=m&&(this.alignedSampledElevation=m),this.resetEdgeObject(y))};q.getBSRadius=function(){return this.stageObject.getBSRadius()};q.getCenterObjectSpace=function(m=a.create()){return r.copy(m,this.stageObject.getCenter(!0))};q.getBoundingBoxObjectSpace=function(m=l.create()){var u=this.stageObject;m||(m=l.create());l.setMin(m,u.getBBMin(!0));l.setMax(m,u.getBBMax(!0));return m};q.computeAttachmentOrigin=function(m){for(const u of this.stageObject.geometryRecords)u.computeAttachmentOrigin(p)&&
(r.transformMat4(p,p,this.stageObject.objectTransformation),r.add(m.render.origin,m.render.origin,p),m.render.num++)};q.getProjectedBoundingBox=async function(m,u,v,y,B){B=this.getBoundingBoxObjectSpace(B);var x=n;const C=l.isPoint(B)?1:x.length;for(var z=0;z<C;z++){const A=x[z];g[0]=B[A[0]];g[1]=B[A[1]];g[2]=B[A[2]];r.transformMat4(g,g,this.stageObject.objectTransformation);f[3*z]=g[0];f[3*z+1]=g[1];f[3*z+2]=g[2]}if(!m(f,0,C))return null;l.empty(B);m=null;this.calculateRelativeScreenBounds&&(m=this.calculateRelativeScreenBounds());
for(x=0;x<3*C;x+=3){for(z=0;3>z;z++)B[z]=Math.min(B[z],f[x+z]),B[z+3]=Math.max(B[z+3],f[x+z]);m&&v.push({location:f.slice(x,x+3),screenSpaceBoundingRect:m})}if(u&&u.service&&"absolute-height"!==this.elevationContext.mode){l.center(B,p);v="relative-to-scene"===this.elevationContext.mode?"scene":"ground";let A;if(u.useViewElevation)A=u.service.getElevation(p[0],p[1],v);else try{const t=h.demResolutionForBoundingBox(B,u);A=await u.service.queryElevation(p[0],p[1],y,t,v)}catch(t){A=null}l.offset(B,0,
0,-this.alignedSampledElevation+A)}return B};q.addObjectState=function(m,u){0===m&&u.addObject(this.stageObject,this.stageObject.highlight());1===m&&u.addObject(this.stageObject,this.stageObject.maskOccludee())};q.removeObjectState=function(m){m.removeObject(this.stageObject)};q.resetEdgeObject=function(m){if(!k.isNone(this._edgeState)){var u=this.stage.renderView.ensureEdgeView();this._visible?this.addOrUpdateEdgeObject(u,m):u.removeObject(this.stageObject)}};q.addOrUpdateEdgeObject=function(m,u){const v=
this._edgeState;if(!k.isNone(v)){var y=c(v.baseMaterial);for(const B of v.edgeMaterials)B.objectTransparency=y;m.addOrUpdateObject3D(this.stageObject,v.edgeMaterials,v.properties,!u)}};b._createClass(w,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"visible",get:function(){return this._visible}}]);return w}();(function(w){w=w.VisibilityModes||(w.VisibilityModes={});w[w.REMOVE_OBJECT=0]="REMOVE_OBJECT";w[w.HIDE_FACERANGE=
1]="HIDE_FACERANGE"})(e||(e={}));const f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=a.create(),p=a.create(),n=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return e})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./geometryDataUtils ./Util ./IdGen ./BoundingInfo".split(" "),function(b,k,a,r,l,h){let d=function(){function c(f,g){this._boundingInfo=null;this._id=c.__idGen.gen(g);this._data=
f}var e=c.prototype;e.getIndices=function(f){return this.data.getIndices(f)};e.getAttribute=function(f){return this.data.getAttribute(f)};e.computeAttachmentOrigin=function(f){return"triangle"===this.data.primitiveType?this.computeAttachmentOriginTriangles(f):this.computeAttachmentOriginPoints(f)};e.computeAttachmentOriginTriangles=function(f){const g=this.getIndices(r.VertexAttrConstants.POSITION),p=this.getAttribute(r.VertexAttrConstants.POSITION);return a.computeAttachmentOriginTriangles(p,g,f)};
e.computeAttachmentOriginPoints=function(f){const g=this.getIndices(r.VertexAttrConstants.POSITION),p=this.getAttribute(r.VertexAttrConstants.POSITION);return a.computeAttachmentOriginPoints(p,g,f)};e.invalidateBoundingInfo=function(){this._boundingInfo=null};e._calculateBoundingInfo=function(){let f=this.data.getIndices(r.VertexAttrConstants.POSITION);const g=this.data.getAttribute(r.VertexAttrConstants.POSITION),p="triangle"===this.data.primitiveType?3:1;if(0===f.length){f=new Uint32Array(p);for(var n=
0;n<p;++n)f[n]=n}n=f.length;r.assert(0===n%p,"Indexing error: "+n.toFixed(0)+" not divisible by "+p.toFixed(0));n=a.generateDefaultIndexArray(n/p);return new h(n,p,f,g)};b._createClass(c,[{key:"id",get:function(){return this._id}},{key:"data",get:function(){return this._data}},{key:"indexCount",get:function(){return this.data.indexCount}},{key:"vertexCount",get:function(){return this.data.indexCount}},{key:"faceCount",get:function(){return this.data.indexCount/3}},{key:"boundingInfo",get:function(){k.isNone(this._boundingInfo)&&
(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}}]);return c}();d.__idGen=new l.IdGen;return d})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["../../../../core/PooledArray","../../../../chunks/vec3f64","../../../../chunks/vec3","./Util"],function(b,k,a,r){let l=function(){function h(c,e,f,g){this.primitiveIndices=c;this._numIndexPerPrimitive=e;this.indices=f;this._position=g;this.center=k.create();r.assert(1<=c.length);r.assert(0===f.length%this._numIndexPerPrimitive);
r.assert(f.length>=c.length*this._numIndexPerPrimitive);r.assert(3===this._position.size||4===this._position.size);const {data:p,offsetIdx:n,strideIdx:w}=this._position;e=0;var q=c.length;g=n+w*f[this._numIndexPerPrimitive*c[e]];h.tmpIndices.clear();h.tmpIndices.push(g);this.bbMin=k.fromValues(p[g],p[g+1],p[g+2]);for(this.bbMax=k.clone(this.bbMin);e<q;++e){var m=this._numIndexPerPrimitive*c[e];for(var u=0;u<this._numIndexPerPrimitive;++u){g=n+w*f[m+u];h.tmpIndices.push(g);let v=p[g];this.bbMin[0]=
Math.min(v,this.bbMin[0]);this.bbMax[0]=Math.max(v,this.bbMax[0]);v=p[g+1];this.bbMin[1]=Math.min(v,this.bbMin[1]);this.bbMax[1]=Math.max(v,this.bbMax[1]);v=p[g+2];this.bbMin[2]=Math.min(v,this.bbMin[2]);this.bbMax[2]=Math.max(v,this.bbMax[2])}}a.lerp(this.center,this.bbMin,this.bbMax,.5);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-this.bbMin[2]);c=this.bsRadius*this.bsRadius;for(e=0;e<h.tmpIndices.length;++e)g=h.tmpIndices.data[e],f=p[g]-
this.center[0],q=p[g+1]-this.center[1],g=p[g+2]-this.center[2],m=f*f+q*q+g*g,m<=c||(m=Math.sqrt(m),u=.5*(m-this.bsRadius),this.bsRadius+=u,c=this.bsRadius*this.bsRadius,m=u/m,this.center[0]+=f*m,this.center[1]+=q*m,this.center[2]+=g*m);h.tmpIndices.clear()}var d=h.prototype;d.getCenter=function(){return this.center};d.getBSRadius=function(){return this.bsRadius};d.getBBMin=function(){return this.bbMin};d.getBBMax=function(){return this.bbMax};d.getPrimitiveIndices=function(){return this.primitiveIndices};
d.getIndices=function(){return this.indices};d.getPosition=function(){return this._position};d.getChildren=function(){if(this._children)return this._children;if(1<a.squaredDistance(this.bbMin,this.bbMax)){var c=a.lerp(k.create(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length;const n=new Uint8Array(e),w=Array(8);for(var f=0;8>f;++f)w[f]=0;const {data:q,offsetIdx:m,strideIdx:u}=this._position;for(f=0;f<e;++f){var g=0;const v=this._numIndexPerPrimitive*this.primitiveIndices[f];var p=m+u*this.indices[v];
let y=q[p],B=q[p+1],x=q[p+2];for(let C=1;C<this._numIndexPerPrimitive;++C){p=m+u*this.indices[v+C];const z=q[p],A=q[p+1];p=q[p+2];z<y&&(y=z);A<B&&(B=A);p<x&&(x=p)}y<c[0]&&(g|=1);B<c[1]&&(g|=2);x<c[2]&&(g|=4);n[f]=g;++w[g]}c=0;for(f=0;8>f;++f)0<w[f]&&++c;if(2>c)return;c=Array(8);for(f=0;8>f;++f)c[f]=0<w[f]?new Uint32Array(w[f]):void 0;for(f=0;8>f;++f)w[f]=0;for(f=0;f<e;++f)g=n[f],c[g][w[g]++]=this.primitiveIndices[f];this._children=Array(8);for(e=0;8>e;++e)void 0!==c[e]&&(this._children[e]=new h(c[e],
this._numIndexPerPrimitive,this.indices,this._position))}return this._children};return h}();(l||(l={})).tmpIndices=new b({deallocator:null});return l})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ../../webgl-engine/lib/Util ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/lodRendering/LodResources".split(" "),function(b,k,a,r,l,h,d,
c){function e(m){let u=0,v=0,y=0,B=!1,x=0;const C={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const z of m)a.isNone(z)||(u+=z.primitivesPerFeature,v+=z.primitivesPerCoordinate,y+=z.drawCallsPerFeature,C.bytesPerFeature+=z.memory.bytesPerFeature,C.bytesPerFeatureLabel+=z.memory.bytesPerFeatureLabel,C.bytesPerCoordinate+=z.memory.bytesPerCoordinate,C.draped.bytesPerFeature+=z.memory.bytesPerFeature,C.draped.bytesPerFeatureLabel+=
z.memory.bytesPerFeatureLabel,C.draped.bytesPerCoordinate+=z.memory.bytesPerCoordinate,B=B||z.estimated,++x);return{primitivesPerFeature:u,primitivesPerCoordinate:v,drawCallsPerFeature:y,estimated:B,memory:C,numComplexities:x}}function f(m,u){const v=g(m,u);var y=d.hasEdges(u)?2:0;switch(u.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:y,estimated:!1,memory:v};case "fill":return"mesh-3d"===m.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,
drawCallsPerFeature:y,estimated:!1,memory:v}:a.isSome(u.outline)&&0<u.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:v}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:v};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:v};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:v};
case "object":return u.resource&&u.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:v}:{...p(u.resource&&u.resource.primitive||r.defaultPrimitive),memory:v};case "path":{var B=m=0;switch(u.profile){case "circle":m=10;break;case "quad":m=4;break;default:k.neverReached(u.profile);return}switch(u.join){case "round":B=3;break;case "miter":case "bevel":B=1;break;default:k.neverReached(u.join);return}y=2*m;B=m*B*2;let x=-2*B-y;switch(u.cap){case "none":break;
case "butt":case "square":x+=2*(m-1);break;case "round":x+=2*(4*m+m);break;default:k.neverReached(u.cap);return}return{primitivesPerFeature:x,primitivesPerCoordinate:B+y,drawCallsPerFeature:0,estimated:!1,memory:v}}case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:v}}}function g(m,u){m="point-3d"===m.type;switch(u.type){case "extrude":return u.edges&&0<u.edges.size?q.EXTRUDE_EDGES:q.EXTRUDE;case "fill":return a.isSome(u.outline)&&
0<u.outline.size?q.FILL_OUTLINE:q.FILL;case "water":return q.FILL;case "line":return"round"===u.join?q.LINE_ROUND:q.LINE_MITER;case "path":switch(u.join){case "round":switch(u.profile){case "circle":return q.PATH_ROUND_CIRCLE;case "quad":return q.PATH_ROUND_QUAD;default:k.neverReached(u.profile);return}case "miter":case "bevel":switch(u.profile){case "circle":return q.PATH_MITER_CIRCLE;case "quad":return q.PATH_MITER_QUAD;default:k.neverReached(u.profile);return}default:k.neverReached(u.join);return}case "object":return m?
q.OBJECT_POINT:q.OBJECT_POLYGON;case "icon":case "text":return m?q.ICON_POINT:q.ICON_POLYGON}}function p(m){var u=w[m];if(u)return u;u=h.primitiveLodResources(m,null,null);u={primitivesPerFeature:c.geometriesFromLodLevelResources(u.levels[0]).reduce((v,y)=>v+y.data.getIndices(l.VertexAttrConstants.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};return w[m]=u}const n={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,
bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},w={},q={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,
bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},
LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,
bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,
draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,
bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,
bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312}}};b.averageSymbolComplexities=function(m){m=e(m);0<m.numComplexities&&(m.primitivesPerFeature/=m.numComplexities,m.primitivesPerCoordinate/=m.numComplexities,m.drawCallsPerFeature/=m.numComplexities,m.memory.bytesPerFeature/=
m.numComplexities,m.memory.bytesPerFeatureLabel/=m.numComplexities,m.memory.bytesPerCoordinate/=m.numComplexities,m.memory.draped.bytesPerFeature/=m.numComplexities,m.memory.draped.bytesPerFeatureLabel/=m.numComplexities,m.memory.draped.bytesPerCoordinate/=m.numComplexities);return m};b.defaultSymbolComplexity=function(m){if("web-style"===m.type)return n;const u=m.symbolLayers.toArray().map(v=>f(m,v));return e(u)};b.defaultSymbolLayerComplexity=f;b.defaultSymbolLayerMemoryComplexity=g;b.emptySymbolComplexity=
n;b.memoryEstimators=q;b.totalSymbolComplexities=e;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/Geometry"],function(b,k,a,r){const l=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];b.isValidPrimitive=function(h){switch(h){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};
b.primitiveGeometryData=function(h){switch(h){case "sphere":return a.createPolySphereGeometry(.5,2,!0);case "cube":return a.createBoxGeometry(1);case "cylinder":return a.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return a.cgToGIS(a.createConeGeometry(1,.5,15,!1));case "inverted-cone":return a.cgToGIS(a.createConeGeometry(1,.5,15,!0));case "tetrahedron":return a.cgToGIS(a.createTetrahedronGeometry(1));case "diamond":return a.cgToGIS(a.createDiamondGeometry(1))}};b.primitiveLodResources=
function(h,d,c){const e=(f,g,p=!1)=>({levels:f.map((n,w)=>{const q=g(n.tesselation);p&&a.cgToGIS(q);return{components:[{geometry:new r(q,c+`_lod${w}`),material:d}],faceCount:q.indexCount/3,minScreenSpaceRadius:n.minScreenSpaceRadius}})});switch(h){case "sphere":return e([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],f=>a.createPolySphereGeometry(.5,
f,!0));case "cube":return e([{tesselation:0,minScreenSpaceRadius:0}],()=>a.createBoxGeometry(1));case "cone":return e(l,f=>a.createConeGeometry(1,.5,f,!1),!0);case "inverted-cone":return e(l,f=>a.createConeGeometry(1,.5,f,!0),!0);case "cylinder":return e(l,f=>a.createCylinderGeometry(1,.5,f,[0,0,1],[0,0,.5]));case "tetrahedron":return e([{tesselation:0,minScreenSpaceRadius:0}],()=>a.createTetrahedronGeometry(1),!0);case "diamond":return e([{tesselation:0,minScreenSpaceRadius:0}],()=>a.createDiamondGeometry(1),
!0)}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../Color ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils".split(" "),function(b,k,a,r,l,h,d){function c(p,n){if(a.isNone(p))return null;const w=a.isSome(p.color)?h.fromArray(r.toUnitRGBA(p.color)):h.fromValues(0,0,0,0),q=l.pt2px(p.size),m=l.pt2px(p.extensionLength);switch(p.type){case "solid":return e({color:w,
size:q,extensionLength:m,...n});case "sketch":return{...g,color:w,size:q,extensionLength:m,...n,type:"sketch"}}}function e(p){return{...f,...p,type:"solid"}}const f={color:h.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2},g={color:h.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:2};b.createMaterial=function(p,n){return c(p&&p.enabled&&p.edges||null,n)};b.createMaterialFromEdges=c;b.createSolidEdgeMaterial=e;b.hasEdges=function(p){return p&&
p.enabled&&(d.isExtrudeSymbol3DLayer(p)||d.isFillSymbol3DLayer(p))&&a.isSome(p.edges)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],function(b){b.isExtrudeSymbol3DLayer=function(k){return"extrude"===k.type};b.isFillSymbol3DLayer=function(k){return"fill"===k.type};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils"],
function(b,k){function a(r){const l=[];r.components.forEach(h=>{l.push(h.geometry)});return k.unique(l)}b.computeFaceCount=function(r){let l=0;a(r).forEach(h=>{l+=h.data.indexCount/3});return l};b.geometriesFromLodLevelResources=a;b.geometriesFromLodResources=function(r){const l=[];r.levels.forEach(h=>{h.components.forEach(d=>{l.push(d.geometry)})});return k.unique(l)};b.materialsFromLodResources=function(r){const l=[];r.levels.forEach(h=>{h.components.forEach(d=>{l.push(d.material)})});return k.unique(l)};
b.texturesFromLodResources=function(r){const l=[];r.levels.forEach(h=>{h.components.forEach(d=>{d.textures&&l.push(...d.textures)})});return k.unique(l)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/mathUtils ../../../../Color ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./graphicUtils ./elevationAlignmentUtils ./featureExpressionInfoUtils ./ElevationContext ./Loadable ./symbolComplexity".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){function m(x,C){x=null!=x?C.attributes[x]:0;return null!=x&&isFinite(x)?x:0}const u=l.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");a=function(x){function C(A,t,D,E){var G=x.call(this)||this;G._elevationInfoOverride=null;G.complexity=null;G.logger=u;G._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};G.symbol=A;G.symbolLayer=t;G._context=D;G._renderPriority=E.renderPriority;G._renderPriorityStep=E.renderPriorityStep;G._elevationContext=
new n.ElevationContext;G.complexity=G.computeComplexity();G._updateDrivenProperties(E.ignoreDrivers);G._updateElevationContext();return G}k._inheritsLoose(C,x);var z=C.prototype;z.getCachedSize=function(){return null};z._logGeometryCreationWarnings=function(A,t,D,E){const G="polygons"in A?A.polygons:null;E=`${E} geometry failed to be created`;let H=null;A.projectionSuccess?!t.length||1===t.length&&!t[0].length?H=`${E} (no ${D} were defined)`:Array.isArray(t)&&Array.isArray(t[0])?G&&0===G.length&&
"rings"===D&&0<t.length&&2<t[0].length&&(H=`${E} (filled rings should use clockwise winding - try reversing the order of vertices)`):H=`${E} (${D} should be defined as a 2D array)`:H=`${E} (failed to project geometry to view spatial reference)`;H&&u.warnOncePerTick(H)};z._validateGeometryType=function(A,t,D){if(t.includes(A.type))return!0;this.logger.warn("unsupported geometry type for "+D+` symbol: ${A.type}`);return!1};z._validateGeometry=function(A){return"point"!==A.type||h.isFinite(A.x)&&h.isFinite(A.y)?
!0:(u.warn("point coordinate is not a valid number, graphic skipped"),!1)};z._defaultElevationInfoNoZ=function(){return v};z._defaultElevationInfoZ=function(){return y};z._updateElevationContext=function(){r.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):
this._elevationContext.reset()};z.getDefaultElevationInfo=function(A){return A.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};z.getGeometryElevationMode=function(A,t=this.getDefaultElevationInfo(A)){return this._elevationContext.mode||t.mode};z.setElevationInfoOverride=function(A){this._elevationInfoOverride=A;this._updateElevationContext()};z.setGraphicElevationContext=function(A,t){var D=r.unwrap(A.geometry);const E=this.getDefaultElevationInfo(D);t.unit=null!=this._elevationContext.unit?
this._elevationContext.unit:E.unit;t.mode=this.getGeometryElevationMode(D,E);t.offsetMeters=r.unwrapOr(this._elevationContext.meterUnitOffset,r.unwrapOr(E.offset,0));if(D=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===t.mode)t.mode="relative-to-ground",t.offsetMeters=0;t.updateFeatureExpressionInfoContext(D?p.zeroContext:this._elevationContext.featureExpressionInfoContext,A,this._context.layer);return t};z.prepareSymbolLayerPatch=function(A){};z.updateGeometry=function(A,t){return!1};
z.onRemoveGraphic=function(A){};z._updateDrivenProperties=function(A){const t={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};A||(A=this._context.renderer)&&"visualVariables"in A&&A.visualVariables&&A.visualVariables.forEach(D=>{switch(D.type){case "color":t.color=!0;if(D.stops)for(let E=0;E<D.stops.length;E++){const G=D.stops[E].color;G&&(t.opacity=!0,1>G.a&&(t.opacityAlwaysOpaque=!1))}break;case "opacity":t.opacity=!0;t.opacityAlwaysOpaque=!1;break;case "size":t.size=!0}});this._drivenProperties=
t};z._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;const A=this._context.layer.opacity;return null==A?1:A};z._getCombinedOpacity=function(A,t=B){let D=1;this.draped||(D*=this._getLayerOpacity());if(this._drivenProperties.opacity)return D;r.isSome(A)?D*=A.a:t.hasIntrinsicColor||(D=0);return D};z._getCombinedOpacityAndColor=function(A,t=B){t=this._getCombinedOpacity(A,t);if(this._drivenProperties.color)return f.mixinColorAndOpacity(null,
t);A=r.isSome(A)?d.toUnitRGB(A):c.ONES;return f.mixinColorAndOpacity(A,t)};z._getVertexOpacityAndColor=function(A,t,D){A=f.mixinColorAndOpacity(this._drivenProperties.color?A.color:null,this._drivenProperties.opacity?A.opacity:null);D&&(A[0]*=D,A[1]*=D,A[2]*=D,A[3]*=D);return t?new t(A):A};z._getIdHint=function(A=""){return this._context.layer.id+"_symbol"+A};z.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};z.computeComplexity=function(){return q.defaultSymbolLayerComplexity(this.symbol,
this.symbolLayer)};z.destroy=function(){this.abortLoad()};z.globalPropertyChanged=function(A,t,D){switch(A){case "opacity":return this.layerOpacityChanged(t,D);case "elevationInfo":return A=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(t,D,A)===g.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(t,D);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();
default:return!1}};z.updateGraphics3DGraphicElevationInfo=function(A,t,D){let E=g.SymbolUpdateType.UPDATE;A.forEach(G=>{const H=t(G);r.isSome(H)?(this.setGraphicElevationContext(G.graphic,H.elevationContext),H.needsElevationUpdates=D(H.elevationContext.mode)):E=g.SymbolUpdateType.RECREATE});return E};z.applyRendererDiff=function(A,t){return!1};z.getFastUpdateAttrValues=function(A){if(!this._fastUpdates.enabled)return null;const t=this._fastUpdates.visualVariables,D=t.size?m(t.size.field,A):0,E=t.color?
m(t.color.field,A):0;A=t.opacity?m(t.opacity.field,A):0;return e.fromValues(D,E,A,0)};z.ensureDrapedStatus=function(A){if(null==this._draped)return this._draped=A,!0;A!==this.draped&&u.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};k._createClass(C,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&
!this._drivenProperties.opacityAlwaysOpaque}},{key:"draped",get:function(){return this._draped}}]);return C}(w.Loadable);const v={mode:"on-the-ground",offset:0,unit:"meters"},y={mode:"absolute-height",offset:0,unit:"meters"},B={hasIntrinsicColor:!1};b.Graphics3DSymbolLayer=a;b.default=a;b.getAttributeValue=m;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],
function(b,k,a){let r=function(){function l(){this._abortController=null;this._loadStatus=0;this.logger=this._loader=this._loadError=null}var h=l.prototype;h.load=function(d,c){if(1===this._loadStatus)return d&&d(),this._loader;if(2===this._loadStatus)return c&&c(this._loadError),this._loader;this._loader||(this._abortController=a.createAbortController(),this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=1},e=>{this._loadError=e;this._abortController=
null;this._loadStatus=2;!a.isAbortError(e)&&this.logger&&e.message&&this.logger.warn(e.message);throw e;}));this._loader.then(d,c).catch(()=>{});return this._loader};h.abortLoad=function(){this._abortController?(this._abortController.abort(),this._abortController=null):0===this._loadStatus&&(this._loadStatus=2);this._loader=null};k._createClass(l,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return l}();b.Loadable=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/maybe ../../../../geometry/support/coordsUtils ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../webgl-engine/lib/Object3D ./graphicUtils ./elevationAlignmentUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){const p=r.create();b.createStageObjectForHUD=function(n,w,q,m,u,v,y,B,x,C,z){const A=q?q.length:0;var t=n.clippingExtent;l.projectPointToVector(w,p,n.elevationProvider.spatialReference);if(k.isSome(t)&&!d.containsPoint(t,p))return null;l.projectPointToVector(w,p,n.renderCoordsHelper.spatialReference);t=n.localOriginFactory.getOrigin(p);B=new e({castShadow:!1,metadata:{layerUid:x,graphicUid:C,usesVerticalDistanceToGround:!0},idHint:B});for(x=0;x<A;x++)B.addGeometry(q[x],
m[x],u?u[x]:h.IDENTITY,v,t,z);n=g.applyElevationAlignmentForHUD(B,w,n.elevationProvider,n.renderCoordsHelper,y);return{object:B,sampledElevation:n}};b.extendPointGraphicElevationContext=function(n,w,q){n=n.elevationContext;q=q.spatialReference;l.projectPointToVector(w,p,q);n.centerPointInElevationSR=c.makeDehydratedPoint(p[0],p[1],w.hasZ?p[2]:0,q)};b.geometryToRenderInfo=function(n,w,q,m,u){const v=new Float64Array(3*n.length),y=new Float64Array(v.length);n.forEach((B,x)=>{v[3*x]=B[0];v[3*x+1]=B[1];
v[3*x+2]=2<B.length?B[2]:0});w=g.applyPerVertexElevationAlignment(v,w,0,y,0,v,0,v.length/3,q,m,u);return{numVertices:n.length,position:v,mapPosition:y,projectionSuccess:null!=w,sampledElevation:w}};b.placePointOnGeometry=function(n){switch(n.type){case "point":return n;case "polygon":case "extent":return f.computeCentroid(n);case "polyline":var w=n.paths[0];if(!w||0===w.length)break;w=a.getPointOnPath(w,a.getPathLength(w)/2);return c.makeDehydratedPoint(w[0],w[1],w[2],n.spatialReference);case "mesh":return n.extent.center}return null};
Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f32 ../../support/buffer/InterleavedLayout ../lib/Util ../lib/GLMaterial ../lib/Material ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique".split(" "),function(b,k,a,r,l,h,d,c,e){let f=function(m){function u(y,B){y=m.call(this,B,y,p)||this;y.techniqueConfig=new e.LineCalloutTechniqueConfiguration;
y._uniqueMaterialIdentifier=u.uniqueMaterialIdentifier(y.params);return y}k._inheritsLoose(u,m);var v=u.prototype;v.dispose=function(){};v.getGLMaterial=function(y){return 0===y.output?new g(y):void 0};v.getPassParameters=function(){return this.params};v.getTechniqueConfig=function(y){this.techniqueConfig.occlusionTestEnabled=this.params.occlusionTest;this.techniqueConfig.verticalOffset=!!this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=!!this.params.screenSizePerspective;this.techniqueConfig.depthHudEnabled=
y;this.techniqueConfig.depthHudAlignStartEnabled=!!this.params.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.params.centerOffsetUnits?1:0;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;return this.techniqueConfig};v.intersect=function(){};v.createBufferWriter=function(){return new q};v.validateParameterValues=function(y){y=u.uniqueMaterialIdentifier(y);y!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=y)};u.uniqueMaterialIdentifier=
function(y){return JSON.stringify({screenOffset:y.screenOffset||[0,0],centerOffsetUnits:y.centerOffsetUnits||"world"})};k._createClass(u,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return u}(d.Material),g=function(m){function u(y){y=m.call(this,y)||this;y.isRenderSlot=!0;y.updateParameters();return y}k._inheritsLoose(u,m);var v=u.prototype;v.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(e.LineCalloutTechnique,this.material.getTechniqueConfig(!1),
this.technique);this.depthTechnique=this.techniqueRep.acquireAndReleaseExisting(e.LineCalloutTechnique,this.material.getTechniqueConfig(!0),this.depthTechnique)};v.beginSlot=function(y){switch(y){case 20:return this.isRenderSlot=!0;case 21:return this.isRenderSlot=!1,!0}return!1};v.getTechnique=function(){return this.isRenderSlot?this.technique:this.depthTechnique};v.bind=function(y,B){const x=this.getTechnique();y.bindProgram(x.program);x.bindPass(y,this.material.getPassParameters(),B)};return u}(h);
const p={verticalOffset:null,screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1,...d.materialParametersDefaults},n=r.newLayout().vec3f(l.VertexAttrConstants.POSITION).vec3f(l.VertexAttrConstants.NORMAL).vec2f(l.VertexAttrConstants.UV0).vec4f(l.VertexAttrConstants.AUXPOS1),w=[a.fromValues(0,0),a.fromValues(1,0),a.fromValues(0,1),a.fromValues(1,0),a.fromValues(1,
1),a.fromValues(0,1)];let q=function(){function m(){this.vertexBufferLayout=n}var u=m.prototype;u.allocate=function(v){return this.vertexBufferLayout.createBuffer(v)};u.elementCount=function(v){return 6*v.indices[l.VertexAttrConstants.POSITION].length};u.write=function(v,y,B,x){c.writePosition(y.indices[l.VertexAttrConstants.POSITION],y.vertexAttr[l.VertexAttrConstants.POSITION].data,v.transformation,B.position,x,6);c.writeNormal(y.indices[l.VertexAttrConstants.NORMAL],y.vertexAttr[l.VertexAttrConstants.NORMAL].data,
v.invTranspTransformation,B.normal,x,6);c.writeBufferVec4(y.indices[l.VertexAttrConstants.AUXPOS1],y.vertexAttr[l.VertexAttrConstants.AUXPOS1].data,B.auxpos1,x,6);for(v=0;v<w.length;++v)B.uv0.setVec(x+v,w[v])};return m}();b.LineCalloutMaterial=f;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/vec2f32":function(){define(["exports"],function(b){function k(){return new Float32Array(2)}function a(q){const m=new Float32Array(2);m[0]=q[0];m[1]=q[1];return m}function r(q,m){const u=new Float32Array(2);
u[0]=q;u[1]=m;return u}function l(q,m){return new Float32Array(q,m,2)}function h(){return k()}function d(){return r(1,1)}function c(){return r(1,0)}function e(){return r(0,1)}const f=k(),g=d(),p=c(),n=e();var w=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,createView:l,zeros:h,ones:d,unitX:c,unitY:e,ZEROS:f,ONES:g,UNIT_X:p,UNIT_Y:n});b.ONES=g;b.UNIT_X=p;b.UNIT_Y=n;b.ZEROS=f;b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.ones=d;b.unitX=c;b.unitY=e;b.vec2f32=w;b.zeros=h})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../materials/internal/MaterialUtil ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../../../../chunks/LineCallout.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){h=function(m){function u(){return m.apply(this,arguments)||this}a._inheritsLoose(u,m);var v=u.prototype;v.initializeProgram=function(y){var B=u.shader.get();const x=this.configuration;B=B.build({occlusionTestEnabled:x.occlusionTestEnabled,verticalOffsetEnabled:x.verticalOffset,screenSizePerspectiveEnabled:x.screenSizePerspective,depthHudEnabled:x.depthHudEnabled,depthHudAlignStartEnabled:x.depthHudAlignStartEnabled,screenCenterOffsetUnitsEnabled:x.screenCenterOffsetUnitsEnabled,
slicePlaneEnabled:x.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,viewingMode:y.viewingMode,isDraped:!1});return new e(y.rctx,B.generateSource("vertex"),B.generateSource("fragment"),c.Default3D)};v.bindPass=function(y,B,x){g.View.bindProjectionMatrix(this.program,x.camera.projectionMatrix);q.LineCallout.bindUniforms(this.program,B,x.camera.pixelRatio||1);w.VerticalOffset.bindUniforms(this.program,B,x);this.program.setUniform1i("hudVisibilityTexture",0);y.bindTexture(x.hudVisibilityTexture,
0);this.program.setUniform1f("cameraGroundRelative",x.camera.aboveGround?1:-1);this.program.setUniform1f("polygonOffset",B.shaderPolygonOffset);g.View.bindViewport(this.program,x);this.program.setUniform1f("perDistancePixelRatio",Math.tan(x.camera.fovY/2)/(x.camera.fullViewport[2]/2));this.program.setUniformMatrix4fv("viewNormal",x.camera.viewInverseTransposeMatrix);this.program.setUniform2f("pixelToNDC",2/x.camera.fullViewport[2],2/x.camera.fullViewport[3]);this.program.setUniform1f("lineSize",Math.ceil(B.size)*
(x.camera.pixelRatio||1));p.bindScreenSizePerspective(B.screenSizePerspective,this.program,"screenSizePerspectiveAlignment")};v.bindDraw=function(y){g.View.bindView(this.program,y);g.View.bindCamPosition(this.program,y.origin,y.camera.viewInverseTransposeMatrix);n.Slice.bindUniformsWithOrigin(this.program,this.configuration,y)};v.initializePipeline=function(){return this.configuration.depthHudEnabled?f.makePipelineState({depthTest:{func:513},depthWrite:f.defaultDepthWriteParams}):f.makePipelineState({blending:f.separateBlendingParams(1,
770,771,771),depthTest:{func:513},colorWrite:f.defaultColorWriteParams})};return u}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(q.LineCalloutShader,()=>new Promise(function(m,u){b(["./LineCallout.glsl"],m,u)}));l=function(m){function u(){var v=m.apply(this,arguments)||this;v.occlusionTestEnabled=!0;v.verticalOffset=!1;v.screenSizePerspective=!1;v.depthHudEnabled=!1;v.depthHudAlignStartEnabled=!1;v.screenCenterOffsetUnitsEnabled=0;v.slicePlaneEnabled=!1;return v}a._inheritsLoose(u,m);
return u}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter()],l.prototype,"occlusionTestEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"verticalOffset",void 0);r.__decorate([d.parameter()],l.prototype,"screenSizePerspective",void 0);r.__decorate([d.parameter()],l.prototype,"depthHudEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"depthHudAlignStartEnabled",void 0);r.__decorate([d.parameter({count:2})],l.prototype,"screenCenterOffsetUnitsEnabled",void 0);r.__decorate([d.parameter()],
l.prototype,"slicePlaneEnabled",void 0);k.LineCalloutTechnique=h;k.LineCalloutTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl".split(" "),
function(b,k,a,r,l,h){function d(f){const g=new a.ShaderBuilder;g.include(r.AlignPixel);g.include(h.HUD,f);g.include(l.Slice,f);g.attributes.add("uv0","vec2");g.vertex.uniforms.add("lineSize","float").add("pixelToNDC","vec2").add("borderSize","float").add("screenOffset","vec2");g.varyings.add("coverageSampling","vec4");g.varyings.add("lineSizes","vec2");g.vertex.code.add(k.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${f.occlusionTestEnabled?k.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${f.screenSizePerspectiveEnabled?k.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:k.glsl`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${f.depthHudEnabled?f.depthHudAlignStartEnabled?k.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:k.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${f.screenSizePerspectiveEnabled?k.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:k.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);g.fragment.uniforms.add("color","vec4");g.fragment.uniforms.add("borderColor","vec4");g.fragment.code.add(k.glsl`
    void main() {
      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = color.a * borderColor.a * coverage.y;
      float colorAlpha = color.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${f.depthHudEnabled?k.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:k.glsl`
      // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you
      // need to divide by finalAlpha). We avoid the division here by setting the
      // appropriate blending function in the material.
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return g}function c(f,g,p){3===p.length?f.setUniform4f(g,p[0],p[1],p[2],1):f.setUniform4fv(g,p)}(function(f){f.bindUniforms=function(g,p,n){c(g,"color",p.color);g.setUniform1f("pixelRatio",n);g.setUniform2f("screenOffset",p.screenOffset[0]*n,p.screenOffset[1]*n);null!==p.borderColor?(c(g,"borderColor",p.borderColor),g.setUniform1f("borderSize",n)):(g.setUniform4f("borderColor",0,0,0,0),g.setUniform1f("borderSize",0))}})(b.LineCallout||(b.LineCallout={}));var e=Object.freeze({__proto__:null,build:d,
get LineCallout(){return b.LineCallout}});b.LineCalloutShader=e;b.build=d})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(function(){return function(b,k,a){this.graphic=b;this.renderingInfo=k;this.layer=a}})},"esri/views/3d/webgl-engine/lib/Layer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Evented","../../../../chunks/vec3f64","./IdGen","./Octree"],function(b,k,a,r,l){k=function(h){function d(e,f,g){var p=h.call(this)||
this;p._parentStages=new Map;p._objects=new Set;p.id=d._idGen.gen(e);p.apiLayerUid=g;p.name=e;f=f||{};p.group=f.group||"";p.isVisible=null!=f.isVisible?f.isVisible:!0;p.isPickable=null!=f.isPickable?f.isPickable:!0;p.isSliceable=!1;p.translation=f.translation?a.clone(f.translation):a.create();return p}b._inheritsLoose(d,h);var c=d.prototype;c.addParentStage=function(e){if(!this._parentStages.has(e)){const f=this.on("dirty",g=>{e.notifyDirty(g.origin,g.dirtyType,g.subObject)});this._parentStages.set(e,
f)}};c.removeParentStage=function(e){const f=this._parentStages.get(e);f&&(f.remove(),this._parentStages.delete(e));this.invalidateSpatialQueryAccelerator()};c.getName=function(){return this.name};c.getGroup=function(){return this.group};c.getTranslation=function(){return this.translation};c.getObjectIds=function(){return Array.from(this._objects,e=>e.id)};c.getObjects=function(){return[...this._objects]};c.addObject=function(e){this._objects.add(e);e.parentLayer=this;this.notifyDirty("layerObjectAdded",
e);this._octree&&this._octree.add(e)};c.hasObject=function(e){return this._objects.has(e)};c.removeObject=function(e){if(!this._objects.delete(e))return!1;e.parentLayer=null;this.notifyDirty("layerObjectRemoved",e);this._octree&&this._octree.remove(e);return!0};c.notifyObjectBBChanged=function(e,f){this._octree&&this._octree.update(e,f)};c.getSpatialQueryAccelerator=function(){!this._octree&&50<this._objects.size&&this._createOctree();return this._octree};c.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",
null)};c.invalidateSpatialQueryAccelerator=function(){this._octree&&(this._octree.destroy(),this._octree=null)};c.notifyDirty=function(e,f,g,p){this.emit("dirty",{origin:p||this,dirtyType:e,subObject:f})};c._createOctree=function(){this._octree=new l({getRadius:e=>e.getBSRadius(),getCenter:e=>e.getCenter()});this._octree.add([...this._objects])};return d}(k);k._idGen=new r.IdGen;return k})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/geometryUtils ./Util".split(" "),
function(b,k,a,r,l,h,d){function c(K,L,S){S=S||K;S[0]=K[0]+L;S[1]=K[1]+L;S[2]=K[2]+L;return S}function e(K,L,S){return!h.frustum.intersectsSphere(S.planes,h.sphere.wrap(L,K))}function f(K,L,S){if(!I.length)for(var M=0;8>M;++M)I.push({index:0,distance:0});for(M=0;8>M;++M){const T=m[M];I.data[M].index=M;I.data[M].distance=p(K,L,T)}I.sort((T,O)=>T.distance-O.distance);S.clear();for(K=0;8>K;++K)S.push(I.data[K].index)}function g(K,L){let S=Infinity,M=null;for(let T=0;8>T;++T){const O=p(K,L,u[T]);O<S&&
(S=O,M=u[T])}return M}function p(K,L,S){return L*(K[0]*S[0]+K[1]*S[1]+K[2]*S[2])}function n(K){if(Array.isArray(K))return K;y[0]=K;return y}let w=function(){function K(S,M){this._objectToBoundingSphere=S;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._objectCount=0;M&&(void 0!==M.maximumObjectsPerNode&&(this._maximumObjectsPerNode=M.maximumObjectsPerNode),void 0!==M.maximumDepth&&(this._maximumDepth=M.maximumDepth));this._root=new q(null,r.fromValues(0,0,
0),0)}var L=K.prototype;L.destroy=function(){this._degenerateObjects.clear();this._root=null;q.clearPool();y[0]=null;A.prune();I.prune();J.prune()};L.add=function(S,M){S=n(S);M=null==M?S.length:M;this._objectCount+=M;this._grow(S,M);const T=q.acquire();for(let O=0;O<M;O++){const Q=S[O];this._isDegenerate(Q)?this._degenerateObjects.add(Q):(T.init(this._root),this._add(Q,T))}q.release(T)};L.remove=function(S,M){var T=n(S);this._objectCount-=T.length;S=q.acquire();for(const O of T)T=M||this._boundingSphereFromObject(O,
t),this._isValidRadius(T.radius)?(S.init(this._root),this._remove(O,T,S)):this._degenerateObjects.delete(O);q.release(S);this._shrink()};L.update=function(S,M){if(this._isValidRadius(M.radius)||!this._isDegenerate(S))this.remove(S,M),this.add(S)};L.forEachAlongRay=function(S,M,T){const O=h.ray.wrap(S,M);this._forEachNode(this._root,Q=>{if(!this._intersectsNode(O,Q))return!1;Q=Q.node;Q.terminals.forAll(F=>{this._intersectsObject(O,F)&&T(F)});null!==Q.residents&&Q.residents.forAll(F=>{this._intersectsObject(O,
F)&&T(F)});return!0})};L.forEachAlongRayWithVerticalOffset=function(S,M,T,O){const Q=h.ray.wrap(S,M);this._forEachNode(this._root,F=>{if(!this._intersectsNodeWithOffset(Q,F,O))return!1;F=F.node;F.terminals.forAll(N=>{this._intersectsObjectWithOffset(Q,N,O)&&T(N)});null!==F.residents&&F.residents.forAll(N=>{this._intersectsObjectWithOffset(Q,N,O)&&T(N)});return!0})};L.forEach=function(S){this._forEachNode(this._root,M=>{M=M.node;M.terminals.forAll(S);null!==M.residents&&M.residents.forAll(S);return!0});
this._degenerateObjects.forEach(S)};L.forEachDegenerateObject=function(S){this._degenerateObjects.forEach(S)};L.findClosest=function(S,M,T,O,Q){return this._findClosest(S,"front-to-back"===M?1:-1,T,O,Q)};L.forEachInDepthRange=function(S,M,T,O,Q,F,N,P){this._forEachInDepthRange(S,M,"front-to-back"===T?1:-1,O,Q,F,N,P)};L.forEachNode=function(S){this._forEachNode(this._root,M=>S(M.node,M.center,2*M.halfSize))};L._intersectsNode=function(S,M){c(M.center,2*-M.halfSize,C);c(M.center,2*M.halfSize,z);return d.rayBoxTest(S.origin,
S.direction,C,z)};L._intersectsNodeWithOffset=function(S,M,T){c(M.center,2*-M.halfSize,C);c(M.center,2*M.halfSize,z);T.applyToMinMax(C,z);return d.rayBoxTest(S.origin,S.direction,C,z)};L._intersectsObject=function(S,M){const T=this._objectToBoundingSphere.getRadius(M);return 0<T?h.sphere.intersectsRay(h.sphere.wrap(T,this._objectToBoundingSphere.getCenter(M)),S):!0};L._intersectsObjectWithOffset=function(S,M,T){const O=this._objectToBoundingSphere.getRadius(M);return 0<O?h.sphere.intersectsRay(T.applyToBoundingSphere(O,
this._objectToBoundingSphere.getCenter(M)),S):!0};L._forEachNode=function(S,M){S=q.acquire().init(S);const T=[S];for(;0!==T.length;){S=T.pop();if(M(S)&&!S.isLeaf())for(let O=0;O<S.node.children.length;O++)S.node.children[O]&&T.push(q.acquire().init(S).advance(O));q.release(S)}};L._forEachNodeDepthOrdered=function(S,M,T,O=1){S=q.acquire().init(S);const Q=[S];for(f(T,O,J);0!==Q.length;){S=Q.pop();if(M(S)&&!S.isLeaf())for(T=7;0<=T;--T)O=J.data[T],O>=S.node.children.length||S.node.children[O]&&Q.push(q.acquire().init(S).advance(O));
q.release(S)}};L._findClosest=function(S,M,T,O,Q){let F=Infinity,N=Infinity,P=null;const U=g(S,M);let V=0;const W=X=>{++V;if(!O||O(X)){var ca=this._objectToBoundingSphere.getCenter(X),R=this._objectToBoundingSphere.getRadius(X);if(!T||!e(ca,R,T)){ca=p(S,M,ca);var aa=ca-R;aa<F&&(F=aa,N=ca+R,P=X)}}};this._forEachNodeDepthOrdered(this._root,X=>{if(null!=Q&&V>=Q||T&&e(X.center,X.halfSize*v,T))return!1;l.scale(x,U,X.halfSize);l.add(x,x,X.center);if(p(S,M,x)>N)return!1;X=X.node;X.terminals.forAll(ca=>{W(ca)});
null!==X.residents&&X.residents.forAll(ca=>{W(ca)});return!0},S,M);return P};L._forEachInDepthRange=function(S,M,T,O,Q,F,N,P){let U=-Infinity,V=Infinity;const W={setRange:da=>{1===T?(U=Math.max(U,da.near),V=Math.min(V,da.far)):(U=Math.max(U,-da.far),V=Math.min(V,-da.near))}};W.setRange(O);const X=p(M,T,S),ca=g(M,T),R=g(M,-1*T);let aa=0;const ka=da=>{++aa;if(!N||N(da)){var fa=this._objectToBoundingSphere.getCenter(da),ea=this._objectToBoundingSphere.getRadius(da),Y=p(M,T,fa)-X;Y-ea>V||Y+ea<U||F&&e(fa,
ea,F)||Q(da,W)}};this._forEachNodeDepthOrdered(this._root,da=>{if(null!=P&&aa>=P||F&&e(da.center,da.halfSize*v,F))return!1;l.scale(x,ca,da.halfSize);l.add(x,x,da.center);if(p(M,T,x)-X>V)return!1;l.scale(x,R,da.halfSize);l.add(x,x,da.center);if(p(M,T,x)-X<U)return!1;da=da.node;da.terminals.forAll(fa=>{ka(fa)});null!==da.residents&&da.residents.forAll(fa=>{ka(fa)});return!0},M,T)};L._remove=function(S,M,T){A.clear();M=T.advanceTo(M,(O,Q)=>{A.push(O.node);A.push(Q)})?T.node.terminals:T.node.residents;
M.removeUnordered(S);if(0===M.length)for(S=A.length-2;0<=S&&this._purge(A.data[S],A.data[S+1]);S-=2);};L._nodeIsEmpty=function(S){if(0!==S.terminals.length)return!1;if(null!==S.residents)return 0===S.residents.length;for(let M=0;M<S.children.length;M++)if(S.children[M])return!1;return!0};L._purge=function(S,M){0<=M&&(S.children[M]=null);return this._nodeIsEmpty(S)?(null===S.residents&&(S.residents=new a({shrink:!0})),!0):!1};L._add=function(S,M){M.advanceTo(this._boundingSphereFromObject(S,t))?M.node.terminals.push(S):
(M.node.residents.push(S),M.node.residents.length>this._maximumObjectsPerNode&&M.depth<this._maximumDepth&&this._split(M))};L._split=function(S){const M=S.node.residents;S.node.residents=null;for(let T=0;T<M.length;T++){const O=q.acquire().init(S);this._add(M.data[T],O);q.release(O)}};L._grow=function(S,M){0!==M&&(S=this._boundingSphereFromObjects(S,M,(T,O)=>this._boundingSphereFromObject(T,O),D),this._isValidRadius(S.radius)&&!this._fitsInsideTree(S)&&(this._nodeIsEmpty(this._root.node)?(l.copy(this._root.center,
S.center),this._root.halfSize=1.25*S.radius):(M=q.acquire(),this._rootBoundsForRootAsSubNode(S,M),this._placingRootViolatesMaxDepth(M)?this._rebuildTree(S,M):this._growRootAsSubNode(M),q.release(M))))};L._rebuildTree=function(S,M){l.copy(E.center,M.center);E.radius=M.halfSize;S=this._boundingSphereFromObjects([S,E],2,T=>T,G);M=q.acquire().init(this._root);this._root.initFrom(null,S.center,1.25*S.radius);this._forEachNode(M,T=>{this.add(T.node.terminals.data,T.node.terminals.length);null!==T.node.residents&&
this.add(T.node.residents.data,T.node.residents.length);return!0});q.release(M)};L._placingRootViolatesMaxDepth=function(S){let M=0;this._forEachNode(this._root,T=>{M=Math.max(M,T.depth);return!0});return M+Math.log(S.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};L._rootBoundsForRootAsSubNode=function(S,M){var T=S.radius,O=S.center;S=-Infinity;const Q=this._root.center,F=this._root.halfSize;for(var N=0;3>N;N++){var P=Math.max(0,Math.ceil((Q[N]-F-(O[N]-T))/(2*F)));const U=Math.max(0,
Math.ceil((O[N]+T-(Q[N]+F))/(2*F)))+1;S=Math.max(S,Math.pow(2,Math.ceil(Math.log(P+U)*Math.LOG2E)));H[N].min=P;H[N].max=U}for(T=0;3>T;T++)O=H[T].min,N=H[T].max,P=(S-(O+N))/2,O+=Math.ceil(P),N+=Math.floor(P),B[T]=Q[T]-F-O*F*2+(N+O)*F;return M.initFrom(null,B,S*F,0)};L._growRootAsSubNode=function(S){const M=this._root.node;l.copy(D.center,this._root.center);D.radius=this._root.halfSize;this._root.init(S);S.advanceTo(D,null,!0);S.node.children=M.children;S.node.residents=M.residents;S.node.terminals=
M.terminals};L._shrink=function(){for(;;){const S=this._findShrinkIndex();if(-1===S)break;this._root.advance(S);this._root.depth=0}};L._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let S=null;const M=this._root.node.children;let T=0,O=0;for(;O<M.length&&null==S;)T=O++,S=M[T];for(;O<M.length;)if(M[O++])return-1;return T};L._isDegenerate=function(S){S=this._objectToBoundingSphere.getRadius(S);return!this._isValidRadius(S)};L._isValidRadius=function(S){return!isNaN(S)&&
-Infinity!==S&&Infinity!==S&&0<S};L._fitsInsideTree=function(S){const M=this._root.center,T=this._root.halfSize,O=S.center;return S.radius<=T&&O[0]>=M[0]-T&&O[0]<=M[0]+T&&O[1]>=M[1]-T&&O[1]<=M[1]+T&&O[2]>=M[2]-T&&O[2]<=M[2]+T};L._boundingSphereFromObject=function(S,M){l.copy(M.center,this._objectToBoundingSphere.getCenter(S));M.radius=this._objectToBoundingSphere.getRadius(S);return M};L._boundingSphereFromObjects=function(S,M,T,O){if(1===M)S=T(S[0],D),l.copy(O.center,S.center),O.radius=S.radius;
else{C[0]=Infinity;C[1]=Infinity;C[2]=Infinity;z[0]=-Infinity;z[1]=-Infinity;z[2]=-Infinity;for(let U=0;U<M;U++){var Q=T(S[U],D);if(this._isValidRadius(Q.radius)){var F=C,N=Q.center,P=Q.radius;F[0]=Math.min(F[0],N[0]-P);F[1]=Math.min(F[1],N[1]-P);F[2]=Math.min(F[2],N[2]-P);F=z;N=Q.center;Q=Q.radius;F[0]=Math.max(F[0],N[0]+Q);F[1]=Math.max(F[1],N[1]+Q);F[2]=Math.max(F[2],N[2]+Q)}}l.lerp(O.center,C,z,.5);O.radius=Math.max(z[0]-C[0],z[1]-C[1],z[2]-C[2])/2}return O};b._createClass(K,[{key:"center",get:function(){return this._root.center}},
{key:"size",get:function(){return 2*this._root.halfSize}},{key:"root",get:function(){return this._root.node}},{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return K}(),q=function(){function K(S,M,T=0){this.center=r.create();this.initFrom(S,M,T,0)}var L=K.prototype;L.init=function(S){return this.initFrom(S.node,S.center,S.halfSize,S.depth)};
L.initFrom=function(S=null,M,T=this.halfSize,O=this.depth){this.node=S||K.createEmptyNode();M&&l.copy(this.center,M);this.halfSize=T;this.depth=O;return this};L.advance=function(S){let M=this.node.children[S];M||(M=K.createEmptyNode(),this.node.children[S]=M);this.node=M;this.halfSize/=2;this.depth++;S=m[S];this.center[0]+=S[0]*this.halfSize;this.center[1]+=S[1]*this.halfSize;this.center[2]+=S[2]*this.halfSize;return this};L.advanceTo=function(S,M,T=!1){for(;;){if(this.isTerminalFor(S))return M&&
M(this,-1),!0;if(this.isLeaf()&&!T)return M&&M(this,-1),!1;this.isLeaf()&&(this.node.residents=null);const O=this._childIndex(S);M&&M(this,O);this.advance(O)}};L.isLeaf=function(){return null!=this.node.residents};L.isTerminalFor=function(S){return S.radius>this.halfSize/2};L._childIndex=function(S){S=S.center;const M=this.center;let T=0;for(let O=0;3>O;O++)M[O]<S[O]&&(T|=1<<O);return T};K.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new a({shrink:!0}),
residents:new a({shrink:!0})}};K.acquire=function(){return K._pool.acquire()};K.release=function(S){K._pool.release(S)};K.clearPool=function(){K._pool.prune()};return K}();q._pool=new k(q);const m=[r.fromValues(-1,-1,-1),r.fromValues(1,-1,-1),r.fromValues(-1,1,-1),r.fromValues(1,1,-1),r.fromValues(-1,-1,1),r.fromValues(1,-1,1),r.fromValues(-1,1,1),r.fromValues(1,1,1)],u=[r.fromValues(-1,-1,-1),r.fromValues(-1,-1,1),r.fromValues(-1,1,-1),r.fromValues(-1,1,1),r.fromValues(1,-1,-1),r.fromValues(1,-1,
1),r.fromValues(1,1,-1),r.fromValues(1,1,1)],v=Math.sqrt(3),y=[null],B=r.create(),x=r.create(),C=r.create(),z=r.create(),A=new a,t={center:r.create(),radius:0},D={center:r.create(),radius:0},E={center:r.create(),radius:0},G={center:r.create(),radius:0},H=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],I=new a,J=new a;return w})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define(["exports","../../../../core/maybe","../../../../Color","../../../../core/screenUtils","../../../../chunks/vec4f64"],
function(b,k,a,r,l){let h=function(){function d(e){this.definition=e;this.key=JSON.stringify(e);this.haloSize=Math.round(e.halo.size);this.fillStyle=this.colorToRGBA(e.color);this.haloStyle=this.colorToRGB(e.halo.color)}var c=d.prototype;c.colorToRGB=function(e){return`rgb(${e.slice(0,3).map(f=>Math.floor(255*f)).toString()})`};c.colorToRGBA=function(e){return`rgba(${e.slice(0,3).map(f=>Math.floor(255*f)).toString()},${e[3]})`};d.fromSymbol=function(e,f=1){var g=k.get(e,"material","color");g=k.isSome(g)?
a.toUnitRGBA(g):l.ZEROS;var p=e.halo;const n=null!=e.size?r.pt2px(e.size):12;e={family:e.font&&e.font.family?e.font.family:"sans-serif",weight:e.font&&e.font.weight?e.font.weight:"normal",style:e.font&&e.font.style?e.font.style:"normal"};p=k.isSome(p)&&k.isSome(p.color)&&0<p.size?{size:r.pt2px(p.size),color:a.toUnitRGBA(p.color)}:{size:0,color:l.ZEROS};return new d({size:n,color:g,font:e,halo:p,pixelRatio:f})};return d}();b.TextRenderParameters=h;b.default=h;Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./TextRenderParameters"],function(b,k,a,r){function l(e,f,g){e.canvas||(e.canvas=document.createElement("canvas"));e.canvas.width=f;e.canvas.height=g;return e.canvas}let h=function(){function e(g,p,n=2048){this.text=g;this.maxSize=n;this._displayWidth=this._renderPixelRatio=null;this.parameters=p instanceof r.TextRenderParameters?p:new r.TextRenderParameters(p);
this.key=`${this.parameters.key}--${g}`;this.textLines=g.split(/\r?\n/);this.lineHeight=this.computeLineHeight()}var f=e.prototype;f.render=function(g,p=0,n=0){const w=this.renderedLineHeight,q=this.renderedHaloSize;var m=g.textAlign,u=this.renderedWidth;m=("center"===m?.5*u:"right"===m?u:0)+q;u=q+1;g.save();0<q&&this.renderHalo(g,m,u,p,n);this.setFontProperties(g,this.renderedFontSize);n+=u;p+=m;for(const v of this.textLines)g.globalCompositeOperation="destination-out",g.fillStyle="rgb(0, 0, 0)",
g.fillText(v,p,n),g.globalCompositeOperation="source-over",g.fillStyle=this.parameters.fillStyle,g.fillText(v,p,n),n+=w;g.restore()};f.renderHalo=function(g,p,n,w,q){const m=this.renderedWidth,u=this.renderedHeight,v=l(c,Math.max(m,512),Math.max(u,512)),y=v.getContext("2d");y.clearRect(0,0,m,u);this.setFontProperties(y,this.renderedFontSize);y.fillStyle=this.parameters.haloStyle;y.strokeStyle=this.parameters.haloStyle;const B=3>this.renderedHaloSize;y.lineJoin=B?"miter":"round";B?this.renderHaloEmulated(y,
p,n):this.renderHaloNative(y,p,n);g.globalAlpha=this.parameters.definition.halo.color[3];g.drawImage(v,0,0,m,u,w,q,m,u);g.globalAlpha=1};f.renderHaloEmulated=function(g,p,n){const w=this.renderedLineHeight,q=this.renderedHaloSize;for(const m of this.textLines){for(const [u,v]of d)g.fillText(m,p+q*u,n+q*v);n+=w}};f.renderHaloNative=function(g,p,n){const w=this.renderedLineHeight,q=this.renderedHaloSize;for(const m of this.textLines){const u=2*q;for(let v=0;5>v;v++)g.lineWidth=(.6+.1*v)*u,g.strokeText(m,
p,n);n+=w}};f.setFontProperties=function(g,p){const n=this.parameters.definition.font;g.font=`${n.style} ${n.weight} ${p}px ${n.family}, sans-serif`;g.textAlign="left";g.textBaseline="top"};f.computeTextWidth=function(){const g=l(c,512,512).getContext("2d");this.setFontProperties(g,this.parameters.definition.size);let p=0;for(var n of this.textLines)p=Math.max(p,g.measureText(n).width);n=this.parameters.definition.font;if("italic"===n.style||"oblique"===n.style||"string"===typeof n.weight&&("bold"===
n.weight||"bolder"===n.weight)||"number"===typeof n.weight&&600<n.weight)p+=.3*g.measureText("A").width;p+=2*this.parameters.haloSize;return Math.round(p)};f.computeLineHeight=function(){return Math.ceil(1.275*this.parameters.definition.size+2*this.parameters.haloSize)+1};k._createClass(e,[{key:"displayWidth",get:function(){a.isNone(this._displayWidth)&&(this._displayWidth=this.computeTextWidth());return this._displayWidth}},{key:"displayHeight",get:function(){return this.lineHeight*this.textLines.length}},
{key:"renderedWidth",get:function(){return Math.round(this.displayWidth*this.renderPixelRatio)}},{key:"renderedHeight",get:function(){return Math.round(this.displayHeight*this.renderPixelRatio)}},{key:"renderedLineHeight",get:function(){return Math.round(this.lineHeight*this.renderPixelRatio)}},{key:"renderedFontSize",get:function(){return this.parameters.definition.size*this.renderPixelRatio}},{key:"renderedHaloSize",get:function(){return this.parameters.haloSize*this.renderPixelRatio}},{key:"renderPixelRatio",
get:function(){if(a.isNone(this._renderPixelRatio)){const g=this.parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(g,Math.min(this.maxSize/(this.displayWidth*g),this.maxSize/(this.displayHeight*g))):g}return this._renderPixelRatio}}]);return e}();const d=[];for(let e=0;360>e;e+=22.5)d.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);const c={canvas:null};b.TextRenderer=h;b.default=h;b.getTextHelperCanvas=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports",
"./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(b,k,a){b.getGraphics3DSymbol=function(r){return r instanceof a?r.graphics3DSymbol:r instanceof k?r:null};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/asyncUtils ./Graphics3DObject3DGraphicLayer ./Loadable ./symbolComplexity ./Graphics3DGraphic ./Graphics3DSymbolLayerFactory".split(" "),
function(b,k,a,r,l,h,d,c,e){const f={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(g){function p(w,q,m){var u=g.call(this)||this;u._symbol=w;u._context=q;u._backgroundLayers=m;u._destroyed=!1;u.symbolLayers=[];u.referenced=0;u._extentPadding=0;return u}b._inheritsLoose(p,g);var n=p.prototype;n.doLoad=async function(w){let q=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(q=this._backgroundLayers.concat(q));const m=q.length;for(;this.symbolLayers.length<
q.length;)this.symbolLayers.push(null);this.symbolLayers.length=q.length;const u=[];for(let v=0;v<m;v++){const y=q.getItemAt(v);if(!1===y.enabled)continue;f.renderPriority=1-(1+v)/m;f.renderPriorityStep=1/m;f.ignoreDrivers=y._ignoreDrivers;const B=e.make(this.symbol,y,this._context,f);u.push(a.onAbortOrThrow(w,()=>{this.symbolLayers[v]=null;B.destroy()}));this.symbolLayers[v]=B}await r.forEach(this.symbolLayers,async(v,y)=>{if(k.isSome(v))try{await v.load(),this._extentPadding+=Math.max(this._extentPadding,
v.extentPadding)}catch{this.symbolLayers[y]=null}});for(const v of u)null==v?void 0:v.remove();u.length=0;a.throwIfAborted(w);if(this.symbolLayers.length&&!this.symbolLayers.some(v=>!!v))throw Error();};n.getSymbolLayerSize=function(w){w=this.symbolLayers[w];return k.isSome(w)?w.getCachedSize():null};n.createGraphics3DGraphic=function(w,q){const m=w.graphic,u=Array(this.symbolLayers.length);for(let v=0;v<this.symbolLayers.length;v++){const y=this.symbolLayers[v];u[v]=k.isSome(y)?y.createGraphics3DGraphic(w):
null}return new c(m,q||this,u,w.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};n.globalPropertyChanged=function(w,q){const m=this.symbolLayers.length;for(let u=0;u<m;u++){const v=this.symbolLayers[u],y=B=>{B=B._graphics[u];return B instanceof l?B:null};if(k.isSome(v)&&!v.globalPropertyChanged(w,q,y))return!1}return!0};n.applyRendererDiff=function(w,q){return 1!==
this.loadStatus?!1:this.symbolLayers.reduce((m,u)=>m&&(k.isNone(u)||u.applyRendererDiff(w,q)),!0)};n.prepareSymbolPatch=function(w){if(2!==this.loadStatus&&"partial"===w.diff.type){var q=w.diff.diff;if(q.symbolLayers&&"partial"===q.symbolLayers.type){var m=q.symbolLayers.diff;this.symbolLayers.forEach((u,v)=>{if(!k.isNone(u)){var y=m[v];if(y){const B={diff:y,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};u.prepareSymbolLayerPatch(B);w.symbolStatePatches.push(...B.symbolLayerStatePatches);
B.graphics3DGraphicPatches.length&&w.graphics3DGraphicPatches.push((x,C)=>{const z=x._graphics[v];k.isSome(z)&&B.graphics3DGraphicPatches.forEach(A=>A(z,C))})}}})}}};n.updateGeometry=function(w,q){for(let m=0;m<this.symbolLayers.length;m++){const u=this.symbolLayers[m];if(k.isNone(u))continue;const v=w._graphics[m];if(k.isNone(v)||!u.updateGeometry(v,q))return!1}return!0};n.onRemoveGraphic=function(w){for(let q=0;q<this.symbolLayers.length;q++){const m=this.symbolLayers[q];if(k.isNone(m))continue;
const u=w._graphics[q];if(k.isSome(u))m.onRemoveGraphic(u)}};n.getFastUpdateStatus=function(){let w=0,q=0,m=0;this.symbolLayers.forEach(u=>{k.isNone(u)||(0===u.loadStatus?w++:u.isFastUpdatesEnabled()?m++:q++)});return{loading:w,slow:q,fast:m}};n.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{this.abortLoad();for(const w of this.symbolLayers)k.isSome(w)&&w.destroy();this.symbolLayers.length=0;this._destroyed=!0}};b._createClass(p,
[{key:"symbol",set:function(w){this._symbol=w;if(this.symbolLayers)for(let q=0;q<w.symbolLayers.length;q++){const m=this.symbolLayers[q];k.isNone(m)||(m.symbol=w,m.symbolLayer=w.symbolLayers.items[q])}},get:function(){return this._symbol}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"complexity",get:function(){return d.totalSymbolComplexities(this.symbolLayers.map(w=>k.get(w,"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return p}(h.Loadable)})},
"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../geometry/Polygon ../../../../core/asyncUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../../layers/graphics/featureConversionUtils ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./featureExpressionInfoUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){const m=new a(Array,v=>n.set(v,n.ZERO),null,10,5),u=c.create();return function(){function v(B,x,C,z,A){this._labelGraphics=[];this._auxiliaryGraphics=[];var t=Array(2);for(let D=0;D<t.length;D++)t[D]=Array(4);this._visibilityFlags=t;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;this.isElevationSource=!1;++x.referenced;this.graphics3DSymbol=x;this.graphic=B;this._graphics=C;this._featureExpressionFeature=
A?q.createFeature(A,B,z):null;for(const D of this._graphics)k.isSome(D)&&(this.isElevationSource=this.isElevationSource||D.isElevationSource)}var y=v.prototype;y.initialize=function(B,x,C){this._layer=x;this._stage=B;this.forEachSymbolLayerGraphic(z=>{z.initialize(B,x,C);z.setVisibility(this.isVisible())})};y.destroy=function(){this.forEachSymbolLayerGraphic(B=>B.destroy());this._auxiliaryGraphics=this._graphics=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=null};y.clearLabelGraphics=
function(){this.forEachLabelGraphic(B=>B.destroy());this._labelGraphics.length=0};y.addLabelGraphic=function(B,x,C){this._labelGraphics.push(B);B.initialize(x,C);B.setVisibility(this.isVisible(1))};y.addAuxiliaryGraphic=function(B){this._auxiliaryGraphics.push(B);this._layer&&(B.initialize(this._stage,this._layer),B.setVisibility(this.isVisible()))};y.isVisible=function(B=0,x){for(let C=0;C<=B;C++){const z=this._visibilityFlags[C];for(let A=0;A<z.length;++A)if(!1===z[A]&&A!==x)return!1}return!0};
y.hasVisibilityFlag=function(B,x){return null!=this._visibilityFlags[x][B]};y.setVisibilityFlag=function(B,x,C){const z=this.isVisible(C);this._visibilityFlags[C][B]=x;const A=this.isVisible(C);if(z===A)return!1;if(1===C)this.forEachLabelGraphic(t=>t.setVisibility(A));else{this.forEachSymbolLayerGraphic(D=>D.setVisibility(A));const t=this.isVisible(1);this.forEachLabelGraphic(D=>D.setVisibility(t))}return!0};y.clearVisibilityFlag=function(B,x=0){return this.setVisibilityFlag(B,void 0,x)};y.getBSRadius=
function(){let B=0;this.forEachSymbolLayerGraphic(x=>{B=Math.max(B,x.getBSRadius())});return B};y.getCenterObjectSpace=function(B=h.create()){if(0===this._graphics.length)return d.set(B,0,0,0),B;const x=this._graphics[0];return k.isSome(x)?x.getCenterObjectSpace(B):B};y.computeExtent=function(B){if(!this._extent){var x=this.graphic.geometry;if(k.isNone(x))return!1;this._extent=c.create();w.computeAABR(x,this._extent);x=x.spatialReference;if(!x.equals(B)&&!e.projectBoundingRect(this._extent,x,this._extent,
B))return this._extent=null,!1}return!0};y.getAsOptimizedGeometry=function(B,x){if(this._optimizedGeometry.geometry&&this._optimizedGeometry.hasZ===B&&this._optimizedGeometry.hasM===x)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,B,x);this._optimizedGeometry.hasZ=B;this._optimizedGeometry.hasM=x;return this._optimizedGeometry.geometry};y._convertGraphicToOptimizedGeometry=function(B,x,C){B=B.geometry;if("mesh"===B.type||
"extent"===B.type)B=r.fromExtent("mesh"===B.type?B.extent:B);return f.convertFromGeometry(B,x,C)};y.computeAttachmentOrigin=function(){const B={render:{origin:h.create(),num:0},draped:{origin:g.create(),num:0}};for(const x of this._graphics)k.isNone(x)||x.computeAttachmentOrigin(B);B.render.num&&d.scale(B.render.origin,B.render.origin,1/B.render.num);B.draped.num&&p.scale(B.draped.origin,B.draped.origin,1/B.draped.num);return B};y.getProjectedBoundingBox=async function(B,x,C,z,A){A||(A={boundingBox:null,
requiresDrapedElevation:!1,screenSpaceObjects:[]});A.boundingBox?n.empty(A.boundingBox):A.boundingBox=n.empty();A.requiresDrapedElevation=!1;await l.forEach(this._graphics,async t=>{if(!k.isNone(t)){var D="draped"===t.type?x:B,E=m.acquire();t=await t.getProjectedBoundingBox(D,C,A.screenSpaceObjects,z,E);isFinite(t[2])&&isFinite(t[5])||(A.requiresDrapedElevation=!0);t&&n.expandWithAABB(A.boundingBox,E);m.release(E)}});return n.allFinite(A.boundingBox)||c.allFinite(n.toRect(A.boundingBox,u))?A:null};
y.needsElevationUpdates=function(){for(const B of this._graphics)if(k.isSome(B)&&("object3d"===B.type||"lod-instance"===B.type)&&B.needsElevationUpdates)return!0;for(const B of this._labelGraphics)if(B&&B.needsElevationUpdates)return!0;return!1};y.alignWithElevation=function(B,x,C){this.forEachRenderedGraphic(z=>{"object3d"!==z.type&&"lod-instance"!==z.type||z.alignWithElevation(B,x,this._featureExpressionFeature,C)})};y.addObjectStateSet=function(B,x){this.forEachSymbolLayerGraphic(C=>C.addObjectState(B,
x))};y.removeObjectState=function(B){this.forEachSymbolLayerGraphic(x=>x.removeObjectState(B))};y.forEachGraphicList=function(B,x){B.forEach(C=>C&&x(C))};y.forEachSymbolLayerGraphic=function(B){this.forEachGraphicList(this._graphics,B);this.forEachGraphicList(this._auxiliaryGraphics,B)};y.forEachLabelGraphic=function(B){this.forEachGraphicList(this._labelGraphics,B)};y.forEachRenderedGraphic=function(B){this.forEachSymbolLayerGraphic(B);this.forEachLabelGraphic(B)};b._createClass(v,[{key:"labelGraphics",
get:function(){return this._labelGraphics}},{key:"extent",get:function(){return this._extent}},{key:"destroyed",get:function(){return null==this._graphics}},{key:"isDraped",get:function(){let B=!1;this.forEachSymbolLayerGraphic(x=>{"draped"===x.type&&(B=!0)});return B}},{key:"usedMemory",get:function(){let B=w.estimateAttributesObjectSize(this.graphic.attributes);this.forEachSymbolLayerGraphic(x=>{const C=x.graphics3DSymbolLayer.complexity;k.isNone(C)||(x="draped"===x.type?C.memory.draped:C.memory,
B+=x.bytesPerFeature,x.bytesPerCoordinate&&(B+=w.numVertices(this.graphic.geometry)*x.bytesPerCoordinate))});return B}}]);return v}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){const p=k.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory"),n={icon:r.Graphics3DIconSymbolLayer,object:d.Graphics3DObjectSymbolLayer,line:l.Graphics3DLineSymbolLayer,path:c.Graphics3DPathSymbolLayer,fill:e.Graphics3DPolygonFillSymbolLayer,extrude:a.Graphics3DExtrudeSymbolLayer,text:f.Graphics3DTextSymbolLayer,water:g.Graphics3DWaterSymbolLayer},w={"mesh-3d":{fill:h.Graphics3DMeshFillSymbolLayer}};b.make=function(q,m,u,v){const y=w[q.type]&&w[q.type][m.type]||
n[m.type];return y?new y(q,m,u,v):(p.error("GraphicsLayerFactory#make",`unknown symbol type ${m.type}`),null)};b.setSymbolClass=function(q,m){n[q]=m};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Error ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/projection ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../core/libs/earcut/earcut ../../../../chunks/mat3 ../../support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/aaBoundingBox ../../support/ElevationProvider ../../webgl-engine/lib/Util ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ./graphicUtils ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ../../webgl-engine/lib/Geometry ../support/edgeUtils ./Graphics3DSymbolLayer ../../../../renderers/support/renderingInfoUtils ./polygonUtils ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H){function I(ca,R,aa,ka,da,fa,ea,Y,Z,ba,ia,ja,la,qa){let na=0;var oa=2*ka.count;{var ua=ka.index,za=ka.count,Fa=aa.length/3,La=Z;h.copy(U,la);const Sa=0<ja?1:-1;ua*=3;let Ia=La;la=3*Ia;let Qa=La+za;La=3*Qa;for(let Pa=0;Pa<za;++Pa)qa&&(U[0]=ca[ua+0],U[1]=ca[ua+1],U[2]=ca[ua+2],h.normalize(U,U)),da[la+0]=ca[ua+0],da[la+1]=ca[ua+1],da[la+2]=ca[ua+2],fa[la+0]=R[ua+0],fa[la+1]=R[ua+1],fa[la+2]=R[ua+2],ea[la+0]=-Sa*U[0],ea[la+1]=-Sa*U[1],
ea[la+2]=-Sa*U[2],Y[Ia]=0,da[La+0]=ca[ua+0]+ja*U[0],da[La+1]=ca[ua+1]+ja*U[1],da[La+2]=ca[ua+2]+ja*U[2],fa[La+0]=R[ua+0],fa[La+1]=R[ua+1],fa[La+2]=R[ua+2],ea[La+0]=Sa*U[0],ea[La+1]=Sa*U[1],ea[La+2]=Sa*U[2],Y[Qa]=ja,la+=3,La+=3,ua+=3,Ia+=1,Qa+=1;la=ua=0;La=3*oa;ca=0>ja?W:V;R=0>ja?V:W;for(qa=0;qa<Fa;++qa)ia[la+0]=aa[ua+ca[0]],ia[la+1]=aa[ua+ca[1]],ia[la+2]=aa[ua+ca[2]],ba[La+0]=aa[ua+R[0]]+za,ba[La+1]=aa[ua+R[1]]+za,ba[La+2]=aa[ua+R[2]]+za,la+=3,La+=3,ua+=3}Z+=2*ka.count;oa=0;K(da,fa,Y,ea,na,ka.pathLengths[0],
ka.count,Z,ba,oa,ja);Z+=4*ka.pathLengths[0];oa+=2*ka.pathLengths[0];na+=ka.pathLengths[0];for(aa=1;aa<ka.pathLengths.length;++aa)K(da,fa,Y,ea,na,ka.pathLengths[aa],ka.count,Z,ba,oa,ja),Z+=4*ka.pathLengths[aa],oa+=2*ka.pathLengths[aa],na+=ka.pathLengths[aa]}function J(ca,R,aa,ka,da,fa,ea){ka[fa]=ka[ea];ea*=3;fa*=3;ca[fa+0]=ca[ea+0];ca[fa+1]=ca[ea+1];ca[fa+2]=ca[ea+2];R[fa+0]=R[ea+0];R[fa+1]=R[ea+1];R[fa+2]=R[ea+2];aa[fa+0]=da[0];aa[fa+1]=da[1];aa[fa+2]=da[2]}function K(ca,R,aa,ka,da,fa,ea,Y,Z,ba,ia){let ja=
da,la=da+1,qa=da+ea,na=da+ea+1,oa=Y,ua=Y+1,za=Y+2*fa;Y=Y+2*fa+1;0>ia&&(ja=da+ea+1,na=da);ba*=3;for(let Pa=0;Pa<fa;++Pa){Pa===fa-1&&(0<ia?(la=da,na=da+ea):(la=da,ja=da+ea));var Fa=ca,La=ja,Sa=la,Ia=qa,Qa=S;La*=3;Sa*=3;Ia*=3;h.set(M,Fa[La++],Fa[La++],Fa[La++]);h.set(T,Fa[Sa++],Fa[Sa++],Fa[Sa++]);h.set(O,Fa[Ia++],Fa[Ia++],Fa[Ia++]);h.subtract(Q,T,M);h.subtract(F,O,M);h.cross(Qa,F,Q);h.normalize(Qa,Qa);J(ca,R,ka,aa,S,oa,ja);J(ca,R,ka,aa,S,ua,la);J(ca,R,ka,aa,S,za,qa);J(ca,R,ka,aa,S,Y,na);Z[ba++]=oa;Z[ba++]=
za;Z[ba++]=Y;Z[ba++]=oa;Z[ba++]=Y;Z[ba++]=ua;ja++;la++;qa++;na++;oa+=2;ua+=2;za+=2;Y+=2}}function L(ca,R,aa,ka){ca=ca.stageObject;const da=ca.geometryRecords,fa=da.length,ea="absolute-height"!==R.mode;let Y=0;const Z=ca.objectTransformation,ba=d.invert(f.create(),Z);for(let la=0;la<fa;la+=2){const qa=da[la].geometry;var ia=qa.data.getVertexAttr();const na=ia[u.VertexAttrConstants.POSITION].data,oa=ia[u.VertexAttrConstants.SIZE].data;ia=new m.SamplePosition(ia.mapPos.data);const ua=na.length/3;let za=
0,Fa=!1,La=0;for(let Sa=0;Sa<ua;Sa++){N[0]=na[za];N[1]=na[za+1];N[2]=na[za+2];var ja=x.evaluateElevationAlignmentAtPoint(ia,aa,R,ka,ea?X:null);ea&&(La+=X.sampledElevation);h.set(P,na[za+0],na[za+1],na[za+2]);h.transformMat4(P,P,Z);ka.setAltitude(ja+oa[za/3],P);h.transformMat4(P,P,ba);na[za]=P[0];na[za+1]=P[1];na[za+2]=P[2];ja=.01/ka.unitInMeters;if(Math.abs(N[0]-na[za])>ja||Math.abs(N[1]-na[za+1])>ja||Math.abs(N[2]-na[za+2])>ja)Fa=!0;ia.offset+=3;za+=3}Fa&&(qa.invalidateBoundingInfo(),ca.geometryVertexAttrsUpdated(la),
da[la+1].geometry.invalidateBoundingInfo(),ca.geometryVertexAttrsUpdated(la+1));Y+=La/ua}return Y/fa}D=function(ca){function R(ka,da,fa,ea){ka=ca.call(this,ka,da,fa,ea)||this;ka.ensureDrapedStatus(!1);return ka}k._inheritsLoose(R,ca);var aa=R.prototype;aa.doLoad=async function(){if(!this._drivenProperties.size){var ka=B.validateSymbolLayerSize(this._getSymbolSize());if(ka)throw new r("graphics3dextrudesymbollayer:invalid-size",ka);}ka=a.get(this.symbolLayer,"material","color");var da=this._getCombinedOpacityAndColor(ka);
ka=l.fromArray(da);da=da[3];ka={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:ka,ambient:ka,opacity:da,transparent:1>da||this.needsDrivenTransparentPass,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new H.DefaultMaterial(ka,this._getIdHint("_3dlinemat"));this._bottomMaterial=new H.DefaultMaterial({...ka,cullFace:2},this._getIdHint("_3dlinematbot"));this._context.stage.add(3,
this._material);this._context.stage.add(3,this._bottomMaterial)};aa.destroy=function(){ca.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,this._material.id),this._context.stage.remove(3,this._bottomMaterial.id))};aa.createGraphics3DGraphic=function(ka){const da=ka.graphic;if(!this._validateGeometryType(da.geometry,R.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(da.geometry))return null;const fa="graphic"+da.uid,ea=this._getVertexOpacityAndColor(ka.renderingInfo,
Float32Array,255),Y=this.setGraphicElevationContext(da,new C.ElevationContext);return this._createAs3DShape(da,ka.renderingInfo,ea,Y,fa,da.uid)};aa.layerOpacityChanged=function(ka,da){var fa=a.get(this.symbolLayer,"material","color");fa=this._getCombinedOpacity(fa);const ea=1>fa||this.needsDrivenTransparentPass;this._material.setParameterValues({opacity:fa,transparent:ea});this._bottomMaterial.setParameterValues({opacity:fa,transparent:ea});const Y=this._getLayerOpacity();ka.forEach(Z=>{Z=da(Z);a.isSome(Z)&&
Z.layerOpacityChanged(Y,this._context.isAsync)});return!0};aa.layerElevationInfoChanged=function(ka,da){return this.updateGraphics3DGraphicElevationInfo(ka,da,x.needsElevationUpdates3D)};aa.slicePlaneEnabledChanged=function(ka,da){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});this._bottomMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});ka.forEach(fa=>{fa=da(fa);a.isSome(fa)&&fa.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,
this._context.isAsync)});return!0};aa.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._bottomMaterial.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};aa.pixelRatioChanged=function(){return!0};aa._getExtrusionSize=function(ka){if(ka.size&&this._drivenProperties.size){var da;ka=null!=(da=E.getDriverAxisSizeValue(ka.size,2))?da:0}else ka=this._getSymbolSize();
return ka/=this._context.renderCoordsHelper.unitInMeters};aa._getSymbolSize=function(){var ka;return null!=(ka=this.symbolLayer.size)?ka:1};aa._createAs3DShape=function(ka,da,fa,ea,Y,Z){var ba=G.geometryAsPolygon(ka.geometry);if(a.isNone(ba))return null;ka=G.geometryToRenderInfo(ba,this._context.elevationProvider,this._context.renderCoordsHelper,ea);this._logGeometryCreationWarnings(ka,ba.rings,"rings","ExtrudeSymbol3DLayer");if(0===ba.rings.length||!ba.rings.some(db=>0<db.length))return null;var ia=
B.computeCentroid(ba);if(a.isNone(ia))return null;var ja=[];const la=[],qa=[],na=q.create(),oa=f.create(),ua=l.create(),za=1===this._context.renderCoordsHelper.viewingMode;za||this._context.renderCoordsHelper.worldUpAtPosition(null,ua);c.computeLinearTransformation(ba.spatialReference,[ia.x,ia.y,0],oa,this._context.renderCoordsHelper.spatialReference);ba=f.create();d.invert(ba,oa);ia=e.create();p.normalFromMat4(ia,ba);const {polygons:Fa,mapPosition:La,position:Sa}=ka;var Ia=Sa.length/3;const Qa=new Float64Array(18*
Ia),Pa=new Float64Array(18*Ia),sa=new Float64Array(18*Ia);Ia=new Float64Array(6*Ia);let Ga=0;for(let db=0;db<Fa.length;++db){var Ra=Fa[db];const mb=Ra.count;if(this._context.clippingExtent&&(q.empty(na),q.expandWithBuffer(na,Ra.mapPosition),!q.intersectsClippingArea(na,this._context.clippingExtent)))continue;const Ea=g.earcut(Ra.mapPosition,Ra.holeIndices,3);if(0===Ea.length)continue;const ya=new Uint32Array(6*mb+Ea.length);var Ua=new Uint32Array(Ea.length),ha=6*mb,Ya=3*Qa.BYTES_PER_ELEMENT;Ya=new n.BufferViewVec3f64(Qa.buffer,
Ga*Ya,Ya,(Ga+ha)*Ya);var Wa=3*Pa.BYTES_PER_ELEMENT;Wa=new n.BufferViewVec3f64(Pa.buffer,Ga*Wa,Wa,(Ga+ha)*Wa);const xa=new Float64Array(sa.buffer,3*Ga*sa.BYTES_PER_ELEMENT,3*ha);ha=new Float64Array(Ia.buffer,1*Ga*Ia.BYTES_PER_ELEMENT,1*ha);const wa=this._getExtrusionSize(da);I(Sa,La,Ea,Ra,Ya.typedBuffer,xa,Wa.typedBuffer,ha,0,ya,Ua,wa,ua,za);w.transformMat4(Ya,Ya,ba);w.transformMat3(Wa,Wa,ia);Ga+=6*mb;Ra=this._createExtrudeGeometry(ya,{positions:Ya.typedBuffer,elevation:xa,normals:Wa.typedBuffer,heights:ha},
fa);Ra=new A(Ra,Y+"path"+db);ja.push(Ra);la.push(this._material);qa.push(f.IDENTITY);Ua=this._createExtrudeGeometry(Ua,{positions:Ya.typedBuffer,elevation:xa,normals:Wa.typedBuffer,heights:ha},fa);Ua=new A(Ua,Y+"bottompath"+db);ja.push(Ua);la.push(this._bottomMaterial);qa.push(f.IDENTITY)}if(0===ja.length)return null;da=new y({geometries:ja,materials:la,transformations:qa,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:Z,isElevationSource:!0},idHint:Y});da.objectTransformation=
oa;fa=this._createEdgeMaterial();fa=a.isSome(fa)?{baseMaterial:this._material,edgeMaterials:[fa],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;ja=new z(this,da,ja,null,null,L,ea,fa);ja.alignedSampledElevation=ka.sampledElevation;ja.needsElevationUpdates=x.needsElevationUpdates3D(ea.mode);return ja};aa._createExtrudeGeometry=function(ka,da,fa){var ea=new Uint32Array(ka.length);const Y={};Y[u.VertexAttrConstants.POSITION]=ka;Y[u.VertexAttrConstants.NORMAL]=
ka;Y[u.VertexAttrConstants.COLOR]=ea;ea={};ea[u.VertexAttrConstants.POSITION]={size:3,data:da.positions};ea[u.VertexAttrConstants.NORMAL]={size:3,data:da.normals};ea[u.VertexAttrConstants.COLOR]={size:4,data:fa};ea[u.VertexAttrConstants.SIZE]={size:1,data:da.heights};da.elevation&&(ea.mapPos={size:3,data:da.elevation},Y.mapPos=ka);return new v.GeometryData(ea,Y)};aa._createEdgeMaterial=function(){const ka={opacity:this._getLayerOpacity()};return t.createMaterial(this.symbolLayer,ka)};return R}(D.Graphics3DSymbolLayer);
D.validGeometryTypes=["polygon","extent"];const S=l.create(),M=l.create(),T=l.create(),O=l.create(),Q=l.create(),F=l.create(),N=l.create(),P=l.create(),U=l.create(),V=[0,2,1],W=[0,1,2],X={verticalDistanceToGround:0,sampledElevation:0};b.Graphics3DExtrudeSymbolLayer=D;b.default=D;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/libs/earcut/earcut":function(){define(["exports"],function(b){function k(x,C,z,A,t){let D;if(t===0<n(x,C,z,A))for(;C<z;C+=A)D=h(C,x[C],x[C+1],D);else for(z-=A;z>=
C;z-=A)D=h(z,x[z],x[z+1],D);D&&u(D,D.next)&&(d(D),D=D.next);return D}function a(x,C=x){if(!x)return x;let z;do if(z=!1,x.steiner||!u(x,x.next)&&0!==g(x.prev,x,x.next))x=x.next;else{d(x);x=C=x.prev;if(x===x.next)break;z=!0}while(z||x!==C);return C}function r(x,C,z,A,t,D,E=0){if(x){!E&&D&&(x=f(x,A,t,D));for(var G=x;x.prev!==x.next;){var H=x.prev,I=x.next;if(D)var J=l(x,A,t,D);else a:{J=x;var K=J.prev,L=J;const S=J.next;if(0<=g(K,L,S)){J=!1;break a}let M=J.next.next;const T=M;let O=0;for(;M!==J.prev&&
(0===O||M!==T);){O++;if(w(K.x,K.y,L.x,L.y,S.x,S.y,M.x,M.y)&&0<=g(M.prev,M,M.next)){J=!1;break a}M=M.next}J=!0}if(J)C.push(H.index/z),C.push(x.index/z),C.push(I.index/z),d(x),G=x=I.next;else if(x=I,x===G){if(!E)r(a(x),C,z,A,t,D,1);else if(1===E){E=C;G=z;H=x;do I=H.prev,J=H.next.next,!u(I,J)&&p(I,H,H.next,J)&&q(I,J)&&q(J,I)&&(E.push(I.index/G),E.push(H.index/G),E.push(J.index/G),d(H),d(H.next),H=x=J),H=H.next;while(H!==x);x=H;r(x,C,z,A,t,D,2)}else if(2===E)a:{E=x;do{for(G=E.next.next;G!==E.prev;){if(H=
E.index!==G.index){J=J=J=void 0;H=E;I=G;if(J=H.next.index!==I.index&&H.prev.index!==I.index){b:{J=H;do{if(J.index!==H.index&&J.next.index!==H.index&&J.index!==I.index&&J.next.index!==I.index&&p(J,J.next,H,I)){J=!0;break b}J=J.next}while(J!==H);J=!1}J=!J}if(J=J&&q(H,I)&&q(I,H)){J=H;K=!1;L=(H.x+I.x)/2;I=(H.y+I.y)/2;do J.y>I!==J.next.y>I&&J.next.y!==J.y&&L<(J.next.x-J.x)*(I-J.y)/(J.next.y-J.y)+J.x&&(K=!K),J=J.next;while(J!==H);J=K}H=J}if(H){x=y(E,G);E=a(E,E.next);x=a(x,x.next);r(E,C,z,A,t,D);r(x,C,z,
A,t,D);break a}G=G.next}E=E.next}while(E!==x)}break}}}}function l(x,C,z,A){const t=x.prev,D=x.next;if(0<=g(t,x,D))return!1;const E=t.x>x.x?t.x>D.x?t.x:D.x:x.x>D.x?x.x:D.x,G=t.y>x.y?t.y>D.y?t.y:D.y:x.y>D.y?x.y:D.y,H=m(t.x<x.x?t.x<D.x?t.x:D.x:x.x<D.x?x.x:D.x,t.y<x.y?t.y<D.y?t.y:D.y:x.y<D.y?x.y:D.y,C,z,A);C=m(E,G,C,z,A);z=x.prevZ;for(A=x.nextZ;z&&z.z>=H&&A&&A.z<=C;){if(z!==x.prev&&z!==x.next&&w(t.x,t.y,x.x,x.y,D.x,D.y,z.x,z.y)&&0<=g(z.prev,z,z.next))return!1;z=z.prevZ;if(A!==x.prev&&A!==x.next&&w(t.x,
t.y,x.x,x.y,D.x,D.y,A.x,A.y)&&0<=g(A.prev,A,A.next))return!1;A=A.nextZ}for(;z&&z.z>=H;){if(z!==x.prev&&z!==x.next&&w(t.x,t.y,x.x,x.y,D.x,D.y,z.x,z.y)&&0<=g(z.prev,z,z.next))return!1;z=z.prevZ}for(;A&&A.z<=C;){if(A!==x.prev&&A!==x.next&&w(t.x,t.y,x.x,x.y,D.x,D.y,A.x,A.y)&&0<=g(A.prev,A,A.next))return!1;A=A.nextZ}return!0}function h(x,C,z,A){x=new B(x,C,z);A?(x.next=A.next,x.prev=A,A.next.prev=x,A.next=x):(x.prev=x,x.next=x);return x}function d(x){x.next.prev=x.prev;x.prev.next=x.next;x.prevZ&&(x.prevZ.nextZ=
x.nextZ);x.nextZ&&(x.nextZ.prevZ=x.prevZ)}function c(x){let C=x,z=x;do{if(C.x<z.x||C.x===z.x&&C.y<z.y)z=C;C=C.next}while(C!==x);return z}function e(x,C){let z=C;const A=x.x,t=x.y;let D=-Infinity,E;do{if(t<=z.y&&t>=z.next.y&&z.next.y!==z.y){var G=z.x+(t-z.y)*(z.next.x-z.x)/(z.next.y-z.y);if(G<=A&&G>D){D=G;if(G===A){if(t===z.y)return z;if(t===z.next.y)return z.next}E=z.x<z.next.x?z:z.next}}z=z.next}while(z!==C);if(!E)return null;if(A===D)return E.prev;C=E;G=E.x;const H=E.y;let I=Infinity,J;for(z=E.next;z!==
C;)A>=z.x&&z.x>=G&&A!==z.x&&w(t<H?A:D,t,G,H,t<H?D:A,t,z.x,z.y)&&(J=Math.abs(t-z.y)/(A-z.x),(J<I||J===I&&z.x>E.x)&&q(z,x)&&(E=z,I=J)),z=z.next;return E}function f(x,C,z,A){for(var t;t!==x;t=t.next){t=t||x;null===t.z&&(t.z=m(t.x,t.y,C,z,A));if(t.prev.next!==t||t.next.prev!==t)return t.prev.next=t,t.next.prev=t,f(x,C,z,A);t.prevZ=t.prev;t.nextZ=t.next}x.prevZ.nextZ=null;x.prevZ=null;a:for(z=1;;){A=x;C=x=null;let D=0;for(;A;){D++;t=A;let E=0;for(;E<z&&t;E++)t=t.nextZ;let G=z;for(;0<E||0<G&&t;){let H;
0===E?(H=t,t=t.nextZ,G--):0!==G&&t?A.z<=t.z?(H=A,A=A.nextZ,E--):(H=t,t=t.nextZ,G--):(H=A,A=A.nextZ,E--);C?C.nextZ=H:x=H;H.prevZ=C;C=H}A=t}C.nextZ=null;z*=2;if(2>D)break a}return x}function g(x,C,z){return(C.y-x.y)*(z.x-C.x)-(C.x-x.x)*(z.y-C.y)}function p(x,C,z,A){return u(x,C)&&u(z,A)||u(x,A)&&u(z,C)?!0:0<g(x,C,z)!==0<g(x,C,A)&&0<g(z,A,x)!==0<g(z,A,C)}function n(x,C,z,A){let t=0;for(let D=C,E=z-A;D<z;D+=A)t+=(x[E]-x[D])*(x[D+1]+x[E+1]),E=D;return t}function w(x,C,z,A,t,D,E,G){return 0<=(t-E)*(C-G)-
(x-E)*(D-G)&&0<=(x-E)*(A-G)-(z-E)*(C-G)&&0<=(z-E)*(D-G)-(t-E)*(A-G)}function q(x,C){return 0>g(x.prev,x,x.next)?0<=g(x,C,x.next)&&0<=g(x,x.prev,C):0>g(x,C,x.prev)||0>g(x,x.next,C)}function m(x,C,z,A,t){x=32767*(x-z)*t;C=32767*(C-A)*t;x=(x|x<<8)&16711935;x=(x|x<<4)&252645135;x=(x|x<<2)&858993459;C=(C|C<<8)&16711935;C=(C|C<<4)&252645135;C=(C|C<<2)&858993459;return(x|x<<1)&1431655765|((C|C<<1)&1431655765)<<1}function u(x,C){return x.x===C.x&&x.y===C.y}function v(x,C){return x.x-C.x}function y(x,C){const z=
new B(x.index,x.x,x.y),A=new B(C.index,C.x,C.y),t=x.next,D=C.prev;x.next=C;C.prev=x;z.next=t;t.prev=z;A.next=z;z.prev=A;D.next=A;A.prev=D;return A}let B=function(x,C,z){this.index=x;this.x=C;this.y=z;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1};b.deviation=function(x,C,z,A){var t=C&&C.length;let D=Math.abs(n(x,0,t?C[0]*z:x.length,z));if(t)for(let E=0,G=C.length;E<G;E++)D-=Math.abs(n(x,C[E]*z,E<G-1?C[E+1]*z:x.length,z));C=0;for(t=0;t<A.length;t+=3){const E=A[t]*z,G=A[t+1]*
z,H=A[t+2]*z;C+=Math.abs((x[E]-x[H])*(x[G+1]-x[E+1])-(x[E]-x[G])*(x[H+1]-x[E+1]))}return 0===D&&0===C?0:Math.abs((C-D)/D)};b.earcut=function(x,C,z){var A=C&&C.length;const t=A?C[0]*z:x.length;var D=k(x,0,t,z,!0);const E=[];if(!D||D.next===D.prev)return E;let G,H;var I,J;if(A){A=[];for(let L=0,S=C.length;L<S;L++){var K=k(x,C[L]*z,L<S-1?C[L+1]*z:x.length,z,!1);K===K.next&&(K.steiner=!0);A.push(c(K))}A.sort(v);for(J of A){C=J;A=D;if(A=e(C,A))C=y(A,C),a(C,C.next);D=a(D,D.next)}}if(x.length>80*z){G=I=
x[0];H=J=x[1];for(C=z;C<t;C+=z)A=x[C],K=x[C+1],G=Math.min(G,A),H=Math.min(H,K),I=Math.max(I,A),J=Math.max(J,K);I=Math.max(I-G,J-H);I=0!==I?1/I:0}r(D,E,z,G,H,I);return E};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/vec32":function(){define(["exports","../views/3d/support/buffer/math/common"],function(b,k){function a(c,e,f){if(c.count!==e.count)k.logger.error("source and destination buffers need to have the same number of elements");else{var g=c.count,p=f[0],n=f[1],w=f[2],q=f[4],
m=f[5],u=f[6],v=f[8],y=f[9],B=f[10],x=f[12],C=f[13];f=f[14];var z=c.typedBuffer;c=c.typedBufferStride;var A=e.typedBuffer;e=e.typedBufferStride;for(let D=0;D<g;D++){const E=D*c;var t=D*e;const G=A[t],H=A[t+1];t=A[t+2];z[E]=p*G+q*H+v*t+x;z[E+1]=n*G+m*H+y*t+C;z[E+2]=w*G+u*H+B*t+f}}}function r(c,e,f){if(c.count!==e.count)k.logger.error("source and destination buffers need to have the same number of elements");else{var g=c.count,p=f[0],n=f[1],w=f[2],q=f[3],m=f[4],u=f[5],v=f[6],y=f[7];f=f[8];var B=c.typedBuffer;
c=c.typedBufferStride;var x=e.typedBuffer;e=e.typedBufferStride;for(let z=0;z<g;z++){const A=z*c;var C=z*e;const t=x[C],D=x[C+1];C=x[C+2];B[A]=p*t+q*D+v*C;B[A+1]=n*t+m*D+y*C;B[A+2]=w*t+u*D+f*C}}}function l(c,e,f){const g=Math.min(c.count,e.count),p=c.typedBuffer;c=c.typedBufferStride;const n=e.typedBuffer;e=e.typedBufferStride;for(let w=0;w<g;w++){const q=w*c,m=w*e;p[q]=f*n[m];p[q+1]=f*n[m+1];p[q+2]=f*n[m+2]}}function h(c,e,f){const g=Math.min(c.count,e.count),p=c.typedBuffer;c=c.typedBufferStride;
const n=e.typedBuffer;e=e.typedBufferStride;for(let w=0;w<g;w++){const q=w*c,m=w*e;p[q]=n[m]>>f;p[q+1]=n[m+1]>>f;p[q+2]=n[m+2]>>f}}var d=Object.freeze({__proto__:null,transformMat4:a,transformMat3:r,scale:l,shiftRight:h});b.scale=l;b.shiftRight=h;b.transformMat3=r;b.transformMat4=a;b.vec3=d})},"esri/views/3d/support/buffer/math/common":function(){define(["exports","../../../../../core/Logger"],function(b,k){k=k.getLogger("esri.views.3d.support.buffer.math");b.logger=k;Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../core/maybe","../../Color","../visualVariables/support/visualVariableUtils"],function(b,k,a,r){function l(c,e){if(!c||c.symbol)return null;e=e&&e.renderer;return c&&k.isSome(e)&&e.getObservationRenderer?e.getObservationRenderer(c):e}function h(c,e){if(k.isSome(c.symbol))return c.symbol;const f=l(c,e);return k.isSome(f)?f.getSymbol(c,e):null}async function d(c,e){if(k.isSome(c.symbol))return c.symbol;const f=
l(c,e);return k.isSome(f)&&f.getSymbolAsync(c,{...e,abortOptions:{signal:e.signal}})}b.getDriverAxisSizeValue=function(c,e=0){c=c[e];return"number"===typeof c&&isFinite(c)?c:null};b.getDriverAxisSizeValueAny=function(c){for(let e=0;3>e;e++){const f=c[e];if("number"===typeof f)return isFinite(f)?f:0}return 0};b.getRenderer=l;b.getRenderingInfo=function(c,e){const f=l(c,e);var g=h(c,e);if(!g)return null;g={renderer:f,symbol:g};if(k.isNone(f)||!("visualVariables"in f)||!f.visualVariables)return g;e=
r.getVisualVariableValues(f,c,e);c=["proportional","proportional","proportional"];for(const {variable:p,value:n}of e)switch(p.type){case "color":g.color=n.toRgba();break;case "size":if("outline"===p.target)g.outlineSize=n;else switch(e=p.useSymbolValue?"symbol-value":n,p.axis){case "width":c[0]=e;break;case "depth":c[1]=e;break;case "height":c[2]=e;break;case "width-and-depth":c[0]=c[1]=e;break;default:c[0]=c[1]=c[2]=e}break;case "opacity":g.opacity=n;break;case "rotation":switch(p.axis){case "tilt":g.tilt=
n;break;case "roll":g.roll=n;break;default:g.heading=n}}if("proportional"!==c[0]||"proportional"!==c[1]||"proportional"!==c[2])g.size=c;return g};b.getRenderingInfoAsync=async function(c,e){var f=l(c,e),g=await d(c,e);if(!g)return null;g={renderer:f,symbol:g};if(!(f&&"visualVariables"in f&&f.visualVariables))return g;e=r.getVisualVariableValues(f,c,e);c=["proportional","proportional","proportional"];for(const {variable:p,value:n}of e)"color"===p.type?g.color=a.toUnitRGBA(n):"size"===p.type?"outline"===
p.target?g.outlineSize=n:(e=p.axis,f=p.useSymbolValue?"symbol-value":n,"width"===e?c[0]=f:"depth"===e?c[1]=f:"height"===e?c[2]=f:c[0]="width-and-depth"===e?c[1]=f:c[1]=c[2]=f):"opacity"===p.type?g.opacity=n:"rotation"===p.type&&"tilt"===p.axis?g.tilt=n:"rotation"===p.type&&"roll"===p.axis?g.roll=n:"rotation"===p.type&&(g.heading=n);if(isFinite(c[0])||isFinite(c[1])||isFinite(c[2]))g.size=c;return g};b.getSymbol=h;b.getSymbolAsync=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../core/maybe ../../../../geometry/Extent ../../../../geometry/Polygon ../../../../geometry ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ../../webgl-engine/lib/Util ../../webgl-engine/lib/GeometryData ./elevationAlignmentUtils ../../terrain/OverlayRenderer".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){function p(w,q,m){const u=[];for(const {index:v,count:y}of w){if(1>=y)continue;w=3*v;const B=w+3*y;u.push({index:v,count:y,position:q.subarray(w,B),mapPosition:m?m.subarray(w,B):void 0})}return u}function n(w,q,m){const u=[];for(const {index:v,count:y,holeIndices:B,pathLengths:x}of w){if(1>=y)continue;w=3*v;const C=w+3*y,z=B.map(A=>A-v);u.push({index:v,count:y,holeIndices:z,pathLengths:x,position:q.subarray(w,C),mapPosition:m?m.subarray(w,C):void 0})}return u}b.createColorGeometryData=
function(w){const q={},m={};m[c.VertexAttrConstants.POSITION]={size:3,data:w.attributeData.position};q[c.VertexAttrConstants.POSITION]=w.indices;if(k.isSome(w.attributeData.color)){const u=new Uint32Array(w.indices.length);m[c.VertexAttrConstants.COLOR]={size:4,data:w.attributeData.color};q[c.VertexAttrConstants.COLOR]=u}k.isSome(w.attributeData.uvMapSpace)&&(m[c.VertexAttrConstants.UVMAPSPACE]={size:4,data:w.attributeData.uvMapSpace},q[c.VertexAttrConstants.UVMAPSPACE]=w.indices);k.isSome(w.attributeData.bound1)&&
(m[c.VertexAttrConstants.BOUND1]={size:3,data:w.attributeData.bound1},q[c.VertexAttrConstants.BOUND1]=w.indices);k.isSome(w.attributeData.bound2)&&(m[c.VertexAttrConstants.BOUND2]={size:3,data:w.attributeData.bound2},q[c.VertexAttrConstants.BOUND2]=w.indices);k.isSome(w.attributeData.bound3)&&(m[c.VertexAttrConstants.BOUND3]={size:3,data:w.attributeData.bound3},q[c.VertexAttrConstants.BOUND3]=w.indices);k.isSome(w.attributeData.mapPosition)&&(m.mapPos={size:3,data:w.attributeData.mapPosition},q.mapPos=
w.indices);return new e.GeometryData(m,q)};b.createWaterGeometryData=function(w){const q={},m={};m[c.VertexAttrConstants.POSITION]={size:3,data:w.attributeData.position};q[c.VertexAttrConstants.POSITION]=w.indices;m[c.VertexAttrConstants.UV0]={size:2,data:w.attributeData.uv0};q[c.VertexAttrConstants.UV0]=w.indices;k.isSome(w.attributeData.mapPosition)&&(m.mapPos={size:3,data:w.attributeData.mapPosition},q.mapPos=w.indices);return new e.GeometryData(m,q)};b.geometryAsPolygon=function(w){switch(w.type){case "extent":if(w instanceof
a)return r.fromExtent(w);break;case "polygon":return w}return null};b.geometryToRenderInfo=function(w,q,m,u){const v=d.pathsToTriangulationInfo(w.rings,w.hasZ,1),y=new Float64Array(v.position.length);w=f.applyPerVertexElevationAlignment(v.position,w.spatialReference,0,y,0,v.position,0,v.position.length/3,q,m,u);q=null!=w;return{position:v.position,mapPosition:y,polygons:n(v.polygons,v.position,y),outlines:p(v.outlines,v.position,y),projectionSuccess:q,sampledElevation:w}};b.geometryToRenderInfoDraped=
function(w,q){const m=d.pathsToTriangulationInfo(w.rings,!1,1);w=h.projectBuffer(m.position,w.spatialReference,0,m.position,q,0,m.position.length/3);for(q=2;q<m.position.length;q+=3)m.position[q]=g.DRAPED_Z;return{position:m.position,polygons:n(m.polygons,m.position),outlines:p(m.outlines,m.position),projectionSuccess:w}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/geometry/support/triangulationUtils":function(){define(["exports","./coordsUtils","../../core/libs/earcut/earcut","./meshUtils/deduplicate"],
function(b,k,a,r){function l(c,e,f){if(1===c.length)return c[0];e=new Float64Array(e);f=new Uint32Array(f);let g=0,p=0,n=0;for(const w of c){for(c=0;c<w.position.length;c++)e[g++]=w.position[c];for(c=0;c<w.faces.length;c++)f[p++]=w.faces[c]+n;n=g/3}return{position:e,faces:f}}function h(c,e,f){const g=c.length,p=Array(g),n=Array(g),w=Array(g);let q=0,m=0,u=0;var v=0;for(var y=0;y<g;++y)v+=c[y].length;v=new Float64Array(3*v);y=0;for(let z=g-1;0<=z;z--){var B=c[z],x=1===f?!k.isClockwise(B,!1,!1):!1;
if(x&&1!==g)p[q++]=B;else{var C=B.length;for(let A=0;A<q;++A)C+=p[A].length;C={index:y,pathLengths:Array(q+1),count:C,holeIndices:Array(q)};C.pathLengths[0]=B.length;0<B.length&&(w[u++]={index:y,count:B.length});y=x?d(B,B.length-1,-1,v,y,B.length,e):d(B,0,1,v,y,B.length,e);for(B=0;B<q;++B)x=p[B],C.holeIndices[B]=y,C.pathLengths[B+1]=x.length,0<x.length&&(w[u++]={index:y,count:x.length}),y=d(x,0,1,v,y,x.length,e);q=0;0<C.count&&(n[m++]=C)}}for(c=0;c<q;++c)f=p[c],0<f.length&&(w[u++]={index:y,count:f.length}),
y=d(f,0,1,v,y,f.length,e);m<g&&(n.length=m);u<g&&(w.length=u);return{position:v,polygons:n,outlines:w}}function d(c,e,f,g,p,n,w){p*=3;for(let q=0;q<n;++q){const m=c[e];g[p++]=m[0];g[p++]=m[1];g[p++]=w?m[2]:0;e+=f}return p/3}b.pathsToTriangulationInfo=h;b.triangulate=function(c){c=h(c.rings,c.hasZ,1);const e=[];let f=0,g=0;for(var p of c.polygons){const w=p.index,q=new Float64Array(c.position.buffer,3*w*c.position.BYTES_PER_ELEMENT,3*p.count);var n=p.holeIndices.map(m=>m-w);n=new Uint32Array(a.earcut(q,
n,3));e.push({position:q,faces:n});f+=q.length;g+=n.length}p=l(e,f,g);c=r.deduplicate(p.position.buffer,6,{originalIndices:p.faces});p.position=new Float64Array(c.buffer);p.faces=c.indices;return p};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils"],function(b,k){function a(l,h,d){var c=l.byteLength/(4*h),e=new Uint32Array(l,0,c*h);l=new Uint32Array(c);var f=d&&d.minReduction||0;const g=d&&d.originalIndices||
null;var p=d&&d.componentOffsets||null;d=0;if(p)for(var n=0;n<p.length-1;n++){var w=p[n+1]-p[n];w>d&&(d=w)}else d=c;var q=Math.floor(1.1*d)+1;if(null==r||r.length<2*q)r=new Uint32Array(k.nextHighestPowerOfTwo(2*q));for(d=0;d<2*q;d++)r[d]=0;d=0;w=(n=!!p&&!!g)?g.length:c;var m=n?new Uint32Array(g.length):null,u=0!==f?Math.ceil(7.84*1.96/(f*f)*f*(1-f)):w,v=1,y=p?p[1]:w;for(var B=0;B<w;B++){if(B===u){var x=1-d/B;if(x+1.96*Math.sqrt(x*(1-x)/B)<f)return null;u*=2}if(B===y){for(y=0;y<2*q;y++)r[y]=0;if(g)for(y=
p[v-1];y<p[v];y++)m[y]=l[g[y]];y=p[++v]}x=n?g[B]:B;const t=x*h;var C=0;for(var z=0;z<h;z++)C=e[t+z]+C|0,C=C+(C<<11)+(C>>>2)|0;C>>>=0;z=C%q;let D=d;for(;0!==r[2*z+1];){if(r[2*z]===C){const E=r[2*z+1]-1;var A=E*h;a:{for(let G=0;G<h;G++)if(e[t+G]!==e[A+G]){A=!1;break a}A=!0}if(A){D=l[E];break}}z++;z>=q&&(z-=q)}D===d&&(r[2*z]=C,r[2*z+1]=x+1,d++);l[x]=D}if(0!==f&&1-d/c<f)return null;if(n){for(c=p[v-1];c<m.length;c++)m[c]=l[g[c]];l=m}c=new Uint32Array(h*d);d=0;for(v=0;v<w;v++)if(l[v]===d){f=e;p=(n?g[v]:
v)*h;q=c;m=d*h;u=h;for(B=0;B<u;B++)q[m+B]=f[p+B];d++}if(g&&!n){h=new Uint32Array(g.length);for(e=0;e<h.length;e++)h[e]=l[g[e]];l=h}return{buffer:c.buffer,indices:l,uniqueCount:d}}let r=null;b.deduplicate=a;b.default=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/PooledArray ../../../core/Accessor ../../../chunks/vec3f64 ../../../core/Handles ../../../core/watchUtils ../../../chunks/mat4 ../../../core/MapUtils ../../../chunks/vec2f64 ../../webgl/Texture ../../webgl/Util ../webgl-engine/lib/glUtil3D ../webgl-engine/lighting/Lightsources ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/Camera ../support/debugFlags ../webgl-engine/lib/AutoDisposable ./OverlayRenderTarget ./Overlay ../webgl-engine/core/shaderTechnique/CommonUniformStore ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/GLMaterialRep ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/RenderContext ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/TextureTechnique ../webgl-engine/lighting/SceneLighting ../webgl-engine/materials/lineStippleUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q,F,N){const P=h.getLogger("esri.views.3d.webgl-engine.lib.OverlayRenderer");b.OverlayRenderer=function(R){function aa(da){da=R.call(this,da)||this;da._overlays=null;da._hasHighlights=!1;da._rendersOccluded=!1;da._hasWater=!1;da._lighting=new F.SceneLighting;da._localOrigins=new M;da._handles=new u;da._layerRenderers=new Map;da._sortedLayerRenderersDirty=!1;da._sortedLayerRenderers=new w;da._geometries=new Map;da._uniqueIdx=
0;da.globalUnitScale=1;da.longitudeCyclical=null;return da}k._inheritsLoose(aa,R);var ka=aa.prototype;ka.initialize=function(){this._rctx=this.renderView.renderingContext;this._renderContext=new T(this._rctx,null,null,null,null,null);this._stippleTextureRepository=new N.StippleTextureRepository;this.waterTextureRepository=this.renderView.waterTextureRepository;this._shaderTechniqueRepository=new L.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:2,commonUniformStore:new K.CommonUniformStore,
stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:this.waterTextureRepository});v.init(this.waterTextureRepository,"loadingState",()=>this.emitContentChanged());this._materialRepository=new S(this.renderView.textureRepository,this._shaderTechniqueRepository);this._materialRepository.onMaterialChanged=da=>{0<(da.renderOccluded&4)!==this._rendersOccluded&&this.updateRendersOccluded();this.emitContentChanged();this.notifyChange("updating")};this._compositingHelper=this.renderView.compositingHelper;
this._lighting.set({lights:[new t.AmbientLight(m.fromValues(1,1,1))],groundLightingFactor:1,globalFactor:0});this._bindParameters={slot:null,highlightDepthTexture:A.createEmptyDepthTexture(this._rctx),camera:W,inverseViewport:x.create(),origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,shadowMappingEnabled:!1,slicePlane:null,ssaoEnabled:!1,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrEnabled:!1,
lighting:this._lighting,transparencyPassType:3}};ka.dispose=function(){this._handles.destroy();this._layerRenderers.forEach(da=>da.dispose());this._layerRenderers.clear();this._bindParameters.highlightDepthTexture.dispose();this._bindParameters.highlightDepthTexture=null;this._shaderTechniqueRepository.dispose();this._shaderTechniqueRepository=null};ka.forEachOverlay=function(da){l.isSome(this._overlays)&&(da(this._overlays[0],0),da(this._overlays[1],1))};ka.ensureOverlays=function(){if(l.isNone(this._overlays)){const da=
this.renderView.renderingContext;this._overlays=[new J.Overlay(da,0),new J.Overlay(da,1)]}};ka.disposeOverlays=function(){l.isSome(this._overlays)&&(this._overlays.forEach(da=>da.dispose()),this._overlays=null)};ka.commitChanges=function(){let da=!1;this._layerRenderers.forEach((fa,ea)=>{fa.commitChanges()&&(da=!0);fa.isEmpty&&(this._layerRenderers.delete(ea),this._sortedLayerRenderersDirty=!0,this._handles.remove(ea))});this._sortedLayerRenderersDirty&&(this.updateSortedLayerRenderers(),da=!0);da&&
(this.notifyChange("updating"),this.emitContentChanged(),this.updateHasHighlights(),this.updateRendersOccluded(),this.updateHasWater())};ka.addGeometries=function(da,fa,ea){for(const Y of da)null==Y.origin&&(Y.origin=this._localOrigins.getOrigin(Y.center)),Y.uniqueName||(Y.uniqueName=`ov:${this._uniqueIdx++}`),this._geometries.set(Y.uniqueName,Y);this.ensureLayerRenderer(fa).add(da);2===ea&&this.notifyGraphicUpdate(da,fa,2)};ka.removeGeometries=function(da,fa,ea){for(var Y of da)this._geometries.delete(Y.uniqueName);
if(Y=this._layerRenderers.get(fa))Y.remove(da),2===ea&&this.notifyGraphicUpdate(da,fa,2)};ka.updateGeometries=function(da,fa,ea){const Y=this._layerRenderers.get(fa);Y?(Y.modify(da,ea),this.notifyUpdateGeometries(da,fa,ea)):P.warn("Attempted to update geometry for nonexistent layer")};ka.notifyUpdateGeometries=function(da,fa,ea){this.notifyGraphicUpdate(da,fa,4===ea||2===ea?2:1===ea?1:0)};ka.notifyGraphicUpdate=function(da,fa,ea){if(0!==ea&&!l.isNone(fa.notifyGraphicUpdate)){var Y=-1;for(const Z of da)da=
Z.data.graphicUid,da!==Y&&(fa.notifyGraphicUpdate(da,ea),Y=da)}};ka.updateHighlights=function(da,fa){(fa=this._layerRenderers.get(fa))?fa.modify(da,8):P.warn("Attempted to update highlights for nonexistent layer")};ka.isEmpty=function(){return 0===this._geometries.size&&!G.OVERLAY_DRAW_DEBUG_TEXTURE};ka.updateLogic=function(da){let fa=!1;this._layerRenderers.forEach(ea=>{ea.updateLogic(da)&&(fa=!0)});return fa};ka.updateLayerOrder=function(){this._sortedLayerRenderersDirty=!0};ka.drawPass=function(da,
fa,ea,Y=0){if(0===ea.numViews)return!1;this._screenToWorldRatio=ea.pixelRatio*Math.abs(ea.views[0].extent[2]-ea.views[0].extent[0])/Math.abs(ea.views[0].viewport[2]-ea.views[0].viewport[0]);if(this.isEmpty()||5===da&&!this.hasHighlights||3===da&&!this.hasWater||!this.hasNonZeroSizedView(ea))return!1;const Z=ea.width,ba=ea.height;if(!fa.isValid())return!1;fa.resize(Z,ba);const ia=this._rctx;W.pixelRatio=ea.pixelRatio||1;this._renderContext.pass=da;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;
this._bindParameters.screenToWorldRatioGlobalWM=this._screenToWorldRatio*this.globalUnitScale;fa.bind(ia);ia.setClearColor(0,0,0,0);ia.clearSafe(16384);1===Y&&(this._renderContext.renderOccludedMask=4);if(G.OVERLAY_DRAW_DEBUG_TEXTURE&&1!==Y)for(let ja=0;ja<ea.numViews;ja++)this.setViewParameters(ea.views[ja],W),this.drawDebugTexture(Z,ba,V[ea.index%V.length]);0<this._layerRenderers.size&&this._sortedLayerRenderers.forAll(({layerView:ja,renderer:la})=>{if(2!==Y||!l.isSome(ja)||0!==ja.drapeSourceType){var qa=
l.isSome(ja)&&l.isSome(ja.fullOpacity)&&1>ja.fullOpacity&&0===da;qa&&(this.bindTemporaryFramebuffer(this._rctx,Z,ba),ia.clearSafe(16384));for(let na=0;na<ea.numViews;na++)this.setViewParameters(ea.views[na],W),la.draw(this._renderContext,this._bindParameters);qa&&l.isSome(this._temporaryRenderTarget)&&(fa.bind(ia),this._compositingHelper.composite(this._temporaryRenderTarget.getTexture(),2,l.unwrap(l.unwrap(ja).fullOpacity)))}});ia.bindFramebuffer(null);fa.generateMipMap();this._renderContext.resetRenderOccludedMask();
return!0};ka.bindTemporaryFramebuffer=function(da,fa,ea){l.isNone(this._temporaryRenderTarget)&&(this._temporaryRenderTarget=new I.OverlayRenderTarget(da,"temp",0,!1));this._temporaryRenderTarget.resize(fa,ea);this._temporaryRenderTarget.bind(da)};ka.reloadShaders=async function(){await this._shaderTechniqueRepository.hotReload()};ka.intersect=function(da,fa,ea){let Y=0;this._geometries.forEach(Z=>{if(!ea||ea(Z)){this.intersectRenderGeometry(Z,fa,0,da,Y);var ba=this.longitudeCyclical;ba&&(Z.center[0]-
Z.bsRadius<ba.min&&this.intersectRenderGeometry(Z,fa,ba.range,da,Y),Z.center[0]+Z.bsRadius>ba.max&&this.intersectRenderGeometry(Z,fa,-ba.range,da,Y));Y++}})};ka.intersectRenderGeometry=function(da,fa,ea,Y,Z){let ba=0;l.isSome(da.transformation)&&(ea+=da.transformation[12],ba=da.transformation[13]);X[0]=fa[0]-ea;X[1]=fa[1]-ba;X[2]=1;ca[0]=fa[0]-ea;ca[1]=fa[1]-ba;ca[2]=0;da.screenToWorldRatio=this._screenToWorldRatio;da.material.intersect(da,null,da.getShaderTransformation(),Y,X,ca,(ia,ja,la)=>{this.addIntersectionResult(la,
da.material.renderPriority,Z,Y,da.data.layerUid,da.data.graphicUid)},da.calculateShaderTransformation,!0)};ka.addIntersectionResult=function(da,fa,ea,Y,Z,ba){const ia={type:"external",metadata:{layerUid:Z,graphicUid:ba}};Z=ja=>{ja.set(ia,null,Y.results.ground.dist,Y.results.ground.normal,Y.results.ground.transformation,fa,null,null,da,ea);ja.intersector="OverlayRenderer"};(null==Y.results.min.drapedLayerOrder||fa>=Y.results.min.drapedLayerOrder)&&(null==Y.results.min.dist||Y.results.ground.dist<=
Y.results.min.dist)&&Z(Y.results.min);0!==Y.options.store&&(null==Y.results.max.drapedLayerOrder||fa<Y.results.max.drapedLayerOrder)&&(null==Y.results.max.dist||Y.results.ground.dist>Y.results.max.dist)&&Z(Y.results.max);2===Y.options.store&&(ba=new D.IntersectorResult(Y.ray),Z(ba),Y.results.all.push(ba))};ka.stopAnimationsAtTime=function(da){this._sortedLayerRenderers.forAll(fa=>fa.renderer.stopAnimationsAtTime(da))};ka.ensureLayerRenderer=function(da){let fa=this._layerRenderers.get(da);fa||(fa=
new O.SortedRenderGeometryRenderer({rctx:this._rctx,materialRepository:this._materialRepository}),this._layerRenderers.set(da,fa),this._sortedLayerRenderersDirty=!0,"fullOpacity"in da&&this._handles.add(da.watch("fullOpacity",()=>this.emitContentChanged()),da),this._handles.add(v.init(fa,"updating",()=>this.notifyChange("updating")),da));return fa};ka.updateSortedLayerRenderers=function(){if(this._sortedLayerRenderersDirty&&(this._sortedLayerRenderersDirty=!1,this._sortedLayerRenderers.clear(),0!==
this._layerRenderers.size)){var [{view:{allLayerViews:da}}]=this._layerRenderers.keys(),fa=new Set(this._layerRenderers.values());da.forEach(ea=>{const Y=this._layerRenderers.get(ea);Y&&(this._sortedLayerRenderers.push(new U(ea,Y)),fa.delete(Y))});fa.forEach(ea=>{this._sortedLayerRenderers.push(new U(null,ea))})}};ka.setViewParameters=function(da,fa){fa.viewport=da.viewport;const ea=da.extent;y.ortho(fa.projectionMatrix,0,ea[2]-ea[0],0,ea[3]-ea[1],fa.near,fa.far);y.identity(fa.viewMatrix);y.translate(fa.viewMatrix,
fa.viewMatrix,[-da.extent[0],-da.extent[1],0]);fa.setGLViewport(this._rctx);this._renderContext.camera=fa;this._bindParameters.camera=fa;this._bindParameters.inverseViewport[0]=1/fa.fullViewport[2];this._bindParameters.inverseViewport[1]=1/fa.fullViewport[3]};ka.hasNonZeroSizedView=function(da){for(let fa=0;fa<da.numViews;fa++){const ea=da.views[fa];if(ea.extent[0]!==ea.extent[2]&&ea.extent[1]!==ea.extent[3])return!0}return!1};ka.emitContentChanged=function(){if(this.onContentChanged)this.onContentChanged()};
ka.updateHasWater=function(){const da=B.someMap(this._layerRenderers,fa=>fa.hasWater);da!==this._hasWater&&(this._hasWater=da)};ka.updateHasHighlights=function(){const da=B.someMap(this._layerRenderers,fa=>fa.hasHighlights);if(da!==this._hasHighlights&&(this._hasHighlights=da,this.onHasHighlightsChanged))this.onHasHighlightsChanged(this._hasHighlights)};ka.updateRendersOccluded=function(){const da=B.someMap(this._layerRenderers,fa=>fa.rendersOccluded);if(da!==this._rendersOccluded&&(this._rendersOccluded=
da,this.onRendersOccludedChanged))this.onRendersOccludedChanged(this.rendersOccluded)};ka.drawDebugTexture=function(da,fa,ea){const Y=this._rctx;this.ensureDebugPatternResources(da,fa);da=this._debugTextureTechnique.program;Y.bindProgram(da);Y.setPipelineState(this._debugTextureTechnique.pipeline);da.setUniform4f("color",ea[0],ea[1],ea[2],1);da.setUniform1i("tex",0);Y.bindTexture(this._debugPatternTexture,0);Y.bindVAO(this._quadVAO);Y.drawArrays(5,0,z.vertexCount(this._quadVAO,"geometry"))};ka.ensureDebugPatternResources=
function(da,fa){if(!this._debugPatternTexture){var ea=new Uint8Array(da*fa*4),Y=0;for(let Z=0;Z<fa;Z++)for(let ba=0;ba<da;ba++){const ia=Math.floor(ba/10),ja=Math.floor(Z/10);2>ia||2>ja||10*ia>da-20||10*ja>fa-20?(ea[Y++]=255,ea[Y++]=255,ea[Y++]=255,ea[Y++]=255):(ea[Y++]=255,ea[Y++]=255,ea[Y++]=255,ia&1&&ja&1?ea[Y++]=ba&1^Z&1?0:255:ea[Y++]=ia&1^ja&1?0:128)}this._debugPatternTexture=new C(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:da,height:fa},ea);da=new Q.TextureTechniqueConfiguration;
da.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquireAndReleaseExisting(Q.TextureTechnique,da,this._debugTextureTechnique);this._quadVAO=A.createQuadVAO(this._rctx)}};k._createClass(aa,[{key:"updating",get:function(){return this._sortedLayerRenderersDirty||B.someMap(this._layerRenderers,da=>da.updating)||this.waterTextureRepository.updating}},{key:"hasOverlays",get:function(){return l.isSome(this._overlays)}},{key:"gpuMemoryUsage",get:function(){return l.isSome(this._overlays)?
this._overlays[0].getGpuMemoryUsage()+this._overlays[1].getGpuMemoryUsage():0}},{key:"overlays",get:function(){return this._overlays}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"test",get:function(){return{layerRenderers:this._layerRenderers}}}]);return aa}(H.AutoDisposableMixin(q));a.__decorate([H.autoDispose()],b.OverlayRenderer.prototype,"_shaderTechniqueRepository",
void 0);a.__decorate([H.autoDispose()],b.OverlayRenderer.prototype,"_stippleTextureRepository",void 0);a.__decorate([c.property(),H.autoDispose()],b.OverlayRenderer.prototype,"waterTextureRepository",void 0);a.__decorate([c.property({constructOnly:!0})],b.OverlayRenderer.prototype,"renderView",void 0);a.__decorate([c.property()],b.OverlayRenderer.prototype,"globalUnitScale",void 0);a.__decorate([c.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating"]})],b.OverlayRenderer.prototype,
"updating",null);b.OverlayRenderer=a.__decorate([f.subclass("esri.views.3d.terrain.OverlayRenderer")],b.OverlayRenderer);let U=function(R,aa){this.layerView=R;this.renderer=aa};const V=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],W=new E;W.near=1;W.far=1E4;W.relativeElevation=null;const X=m.create(),ca=m.create();b.DRAPED_Z=-2;b.overlayRenderOccludedFlag=4;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayRenderTarget":function(){define("exports ../../webgl/Program ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject ../../webgl/Renderbuffer ../../webgl/FramebufferObject ../../webgl/ProgramCache ../../webgl/RenderingContext ../../webgl/ShaderCompiler".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){k=function(){function p(w,q,m,u){this._renderTarget=null;this.id=`${q}_${++m}`;this._renderTarget=new c(w,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:u,maxAnisotropy:8,width:0,height:0})}var n=p.prototype;n.dispose=function(){this._renderTarget.dispose();this._renderTarget=null};n.getTexture=function(){return this._renderTarget?this._renderTarget.colorTexture:null};n.isValid=function(){return null!==
this._renderTarget};n.resize=function(w,q){this._renderTarget.resize(w,q)};n.bind=function(w){w.bindFramebuffer(this._renderTarget)};n.generateMipMap=function(){this._renderTarget.colorTexture.descriptor.hasMipmap&&this._renderTarget.colorTexture.generateMipmap()};n.disposeRenderTargetMemory=function(){this._renderTarget&&this._renderTarget.resize(0,0)};n.getGpuMemoryUsage=function(){let w=0;this._renderTarget&&(w+=l.getGpuMemoryUsage(this._renderTarget));return w};return p}();b.OverlayRenderTarget=
k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/Renderbuffer":function(){define(["../../chunks/_rollupPluginBabelHelpers"],function(b){let k=0;return function(){function a(l,h){this._context=l;this._desc=h;this.id=++k;this._context.instanceCounter.increment(5,this);l=this._context.gl;this.glName=l.createRenderbuffer();this._context.bindRenderbuffer(this);l.renderbufferStorage(l.RENDERBUFFER,h.internalFormat,h.width,h.height)}var r=a.prototype;r.resize=function(l,h){const d=
this._desc;if(d.width!==l||d.height!==h)d.width=l,d.height=h,l=this._context.gl,this._context.bindRenderbuffer(this),l.renderbufferStorage(l.RENDERBUFFER,d.internalFormat,d.width,d.height)};r.dispose=function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(5,this),this._context=null)};b._createClass(a,[{key:"descriptor",get:function(){return this._desc}}]);return a}()})},"esri/views/webgl/FramebufferObject":function(){define(["../../chunks/_rollupPluginBabelHelpers",
"../../core/has","../../core/Logger","./Texture","./Renderbuffer"],function(b,k,a,r,l){const h=a.getLogger("esri.views.webgl.FrameBufferObject");k=function(){function c(f,g,p,n){this._glName=this._context=null;this.id=d++;this._stencilAttachment=this._depthAttachment=null;this._colorAttachments=new Map;this._initialized=!1;f.instanceCounter.increment(4,this);this._context=f;this._desc={...g};if(p)if(Array.isArray(p))for(const m of p){const {attachmentPoint:u,texture:v}=m;p=v instanceof r?v:new r(f,
v);g=p.descriptor;this._colorAttachments.set(u,p);this._validateColorAttachmentPoint(u);this._validateTextureDimensions(g,this._desc)}else{var w;p instanceof r?(g=p.descriptor,this._colorAttachments.set(36064,p)):(g=p,this._colorAttachments.set(36064,new r(f,p)));0!==(null==(w=this._desc)?void 0:w.colorTarget)&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!");this._validateTextureDimensions(g,this._desc)}if(n instanceof
l){var q;f=null!=(q=this._desc.depthStencilTarget)?q:3;2===f?this._stencilAttachment=n:1===f||3===f?this._depthAttachment=n:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER');c._validateBufferDimensions(n.descriptor,this._desc)}else n&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),
n instanceof r?(this._depthStencilTexture=n,n=this._depthStencilTexture.descriptor):this._depthStencilTexture=new r(this._context,n),this._validateTextureDimensions(n,this._desc))}var e=c.prototype;e.dispose=function(){if(this._context){var f=this._context,g=f.getBoundFramebufferObject();this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(f.gl.deleteFramebuffer(this._glName),this._glName=null);f.bindFramebuffer(g);f.instanceCounter.decrement(4,this);this._context=
null}};e.getColorTexture=function(f){return(f=this._colorAttachments.get(f))&&f instanceof r?f:null};e.attachColorTexture=function(f,g=36064){if(f){this._validateColorAttachmentPoint(g);this._validateTextureDimensions(f.descriptor,this._desc);this._disposeColorAttachments();if(this._initialized){this._context.bindFramebuffer(this);const p=this._context.gl;p.framebufferTexture2D(p.FRAMEBUFFER,g,p.TEXTURE_2D,f.glName,0)}this._colorAttachments.set(g,f)}};e.detachColorTexture=function(f=36064){const g=
this._colorAttachments.get(f);if(g instanceof r){if(this._initialized){this._context.bindFramebuffer(this);const p=this._context.gl;p.framebufferTexture2D(p.FRAMEBUFFER,f,p.TEXTURE_2D,null,0)}this._colorAttachments.delete(f);return g}};e.attachDepthStencilTexture=function(f){if(f){var g=f.descriptor;34041!==g.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==g.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");
this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");this._validateTextureDimensions(g,this._desc);this._desc.depthStencilTarget&&4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),g=this._context.gl,g.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.TEXTURE_2D,
f.glName,0));this._depthStencilTexture=f}};e.detachDepthStencilTexture=function(){const f=this._depthStencilTexture;if(f&&this._initialized){this._context.bindFramebuffer(this);const g=this._context.gl;this._context.gl.framebufferTexture2D(g.FRAMEBUFFER,g.DEPTH_STENCIL_ATTACHMENT,g.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return f};e.attachDepthStencilBuffer=function(f){if(f){var g=f.descriptor;34041!==g.internalFormat&&33189!==g.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");
c._validateBufferDimensions(g,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===g.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),g=this._context.gl,g.framebufferRenderbuffer(g.FRAMEBUFFER,1===this._desc.depthStencilTarget?g.DEPTH_ATTACHMENT:g.DEPTH_STENCIL_ATTACHMENT,g.RENDERBUFFER,f.glName));this._depthAttachment=f}};e.detachDepthStencilBuffer=function(){const f=this._context.gl,g=this._depthAttachment;g&&this._initialized&&(this._context.bindFramebuffer(this),
f.framebufferRenderbuffer(f.FRAMEBUFFER,1===this._desc.depthStencilTarget?f.DEPTH_ATTACHMENT:f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,null));this._depthAttachment=null;return g};e.copyToTexture=function(f,g,p,n,w,q,m){(0>f||0>g||0>w||0>q)&&console.error("Offsets cannot be negative!");(0>=p||0>=n)&&console.error("Copy width and height must be greater than zero!");var u=this._desc;const v=m.descriptor;3553!==m.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(f+p>u.width||g+n>
u.height||w+p>v.width||q+n>v.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");u=this._context;u.bindTexture(m,0);u.bindFramebuffer(this);u.gl.copyTexSubImage2D(3553,0,w,q,f,g,p,n)};e.readPixels=function(f,g,p,n,w,q,m){(0>=p||0>=n)&&console.error("Copy width and height must be greater than zero!");m||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(f,g,p,n,w,q,m)};e.resize=
function(f,g){const p=this._desc;if(p.width!==f||p.height!==g)if(this._initialized){p.width=f;p.height=g;this._colorAttachments.forEach(n=>{n&&n.resize(f,g)});if(null!=this._depthStencilTexture)this._depthStencilTexture.resize(f,g);else if(this._depthAttachment||this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(f,g),this._stencilAttachment&&this._stencilAttachment.resize(f,g);this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null);this._initialized=
!1}else p.width=f,p.height=g,this._colorAttachments.forEach(n=>{n&&n.resize(f,g)}),this._depthStencilTexture&&this._depthStencilTexture.resize(f,g)};e.initialize=function(){var f,g,p,n;if(this._initialized)return!1;const w=this._context,q=w.gl;this._glName&&q.deleteFramebuffer(this._glName);const m=q.createFramebuffer(),u=this._desc,v=null!=(f=u.colorTarget)?f:1;f=null!=(g=u.width)?g:1;g=null!=(p=u.height)?p:1;q.bindFramebuffer(q.FRAMEBUFFER,m);0===this._colorAttachments.size&&(0===v?this._colorAttachments.set(36064,
new r(w,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:u.width,height:u.height})):(p=new l(w,{internalFormat:32854,width:f,height:g}),this._colorAttachments.set(36064,p)));this._colorAttachments.forEach((y,B)=>{y&&(y instanceof r?q.framebufferTexture2D(q.FRAMEBUFFER,B,q.TEXTURE_2D,y.glName,0):q.framebufferRenderbuffer(q.FRAMEBUFFER,q.COLOR_ATTACHMENT0,q.RENDERBUFFER,y.glName))});p=null!=(n=u.depthStencilTarget)?n:0;switch(p){case 1:case 3:this._depthAttachment||
(this._depthAttachment=new l(w,{internalFormat:1===u.depthStencilTarget?33189:34041,width:f,height:g}));q.framebufferRenderbuffer(q.FRAMEBUFFER,1===p?q.DEPTH_ATTACHMENT:q.DEPTH_STENCIL_ATTACHMENT,q.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new l(w,{internalFormat:36168,width:f,height:g}));q.framebufferRenderbuffer(q.FRAMEBUFFER,q.STENCIL_ATTACHMENT,q.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||
(w.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new r(w,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:f,height:g})),q.framebufferTexture2D(q.FRAMEBUFFER,q.DEPTH_STENCIL_ATTACHMENT,q.TEXTURE_2D,this._depthStencilTexture.glName,0)}this._glName=m;return this._initialized=!0};e._disposeColorAttachments=function(){this._colorAttachments.forEach((f,
g)=>{if(f instanceof r){if(this._initialized){this._context.bindFramebuffer(this);var p=this._context.gl;p.framebufferTexture2D(p.FRAMEBUFFER,g,p.TEXTURE_2D,null,0)}f.dispose()}else f instanceof WebGLRenderbuffer&&(p=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),p.framebufferRenderbuffer(p.FRAMEBUFFER,g,p.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(f))});this._colorAttachments.clear()};e._disposeDepthStencilAttachments=function(){const f=this._context.gl;this._depthAttachment&&
(this._initialized&&(this._context.bindFramebuffer(this),f.framebufferRenderbuffer(f.FRAMEBUFFER,1===this._desc.depthStencilTarget?f.DEPTH_ATTACHMENT:f.DEPTH_STENCIL_ATTACHMENT,f.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),f.framebufferRenderbuffer(f.FRAMEBUFFER,f.STENCIL_ATTACHMENT,f.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&
(this._initialized&&(this._context.bindFramebuffer(this),f.framebufferTexture2D(f.FRAMEBUFFER,f.DEPTH_STENCIL_ATTACHMENT,f.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};c._validateBufferDimensions=function(f,g){console.assert(0<=f.width&&0<=f.height);void 0!==g.width&&0<=g.width&&void 0!==g.height&&0<=g.height?g.width===f.width&&g.height===f.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(g.width=f.width,g.height=f.height)};
e._validateTextureDimensions=function(f,g){console.assert(0<=f.width&&0<=f.height);3553!==f.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==g.width&&0<=g.width&&void 0!==g.height&&0<=g.height?g.width===f.width&&g.height===f.height||console.error("Color attachment texture must match the framebuffer's!"):(g.width=f.width,g.height=f.height)};e._validateColorAttachmentPoint=function(f){if(-1===c._MAX_COLOR_ATTACHMENTS){const g=this._context.capabilities.drawBuffers;c._MAX_COLOR_ATTACHMENTS=
g?this._context.gl.getParameter(g.MAX_COLOR_ATTACHMENTS):1}f-=36064;f+1>c._MAX_COLOR_ATTACHMENTS&&h.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${f+1}. Implementation supports up to ${c._MAX_COLOR_ATTACHMENTS} color attachments`)};b._createClass(c,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._desc}},{key:"colorTexture",get:function(){const f=this._colorAttachments.get(36064);return f&&f instanceof r?f:null}},{key:"colorAttachment",
get:function(){return this._colorAttachments.get(36064)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this._desc.width}},{key:"height",get:function(){return this._desc.height}}]);return c}();k._MAX_COLOR_ATTACHMENTS=-1;let d=0;return k})},"esri/views/webgl/ProgramCache":function(){define(["./programUtils"],
function(b){return function(){function k(r){this._programCacheByTemplate=new Map;this._rctx=r}var a=k.prototype;a.dispose=function(){this._programCacheByTemplate.forEach(r=>{r.programs.forEach(l=>{l.dispose()})});this._programCacheByTemplate=null};a.getProgram=function(r,l){this._programCacheByTemplate.has(r)||this.addProgramTemplate(r,h=>b.createProgram(this._rctx,r,h));return this.getProgramTemplateInstance(r,l)};a.addProgramTemplate=function(r,l){this._programCacheByTemplate.set(r,{constructor:l,
programs:new Map})};a.getProgramTemplateInstance=function(r,l){if(r=this._programCacheByTemplate.get(r)){const h=l?JSON.stringify(l):"default";r.programs.has(h)||(l=r.constructor(l),r.programs.set(h,l));return r.programs.get(h)}return null};return k}()})},"esri/views/webgl/programUtils":function(){define(["exports","./Program"],function(b,k){b.createProgram=function(a,r,l,h){l=l||{};h=h||"";l="function"===typeof r.shaders?r.shaders(l):r.shaders;return new k(a,h+l.vertexShader,h+l.fragmentShader,r.attributes)};
b.glslifyDefineMap=function(a){let r="";for(const l in a){const h=a[l];if("boolean"===typeof h)h&&(r+=`#define ${l}\n`);else if("number"===typeof h)r+=`#define ${l} ${h.toFixed()}\n`;else if("object"===typeof h){const d=h.options;let c=0;for(const e in d)r+=`#define ${d[e]} ${(c++).toFixed()}\n`;r+=`#define ${l} ${d[h.value]}\n`}}return r};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/RenderingContext":function(){define("../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./renderState ./enums ./InstanceCounter ./capabilities/isWebGL2Context ./capabilities/load".split(" "),
function(b,k,a,r,l,h,d,c){k=function(){function e(g,p){this.gl=null;this.instanceCounter=new h.InstanceCounter;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=
!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=
this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=d(g)?"webgl2":"webgl";this.gl=g;g instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=c.loadCapabilities(g,p);g=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:g[0],y:g[1],width:g[2],height:g[3]};this._stateTracker=new r.StateTracker({setBlending:n=>{n?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(n.opRgb,
n.opAlpha),this.setBlendFunctionSeparate(n.srcRgb,n.dstRgb,n.srcAlpha,n.dstAlpha),n=n.color,this.setBlendColor(n.r,n.g,n.b,n.a)):this.setBlendingEnabled(!1)},setCulling:n=>{n?(this.setFaceCullingEnabled(!0),this.setCullFace(n.face),this.setFrontFace(n.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:n=>{n?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(n.factor,n.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:n=>{n?(this.setDepthTestEnabled(!0),this.setDepthFunction(n.func)):
this.setDepthTestEnabled(!1)},setStencilTest:n=>{if(n){this.setStencilTestEnabled(!0);const w=n.function;this.setStencilFunction(w.func,w.ref,w.mask);n=n.operation;this.setStencilOp(n.fail,n.zFail,n.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:n=>{n?(this.setDepthWriteEnabled(!0),this.setDepthRange(n.zNear,n.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:n=>{n?this.setColorMask(n.r,n.g,n.b,n.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:n=>{n?this.setStencilWriteMask(n.mask):
this.setStencilWriteMask(0)}});this.enforceState()}var f=e.prototype;f.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this._capabilities=this.gl=null};f.setPipelineState=function(g){this._stateTracker.setPipeline(g)};f.setBlendingEnabled=function(g){this._blendEnabled!==g&&(!0===g?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=g,this._stateTracker.invalidateBlending())};f.setBlendColor=function(g,p,n,
w){if(g!==this._blendColorState.r||p!==this._blendColorState.g||n!==this._blendColorState.b||w!==this._blendColorState.a)this.gl.blendColor(g,p,n,w),this._blendColorState.r=g,this._blendColorState.g=p,this._blendColorState.b=n,this._blendColorState.a=w,this._stateTracker.invalidateBlending()};f.setBlendFunction=function(g,p){if(g!==this._blendFunctionState.srcRGB||p!==this._blendFunctionState.dstRGB)this.gl.blendFunc(g,p),this._blendFunctionState.srcRGB=g,this._blendFunctionState.srcAlpha=g,this._blendFunctionState.dstRGB=
p,this._blendFunctionState.dstAlpha=p,this._stateTracker.invalidateBlending()};f.setBlendFunctionSeparate=function(g,p,n,w){if(this._blendFunctionState.srcRGB!==g||this._blendFunctionState.srcAlpha!==n||this._blendFunctionState.dstRGB!==p||this._blendFunctionState.dstAlpha!==w)this.gl.blendFuncSeparate(g,p,n,w),this._blendFunctionState.srcRGB=g,this._blendFunctionState.srcAlpha=n,this._blendFunctionState.dstRGB=p,this._blendFunctionState.dstAlpha=w,this._stateTracker.invalidateBlending()};f.setBlendEquation=
function(g){this._blendEquationState.mode!==g&&(this.gl.blendEquation(g),this._blendEquationState.mode=g,this._blendEquationState.modeAlpha=g,this._stateTracker.invalidateBlending())};f.setBlendEquationSeparate=function(g,p){if(this._blendEquationState.mode!==g||this._blendEquationState.modeAlpha!==p)this.gl.blendEquationSeparate(g,p),this._blendEquationState.mode=g,this._blendEquationState.modeAlpha=p,this._stateTracker.invalidateBlending()};f.setColorMask=function(g,p,n,w){if(this._colorMaskState.r!==
g||this._colorMaskState.g!==p||this._colorMaskState.b!==n||this._colorMaskState.a!==w)this.gl.colorMask(g,p,n,w),this._colorMaskState.r=g,this._colorMaskState.g=p,this._colorMaskState.b=n,this._colorMaskState.a=w,this._stateTracker.invalidateColorWrite()};f.setClearColor=function(g,p,n,w){if(this._clearColor.r!==g||this._clearColor.g!==p||this._clearColor.b!==n||this._clearColor.a!==w)this.gl.clearColor(g,p,n,w),this._clearColor.r=g,this._clearColor.g=p,this._clearColor.b=n,this._clearColor.a=w};
f.setFaceCullingEnabled=function(g){this._polygonCullingEnabled!==g&&(!0===g?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=g,this._stateTracker.invalidateCulling())};f.setPolygonOffsetFillEnabled=function(g){this._polygonOffsetFillEnabled!==g&&(!0===g?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=g,this._stateTracker.invalidatePolygonOffset())};f.setPolygonOffset=function(g,
p){if(this._polygonOffset[0]!==g||this._polygonOffset[1]!==p)this._polygonOffset[0]=g,this._polygonOffset[1]=p,this.gl.polygonOffset(g,p),this._stateTracker.invalidatePolygonOffset()};f.setCullFace=function(g){this._cullFace!==g&&(this.gl.cullFace(g),this._cullFace=g,this._stateTracker.invalidateCulling())};f.setFrontFace=function(g){this._frontFace!==g&&(this.gl.frontFace(g),this._frontFace=g,this._stateTracker.invalidateCulling())};f.setScissorTestEnabled=function(g){this._scissorTestEnabled!==
g&&(!0===g?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=g)};f.setScissorRect=function(g,p,n,w){if(this._scissorRect.x!==g||this._scissorRect.y!==p||this._scissorRect.width!==n||this._scissorRect.height!==w)this.gl.scissor(g,p,n,w),this._scissorRect.x=g,this._scissorRect.y=p,this._scissorRect.width=n,this._scissorRect.height=w};f.setDepthTestEnabled=function(g){this._depthTestEnabled!==g&&(!0===g?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),
this._depthTestEnabled=g,this._stateTracker.invalidateDepthTest())};f.setClearDepth=function(g){this._clearDepth!==g&&(this.gl.clearDepth(g),this._clearDepth=g)};f.setDepthFunction=function(g){this._depthFunction!==g&&(this.gl.depthFunc(g),this._depthFunction=g,this._stateTracker.invalidateDepthTest())};f.setDepthWriteEnabled=function(g){this._depthWriteEnabled!==g&&(this.gl.depthMask(g),this._depthWriteEnabled=g,this._stateTracker.invalidateDepthWrite())};f.setDepthRange=function(g,p){if(this._depthRange.zNear!==
g||this._depthRange.zFar!==p)this.gl.depthRange(g,p),this._depthRange.zNear=g,this._depthRange.zFar=p,this._stateTracker.invalidateDepthWrite()};f.setStencilTestEnabled=function(g){this._stencilTestEnabled!==g&&(!0===g?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=g,this._stateTracker.invalidateStencilTest())};f.setClearStencil=function(g){g!==this._clearStencil&&(this.gl.clearStencil(g),this._clearStencil=g)};f.setStencilFunction=function(g,p,
n){if(this._stencilFunction.func!==g||this._stencilFunction.ref!==p||this._stencilFunction.mask!==n)this.gl.stencilFunc(g,p,n),this._stencilFunction.face=1032,this._stencilFunction.func=g,this._stencilFunction.ref=p,this._stencilFunction.mask=n,this._stateTracker.invalidateStencilTest()};f.setStencilFunctionSeparate=function(g,p,n,w){if(this._stencilFunction.face!==g||this._stencilFunction.func!==p||this._stencilFunction.ref!==n||this._stencilFunction.mask!==w)this.gl.stencilFuncSeparate(g,p,n,w),
this._stencilFunction.face=g,this._stencilFunction.func=p,this._stencilFunction.ref=n,this._stencilFunction.mask=w,this._stateTracker.invalidateStencilTest()};f.setStencilWriteMask=function(g){this._stencilWriteMask!==g&&(this.gl.stencilMask(g),this._stencilWriteMask=g,this._stateTracker.invalidateStencilWrite())};f.setStencilOp=function(g,p,n){if(this._stencilOperation.fail!==g||this._stencilOperation.zFail!==p||this._stencilOperation.zPass!==n)this.gl.stencilOp(g,p,n),this._stencilOperation.face=
1032,this._stencilOperation.fail=g,this._stencilOperation.zFail=p,this._stencilOperation.zPass=n,this._stateTracker.invalidateStencilTest()};f.setStencilOpSeparate=function(g,p,n,w){if(this._stencilOperation.face!==g||this._stencilOperation.fail!==p||this._stencilOperation.zFail!==n||this._stencilOperation.zPass!==w)this.gl.stencilOpSeparate(g,p,n,w),this._stencilOperation.face=g,this._stencilOperation.face=g,this._stencilOperation.fail=p,this._stencilOperation.zFail=n,this._stencilOperation.zPass=
w,this._stateTracker.invalidateStencilTest()};f.setActiveTexture=function(g){const p=this._activeTextureUnit;0<=g&&g!==this._activeTextureUnit&&(this.gl.activeTexture(l.BASE_TEXTURE_UNIT+g),this._activeTextureUnit=g);return p};f.clear=function(g){g&&this.gl.clear(g)};f.clearSafe=function(g,p=255){g&&(g&16384&&this.setColorMask(!0,!0,!0,!0),g&256&&this.setDepthWriteEnabled(!0),g&1024&&this.setStencilWriteMask(p),this.gl.clear(g))};f.drawArrays=function(g,p,n){this.gl.drawArrays(g,p,n)};f.drawElements=
function(g,p,n,w){5123===n?this.gl.drawElements(g,p,n,w):5125===n&&this.gl.drawElements(g,p,n,w)};f.logIno=function(){};f.setViewport=function(g,p,n,w){const q=this._viewport;if(q.x!==g||q.y!==p||q.width!==n||q.height!==w)q.x=g,q.y=p,q.width=n,q.height=w,this.gl.viewport(g,p,n,w)};f.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};f.bindProgram=function(g){g?this._activeShaderProgram!==g&&(g.initialize(),this.gl.useProgram(g.glName),
this._activeShaderProgram=g):(this.gl.useProgram(null),this._activeShaderProgram=null)};f.bindTexture=function(g,p){-1===e._MAX_TEXTURE_IMAGE_UNITS&&(e._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(p>=e._MAX_TEXTURE_IMAGE_UNITS||0>p)&&console.error("Input texture unit is out of range of available units!");const n=this._textureUnitMap[p];this.setActiveTexture(p);null==g||null==g.glName?(null!=n&&(this.gl.bindTexture(n.descriptor.target,null),n.setBoundToUnit(p,!1)),
this._textureUnitMap[p]=null):n&&n.id===g.id?g.applyChanges():(n&&n.setBoundToUnit(p,!1),this.gl.bindTexture(g.descriptor.target,g.glName),g.setBoundToUnit(p,!0),g.applyChanges(),this._textureUnitMap[p]=g)};f.bindFramebuffer=function(g){a.isNone(g)?(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null):this._activeFramebuffer!==g&&(g.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,g.glName),this._activeFramebuffer=g)};f.bindBuffer=function(g){g&&(34962===g.bufferType?
this._activeVertexBuffer=e._bindBuffer(this.gl,g,g.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=e._bindBuffer(this.gl,g,g.bufferType,this._activeIndexBuffer))};f.bindRenderbuffer=function(g){const p=this.gl;g||(p.bindRenderbuffer(p.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==g&&(p.bindRenderbuffer(p.RENDERBUFFER,g.glName),this._activeRenderbuffer=g)};f.unbindBuffer=function(g){34962===g?this._activeVertexBuffer=e._bindBuffer(this.gl,null,g,this._activeVertexBuffer):
this._activeIndexBuffer=e._bindBuffer(this.gl,null,g,this._activeIndexBuffer)};f.bindVAO=function(g){g?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===g.id||(g.bind(),this._activeVertexArrayObject=g):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};f.getBoundTexture=function(g){return this._textureUnitMap[g]};f.getBoundFramebufferObject=function(){return this._activeFramebuffer};f.getBoundVAO=function(){return this._activeVertexArrayObject};
f.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(let g=0;g<this.parameters.maxTextureImageUnits;g++)this.bindTexture(null,g);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);
this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};f.enforceState=function(){const g=
this.gl;var p=this.capabilities.vao;p&&p.bindVertexArray(null);for(var n=0;n<this.parameters.maxVertexAttributes;n++)g.disableVertexAttribArray(n);this._activeVertexBuffer?g.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):g.bindBuffer(34962,null);this._activeIndexBuffer?g.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):g.bindBuffer(34963,null);if(p&&this._activeVertexArrayObject){if(p=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),
this._activeVertexArrayObject=null;this.bindVAO(p)}g.bindFramebuffer(g.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);g.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);g.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);g.bindRenderbuffer(g.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?g.enable(this.gl.BLEND):g.disable(this.gl.BLEND);
g.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);g.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);g.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);g.clearDepth(this._clearDepth);g.clearStencil(this._clearStencil);g.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);
g.cullFace(this._cullFace);g.depthFunc(this._depthFunction);g.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST);g.depthMask(this._depthWriteEnabled);g.frontFace(this._frontFace);g.lineWidth(1);!0===this._polygonCullingEnabled?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE);g.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?g.enable(g.POLYGON_OFFSET_FILL):g.disable(g.POLYGON_OFFSET_FILL);
g.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?g.enable(g.SCISSOR_TEST):g.disable(g.SCISSOR_TEST);g.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);g.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST);g.stencilMask(this._stencilWriteMask);
for(p=0;p<this.parameters.maxTextureImageUnits;p++)g.activeTexture(l.BASE_TEXTURE_UNIT+p),g.bindTexture(3553,null),(n=this._textureUnitMap[p])&&g.bindTexture(n.descriptor.target,n.glName);g.activeTexture(l.BASE_TEXTURE_UNIT+this._activeTextureUnit);g.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};e._bindBuffer=function(g,p,n,w){p?w!==p&&g.bindBuffer(n,p.glName):g.bindBuffer(n,null);return p};b._createClass(e,[{key:"contextAttributes",get:function(){return this.gl.getContextAttributes()}},
{key:"parameters",get:function(){if(!this._parameters){const g=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:g?this.gl.getParameter(g.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE)}}return this._parameters}},
{key:"capabilities",get:function(){return this._capabilities}}]);return e}();k._MAX_TEXTURE_IMAGE_UNITS=-1;return k})},"esri/views/webgl/enums":function(){define(["exports"],function(b){b.BASE_TEXTURE_UNIT=33984;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(){this._current=[];this._max=[];for(this._allocations=new Map;6>this._current.length;)this._current.push(0),
this._max.push(0)}var l=r.prototype;l.resetMax=function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)};l.increment=function(h,d){d=++this._current[h];this._max[h]=Math.max(d,this._max[h])};l.decrement=function(h,d){--this._current[h]};l.printResourceCount=function(){console.log("Live objects:");console.log(`Textures: ${this._current[0]}`);console.log(`Buffers: ${this._current[1]}`);console.log(`VAOs: ${this._current[2]}`);console.log(`Programs: ${this._current[3]}`);
console.log(`Framebuffers: ${this._current[4]}`);console.log(`Renderbuffers: ${this._current[5]}`);if(0<this._allocations.size){console.log(`${this._allocations.size} live object allocations:`);const h=new Map;this._allocations.forEach(d=>{var c;h.set(d,(null!=(c=h.get(d))?c:0)+1)});h.forEach((d,c)=>console.log(d," : ",c))}};k._createClass(r,[{key:"max",get:function(){return this._max}},{key:"current",get:function(){return this._current}}]);return r}();b.InstanceCounter=a;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(b){return window.WebGL2RenderingContext&&b instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/capabilities/load":function(){define("exports ./isWebGL2Context ./DisjointTimerQuery ./DrawBuffers ./Instancing ./LoseContext ./VertexArrayObjects".split(" "),function(b,k,a,r,l,h,d){function c(e,f,g,p,n){if(p&&k(e))return!0;if(f[g])return!1;for(const w of n)if(e.getExtension(w))return!0;
return!1}b.loadCapabilities=function(e,f){const g=f&&f.disabledExtensions||{},p=f&&f.debugWebGLExtensions||{};let n,w,q,m,u,v,y,B,x,C,z=null,A=null,t=null,D=null;return{get drawBuffers(){C||(C=r.load(e,g));return C},get instancing(){n||(n=l.load(e));return n},get vao(){w||(w=d.load(e,g));return w},get compressedTextureS3TC(){if(!q)if(g.compressedTextureS3TC)q=null;else{var E=e.getExtension("WEBGL_compressed_texture_s3tc");q=E?{COMPRESSED_RGB_S3TC_DXT1:E.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:E.COMPRESSED_RGBA_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT3:E.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:E.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null}return q},get textureFilterAnisotropic(){if(!m)if(g.textureFilterAnisotropic)m=null;else{var E=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");m=E?{MAX_TEXTURE_MAX_ANISOTROPY:E.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:E.TEXTURE_MAX_ANISOTROPY_EXT}:null}return m},
get disjointTimerQuery(){u||(u=a.createDisjointTimerQuery(e,g));return u},get textureFloat(){if(!v)if(k(e))v={textureFloat:!0,textureFloatLinear:!g.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!g.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:e.HALF_FLOAT};else if(e instanceof WebGLRenderingContext){const E=!g.textureHalfFloat&&e.getExtension("OES_texture_half_float");v={textureFloat:!g.textureFloat&&
!!e.getExtension("OES_texture_float"),textureFloatLinear:!g.textureFloatLinear&&!!e.getExtension("OES_texture_float_linear"),textureHalfFloat:!!E,textureHalfFloatLinear:!g.textureHalfFloatLinear&&!!e.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:E?E.HALF_FLOAT_OES:void 0}}else v=null;return v},get colorBufferFloat(){if(!y)if(k(e)){var E=!g.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),G=!g.colorBufferFloat&&e.getExtension("EXT_color_buffer_float");y=E||G?{textureFloat:!!G,
textureHalfFloat:!!E,R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F,RGB16F:e.RGB16F}:null}else e instanceof WebGLRenderingContext?(E=!g.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float"),G=!g.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float"),y=E||G?{textureFloat:!!G,textureHalfFloat:!!E,RGBA16F:E?E.RGBA16F_EXT:void 0,RGB16F:E?E.RGB16F_EXT:void 0,RGBA32F:G?G.RGBA32F_EXT:void 0}:null):y=null;return y},get blendMinMax(){if(!B)if(k(e))B=
{MIN:e.MIN,MAX:e.MAX};else if(g.blendMinMax)B=null;else{{const E=e.getExtension("EXT_blend_minmax");B=E?{MIN:E.MIN_EXT,MAX:E.MAX_EXT}:null}}return B},get depthTexture(){null===z&&(z=c(e,g,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return z},get standardDerivatives(){null===A&&(A=c(e,g,"standardDerivatives",!0,["OES_standard_derivatives"]));return A},get shaderTextureLOD(){null===t&&(t=c(e,g,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));
return t},get fragDepth(){null===D&&(D=c(e,g,"fragDepth",!0,["EXT_frag_depth"]));return D},get loseContext(){x||(x=h.load(e,p));return x}}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","./isWebGL2Context"],function(b,k){let a=function(r,l,h,d,c,e,f,g){this.createQuery=r;this.resultAvailable=l;this.getResult=h;this.disjoint=d;this.beginTimeElapsed=c;this.endTimeElapsed=e;this.createTimestamp=f;this.timestampBits=
g};b.DisjointTimerQuery=a;b.createDisjointTimerQuery=function(r,l){if(l.disjointTimerQuery)return null;let h=r.getExtension("EXT_disjoint_timer_query_webgl2");return h&&k(r)?new a(()=>r.createQuery(),d=>r.getQueryParameter(d,r.QUERY_RESULT_AVAILABLE),d=>r.getQueryParameter(d,r.QUERY_RESULT),()=>r.getParameter(h.GPU_DISJOINT_EXT),d=>r.beginQuery(h.TIME_ELAPSED_EXT,d),()=>r.endQuery(h.TIME_ELAPSED_EXT),d=>h.queryCounterEXT(d,h.TIMESTAMP_EXT),()=>r.getQuery(h.TIMESTAMP_EXT,h.QUERY_COUNTER_BITS_EXT)):
(h=r.getExtension("EXT_disjoint_timer_query"))?new a(()=>h.createQueryEXT(),d=>h.getQueryObjectEXT(d,h.QUERY_RESULT_AVAILABLE_EXT),d=>h.getQueryObjectEXT(d,h.QUERY_RESULT_EXT),()=>r.getParameter(h.GPU_DISJOINT_EXT),d=>h.beginQueryEXT(h.TIME_ELAPSED_EXT,d),()=>h.endQueryEXT(h.TIME_ELAPSED_EXT),d=>h.queryCounterEXT(d,h.TIMESTAMP_EXT),()=>h.getQueryEXT(h.TIMESTAMP_EXT,h.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports",
"./isWebGL2Context"],function(b,k){b.load=function(a,r){return r.disjointTimerQuery?null:k(a)?{drawBuffers:a.drawBuffers.bind(a),MAX_DRAW_BUFFERS:a.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:a.MAX_COLOR_ATTACHMENTS}:r.drawBuffers?null:(a=a.getExtension("WEBGL_draw_buffers"))?{drawBuffers:a.drawBuffersWEBGL.bind(a),MAX_DRAW_BUFFERS:a.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:a.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports",
"./isWebGL2Context"],function(b,k){b.load=function(a){return k(a)?{drawArraysInstanced:a.drawArraysInstanced.bind(a),drawElementsInstanced:a.drawElementsInstanced.bind(a),vertexAttribDivisor:a.vertexAttribDivisor.bind(a)}:(a=a.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:a.drawArraysInstancedANGLE.bind(a),drawElementsInstanced:a.drawElementsInstancedANGLE.bind(a),vertexAttribDivisor:a.vertexAttribDivisorANGLE.bind(a)}:null};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],
function(b){b.load=function(k,a){const r=a.loseContext&&k.getExtension("WEBGL_lose_context");return r?{loseRenderingContext:()=>r.loseContext()}:null};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports","./isWebGL2Context"],function(b,k){b.load=function(a,r){return k(a)?{createVertexArray:a.createVertexArray.bind(a),deleteVertexArray:a.deleteVertexArray.bind(a),bindVertexArray:a.bindVertexArray.bind(a)}:r.vao?null:(a=
a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||a.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:a.createVertexArrayOES.bind(a),deleteVertexArray:a.deleteVertexArrayOES.bind(a),bindVertexArray:a.bindVertexArrayOES.bind(a)}:null};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/ShaderCompiler":function(){define(function(){return function(){function b(a){this.readFile=a}var k=b.prototype;k.resolveIncludes=function(a){return this.resolve(a)};
k.resolve=function(a,r=new Map){if(r.has(a))return r.get(a);const l=this.read(a);if(!l)throw Error(`cannot find shader file ${a}`);const h=/^[^\S\n]*#include\s+<(\S+)>[^\S\n]?/gm;let d=h.exec(l);const c=[];for(;null!=d;)c.push({path:d[1],start:d.index,length:d[0].length}),d=h.exec(l);let e=0,f="";c.forEach(g=>{f+=l.slice(e,g.start);f+=r.has(g.path)?"":this.resolve(g.path,r);e=g.start+g.length});f+=l.slice(e);r.set(a,f);return f};k.read=function(a){return this.readFile(a)};return b}()})},"esri/views/3d/terrain/Overlay":function(){define(["exports",
"../../../geometry/support/aaBoundingRect","./OverlayRenderTarget","../webgl-engine/lib/localOrigin"],function(b,k,a,r){let l=function(){function h(c,e){this.extent=k.create();this.resolution=0;this.renderLocalOrigin=r.fromValues(0,0,0,"O");this.pixelRatio=1;this.renderTargets={color:{fbo:new a.OverlayRenderTarget(c,"overlay",e,!0),valid:!1,lastUsed:Infinity},colorWithoutRasterImage:{fbo:new a.OverlayRenderTarget(c,"overlayWithoutRasterImage",e,!0),valid:!1,lastUsed:Infinity},highlight:{fbo:new a.OverlayRenderTarget(c,
"overlayHighlight",e,!1),valid:!1,lastUsed:Infinity},water:{fbo:new a.OverlayRenderTarget(c,"overlayWaterMask",e,!0),valid:!1,lastUsed:Infinity},occluded:{fbo:new a.OverlayRenderTarget(c,"overlayOccluded",e,!0),valid:!1,lastUsed:Infinity}}}var d=h.prototype;d.dispose=function(){this.renderTargets.color.fbo.dispose();this.renderTargets.colorWithoutRasterImage.fbo.dispose();this.renderTargets.highlight.fbo.dispose();this.renderTargets.water.fbo.dispose();this.renderTargets.occluded.fbo.dispose()};d.drawRenderTargets=
function(c,e,f){const g=this.renderTargets;g.color.valid=c.drawPass(0,g.color.fbo,e);g.highlight.valid=c.drawPass(5,g.highlight.fbo,e);g.water.valid=c.drawPass(3,g.water.fbo,e);g.occluded.valid=c.drawPass(0,g.occluded.fbo,e,1);g.colorWithoutRasterImage.valid=f&&c.drawPass(0,g.colorWithoutRasterImage.fbo,e,2)};d.computeRenderTargetValidityBitfield=function(){const c=this.renderTargets;return+c.color.valid|+c.colorWithoutRasterImage.valid<<1|+c.highlight.valid<<2|+c.water.valid<<3|+c.occluded.valid<<
4};d.validateUsage=function(c,e){if(c.valid)c.lastUsed=e;else if(1E3<e-c.lastUsed)c.fbo.disposeRenderTargetMemory(),c.lastUsed=Infinity;else if(Infinity>c.lastUsed)return!0;return!1};d.collectUnusedMemory=function(c){let e=!1;e=this.validateUsage(this.renderTargets.color,c)||e;e=this.validateUsage(this.renderTargets.colorWithoutRasterImage,c)||e;e=this.validateUsage(this.renderTargets.highlight,c)||e;e=this.validateUsage(this.renderTargets.occluded,c)||e;return e=this.validateUsage(this.renderTargets.water,
c)||e};d.getGpuMemoryUsage=function(){return this.renderTargets.color.fbo.getGpuMemoryUsage()+this.renderTargets.colorWithoutRasterImage.fbo.getGpuMemoryUsage()+this.renderTargets.highlight.fbo.getGpuMemoryUsage()+this.renderTargets.water.fbo.getGpuMemoryUsage()+this.renderTargets.occluded.fbo.getGpuMemoryUsage()};return h}();b.Overlay=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/localOrigin":function(){define(["exports","../../../../chunks/vec3f64"],function(b,
k){let a=function(r,l){this.vec3=r;this.id=l};b.LocalOrigin=a;b.fromValues=function(r,l,h,d){return new a(k.fromValues(r,l,h),d)};b.fromVector=function(r,l){return new a(k.clone(r),l)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/CommonUniformStore":function(){define(["exports","../../../../../core/arrayUtils"],function(b,k){let a=function(){function r(){this._uniforms={proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}
var l=r.prototype;l.dispose=function(){this._uniforms=null};l.getPrograms=function(h){return this._uniforms[h]||[]};l.subscribeProgram=function(h){for(const d in this._uniforms)h.hasUniform(d)&&this._uniforms[d].push(h)};l.unsubscribeProgram=function(h){for(const d in this._uniforms)k.removeUnordered(this._uniforms[d],h)};return r}();b.CommonUniformStore=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/promiseUtils"],function(b,k,a,r){let l=function(d){this.technique=d;this.refZeroFrame=this.refCount=0},h=function(){function d(e){this._context=e;this._perConstructorInstances=new Map;this._frameCounter=0;this._keepAliveFrameCount=1200}var c=d.prototype;c.dispose=function(){this._perConstructorInstances.forEach(e=>e.forEach(f=>f.technique.dispose()));this._perConstructorInstances.clear()};c.acquire=
function(e,f){const g=f.key;let p=this._perConstructorInstances.get(e);p||(p=new Map,this._perConstructorInstances.set(e,p));let n=p.get(g);void 0===n&&(n=new l(new e(this._context,f)),p.set(g,n));++n.refCount;return n.technique};c.acquireAndReleaseExisting=function(e,f,g){return a.isNone(g)?this.acquire(e,f):f.key===g.key&&g instanceof e?g:(this.release(g),this.acquire(e,f))};c.release=function(e){e=this._perConstructorInstances.get(e.constructor).get(e.key);--e.refCount;0===e.refCount&&(e.refZeroFrame=
this._frameCounter)};c.frameUpdate=function(){this._frameCounter++;this._perConstructorInstances.forEach((e,f)=>{e.forEach((g,p)=>{0===g.refCount&&g.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(g.technique.dispose(),e.delete(p))});0===e.size&&this._perConstructorInstances.delete(f)})};c.getProgramsUsingUniform=function(e){return this._context.commonUniformStore.getPrograms(e)};c.hotReload=async function(){const e=[];this._perConstructorInstances.forEach((f,g)=>{e.push((async(p,n)=>
{if(n=n.shader)await n.reload(),p.forEach(w=>{w.technique.reload(this._context)})})(f,g))});await r.all(e)};k._createClass(d,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return d}();b.ShaderTechniqueRepository=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["../../../../core/maybe","../../../../core/Logger","./Util","../core/shaderLibrary/ShaderOutputOptions"],
function(b,k,a,r){const l=k.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRep");let h=function(){function d(e){this.refCnt=0;this.glMaterial=e}var c=d.prototype;c.incRefCnt=function(){++this.refCnt};c.decRefCnt=function(){--this.refCnt;a.assert(0<=this.refCnt)};c.getRefCnt=function(){return this.refCnt};c.getGLMaterial=function(){return this.glMaterial};return d}();return function(){function d(e,f,g){this._textureRep=e;this._techniqueRep=f;this.onMaterialChanged=g;this._id2glMaterialRef=new Map}
var c=d.prototype;c.dispose=function(){this._textureRep.dispose()};c.acquire=function(e,f){this.ownMaterial(e);const g=r.getShaderOutputID(e.id,f);let p=this._id2glMaterialRef.get(g);if(null==p)return e=e.getGLMaterial({material:e,techniqueRep:this._techniqueRep,textureRep:this._textureRep,output:f}),p=new h(e),p.incRefCnt(),this._id2glMaterialRef.set(g,p),e;p.incRefCnt();return p.getGLMaterial()};c.release=function(e,f){e=r.getShaderOutputID(e.id,f);f=this._id2glMaterialRef.get(e);f.decRefCnt();
0===f.getRefCnt()&&((f=f.getGLMaterial())&&f.dispose(),this._id2glMaterialRef.delete(e))};c.materialChanged=function(e){for(const g of r.ShaderOutputTypes)if(5!==g.output&&6!==g.output){var f=this._id2glMaterialRef.get(r.getShaderOutputID(e.id,g.output));f&&f.getGLMaterial()&&(f=f.getGLMaterial(),f.updateParameters&&f.updateParameters())}if(this.onMaterialChanged)this.onMaterialChanged(e)};c.ownMaterial=function(e){b.isSome(e.materialRepository)&&e.materialRepository!==this&&l.error("Material is already owned by a different material repository");
e.materialRepository=this};return d}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["exports"],function(b){const k=[{output:0,name:"color"},{output:1,name:"depth"},{output:2,name:"normal"},{output:3,name:"depthShadowMap"},{output:4,name:"highlight"},{output:5,name:"draped"},{output:6,name:"occlusion"},{output:7,name:"alpha"}];b.ShaderOutputTypes=k;b.getShaderOutputID=function(a,r){return a+"_"+k.find(l=>l.output===r).name};Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("../../../../core/maybe ../../../../geometry/SpatialReference ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../chunks/mat4f64 ./Util ./GeometryData ./Object3D ./Geometry ./localOrigin ./Layer ../materials/RibbonLineMaterial".split(" "),function(b,k,a,r,l,h,d,c,e,f,g,p,n){let w=0,q=function(){function u(){this.ROOT_ORIGIN_ID="rg_root_"+w++;this._origins=new Map;this._gridSize=
42E5}var v=u.prototype;v.getOrigin=function(y){var B=this._origins.get(this.ROOT_ORIGIN_ID);if(null==B){if(b.isSome(u.testOrigin)){var x=u.testOrigin;this._origins.set(this.ROOT_ORIGIN_ID,g.fromValues(x[0],x[1],x[2],this.ROOT_ORIGIN_ID));return this.getOrigin(y)}x=g.fromValues(y[0]+Math.random()-.5,y[1]+Math.random()-.5,y[2]+Math.random()-.5,this.ROOT_ORIGIN_ID);this._origins.set(this.ROOT_ORIGIN_ID,x);return x}r.subtract(m,y,B.vec3);m[0]=Math.abs(m[0]);m[1]=Math.abs(m[1]);m[2]=Math.abs(m[2]);x=this._gridSize;
if(m[0]<x&&m[1]<x&&m[2]<x)return B;B=Math.round(y[0]/x);const C=Math.round(y[1]/x);y=Math.round(y[2]/x);const z=`${"rg_"}${B}/${C}/${y}`;let A=this._origins.get(z);A||(A=g.fromValues(B*x,C*x,y*x,z),this._origins.set(z,A));return A};v._drawOriginBox=function(y){var B=window.view;const x=B._stage;if(null==this._object){this._material=new n.RibbonLineMaterial({width:2,color:[0,1,0,1]},"GridLocalOriginMaterial");x.add(3,this._material);var C=new p("GridLocalOrigin",{isPickable:!1});x.add(0,C);this._object=
new e({idHint:"GridLocalOrigin",castShadow:!1});x.add(1,this._object);C.addObject(this._object);x.addToViewContent([C.id])}const z=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0],A=z.length;var t=new Float32Array(3*A);C=new Uint32Array(2*(A-1));const D=.5*this._gridSize;for(let E=0;E<A;E++)t[3*E]=y[0]+(z[E]&1?D:-D),t[3*E+1]=y[1]+(z[E]&2?D:-D),t[3*E+2]=y[2]+(z[E]&4?D:-D),0<E&&(C[2*E]=E-1,C[2*E+1]=E);l.projectBuffer(t,k.WebMercator,0,t,B.spatialReference,0,A);B={};B[d.VertexAttrConstants.POSITION]={size:3,
data:t};t={};t[d.VertexAttrConstants.POSITION]=C;C=new c.GeometryData(B,t,"line");C=new f(C,"GridLocalOriginBox");x.add(2,C);this._object.addGeometry(C,this._material,h.IDENTITY);console.log(this._origins.size,y)};return u}();const m=a.create();(q||(q={})).testOrigin=null;return q})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/vec2 ../../support/buffer/InterleavedLayout ../../support/geometryUtils ../lib/geometryDataUtils ../lib/Util ./renderers/utils ../lib/GLMaterial ../lib/Material ./VisualVariableMaterialParameters ../shaders/RibbonLineTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){function y(X,ca,R,aa,ka){for(let da=0;da<ka;da++)R[aa++]=X[ca++];return aa}function B(X,ca,R){R=R?R[v.RibbonVertexAttributeConstants.POSITION]:null;return X.isClosed?R?2<R.length:6<ca[v.RibbonVertexAttributeConstants.POSITION].data.length:!1}const x=r.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");r=function(X){function ca(aa,ka){aa=X.call(this,ka,aa,z)||this;aa._vertexAttributeLocations=v.ribbonVertexAttributeLocations;aa.techniqueConfig=
new v.RibbonLineTechniqueConfiguration;aa.layout=aa.createLayout();return aa}k._inheritsLoose(ca,X);var R=ca.prototype;R.isClosed=function(aa,ka){return this.params.isClosed?ka?2<ka.length:6<aa.length:!1};R.dispose=function(){};R.getPassParameters=function(){return this.params};R.getTechniqueConfig=function(aa,ka){this.techniqueConfig.output=aa;aa=a.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=aa;this.techniqueConfig.stippleIntegerRepeatsEnabled=aa&&this.params.stippleIntegerRepeats;
this.techniqueConfig.stippleOffColorEnabled=aa&&a.isSome(this.params.stippleOffColor);this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.roundJoins="round"===this.params.join;this.techniqueConfig.roundCaps="round"===this.params.cap;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;
this.techniqueConfig.vvColor=this.params.vvColorEnabled;this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.innerColorEnabled=0<this.params.innerWidth&&a.isSome(this.params.innerColor);this.techniqueConfig.falloffEnabled=0<this.params.falloff;this.techniqueConfig.occluder=8===this.params.renderOccluded;this.techniqueConfig.transparencyPassType=ka?ka.transparencyPassType:3;return this.techniqueConfig};R.intersect=function(aa,
ka,da,fa,ea,Y,Z,ba,ia){ia?this.intersectDrapedLineGeometry(aa,fa,Y,Z):this.intersectLineGeometry(aa,ka,da,fa,this.params.width,Z)};R.intersectDrapedLineGeometry=function(aa,ka,da,fa){if(ka.options.selectionMode){ka=aa.getAttribute(v.RibbonVertexAttributeConstants.POSITION).data;var ea=aa.getAttribute(v.RibbonVertexAttributeConstants.SIZE),Y=this.params.width;this.params.vvSizeEnabled?(ea=aa.getAttribute(v.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE).data[0],Y*=l.clamp(this.params.vvSizeOffset[0]+
ea*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0])):ea&&(Y*=ea.data[0]);ea=da[0];da=da[1];aa=(Y/2+4)*aa.screenToWorldRatio;Y=Number.MAX_VALUE;for(let la=0;la<ka.length-5;la+=3){var Z=ka[la],ba=ka[la+1],ia=ea-Z,ja=da-ba;Z=ka[la+3]-Z;ba=ka[la+4]-ba;const qa=l.clamp((Z*ia+ba*ja)/(Z*Z+ba*ba),0,1);ia=Z*qa-ia;ja=ba*qa-ja;ja=ia*ia+ja*ja;ja<Y&&(Y=ja)}Y<aa*aa&&fa()}};R.intersectLineGeometry=function(aa,ka,da,fa,ea,Y){if(fa.options.selectionMode&&!w.isInstanceHidden(ka))if(n.isTranslationMatrix(da)){var Z=
aa.data,ba=Z.getVertexAttr();aa=ba[v.RibbonVertexAttributeConstants.POSITION].data;this.params.vvSizeEnabled?ea*=l.clamp(this.params.vvSizeOffset[0]+ba[v.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]*this.params.vvSizeFactor[0],this.params.vvSizeMinSize[0],this.params.vvSizeMaxSize[0]):ba[v.RibbonVertexAttributeConstants.SIZE]&&(ea*=ba[v.RibbonVertexAttributeConstants.SIZE].data[0]);ka=fa.camera;var ia=H;e.copy(ia,fa.point);ea=ea*ka.pixelRatio/2+4*ka.pixelRatio;c.set(F[0],ia[0]-ea,
ia[1]+ea,0);c.set(F[1],ia[0]+ea,ia[1]+ea,0);c.set(F[2],ia[0]+ea,ia[1]-ea,0);c.set(F[3],ia[0]-ea,ia[1]-ea,0);for(var ja=0;4>ja;ja++)if(!ka.unprojectFromRenderScreen(F[ja],N[ja]))return;g.plane.fromPoints(ka.eye,N[0],N[1],P);g.plane.fromPoints(ka.eye,N[1],N[2],U);g.plane.fromPoints(ka.eye,N[2],N[3],V);g.plane.fromPoints(ka.eye,N[3],N[0],W);ja=Number.MAX_VALUE;Z=B(this.params,ba,Z.indices)?aa.length-2:aa.length-5;for(ba=0;ba<Z;ba+=3){t[0]=aa[ba]+da[12];t[1]=aa[ba+1]+da[13];t[2]=aa[ba+2]+da[14];var la=
(ba+3)%aa.length;D[0]=aa[la]+da[12];D[1]=aa[la+1]+da[13];D[2]=aa[la+2]+da[14];if(!(0>g.plane.signedDistance(P,t)&&0>g.plane.signedDistance(P,D)||0>g.plane.signedDistance(U,t)&&0>g.plane.signedDistance(U,D)||0>g.plane.signedDistance(V,t)&&0>g.plane.signedDistance(V,D)||0>g.plane.signedDistance(W,t)&&0>g.plane.signedDistance(W,D))){ka.projectToRenderScreen(t,I);ka.projectToRenderScreen(D,J);if(0>I[2]&&0<J[2])c.subtract(E,t,D),la=ka.frustum,la=-g.plane.signedDistance(la.planes[4],t)/c.dot(E,g.plane.normal(la.planes[4])),
c.scale(E,E,la),c.add(t,t,E),ka.projectToRenderScreen(t,I);else if(0<I[2]&&0>J[2])c.subtract(E,D,t),la=ka.frustum,la=-g.plane.signedDistance(la.planes[4],D)/c.dot(E,g.plane.normal(la.planes[4])),c.scale(E,E,la),c.add(D,D,E),ka.projectToRenderScreen(D,J);else if(0>I[2]&&0>J[2])continue;I[2]=0;J[2]=0;la=g.lineSegment.distance2(g.lineSegment.fromPoints(I,J,S),ia);la<ja&&(ja=la,c.copy(K,t),c.copy(L,D))}}da=fa.rayBeginPoint;fa=fa.rayEndPoint;ja<ea*ea&&(aa=Number.MAX_VALUE,g.lineSegment.closestLineSegmentPoint(g.lineSegment.fromPoints(K,
L,S),g.lineSegment.fromPoints(da,fa,M),G)&&(c.subtract(G,G,da),aa=c.length(G),c.scale(G,G,1/aa),aa/=c.distance(da,fa)),Y(aa,G))}else x.error("intersection assumes a translation-only matrix")};R.computeAttachmentOrigin=function(aa,ka){var da=aa.data;aa="getVertexAttr"in da?da.getVertexAttr():"vertexAttr"in da?da.vertexAttr:null;if(!aa)return null;const fa=v.RibbonVertexAttributeConstants.POSITION;da="getVertexAttr"in da?da.indices:null;return p.computeAttachmentOriginLines(aa[fa],da?da[fa]:null,da&&
B(this.params,aa,da),ka)};R.createLayout=function(){const aa=f.newLayout().vec3f(v.RibbonVertexAttributeConstants.POSITION).f32(v.RibbonVertexAttributeConstants.SUBDIVISIONFACTOR).vec2f(v.RibbonVertexAttributeConstants.UV0).vec3f(v.RibbonVertexAttributeConstants.AUXPOS1).vec3f(v.RibbonVertexAttributeConstants.AUXPOS2);this.params.vvSizeEnabled?aa.f32(v.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE):aa.f32(v.RibbonVertexAttributeConstants.SIZE);this.params.vvColorEnabled?aa.f32(v.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE):
aa.vec4f(v.RibbonVertexAttributeConstants.COLOR);this.params.vvOpacityEnabled&&aa.f32(v.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE);return aa};R.createBufferWriter=function(){return new A(this.layout,this.params)};R.getGLMaterial=function(aa){return 0===aa.output||7===aa.output||4===aa.output||1===aa.output?new C(aa):void 0};R.validateParameterValues=function(aa){"miter"!==aa.join&&(aa.miterLimit=0);this.requiresTransparent(aa)&&(aa.transparent=!0)};R.requiresTransparent=function(aa){return!!(1>
(aa.color&&aa.color[3])||0<aa.innerWidth&&this.colorRequiresTransparent(aa.innerColor)||aa.stipplePattern&&this.colorRequiresTransparent(aa.stippleOffColor)||0<aa.falloff)};R.colorRequiresTransparent=function(aa){return a.isSome(aa)&&1>aa[3]&&0<aa[3]};return ca}(m.Material);let C=function(X){function ca(aa){aa=X.call(this,aa)||this;aa.updateParameters();return aa}k._inheritsLoose(ca,X);var R=ca.prototype;R.updateParameters=function(aa){this.technique=this.techniqueRep.acquireAndReleaseExisting(v.RibbonLineTechnique,
this.material.getTechniqueConfig(this.output,aa),this.technique)};R.beginSlot=function(aa){return this.technique.configuration.occluder?3===aa||10===aa||11===aa:0===this.output||7===this.output?(this.targetSlot=this.technique.configuration.writeDepth?5:8,aa===this.targetSlot):3===aa};R._updateOccludeeState=function(aa){aa.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:aa.hasOccludees})};R.ensureParameters=function(aa){0!==this.output&&7!==
this.output||this._updateOccludeeState(aa);this.updateParameters(aa)};R.bind=function(aa,ka){aa.bindProgram(this.technique.program);this.technique.bindPass(aa,this.material.getPassParameters(),ka)};R.getPipelineState=function(aa,ka){return this.technique.getPipelineState(aa,ka)};return ca}(q);const z={width:0,color:[1,1,1,1],join:"miter",cap:"butt",miterLimit:5,writeDepth:!0,polygonOffset:!1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,slicePlaneEnabled:!1,vvFastUpdate:!1,transparent:!1,
isClosed:!1,falloff:0,innerWidth:0,innerColor:null,sceneHasOcludees:!1,...m.materialParametersDefaults,...u.Default};let A=function(){function X(R,aa){this.params=aa;this.numJoinSubdivisions=0;this.vertexBufferLayout=R;switch(this.params.join){case "miter":case "bevel":this.numJoinSubdivisions=aa.stipplePattern?1:0;break;case "round":this.numJoinSubdivisions=1}}var ca=X.prototype;ca.isClosed=function(R){return B(this.params,R.vertexAttr,R.indices)};ca.numCapSubdivisions=function(R){if(this.isClosed(R))return 0;
switch(this.params.cap){case "butt":return 0;case "square":return 1;case "round":return 3}};ca.allocate=function(R){return this.vertexBufferLayout.createBuffer(R)};ca.elementCount=function(R){var aa=2*this.numCapSubdivisions(R)+2,ka=R.indices[v.RibbonVertexAttributeConstants.POSITION].length/2+1;const da=this.isClosed(R);aa=da?2:2*aa;var fa=da?0:1;ka=da?ka:ka-1;if(R.vertexAttr[v.RibbonVertexAttributeConstants.SUBDIVISIONS])for(R=R.vertexAttr[v.RibbonVertexAttributeConstants.SUBDIVISIONS].data;fa<
ka;++fa)aa+=4+2*R[fa];else aa+=(ka-fa)*(2*this.numJoinSubdivisions+4);return aa+2};ca.write=function(R,aa,ka,da){const fa=T,ea=O,Y=Q;var Z=aa.vertexAttr[v.RibbonVertexAttributeConstants.POSITION].data,ba=aa.indices&&aa.indices[v.RibbonVertexAttributeConstants.POSITION];const ia=this.numCapSubdivisions(aa);ba&&ba.length!==2*(Z.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");ba=null;aa.vertexAttr[v.RibbonVertexAttributeConstants.SUBDIVISIONS]&&(ba=aa.vertexAttr[v.RibbonVertexAttributeConstants.SUBDIVISIONS].data);
let ja=1,la=0;this.params.vvSizeEnabled?la=aa.vertexAttr[v.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE].data[0]:aa.vertexAttr[v.RibbonVertexAttributeConstants.SIZE]&&(ja=aa.vertexAttr[v.RibbonVertexAttributeConstants.SIZE].data[0]);let qa=[1,1,1,1],na=0;this.params.vvColorEnabled?na=aa.vertexAttr[v.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE].data[0]:aa.vertexAttr[v.RibbonVertexAttributeConstants.COLOR]&&(qa=aa.vertexAttr[v.RibbonVertexAttributeConstants.COLOR].data);let oa=0;this.params.vvOpacityEnabled&&
(oa=aa.vertexAttr[v.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE].data[0]);const ua=Z.length/3;R=R.transformation;const za=new Float32Array(ka.buffer);ka=this.vertexBufferLayout.stride/4;let Fa=da*ka;da=Fa;const La=(Pa,sa,Ga,Ra,Ua,ha,Ya)=>{za[Fa++]=sa[0];za[Fa++]=sa[1];za[Fa++]=sa[2];za[Fa++]=Ra;za[Fa++]=Ua;za[Fa++]=ha;za[Fa++]=Pa[0];za[Fa++]=Pa[1];za[Fa++]=Pa[2];za[Fa++]=Ga[0];za[Fa++]=Ga[1];za[Fa++]=Ga[2];this.params.vvSizeEnabled?za[Fa++]=la:za[Fa++]=ja;this.params.vvColorEnabled?za[Fa++]=
na:(Pa=Math.min(4*Ya,qa.length-4),za[Fa++]=qa[Pa+0],za[Fa++]=qa[Pa+1],za[Fa++]=qa[Pa+2],za[Fa++]=qa[Pa+3]);this.params.vvOpacityEnabled&&(za[Fa++]=oa)};Fa+=ka;c.set(ea,Z[0],Z[1],Z[2]);R&&c.transformMat4(ea,ea,R);if(aa=this.isClosed(aa)){var Sa=Z.length-3;c.set(fa,Z[Sa],Z[Sa+1],Z[Sa+2]);R&&c.transformMat4(fa,fa,R)}else{c.copy(fa,ea);c.set(Y,Z[3],Z[4],Z[5]);R&&c.transformMat4(Y,Y,R);for(Sa=0;Sa<ia;++Sa){var Ia=1-Sa/ia;La(fa,ea,Y,Ia,1,-4,0);La(fa,ea,Y,Ia,1,4,0)}La(fa,ea,Y,0,0,-4,0);La(fa,ea,Y,0,0,4,
0);c.copy(fa,ea);c.copy(ea,Y)}Ia=aa?0:1;for(Sa=aa?ua:ua-1;Ia<Sa;Ia++){var Qa=(Ia+1)%ua*3;c.set(Y,Z[Qa+0],Z[Qa+1],Z[Qa+2]);R&&c.transformMat4(Y,Y,R);La(fa,ea,Y,0,1,-1,Ia);La(fa,ea,Y,0,1,1,Ia);Qa=ba?ba[Ia]:this.numJoinSubdivisions;for(let Pa=0;Pa<Qa;++Pa){const sa=(Pa+1)/(Qa+1);La(fa,ea,Y,sa,1,-2,Ia);La(fa,ea,Y,sa,1,2,Ia)}La(fa,ea,Y,1,0,-2,Ia);La(fa,ea,Y,1,0,2,Ia);c.copy(fa,ea);c.copy(ea,Y)}if(aa)Fa=y(za,da+ka,za,Fa,2*ka);else for(La(fa,ea,Y,0,1,-5,Sa),La(fa,ea,Y,0,1,5,Sa),Z=0;Z<ia;++Z)ba=(Z+1)/ia,
La(fa,ea,Y,ba,1,-5,Sa),La(fa,ea,Y,ba,1,5,Sa);y(za,da+ka,za,da,ka);Fa=y(za,Fa-ka,za,Fa,ka)};return X}();const t=d.create(),D=d.create(),E=d.create(),G=d.create(),H=d.create(),I=h.createRenderScreenPointArray3(),J=h.createRenderScreenPointArray3(),K=d.create(),L=d.create(),S=g.lineSegment.create(),M=g.lineSegment.create(),T=d.create(),O=d.create(),Q=d.create(),F=[h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3(),h.createRenderScreenPointArray3()],
N=[d.create(),d.create(),d.create(),d.create()],P=g.plane.create(),U=g.plane.create(),V=g.plane.create(),W=g.plane.create();b.RibbonLineMaterial=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/VisualVariableMaterialParameters":function(){define(["../../../../chunks/mat3f64","../../../../chunks/vec3f32"],function(b,k){var a;(a||(a={})).Default={vvSizeEnabled:!1,vvSizeMinSize:k.fromValues(1,1,1),vvSizeMaxSize:k.fromValues(100,100,100),vvSizeOffset:k.fromValues(0,
0,0),vvSizeFactor:k.fromValues(1,1,1),vvSizeValue:k.fromValues(1,1,1),vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvOpacityEnabled:!1,vvOpacityValues:[0,0,0,0,0,0,0,0],vvOpacityOpacities:[1,1,1,1,1,1,1,1],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:b.create()};return a})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../lib/OrderIndependentTransparency ../lib/StencilUtils ../../../../chunks/RibbonLine.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){const v={position:0,subdivisionFactor:1,uv0:2,auxpos1:3,auxpos2:4,size:6,sizeFeatureAttribute:6,color:5,colorFeatureAttribute:5,opacityFeatureAttribute:7};d=function(B){function x(z,A){A=B.call(this,z,A)||this;A.stipplePattern=null;A.stippleTextureBind=null;A.stippleTextureRepository=z.stippleTextureRepository;return A}a._inheritsLoose(x,B);var C=x.prototype;C.initializeProgram=function(z){var A=x.shader.get();const t=this.configuration;A=A.build({OITEnabled:0===
t.transparencyPassType,output:t.output,slicePlaneEnabled:t.slicePlaneEnabled,sliceHighlightDisabled:t.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,stippleEnabled:t.stippleEnabled,stippleOffColorEnabled:t.stippleOffColorEnabled,stippleUVMaxEnabled:t.stippleIntegerRepeatsEnabled,stippleIntegerRepeatsEnabled:t.stippleIntegerRepeatsEnabled,roundCaps:t.roundCaps,roundJoins:t.roundJoins,vvColor:t.vvColor,vvSize:t.vvSize,vvInstancingEnabled:!0,vvOpacity:t.vvOpacity,falloffEnabled:t.falloffEnabled,
innerColorEnabled:t.innerColorEnabled});return new e(z.rctx,A.generateSource("vertex"),A.generateSource("fragment"),v)};C.dispose=function(){B.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};C.bindPass=function(z,A,t){g.View.bindProjectionMatrix(this.program,t.camera.projectionMatrix);4===this.configuration.output&&n.OutputHighlight.bindOutputHighlight(z,this.program,t);this.program.setUniform1f("intrinsicWidth",
A.width);this.program.setUniform4fv("intrinsicColor",A.color);this.program.setUniform1f("miterLimit","miter"!==A.join?0:A.miterLimit);this.program.setUniform2fv("nearFar",t.camera.nearFar);this.program.setUniform1f("pixelRatio",t.camera.pixelRatio);this.program.setUniform2f("screenSize",t.camera.fullViewport[2],t.camera.fullViewport[3]);w.VisualVariables.bindUniformsWithOpacity(this.program,A);if(this.stipplePattern!==A.stipplePattern){const D=A.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,
D);this.stipplePattern=D}this.configuration.stippleEnabled&&(z=l.isSome(this.stippleTextureBind)?this.stippleTextureBind(z,0)*t.camera.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/z),this.configuration.stippleOffColorEnabled&&(z=l.unwrap(A.stippleOffColor),this.program.setUniform4f("stippleOffColor",z[0],z[1],z[2],3<z.length?z[3]:1)));this.configuration.falloffEnabled&&this.program.setUniform1f("falloff",A.falloff);this.configuration.innerColorEnabled&&
(this.program.setUniform4fv("innerColor",l.unwrapOr(A.innerColor,A.color)),this.program.setUniform1f("innerWidth",A.innerWidth*t.camera.pixelRatio))};C.bindDraw=function(z){g.View.bindView(this.program,z);p.Slice.bindUniformsWithOrigin(this.program,this.configuration,z)};C.setPipelineState=function(z,A){const t=this.configuration,D=3===z,E=2===z;return f.makePipelineState({blending:0===t.output||7===t.output?D?q.blendingDefault:q.OITBlending(z):null,depthTest:{func:q.OITDepthTest(z)},depthWrite:D?
!t.transparent&&t.writeDepth&&f.defaultDepthWriteParams:q.OITDepthWrite(z),colorWrite:f.defaultColorWriteParams,stencilWrite:t.sceneHasOcludees?m.stencilWriteMaskOn:null,stencilTest:t.sceneHasOcludees?A?m.stencilToolMaskBaseParams:m.stencilBaseAllZerosParams:null,polygonOffset:D||E?t.polygonOffset&&y:q.OITPolygonOffset})};C.initializePipeline=function(){const z=this.configuration,A=z.polygonOffset&&y;z.occluder&&(this._occluderPipelineTransparent=f.makePipelineState({blending:q.blendingDefault,polygonOffset:A,
depthTest:m.depthCompareAlways,depthWrite:null,colorWrite:f.defaultColorWriteParams,stencilWrite:null,stencilTest:m.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=f.makePipelineState({blending:q.blendingDefault,polygonOffset:A,depthTest:m.depthCompareAlways,depthWrite:null,colorWrite:f.defaultColorWriteParams,stencilWrite:m.stencilWriteMaskOff,stencilTest:m.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=f.makePipelineState({blending:null,polygonOffset:A,depthTest:m.depthCompareLess,
depthWrite:null,colorWrite:null,stencilWrite:m.stencilWriteMaskOn,stencilTest:m.stencilToolMaskBaseParams}));this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,!1)};C.getPipelineState=function(z,A){return A?this._occludeePipelineState:this.configuration.occluder?11===z?this._occluderPipelineTransparent:10===z?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:this.pipeline};a._createClass(x,
[{key:"primitiveType",get:function(){return 5}}]);return x}(d.ShaderTechnique);d.shader=new h.ReloadableShaderModule(u.RibbonLineShader,()=>new Promise(function(B,x){b(["./RibbonLine.glsl"],B,x)}));const y={factor:0,units:-4};h=function(B){function x(){var C=B.apply(this,arguments)||this;C.output=0;C.occluder=!1;C.slicePlaneEnabled=!1;C.sliceHighlightDisabled=!1;C.vertexColors=!1;C.transparent=!1;C.polygonOffset=!1;C.writeDepth=!1;C.stippleEnabled=!1;C.stippleOffColorEnabled=!1;C.stippleIntegerRepeatsEnabled=
!1;C.roundCaps=!1;C.roundJoins=!1;C.vvSize=!1;C.vvColor=!1;C.vvOpacity=!1;C.falloffEnabled=!1;C.innerColorEnabled=!1;C.sceneHasOcludees=!1;C.transparencyPassType=3;return C}a._inheritsLoose(x,B);return x}(c.ShaderTechniqueConfiguration);r.__decorate([c.parameter({count:8})],h.prototype,"output",void 0);r.__decorate([c.parameter()],h.prototype,"occluder",void 0);r.__decorate([c.parameter()],h.prototype,"slicePlaneEnabled",void 0);r.__decorate([c.parameter()],h.prototype,"sliceHighlightDisabled",void 0);
r.__decorate([c.parameter()],h.prototype,"vertexColors",void 0);r.__decorate([c.parameter()],h.prototype,"transparent",void 0);r.__decorate([c.parameter()],h.prototype,"polygonOffset",void 0);r.__decorate([c.parameter()],h.prototype,"writeDepth",void 0);r.__decorate([c.parameter()],h.prototype,"stippleEnabled",void 0);r.__decorate([c.parameter()],h.prototype,"stippleOffColorEnabled",void 0);r.__decorate([c.parameter()],h.prototype,"stippleIntegerRepeatsEnabled",void 0);r.__decorate([c.parameter()],
h.prototype,"roundCaps",void 0);r.__decorate([c.parameter()],h.prototype,"roundJoins",void 0);r.__decorate([c.parameter()],h.prototype,"vvSize",void 0);r.__decorate([c.parameter()],h.prototype,"vvColor",void 0);r.__decorate([c.parameter()],h.prototype,"vvOpacity",void 0);r.__decorate([c.parameter()],h.prototype,"falloffEnabled",void 0);r.__decorate([c.parameter()],h.prototype,"innerColorEnabled",void 0);r.__decorate([c.parameter()],h.prototype,"sceneHasOcludees",void 0);r.__decorate([c.parameter({count:4})],
h.prototype,"transparencyPassType",void 0);k.RibbonLineTechnique=d;k.RibbonLineTechniqueConfiguration=h;k.RibbonVertexAttributeConstants={POSITION:"position",SUBDIVISIONFACTOR:"subdivisionFactor",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",SUBDIVISIONS:"subdivisions",COLOR:"color",COLORFEATUREATTRIBUTE:"colorFeatureAttribute",SIZE:"size",SIZEFEATUREATTRIBUTE:"sizeFeatureAttribute",OPACITYFEATUREATTRIBUTE:"opacityFeatureAttribute"};k.ribbonVertexAttributeLocations=v;Object.defineProperty(k,"__esModule",
{value:!0})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f){function g(n){const w=new a.ShaderBuilder;w.extensions.add("GL_OES_standard_derivatives");w.include(f.PiUtils);w.include(c.RibbonVertexPosition,n);w.include(e.LineStipple,n);1===n.output&&w.include(d.OutputDepth,n);w.vertex.uniforms.add("proj","mat4").add("view","mat4").add("nearFar","vec2").add("pixelRatio","float").add("miterLimit","float").add("screenSize","vec2");w.attributes.add("position","vec3");w.attributes.add("subdivisionFactor","float");w.attributes.add("uv0",
"vec2");w.attributes.add("auxpos1","vec3");w.attributes.add("auxpos2","vec3");w.varyings.add("vColor","vec4");w.varyings.add("vpos","vec3");w.varyings.add("linearDepth","float");const q=n.falloffEnabled,m=n.innerColorEnabled;m&&w.varyings.add("vLineDistance","float");q&&w.varyings.add("vLineDistanceNorm","float");n.falloffEnabled&&w.fragment.uniforms.add("falloff","float");n.innerColorEnabled&&(w.fragment.uniforms.add("innerColor","vec4"),w.fragment.uniforms.add("innerWidth","float"));w.vertex.code.add(k.glsl`
		#define PERPENDICULAR(v) vec2(v.y, -v.x);
		#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y > 0.0

		float interp(float ncp, vec4 a, vec4 b) {
			return (-ncp - a.z) / (b.z - a.z);
		}

		vec2 rotate(vec2 v, float a) {
			float s = sin(a);
			float c = cos(a);
			mat2 m = mat2(c, -s, s, c);
			return m * v;
		}
`);w.vertex.code.add(k.glsl`
    vec4 projectAndScale(vec4 pos) {
      vec4 posNdc = proj * pos;

      // Note that posNdc is in -1:1, scaling by screenSize converts this to a coordinate system
      // that is twice scaled (going from -size:size).
      posNdc.xy *= screenSize / posNdc.w;
      return posNdc;
    }
`);w.vertex.code.add(k.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      //current pos behind ncp --> we need to clip
      if(pos.z > -nearFar[0]) {
        if (!isStartVertex) {
          //previous in front of ncp
          if(prev.z < -nearFar[0]) {
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
        //next in front of ncp
        if(isStartVertex) {
          if(next.z < -nearFar[0]) {
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        //previous behind ncp
        if (prev.z > -nearFar[0]) {
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        //next behind ncp
        if (next.z > -nearFar[0]) {
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
`);w.vertex.code.add(k.glsl`
  void main(void) {
    float coverage = 1.0;
    vpos = position;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;
      bool isJoin = abs(uv0.y)-3.0 < 0.0;

      float lineWidth = getSize() * pixelRatio;

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `);n.stippleEnabled&&w.vertex.code.add(k.glsl`
      // uv0.x is either 0 or 1, depending on whether this is considered the start of a line segment
      // or the end. If start, then use pos->next, otherwise use prev->pos to define the line segment
      // vector
      vec4 stippleSegmentInfo = mix(vec4(pos.xy, right), vec4(prev.xy, left), uv0.x);
      vec2 stippleSegmentOrigin = stippleSegmentInfo.xy;

      // Scale s.t. it's in units of stipple pattern size.
      vec2 stippleSegmentDirection = stippleSegmentInfo.zw;
    `);w.vertex.code.add(k.glsl`
    left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
    right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);

    vec2 capDisplacementDir = vec2(0, 0);
    vec2 joinDisplacementDir = vec2(0, 0);
    float displacementLen = lineWidth;

    if (isJoin) {

      // JOIN handling ---------------------------------------------------
      // determine if vertex is on the "outside or "inside" of the join
      bool isOutside = ISOUTSIDE;

      // compute miter join position first
      joinDisplacementDir = normalize(left + right);
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      // compute miter stretch
      if (leftLen > 0.001 && rightLen > 0.001) {
        float nDotSeg = dot(joinDisplacementDir, left);
        displacementLen /= length(nDotSeg * left - joinDisplacementDir);

        // limit displacement of inner vertices
        if (!isOutside) {
          displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
        }
      }

      if (isOutside && (displacementLen > miterLimit * lineWidth)) {
    `);n.roundJoins?w.vertex.code.add(k.glsl`
        vec2 startDir;
        vec2 endDir;

        if (leftLen < 0.001) {
          startDir = right;
        }
        else{
          startDir = left;
        }
        startDir = normalize(startDir);
        startDir = PERPENDICULAR(startDir);

        if (rightLen < 0.001) {
          endDir = left;
        }
        else{
          endDir = right;
        }
        endDir = normalize(endDir);
        endDir = PERPENDICULAR(endDir);

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * subdivisionFactor * rotationAngle);
      `):w.vertex.code.add(k.glsl`
        // convert to bevel join if miterLimit is exceeded
        if (leftLen < 0.001) {
          joinDisplacementDir = right;
        }
        else if (rightLen < 0.001) {
          joinDisplacementDir = left;
        }
        else {
          joinDisplacementDir = isStartVertex ? right : left;
        }
        joinDisplacementDir = normalize(joinDisplacementDir);
        joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
  `);w.vertex.code.add(k.glsl`
        displacementLen = lineWidth;
      }
    } else {
    // CAP handling ---------------------------------------------------
    if (leftLen < 0.001) {
      joinDisplacementDir = right;
    }
    else if (rightLen < 0.001) {
      joinDisplacementDir = left;
    }
    else {
      joinDisplacementDir = isStartVertex ? right : left;
    }
    joinDisplacementDir = normalize(joinDisplacementDir);
    joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
    displacementLen = lineWidth;

    capDisplacementDir = isStartVertex ? -right : left;
  `);n.roundCaps?w.vertex.code.add(k.glsl`
    float angle = subdivisionFactor*PI*0.5;
    joinDisplacementDir *= cos(angle);
    capDisplacementDir *= sin(angle);
    `):w.vertex.code.add(k.glsl`
    capDisplacementDir *= subdivisionFactor;
    `);w.vertex.code.add(k.glsl`
  }

  // Displacement (in pixels) caused by join/or cap
  vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

  ${q||m?k.glsl`float lineDist = lineWidth * sign(uv0.y) * pos.w;`:""}

  ${m?k.glsl`vLineDistance = lineDist;`:""}
  ${q?k.glsl`vLineDistanceNorm = lineDist / lineWidth;`:""}

  pos.xy += dpos;
  `);n.stippleEnabled&&(w.vertex.code.add(k.glsl`
    {
      // Compute the stipple pattern UV coordinate from the actual position, based on the origin
      // and direction of the line segment on which the stipple pattern is based.

      // Project the vector from the origin of the segment to the vertex onto the line segment.
      // Note the 0.5 factor due to projected positions being at twice the screen size scale (see projectAndScale)
      vec2 posVec = pos.xy - stippleSegmentOrigin;

      float stippleSegmentDirectionLength = length(stippleSegmentDirection);
    `),n.stippleIntegerRepeatsEnabled&&w.vertex.code.add(k.glsl`
      float numberOfPatternRepeats = stippleSegmentDirectionLength * 0.5 * stipplePatternPixelSizeInv;
      float roundedNumberOfPatternRepeats = floor(numberOfPatternRepeats);
      stipplePatternUvMax = roundedNumberOfPatternRepeats;
      `),w.vertex.code.add(k.glsl`
      if (stippleSegmentDirectionLength >= 0.001) {
        // Project the vertex position onto the line segment.
        float projectedLength = dot(stippleSegmentDirection, posVec) / stippleSegmentDirectionLength * 0.5;
     ${n.stippleIntegerRepeatsEnabled?"float wholeNumberOfRepeatsScale \x3d roundedNumberOfPatternRepeats / numberOfPatternRepeats;":"float wholeNumberOfRepeatsScale \x3d 1.0;"}
        stipplePatternUv = projectedLength * wholeNumberOfRepeatsScale * stipplePatternPixelSizeInv * pos.w;
        } else {
          stipplePatternUv = 1.0;
        }
      }
    `));w.vertex.code.add(k.glsl`
      // Convert back into NDC
      pos.xy = pos.xy / screenSize * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      gl_Position = pos;
    }
  }
  `);w.include(l.Slice,n);w.fragment.uniforms.add("intrinsicColor","vec4");w.fragment.include(r.ColorConversion);w.fragment.code.add(k.glsl`
  void main() {
    discardBySlice(vpos);
    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);

    vec4 color = intrinsicColor * vColor;
  `);n.innerColorEnabled&&(w.fragment.uniforms.add("pixelRatio","float"),w.fragment.code.add(k.glsl`
    float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
    float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
    float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
    color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);
    `));w.fragment.code.add(k.glsl`
    vec4 finalColor = blendStipple(color, stippleAlpha);
  `);n.falloffEnabled&&w.fragment.code.add(k.glsl`
    finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);
    `);w.fragment.code.add(k.glsl`
    if (finalColor.a < ${k.glsl.float(h.symbolAlphaCutoff)}) {
      discard;
    }

    ${7===n.output?k.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${0===n.output?k.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${0===n.output&&n.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${4===n.output?k.glsl`gl_FragColor = vec4(1.0);`:""}
    ${1===n.output?k.glsl`outputDepth(linearDepth);`:""}
  }
  `);return w}var p=Object.freeze({__proto__:null,build:g});b.RibbonLineShader=p;b.build=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.RibbonVertexPosition=function(a,r){a.vertex.uniforms.add("intrinsicWidth","float");r.vvSize?(a.attributes.add("sizeFeatureAttribute","float"),a.vertex.uniforms.add("vvSizeMinSize","vec3"),a.vertex.uniforms.add("vvSizeMaxSize","vec3"),a.vertex.uniforms.add("vvSizeOffset",
"vec3"),a.vertex.uniforms.add("vvSizeFactor","vec3"),a.vertex.code.add(k.glsl`
    float getSize() {
      return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
    }
    `)):(a.attributes.add("size","float"),a.vertex.code.add(k.glsl`
    float getSize(){
      return intrinsicWidth * size;
    }
    `));r.vvOpacity?(a.attributes.add("opacityFeatureAttribute","float"),a.vertex.defines.addInt("VV_OPACITY_N",8),a.vertex.code.add(k.glsl`
    uniform float vvOpacityValues[VV_OPACITY_N];
    uniform float vvOpacityOpacities[VV_OPACITY_N];

    float interpolateOpacity( float value ){
      if (value <= vvOpacityValues[0]) {
        return vvOpacityOpacities[0];
      }

      for (int i = 1; i < VV_OPACITY_N; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
        }
      }

      return vvOpacityOpacities[VV_OPACITY_N - 1];
    }

    vec4 applyOpacity( vec4 color ){
      return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
    }
    `)):a.vertex.code.add(k.glsl`
    vec4 applyOpacity( vec4 color ){
      return color;
    }
    `);r.vvColor?(a.attributes.add("colorFeatureAttribute","float"),a.vertex.defines.addInt("VV_COLOR_N",8),a.vertex.code.add(k.glsl`
    uniform float vvColorValues[VV_COLOR_N];
    uniform vec4 vvColorColors[VV_COLOR_N];

    vec4 interpolateColor( float value ) {
      if (value <= vvColorValues[0]) {
        return vvColorColors[0];
      }

      for (int i = 1; i < VV_COLOR_N; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return mix(vvColorColors[i-1], vvColorColors[i], f);
        }
      }

      return vvColorColors[VV_COLOR_N - 1];
    }

    vec4 getColor(){
      return applyOpacity(interpolateColor(colorFeatureAttribute));
    }
    `)):(a.attributes.add("color","vec4"),a.vertex.code.add(k.glsl`
    vec4 getColor(){
      return applyOpacity(color);
    }
    `))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.LineStipple=function(a,r){a.defines.addFloat("STIPPLE_ALPHA_COLOR_DISCARD",.001);a.defines.addFloat("STIPPLE_ALPHA_HIGHLIGHT_DISCARD",.5);r.stippleEnabled?(a.vertex.uniforms.add("stipplePatternPixelSizeInv","float"),r.stippleUVMaxEnabled&&a.varyings.add("stipplePatternUvMax","float"),a.varyings.add("stipplePatternUv",
"float"),a.fragment.uniforms.add("stipplePatternTexture","sampler2D"),r.stippleOffColorEnabled&&a.fragment.uniforms.add("stippleOffColor","vec4"),a.fragment.code.add(k.glsl`
  float getStippleAlpha() {
    float stipplePatternUvClamped = stipplePatternUv * gl_FragCoord.w;
    ${r.stippleUVMaxEnabled?"stipplePatternUvClamped \x3d clamp(stipplePatternUvClamped, 0.0, stipplePatternUvMax);":""}

    return texture2D(stipplePatternTexture, vec2(mod(stipplePatternUvClamped, 1.0), 0.5)).a;
  }`),r.stippleOffColorEnabled?a.fragment.code.add(k.glsl`
    #define discardByStippleAlpha(stippleAlpha, threshold) {}
    #define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)
    `):a.fragment.code.add(k.glsl`
    #define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
    #define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)
    `)):a.fragment.code.add(k.glsl`
  float getStippleAlpha() { return 1.0; }

  #define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
  #define blendStipple(color, _stippleAlpha_) color
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.PiUtils=function(a){a.vertex.code.add(k.glsl`
    const float PI = 3.141592653589793;
  `);a.fragment.code.add(k.glsl`
    const float PI = 3.141592653589793;
    const float LIGHT_NORMALIZATION = 1.0 / PI;
    const float INV_PI = 0.3183098861837907;
    const float HALF_PI = 1.570796326794897;
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./Camera"],function(b,k){return function(){function a(r,l,h,d,c,e){this.camera=null;this.lastFrameCamera=new k;this.slot=this.pass=0;this.highlightDepthTexture=null;this.renderOccludedMask=13;this.hasOccludees=!1;this.rctx=r;this.offscreenRenderingHelper=l;this.scenelightingData=h;this.shadowMap=d;this.ssaoHelper=c;this.sliceHelper=
e}a.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=13};b._createClass(a,[{key:"isHighlightPass",get:function(){return 5===this.pass}}]);return a}()})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/PooledArray ../../../../core/Accessor ../../../../core/MapUtils ./Material ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){let B=function(){};b.SortedRenderGeometryRenderer=function(x){function C(){var A=x.apply(this,arguments)||this;A._pendingAddsRemoves=new Map;A._adds=new w;A._removes=new w;A._updates=new w({allocator:t=>t||new B,deallocator:t=>{t.renderGeometry=null;return t}});A._materialRenderers=new Map;A._sortedMaterialRenderers=new w;A._hasHighlights=!1;A._hasWater=!1;return A}k._inheritsLoose(C,x);var z=C.prototype;z.dispose=function(){this._adds.prune();this._removes.prune();
this._updates.prune();this._materialRenderers&&(this._materialRenderers.forEach(A=>A.dispose()),this._materialRenderers.clear(),this._sortedMaterialRenderers.clear())};z.stopAnimationsAtTime=function(A){this._sortedMaterialRenderers.forAll(t=>l.applySome(t.material.animation,D=>D.stopAtTime(A)))};z.commitChanges=function(){let A=!1;if(!this.updating)return!1;this.updateAddsRemoves();let t=!1,D=!1;v.splitRenderGeometryChangeSetByMaterial({numToAdd:this._adds.length,toAdd:this._adds.data,numToRemove:this._removes.length,
toRemove:this._removes.data,numToUpdate:this._updates.length,toUpdate:this._updates.data}).forEach((E,G)=>{let H=this._materialRenderers.get(G);!H&&0<E.toAdd.length&&(H=new y(this.rctx,this.materialRepository,G),this._materialRenderers.set(G,H),D=t=A=!0);if(H){var I=t||H.hasHighlights,J=D||H.hasWater;H.modify(E);t=t||I!==H.hasHighlights;D=D||J!==H.hasWater;H.isEmpty&&(this._materialRenderers.delete(G),H.dispose(),A=!0)}});this._adds.clear();this._removes.clear();this._updates.clear();this._pendingAddsRemoves.clear();
A&&this.updateSortedMaterialRenderers();t&&(this._hasHighlights=m.someMap(this._materialRenderers,E=>E.hasHighlights));D&&(this._hasWater=m.someMap(this._materialRenderers,E=>E.hasWater));this.notifyChange("updating");return!0};z.add=function(A){if(0!==A.length){var t=0===this._pendingAddsRemoves.size;for(const D of A)this._pendingAddsRemoves.set(D,0);t&&this.notifyChange("updating")}};z.remove=function(A){const t=0===this._pendingAddsRemoves.size;for(const D of A)A=this._pendingAddsRemoves.get(D),
0===A?this._pendingAddsRemoves.set(D,2):2!==A&&this._pendingAddsRemoves.set(D,1);t&&0<this._pendingAddsRemoves.size&&this.notifyChange("updating")};z.modify=function(A,t){const D=0===this._updates.length;for(const E of A)A=this._updates.pushNew(),A.renderGeometry=E,A.updateType=t;D&&0<this._updates.length&&this.notifyChange("updating")};z.updateLogic=function(A){let t=!1;this._sortedMaterialRenderers.forAll(({materialRenderer:D})=>{D.updateLogic&&D.updateLogic(A)&&(t=!0)});return t};z.draw=function(A,
t){for(let D=0;D<this._sortedMaterialRenderers.length;D++){const E=this._sortedMaterialRenderers.data[D];u.materialPredicate(E.material,A)&&E.materialRenderer.render(null,A,t,null)}};z.updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let A=0;this._materialRenderers.forEach((t,D)=>{D.insertOrder=A++;this._sortedMaterialRenderers.push({material:D,materialRenderer:t})});this._sortedMaterialRenderers.sort((t,D)=>{const E=D.material.renderPriority-t.material.renderPriority;
return 0!==E?E:t.material.insertOrder-D.material.insertOrder})};z.updateAddsRemoves=function(){this._adds.clear();this._removes.clear();this._pendingAddsRemoves.forEach((t,D)=>{switch(t){case 0:this._adds.push(D);break;case 1:this._removes.push(D)}});let A=0;for(;A<this._updates.length;)this._pendingAddsRemoves.has(this._updates.data[A].renderGeometry)?this._updates.removeUnorderedIndex(A):A++};k._createClass(C,[{key:"updating",get:function(){return 0<this._pendingAddsRemoves.size||0<this._updates.length}},
{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return m.someMap(this._materialRenderers,A=>A.rendersOccluded)}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);return C}(q);a.__decorate([c.property()],b.SortedRenderGeometryRenderer.prototype,"rctx",void 0);a.__decorate([c.property()],
b.SortedRenderGeometryRenderer.prototype,"materialRepository",void 0);a.__decorate([c.property()],b.SortedRenderGeometryRenderer.prototype,"updating",null);b.SortedRenderGeometryRenderer=a.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],b.SortedRenderGeometryRenderer);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./Util"],function(b,k){b.splitRenderGeometryChangeSetByMaterial=
function(a){const r=new Map;let l=null,h=null;const d=f=>{if(f===l)return h;let g=r.get(f);g||(g={toAdd:[],numToAdd:-1,toRemove:[],numToRemove:-1,toUpdate:[],numToUpdate:-1},r.set(f,g));l=f;return h=g};for(var c=0;c<a.numToAdd;c++){var e=a.toAdd[c];1<=k.getFirstObjectValue(e.data.indices).length&&d(e.material).toAdd.push(e)}for(c=0;c<a.numToRemove;c++)e=a.toRemove[c],1<=k.getFirstObjectValue(e.data.indices).length&&d(e.material).toRemove.push(e);for(c=0;c<a.numToUpdate;c++)e=a.toUpdate[c],1<=k.getFirstObjectValue(e.renderGeometry.data.indices).length&&
d(e.renderGeometry.material).toUpdate.push(e);return r};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../core/MapUtils ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../lib/Util ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject ./utils ../../lib/ResizableFloat32Array ../WaterGLMaterial ./Instance ../../statistics/RendererPerformanceInfo".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){function m(C,z,A,t){const D=new Map,E=z.vertexBufferLayout.stride/4,G=(H,I)=>{var J=H.origin;const K=C.get(J.id);let L=D.get(J.id);null==L&&(L={optimalCount:null==K?0:K.optimalCount,sparseCount:null==K?0:K.buffer.size,toAdd:[],toRemove:[],origin:J.vec3},D.set(J.id,L));J=z.elementCount(H.data)*E;I?(L.optimalCount+=J,L.sparseCount+=J,L.toAdd.push(H)):(L.optimalCount-=J,L.toRemove.push(H))};for(const H of A)G(H,!0);for(const H of t)G(H,!1);return D}let u=function(){function C(A,
t,D){this.type="MergedRenderer";this._dataByOrigin=new Map;this._hasOccludees=this._hasHighlights=!1;this._rctx=A;this._material=D;this._materialRep=t;this._glMaterials=g.acquireMaterials(this._material,this._materialRep);this._bufferWriter=D.createBufferWriter()}var z=C.prototype;z.dispose=function(){g.releaseMaterials(this._material,this._materialRep);this._dataByOrigin&&(this._dataByOrigin.forEach(A=>{A.vao.dispose(!0);A.vao=null}),this._dataByOrigin.clear(),this._dataByOrigin=null);this._glMaterials&&
(this._glMaterials.forEach(A=>{A&&A.dispose()}),this._glMaterials.clear(),this._glMaterials=null)};z.modify=function(A){this.updateGeometries(A.toUpdate);this.addAndRemoveGeometries(A.toAdd,A.toRemove);this.updateRenderCommands()};z.addAndRemoveGeometries=function(A,t){const D=this._bufferWriter,E=D.vertexBufferLayout,G=E.stride/4,H=this._dataByOrigin,I=m(H,D,A,t);I.forEach((J,K)=>{I.delete(K);var L=J.optimalCount;const S=J.sparseCount;let M=H.get(K);if(null==M)d.assert(0<L),M=this.createData(E,L,
J.origin),H.set(K,M);else if(0===L){M.vao.dispose(!0);M.vao=null;H.delete(K);return}const T=L<J.sparseCount/2;K=v;const O=M.buffer.size,Q=M.buffer.array;L=M.buffer.resize(T?L:S,!1);T||L?this.removeAndRebuild(M,J.toRemove,G,Q,K):0<J.toRemove.length?(this.removeByErasing(M,J.toRemove,G,K),0<J.toAdd.length&&(K.end=O)):(K.begin=O,K.end=O);L=y;d.setMatrixTranslation3(L,-J.origin[0],-J.origin[1],-J.origin[2]);this.append(M,J.toAdd,G,L,K);J=M.vao.vertexBuffers.geometry;if(J.byteSize!==M.buffer.array.buffer.byteLength)J.setData(M.buffer.array);
else{const {begin:F,end:N}=K;F<N&&(K=4*F,J.setSubData(M.buffer.array,K,K,4*N))}M.drawCommandsDirty=!0})};z.updateGeometries=function(A){const t=this._bufferWriter,D=t.vertexBufferLayout.stride/4;for(const H of A){var E=H.updateType;A=H.renderGeometry;const I=this._dataByOrigin.get(A.origin.id),J=I&&I.instances.get(A.uniqueName);if(!J)break;E&1&&(J.isVisible=A.instanceParameters.visible);if(E&9){var G=A.instanceParameters.visible;J.hasHighlights=!!A.instanceParameters.highlights&&G}E&16&&(J.hasOccludees=
!!A.instanceParameters.occludees);E&6&&(E=I.buffer.array,G=I.vao,g.calculateTransformRelToOrigin(A,B,x),t.write({transformation:B,invTranspTransformation:x},A.data,t.vertexBufferLayout.createView(E.buffer),J.from),d.assert(J.from+t.elementCount(A.data)===J.to,"material VBO layout has changed"),G.vertexBuffers.geometry.setSubData(E,J.from*D*4,J.from*D*4,J.to*D*4));I.drawCommandsDirty=!0}};z.updateRenderCommands=function(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(t=>{t.hasHiddenInstances=
!1;t.hasHighlights=!1;t.hasOccludees=!1;r.someMap(t.instances,D=>{D.isVisible?(D.hasHighlights&&(this._hasHighlights=!0,t.hasHighlights=!0),D.hasOccludees&&(this._hasOccludees=!0,t.hasOccludees=!0)):t.hasHiddenInstances=!0;return t.hasHiddenInstances&&t.hasHighlights&&t.hasOccludees})});const A=t=>{t.drawCommandsDefault=null;t.drawCommandsHighlight=null;t.drawCommandsOccludees=null;t.stats={default:0,highlight:0,occludees:0};if(0!==t.instances.size)if(t.hasOccludees||t.hasHighlights||t.hasHiddenInstances){var D=
w.sortInstancesAccordingToRange([...t.instances.values()]);t.drawCommandsDefault=[];t.drawCommandsHighlight=[];t.drawCommandsOccludees=[];for(const E of D)E.isVisible&&(E.hasOccludees?w.addOrMerge(t.drawCommandsOccludees,E):w.addOrMerge(t.drawCommandsDefault,E),E.hasHighlights&&w.addOrMerge(t.drawCommandsHighlight,E));D=E=>{let G=0;for(const H of E)G+=H.count;return G/3};t.stats={default:D(t.drawCommandsDefault),highlight:D(t.drawCommandsHighlight),occludees:D(t.drawCommandsOccludees)}}else D=4*t.buffer.size/
e.getStride(t.vao.layout.geometry),t.drawCommandsDefault=[{first:0,count:D}],t.stats={default:D,highlight:0,occludees:0}};this._dataByOrigin.forEach(t=>{t.drawCommandsDirty&&(A(t),t.drawCommandsDirty=!1)})};z.updateLogic=function(A){return this._material.update(A)};z.render=function(A,t,D,E){const G=this._rctx,H=this._glMaterials.get(t.pass),I=5===t.pass;let J=A;3===t.pass&&null===J&&(J=22);if(!H||2!==H.ensureResources(G)||null!=J&&!H.beginSlot(J)||I&&!this._hasHighlights)return!1;H.ensureParameters(D);
const K=H.getTechnique(),L=H.getPipelineState(J,!1);G.setPipelineState(L);H.bind(G,D);let S=!1;this._dataByOrigin.forEach(M=>{if(!(k.isNone(M.drawCommandsDefault)&&k.isNone(M.drawCommandsHighlight)&&k.isNone(M.drawCommandsOccludees)||I&&!M.hasHighlights)){D.origin=M.origin;K.bindDraw(D);K.ensureAttributeLocations(M.vao);G.bindVAO(M.vao);var T=K.primitiveType,O=I?M.drawCommandsHighlight:M.drawCommandsDefault,Q=I?M.stats.highlight:M.stats.default;k.isSome(O)&&(this.renderCommands(G,T,O),q.addToRenderStats(O.length,
Q,E),S=!0);I||(O=M.drawCommandsOccludees,k.isSome(O)&&(Q=H.getPipelineState(J,!0),G.setPipelineState(Q),this.renderCommands(G,T,O),G.setPipelineState(L),q.addToRenderStats(O.length,M.stats.occludees,E),S=!0))}});return S};z.renderCommands=function(A,t,D){for(let E=0;E<D.length;E++)A.drawArrays(t,D[E].first,D[E].count)};z.createData=function(A,t,D){return{instances:new Map,vao:new f(this._rctx,this._material.vertexAttributeLocations,{geometry:h.glLayout(A)},{geometry:c.createVertex(this._rctx,35044)}),
buffer:new p.ResizableFloat32Array(t),optimalCount:0,origin:D,hasHiddenInstances:!1,hasHighlights:!1,hasOccludees:!1,drawCommandsDirty:!1,drawCommandsDefault:null,drawCommandsOccludees:null,drawCommandsHighlight:null,stats:{default:0,highlight:0,occludees:0}}};z.removeAndRebuild=function(A,t,D,E,G){for(const S of t){t=S.uniqueName;const M=A.instances.get(t);A.optimalCount-=(M.to-M.from)*D;A.instances.delete(t)}let H=0;const I=A.buffer.array;G.begin=0;G.end=0;let J=-1,K=-1,L=0;A.instances.forEach(S=>
{const M=S.from*D,T=S.to*D,O=T-M;J!==K&&K!==M?(I.set(E.subarray(J,K),L),L+=K-J,J=M):-1===J&&(J=M);K=T;S.from=H/D;H+=O;S.to=H/D});J!==K&&I.set(E.subarray(J,K),L);G.end=H};z.removeByErasing=function(A,t,D,E){E.begin=Infinity;E.end=-Infinity;let G=-1,H=-1;for(const J of t){t=J.uniqueName;var I=A.instances.get(t);const K=I.from*D;I=I.to*D;G!==H&&H!==K?(A.buffer.erase(G,H),G=K):-1===G&&(G=K);H=I;A.instances.delete(t);A.optimalCount-=I-K;K<E.begin&&(E.begin=K);I>E.end&&(E.end=I)}G!==H&&A.buffer.erase(G,
H)};z.append=function(A,t,D,E,G){const H=this._bufferWriter;for(const J of t){var I=k.isSome(J.transformation)?a.multiply(B,E,J.transformation):E;a.invert(x,I);a.transpose(x,x);t=G.end;H.write({transformation:I,invTranspTransformation:x},J.data,H.vertexBufferLayout.createView(A.buffer.array.buffer),G.end/D);I=H.elementCount(J.data)*D;const K=t+I;d.assert(null==A.instances.get(J.uniqueName));const L=J.instanceParameters.visible;t=new w.Instance(t/D,K/D,L,!!J.instanceParameters.highlights&&L,!!J.instanceParameters.occludees);
A.instances.set(J.uniqueName,t);A.optimalCount+=I;G.end+=I}};b._createClass(C,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&r.someMap(this._glMaterials,A=>A instanceof n.WaterGLMaterial)}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&1!==this._material.renderOccluded}},{key:"test",get:function(){return{material:this._material,
glMaterials:this._glMaterials}}}]);return C}();const v={begin:0,end:0},y=l.create(),B=l.create(),x=l.create();return u})},"esri/views/3d/webgl-engine/lib/ResizableFloat32Array":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils"],function(b,k,a){let r=function(){function l(d){null==d?d=16:65536>d&&(d=a.nextHighestPowerOfTwo(d));this._array=new Float32Array(d);this._size=0}var h=l.prototype;h.resize=function(d,c){this._size=d;if(this._size>this._array.length){for(d=
this._array.length||1;d<this._size;)d*=2;d=new Float32Array(d);c&&d.set(this._array);this._array=d;return!0}var e=2*this._size;if(e<=this._array.length){for(d=this._array.length;d>=e;)d=Math.floor(d/2);e=new Float32Array(d);c&&e.set(this._array.subarray(0,d));this._array=e;return!0}return!1};h.append=function(d){const c=this._size;this.resize(this._size+d.length,!0);this._array.set(d,c)};h.erase=function(d,c){for(;d<c;++d)this._array[d]=0};k._createClass(l,[{key:"array",get:function(){return this._array}},
{key:"size",get:function(){return this._size}}]);return l}();b.ResizableFloat32Array=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../lib/GLMaterial","./WaterTechnique"],function(b,k,a,r){a=function(l){function h(c){c=l.call(this,c)||this;c.updateParameters();return c}k._inheritsLoose(h,l);var d=h.prototype;d.updateParameters=function(c){this.technique=this.techniqueRep.acquireAndReleaseExisting(r.WaterTechnique,
this.material.getTechniqueConfig(this.output,c),this.technique)};d.beginSlot=function(c){if(2===this.output)return 22===c;if(5===this.output)return null==c;if(4===this.output)return 3===c;let e=3;this.material.params.transparent&&(e=this.material.params.writeDepth?5:8);return c===e};d.setElapsedTimeUniform=function(c){c.setUniform1f("timeElapsed",.001*this.material.animation.time*this.material.params.animationSpeed)};d._updateShadowState=function(c){c.shadowMappingEnabled!==this.material.params.receiveShadows&&
this.material.setParameterValues({receiveShadows:c.shadowMappingEnabled})};d._updateSSRState=function(c){c.ssrEnabled!==this.material.params.ssrEnabled&&this.material.setParameterValues({ssrEnabled:c.ssrEnabled})};d.ensureResources=function(c){return this.technique.ensureResource(c)};d.ensureParameters=function(c){0===this.output&&(this._updateShadowState(c),this._updateSSRState(c));this.updateParameters(c)};d.bind=function(c,e){c.bindProgram(this.technique.program);this.technique.bindPass(c,this.material.params,
e);2!==this.output&&0!==this.output||this.setElapsedTimeUniform(this.technique.program)};return h}(a);b.WaterGLMaterial=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../lib/DefaultTextureUnits ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../lib/OrderIndependentTransparency ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../../../../chunks/WaterSurface.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){h=function(B){function x(z,A){A=B.call(this,z,A)||this;A.waterTextureRepository=z.waterTextureRepository;return A}a._inheritsLoose(x,B);var C=x.prototype;C.initializeProgram=function(z){var A=x.shader.get();const t=this.configuration;A=A.build({OITEnabled:0===t.transparencyPassType,output:t.output,viewingMode:z.viewingMode,slicePlaneEnabled:t.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,receiveShadows:t.receiveShadows,
pbrMode:3,useCustomDTRExponentForWater:!0,ssrEnabled:t.useSSR,highStepCount:!0});return new e(z.rctx,A.generateSource("vertex"),A.generateSource("fragment"),c.Default3D)};C.ensureResource=function(z){this.waterTextureRepository.ready||this.waterTextureRepository.updating||this.waterTextureRepository.loadTextures(z);return this.waterTextureRepository.ready?2:1};C.bindPass=function(z,A,t){g.View.bindProjectionMatrix(this.program,t.camera.projectionMatrix);0===this.configuration.output&&(t.lighting.setUniforms(this.program,
!1),u.ScreenSpaceReflections.bindUniforms(this.program,z,t));if(0===this.configuration.output||2===this.configuration.output)v.WaterDistortion.bindUniforms(this.program,A),this.waterTextureRepository.bindRepo(z);this.program.setUniform4fv("waterColor",A.color);4===this.configuration.output&&w.OutputHighlight.bindOutputHighlight(z,this.program,t)};C.bindDraw=function(z){g.View.bindView(this.program,z);0!==this.configuration.output&&7!==this.configuration.output||g.View.bindCamPosition(this.program,
z.origin,z.camera.viewInverseTransposeMatrix);0===this.configuration.output&&m.ReadShadowMap.bindUniforms(this.program,z,p.DefaultTextureUnits.SHADOW_MAP);0!==this.configuration.output&&7!==this.configuration.output&&4!==this.configuration.output||n.Slice.bindUniformsWithOrigin(this.program,this.configuration,z)};C.setPipelineState=function(z){const A=this.configuration,t=3===z,D=2===z;return f.makePipelineState({blending:2!==A.output&&4!==A.output&&A.transparent?t?q.blendingDefault:q.OITBlending(z):
null,depthTest:{func:q.OITDepthTest(z)},depthWrite:t?A.writeDepth&&f.defaultDepthWriteParams:q.OITDepthWrite(z),colorWrite:f.defaultColorWriteParams,polygonOffset:t||D?null:q.getOITPolygonOffset(A.enableOffset)})};C.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};return x}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(y.WaterSurface,()=>new Promise(function(B,x){b(["../shaders/WaterSurface.glsl"],B,x)}));l=function(B){function x(){var C=
B.apply(this,arguments)||this;C.output=0;C.receiveShadows=!1;C.slicePlaneEnabled=!1;C.transparent=!1;C.enableOffset=!0;C.writeDepth=!1;C.useSSR=!1;C.isDraped=!1;C.transparencyPassType=3;return C}a._inheritsLoose(x,B);return x}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter({count:8})],l.prototype,"output",void 0);r.__decorate([d.parameter()],l.prototype,"receiveShadows",void 0);r.__decorate([d.parameter()],l.prototype,"slicePlaneEnabled",void 0);r.__decorate([d.parameter()],l.prototype,
"transparent",void 0);r.__decorate([d.parameter()],l.prototype,"enableOffset",void 0);r.__decorate([d.parameter()],l.prototype,"writeDepth",void 0);r.__decorate([d.parameter()],l.prototype,"useSSR",void 0);r.__decorate([d.parameter()],l.prototype,"isDraped",void 0);r.__decorate([d.parameter({count:4})],l.prototype,"transparencyPassType",void 0);k.WaterTechnique=h;k.WaterTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define(["exports",
"../../shaderModules/interfaces","../util/RgbaFloatEncoding.glsl"],function(b,k,a){function r(l){l.fragment.include(a.RgbaFloatEncoding);l.fragment.uniforms.add("depthTex","sampler2D");l.fragment.uniforms.add("shadowMapNum","int");l.fragment.uniforms.add("shadowMapDistance","vec4");l.fragment.uniforms.add("shadowMapMatrix","mat4",4);l.fragment.uniforms.add("depthHalfPixelSz","float");l.fragment.code.add(k.glsl`
    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      float halfPixelSize = depthHalfPixelSz;
      vec4 distance = shadowMapDistance;
      float depth = _linearDepth;

      //choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      if (i >= shadowMapNum) { return 0.0; }

      mat4 mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;

      // vertex completely outside? -> no shadow
      vec3 lvpos = 0.5 * lv.xyz + vec3(0.5);
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;

      float texSize = 0.5 / halfPixelSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);

      float s00 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;
      float s10 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, -halfPixelSize))) < lvpos.z ? 1.0 : 0.0;
      float s11 = rgba2float(texture2D(depthTex, uv + vec2(halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;
      float s01 = rgba2float(texture2D(depthTex, uv + vec2(-halfPixelSize, halfPixelSize))) < lvpos.z ? 1.0 : 0.0;

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }
  `)}(function(l){l.bindUniforms=function(h,d,c){d.shadowMappingEnabled&&(d.shadowMap.bind(h,c),d.shadowMap.bindView(h,d.origin))};l.bindViewCustomOrigin=function(h,d,c){d.shadowMappingEnabled&&d.shadowMap.bindView(h,c)};l.bindView=function(h,d){d.shadowMappingEnabled&&d.shadowMap.bindView(h,d.origin)}})(r||(r={}));b.ReadShadowMap=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define(["exports","../../shaderModules/interfaces",
"../output/ReadLinearDepth.glsl","./Reprojection.glsl"],function(b,k,a,r){function l(h,d){h.fragment.uniforms.add("nearFar","vec2");h.fragment.uniforms.add("depthMapView","sampler2D");h.fragment.uniforms.add("ssrViewMat","mat4");h.fragment.uniforms.add("invResolutionHeight","float");h.include(a.ReadLinearDepth);h.include(r.Reprojection);h.fragment.code.add(k.glsl`
  const int maxSteps = ${d.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(rpProjectionMat, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(rpProjectionMat, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMapView, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
          return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)}(function(h){h.bindUniforms=function(d,c,e){e.ssrEnabled&&(d.setUniform1i("depthMapView",e.linearDepthTextureID),c.bindTexture(e.linearDepthTexture,e.linearDepthTextureID),d.setUniform2fv("nearFar",e.camera.nearFar),d.setUniformMatrix4fv("ssrViewMat",e.camera.viewMatrix),d.setUniform1f("invResolutionHeight",1/e.camera.height),r.Reprojection.bindUniforms(d,c,e))}})(l||(l={}));b.ScreenSpaceReflections=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports",
"../../shaderModules/interfaces","../util/RgbaFloatEncoding.glsl"],function(b,k,a){b.ReadLinearDepth=function(r){r.fragment.include(a.RgbaFloatEncoding);r.fragment.code.add(k.glsl`
    float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
      return -(rgba2float(texture2D(depthTex, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Reprojection.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){function a(r){r.fragment.uniforms.add("lastFrameColorMap","sampler2D");r.fragment.uniforms.add("reprojectionMat","mat4");r.fragment.uniforms.add("rpProjectionMat","mat4");r.fragment.code.add(k.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = rpProjectionMat * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMat * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy*0.5 + 0.5;
  }
  `)}(function(r){r.bindUniforms=function(l,h,d){l.setUniform1i("lastFrameColorMap",d.lastFrameColorTextureID);h.bindTexture(d.lastFrameColorTexture,d.lastFrameColorTextureID);l.setUniformMatrix4fv("reprojectionMat",d.reprojectionMat);l.setUniformMatrix4fv("rpProjectionMat",d.camera.projectionMatrix)}})(a||(a={}));b.Reprojection=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define(["exports","../../shaderModules/interfaces",
"./FoamRendering.glsl"],function(b,k,a){function r(l){l.fragment.uniforms.add("texWaveNormal","sampler2D");l.fragment.uniforms.add("texWavePerturbation","sampler2D");l.fragment.uniforms.add("waveParams","vec4");l.fragment.uniforms.add("waveDirection","vec2");l.include(a.FoamIntensity);l.fragment.code.add(k.glsl`
      const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);

      vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
        return 2.0 * texture2D(_tex, _uv).rg - 1.0;
      }

      float sampleNoiseTexture(vec2 _uv) {
        return texture2D(texWavePerturbation, _uv).b;
      }

      vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
        return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
      }

      float computeProgress(vec2 uv, float time) {
        return fract(time);
      }

      float computeWeight(vec2 uv, float time) {
        float progress = computeProgress(uv, time);
        return 1.0 - abs(1.0 - 2.0 * progress);
      }

      vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
        float flowStrength = waveParams[2];
        float flowOffset = waveParams[3];

        vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;

        float progress = computeProgress(uv, time + phaseOffset);
        float weight = computeWeight(uv, time + phaseOffset);

        vec2 result = uv;
        result -= flowVector * (progress + flowOffset);
        result += phaseOffset;
        result += (time - progress) * FLOW_JUMP;

        return vec3(result, weight);
      }

      const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
      const float TIME_NOISE_STRENGTH = 7.77;

      vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
        float waveStrength = waveParams[0];

        // overall directional shift in uv's for directional wave movement for
        // now we do a hard coded scale for wave speed such that a unit length
        // direction is not too fast.
        vec2 waveMovement = time * -_waveDir;

        float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;

        // compute two perturbed uvs and blend weights
        // then sample the wave normals at the two positions and blend
        vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
        vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);

        vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
        vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;

        // logic to flatten the wave pattern
        // scale xy components of the normal, then adjust z (up) component
        vec3 mixNormal = normalize(normal_A + normal_B);
        mixNormal.xy *= waveStrength;
        mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));

        return mixNormal;
      }

      vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
        float waveTextureRepeat = waveParams[1];
        vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
        float foam  = normals2FoamIntensity(normal, waveParams[0]);
        return vec4(normal, foam);
      }
    `)}(function(l){l.bindUniforms=function(h,d){h.setUniform1i("texWaveNormal",0);h.setUniform1i("texWavePerturbation",1);h.setUniform4f("waveParams",d.waveStrength,d.waveTextureRepeat,d.flowStrength,d.flowOffset);h.setUniform2f("waveDirection",d.waveDirection[0]*d.waveVelocity,d.waveDirection[1]*d.waveVelocity)}})(r||(r={}));b.WaterDistortion=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(b,k){b.FoamColor=function(a){a.fragment.code.add(k.glsl`
    vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
      return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
    }
  `)};b.FoamIntensity=function(a){a.fragment.code.add(k.glsl`
    float normals2FoamIntensity(vec3 n, float waveStrength){
      float normalizationFactor =  max(0.015, waveStrength);
      return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){function w(m){const u=new r.ShaderBuilder;u.include(a.Transform,{linearDepth:!1});u.attributes.add("position","vec3");u.attributes.add("uv0","vec2");u.vertex.uniforms.add("proj","mat4").add("view","mat4").add("localOrigin","vec3");u.vertex.uniforms.add("waterColor","vec4");if(0===m.output||7===m.output)u.include(p.NormalUtils,m),u.include(g.ForwardLinearDepth,m),u.varyings.add("vuv","vec2"),u.varyings.add("vpos","vec3"),u.varyings.add("vnormal","vec3"),u.varyings.add("vtbnMatrix",
"mat3"),u.vertex.code.add(k.glsl`
      void main(void) {
        if (waterColor.a < ${k.glsl.float(c.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        gl_Position = transformPosition(proj, view, vpos);
        ${0===m.output?"forwardLinearDepth();":""}
      }
    `);7===m.output&&(u.include(h.Slice,m),u.fragment.uniforms.add("waterColor","vec4"),u.fragment.code.add(k.glsl`
        void main() {
          discardBySlice(vpos);

          gl_FragColor = vec4(waterColor.a);
        }
      `));0===m.output&&(u.include(f.WaterDistortion,m),u.include(h.Slice,m),m.receiveShadows&&u.include(e.ReadShadowMap,m),u.include(n.Water,m),u.fragment.uniforms.add("waterColor","vec4").add("lightingMainDirection","vec3").add("lightingMainIntensity","vec3").add("camPos","vec3").add("timeElapsed","float").add("view","mat4"),u.fragment.include(l.ColorConversion),u.fragment.code.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - camPos);
        vec3 l = normalize(-lightingMainDirection);
        float shadow = ${m.receiveShadows?k.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, l, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${m.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));2===m.output&&(u.include(p.NormalUtils,m),u.include(f.WaterDistortion,m),u.include(h.Slice,m),u.varyings.add("vpos","vec3"),u.varyings.add("vuv","vec2"),u.vertex.code.add(k.glsl`
        void main(void) {
          if (waterColor.a < ${k.glsl.float(c.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),u.fragment.uniforms.add("timeElapsed","float"),u.fragment.code.add(k.glsl`
        void main() {
          discardBySlice(vpos);

          // the created normal is in tangent space and foam
          vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
          tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);

          gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
        }
    `));5===m.output&&(u.varyings.add("vpos","vec3"),u.vertex.code.add(k.glsl`
        void main(void) {
          if (waterColor.a < ${k.glsl.float(c.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),u.fragment.uniforms.add("waterColor","vec4"),u.fragment.code.add(k.glsl`
        void main() {
          gl_FragColor = waterColor;
        }
    `));4===m.output&&(u.include(d.OutputHighlight),u.varyings.add("vpos","vec3"),u.vertex.code.add(k.glsl`
      void main(void) {
        if (waterColor.a < ${k.glsl.float(c.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),u.include(h.Slice,m),u.fragment.code.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        outputHighlight();
      }
    `));return u}var q=Object.freeze({__proto__:null,build:w});b.WaterSurface=q;b.build=w})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","../shaderModules/interfaces"],function(b,k){b.ForwardLinearDepth=function(a,r){0===r.output&&r.receiveShadows?(a.varyings.add("linearDepth","float"),a.vertex.code.add(k.glsl`
      void forwardLinearDepth() { linearDepth = gl_Position.w; }
    `)):1===r.output||3===r.output?(a.varyings.add("linearDepth","float"),a.vertex.uniforms.add("uCameraNearFar","vec2"),a.vertex.code.add(k.glsl`
      void forwardLinearDepth() {
        linearDepth = (-position_view().z - uCameraNearFar[0]) / (uCameraNearFar[1] - uCameraNearFar[0]);
      }
    `)):a.vertex.code.add(k.glsl`
      void forwardLinearDepth() {}
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.NormalUtils=function(a,r){1===r.viewingMode?a.vertex.code.add(k.glsl`
      vec3 getLocalUp(in vec3 pos, in vec3 origin) {
          return normalize(pos + origin);
      }
    `):a.vertex.code.add(k.glsl`
      vec3 getLocalUp(in vec3 pos, in vec3 origin) {
          return vec3(0.0, 0.0, 1.0); // WARNING: up-axis dependent code
      }
    `);1===r.viewingMode?a.vertex.code.add(k.glsl`
        mat3 getTBNMatrix(in vec3 n) {
            vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
            vec3 b = normalize(cross(n, t));
            return mat3(t, b, n);
        }
    `):a.vertex.code.add(k.glsl`
        mat3 getTBNMatrix(in vec3 n) {
            vec3 t = vec3(1.0, 0.0, 0.0);
            vec3 b = normalize(cross(n, t));
            return mat3(t, b, n);
        }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ../../shaderModules/interfaces ./ScreenSpaceReflections.glsl ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl".split(" "),function(b,k,a,r,l,h){b.Water=function(d,c){d.include(h.PhysicallyBasedRendering,c);d.include(l.Gamma);d.include(r.FoamColor);c.ssrEnabled&&d.include(a.ScreenSpaceReflections,c);d.fragment.code.add(k.glsl`
    const vec3 fresnelSky =  vec3(0.02, 1.0, 15.0); // f0, f0max, exp
    const vec2 fresnelMaterial =  vec2(0.02, 0.1); // f0, f0max for specular term
    const float roughness = 0.015;
    const float foamIntensityExternal = 1.7;
    const float ssrIntensity = 0.65;
    const float ssrHeightFadeStart = 300000.0;
    const float ssrHeightFadeEnd = 500000.0;
    const float waterDiffusion = 0.775;
    const float waterSeeColorMod = 0.8;
    const float correctionViewingPowerFactor = 0.4;

    const vec3 skyZenitColor = vec3(0.52, 0.68, 0.90);
    const vec3 skyColor = vec3(0.67, 0.79, 0.9);

    PBRShadingWater shadingInfo;

    /*
    *   This function is an approximation for the sky gradient reflected
    *   the water surface and describes a combination of two fresnel terms.
    *   @parameter: cosTheta = is the result of max(dot(n,v), 0.0)
    *   @parameter: horizon = the dominant color of the sky horizon
    *   @parameter: cosTheta = the dominant color of the sky zenit
    */
    vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
      float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
      return mix(zenit, horizon, exponent);
    }

    /*
    *   This function determines the water color per pixel.
    *   @parameter: n = normal facing away from the surface
    *   @parameter: v = view direction facing away from the surface.
    *   @parameter: l = light direction facing away from the surface
    *   @parameter: lightIntensity = light intensity, currently between 0...PI
    *   @parameter: localUp = a normal for the general direction of the surface
    *   @parameter: shadow = the amount of shadow at this pixel (0 = no shadow)
    */
    vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 positionView) {

      float reflectionHit = 0.;
      vec3 seaWaterColor = linearizeGamma(color);
      // using half vector to determine the specular light
      vec3 h = normalize(l + v);
      shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
      shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
      shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
      shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
      shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
      shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);

      // angle between vertex normal and view direction
      float upDotV = max(dot(localUp,v), 0.0);
      // reflected sky color: the reflected sky color consists of two main colors, the
      // reflected color at the horizon and the reflected color of the zenit.
      // the reflected sky color is then an approximation based on the fresnel term.
      vec3 skyHorizon = linearizeGamma(skyColor);
      vec3 skyZenit = linearizeGamma(skyZenitColor);
      vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );

      // we use the upDotL to smoothen out the
      // reflected color of the water
      float upDotL = max(dot(localUp,l),0.0);

      // The approximated sky color is adjusted according to the sun position.
      // This is done as approximation for e.g. night views.
      float daytimeMod = 0.1 + upDotL * 0.9;
      skyColor *= daytimeMod;

      // If a water surface is in shadow we just use a slight darkening of the
      // water surface expressed with this shadowModifier.
      float shadowModifier = clamp(shadow, 0.8, 1.0);

      // The reflected sky color consists of the fresnel reflection multiplied with the approximated sky color.
      // The shadow is influencing the frensel term to keep the shadow impression for really near views. As long
      // as reflection are absent there is a need to have a slight shadow for depth perception.
      vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
      vec3 reflSky = fresnelModifier * skyColor * shadowModifier;

      // The reflected sea color is the input water color combined with the reflected sky color.
      // The reflected sky color is modified by the incoming light.
      vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;

      vec3 specular = vec3(0.0);
      // This prevents the specular light to be rendered when:
      // - sun is behind a polygon (e.g. sundown for elevated polygons where nDotL might be still ok)
      // - viewer is under water (for this localUp is better than n)
      if(upDotV > 0.0 && upDotL > 0.0) {
        // calculate the cook torrance BRDF but with simplified occlusion
        vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);

        // Normalize light intensity to be between 0...1. Shadow cancels out specular light here
        vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;

        specular = shadingInfo.NdotL * incidentLight * specularSun;
      }

      vec3 foam = vec3(0.0);
      if(upDotV > 0.0) {
        foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
      }
      `);c.ssrEnabled?d.fragment.code.add(k.glsl`
      // Convert the world position to view position
      vec4 viewPosition = vec4(positionView.xyz, 1.0);
      vec3 viewDir = normalize(viewPosition.xyz);
      vec4 viewNormalVectorCoordinate = ssrViewMat *vec4(n, 0.0);
      vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
      vec4 viewUp = ssrViewMat *vec4(localUp, 0.0);

      // at steeper viewing angles we use more of a vertex normal (in this case up) then the wave normal
      // this removes some artifacts of normal mapping
      float correctionViewingFactor = pow(max(dot(-viewDir, viewUp.xyz), 0.0), correctionViewingPowerFactor);
      vec3 viewNormalCorrected = mix(viewUp.xyz, viewNormal, correctionViewingFactor);

      vec3 reflected = normalize(reflect(viewDir, viewNormalCorrected));

      // perform screen space reflection to detect hit
      vec3 hitCoordinate = screenSpaceIntersection( normalize(reflected), viewPosition.xyz, viewDir, viewUp.xyz);
      vec3 reflectedColor = vec3(0.0);

      // if there is a hit with ssr find reflected color from the reprojeted frame
      if (hitCoordinate.z > 0.0)
      {
        vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);

        // fade out if there if the hit is near end of Y axis
        vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
        float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -positionView.z);
        reflectionHit = waterDiffusion * clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;

        reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHit * fresnelModifier.y * ssrIntensity;
      }
      float seeColorMod =  mix(waterSeeColorMod, waterSeeColorMod*0.5, reflectionHit);
      // combining reflected sky, reflected sea, specular highlight and SSR reflections.
      return tonemapACES((1. - reflectionHit) * reflSky + reflectedColor + reflSea * seeColorMod + specular + foam);
    }
  `):d.fragment.code.add(k.glsl`
      // combining reflected sky, reflected sea, specular highlight and SSR reflections.
      return tonemapACES(reflSky + reflSea * waterSeeColorMod + specular + foam);
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.Gamma=function(a){a.fragment.code.add(k.glsl`
    const float GAMMA = 2.2;
    const float INV_GAMMA = 0.4545454545;

    vec4 delinearizeGamma(vec4 color) {
      return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
    }

    vec3 linearizeGamma(vec3 color) {
      return pow(color, vec3(GAMMA));
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","../../shaderModules/interfaces","./PiUtils.glsl","./AnalyticalSkyModel.glsl"],function(b,k,a,r){b.PhysicallyBasedRendering=function(l,h){const d=l.fragment.code;l.include(a.PiUtils);if(3===h.pbrMode||4===h.pbrMode)d.add(k.glsl`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${h.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),d.add(k.glsl`
    vec3 fresnelReflection(float angle, vec3 f0, float f90) {
      return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
    }
    `),d.add(k.glsl`
    float normalDistributionWater(float NdotH, float roughness)
    {
      float r2 = roughness * roughness;
      float NdotH2 = NdotH * NdotH;
      float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
      return r2 / denom;
    }
    `),d.add(k.glsl`
    float geometricOcclusionKelemen(float LoH)
    {
        return 0.25 / (LoH * LoH);
    }
    `),d.add(k.glsl`
    vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
    {
      vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
      float dSun = normalDistributionWater(props.NdotH, roughness);
      float V = geometricOcclusionKelemen(props.LdotH);

      float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
      float strengthSunHaze  = 1.2;
      float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;

      return ((dSun + dSunHaze) * V) * F;
    }

    vec3 tonemapACES(const vec3 x) {
      return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
    }
    `);else if(1===h.pbrMode||2===h.pbrMode)l.include(r.AnalyticalSkyModel),d.add(k.glsl`
    struct PBRShadingInfo
    {
        float NdotL;                  // cos angle between normal and light direction
        float NdotV;                  // cos angle between normal and view direction
        float NdotH;                  // cos angle between normal and half vector
        float VdotH;                  // cos angle between view direction and half vector
        float LdotH;                  // cos angle between view light direction and half vector
        float NdotNG;                 // cos angle between normal and normal of the ground
        float RdotNG;                 // cos angle between view direction reflected of the normal and normal of the ground
        float NdotAmbDir;             // cos angle between view direction and the fill light in ambient illumination
        float NdotH_Horizon;          // cos angle between normal and half vector defined with horizon illumination
        vec3 skyRadianceToSurface;         // integrated radiance of the sky based on the surface roughness (used for specular reflection)
        vec3 groundRadianceToSurface;      // integrated radiance of the ground based on the surface roughness (used for specular reflection)
        vec3 skyIrradianceToSurface;       // irradiance of the sky (used for diffuse reflection)
        vec3 groundIrradianceToSurface;    // irradiance of the ground (used for diffuse reflection)

        float averageAmbientRadiance;      // average ambient radiance used to deduce black level in gamut mapping
        float ssao;                   // ssao coefficient
        vec3 albedoLinear;            // linear color of the albedo
        vec3 f0;                      // fresnel value at normal incident light
        vec3 f90;                     // fresnel value at 90o of incident light

        vec3 diffuseColor;            // diffuse color of the material used in environment illumination
        float metalness;              // metalness of the material
        float roughness;              // roughness of the material
    };
    `),d.add(k.glsl`
    float normalDistribution(float NdotH, float roughness)
    {
        float a = NdotH * roughness;
        float b = roughness / (1.0 - NdotH * NdotH + a * a);
        return b * b * INV_PI;
    }
    `),d.add(k.glsl`
    const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
    const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
    const vec2 c2 = vec2(-1.04, 1.04);

    vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
        vec4 r = roughness * c0 + c1;
        float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
        return c2 * a004 + r.zw;
    }
    `),d.add(k.glsl`
    vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
      vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
      vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);

      // From diffuse illumination calculate reflected color
      vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;

      // From specular illumination calculate reflected color
      vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
      vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
      vec3 specularComponent = specularColor * indirectSpecular;

      return (diffuseComponent + specularComponent);
    }
    `),d.add(k.glsl`
    float gamutMapChanel(float x, vec2 p){
      return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
    }`),d.add(k.glsl`
    vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
      vec3 outColor;
      vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
      outColor.x = gamutMapChanel(inColor.x, p) ;
      outColor.y = gamutMapChanel(inColor.y, p) ;
      outColor.z = gamutMapChanel(inColor.z, p) ;
      return outColor;
    }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.AnalyticalSkyModel=function(a){a=a.fragment.code;a.add(k.glsl`
    vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
    {
      return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
    }
    `);a.add(k.glsl`
    float integratedRadiance(float cosTheta2, float roughness)
    {
      return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
    }
    `);a.add(k.glsl`
    vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
    {
      float cosTheta2 = 1.0 - RdotNG * RdotNG;
      float intRadTheta = integratedRadiance(cosTheta2, roughness);

      // Calculate the integrated directional radiance of the ground and the sky
      float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
      float sky = 2.0 - ground;
      return (ground * ambientGround + sky * ambientSky) * 0.5;
    }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","../../../../../chunks/mat4","../../../../../chunks/mat4f64"],function(b,k,a){b.Instance=function(r,l,h,d,c,e){this.from=r;this.to=l;this.isVisible=h;this.hasHighlights=d;this.hasOccludees=c;this.transformation=e;null!=e&&(this.transformationNormal=a.clone(e),k.invert(this.transformationNormal,this.transformationNormal),k.transpose(this.transformationNormal,
this.transformationNormal))};b.addOrMerge=function(r,l){if(0===r.length)r.push({first:l.from,count:l.to-l.from});else{var h=r[r.length-1];var d=h.first+h.count>=l.from?!0:!1;d?h.count=l.from-h.first+l.to-l.from:r.push({first:l.from,count:l.to-l.from})}};b.sortInstancesAccordingToRange=function(r){return r.sort((l,h)=>l.from===h.from?l.to>h.to?1:l.to<h.to?-1:0:l.from>h.from?1:l.from<h.from?-1:0)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/accessorSupport/utils ../../../../core/PerformanceSampler ../../../webgl/Measurement".split(" "),
function(b,k,a,r,l,h){const d="prepare;shadowmap;lineardepth;normals;ssao;opaque;opaque edges;transparent;transparent edges;hudvisibility;transparent terrain;atmosphere;laserline;occluded;antialiasing;highlights;hudOccluded;hudNotoccluded".split(";");let c=function(){function g(){this.drawCalls=this.triangles=0}g.prototype.reset=function(){this.drawCalls=this.triangles=0};return g}(),e=function(g){function p(){var n=g.call(this,"total")||this;n.total=0;n.frameCount=0;return n}k._inheritsLoose(p,g);
return p}(l),f=function(){function g(){this._enableGPUTimer=this._lastSample=this._startTime=0;this.totalTime=new e;this.gpuTime=new l("gpu",9);this.renderPassTimings=d.map(n=>new l(n));this.stats=new c}var p=g.prototype;p.enableGPUTimer=function(){++this._enableGPUTimer;return{remove:r.once(()=>--this._enableGPUTimer)}};p.prerender=function(n){this._startTime=this._lastSample=performance.now();this._enableGPUTimer&&(this._gpuTimer=h.startMeasurement(n))};p.advance=function(n){const w=performance.now();
this.renderPassTimings[n].record(w-this._lastSample);this._lastSample=w};p.postrender=function(){a.isSome(this._gpuTimer)&&(this._gpuTimer.stop(w=>a.isSome(w)&&this.gpuTime.record(w),16),this._gpuTimer=null);const n=performance.now()-this._startTime;this.totalTime.record(n);this.totalTime.total+=n;this.totalTime.frameCount++};return g}();b.RenderStats=c;b.RenderTime=e;b.RendererPerformanceInfo=f;b.addToRenderStats=function(g,p,n){a.isSome(n)&&(n.drawCalls+=g,n.triangles+=p)};b.performanceStatsCategories=
d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/webgl/Measurement":function(){define(["exports","../../core/maybe"],function(b,k){let a=function(){function h(c){this.timer=c;this.start=c.createQuery();c.createTimestamp(this.start)}var d=h.prototype;d.stop=function(c,e=50){this.end=this.timer.createQuery();this.timer.createTimestamp(this.end);this.checkQueryResult(c,e)};d.checkQueryResult=function(c,e){if(this.timer.resultAvailable(this.end))if(this.timer.disjoint())c(null);else{var f=
this.timer.getResult(this.start),g=this.timer.getResult(this.end);c((g-f)/1E6)}else setTimeout(()=>this.checkQueryResult(c,e),e)};return h}(),r=function(){function h(c){this.timer=c;this.query=c.createQuery();l=!0;this.timer.beginTimeElapsed(this.query)}var d=h.prototype;d.stop=function(c,e=50){this.timer.endTimeElapsed();l=!1;this.checkQueryResult(c,e)};d.checkQueryResult=function(c,e){var f=this.timer.resultAvailable(this.query);const g=this.timer.disjoint();f&&!g?(f=this.timer.getResult(this.query),
c(f/1E6)):g?c(null):setTimeout(()=>this.checkQueryResult(c,e),e)};return h}(),l=!1;b.startMeasurement=function(h){h=h.capabilities.disjointTimerQuery;return k.isNone(h)?null:0<h.timestampBits()?new a(h):l?null:new r(h)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../../../../chunks/TextureOnly.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){h=function(p){function n(){return p.apply(this,arguments)||this}a._inheritsLoose(n,p);var w=n.prototype;w.initializeProgram=function(q){const m=n.shader.get().build();return new e(q.rctx,m.generateSource("vertex"),m.generateSource("fragment"),c.Default3D)};w.initializePipeline=function(){return this.configuration.hasAlpha?f.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),colorWrite:f.defaultColorWriteParams}):f.makePipelineState({colorWrite:f.defaultColorWriteParams})};
return n}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(g.TextureOnlyShader,()=>new Promise(function(p,n){b(["../core/shaderLibrary/util/TextureOnly.glsl"],p,n)}));l=function(p){function n(){var w=p.apply(this,arguments)||this;w.hasAlpha=!1;return w}a._inheritsLoose(n,p);return n}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter()],l.prototype,"hasAlpha",void 0);k.TextureTechnique=h;k.TextureTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/TextureOnly.glsl":function(){define(["exports",
"../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass"],function(b,k,a,r){function l(){const d=new a.ShaderBuilder;d.include(r.ScreenSpacePass);d.fragment.uniforms.add("tex","sampler2D");d.fragment.uniforms.add("color","vec4");d.fragment.code.add(k.glsl`
    void main() {
      vec4 texColor = texture2D(tex, uv);
      gl_FragColor = texColor * color;
    }
  `);return d}var h=Object.freeze({__proto__:null,build:l});b.TextureOnlyShader=h;b.build=l})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["exports","../shaderModules/interfaces"],function(b,k){b.ScreenSpacePass=function(a){a.attributes.add("position","vec2");a.varyings.add("uv","vec2");a.vertex.code.add(k.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = position * 0.5 + vec2(0.5);
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64","../../../../chunks/vec3","./SphericalHarmonics"],function(b,k,a,r,l){const h=a.create();let d=function(){function c(){this._renderLighting={main:{intensity:a.create(),direction:a.fromValues(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldSunlight=
{direction:a.create(),ambient:{color:a.create(),intensity:0},diffuse:{color:a.create(),intensity:0}}}var e=c.prototype;e.setLightDirectionUniform=function(f){f.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction)};e.setUniforms=function(f,g=!1){g?f.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):f.setUniform1f("lightingFixedFactor",0);f.setUniform1f("lightingGlobalFactor",this._info.globalFactor);this.setLightDirectionUniform(f);
f.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);f.setUniform1f("ambientBoostFactor",.4);g=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?f.setUniform3f("lightingAmbientSH0",g.r[0],g.g[0],g.b[0]):1===this._shOrder?(f.setUniform4f("lightingAmbientSH_R",g.r[0],g.r[1],g.r[2],g.r[3]),f.setUniform4f("lightingAmbientSH_G",g.g[0],g.g[1],g.g[2],g.g[3]),f.setUniform4f("lightingAmbientSH_B",g.b[0],g.b[1],g.b[2],g.b[3])):2===this._shOrder&&(f.setUniform3f("lightingAmbientSH0",
g.r[0],g.g[0],g.b[0]),f.setUniform4f("lightingAmbientSH_R1",g.r[1],g.r[2],g.r[3],g.r[4]),f.setUniform4f("lightingAmbientSH_G1",g.g[1],g.g[2],g.g[3],g.g[4]),f.setUniform4f("lightingAmbientSH_B1",g.b[1],g.b[2],g.b[3],g.b[4]),f.setUniform4f("lightingAmbientSH_R2",g.r[5],g.r[6],g.r[7],g.r[8]),f.setUniform4f("lightingAmbientSH_G2",g.g[5],g.g[6],g.g[7],g.g[8]),f.setUniform4f("lightingAmbientSH_B2",g.b[5],g.b[6],g.b[7],g.b[8]))};e.set=function(f){this._info=f;l.combineLights(f.lights,this._shOrder,this._renderLighting);
r.negate(this._oldSunlight.direction,this._renderLighting.main.direction);f=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*f;this._oldSunlight.ambient.color[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*f;this._oldSunlight.ambient.color[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*f;this._oldSunlight.ambient.intensity=1;this._oldSunlight.diffuse.color[0]=this._renderLighting.main.intensity[0]*f;this._oldSunlight.diffuse.color[1]=
this._renderLighting.main.intensity[1]*f;this._oldSunlight.diffuse.color[2]=this._renderLighting.main.intensity[2]*f;this._oldSunlight.diffuse.intensity=1;f=r.copy(h,this._oldSunlight.diffuse.color);r.scale(f,f,.4*this._info.globalFactor);r.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,f)};k._createClass(c,[{key:"globalFactor",get:function(){return this._info.globalFactor}},{key:"old",get:function(){return this._oldSunlight}}]);return c}();b.SceneLighting=d;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ./Lightsources ../lib/LongVectorMath".split(" "),function(b,k,a,r,l,h){function d(B){return(B+1)*(B+1)}function c(B){return k.clamp(Math.floor(Math.sqrt(B)-1),0,2)}function e(B,x,C){const z=B[0],A=B[1];B=B[2];C=C||[];C.length=d(x);0<=x&&(C[0]=.28209479177);1<=x&&(C[1]=.4886025119*z,C[2]=.4886025119*B,C[3]=.4886025119*
A);2<=x&&(C[4]=1.09254843059*z*A,C[5]=1.09254843059*A*B,C[6]=.31539156525*(3*B*B-1),C[7]=1.09254843059*z*B,C[8]=.54627421529*(z*z-A*A));return C}function f(B,x){B=d(B);x=x||{r:[],g:[],b:[]};x.r.length=x.g.length=x.b.length=B;for(let C=0;C<B;C++)x.r[C]=x.g[C]=x.b[C]=0;return x}function g(B,x){const C=c(x.r.length);for(const z of B)r.negate(v,z.direction),e(v,C,m),h.elementwiseProduct(m,y),h.scalarProduct(m,z.intensity[0],u),h.add(x.r,u),h.scalarProduct(m,z.intensity[1],u),h.add(x.g,u),h.scalarProduct(m,
z.intensity[2],u),h.add(x.b,u);return x}function p(B,x){e(v,0,m);for(const C of B)x.r[0]+=m[0]*y[0]*C.intensity[0]*4*Math.PI,x.g[0]+=m[0]*y[0]*C.intensity[1]*4*Math.PI,x.b[0]+=m[0]*y[0]*C.intensity[2]*4*Math.PI;return x}const n=[],w=[],q=[],m=[0],u=[0],v=a.create(),y=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];b.combineLights=function(B,x,C){f(x,C.sphericalHarmonics.sh);r.set(C.main.intensity,0,0,0);x=!1;n.length=0;w.length=0;q.length=0;for(const z of B)z instanceof
l.MainLight&&!x?(r.copy(C.main.direction,z.direction),C.main.intensity[0]=z.intensity[0],C.main.intensity[1]=z.intensity[1],C.main.intensity[2]=z.intensity[2],C.main.castShadows=z.castShadows,x=!0):z instanceof l.MainLight||z instanceof l.FillLight?n.push(z):z instanceof l.AmbientLight?w.push(z):z instanceof l.SphericalHarmonicsLight&&q.push(z);g(n,C.sphericalHarmonics.sh);p(w,C.sphericalHarmonics.sh);for(const z of q)h.add(C.sphericalHarmonics.sh.r,z.sh.r),h.add(C.sphericalHarmonics.sh.g,z.sh.g),
h.add(C.sphericalHarmonics.sh.b,z.sh.b)};b.computeCoefficients=e;b.initSHCoefficients=f;b.numberOfCoefficients=d;b.numberOfCoefficientsInBand=function(B){return 2*B+1};b.orderFromNumberOfCoefficients=c;b.projectAmbientLights=p;b.projectFillLights=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(b){b.add=function(k,a,r){r=r||k;r.length=k.length;for(let l=0;l<k.length;l++)r[l]=k[l]+a[l];return r};b.dotProduct=
function(k,a){let r=0;for(let l=0;l<k.length;l++)r+=k[l]*a[l];return r};b.elementwiseProduct=function(k,a,r){r=r||k;r.length=k.length;for(let l=0;l<k.length;l++)r[l]=k[l]*a[l];return r};b.scalarProduct=function(k,a,r){r=r||k;r.length=k.length;for(let l=0;l<k.length;l++)r[l]=k[l]*a;return r};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define("exports ../../../../core/maybe ../../../webgl/Program ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){a=function(){function p(){this.cache=new Map}var n=p.prototype;n.dispose=function(){this.cache.forEach(w=>{k.isSome(w.texture)&&(w.texture.dispose(),w.texture=null)});this.cache.clear()};n.acquire=function(w){if(k.isNone(w))return null;const q=this.patternId(w),m=this.cache.get(q);if(m)return m.refCount++,m.bind;const u=this.patternToTextureData(w,2),v=u.length/2,y={refCount:1,texture:null,bind:(B,x)=>{k.isNone(y.texture)&&(y.texture=new l(B,{width:u.length,height:1,
internalFormat:6406,pixelFormat:6406,dataType:5121,wrapMode:33071},u));B.bindTexture(y.texture,x);return v}};this.cache.set(q,y);return y.bind};n.release=function(w){if(!k.isNone(w)){w=this.patternId(w);var q=this.cache.get(w);q&&(q.refCount--,0===q.refCount&&(k.isSome(q.texture)&&q.texture.dispose(),this.cache.delete(w)))}};n.swap=function(w,q){q=this.acquire(q);this.release(w);return q};n.patternId=function(w){return w.join(",")};n.patternToTextureData=function(w,q){var m=w.reduce((y,B)=>y+B)*q;
m=new Uint8Array(m);let u=!0,v=0;for(const y of w){for(w=0;w<y*q;w++)m[v++]=u?255:0;u=!u}return m};return p}();b.StippleTextureRepository=a;b.createStipplePattern=function(p){return k.isNone(p)?p:p.slice()};b.createStipplePatternSimple=function(p){return[p,p]};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat3f64 ../../support/buffer/InterleavedLayout ../lib/intersectorUtils ../lib/GLMaterialTexture ./internal/MaterialUtil ../lib/Material ./internal/bufferWriterUtils ../core/shaderLibrary/util/AlphaDiscard.glsl ../lib/OrderIndependentTransparency ../shaders/DefaultMaterialTechnique ../shaders/RealisticTreeTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){let m=function(E){function G(I,J){J=E.call(this,J,I,v)||this;J.supportsEdges=!0;J.techniqueConfig=new w.DefaultMaterialTechniqueConfiguration;J.vertexBufferLayout=G.getVertexBufferLayout(J.params);J.instanceBufferLayout=I.instanced?G.getInstanceBufferLayout(J.params):null;return J}k._inheritsLoose(G,E);var H=G.prototype;H.isVisibleInPass=function(I){return 4===I?this.params.castShadows:!0};H.isVisible=function(){var I=this.params;if(!E.prototype.isVisible.call(this)||
0===I.layerOpacity)return!1;var J=I.instanced;const K=I.vertexColors,L=I.symbolColors;J=!!J&&-1<J.indexOf("color");const S=I.vvColorEnabled,M="replace"===I.colorMixMode,T=0<I.opacity;I=I.externalColor&&0<I.externalColor[3];return K&&(J||S||L)?M?!0:T:K?M?I:T:J||S||L?M?!0:T:M?I:T};H.getTechniqueConfig=function(I,J){this.techniqueConfig.output=I;this.techniqueConfig.hasNormalTexture=!!this.params.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.params.textureId;this.techniqueConfig.vertexTangents=
this.params.vertexTangents;this.techniqueConfig.instanced=!!this.params.instanced;this.techniqueConfig.instancedDoublePrecision=this.params.instancedDoublePrecision;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.verticalOffset=null!==this.params.verticalOffset;this.techniqueConfig.screenSizePerspective=null!==this.params.screenSizePerspective;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.sliceHighlightDisabled=this.params.sliceHighlightDisabled;
this.techniqueConfig.alphaDiscardMode=this.params.textureAlphaMode;this.techniqueConfig.normalsTypeDerivate="screenDerivative"===this.params.normals?!0:!1;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;this.techniqueConfig.cullFace=null!=this.params.cullFace?this.params.cullFace:0;if(0===I||7===I)this.techniqueConfig.vertexColors=this.params.vertexColors,this.techniqueConfig.symbolColors=
this.params.symbolColors,this.techniqueConfig.doubleSidedMode=this.params.treeRendering?2:this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.instancedColor=!!this.params.instanced&&-1<this.params.instanced.indexOf("color"),this.techniqueConfig.receiveShadows=this.params.receiveShadows&&this.params.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=this.params.receiveSSAO,this.techniqueConfig.vvColor=
this.params.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.params.textureAlphaPremultiplied,this.techniqueConfig.usePBR=this.params.usePBR,this.techniqueConfig.hasMetalnessAndRoughnessTexture=!!this.params.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.params.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.params.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.params.transparent||!this.params.offsetTransparentBackfaces),
this.techniqueConfig.isSchematic=this.params.usePBR&&this.params.isSchematic,this.techniqueConfig.transparencyPassType=J?J.transparencyPassType:3,this.techniqueConfig.enableOffset=J?J.camera.relativeElevation<n.OITPolygonOffsetLimit:!0;return this.techniqueConfig};H.intersect=function(I,J,K,L,S,M,T){if(null!==this.params.verticalOffset){const Q=L.camera;r.set(t,K[12],K[13],K[14]);K=null;switch(L.viewingMode){case 1:K=r.normalize(z,t);break;case 2:K=r.copy(z,C)}let F=0;if(null!==this.params.verticalOffset){var O=
r.subtract(D,t,Q.eye);const N=r.length(O);O=r.scale(O,O,1/N);let P=null;this.params.screenSizePerspective&&(P=r.dot(K,O));F+=e.verticalOffsetAtDistance(Q,N,this.params.verticalOffset,P,this.params.screenSizePerspective)}r.scale(K,K,F);r.transformMat3(A,K,L.transform.inverseRotation);S=r.subtract(B,S,A);M=r.subtract(x,M,A)}e.intersectTriangleGeometry(I,J,L,S,M,d.getVerticalOffsetObject3D(L.verticalOffset),T)};H.getGLMaterial=function(I){if(0===I.output||7===I.output||1===I.output||2===I.output||3===
I.output||4===I.output)return new u(I)};H.createBufferWriter=function(){return new y(this.vertexBufferLayout,this.instanceBufferLayout)};G.getVertexBufferLayout=function(I){const J=I.textureId||I.normalTextureId||I.metallicRoughnessTextureId||I.emissiveTextureId||I.occlusionTextureId,K=h.newLayout().vec3f("position").vec3f("normal");I.vertexTangents&&K.vec4f("tangent");J&&K.vec2f("uv0");I.vertexColors&&K.vec4u8("color");I.symbolColors&&K.vec4u8("symbolColor");return K};G.getInstanceBufferLayout=function(I){let J=
h.newLayout();J=I.instancedDoublePrecision?J.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):J.mat4f("model").mat4f("modelNormal");I.instanced&&-1<I.instanced.indexOf("color")&&(J=J.vec4f("instanceColor"));I.instanced&&-1<I.instanced.indexOf("featureAttribute")&&(J=J.vec4f("instanceFeatureAttribute"));return J};return G}(f.Material),u=function(E){function G(I){I=E.call(this,{...I,...I.material.params})||this;I.updateParameters();return I}k._inheritsLoose(G,E);var H=
G.prototype;H.updateParameters=function(I){const J=this.material.params;this.updateTexture(J.textureId);this.technique=J.treeRendering?this.techniqueRep.acquireAndReleaseExisting(q.RealisticTreeTechnique,this.material.getTechniqueConfig(this.output,I),this.technique):this.techniqueRep.acquireAndReleaseExisting(w.DefaultMaterialTechnique,this.material.getTechniqueConfig(this.output,I),this.technique)};H.selectPipelines=function(){};H._updateShadowState=function(I){I.shadowMappingEnabled!==this.material.params.shadowMappingEnabled&&
this.material.setParameterValues({shadowMappingEnabled:I.shadowMappingEnabled})};H._updateOccludeeState=function(I){I.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:I.hasOccludees})};H.ensureParameters=function(I){if(0===this.output||7===this.output)this._updateShadowState(I),this._updateOccludeeState(I);this.updateParameters(I)};H.bind=function(I,J){I.bindProgram(this.technique.program);this.technique.bindPass(I,this.material.params,J);this.bindTexture(I,
this.technique.program)};H.beginSlot=function(I){return I===(this.material.params.transparent?this.material.params.writeDepth?5:8:3)};H.getPipelineState=function(I,J){return this.technique.getPipelineState(J)};return G}(c);const v={textureId:void 0,initTextureTransparent:!1,isSchematic:!1,usePBR:!1,normalTextureId:void 0,vertexTangents:!1,occlusionTextureId:void 0,emissiveTextureId:void 0,metallicRoughnessTextureId:void 0,emissiveFactor:[0,0,0],mrrFactors:[0,1,.5],ambient:[.2,.2,.2],diffuse:[.8,.8,
.8],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,vertexColors:!1,symbolColors:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,normals:"default",receiveSSAO:!0,receiveShadows:!0,castShadows:!0,shadowMappingEnabled:!1,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,sliceHighlightDisabled:!1,offsetTransparentBackfaces:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,
0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotationMatrix:l.create(),transparent:!1,writeDepth:!0,textureAlphaMode:0,textureAlphaCutoff:p.defaultMaskAlphaCutoff,textureAlphaPremultiplied:!1,sceneHasOcludees:!1,...f.materialParametersDefaults};let y=function(){function E(H,I){this.vertexBufferLayout=H;this.instanceBufferLayout=I}var G=E.prototype;
G.allocate=function(H){return this.vertexBufferLayout.createBuffer(H)};G.elementCount=function(H){return H.indices.position.length};G.write=function(H,I,J,K){g.writeDefaultAttributes(I,this.vertexBufferLayout,H.transformation,H.invTranspTransformation,J,K)};return E}();const B=a.create(),x=a.create(),C=a.fromValues(0,0,1),z=a.create(),A=a.create(),t=a.create(),D=a.create();b.COLOR_GAMMA=2.1;b.DefaultMaterial=m;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../materials/internal/MaterialUtil ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../core/shaderLibrary/shading/VisualVariables.glsl ../core/shaderLibrary/attributes/VerticalOffset.glsl ../lib/OrderIndependentTransparency ../lib/StencilUtils ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../../chunks/DefaultMaterial.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A){d=function(D){function E(){return D.apply(this,arguments)||this}a._inheritsLoose(E,D);var G=E.prototype;G.initializeProgram=function(H){var I=E.shader.get();const J=this.configuration;I=I.build({OITEnabled:0===J.transparencyPassType,output:J.output,viewingMode:H.viewingMode,receiveShadows:J.receiveShadows,slicePlaneEnabled:J.slicePlaneEnabled,sliceHighlightDisabled:J.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:J.symbolColors,
vvSize:J.vvSize,vvColor:J.vvColor,vvInstancingEnabled:!0,instanced:J.instanced,instancedColor:J.instancedColor,instancedDoublePrecision:J.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:J.usePBR?J.isSchematic?2:1:0,hasMetalnessAndRoughnessTexture:J.hasMetalnessAndRoughnessTexture,hasEmissionTexture:J.hasEmissionTexture,hasOcclusionTexture:J.hasOcclusionTexture,hasNormalTexture:J.hasNormalTexture,hasColorTexture:J.hasColorTexture,receiveAmbientOcclusion:J.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,
normalType:J.normalsTypeDerivate?3:0,doubleSidedMode:J.doubleSidedMode,vertexTangets:J.vertexTangents,attributeTextureCoordinates:J.hasMetalnessAndRoughnessTexture||J.hasEmissionTexture||J.hasOcclusionTexture||J.hasNormalTexture||J.hasColorTexture?1:0,textureAlphaPremultiplied:J.textureAlphaPremultiplied,attributeColor:J.vertexColors,screenSizePerspectiveEnabled:J.screenSizePerspective,verticalOffsetEnabled:J.verticalOffset,offsetBackfaces:J.offsetBackfaces,doublePrecisionRequiresObfuscation:x.doublePrecisionRequiresObfuscation(H.rctx),
alphaDiscardMode:J.alphaDiscardMode,supportsTextureAtlas:!1});return new f(H.rctx,I.generateSource("vertex"),I.generateSource("fragment"),e.Default3D)};G.bindPass=function(H,I,J){p.View.bindProjectionMatrix(this.program,J.camera.projectionMatrix);const K=this.configuration.output;7===K&&(this.program.setUniform1f("opacity",I.opacity),this.program.setUniform1f("layerOpacity",I.layerOpacity),this.program.setUniform4fv("externalColor",I.externalColor),this.program.setUniform1i("colorMixMode",n.colorMixModes[I.colorMixMode]));
0===K?(J.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",I.ambient),this.program.setUniform3fv("diffuse",I.diffuse),this.program.setUniform4fv("externalColor",I.externalColor),this.program.setUniform1i("colorMixMode",n.colorMixModes[I.colorMixMode]),this.program.setUniform1f("opacity",I.opacity),this.program.setUniform1f("layerOpacity",I.layerOpacity),this.configuration.usePBR&&z.PhysicallyBasedRenderingParameters.bindUniforms(this.program,I,this.configuration.isSchematic)):
1===K||3===K?this.program.setUniform2fv("nearFar",J.camera.nearFar):4===K&&q.OutputHighlight.bindOutputHighlight(H,this.program,J);m.VisualVariables.bindUniformsForSymbols(this.program,I);u.VerticalOffset.bindUniforms(this.program,I,J);n.bindScreenSizePerspective(I.screenSizePerspective,this.program,"screenSizePerspectiveAlignment");2!==I.textureAlphaMode&&3!==I.textureAlphaMode||this.program.setUniform1f("textureAlphaCutoff",I.textureAlphaCutoff)};G.bindDraw=function(H){const I=this.configuration.instancedDoublePrecision?
l.fromValues(H.camera.viewInverseTransposeMatrix[3],H.camera.viewInverseTransposeMatrix[7],H.camera.viewInverseTransposeMatrix[11]):H.origin;p.View.bindViewCustomOrigin(this.program,I,H.camera.viewMatrix);(0===this.configuration.output||7===this.configuration.output||1===this.configuration.output&&this.configuration.screenSizePerspective||2===this.configuration.output&&this.configuration.screenSizePerspective||4===this.configuration.output&&this.configuration.screenSizePerspective)&&p.View.bindCamPosition(this.program,
I,H.camera.viewInverseTransposeMatrix);2===this.configuration.output&&this.program.setUniformMatrix4fv("viewNormal",H.camera.viewInverseTransposeMatrix);this.configuration.instancedDoublePrecision&&C.InstancedDoublePrecision.bindCustomOrigin(this.program,I);w.Slice.bindUniforms(this.program,this.configuration,H.slicePlane,I);0===this.configuration.output&&B.ReadShadowMap.bindViewCustomOrigin(this.program,H,I)};G.setPipeline=function(H,I){const J=this.configuration,K=3===H,L=2===H;return g.makePipelineState({blending:0!==
J.output&&7!==J.output||!J.transparent?null:K?v.blendingDefault:v.OITBlending(H),culling:t(J),depthTest:{func:v.OITDepthTest(H)},depthWrite:K||L?J.writeDepth&&g.defaultDepthWriteParams:null,colorWrite:g.defaultColorWriteParams,stencilWrite:J.sceneHasOcludees?y.stencilWriteMaskOn:null,stencilTest:J.sceneHasOcludees?I?y.stencilToolMaskBaseParams:y.stencilBaseAllZerosParams:null,polygonOffset:K||L?null:v.getOITPolygonOffset(J.enableOffset)})};G.initializePipeline=function(){this._occludeePipelineState=
this.setPipeline(this.configuration.transparencyPassType,!0);return this.setPipeline(this.configuration.transparencyPassType,!1)};G.getPipelineState=function(H){return H?this._occludeePipelineState:this.pipeline};return E}(d.ShaderTechnique);d.shader=new h.ReloadableShaderModule(A.DefaultMaterialShader,()=>new Promise(function(D,E){b(["./DefaultMaterial.glsl"],D,E)}));const t=D=>{var E=D.cullFace?0!==D.cullFace:D.slicePlaneEnabled?!1:!D.transparent&&!D.doubleSidedMode;return E&&{face:1===D.cullFace?
1028:1029,mode:2305}};h=function(D){function E(){var G=D.apply(this,arguments)||this;G.output=0;G.alphaDiscardMode=1;G.doubleSidedMode=0;G.isSchematic=!1;G.vertexColors=!1;G.offsetBackfaces=!1;G.symbolColors=!1;G.vvSize=!1;G.vvColor=!1;G.verticalOffset=!1;G.receiveShadows=!1;G.slicePlaneEnabled=!1;G.sliceHighlightDisabled=!1;G.receiveAmbientOcclusion=!1;G.screenSizePerspective=!1;G.textureAlphaPremultiplied=!1;G.hasColorTexture=!1;G.usePBR=!1;G.hasMetalnessAndRoughnessTexture=!1;G.hasEmissionTexture=
!1;G.hasOcclusionTexture=!1;G.hasNormalTexture=!1;G.instanced=!1;G.instancedColor=!1;G.instancedDoublePrecision=!1;G.vertexTangents=!1;G.normalsTypeDerivate=!1;G.writeDepth=!0;G.sceneHasOcludees=!1;G.transparent=!1;G.enableOffset=!0;G.cullFace=0;G.transparencyPassType=3;return G}a._inheritsLoose(E,D);return E}(c.ShaderTechniqueConfiguration);r.__decorate([c.parameter({count:8})],h.prototype,"output",void 0);r.__decorate([c.parameter({count:4})],h.prototype,"alphaDiscardMode",void 0);r.__decorate([c.parameter({count:3})],
h.prototype,"doubleSidedMode",void 0);r.__decorate([c.parameter()],h.prototype,"isSchematic",void 0);r.__decorate([c.parameter()],h.prototype,"vertexColors",void 0);r.__decorate([c.parameter()],h.prototype,"offsetBackfaces",void 0);r.__decorate([c.parameter()],h.prototype,"symbolColors",void 0);r.__decorate([c.parameter()],h.prototype,"vvSize",void 0);r.__decorate([c.parameter()],h.prototype,"vvColor",void 0);r.__decorate([c.parameter()],h.prototype,"verticalOffset",void 0);r.__decorate([c.parameter()],
h.prototype,"receiveShadows",void 0);r.__decorate([c.parameter()],h.prototype,"slicePlaneEnabled",void 0);r.__decorate([c.parameter()],h.prototype,"sliceHighlightDisabled",void 0);r.__decorate([c.parameter()],h.prototype,"receiveAmbientOcclusion",void 0);r.__decorate([c.parameter()],h.prototype,"screenSizePerspective",void 0);r.__decorate([c.parameter()],h.prototype,"textureAlphaPremultiplied",void 0);r.__decorate([c.parameter()],h.prototype,"hasColorTexture",void 0);r.__decorate([c.parameter()],
h.prototype,"usePBR",void 0);r.__decorate([c.parameter()],h.prototype,"hasMetalnessAndRoughnessTexture",void 0);r.__decorate([c.parameter()],h.prototype,"hasEmissionTexture",void 0);r.__decorate([c.parameter()],h.prototype,"hasOcclusionTexture",void 0);r.__decorate([c.parameter()],h.prototype,"hasNormalTexture",void 0);r.__decorate([c.parameter()],h.prototype,"instanced",void 0);r.__decorate([c.parameter()],h.prototype,"instancedColor",void 0);r.__decorate([c.parameter()],h.prototype,"instancedDoublePrecision",
void 0);r.__decorate([c.parameter()],h.prototype,"vertexTangents",void 0);r.__decorate([c.parameter()],h.prototype,"normalsTypeDerivate",void 0);r.__decorate([c.parameter()],h.prototype,"writeDepth",void 0);r.__decorate([c.parameter()],h.prototype,"sceneHasOcludees",void 0);r.__decorate([c.parameter()],h.prototype,"transparent",void 0);r.__decorate([c.parameter()],h.prototype,"enableOffset",void 0);r.__decorate([c.parameter({count:3})],h.prototype,"cullFace",void 0);r.__decorate([c.parameter({count:4})],
h.prototype,"transparencyPassType",void 0);k.DefaultMaterialTechnique=d;k.DefaultMaterialTechniqueConfiguration=h;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../../../../../core/has","../../shaderModules/interfaces","../../../lib/WebGLDriverTest"],function(b,k,a,r){b.DoublePrecision=function({code:l},h){h.doublePrecisionRequiresObfuscation?l.add(a.glsl`
      vec3 dpPlusFrc(vec3 a, vec3 b) {
        return mix(a, a + b, vec3(notEqual(b, vec3(0))));
      }

      vec3 dpMinusFrc(vec3 a, vec3 b) {
        return mix(vec3(0), a - b, vec3(notEqual(a, b)));
      }

      // based on https://www.thasler.com/blog/blog/glsl-part2-emu
      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
        vec3 t1 = dpPlusFrc(hiA, hiB);
        vec3 e = dpMinusFrc(t1, hiA);
        vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
        return t1 + t2;
      }
    `):l.add(a.glsl`
      vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
        vec3 t1 = hiA + hiB;
        vec3 e = t1 - hiA;
        vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
        return t1 + t2;
      }
    `)};b.doublePrecisionRequiresObfuscation=function(l){return k("force-double-precision-obfuscation")?!0:r.testWebGLDriver(l).doublePrecisionRequiresObfuscation};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/WebGLDriverTest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../webgl/Program ./Util ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ./doublePrecisionUtils ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){function m(y,B){var x=new p(y,{colorTarget:0,depthStencilTarget:0},{target:3553,wrapMode:33071,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1});const C=d.createVertex(y,35044,new Uint16Array([0,0,1,0,0,1,1,1])),z=new e(y,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1}]},{geometry:C}),A=r.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),t=r.fromValues(5633271.46742708,2626873.6381334523,
1434963.231608387);B=new l(y,`

  precision highp float;

  attribute vec2 a_pos;

  uniform vec3 u_highA;
  uniform vec3 u_lowA;
  uniform vec3 u_highB;
  uniform vec3 u_lowB;

  varying vec4 v_color;

  ${B?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}

  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION

  vec3 dpPlusFrc(vec3 a, vec3 b) {
    return mix(a, a + b, vec3(notEqual(b, vec3(0))));
  }

  vec3 dpMinusFrc(vec3 a, vec3 b) {
    return mix(vec3(0), a - b, vec3(notEqual(a, b)));
  }

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = dpPlusFrc(hiA, hiB);
    vec3 e = dpMinusFrc(t1, hiA);
    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
    return t1 + t2;
  }

  #else

  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
    vec3 t1 = hiA + hiB;
    vec3 e = t1 - hiA;
    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
    return t1 + t2;
  }

  #endif

  const float MAX_RGBA_FLOAT =
    255.0 / 256.0 +
    255.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 +
    255.0 / 256.0 / 256.0 / 256.0 / 256.0;

  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);

  vec4 float2rgba(const float value) {
    // Make sure value is in the domain we can represent
    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);

    // Decompose value in 32bit fixed point parts represented as
    // uint8 rgba components. Decomposition uses the fractional part after multiplying
    // by a power of 256 (this removes the bits that are represented in the previous
    // component) and then converts the fractional part to 8bits.
    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);

    // Convert uint8 values (from 0 to 255) to floating point representation for
    // the shader
    const float toU8AsFloat = 1.0 / 255.0;

    return fixedPointU8 * toU8AsFloat;
  }

  void main() {
    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);

    v_color = float2rgba(val.z / 25.0);

    gl_Position = vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);
  }
  `,"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",{a_pos:0});var D=new Float32Array(6);f.encodeDoubleArray(A,D,3);var E=new Float32Array(6);f.encodeDoubleArray(t,E,3);y.bindProgram(B);B.setUniform3f("u_highA",D[0],D[2],D[4]);B.setUniform3f("u_lowA",D[1],D[3],D[5]);B.setUniform3f("u_highB",E[0],E[2],E[4]);B.setUniform3f("u_lowB",E[1],E[3],E[5]);D=B;E=y.getBoundFramebufferObject();const {x:G,y:H,width:I,height:J}=y.getViewport();
y.bindFramebuffer(x);y.setViewport(0,0,1,1);y.bindVAO(z);y.drawArrays(5,0,4);B=new Uint8Array(4);x.readPixels(0,0,1,1,6408,5121,B);D.dispose();z.dispose(!1);C.dispose();x.dispose();y.setViewport(G,H,I,J);y.bindFramebuffer(E);y=(A[2]-t[2])/25;x=h.unpackFloatRGBA(B);return Math.abs(y-x)}let u=function(){function y(B){this.context=B;this._doublePrecisionRequiresObfuscation=null}k._createClass(y,[{key:"doublePrecisionRequiresObfuscation",get:function(){if(a.isNone(this._doublePrecisionRequiresObfuscation)){const B=
m(this.context,!1),x=m(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==B&&(0===x||5<B/x)}return this._doublePrecisionRequiresObfuscation}}]);return y}(),v=null;b.clearTestWebGLDriver=function(y){a.isSome(v)&&v.context===y&&(v=null)};b.testWebGLDriver=function(y){if(a.isNone(v)||v.context!==y)v=new u(y);return v};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define(["exports","../../../../../../chunks/vec3f64",
"../../shaderModules/interfaces","../../../lib/doublePrecisionUtils","../util/DoublePrecision.glsl"],function(b,k,a,r,l){function h(e,f){f.instanced&&f.instancedDoublePrecision&&(e.attributes.add("modelOriginHi","vec3"),e.attributes.add("modelOriginLo","vec3"),e.attributes.add("model","mat3"),e.attributes.add("modelNormal","mat3"));f.instancedDoublePrecision&&(e.vertex.include(l.DoublePrecision,f),e.vertex.uniforms.add("viewOriginHi","vec3"),e.vertex.uniforms.add("viewOriginLo","vec3"));const g=[a.glsl`
    vec3 calculateVPos() {
      ${f.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `,a.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${f.instancedDoublePrecision?a.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `,a.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${f.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `,a.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${f.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `,f.vertexTangets?a.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${f.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `:a.glsl``];e.vertex.code.add(g[0]);e.vertex.code.add(g[1]);e.vertex.code.add(g[2]);2===f.output&&e.vertex.code.add(g[3]);e.vertex.code.add(g[4])}(function(e){e.Uniforms=function(){};e.bindCustomOrigin=function(f,g){r.encodeDoubleArraySplit(g,d,c,3);f.setUniform3fv("viewOriginHi",d);f.setUniform3fv("viewOriginLo",c)}})(h||(h={}));const d=k.create(),c=k.create();b.InstancedDoublePrecision=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define(["exports",
"../../shaderModules/interfaces","../../../../../../chunks/vec3f32","../attributes/VertexTextureCoordinates.glsl"],function(b,k,a,r){function l(h,d){const c=h.fragment,e=d.hasMetalnessAndRoughnessTexture||d.hasEmissionTexture||d.hasOcclusionTexture;1===d.pbrMode&&e&&h.include(r.VertexTextureCoordinates,d);2===d.pbrMode?c.code.add(k.glsl`
      const vec3 mrr = vec3(0.0, 0.6, 0.2);
      const vec3 emission = vec3(0.0);
      float occlusion = 1.0;

      void applyPBRFactors() {}

      float getBakedOcclusion() { return 1.0; }
    `):(0===d.pbrMode&&c.code.add(k.glsl`
      float getBakedOcclusion() { return 1.0; }
  `),1===d.pbrMode&&(c.uniforms.add("emissionFactor","vec3"),c.uniforms.add("mrrFactors","vec3"),c.code.add(k.glsl`
      vec3 mrr;
      vec3 emission;
      float occlusion;
    `),d.hasMetalnessAndRoughnessTexture&&(c.uniforms.add("texMetallicRoughness","sampler2D"),d.supportsTextureAtlas&&c.uniforms.add("texMetallicRoughnessSize","vec2"),c.code.add(k.glsl`
      void applyMetallnessAndRoughness(TextureLookupParameter params) {
        vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;

        mrr[0] *= metallicRoughness.b;
        mrr[1] *= metallicRoughness.g;
      }`)),d.hasEmissionTexture&&(c.uniforms.add("texEmission","sampler2D"),d.supportsTextureAtlas&&c.uniforms.add("texEmissionSize","vec2"),c.code.add(k.glsl`
      void applyEmission(TextureLookupParameter params) {
        emission *= textureLookup(texEmission, params).rgb;
      }`)),d.hasOcclusionTexture?(c.uniforms.add("texOcclusion","sampler2D"),d.supportsTextureAtlas&&c.uniforms.add("texOcclusionSize","vec2"),c.code.add(k.glsl`
      void applyOcclusion(TextureLookupParameter params) {
        occlusion *= textureLookup(texOcclusion, params).r;
      }

      float getBakedOcclusion() {
        return occlusion;
      }
      `)):c.code.add(k.glsl`
      float getBakedOcclusion() { return 1.0; }
      `),c.code.add(k.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${e?"vtc.uv \x3d vuv0;":""}
      ${d.hasMetalnessAndRoughnessTexture?d.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${d.hasEmissionTexture?d.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${d.hasOcclusionTexture?d.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)))}a=a.fromValues(0,.6,.2);(function(h){h.bindUniforms=function(d,c,e=!1){e||(d.setUniform3fv("mrrFactors",c.mrrFactors),d.setUniform3fv("emissionFactor",c.emissiveFactor))}})(l||(l={}));b.PBRSchematicMRRValues=a;b.PhysicallyBasedRenderingParameters=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","../../shaderModules/interfaces","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl"],
function(b,k,a,r){b.VertexTextureCoordinates=function(l,h){l.include(a.TextureCoordinateAttribute,h);l.fragment.code.add(k.glsl`
  struct TextureLookupParameter {
    vec2 uv;
    ${h.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `);1===h.attributeTextureCoordinates&&l.fragment.code.add(k.glsl`
      vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
        return texture2D(tex, params.uv);
      }
    `);2===h.attributeTextureCoordinates&&(l.include(r.TextureAtlasLookup),l.fragment.code.add(k.glsl`
    vec4 textureLookup(sampler2D tex, TextureLookupParameter params) {
        return textureAtlasLookup(tex, params.size, params.uv, vuvRegion);
      }
    `))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.TextureCoordinateAttribute=function(a,r){1===r.attributeTextureCoordinates&&(a.attributes.add("uv0","vec2"),a.varyings.add("vuv0","vec2"),a.vertex.code.add(k.glsl`
      void forwardTextureCoordinates() {
        vuv0 = uv0;
      }
    `));2===r.attributeTextureCoordinates&&(a.attributes.add("uv0","vec2"),a.varyings.add("vuv0","vec2"),a.attributes.add("uvRegion","vec4"),a.varyings.add("vuvRegion","vec4"),a.vertex.code.add(k.glsl`
      void forwardTextureCoordinates() {
        vuv0 = uv0;
        vuvRegion = uvRegion;
      }
    `));0===r.attributeTextureCoordinates&&a.vertex.code.add(k.glsl`
      void forwardTextureCoordinates() {}
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.TextureAtlasLookup=function(a){a.extensions.add("GL_EXT_shader_texture_lod");a.extensions.add("GL_OES_standard_derivatives");a.fragment.code.add(k.glsl`
    #ifndef GL_EXT_shader_texture_lod
      float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
        float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
        return max(0.0, 0.5 * log2(deltaMaxSqr));
      }
    #endif

    vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
      //[umin, vmin, umax, vmax]
      vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
      vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;

      // calculate derivative of continuous texture coordinate
      // to avoid mipmapping artifacts caused by manual wrapping in shader
      vec2 dUVdx = dFdx(textureCoordinates) * atlasScale;
      vec2 dUVdy = dFdy(textureCoordinates) * atlasScale;

      #ifdef GL_EXT_shader_texture_lod
        return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
      #else
        // use bias to compensate for difference in automatic vs desired mipmap level
        vec2 dUVdxAuto = dFdx(uvAtlas);
        vec2 dUVdyAuto = dFdy(uvAtlas);
        float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
        float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);

        return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
      #endif
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E){function G(I){const J=new r.ShaderBuilder,K=J.vertex.code,L=J.fragment.code;J.include(D.HeaderComment,{name:"Default Material Shader",output:I.output});J.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");J.include(v.PositionAttribute);J.varyings.add("vpos","vec3");J.include(h.VisualVariables,I);J.include(n.InstancedDoublePrecision,I);J.include(c.VerticalOffset,I);if(0===I.output||7===
I.output)J.include(u.NormalAttribute,I),J.include(a.Transform,{linearDepth:!1}),0===I.normalType&&I.offsetBackfaces&&J.include(m.Offset),J.include(C.ComputeNormalTexture,I),J.include(B.VertexNormal,I),I.instancedColor&&J.attributes.add("instanceColor","vec4"),J.varyings.add("localvpos","vec3"),J.include(w.TextureCoordinateAttribute,I),J.include(g.ForwardLinearDepth,I),J.include(y.SymbolColor,I),J.include(e.VertexColor,I),J.vertex.uniforms.add("externalColor","vec4"),J.varyings.add("vcolorExt","vec4"),
K.add(k.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${I.instancedColor?"vcolorExt *\x3d instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${k.glsl.float(d.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        }
        else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${0===I.normalType?k.glsl`
          vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${I.vertexTangets?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, vpos);
          ${0===I.normalType&&I.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
        }
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `);7===I.output&&(J.include(l.Slice,I),J.include(d.DiscardOrAdjustAlpha,I),J.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),I.hasColorTexture&&J.fragment.uniforms.add("tex","sampler2D"),J.fragment.include(E.MixExternalColor),L.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        ${I.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${I.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:k.glsl`vec4 texColor = vec4(1.0);`}
        ${I.attributeColor?k.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:k.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        gl_FragColor = vec4(opacity_);
      }
    `));0===I.output&&(J.include(l.Slice,I),J.include(A.EvaluateSceneLighting,I),J.include(z.EvaluateAmbientOcclusion,I),J.include(d.DiscardOrAdjustAlpha,I),I.receiveShadows&&J.include(f.ReadShadowMap,I),J.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),I.hasColorTexture&&J.fragment.uniforms.add("tex","sampler2D"),J.include(q.PhysicallyBasedRenderingParameters,I),J.include(p.PhysicallyBasedRendering,
I),J.fragment.include(E.MixExternalColor),J.include(t.Normals,I),L.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        ${I.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${I.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:k.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - camPos);
        ${3===I.normalType?k.glsl`
        vec3 normal = screenDerivativeNormal(localvpos);`:k.glsl`
        shadingParams.normalView = vNormalWorld;
        vec3 normal = shadingNormal(shadingParams);`}
        ${1===I.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${I.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===I.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${I.attributeColor?k.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:k.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${I.hasNormalTexture?k.glsl`
              mat3 tangentSpace = ${I.vertexTangets?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
              vec3 shadedNormal = computeTextureNormal(tangentSpace, vuv0);`:"vec3 shadedNormal \x3d normal;"}
        ${1===I.pbrMode||2===I.pbrMode?1===I.viewingMode?k.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:k.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:k.glsl``}
        ${1===I.pbrMode||2===I.pbrMode?k.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${I.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));J.include(x.DefaultMaterialAuxiliaryPasses,I);return J}var H=Object.freeze({__proto__:null,build:G});b.DefaultMaterialShader=H;b.build=G})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(b,k){b.Offset=function(a){a.vertex.code.add(k.glsl`
    vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
      vec3 camToVert = posWorld - camPosWorld;

      bool isBackface = dot(camToVert, normalWorld) > 0.0;
      if (isBackface) {
        posClip.z += 0.0000003 * posClip.w;
      }
      return posClip;
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../util/DecodeNormal.glsl"],function(b,k,a){b.NormalAttribute=function(r,l){0===l.normalType&&(r.attributes.add("normal","vec3"),r.vertex.code.add(k.glsl`
      vec3 normalModel() {
        return normal;
      }
    `));1===l.normalType&&(r.include(a.DecodeNormal),r.attributes.add("normalCompressed","vec2"),r.vertex.code.add(k.glsl`
      vec3 normalModel() {
        return decodeNormal(normalCompressed);
      }
    `));3===l.normalType&&(r.extensions.add("GL_OES_standard_derivatives"),r.fragment.code.add(k.glsl`
      vec3 screenDerivativeNormal(vec3 positionView) {
        return normalize(cross(dFdx(positionView), dFdy(positionView)));
      }
    `))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.DecodeNormal=function(a){const r=k.glsl`
    vec3 decodeNormal(vec2 f) {
      float z = 1.0 - abs(f.x) - abs(f.y);
      return vec3(f + sign(f) * min(z, 0.0), z);
    }
  `;a.fragment.code.add(r);a.vertex.code.add(r)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.PositionAttribute=function(a){a.attributes.add("position","vec3");a.vertex.code.add(k.glsl`
    vec3 positionModel() { return position; }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../collections/Component/Material/shader/DecodeSymbolColor.glsl"],function(b,k,a){b.SymbolColor=function(r,l){l.symbolColor?(r.include(a.DecodeSymbolColor),r.attributes.add("symbolColor","vec4"),r.varyings.add("colorMixMode","mediump float")):r.fragment.uniforms.add("colorMixMode","int");l.symbolColor?
r.vertex.code.add(k.glsl`
    int symbolColorMixMode;

    vec4 getSymbolColor() {
      return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
    }

    void forwardColorMixMode() {
      colorMixMode = float(symbolColorMixMode) + 0.5;
    }
  `):r.vertex.code.add(k.glsl`
    vec4 getSymbolColor() { return vec4(1.0); }
    void forwardColorMixMode() {}
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(b,k){b.DecodeSymbolColor=function(a){a.vertex.code.add(k.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${k.glsl.int(1)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${k.glsl.int(3)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${k.glsl.int(4)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${k.glsl.int(1)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define(["exports","../../shaderModules/interfaces","./NormalAttribute.glsl","./VertexPosition.glsl"],function(b,k,a,r){function l(h,d){0===d.normalType||1===d.normalType?(h.include(a.NormalAttribute,d),h.varyings.add("vNormalWorld","vec3"),h.varyings.add("vNormalView","vec3"),h.vertex.uniforms.add("uTransformNormal_GlobalFromModel","mat3"),h.vertex.uniforms.add("uTransformNormal_ViewFromGlobal",
"mat3"),h.vertex.code.add(k.glsl`
      void forwardNormal() {
        vNormalWorld = uTransformNormal_GlobalFromModel * normalModel();
        vNormalView = uTransformNormal_ViewFromGlobal * vNormalWorld;
      }
    `)):2===d.normalType?(h.include(r.VertexPosition,d),h.varyings.add("vNormalWorld","vec3"),h.vertex.code.add(k.glsl`
    void forwardNormal() {
      vNormalWorld = ${1===d.viewingMode?k.glsl`normalize(vPositionWorldCameraRelative);`:k.glsl`vec3(0.0, 0.0, 1.0);`}
    }
    `)):h.vertex.code.add(k.glsl`
      void forwardNormal() {}
    `)}(function(h){h.bindUniforms=function(d,c){d.setUniformMatrix4fv("viewNormal",c)}})(l||(l={}));b.VertexNormal=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/vec3f64 ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../shaderModules/interfaces ../util/DoublePrecision.glsl ./PositionAttribute.glsl".split(" "),function(b,k,a,r,l,h,d){function c(e,
f){e.include(d.PositionAttribute);e.vertex.include(h.DoublePrecision,f);e.varyings.add("vPositionWorldCameraRelative","vec3");e.varyings.add("vPosition_view","vec3");e.vertex.uniforms.add("uTransform_WorldFromModel_RS","mat3");e.vertex.uniforms.add("uTransform_WorldFromModel_TH","vec3");e.vertex.uniforms.add("uTransform_WorldFromModel_TL","vec3");e.vertex.uniforms.add("uTransform_WorldFromView_TH","vec3");e.vertex.uniforms.add("uTransform_WorldFromView_TL","vec3");e.vertex.uniforms.add("uTransform_ViewFromCameraRelative_RS",
"mat3");e.vertex.uniforms.add("uTransform_ProjFromView","mat4");e.vertex.code.add(l.glsl`
    // compute position in world space orientation, but relative to the camera position
    vec3 positionWorldCameraRelative() {
      vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * positionModel();

      vec3 transform_CameraRelativeFromModel = dpAdd(
        uTransform_WorldFromModel_TL,
        uTransform_WorldFromModel_TH,
        -uTransform_WorldFromView_TL,
        -uTransform_WorldFromView_TH
      );

      return transform_CameraRelativeFromModel + rotatedModelPosition;
    }

    // position in view space, that is relative to the camera position and orientation
    vec3 position_view() {
      return uTransform_ViewFromCameraRelative_RS * positionWorldCameraRelative();
    }

    // compute gl_Position and forward related varyings to fragment shader
    void forwardPosition() {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      vPosition_view = position_view();
      gl_Position = uTransform_ProjFromView * vec4(vPosition_view, 1.0);
    }

    vec3 positionWorld() {
      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
    }
  `);e.fragment.uniforms.add("uTransform_WorldFromView_TL","vec3");e.fragment.code.add(l.glsl`
    vec3 positionWorld() {
      return uTransform_WorldFromView_TL + vPositionWorldCameraRelative;
    }
  `)}(function(e){e.ModelTransform=function(){this.worldFromModel_RS=a.create();this.worldFromModel_TH=k.create();this.worldFromModel_TL=k.create()};e.ViewProjectionTransform=function(){this.worldFromView_TH=k.create();this.worldFromView_TL=k.create();this.viewFromCameraRelative_RS=a.create();this.projFromView=r.create()};e.bindModelTransform=function(f,g){f.setUniformMatrix3fv("uTransform_WorldFromModel_RS",g.worldFromModel_RS);f.setUniform3fv("uTransform_WorldFromModel_TH",g.worldFromModel_TH);
f.setUniform3fv("uTransform_WorldFromModel_TL",g.worldFromModel_TL)};e.bindViewProjTransform=function(f,g){f.setUniform3fv("uTransform_WorldFromView_TH",g.worldFromView_TH);f.setUniform3fv("uTransform_WorldFromView_TL",g.worldFromView_TL);f.setUniformMatrix4fv("uTransform_ProjFromView",g.projFromView);f.setUniformMatrix3fv("uTransform_ViewFromCameraRelative_RS",g.viewFromCameraRelative_RS)}})(c||(c={}));b.VertexPosition=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../../shaderModules/interfaces ../Transform.glsl ../Slice.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../output/OutputDepth.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){b.DefaultMaterialAuxiliaryPasses=function(p,n){const w=p.vertex.code,q=p.fragment.code;if(1===n.output||3===n.output)p.include(a.Transform,{linearDepth:!0}),p.include(e.TextureCoordinateAttribute,n),p.include(h.VisualVariables,n),p.include(c.OutputDepth,n),p.include(r.Slice,n),p.vertex.uniforms.add("nearFar","vec2"),p.varyings.add("depth","float"),n.hasColorTexture&&p.fragment.uniforms.add("tex","sampler2D"),w.add(k.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),p.include(d.DiscardOrAdjustAlpha,n),q.add(k.glsl`
      void main(void) {
        discardBySlice(vpos);
        ${n.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `);2===n.output&&(p.include(a.Transform,{linearDepth:!1}),p.include(f.NormalAttribute,n),p.include(g.VertexNormal,n),p.include(e.TextureCoordinateAttribute,n),p.include(h.VisualVariables,n),n.hasColorTexture&&p.fragment.uniforms.add("tex","sampler2D"),p.vertex.uniforms.add("viewNormal","mat4"),p.varyings.add("vPositionView","vec3"),w.add(k.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${0===n.normalType?k.glsl`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();
      }
    `),p.include(r.Slice,n),p.include(d.DiscardOrAdjustAlpha,n),q.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        ${n.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${3===n.normalType?k.glsl`
            vec3 normal = screenDerivativeNormal(vPositionView);`:k.glsl`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `));4===n.output&&(p.include(a.Transform,{linearDepth:!1}),p.include(e.TextureCoordinateAttribute,n),p.include(h.VisualVariables,n),n.hasColorTexture&&p.fragment.uniforms.add("tex","sampler2D"),w.add(k.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, vpos);
        forwardTextureCoordinates();
      }
    `),p.include(r.Slice,n),p.include(d.DiscardOrAdjustAlpha,n),p.include(l.OutputHighlight),q.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        ${n.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define(["exports","../../shaderModules/interfaces","../attributes/VertexTextureCoordinates.glsl"],function(b,k,a){b.ComputeNormalTexture=function(r,l){const h=r.fragment;h.uniforms.add("normalTexture","sampler2D");h.uniforms.add("normalTextureSize","vec2");l.vertexTangets?(r.attributes.add("tangent","vec4"),r.varyings.add("vTangent","vec4"),2===
l.doubleSidedMode?h.code.add(k.glsl`
      mat3 computeTangentSpace(vec3 normal) {
        float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
        vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
        return mat3(tangent, bitangent, normal);
      }
    `):h.code.add(k.glsl`
      mat3 computeTangentSpace(vec3 normal) {
        float tangentHeadedness = vTangent.w;
        vec3 tangent = normalize(vTangent.xyz);
        vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
        return mat3(tangent, bitangent, normal);
      }
    `)):(r.extensions.add("GL_OES_standard_derivatives"),h.code.add(k.glsl`
    mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {

      vec3 Q1 = dFdx(pos);
      vec3 Q2 = dFdy(pos);

      vec2 stx = dFdx(st);
      vec2 sty = dFdy(st);

      float det = stx.t * sty.s - sty.t * stx.s;

      vec3 T = stx.t * Q2 - sty.t * Q1; // compute tangent
      T = T - normal * dot(normal, T); // orthogonalize tangent
      T *= inversesqrt(max(dot(T,T), 1.e-10)); // "soft" normalize - goes to 0 when T goes to 0
      vec3 B = sign(det) * cross(normal, T); // assume normal is normalized, B has the same lenght as B
      return mat3(T, B, normal); // T and B go to 0 when the tangent space is not well defined by the uv coordinates
    }
  `));0!==l.attributeTextureCoordinates&&(r.include(a.VertexTextureCoordinates,l),h.code.add(k.glsl`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${l.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.EvaluateAmbientOcclusion=function(a,r){a=a.fragment;r.receiveAmbientOcclusion?(a.uniforms.add("ssaoTex","sampler2D"),a.uniforms.add("viewportPixelSz","vec4"),a.code.add(k.glsl`
      float evaluateAmbientOcclusion() {
        return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
      }

      float evaluateAmbientOcclusionInverse() {
        float ssao = texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
        return viewportPixelSz.z < 0.0 ? 1.0 : ssao;
      }
    `)):a.code.add(k.glsl`
      float evaluateAmbientOcclusion() { return 0.0; } // no occlusion
      float evaluateAmbientOcclusionInverse() { return 1.0; }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../shaderModules/interfaces ./PiUtils.glsl ./ReadShadowMap.glsl ./PhysicallyBasedRendering.glsl ./EvaluateAmbientOcclusion.glsl ./EvaluateAmbientLighting.glsl ./EvaluateMainLighting.glsl".split(" "),function(b,k,a,r,l,h,d,c){b.EvaluateSceneLighting=function(e,f){const g=e.fragment;e.include(c.EvaluateMainLighting);e.include(h.EvaluateAmbientOcclusion,
f);0!==f.pbrMode&&e.include(l.PhysicallyBasedRendering,f);e.include(d.EvaluateAmbientLighting,f);f.receiveShadows&&e.include(r.ReadShadowMap,f);g.uniforms.add("lightingGlobalFactor","float");g.uniforms.add("ambientBoostFactor","float");e.include(a.PiUtils);g.code.add(k.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${0===f.pbrMode?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);if(f.useOldSceneLightInterface)g.code.add(k.glsl`
    vec3 evaluateSceneLightingExt(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {
      // evaluate the main light
      #if defined(TREE_RENDERING)
        // Special case for tree rendering:
        // We shift the Lambert lobe to the back, allowing it to reach part of the hemisphere
        // facing away from the light. The idea is to get an effect where light is transmitted
        // through the tree.
        float minDot = -0.5;
        float dotRange = 1.0 - minDot;
        float dotNormalization = 0.66; // guessed & hand tweaked value, for an exact value we could precompute an integral over the sphere

        float dotVal = dotNormalization * (clamp(-dot(normal, lightingMainDirection), 1.0 - dotRange, 1.0) - minDot) * (1.0 / dotRange);
      #else
        float dotVal = clamp(-dot(normal, lightingMainDirection), 0.0, 1.0);
      #endif

      // move lighting towards (1.0, 1.0, 1.0) if requested
      dotVal = mix(dotVal, 1.0, lightingFixedFactor);

      vec3 mainLight = (1.0 - shadow) * lightingMainIntensity * dotVal;
      vec3 ambientLight = calculateAmbientIrradiance(normal, ssao);

      // inverse gamma correction on the albedo color
      vec3 albedoGammaC = pow(albedo, vec3(GAMMA_SRGB));

      // physically correct BRDF normalizes by PI
      vec3 totalLight = mainLight + ambientLight + additionalLight;
      totalLight = min(totalLight, vec3(PI));
      vec3 outColor = vec3((albedoGammaC / PI) * (totalLight));

      // apply gamma correction to the computed color
      outColor = pow(outColor, vec3(INV_GAMMA_SRGB));

      return outColor;
    }
  `);else if(1===f.viewingMode?g.code.add(k.glsl`
      float _oldHeuristicLighting(vec3 vPosWorld) {
        vec3 shadingNormalWorld = normalize(vPosWorld);
        float vndl = -dot(shadingNormalWorld, lightingMainDirection);

        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
      }
    `):g.code.add(k.glsl`
      float _oldHeuristicLighting(vec3 vPosWorld) {
        float vndl = -dot(vec3(0.0, 0.0, 1.0), lightingMainDirection);
        return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
      }
    `),g.code.add(k.glsl`
      vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
        float additionalAmbientScale = _oldHeuristicLighting(vPosWorld);
        return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
      }
    `),0===f.pbrMode||4===f.pbrMode)g.code.add(k.glsl`
      vec3 evaluateSceneLighting(vec3 normalWorld, vec3 baseColor, float mainLightShadow, float ambientOcclusion, vec3 additionalLight)
      {
        vec3 mainLighting = evaluateMainLighting(normalWorld, mainLightShadow);
        vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ambientOcclusion);
        // inverse gamma correction on the base color
        vec3 baseColorLinear = pow(baseColor, vec3(GAMMA_SRGB));

        // physically correct BRDF normalizes by PI
        vec3 totalLight = mainLighting + ambientLighting + additionalLight;
        totalLight = min(totalLight, vec3(PI));
        vec3 outColor = vec3((baseColorLinear / PI) * totalLight);

        // apply gamma correction to the computed color
        outColor = pow(outColor, vec3(INV_GAMMA_SRGB));

        return outColor;
      }
      `);else if(1===f.pbrMode||2===f.pbrMode)g.code.add(k.glsl`
      const float fillLightIntensity = 0.25;
      const float horizonLightDiffusion = 0.4;
      const float additionalAmbientIrradianceFactor = 0.02;

      vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
      {
        // Calculate half vector between view and light direction
        vec3 viewDirection = -viewDir;
        vec3 mainLightDirection = -lightingMainDirection;
        vec3 h = normalize(viewDirection + mainLightDirection);

        PBRShadingInfo inputs;
        inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
        inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
        inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
        inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
        inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
        vec3 reflectedView = normalize(reflect(viewDirection, normal));
        inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);

        inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
        inputs.ssao = ssao;

        inputs.metalness = mrr[0];
        inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);
      `),g.code.add(k.glsl`
        inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
        inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0)); // more accurate then using  f90 = 1.0
        inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);
      `),g.code.add(k.glsl`
        vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
        ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));

        inputs.NdotAmbDir = abs(dot(normal, ambientDir));

        // Calculate the irradiance components: sun, fill lights and the sky.
        vec3 mainLightIrradianceComponent  = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
        vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
        // calculateAmbientIrradiance for localView and additionalLight for gloabalView
        vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;

        // Assemble the overall irradiance of the sky that illuminates the surface
        inputs.skyIrradianceToSurface    = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
        // Assemble the overall irradiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky irradiance by the groundReflectance
        inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
      `),g.code.add(k.glsl`
        vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
        vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
        inputs.NdotH_Horizon = dot(normal, horizonRingH);

        vec3 mainLightRadianceComponent  = normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
        vec3 horizonLightRadianceComponent = normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
        vec3 ambientLightRadianceComponent = calculateAmbientRadiance(ssao) + additionalLight; // calculateAmbientRadiance for localView and additionalLight for gloabalView

        // Assemble the overall radiance of the sky that illuminates the surface
        inputs.skyRadianceToSurface    =  ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
        // Assemble the overall radiance of the ground that illuminates the surface. for this we use the simple model that changes only the sky radince by the groundReflectance
        inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;

        // Calculate average ambient radiance - this is used int the gamut mapping part to deduce the black level that is soft compressed
        inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);
        `),g.code.add(k.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${2===f.pbrMode?k.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:k.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.EvaluateAmbientLighting=function(a,r){a=a.fragment;const l=void 0!==r.lightingSphericalHarmonicsOrder?r.lightingSphericalHarmonicsOrder:2;0===l?(a.uniforms.add("lightingAmbientSH0","vec3"),a.code.add(k.glsl`
      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
        vec3 ambientLight = 0.282095 * lightingAmbientSH0;
        return ambientLight * (1.0 - ambientOcclusion);
      }
    `)):1===l?(a.uniforms.add("lightingAmbientSH_R","vec4"),a.uniforms.add("lightingAmbientSH_G","vec4"),a.uniforms.add("lightingAmbientSH_B","vec4"),a.code.add(k.glsl`
      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
        vec4 sh0 = vec4(
          0.282095,
          0.488603 * normal.x,
          0.488603 * normal.z,
          0.488603 * normal.y
        );
        vec3 ambientLight = vec3(
          dot(lightingAmbientSH_R, sh0),
          dot(lightingAmbientSH_G, sh0),
          dot(lightingAmbientSH_B, sh0)
        );
        return ambientLight * (1.0 - ambientOcclusion);
      }
    `)):2===l&&(a.uniforms.add("lightingAmbientSH0","vec3"),a.uniforms.add("lightingAmbientSH_R1","vec4"),a.uniforms.add("lightingAmbientSH_G1","vec4"),a.uniforms.add("lightingAmbientSH_B1","vec4"),a.uniforms.add("lightingAmbientSH_R2","vec4"),a.uniforms.add("lightingAmbientSH_G2","vec4"),a.uniforms.add("lightingAmbientSH_B2","vec4"),a.code.add(k.glsl`
      vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
        vec3 ambientLight = 0.282095 * lightingAmbientSH0;

        vec4 sh1 = vec4(
          0.488603 * normal.x,
          0.488603 * normal.z,
          0.488603 * normal.y,
          1.092548 * normal.x * normal.y
        );
        vec4 sh2 = vec4(
          1.092548 * normal.y * normal.z,
          0.315392 * (3.0 * normal.z * normal.z - 1.0),
          1.092548 * normal.x * normal.z,
          0.546274 * (normal.x * normal.x - normal.y * normal.y)
        );
        ambientLight += vec3(
          dot(lightingAmbientSH_R1, sh1),
          dot(lightingAmbientSH_G1, sh1),
          dot(lightingAmbientSH_B1, sh1)
        );
        ambientLight += vec3(
          dot(lightingAmbientSH_R2, sh2),
          dot(lightingAmbientSH_G2, sh2),
          dot(lightingAmbientSH_B2, sh2)
        );
        return ambientLight * (1.0 - ambientOcclusion);
      }
    `),1!==r.pbrMode&&2!==r.pbrMode||a.code.add(k.glsl`
        const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);

        vec3 calculateAmbientRadiance(float ambientOcclusion)
        {
          vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
          return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
        }
      `))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateMainLighting.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.EvaluateMainLighting=function(a){a=a.fragment;a.uniforms.add("lightingMainDirection","vec3");a.uniforms.add("lightingMainIntensity","vec3");a.uniforms.add("lightingFixedFactor","float");a.code.add(k.glsl`
    vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
      float dotVal = clamp(-dot(normal_global, lightingMainDirection), 0.0, 1.0);

      // move lighting towards (1.0, 1.0, 1.0) if requested
      dotVal = mix(dotVal, 1.0, lightingFixedFactor);

      return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.Normals=function(a,r){a=a.fragment;a.code.add(k.glsl`
    struct ShadingNormalParameters {
      vec3 normalView;
      vec3 viewDirection;
    } shadingParams;
    `);1===r.doubleSidedMode?a.code.add(k.glsl`
      vec3 shadingNormal(ShadingNormalParameters params) {
        return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
      }
    `):2===r.doubleSidedMode?a.code.add(k.glsl`
      vec3 shadingNormal(ShadingNormalParameters params) {
        return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
      }
    `):a.code.add(k.glsl`
      vec3 shadingNormal(ShadingNormalParameters params) {
        return normalize(params.normalView);
      }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl":function(){define(["exports","../../../../../../core/has","../../shaderModules/interfaces"],function(b,k,a){b.HeaderComment=function(r,l){a.glsl`
  /*
  *  ${l.name}
  *  ${0===l.output?"RenderOutput: Color":1===l.output?"RenderOutput: Depth":3===l.output?"RenderOutput: Shadow":2===l.output?"RenderOutput: Normal":4===l.output?"RenderOutput: Highlight":""}
  */
  `};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../shaderModules/interfaces","./ColorConversion.glsl"],function(b,k,a){b.MixExternalColor=function(r){r.include(a.ColorConversion);r.code.add(k.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${k.glsl.int(1)}) {
        return allMixed;
      }
      else if (mode == ${k.glsl.int(2)}) {
        return internalMixed;
      }
      else if (mode == ${k.glsl.int(3)}) {
        return externalColor;
      }
      else {
        // tint (or something invalid)
        float vIn = rgb2v(internalMixed);
        vec3 hsvTint = rgb2hsv(externalColor);
        vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
        return hsv2rgb(hsvOut);
      }
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${k.glsl.int(2)}) {
        return internalMixed;
      }
      else if (mode == ${k.glsl.int(3)}) {
        return externalOpacity;
      }
      else {
        // multiply or tint (or something invalid)
        return allMixed;
      }
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../core/shaderLibrary/util/DoublePrecision.glsl ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),function(b,k,a,r,l,h,d,c,e){c=function(f){function g(){return f.apply(this,
arguments)||this}a._inheritsLoose(g,f);g.prototype.initializeProgram=function(p){var n=g.shader.get();const w=this.configuration;n=n.build({OITEnabled:0===w.transparencyPassType,output:w.output,viewingMode:p.viewingMode,receiveShadows:w.receiveShadows,slicePlaneEnabled:w.slicePlaneEnabled,sliceHighlightDisabled:w.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,symbolColor:w.symbolColors,vvSize:w.vvSize,vvColor:w.vvColor,vvInstancingEnabled:!0,instanced:w.instanced,instancedColor:w.instancedColor,
instancedDoublePrecision:w.instancedDoublePrecision,useOldSceneLightInterface:!1,pbrMode:w.usePBR?1:0,hasMetalnessAndRoughnessTexture:!1,hasEmissionTexture:!1,hasOcclusionTexture:!1,hasNormalTexture:!1,hasColorTexture:w.hasColorTexture,receiveAmbientOcclusion:w.receiveAmbientOcclusion,useCustomDTRExponentForWater:!1,normalType:0,doubleSidedMode:2,vertexTangets:!1,attributeTextureCoordinates:w.hasColorTexture?1:0,textureAlphaPremultiplied:w.textureAlphaPremultiplied,attributeColor:w.vertexColors,screenSizePerspectiveEnabled:w.screenSizePerspective,
verticalOffsetEnabled:w.verticalOffset,offsetBackfaces:w.offsetBackfaces,doublePrecisionRequiresObfuscation:d.doublePrecisionRequiresObfuscation(p.rctx),alphaDiscardMode:w.alphaDiscardMode,supportsTextureAtlas:!1});return new h(p.rctx,n.generateSource("vertex"),n.generateSource("fragment"),l.Default3D)};return g}(c.DefaultMaterialTechnique);c.shader=new r.ReloadableShaderModule(e.RealisticTreeShader,()=>new Promise(function(f,g){b(["../core/shaderLibrary/default/RealisticTree.glsl"],f,g)}));k.RealisticTreeTechnique=
c;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){function A(D){const E=new r.ShaderBuilder,G=E.vertex.code,H=E.fragment.code;E.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");E.include(v.PositionAttribute);E.varyings.add("vpos","vec3");E.include(h.VisualVariables,D);E.include(n.InstancedDoublePrecision,D);E.include(c.VerticalOffset,D);if(0===D.output||7===D.output)E.include(u.NormalAttribute,D),E.include(a.Transform,{linearDepth:!1}),D.offsetBackfaces&&
E.include(m.Offset),D.instancedColor&&E.attributes.add("instanceColor","vec4"),E.varyings.add("vNormalWorld","vec3"),E.varyings.add("localvpos","vec3"),E.include(w.TextureCoordinateAttribute,D),E.include(g.ForwardLinearDepth,D),E.include(y.SymbolColor,D),E.include(e.VertexColor,D),E.vertex.uniforms.add("externalColor","vec4"),E.varyings.add("vcolorExt","vec4"),G.add(k.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${D.instancedColor?"vcolorExt *\x3d instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${k.glsl.float(d.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          }
          else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${D.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, camPos);":""}
          }
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);7===D.output&&(E.include(l.Slice,D),E.include(d.DiscardOrAdjustAlpha,D),E.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("opacity","float").add("layerOpacity","float"),E.fragment.uniforms.add("view","mat4"),D.hasColorTexture&&E.fragment.uniforms.add("tex","sampler2D"),E.fragment.include(z.MixExternalColor),H.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        ${D.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${D.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:k.glsl`vec4 texColor = vec4(1.0);`}
        ${D.attributeColor?k.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:k.glsl`
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}

        gl_FragColor = vec4(opacity_);
      }
    `));0===D.output&&(E.include(l.Slice,D),E.include(C.EvaluateSceneLighting,D),E.include(x.EvaluateAmbientOcclusion,D),E.include(d.DiscardOrAdjustAlpha,D),D.receiveShadows&&E.include(f.ReadShadowMap,D),E.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("opacity","float").add("layerOpacity","float"),E.fragment.uniforms.add("view","mat4"),D.hasColorTexture&&E.fragment.uniforms.add("tex","sampler2D"),E.include(q.PhysicallyBasedRenderingParameters,
D),E.include(p.PhysicallyBasedRendering,D),E.fragment.include(z.MixExternalColor),H.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        ${D.hasColorTexture?k.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        ${D.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
        discardOrAdjustAlpha(texColor);`:k.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - camPos);
        ${1===D.pbrMode?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${D.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":1===D.viewingMode?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${D.attributeColor?k.glsl`
        vec3 albedo_ = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:k.glsl`
        vec3 albedo_ = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
        float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));
        `}
        ${k.glsl`
        vec3 shadedNormal = normalize(vNormalWorld);
        albedo_ *= 1.2;
        vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
        float alignmentLightView = clamp(dot(-viewForward, lightingMainDirection), 0.0, 1.0);
        float transmittance = 1.0 - clamp(dot(-viewForward, shadedNormal), 0.0, 1.0);
        float treeRadialFalloff = vColor.r;
        float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
        additionalLight += backLightFactor * lightingMainIntensity;`}
        ${1===D.pbrMode||2===D.pbrMode?1===D.viewingMode?k.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:k.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:k.glsl``}
        ${1===D.pbrMode||2===D.pbrMode?k.glsl`
            float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
            vec3 shadedColor = evaluateSceneLightingPBR(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:"vec3 shadedColor \x3d evaluateSceneLighting(shadedNormal, albedo_, shadow, 1.0 - ssao, additionalLight);"}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${D.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));E.include(B.DefaultMaterialAuxiliaryPasses,D);return E}var t=Object.freeze({__proto__:null,build:A});b.RealisticTreeShader=t;b.build=A})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/Error ../../../../core/urlUtils ../../../../core/promiseUtils ../../../../support/arcadeOnDemand ../../../../Color ../../../../symbols/CIMSymbol ../../../../core/screenUtils ../../../../symbols/support/IconSymbol3DLayerResource ../../../../chunks/symbols ../../../../core/asyncUtils ../../../../chunks/vec3f64 ../../../../symbols/support/utils ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/HUDMaterial ./graphicUtils ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ../../webgl-engine/lib/Geometry ./Graphics3DSymbolLayer ./pointUtils ../../terrain/OverlayRenderer ../../../2d/arcade/callExpressionWithFeature ./constants ./Graphics3DDrapedGraphicLayer ./sdfPrimitives ../support/FastSymbolUpdates ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q,F,N,P){function U(aa){return h.isSome(aa)?"cross"===aa||"x"===aa:!1}const V=B.create(),W=u.fromValues(0,0,1),X=[.25,.25,.75,.75];q=function(aa){function ka(fa,ea,Y,Z){fa=aa.call(this,fa,ea,Y,Z)||this;fa._cimLayers=null;fa._cimSymbolMaterials=new Map;fa._cimSymbolTextures=new Map;fa._cimMaterialParametersInfo=null;fa._cimRequiredFields=null;fa._cimScaleFactorOrFunction=null;fa._size=null;fa._symbolTextureRatio=1;fa._outlineSize=
0;fa._texture=null;fa._releaseTexture=null;fa._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return fa}a._inheritsLoose(ka,aa);var da=ka.prototype;da.getCachedSize=function(){return{size:this._getIconSize()}};da.doLoad=async function(fa){this._validateOrThrow();const ea=this._prepareMaterialParameters();var Y=this._getPrimitive();if(h.isSome(Y))this._prepareResourcesPrimitive(ea,Y);else{Y=v.getIconHref(this.symbol,this.symbolLayer);const Z=c.dataComponents(Y);Z&&"application/json"===
Z.mediaType?await this._prepareResourcesCIM(ea,JSON.parse(Z.data),fa):await this._prepareResourcesHref(ea,Y,fa)}};da._validateOrThrow=function(){if(!this._drivenProperties.size){var fa=D.validateSymbolLayerSize(this._getIconSize());if(fa)throw new d("graphics3diconsymbollayer:invalid-size",fa);}};da._getIconSize=function(){var fa=this.symbolLayer;fa=Math.round(null!=fa.size?n.pt2px(fa.size):16);return this._drivenProperties.size?Math.max(fa,64):fa};da._generateTextureCIM=function(fa){const ea=this._getGraphicHash(fa);
let Y=""===ea?null:this._cimSymbolTextures.get(ea);Y||(fa=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,fa,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,null),this._cimMaterialParametersInfo.anchorPos=this._getAnchorPos("relative",fa.anchorPosition),Y=new P(fa.imageData,"symbol",{width:fa.imageData.width,height:fa.imageData.height,powerOfTwoResizeMode:2}),this._cimSymbolTextures.set(ea,Y),this._context.stage.add(4,Y));return Y};da._computeSize=
function(fa,ea){fa=fa.width/fa.height;return 1<fa?[ea,Math.round(ea/fa)]:[Math.round(ea*fa),ea]};da._prepareMaterialParameters=function(){const fa={anchorPos:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},ea=this.symbol;if(ea&&"point-3d"===ea.type&&ea.hasVisibleVerticalOffset()){const {screenLength:Y,minWorldLength:Z,maxWorldLength:ba}=ea.verticalOffset;fa.verticalOffset={screenLength:n.pt2px(Y),minWorldLength:Z||0,maxWorldLength:null!=ba?ba:Infinity}}this._context.screenSizePerspectiveEnabled&&
(fa.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);fa.occlusionTest=!0;fa.slicePlaneEnabled=this._context.slicePlaneEnabled;return fa};da._prepareResourcesPrimitive=function(fa,ea){var Y=this._getOutlineSize();if(U(ea)&&0===Y)throw Error("Nothing to render");this._outlineSize=Y;fa.color=this._getFillColor();fa.outlineColor=this._getOutlineColor();fa.outlineSize=this._outlineSize;const Z=this._context.sharedResources.textures.fromData(ea,()=>{switch(ea){case "circle":var ba=
Q.createCircle(128,64);break;case "square":ba=Q.createSquare(128,64);break;case "kite":ba=Q.createKite(128,64);break;case "cross":ba=Q.createCross(128,64);break;case "x":ba=Q.createX(128,64);break;case "triangle":ba=Q.createTriangle(128,64)}return ba=new P(ba,"sdf_"+ea,{mipmap:!1,wrap:{s:33071,t:33071},width:128,height:128,components:4,noUnpackFlip:!0})});this._texture=Z.texture;this._releaseTexture=()=>this._context.sharedResources.textures.release(Z.uid);fa.textureIsSignedDistanceField=!0;fa.distanceFieldBoundingBox=
X;fa.textureId=this._texture.id;Y=this._getIconSize();this._size=[Y,Y];this._symbolTextureRatio=2;this._createMaterialAndAddToStage(fa,this._context.stage)};da._prepareResourcesHref=async function(fa,ea,Y){if(!r("esri-canvas-svg-support")&&c.isSVG(ea))throw new d("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize();fa.color=this._getFillColor();fa.outlineColor=this._getOutlineColor();
fa.outlineSize=this._outlineSize;fa.textureIsSignedDistanceField=!1;const Z=this._getIconSize();Y=await m.result(this._context.sharedResources.textures.fromUrl(ea,Z*this._context.layerView.view.pixelRatio,{signal:Y}));if(!1===Y.ok)throw e.throwIfAbortError(Y.error),new d("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${ea})`);const {uid:ba,texture:ia}=Y.value;this._releaseTexture=()=>this._context.sharedResources.textures.release(ba);this._size=this._computeSize(ia.params,
Z);fa.textureId=ia.id;this._createMaterialAndAddToStage(fa,this._context.stage)};da._prepareResourcesCIM=async function(fa,ea,Y){ea=new p({data:ea});if(!this._context.sharedResources.cimSymbolRasterizer){var Z=(await new Promise(function(la,qa){b(["../../../../symbols/cim/CIMSymbolRasterizer"],la,qa)})).CIMSymbolRasterizer;e.throwIfAborted(Y);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new Z(this._context.renderCoordsHelper.spatialReference,
!0))}Z=this._context.layer.fields?this._context.layer.fields.map(la=>la.toJSON()):null;this._cimLayers=await this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(ea,Z,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:Y});let ba;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(ea=this._context.renderer,isNaN(ea.scaleExpression)){const la=await f.createRendererExpression(ea.scaleExpression,
this._context.layer.spatialReference,Z);ba=(qa,na,oa)=>{qa=M(la,qa,{$view:oa},"esriGeometryPoint",na);return null!==qa?qa:1}}else var ia=Number(ea.scaleExpression);this._cimScaleFactorOrFunction=ia||ba||1;ia=this._context.renderer?await this._context.renderer.getRequiredFields(this._context.layer.fields):[];e.throwIfAborted(Y);const ja=this._context.layer.fieldsIndex;this._cimRequiredFields=ia.map(la=>ja.get(la).name);this._cimMaterialParametersInfo=fa;this._cimMaterialParametersInfo.color=this._getFillColor();
this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1};da._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||w.defaultPrimitive};da._getOutlineSize=function(){var fa=0;fa=this.symbolLayer;if(h.isSome(fa.outline)&&null!=fa.outline.size)return Math.max(n.pt2px(fa.outline.size),0);fa=
this._getPrimitive();fa=U(fa)?1.5:0;return Math.max(fa,0)};da._getOutlineColor=function(){const fa=this._getLayerOpacity(),ea=h.get(this.symbolLayer,"outline","color");if(h.isSome(ea)){const Y=g.toUnitRGB(ea);return[Y[0],Y[1],Y[2],ea.a*fa]}return[0,0,0,0]};da._getFillColor=function(){if(U(this._getPrimitive()))return T.TRANSPARENT_UNIT;const fa=h.isNone(this._getPrimitive()),ea=h.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(ea,{hasIntrinsicColor:fa})};da._getAnchorPos=
function(fa,ea){return"relative"===fa?x.fromValues((ea.x||0)+.5,-(ea.y||0)+.5):fa in D.namedAnchorToHUDMaterialAnchorPos?D.namedAnchorToHUDMaterialAnchorPos[fa]:D.namedAnchorToHUDMaterialAnchorPos.center};da._createMaterialAndAddToStage=function(fa,ea){this._fastUpdates=this._cimLayers?{enabled:!1}:F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&l.mixin(fa,this._fastUpdates.materialParameters);if(this._cimLayers){let Y=this._cimSymbolMaterials.get(fa.textureId);
Y||(Y=new t.HUDMaterial(fa,this._getIdHint("_icon")),this._cimSymbolMaterials.set(fa.textureId,Y),ea.add(3,Y));return Y}this._material=new t.HUDMaterial(fa,this._getIdHint("_icon"));ea.add(3,this._material);return this._material};da._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(fa=>{fa.setParameterValues({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,slicePlaneEnabled:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};
da.destroy=function(){aa.prototype.destroy.call(this);this._forEachMaterial(fa=>{this._context.stage.remove(3,fa.id)});h.isSome(this._material)&&(this._material=null);this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(fa=>{this._context.stage.remove(4,fa.id)});this._cimSymbolTextures.clear();this._releaseTexture&&(this._releaseTexture(),this._releaseTexture=null)};da._getScaleFactor=function(fa,ea){if(this._drivenProperties.size&&fa.size){for(let Y=0;3>Y;Y++){const Z=fa.size[Y];Z&&"symbol-value"!==
Z&&"proportional"!==Z&&(fa.size[Y]=n.pt2px(Z))}if("symbol-value"===fa.size[0])return 1;if(isFinite(+fa.size[0]))return+fa.size[0]/ea;if(isFinite(+fa.size[2]))return+fa.size[2]/ea}return 1};da.createGraphics3DGraphic=function(fa){var ea=fa.renderingInfo;const Y=fa.graphic;let Z;if(this._cimLayers){if(!this._cimLayers.length)return null;var ba=this._generateTextureCIM(Y);Z=this._createMaterialAndAddToStage({textureId:ba.id,...this._cimMaterialParametersInfo},this._context.stage);var ia=[ba.params.width,
ba.params.height]}else ia=this._size,Z=h.unwrap(this._material);if(!this._validateGeometry(Y.geometry))return null;ba=L.placePointOnGeometry(Y.geometry);if(h.isNone(ba))return this.logger.warn(`unsupported geometry type for icon symbol: ${Y.geometry.type}`),null;const ja="graphic"+Y.uid,la=this._getVertexOpacityAndColor(ea);let qa=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(qa=this._getScaleFactor(ea,ia[0]>ia[1]?ia[0]:ia[1]));qa*=this._symbolTextureRatio;ea=[ia[0]*qa,ia[1]*
qa];ia=this.setGraphicElevationContext(Y,new H.ElevationContext);this.ensureDrapedStatus("on-the-ground"===ia.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(Y,ba,Z,la,ea,fa.layer.uid):this._createAs3DShape(Y,ba,Z,la,ea,ia,ja,Y.uid)};da.layerOpacityChanged=function(){const fa=this._getFillColor(),ea=this._getOutlineColor();this._forEachMaterial(Y=>{Y.setParameterValues({color:fa});Y.setParameterValues({outlineColor:ea})});return!0};da.layerElevationInfoChanged=
function(fa,ea,Y){const Z=this._elevationContext.mode;Y=E.elevationModeChangeUpdateType(ka.elevationModeChangeTypes,Y,Z);if(Y!==E.SymbolUpdateType.UPDATE)return Y;const ba=E.needsElevationUpdates2D(Z)||"absolute-height"===Z;return this.updateGraphics3DGraphicElevationInfo(fa,ea,()=>ba)};da.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(fa=>{fa.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});return!0};da.physicalBasedRenderingChanged=function(){return!0};
da.pixelRatioChanged=function(){return this._getPrimitive()?!0:!1};da.applyRendererDiff=function(fa,ea){for(const Y in fa.diff)switch(Y){case "visualVariables":if(F.updateFastSymbolUpdatesState(this._fastUpdates,ea,this._fastVisualVariableConvertOptions()))h.isSome(this._material)&&this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};da._defaultElevationInfoNoZ=function(){return ca};da._createAs3DShape=function(fa,ea,Y,Z,ba,ia,ja,la){const qa=
this.getFastUpdateAttrValues(fa);fa=qa?oa=>F.evaluateModelTransform(this._fastUpdates.materialParameters,qa,oa):null;Z=A.createPointGeometry(W,null,Z,ba,R,null,qa);Z=[new J(Z,ja)];ja=L.createStageObjectForHUD(this._context,ea,Z,[Y],null,null,ia,ja,this._context.layer.uid,la,fa);if(null===ja)return null;const na=new I(this,ja.object,Z,null,null,G.perObjectElevationAligner,ia);na.alignedSampledElevation=ja.sampledElevation;na.needsElevationUpdates=E.needsElevationUpdates2D(ia.mode)||"absolute-height"===
ia.mode;na.getScreenSize=this._createScreenSizeGetter(ba,fa);na.calculateRelativeScreenBounds=oa=>Y.calculateRelativeScreenBounds(na.getScreenSize(),1,oa);L.extendPointGraphicElevationContext(na,ea,this._context.elevationProvider);return na};da._createAsOverlay=function(fa,ea,Y,Z,ba,ia){Y.renderPriority=this._renderPriority;const ja=u.create();y.projectPointToVector(ea,ja,this._context.overlaySR);ja[2]=S.DRAPED_Z;ea=this._context.clippingExtent;if(h.isSome(ea)&&!z.containsPoint(ea,ja))return null;
const la=this.getFastUpdateAttrValues(fa);ea=la?na=>F.evaluateModelTransform(this._fastUpdates.materialParameters,la,na):null;Z=A.createPointGeometry(W,ja,Z,ba,null,null,la);Z=new N(Z);Z.material=Y;Z.center=ja;Z.bsRadius=0;Z.data.layerUid=ia;Z.data.graphicUid=fa.uid;Z.calculateShaderTransformation=ea;const qa=new O(this,[Z],null);qa.getScreenSize=this._createScreenSizeGetter(ba,ea);qa.calculateRelativeScreenBounds=na=>Y.calculateRelativeScreenBounds(qa.getScreenSize(),1,na);return qa};da._createScreenSizeGetter=
function(fa,ea){const Y=this._outlineSize+2;if(this._fastUpdates.enabled){const Z=fa[0]/this._symbolTextureRatio,ba=fa[1]/this._symbolTextureRatio;return(ia=x.create())=>{const ja=ea(V);ia[0]=ja[0]*Z+Y;ia[1]=ja[5]*ba+Y;return ia}}{const Z=fa[0]/this._symbolTextureRatio+Y,ba=fa[1]/this._symbolTextureRatio+Y;return(ia=x.create())=>{ia[0]=Z;ia[1]=ba;return ia}}};da._fastVisualVariableConvertOptions=function(){var fa=this._size[0]>this._size[1]?this._size[0]:this._size[1];const ea=u.fromValues(fa,fa,
fa),Y=n.px2pt(1);fa*=Y;fa=u.fromValues(fa,fa,fa);return{modelSize:ea,symbolSize:fa,unitInMeters:Y,transformation:{anchor:u.ZEROS,scale:u.ONES,rotation:u.ZEROS}}};da._getGraphicHash=function(fa){let ea="";for(const Y of this._cimRequiredFields)ea+=Y+fa.attributes[Y];return ea};da._forEachMaterial=function(fa){h.isSome(this._material)&&fa(this._material);this._cimSymbolMaterials.forEach(fa)};return ka}(K.Graphics3DSymbolLayer);q.PRIMITIVE_SIZE=[64,64];q.elevationModeChangeTypes={definedChanged:E.SymbolUpdateType.UPDATE,
staysOnTheGround:E.SymbolUpdateType.NONE,onTheGroundChanged:E.SymbolUpdateType.RECREATE};const ca={mode:"relative-to-ground",offset:0},R=C.fromValues(0,0,0,1);k.Graphics3DIconSymbolLayer=q;k.default=q;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/symbols/support/utils":function(){define("require exports ../../core/has ../../core/maybe ../../Color ../../core/screenUtils ./Symbol3DMaterial ../../chunks/symbols ../../core/asyncUtils ../../chunks/vec3f64 ./gfxUtils".split(" "),function(b,
k,a,r,l,h,d,c,e,f,g){function p(z,A){if(null==A)return z;z=z.toRgba();z[3]*=A;return new l(z)}function n(z,A,t){if(z=z.symbolLayers){var D=E=>{E=r.isSome(E)?E:null;A=A||E||null!=t&&C;return p(A,t)};z.forEach(E=>{if("object"!==E.type||null==E.resource.href||A)if("water"===E.type)E.color=D(E.color);else{var G=r.isSome(E.material)?E.material.color:null;G=D(G);r.isNone(E.material)?E.material=new d["default"]({color:G}):E.material.color=G;null!=t&&"outline"in E&&r.isSome(E.outline)&&r.isSome(E.outline.color)&&
(E.outline.color=p(E.outline.color,t))}})}}async function w(z,A){(z=z.symbolLayers)&&await e.forEach(z,async t=>q(t,A))}async function q(z,A){switch(z.type){case "extrude":z.size="number"===typeof A[2]?A[2]:0;break;case "icon":case "line":case "text":A=m(A);r.isSome(A)&&(z.size=A);break;case "path":{const t=v(A,f.ONES,[z.width,void 0,z.height]);z.width=B(A[0],z.width,1,t);z.height=B(A[2],z.height,1,t)}break;case "object":await u(z,A)}}function m(z){for(const A of z)if("number"===typeof A)return A;
return null}async function u(z,A){const {resourceSize:t,symbolSize:D}=await y(z),E=v(A,t,D);z.width=B(A[0],D[0],t[0],E);z.depth=B(A[1],D[1],t[1],E);z.height=B(A[2],D[2],t[2],E)}function v(z,A,t){for(let D=0;3>D;D++){const E=z[D];switch(E){case "symbol-value":return null!=t[D]?t[D]/A[D]:1;case "proportional":break;default:if(E&&A[D])return E/A[D]}}return 1}async function y(z){const A=await (await new Promise(function(I,J){b(["./symbolLayerUtils"],I,J)})).computeObjectLayerResourceSize(z,10),{width:t,
height:D,depth:E}=z;z=[t,E,D];let G=1;for(var H=0;3>H;H++)if(null!=z[H]){G=z[H]/A[H];break}for(H=0;3>H;H++)null==z[H]&&(z[H]=A[H]*G);return{resourceSize:A,symbolSize:z}}function B(z,A,t,D){switch(z){case "proportional":return t*D;case "symbol-value":return null!=A?A:t;default:return z}}const x=/\/resource\/(.*?)\.svg$/,C=new l("white");k.applyColorToSymbol=function(z,A,t){if(z&&(A||null!=t))if(A&&(A=new l(A)),c.isSymbol3D(z))n(z,A,t);else if(c.isSymbol2D(z)){if(A=A||z.color)z.color=p(A,t);null!=t&&
"outline"in z&&z.outline&&z.outline.color&&(z.outline.color=p(z.outline.color,t))}};k.applyOpacityToColor=p;k.applyRotationToSymbol=function(z,A,t){z&&null!=A&&(c.isSymbol3D(z)?(z=z.symbolLayers)&&z.forEach(D=>{if(D&&"object"===D.type)switch(t){case "tilt":D.tilt=A;break;case "roll":D.roll=A;break;default:D.heading=A}}):!c.isSymbol2D(z)||"simple-marker"!==z.type&&"picture-marker"!==z.type&&"text"!==z.type||(z.angle=A))};k.applySizesToSymbol=async function(z,A){if(z&&A){if(c.isSymbol3D(z))return w(z,
A);if(c.isSymbol2D(z)&&(A=m(A),!r.isNone(A)))switch(z.type){case "simple-marker":z.size=A;break;case "picture-marker":{const t=z.width/z.height;1<t?(z.width=A,z.height=A*t):(z.width=A*t,z.height=A);break}case "simple-line":z.width=A;break;case "text":z.font.size=A}}};k.getIconHref=function(z,A){A=A.resource.href;return!a("esri-canvas-svg-support")&&z.styleOrigin&&x.test(A)?A.replace(x,"/resource/png/$1.png"):A};k.getSymbolOutlineSize=function(z){if(!z)return 0;if(c.isSymbol3D(z)){{const A=z.symbolLayers&&
z.symbolLayers.length;A?(z=z.symbolLayers.getItemAt(A-1),z="outline"in z?r.get(z,"outline","size"):void 0):z=void 0}return r.isSome(z)?z:0}return(z=g.getStroke(z))&&h.px2pt(z.width)||0};k.isVolumetricSymbol=function(z){if(!z||!z.symbolLayers)return!1;switch(z.type){case "point-3d":return z.symbolLayers.some(A=>"object"===A.type);case "line-3d":return z.symbolLayers.some(A=>"path"===A.type);case "polygon-3d":return z.symbolLayers.some(A=>"object"===A.type||"extrude"===A.type);default:return!1}};Object.defineProperty(k,
"__esModule",{value:!0})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../core/promiseUtils ../../Color ../../core/screenUtils ../../request ../../assets ../../core/ItemCache ./cimSymbolUtils".split(" "),function(b,k,a,r,l,h,d,c){function e(q){if(!q)return null;let m;switch(q.type){case "simple-fill":case "picture-fill":case "simple-marker":m=e(q.outline);break;case "simple-line":{const u=r.pt2px(q.width);"none"!==q.style&&0!==u&&(m={color:q.color,style:w(q.style),width:u,cap:q.cap,
join:"miter"===q.join?r.pt2px(q.miterLimit):q.join});break}default:m=null}return m}const f=h.getAssetUrl("esri/symbols/patterns/"),g={left:"start",center:"middle",right:"end",justify:"start"},p={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},n=new d(1E3),w=function(){const q={};return function(m){if(q[m])return q[m];const u=m.replace(/-/g,"");return q[m]=u}}();a=new a([128,128,128]);b.defaultThematicColor=a;b.getFill=function(q){const m=q.style;let u=null;
if(q)switch(q.type){case "simple-marker":"cross"!==m&&"x"!==m&&(u=q.color);break;case "simple-fill":"solid"===m?u=q.color:"none"!==m&&(u={type:"pattern",x:0,y:0,src:f+m+".png",width:5,height:5});break;case "picture-fill":u={type:"pattern",src:q.url,width:r.pt2px(q.width)*q.xscale,height:r.pt2px(q.height)*q.yscale,x:r.pt2px(q.xoffset),y:r.pt2px(q.yoffset)};break;case "text":u=q.color;break;case "cim":u=c.getCIMSymbolColor(q)}return u};b.getPatternUrlWithColor=function(q,m){const u=q+"-"+m;return void 0!==
n.get(u)?k.resolve(n.get(u)):l(q,{responseType:"image"}).then(v=>{v=v.data;const y=v.naturalWidth,B=v.naturalHeight,x=document.createElement("canvas");x.width=y;x.height=B;const C=x.getContext("2d");C.fillStyle=m;C.fillRect(0,0,y,B);C.globalCompositeOperation="destination-in";C.drawImage(v,0,0);v=x.toDataURL();n.put(u,v);return v})};b.getSVGAlign=function(q){return q=(q=q.horizontalAlignment)&&g[q.toLowerCase()]||"middle"};b.getSVGBaseline=function(q){return(q=q.verticalAlignment)&&p[q.toLowerCase()]||
"alphabetic"};b.getSVGBaselineShift=function(q){return"bottom"===q.verticalAlignment?"super":null};b.getStroke=e;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/ItemCache":function(){define(["./MemCache"],function(b){return function(){function k(r,l){this._storage=new b.MemCacheStorage;this._storage.maxSize=r;l&&this._storage.registerRemoveFunc("",l)}var a=k.prototype;a.put=function(r,l){this._storage.put(r,l,1,1)};a.pop=function(r){return this._storage.pop(r)};a.get=function(r){return this._storage.get(r)};
a.clear=function(){this._storage.clearAll()};a.destroy=function(){this._storage.clearAll()};return k}()})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(b,k,a){function r(p){p=a.toCIMSymbolJSON(p);if("CIMTextSymbol"===p.type)return p.height;let n=0;if(p.symbolLayers)for(const w of p.symbolLayers)a.isCIMMarker(w)&&w.size>n?n=w.size:a.isCIMStroke(w)&&w.width>n?n=w.width:a.isCIMFill(w);return n}function l(p,n,w,q){if("CIMTextSymbol"===p.type)p.height*=
n;else{if(w&&p.effects)for(const m of p.effects)c(m,n);if(p.symbolLayers)for(const m of p.symbolLayers)switch(m.type){case "CIMPictureMarker":case "CIMVectorMarker":h(m,n,q);break;case "CIMPictureStroke":case "CIMSolidStroke":null!=q&&q.preserveOutlineWidth||(m.width*=n);break;case "CIMPictureFill":m.height*=n;m.offsetX*=n;m.offsetY*=n;break;case "CIMHatchFill":l(m.lineSymbol,n,!0,{...q,preserveOutlineWidth:!1}),m.offsetX*=n,m.offsetY*=n,m.separation*=n}}}function h(p,n,w){p.markerPlacement&&d(p.markerPlacement,
n);p.offsetX*=n;p.offsetY*=n;p.anchorPoint&&"Absolute"===p.anchorPointUnits&&(p.anchorPoint={x:p.anchorPoint.x*n,y:p.anchorPoint.y*n});p.size*=n;if("CIMVectorMarker"===p.type&&p.markerGraphics)for(const q of p.markerGraphics)p.scaleSymbolsProportionally||l(q.symbol,n,!0,w)}function d(p,n){a.isCIMMarkerStrokePlacement(p)&&(p.offset*=n);switch(p.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":p.customEndingOffset*=n;p.offsetAlongLine*=n;if(p.placementTemplate&&
p.placementTemplate.length){var w=p.placementTemplate.map(q=>q*n);p.placementTemplate=w}break;case "CIMMarkerPlacementAlongLineVariableSize":p.maxRandomOffset*=n;p.placementTemplate&&p.placementTemplate.length&&(w=p.placementTemplate.map(q=>q*n),p.placementTemplate=w);break;case "CIMMarkerPlacementOnLine":p.startPointOffset*=n;break;case "CIMMarkerPlacementAtExtremities":p.offsetAlongLine*=n;break;case "CIMMarkerPlacementAtRatioPositions":p.beginPosition*=n;p.endPosition*=n;break;case "CIMMarkerPlacementPolygonCenter":p.offsetX*=
n;p.offsetY*=n;break;case "CIMMarkerPlacementInsidePolygon":p.offsetX*=n,p.offsetY*=n,p.stepX*=n,p.stepY*=n}}function c(p,n){switch(p.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":p.width*=n;break;case "CIMGeometricEffectBuffer":p.size*=n;break;case "CIMGeometricEffectCut":p.beginCut*=n;p.endCut*=n;p.middleCut*=n;break;case "CIMGeometricEffectDashes":p.customEndingOffset*=n;p.offsetAlongLine*=n;if(p.dashTemplate&&p.dashTemplate.length){const w=p.dashTemplate.map(q=>q*n);p.dashTemplate=
w}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":p.length*=n;break;case "CIMGeometricEffectMove":p.offsetX*=n;p.offsetY*=n;break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":p.offset*=n;break;case "CIMGeometricEffectRegularPolygon":p.radius*=n;break;case "CIMGeometricEffectTaperedPolygon":p.fromWidth*=n;p.length*=n;p.toWidth*=n;break;case "CIMGeometricEffectWave":p.amplitude*=n,p.period*=n}}function e(p,n){let w;w="CIMTextSymbol"===
p.type?p.symbol:p;p="CIMPolygonSymbol"===p.type;if(w.symbolLayers)for(const q of w.symbolLayers)if(!(q.colorLocked||p&&(a.isCIMStroke(q)||a.isCIMMarker(q)&&q.markerPlacement&&a.isCIMMarkerStrokePlacement(q.markerPlacement))))switch(q.type){case "CIMVectorMarker":q.markerGraphics.forEach(m=>{e(m.symbol,n)});break;case "CIMSolidStroke":case "CIMSolidFill":f(n,q.color);break;case "CIMHatchFill":e(q.lineSymbol,n)}}function f(p,n){for(const w of p)if(w.join(".")===n.join("."))return;p.push(n)}function g(p,
n){var w="CIMTextSymbol"===p.type?p.symbol:p;p="CIMPolygonSymbol"===p.type?!0:!1;if(w.symbolLayers)for(const q of w.symbolLayers)if(!(q.colorLocked||p&&(a.isCIMStroke(q)||a.isCIMMarker(q)&&q.markerPlacement&&a.isCIMMarkerStrokePlacement(q.markerPlacement))))switch(w=n.toArray(0),q.type){case "CIMVectorMarker":q.markerGraphics.forEach(m=>{g(m.symbol,n)});break;case "CIMSolidStroke":case "CIMSolidFill":q.color=w;break;case "CIMHatchFill":g(q.lineSymbol,n)}}b.applyCIMSymbolColor=function(p,n){n instanceof
k||(n=new k(n));p=a.toCIMSymbolJSON(p);g(p,n)};b.applyCIMSymbolRotation=function(p,n){p=a.toCIMSymbolJSON(p);if("CIMTextSymbol"===p.type)p.angle=n;else if("CIMPointSymbol"===p.type&&p.symbolLayers){const w=n-(p.angle||0);for(const q of p.symbolLayers){if(a.isCIMMarker(q)){let m=q.rotation||0;m=q.rotateClockwise?m-w:m+w;q.rotation=m}p.angle=n}}};b.getCIMSymbolColor=function(p){p=a.toCIMSymbolJSON(p);const n=[];e(p,n);return n.length?new k(a.fromCIMColor(n[0])):null};b.getCIMSymbolRotation=function(p){p=
a.toCIMSymbolJSON(p);return"CIMTextSymbol"===p.type||"CIMPointSymbol"===p.type?p.angle||0:0};b.getCIMSymbolSize=r;b.scaleCIMMarker=h;b.scaleCIMSymbolTo=function(p,n,w){const q=a.toCIMSymbolJSON(p);p=r(p);if(0===p)if("CIMTextSymbol"===q.type)q.height=n;else{if(q.symbolLayers)for(const m of q.symbolLayers)switch(m.type){case "CIMPictureMarker":case "CIMVectorMarker":m.size=n;break;case "CIMPictureStroke":case "CIMSolidStroke":m.width=n}}else l(q,n/p,!1,w)};Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/symbols/cim/utils":function(){define(["exports"],function(b){function k(a,r){"string"!==typeof a&&(a=String(a));switch(r){case "LowerCase":return a.toLowerCase();case "Allcaps":return a.toUpperCase();default:return a}}b._adjustTextCase=k;b.colorToArray=function(a){return[a.r,a.g,a.b,a.a]};b.createLabelOverrideFunction=function(a,r,l){const h=f=>{let g=f.length;for(;g--;)if(-1===" /-,\n".indexOf(f.charAt(g)))return!1;return!0},d=[];var c=0;let e=-1;do e=r.indexOf("[",c),e>=c&&(e>c&&(c=r.substr(c,
e-c),d.push([c,null,h(c)])),c=e+1,e=r.indexOf("]",c),e>=c&&(e>c&&(c=r.substr(c,e-c),(c=a[c])&&d.push([null,c,!1])),c=e+1));while(-1!==e);c<r.length-1&&(a=r.substr(c),d.push([a,null,h(a)]));return f=>{let g="",p=null;for(const n of d){const [w,q,m]=n;if(w)m?p=w:(p&&(g+=p,p=null),g+=w);else{const u=f.attributes[q];u&&(p&&(g+=p,p=null),g+=u)}}return k(g,l)}};b.evaluateValueOrFunction=function(a,r,l,h){return"function"===typeof a?a(r,l,h):a};b.fromCIMColor=function(a){return a?{r:a[0],g:a[1],b:a[2],a:a[3]/
255}:{r:0,g:0,b:0,a:0}};b.isCIMFill=function(a){return"CIMGradientFill"===a.type||"CIMHatchFill"===a.type||"CIMPictureFill"===a.type||"CIMSolidFill"===a.type||"CIMWaterFill"===a.type};b.isCIMMarker=function(a){return"CIMVectorMarker"===a.type||"CIMPictureMarker"===a.type||"CIMBarChartMarker"===a.type||"CIMCharacterMarker"===a.type||"CIMPieChartMarker"===a.type||"CIMStackedBarChartMarker"===a.type};b.isCIMMarkerStrokePlacement=function(a){return"CIMMarkerPlacementAlongLineRandomSize"===a.type||"CIMMarkerPlacementAlongLineSameSize"===
a.type||"CIMMarkerPlacementAlongLineVariableSize"===a.type||"CIMMarkerPlacementAtExtremities"===a.type||"CIMMarkerPlacementAtMeasuredUnits"===a.type||"CIMMarkerPlacementAtRatioPositions"===a.type||"CIMMarkerPlacementOnLine"===a.type||"CIMMarkerPlacementOnVertices"===a.type};b.isCIMStroke=function(a){return"CIMGradientStroke"===a.type||"CIMPictureStroke"===a.type||"CIMSolidStroke"===a.type};b.resampleHermite=function(a,r,l,h,d,c,e=!0){const f=r/d;l/=c;const g=Math.ceil(f/2),p=Math.ceil(l/2);for(let q=
0;q<c;q++)for(let m=0;m<d;m++){const u=4*(m+(e?c-q-1:q)*d);var n=0;let v=0,y=0,B=0,x=0,C=0,z=0;const A=(q+.5)*l;for(let t=Math.floor(q*l);t<(q+1)*l;t++){var w=Math.abs(A-(t+.5))/p;const D=(m+.5)*f;w*=w;for(let E=Math.floor(m*f);E<(m+1)*f;E++){let G=Math.abs(D-(E+.5))/g;n=Math.sqrt(w+G*G);-1<=n&&1>=n&&(n=2*n*n*n-3*n*n+1,0<n&&(G=4*(E+t*r),z+=n*a[G+3],y+=n,255>a[G+3]&&(n=n*a[G+3]/250),B+=n*a[G],x+=n*a[G+1],C+=n*a[G+2],v+=n))}}h[u]=B/v;h[u+1]=x/v;h[u+2]=C/v;h[u+3]=z/y}};b.toCIMSymbolJSON=function(a){var r;
return null==(r=a.data)?void 0:r.symbol};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Logger","../../../core/Error","../../../geometry/support/quantizationUtils"],function(b,k,a){function r(h){const d={};switch(h){case "esriGeometryPoint":return(c,e,f,g)=>a.unquantizePoint(e,d,c,f,g);case "esriGeometryPolygon":return(c,e,f,g)=>a.unquantizePolygon(e,d,c,f,g);case "esriGeometryPolyline":return(c,e,f,g)=>a.unquantizePolyline(e,
d,c,f,g);case "esriGeometryMultipoint":return(c,e,f,g)=>a.unquantizeMultipoint(e,d,c,f,g);default:return b.getLogger("esri.views.2d.support.arcadeOnDemand").error(new k("mapview-arcade",`Unable to handle geometryType: ${h}`)),c=>c}}const l=new Map;return function(h,d,c,e,f){if(h.referencesGeometry()&&f){{const {transform:g,hasZ:p,hasM:n}=f;l.has(e)||l.set(e,r(e));e=l.get(e)(d.geometry,g,p,n);d={...d,geometry:e}}}d=h.repurposeFeature(d);try{return h.evaluate({...c,$feature:d})}catch(g){return b.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",
g),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(b,k){const a=k.ZEROS;k=k.ONES;b.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;b.TRANSPARENT_UNIT=a;b.WHITE_UNIT=k;b.defaultIconElevationOffset=1;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define(["../../../../chunks/vec3f64","../../../../chunks/vec3","../../../../geometry/support/aaBoundingRect","../../../../geometry/support/aaBoundingBox",
"./graphicUtils"],function(b,k,a,r,l){let h=function(){function f(p,n,w){this.graphics3DSymbolLayer=p;this.renderGeometries=n;this.boundingBox=w;this.type="draped";this.stage=null;this._addedToStage=this._visible=!1;this._layerView=null;this.isElevationSource=!1}var g=f.prototype;g.initialize=function(p,n,w){this.stage=p;this._layerView=w;this._overlayRenderer=this._layerView.view.basemapTerrain.overlayManager.renderer};g.setVisibility=function(p){if(null!=this.stage&&this._visible!==p)if((this._visible=
p)&&!this._addedToStage)this._addedToStage=!0,this._overlayRenderer.addGeometries(this.renderGeometries,this._layerView,1);else if(p||this._addedToStage){for(const n of this.renderGeometries)n.instanceParameters.visible=this._visible;this._overlayRenderer.updateGeometries(this.renderGeometries,this._layerView,1)}};g.destroy=function(){this.stage&&this._addedToStage&&this._overlayRenderer.removeGeometries(this.renderGeometries,this._layerView,4);this._visible=this._addedToStage=!1;this.stage=null};
g.getBSRadius=function(){return this.renderGeometries.reduce((p,n)=>Math.max(p,n.bsRadius),0)};g.getCenterObjectSpace=function(p=b.create()){return k.set(p,0,0,0)};g.getBoundingBoxObjectSpace=function(p=r.create()){return r.empty(p)};g.addObjectState=function(p,n){0===p&&(this.renderGeometries.forEach(w=>{const q=w.addHighlight();n.addRenderGeometry(w,q,this)}),this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView))};g.removeObjectState=function(p){this.renderGeometries.forEach(n=>
{p.removeRenderGeometry(n)})};g.removeRenderGeometryObjectState=function(p,n){p.removeHighlight(n);this._addedToStage&&this._overlayRenderer.updateHighlights(this.renderGeometries,this._layerView)};g.computeAttachmentOrigin=function(p){for(const n of this.renderGeometries)n.computeAttachmentOrigin(e)&&(p.draped.origin[0]+=e[0],p.draped.origin[1]+=e[1],p.draped.num++)};g.getProjectedBoundingBox=async function(p,n,w,q,m){r.empty(m);for(let u=0;u<this.renderGeometries.length;u++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[u],
p,d,w),r.expandWithRect(m,d);if(n){r.center(m,e);let u;p=l.demResolutionForBoundingBox(m,n);try{u=await n.service.queryElevation(e[0],e[1],q,p,"ground")}catch(v){u=null}null!=u&&(m[2]=Math.min(m[2],u),m[5]=Math.max(m[5],u))}return m};g._getRenderGeometryProjectedBoundingRect=function(p,n,w,q){if(this.boundingBox)r.set(c,this.boundingBox);else{const m=p.center;p=p.bsRadius;c[0]=m[0]-p;c[1]=m[1]-p;c[2]=m[2]-p;c[3]=m[0]+p;c[4]=m[1]+p;c[5]=m[2]+p}n(c,0,2);this.calculateRelativeScreenBounds&&q.push({location:r.center(c),
screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return r.toRect(c,w)};return f}();const d=a.create(),c=r.create(),e=b.create();return h})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/Util"],function(b,k,a){function r(p,n){const w=new Uint8Array(4*p*p),q=p/2-.5;n/=2;for(let u=0;u<p;u++)for(let v=0;v<p;v++){const y=v+p*u;var m=v-q;const B=u-q;m=Math.sqrt(m*m+B*B)-n;m=m/p+.5;a.packFloatRGBA(m,w,4*y)}return w}
function l(p,n){return f(p,n,!1)}function h(p,n){return f(p,n,!0)}function d(p,n){return g(p,n,!1)}function c(p,n){return g(p,n,!0)}function e(p,n){const w=new Uint8Array(4*p*p),q=Math.sqrt(1.25),m=(p-n)/2;for(let u=0;u<p;u++)for(let v=0;v<p;v++){const y=(v-m)/n,B=(u-m+.75)/n;a.packFloatRGBA(Math.max(-(1*y+-.5*B)/q,(y-1+-.5*-B)/q,-B)*n/p+.5,w,4*(u*p+v))}return w}function f(p,n,w){w&&(n/=Math.SQRT2);const q=new Uint8Array(4*p*p);for(let u=0;u<p;u++)for(let v=0;v<p;v++){var m=v-.5*p+.25;let y=-u+.5*
p-.75;const B=u*p+v;if(w){const x=(m+y)/Math.SQRT2;y=(y-m)/Math.SQRT2;m=x}m=Math.max(Math.abs(m),Math.abs(y))-.5*n;m=m/p+.5;a.packFloatRGBA(m,q,4*B)}return q}function g(p,n,w){w&&(n*=Math.SQRT2);n*=.5;const q=new Uint8Array(4*p*p);for(let u=0;u<p;u++)for(let v=0;v<p;v++){var m=v-.5*p;let y=-u+.5*p-1;const B=u*p+v;if(w){const x=(m+y)/Math.SQRT2;y=(y-m)/Math.SQRT2;m=x}m=Math.abs(m);y=Math.abs(y);m=m>y?m>n?Math.sqrt((m-n)*(m-n)+y*y):y:y>n?Math.sqrt(m*m+(y-n)*(y-n)):m;m=m/p+.5;a.packFloatRGBA(m,q,4*B)}return q}
b.createCircle=r;b.createCross=d;b.createKite=h;b.createSquare=l;b.createTriangle=e;b.createType=function(p,n,w){switch(p){case "circle":return r(n,w);case "square":return l(n,w);case "cross":return d(n,w);case "x":return c(n,w);case "kite":return h(n,w);case "triangle":return e(n,w);default:return r(n,w)}};b.createX=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../renderers/support/lengthUtils ../../../../chunks/mat4 ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/mat3 ../../support/debugFlags".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){function p(J){return null!==J&&void 0!==J}function n(J){return"number"===typeof J}function w(J){return"string"===typeof J}function q(J,K){J&&J.push(K)}function m(J,K,L,S=e.create()){J=J||0;K=K||0;L=L||0;0!==J&&d.rotateZ(S,S,-J/180*Math.PI);0!==K&&d.rotateX(S,S,K/180*Math.PI);0!==L&&d.rotateY(S,S,L/180*Math.PI);return S}function u(J,K,L,S,M){const T=J.minSize,O=J.maxSize;if(J.expression)return q(M,"Could not convert size info: expression not supported"),!1;if(J.useSymbolValue)return J=
S.symbolSize[L],K.minSize[L]=J,K.maxSize[L]=J,K.offset[L]=K.minSize[L],K.factor[L]=0,K.type[L]=1,!0;if(p(J.field)){if(p(J.stops)){if(2===J.stops.length&&n(J.stops[0].size)&&n(J.stops[1].size))return v(J.stops[0].size,J.stops[1].size,J.stops[0].value,J.stops[1].value,K,L),K.type[L]=1,!0;q(M,"Could not convert size info: stops only supported with 2 elements");return!1}if(n(T)&&n(O)&&p(J.minDataValue)&&p(J.maxDataValue))return v(T,O,J.minDataValue,J.maxDataValue,K,L),K.type[L]=1,!0;if(null!=h.meterIn[J.valueUnit])return K.minSize[L]=
-Infinity,K.maxSize[L]=Infinity,K.offset[L]=0,K.factor[L]=1/h.meterIn[J.valueUnit],K.type[L]=1,!0;if("unknown"===J.valueUnit)return q(M,"Could not convert size info: proportional size not supported"),!1;q(M,"Could not convert size info: scale-dependent size not supported");return!1}if(!p(J.field)){if(J.stops&&J.stops[0]&&n(J.stops[0].size))return K.minSize[L]=J.stops[0].size,K.maxSize[L]=J.stops[0].size,K.offset[L]=K.minSize[L],K.factor[L]=0,K.type[L]=1,!0;if(n(T))return K.minSize[L]=T,K.maxSize[L]=
T,K.offset[L]=T,K.factor[L]=0,K.type[L]=1,!0}q(M,"Could not convert size info: unsupported variant of sizeInfo");return!1}function v(J,K,L,S,M,T){S=0<Math.abs(S-L)?(K-J)/(S-L):0;M.minSize[T]=0<S?J:K;M.maxSize[T]=0<S?K:J;M.offset[T]=J-L*S;M.factor[T]=S}function y(J,K,L,S){if(J.normalizationField||J.valueRepresentation)return q(S,"Could not convert size info: unsupported property"),null;var M=J.field;if(null!=M&&!w(M))return q(S,"Could not convert size info: field is not a string"),null;if(!K.size)K.size=
{field:J.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(J.field)if(!K.size.field)K.size.field=J.field;else if(J.field!==K.size.field)return q(S,"Could not convert size info: multiple fields in use"),null;switch(J.axis){case "width":return(M=u(J,K.size,0,L,S))?K:null;case "height":return(M=u(J,K.size,2,L,S))?K:null;case "depth":return(M=u(J,K.size,1,L,S))?K:null;case "width-and-depth":return(M=u(J,K.size,0,L,S))&&u(J,K.size,1,L,S),M?K:null;case null:case void 0:case "all":return(M=
(M=(M=u(J,K.size,0,L,S))&&u(J,K.size,1,L,S))&&u(J,K.size,2,L,S))?K:null;default:return q(S,`Could not convert size info: unknown axis "${J.axis}""`),null}}function B(J,K,L){for(let S=0;3>S;++S){let M=K.unitInMeters;1===J.type[S]&&(M*=K.modelSize[S],J.type[S]=2);J.minSize[S]/=M;J.maxSize[S]/=M;J.offset[S]/=M;J.factor[S]/=M}if(0!==J.type[0])K=0;else if(0!==J.type[1])K=1;else if(0!==J.type[2])K=2;else return q(L,"No size axis contains a valid size or scale"),!1;for(L=0;3>L;++L)0===J.type[L]&&(J.minSize[L]=
J.minSize[K],J.maxSize[L]=J.maxSize[K],J.offset[L]=J.offset[K],J.factor[L]=J.factor[K],J.type[L]=J.type[K]);return!0}function x(J,K,L){J[4*K]=L.r/255;J[4*K+1]=L.g/255;J[4*K+2]=L.b/255;J[4*K+3]=L.a}function C(J,K,L){if(J.normalizationField)return q(L,"Could not convert color info: unsupported property"),null;if(w(J.field))if(J.stops){if(8<J.stops.length)return q(L,"Could not convert color info: too many color stops"),null;K.color={field:J.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};J=J.stops;for(L=0;8>L;++L){const S=J[Math.min(L,J.length-1)];K.color.values[L]=S.value;x(K.color.colors,L,S.color)}}else return q(L,"Could not convert color info: missing stops or colors"),null;else if(J.stops&&0<=J.stops.length)for(J=J.stops&&0<=J.stops.length&&J.stops[0].color,K.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},L=0;8>L;L++)K.color.values[L]=Infinity,x(K.color.colors,
L,J);else return q(L,"Could not convert color info: no field and no colors/stops"),null;return K}function z(J,K,L){if(J.normalizationField)return q(L,"Could not convert opacity info: unsupported property"),null;if(w(J.field))if(J.stops){if(8<J.stops.length)return q(L,"Could not convert opacity info: too many opacity stops"),null;K.opacity={field:J.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};J=J.stops;for(L=0;8>L;++L){const S=J[Math.min(L,J.length-1)];K.opacity.values[L]=S.value;
K.opacity.opacityValues[L]=S.opacity}}else return q(L,"Could not convert opacity info: missing stops or opacities"),null;else if(J.stops&&0<=J.stops.length)for(J=J.stops&&0<=J.stops.length&&J.stops[0].opacity,K.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},L=0;8>L;L++)K.opacity.values[L]=Infinity,K.opacity.opacityValues[L]=J;else return q(L,"Could not convert opacity info: no field and no opacities/stops"),null;return K}function A(J,K,L){J=2===L&&"arithmetic"===J.rotationType;
K.offset[L]=J?90:0;K.factor[L]=J?-1:1;K.type[L]=1}function t(J,K,L){if(!w(J.field))return q(L,"Could not convert rotation info: field is not a string"),null;if(!K.rotation)K.rotation={field:J.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(J.field)if(!K.rotation.field)K.rotation.field=J.field;else if(J.field!==K.rotation.field)return q(L,"Could not convert rotation info: multiple fields in use"),null;switch(J.axis){case "tilt":return A(J,K.rotation,0),K;case "roll":return A(J,K.rotation,
1),K;case null:case void 0:case "heading":return A(J,K.rotation,2),K;default:return q(L,`Could not convert rotation info: unknown axis "${J.axis}""`),null}}function D(J,K,L){if(!J)return null;const S=!K.supportedTypes||!!K.supportedTypes.size,M=!K.supportedTypes||!!K.supportedTypes.color,T=!K.supportedTypes||!!K.supportedTypes.rotation,O=!!K.supportedTypes&&!!K.supportedTypes.opacity,Q=J.reduce((F,N)=>{if(!F)return F;if(N.valueExpression)return q(L,"Could not convert visual variables: arcade expressions not supported"),
null;switch(N.type){case "size":return S?y(N,F,K,L):F;case "color":return M?C(N,F,L):F;case "opacity":return O?z(N,F,L):null;case "rotation":return T?t(N,F,L):F;default:return null}},{size:null,color:null,opacity:null,rotation:null});return 0<J.length&&Q&&!Q.size&&!Q.color&&!Q.opacity&&!Q.rotation||Q&&Q.size&&!B(Q.size,K,L)?null:Q}function E(J,K,L){if(!!J!==!!K||J&&J.field!==K.field)return!1;if(J&&"rotation"===L)for(L=0;3>L;L++)if(J.type[L]!==K.type[L]||J.offset[L]!==K.offset[L]||J.factor[L]!==K.factor[L])return!1;
return!0}function G(J,K){const L={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},S=J&&null!=J.size;J&&J.size?(L.vvSizeEnabled=!0,L.vvSizeMinSize=J.size.minSize,L.vvSizeMaxSize=J.size.maxSize,L.vvSizeOffset=J.size.offset,L.vvSizeFactor=J.size.factor):J&&S&&(L.vvSizeValue=
K.transformation.scale);J&&S&&(L.vvSymbolAnchor=K.transformation.anchor,L.vvSymbolRotationMatrix=c.create(),d.identity(I),m(K.transformation.rotation[2],K.transformation.rotation[0],K.transformation.rotation[1],I),f.fromMat4(L.vvSymbolRotationMatrix,I));J&&J.color&&(L.vvColorEnabled=!0,L.vvColorValues=J.color.values,L.vvColorColors=J.color.colors);J&&J.opacity&&(L.vvOpacityEnabled=!0,L.vvOpacityValues=J.opacity.values,L.vvOpacityOpacities=J.opacity.opacityValues);return L}var H;(function(J){const K=
e.create(),L=r.create();J.evaluateModelTransform=function(S,M,T){if(!S.vvSizeEnabled)return T;d.copy(K,T);T=S.vvSymbolRotationMatrix;d.set(I,T[0],T[1],T[2],0,T[3],T[4],T[5],0,T[6],T[7],T[8],0,0,0,0,1);d.multiply(K,K,I);for(T=0;3>T;++T)L[T]=a.clamp(S.vvSizeOffset[T]+M[0]*S.vvSizeFactor[T],S.vvSizeMinSize[T],S.vvSizeMaxSize[T]);d.scale(K,K,L);d.translate(K,K,S.vvSymbolAnchor);return K};J.evaluateModelTransformScale=function(S,M,T){if(!M.vvSizeEnabled)return l.set(S,1,1,1);for(let O=0;3>O;++O)S[O]=a.clamp(M.vvSizeOffset[O]+
T[0]*M.vvSizeFactor[O],M.vvSizeMinSize[O],M.vvSizeMaxSize[O]);return S}})(H||(H={}));const I=e.create();k=H.evaluateModelTransform;H=H.evaluateModelTransformScale;b.convertVisualVariables=D;b.evaluateModelTransform=k;b.evaluateModelTransformScale=H;b.getMaterialParams=G;b.initFastSymbolUpdatesState=function(J,K){return!J||g.DISABLE_FAST_UPDATES?{enabled:!1}:(J=D(J.visualVariables,K))?{enabled:!0,visualVariables:J,materialParameters:G(J,K),requiresShaderTransformation:J&&null!=J.size}:{enabled:!1}};
b.updateFastSymbolUpdatesState=function(J,K,L){if(!K||!J.enabled)return!1;const S=J.visualVariables;K=D(K.visualVariables,L);if(!(K&&E(S.size,K.size,"size")&&E(S.color,K.color,"color")&&E(S.rotation,K.rotation,"rotation")&&E(S.opacity,K.opacity,"opacity")))return!1;J.visualVariables=K;J.materialParameters=G(K,L);J.requiresShaderTransformation=K&&null!=K.size;return!0};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ./geometryDataUtils ./Util ./Object3DStateSet ../materials/renderers/utils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){return function(){function p(w,q,m,u,v,y,B){this.uniqueName=null;this.shaderTransformationDirty=!0;this.data=w.toRenderData();this.boundingInfo=q;this.material=m;this.origin=null;this.center=a.create();this.bsRadius=0;this.transformation=null;this.calculateShaderTransformation=v;u&&this.updateTransformation(u,y);this.castShadow=B;this.instanceParameters={highlights:null,occludees:null,visible:!0}}var n=p.prototype;n.updateTransformation=function(w,q){this.transformation=
w;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(w,q,this.center)};n.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};n.getBoundingSphere=function(w,q,m){q=q||l.maxScale(w);r.transformMat4(m,this.boundingInfo.getCenter(),w);return this.boundingInfo.getBSRadius()*q};n.getShaderTransformation=function(){if(!this.calculateShaderTransformation)return k.unwrapOr(this.transformation,d.IDENTITY);this.shaderTransformationDirty&&(this.shaderTransformation||
(this.shaderTransformation=d.create()),h.copy(this.shaderTransformation,this.calculateShaderTransformation(k.unwrapOr(this.transformation,d.IDENTITY))),this.shaderTransformationDirty=!1);return this.shaderTransformation};n.computeAttachmentOrigin=function(w){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,w)?(k.isSome(this.transformation)&&r.transformMat4(w,w,this.transformation),!0):!1;const q=this.getIndices(e.VertexAttrConstants.POSITION),m=this.getAttribute(e.VertexAttrConstants.POSITION);
return c.computeAttachmentOriginTriangles(m,q,w)?(k.isSome(this.transformation)&&r.transformMat4(w,w,this.transformation),!0):!1};n.getIndices=function(w){return"indices"in this.data?this.data.indices[w]:null};n.getAttribute=function(w){return"vertexAttr"in this.data?this.data.vertexAttr[w]:null};n.addHighlight=function(){const w=f.generateObject3DStateId(0),q=this.instanceParameters;q.highlights=g.addObject3DStateID(q.highlights,w);return w};n.removeHighlight=function(w){const q=this.instanceParameters;
q.highlights=g.removeObject3DStateID(q.highlights,w)};b._createClass(p,[{key:"hasShaderTransformation",get:function(){return!!this.calculateShaderTransformation}}]);return p}()})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/typedArrayUtil ../../../../core/maybe ../../../../core/Error ../../../../core/urlUtils ../../../../core/promiseUtils ../../../../core/Evented ../../../../core/mathUtils ../../../../support/requestUtils ../../../../support/requestImageUtils ./Util ../../../webgl/Texture ../../../webgl/Util ./glUtil3D ./IdGen ../../../webgl/FramebufferObject ../../../webgl/capabilities/isWebGL2Context ./DDSUtil".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){let B=function(){function x(z,A,t){this.data=z;this.loadingController=this.loadingPromise=this.powerOfTwoStretchInfo=this.glTexture=null;this.events=new c;this.data=z;this.id=x.idGen.gen(A);this.params=t||{};this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.params.wrap=this.params.wrap||{s:10497,t:10497};this.params.powerOfTwoResizeMode=
this.params.powerOfTwoResizeMode||1;this.estimatedTexMemRequired=x.estimateTexMemRequired(this.data,this.params);this.startPreload()}var C=x.prototype;C.startPreload=function(){const z=this.data;r.isNone(z)||(z instanceof HTMLVideoElement?this.startPreloadVideoElement(z):z instanceof HTMLImageElement&&this.startPreloadImageElement(z))};C.startPreloadVideoElement=function(z){h.isBlobProtocol(z.src)||"auto"===z.preload&&z.crossOrigin||(z.preload="auto",z.crossOrigin="anonymous",z.src=z.src)};C.startPreloadImageElement=
function(z){h.isDataProtocol(z.src)||h.isBlobProtocol(z.src)||z.crossOrigin||(z.crossOrigin="anonymous",z.src=z.src)};x.getDataDimensions=function(z){return z instanceof HTMLVideoElement?{width:z.videoWidth,height:z.videoHeight}:z};x.estimateTexMemRequired=function(z,A){if(r.isNone(z))return 0;if(a.isArrayBuffer(z)||a.isUint8Array(z))return z.byteLength;const {width:t,height:D}=z instanceof Image||z instanceof ImageData||z instanceof HTMLCanvasElement||z instanceof HTMLVideoElement?x.getDataDimensions(z):
A;return(A.mipmap?4/3:1)*t*D*(A.components||4)||0};C.dispose=function(){this.data=void 0};C.createDescriptor=function(z){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?9987:9729,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.mipmap&&!this.params.disableAnisotropy?z.parameters.maxMaxAnisotropy:void 0}};C.load=function(z,A){if(r.isSome(this.glTexture))return this.glTexture;
if(r.isSome(this.loadingPromise))return this.loadingPromise;const t=this.data;return r.isNone(t)?(this.glTexture=new n(z,this.createDescriptor(z),null),z.bindTexture(this.glTexture,0),this.glTexture):"string"===typeof t?this.loadFromURL(z,A,t):t instanceof Image?this.loadFromImageElement(z,A,t):t instanceof HTMLVideoElement?this.loadFromVideoElement(z,A,t):t instanceof ImageData||t instanceof HTMLCanvasElement?this.loadFromImage(z,t,A):(a.isArrayBuffer(t)||a.isUint8Array(t))&&this.params.encoding===
x.DDS_ENCODING?this.loadFromDDSData(z,t):a.isUint8Array(t)?this.loadFromPixelData(z,t):a.isArrayBuffer(t)?this.loadFromPixelData(z,new Uint8Array(t)):null};C.frameUpdate=function(z,A,t){if(!(this.data instanceof HTMLVideoElement)||r.isNone(this.glTexture)||2>this.data.readyState||t===this.data.currentTime)return t;if(r.isSome(this.powerOfTwoStretchInfo)){const {framebuffer:D,vao:E,sourceTexture:G}=this.powerOfTwoStretchInfo;G.setData(this.data);this.drawStretchedTexture(z,A,D,E,G,this.glTexture)}else{const {width:D,
height:E}=this.data,{width:G,height:H}=this.glTexture.descriptor;D!==G||E!==H?this.glTexture.updateData(0,0,0,Math.min(D,G),Math.min(E,H),this.data):this.glTexture.setData(this.data)}this.glTexture.descriptor.hasMipmap&&this.glTexture.generateMipmap();return this.data.currentTime};C.loadFromDDSData=function(z,A){this.glTexture=y.createDDSTexture(z,this.createDescriptor(z),A,this.params.mipmap);z.bindTexture(this.glTexture,0);return this.glTexture};C.loadFromPixelData=function(z,A){p.assert(0<this.params.width&&
0<this.params.height);const t=this.createDescriptor(z);t.pixelFormat=1===this.params.components?6409:3===this.params.components?6407:6408;t.width=this.params.width;t.height=this.params.height;this.glTexture=new n(z,t,A);z.bindTexture(this.glTexture,0);return this.glTexture};C.loadAsync=async function(z){const A=d.createAbortController();this.loadingController=A;const t=z(A.signal);this.loadingPromise=t;z=()=>{this.loadingController===A&&(this.loadingController=null);this.loadingPromise===t&&(this.loadingPromise=
null)};t.then(z,z);return t};C.loadFromURL=function(z,A,t){return this.loadAsync(async D=>{D=await g.requestImage(t,{signal:D});return this.loadFromImage(z,D,A)})};C.loadFromImageElement=function(z,A,t){return t.complete?this.loadFromImage(z,t,A):this.loadAsync(async D=>{D=await f.loadImageAsync(t,t.src,!1,D);return this.loadFromImage(z,D,A)})};C.loadFromVideoElement=function(z,A,t){return 2<=t.readyState?this.loadFromImage(z,t,A):this.loadFromVideoElementAsync(z,A,t)};C.loadFromVideoElementAsync=
function(z,A,t){return this.loadAsync(D=>d.create((E,G)=>{const H=()=>{t.removeEventListener("loadeddata",I);t.removeEventListener("error",J);r.isSome(K)&&K.remove()},I=()=>{2<=t.readyState&&(H(),E(this.loadFromImage(z,t,A)))},J=L=>{H();G(L||new l("Failed to load video"))};t.addEventListener("loadeddata",I);t.addEventListener("error",J);const K=d.onAbort(D,()=>J(d.createAbortError()))}))};C.loadFromImage=function(z,A,t){const D=x.getDataDimensions(A);this.params.width=D.width;this.params.height=D.height;
const E=this.createDescriptor(z);E.pixelFormat=3===this.params.components?6407:6408;if(this.requiresPowerOfTwo(z,E)&&(!e.isPowerOfTwo(D.width)||!e.isPowerOfTwo(D.height)))return this.glTexture=this.makePowerOfTwoTexture(z,A,D,E,t),z.bindTexture(this.glTexture,0),this.glTexture;E.width=D.width;E.height=D.height;this.glTexture=new n(z,E,A);z.bindTexture(this.glTexture,0);return this.glTexture};C.requiresPowerOfTwo=function(z,A){const t="number"===typeof A.wrapMode?33071===A.wrapMode:33071===A.wrapMode.s&&
33071===A.wrapMode.t;return!v(z.gl)&&(A.hasMipmap||!t)};C.makePowerOfTwoTexture=function(z,A,t,D,E){const {width:G,height:H}=t;t=e.nextHighestPowerOfTwo(G);const I=e.nextHighestPowerOfTwo(H);D.width=t;D.height=I;let J;switch(this.params.powerOfTwoResizeMode){case 2:D.textureCoordinateScaleFactor=[G/t,H/I];J=new n(z,D);J.updateData(0,0,0,G,H,A);break;case 1:case null:case void 0:J=this.stretchToPowerOfTwo(z,A,D,E);break;default:k.neverReached(this.params.powerOfTwoResizeMode)}D.hasMipmap&&J.generateMipmap();
return J};C.stretchToPowerOfTwo=function(z,A,t,D){const E=new n(z,t),G=new u(z,{colorTarget:0,depthStencilTarget:0},E);A=new n(z,{target:3553,pixelFormat:t.pixelFormat,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!!t.flipped,maxAnisotropy:8,preMultiplyAlpha:t.preMultiplyAlpha},A);t=q.createQuadVAO(z);this.drawStretchedTexture(z,D,G,t,A,E);this.requiresFrameUpdates?this.powerOfTwoStretchInfo={vao:t,sourceTexture:A,framebuffer:G}:(t.dispose(!0),A.dispose(),G.detachColorTexture(),z.bindFramebuffer(null),
G.dispose());return E};C.drawStretchedTexture=function(z,A,t,D,E,G){z.bindFramebuffer(t);t=z.getViewport();z.setViewport(0,0,G.descriptor.width,G.descriptor.height);G=A.program;z.bindProgram(G);G.setUniform4f("color",1,1,1,1);G.setUniform1i("tex",0);z.bindTexture(E,0);z.bindVAO(D);z.setPipelineState(A.pipeline);z.drawArrays(5,0,w.vertexCount(D,"geometry"));z.bindFramebuffer(null);z.setViewport(t.x,t.y,t.width,t.height)};C.unload=function(){if(r.isSome(this.powerOfTwoStretchInfo)){const {framebuffer:z,
vao:A,sourceTexture:t}=this.powerOfTwoStretchInfo;A.dispose(!0);t.dispose();z.dispose();this.powerOfTwoStretchInfo=this.glTexture=null}r.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);if(r.isSome(this.loadingController)){const z=this.loadingController;this.loadingPromise=this.loadingController=null;z.abort()}this.events.emit("unloaded")};b._createClass(x,[{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"requiresFrameUpdates",
get:function(){return this.data instanceof HTMLVideoElement}}]);return x}();B.idGen=new m.IdGen;B.DDS_ENCODING="image/vnd-ms.dds";return B})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports","../../../../core/Logger","../../../../core/mathUtils","../../../webgl/Texture"],function(b,k,a,r){function l(g){return g.charCodeAt(0)+(g.charCodeAt(1)<<8)+(g.charCodeAt(2)<<16)+(g.charCodeAt(3)<<24)}function h(g,p){var n=new Int32Array(g,0,31);if(542327876!==n[0])return d.error("Invalid magic number in DDS header"),
null;if(!(n[20]&4))return d.error("Unsupported format, must contain a FourCC code"),null;var w=n[21];let q;switch(w){case c:w=8;q=33776;break;case e:w=16;q=33778;break;case f:w=16;q=33779;break;default:return d.error("Unsupported FourCC code:",String.fromCharCode(w&255,w>>8&255,w>>16&255,w>>24&255)),null}let m=1,u=n[4],v=n[3];if(0!==(u&3)||0!==(v&3))d.warn("Rounding up compressed texture size to nearest multiple of 4."),u=u+3&-4,v=v+3&-4;const y=u,B=v;n[2]&131072&&!1!==p&&(m=Math.max(1,n[7]));1===
m||a.isPowerOfTwo(u)&&a.isPowerOfTwo(v)||(d.warn("Ignoring mipmaps of non power of two sized compressed texture."),m=1);let x=n[1]+4;const C=[];for(let z=0;z<m;++z)n=(u+3>>2)*(v+3>>2)*w,p=new Uint8Array(g,x,n),C.push(p),x+=n,u=Math.max(1,u>>1),v=Math.max(1,v>>1);return{textureData:{type:"compressed",levels:C},internalFormat:q,width:y,height:B}}const d=k.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),c=l("DXT1"),e=l("DXT3"),f=l("DXT5");b.createDDSTexture=function(g,p,n,w){const {textureData:q,
internalFormat:m,width:u,height:v}=h(n,w);p.samplingMode=1<q.levels.length?9987:9729;p.hasMipmap=1<q.levels.length;p.internalFormat=m;p.width=u;p.height=v;p=new r(g,p,q);g.bindTexture(p,0);return p};b.createDDSTextureData=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Error ../../../../geometry/Extent ../../../../geometry/Polygon ../../../../geometry ../../../../Color ../../../../core/screenUtils ../../../../chunks/mat4f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Object3D ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ../../webgl-engine/lib/Geometry ./Graphics3DSymbolLayer ../../../../renderers/support/renderingInfoUtils ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/materials/lineStippleUtils ./Graphics3DDrapedGraphicLayer ../support/FastSymbolUpdates ../../webgl-engine/lib/RenderGeometry ./lineUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D){d=function(E){function G(I,J,K,L){I=E.call(this,I,J,K,L)||this;I._uniformSize=1;return I}k._inheritsLoose(G,E);var H=G.prototype;H.doLoad=async function(){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?
A.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){const I=null!=this.symbolLayer.size?this.symbolLayer.size:e.px2pt(1);if(0>I)throw new r("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=I}};H.getMaterialParameters=function(I){var J=a.get(this.symbolLayer,"material","color");J=this._getCombinedOpacityAndColor(J);I={width:1,color:J,polygonOffset:!0,join:this.symbolLayer.join||
"miter",cap:this.symbolLayer.cap||"butt",transparent:1>J[3]||this.needsDrivenTransparentPass,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:I,stipplePattern:this.symbolLayer.stipplePattern?C.createStipplePattern(this.symbolLayer.stipplePattern.map(e.pt2px)):null,stippleOffColor:this.symbolLayer.stippleOffColor?c.toUnitRGBA(this.symbolLayer.stippleOffColor):null,stippleIntegerRepeats:!0};this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size&&(I.width=
e.pt2px(1)):(J=null!=this.symbolLayer.size?this.symbolLayer.size:e.px2pt(1),I.width=e.pt2px(J));return this._fastUpdates&&this._fastUpdates.visualVariables?{...I,...this._fastUpdates.materialParameters}:I};H.destroy=function(){E.prototype.destroy.call(this);a.isSome(this._lineMaterial)&&(this._context.stage.remove(3,this._lineMaterial.id),this._lineMaterial=null);a.isSome(this._ringMaterial)&&(this._context.stage.remove(3,this._ringMaterial.id),this._ringMaterial=null)};H.getDrivenSize=function(I){return this._drivenProperties.size&&
I.size?e.pt2px(B.getDriverAxisSizeValueAny(I.size)):1};H.getSizeFeatureAttributeData=function(I){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?y.getAttributeValue(this._fastUpdates.visualVariables.size.field,I):null};H.getDrivenColor=function(I){const J=g.fromValues(1,1,1,1);this._drivenProperties.color&&I.color&&(J[0]=I.color[0],J[1]=I.color[1],J[2]=I.color[2],0<I.color.length&&(J[3]=I.color[3]));this._drivenProperties.opacity&&I.opacity&&(J[3]=I.opacity);return J};H.getColorFeatureAttributeData=
function(I){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?y.getAttributeValue(this._fastUpdates.visualVariables.color.field,I):null};H.getOpacityFeatureAttributeData=function(I){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?y.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,I):null};H.createGraphics3DGraphic=function(I){const J=I.graphic;var K=J.geometry;if(!this._validateGeometryType(J.geometry,G.validGeometryTypes,this.symbolLayer.type)||
!this._validateGeometry(K))return null;K="graphic"+J.uid;const L=this.setGraphicElevationContext(J,new m.ElevationContext);this.ensureDrapedStatus("on-the-ground"===L.mode);return this.draped?this._createAsOverlay(I,this._context.layer.uid):this._createAs3DShape(I,L,K,J.uid)};H.applyRendererDiff=function(I,J){for(const K in I.diff)switch(K){case "visualVariables":if(A.updateFastSymbolUpdatesState(this._fastUpdates,J,this._vvConvertOptions))a.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues(this._fastUpdates.materialParameters),
a.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};H.layerOpacityChanged=function(){a.isSome(this._lineMaterial)&&this.updateMaterialLayerOpacity(this._lineMaterial);a.isSome(this._ringMaterial)&&this.updateMaterialLayerOpacity(this._ringMaterial);return!0};H.updateMaterialLayerOpacity=function(I){const J=I.params.color;var K=a.get(this.symbolLayer,"material","color");K=this._getCombinedOpacity(K);
I.setParameterValues({color:[J[0],J[1],J[2],K],transparent:1>K||this.needsDrivenTransparentPass})};H.layerElevationInfoChanged=function(I,J,K){const L=this._elevationContext.mode;K=w.elevationModeChangeUpdateType(G.elevationModeChangeTypes,K,L);if(K!==w.SymbolUpdateType.UPDATE)return K;const S=w.needsElevationUpdates2D(L);return this.updateGraphics3DGraphicElevationInfo(I,J,()=>S)};H.slicePlaneEnabledChanged=function(){a.isSome(this._lineMaterial)&&this._lineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
a.isSome(this._ringMaterial)&&this._ringMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};H.physicalBasedRenderingChanged=function(){return!0};H.pixelRatioChanged=function(){return!0};H._getGeometryAsPolygonOrPolyline=function(I){switch(I.type){case "extent":if(I instanceof l)return h.fromExtent(I);break;case "polygon":case "polyline":return I}return null};H._createAs3DShape=function(I,J,K,L){const S=this._getGeometryAsPolygonOrPolyline(I.graphic.geometry);
var M="polygon"===S.type?S.rings:S.paths,T=[];const O=[],Q=[],F=p.create(),N=D.geometryToRenderInfo(S,this._context.elevationProvider,this._context.renderCoordsHelper,J);this._logGeometryCreationWarnings(N,M,"polygon"===S.type?"rings":"paths","LineSymbol3DLayer");for(M=0;M<N.lines.length;M++){const {position:U,mapPosition:V}=N.lines[M];if(a.isSome(this._context.clippingExtent)&&(p.empty(F),p.expandWithBuffer(F,V),!p.intersectsClippingArea(F,this._context.clippingExtent)))continue;var P=this._createGeometryData(I,
U,V,S.type);P=new v(P,K+"path"+M);T.push(P);O.push("polygon"===S.type?this.ringMaterial:this.lineMaterial);Q.push(f.IDENTITY)}if(0===T.length)return null;I=new n({geometries:T,materials:O,transformations:Q,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:L},idHint:K});T=new u(this,I,T,null,null,q.perVertexElevationAligner,J);T.alignedSampledElevation=N.sampledElevation;T.needsElevationUpdates=w.needsElevationUpdates2D(J.mode);return T};H._createGeometryData=function(I,J,K,L){const S=
this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;return D.createGeometryData({removeDuplicateStartEnd:"polygon"===L?1:0,uniformSize:this._uniformSize,attributeData:{position:J,mapPosition:K,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this.getDrivenSize(I.renderingInfo),color:S?null:this.getDrivenColor(I.renderingInfo),sizeFeature:this.getSizeFeatureAttributeData(I.graphic),colorFeature:this.getColorFeatureAttributeData(I.graphic),opacityFeature:this.getOpacityFeatureAttributeData(I.graphic)}})};
H._createAsOverlay=function(I,J){const K=I.graphic,L=this._getGeometryAsPolygonOrPolyline(K.geometry);var S="polygon"===L.type?L.rings:L.paths;const M="polygon"===L.type?this.ringMaterial:this.lineMaterial;M.renderPriority=this._renderPriority;const T=[],O=p.create(),Q=p.empty();var F=D.geometryToRenderInfoDraped(L,this._context.overlaySR);this._logGeometryCreationWarnings(F,S,"polygon"===L.type?"rings":"paths","LineSymbol3DLayer");if(0<S.length){({lines:S}=F);for(F=0;F<S.length;++F){var N=S[F];p.empty(O);
p.expandWithBuffer(O,N.position);p.intersectsClippingArea(O,this._context.clippingExtent)&&(p.expandWithAABB(Q,O),N=this._createGeometryData(I,N.position,null,L.type),N=new t(N),N.data.layerUid=J,N.data.graphicUid=K.uid,N.material=M,N.center=[.5*(O[0]+O[3]),.5*(O[1]+O[4]),0],N.bsRadius=.5*Math.sqrt((O[3]-O[0])*(O[3]-O[0])+(O[4]-O[1])*(O[4]-O[1])),T.push(N))}return new z(this,T,Q)}return null};k._createClass(G,[{key:"lineMaterial",get:function(){a.isNone(this._lineMaterial)&&(this._lineMaterial=new x.RibbonLineMaterial(this.getMaterialParameters(!1),
this._getIdHint("_ribbonlinemat")),this._context.stage.add(3,this._lineMaterial));return this._lineMaterial}},{key:"ringMaterial",get:function(){a.isNone(this._ringMaterial)&&(this._ringMaterial=new x.RibbonLineMaterial(this.getMaterialParameters(!0),this._getIdHint("_ribbonlinemat")),this._context.stage.add(3,this._ringMaterial));return this._ringMaterial}}]);return G}(y.Graphics3DSymbolLayer);d.validGeometryTypes=["polyline","polygon","extent"];d.elevationModeChangeTypes={definedChanged:w.SymbolUpdateType.RECREATE,
staysOnTheGround:w.SymbolUpdateType.NONE,onTheGroundChanged:w.SymbolUpdateType.RECREATE};b.Graphics3DLineSymbolLayer=d;b.default=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/lineUtils":function(){define("exports ../../../../core/typedArrayUtil ../../../../core/maybe ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ../../webgl-engine/lib/GeometryData ./elevationAlignmentUtils ../../webgl-engine/shaders/RibbonLineTechnique ../../terrain/OverlayRenderer ./constants".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){function w(v,y,B){const x=[];for(const {index:C,count:z}of v){if(1>=z)continue;v=3*C;const A=v+3*z;x.push({position:y.subarray(v,A),mapPosition:B?B.subarray(v,A):void 0})}return x}const q=l.create(),m=l.create(),u=4/Math.PI;b.createGeometryData=function(v){const y={},B={};{const {attributeData:{position:D},removeDuplicateStartEnd:E}=v;var x=D.length;var C=(x=D[0]===D[x-3]&&D[1]===D[x-2]&&D[2]===D[x-1])&&1===E;x=D.length/3-(C?1:0);var z=new Uint32Array(2*(x-1));
C=C?k.slice(D,0,D.length-3):D;var A=0;for(var t=0;t<x-1;t++)z[A++]=t,z[A++]=t+1;B[g.RibbonVertexAttributeConstants.POSITION]={size:3,data:C,offsetIdx:0,strideIdx:3};y[g.RibbonVertexAttributeConstants.POSITION]=z}x=new Uint32Array(y[g.RibbonVertexAttributeConstants.POSITION].length);z=v.attributeData.mapPosition;a.isNone(z)||(y.mapPos=y[g.RibbonVertexAttributeConstants.POSITION],B.mapPos={size:3,data:z,offsetIdx:0,strideIdx:3});a.isSome(v.attributeData.colorFeature)||(B[g.RibbonVertexAttributeConstants.COLOR]=
{size:4,data:a.unwrapOr(v.attributeData.color,n.WHITE_UNIT),offsetIdx:0,strideIdx:4},y[g.RibbonVertexAttributeConstants.COLOR]=x);a.isSome(v.attributeData.sizeFeature)||(B[g.RibbonVertexAttributeConstants.SIZE]={size:1,data:new Float32Array([a.unwrapOr(v.attributeData.size,1)]),offsetIdx:0,strideIdx:1},y[g.RibbonVertexAttributeConstants.SIZE]=x);z=v.attributeData.colorFeature;a.isNone(z)||(B[g.RibbonVertexAttributeConstants.COLORFEATUREATTRIBUTE]={size:1,data:new Float32Array([z]),offsetIdx:0,strideIdx:1},
y[g.RibbonVertexAttributeConstants.COLOR]=x);z=v.attributeData.sizeFeature;a.isNone(z)||(B[g.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]={size:1,data:new Float32Array([z]),offsetIdx:0,strideIdx:1},y[g.RibbonVertexAttributeConstants.SIZEFEATUREATTRIBUTE]=x);z=v.attributeData.opacityFeature;a.isNone(z)||(B[g.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]={size:1,data:new Float32Array([z]),offsetIdx:0,strideIdx:1},y[g.RibbonVertexAttributeConstants.OPACITYFEATUREATTRIBUTE]=x);if("round"===
v.join){x=B[g.RibbonVertexAttributeConstants.POSITION].data;z=x.length/3;C=new Float32Array(z);h.set(q,0,0,0);v=a.unwrapOr(v.uniformSize,1);for(A=-1;A<z;++A){t=0>A?z+A:A;const D=(A+1)%z;h.set(m,x[3*D]-x[3*t],x[3*D+1]-x[3*t+1],x[3*D+2]-x[3*t+2]);h.normalize(m,m);0<=A&&(t=(Math.PI-r.acosClamped(h.dot(q,m)))*u*(1.863798+-2.0062872/Math.pow(1+v/18.2313,.8856294)),C[A]=Math.max(Math.floor(t),0));h.scale(q,m,-1)}B[g.RibbonVertexAttributeConstants.SUBDIVISIONS]={size:1,data:C,offsetIdx:0,strideIdx:1};y[g.RibbonVertexAttributeConstants.SUBDIVISIONS]=
y[g.RibbonVertexAttributeConstants.POSITION]}return new e.GeometryData(B,y,"line")};b.geometryToRenderInfo=function(v,y,B,x){const {position:C,outlines:z}=c.pathsToTriangulationInfo("polygon"===v.type?v.rings:v.paths,v.hasZ,"polygon"===v.type?1:0),A=new Float64Array(C.length);v=f.applyPerVertexElevationAlignment(C,v.spatialReference,0,A,0,C,0,C.length/3,y,B,x);y=null!=v;return{lines:y?w(z,C,A):[],projectionSuccess:y,sampledElevation:v}};b.geometryToRenderInfoDraped=function(v,y){const {position:B,
outlines:x}=c.pathsToTriangulationInfo("polygon"===v.type?v.rings:v.paths,!1,"polygon"===v.type?1:0);v=d.projectBuffer(B,v.spatialReference,0,B,y,0,B.length/3);for(y=2;y<B.length;y+=3)B[y]=p.DRAPED_Z;return{lines:v?w(x,B):[],projectionSuccess:v}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../Color ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/projection ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/vec4f64 ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/MeshComponent ../../../../chunks/mat3 ../../../../geometry/support/meshUtils/projection ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Util ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../support/debugFlags ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ../../webgl-engine/lib/Geometry ../support/edgeUtils ./Graphics3DSymbolLayer ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/lib/Texture ../support/symbolColorUtils ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K){const L=v.VertexAttrConstants;a=function(V){function W(ca,R,aa,ka){ca=V.call(this,ca,R,aa,ka)||this;ca._materials=new Map;ca._textures=new Map;ca.ensureDrapedStatus(!1);return ca}k._inheritsLoose(W,V);var X=W.prototype;X.doLoad=async function(){x.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new K.NativeLineMaterial({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new K.NativeLineMaterial({color:[0,
1,1,1]},"debugFAceNormal"))};X.destroy=function(){V.prototype.destroy.call(this);this._materials.forEach(ca=>{this._context.stage.remove(3,ca.material.id)});this._textures.forEach(ca=>{this._context.stage.remove(4,ca.id)});this._materials.clear();this._textures.clear()};X.createGraphics3DGraphic=function(ca){const R=ca.graphic;if(!this._validateGeometryType(R.geometry,W.validGeometryTypes,"fill on mesh-3d")||!this._validateGeometry(R.geometry))return null;const aa="graphic"+R.uid,ka=this.setGraphicElevationContext(R,
new A.ElevationContext);return this._createAs3DShape(R,ca.renderingInfo,ka,aa,R.uid)};X.layerOpacityChanged=function(ca,R){const aa=this._getLayerOpacity();this._materials.forEach(ka=>{ka.material.setParameterValues({layerOpacity:aa});const da=ka.material.params;this._setMaterialTransparentParameter(da,ka);ka.material.setParameterValues({transparent:da.transparent})});ca.forEach(ka=>{ka=R(ka);r.isSome(ka)&&ka.layerOpacityChanged(aa,this._context.isAsync)});return!0};X.layerElevationInfoChanged=function(ca,
R){return this.updateGraphics3DGraphicElevationInfo(ca,R,C.needsElevationUpdates3D)};X.slicePlaneEnabledChanged=function(ca,R){this._materials.forEach(aa=>{aa.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});ca.forEach(aa=>{aa=R(aa);r.isSome(aa)&&aa.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};X.physicalBasedRenderingChanged=function(){this._materials.forEach(ca=>{const {isSchematic:R}=ca.material.params;ca.material.setParameterValues({usePBR:this._usePBR(R)})});
return!0};X.pixelRatioChanged=function(){return!0};X._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};X._colorOrTextureUid=function(ca){return ca?ca instanceof l?ca.toHex():ca.contentHash:"-"};X._materialPropertiesDefault=function(ca,R){const aa=this._requiresSymbolVertexColors(),ka=!!ca.vertexAttributes.color;ca=!!ca.vertexAttributes.tangent;return{hasSymbolVertexColors:aa,hasVertexColors:ka,hasVertexTangents:ca,uid:`vc:${ka},vt:${ca},vct${R},svc:${aa}`}};
X._materialProperties=function(ca,R,aa){ca=this._materialPropertiesDefault(ca,aa);if(!R.material)return ca;const {color:ka,colorTexture:da,normalTexture:fa,doubleSided:ea,alphaCutoff:Y,alphaMode:Z}=R.material;aa=this._colorOrTextureUid(ka);var ba=this._colorOrTextureUid(da),ia=this._colorOrTextureUid(fa);ca.color=ka;ca.colorTexture=da;ca.normalTexture=fa;ca.uid=`${ca.uid},cmuid:${aa},ctmuid:${ba},ntmuid:${ia},ds:${ea},ac:${Y},am:${Z}`;if(R.material instanceof n){const {metallic:ja,roughness:la,metallicRoughnessTexture:qa,
emissiveColor:na,emissiveTexture:oa,occlusionTexture:ua}=R.material;R=this._colorOrTextureUid(qa);aa=this._colorOrTextureUid(na);ba=this._colorOrTextureUid(oa);ia=this._colorOrTextureUid(ua);ca.metallic=ja;ca.roughness=la;ca.metallicRoughnessTexture=qa;ca.emissiveColor=na;ca.emissiveTexture=oa;ca.occlusionTexture=ua;ca.uid=`${ca.uid},mrm:${ja},mrr:${la},mrt:${R},emuid:${aa},etmuid:${ba},otmuid:${ia}`}return ca};X._setInternalColorValueParameters=function(ca,R){R.diffuse=l.toUnitRGB(ca);R.opacity=
ca.a};X._getLoadableTextureResource=function(ca){return ca.data?ca.data:ca.url};X._getInternalTextureId=function(ca,R){const aa=this._getLoadableTextureResource(ca);if(aa){var ka=ca.contentHash,da=this._textures.get(ka);da||(da=new I(aa,`${R}_${ka}_tex`,{mipmap:!0,wrap:this._castTextureWrap(ca.wrap),noUnpackFlip:!0,preMultiplyAlpha:!0}),this._textures.set(ka,da),this._context.stage.add(4,da));return da.id}};X._castTextureWrap=function(ca="repeat"){return"string"===typeof ca?(ca=this._castTextureWrapIndividual(ca),
{s:ca,t:ca}):{s:this._castTextureWrapIndividual(ca.horizontal),t:this._castTextureWrapIndividual(ca.vertical)}};X._castTextureWrapIndividual=function(ca){switch(ca){case "clamp":return 33071;case "mirror":return 33648;default:return 10497}};X._setInternalMaterialParameters=function(ca,R,aa){ca.color&&this._setInternalColorValueParameters(ca.color,aa);ca.colorTexture&&(aa.textureId=this._getInternalTextureId(ca.colorTexture,R));ca.normalTexture&&(aa.normalTextureId=this._getInternalTextureId(ca.normalTexture,
R));ca.emissiveColor&&(aa.emissiveFactor=l.toUnitRGB(ca.emissiveColor));ca.emissiveTexture&&(aa.emissiveTextureId=this._getInternalTextureId(ca.emissiveTexture,R));ca.occlusionTexture&&(aa.occlusionTextureId=this._getInternalTextureId(ca.occlusionTexture,R));ca.metallicRoughnessTexture&&(aa.metallicRoughnessTextureId=this._getInternalTextureId(ca.metallicRoughnessTexture,R))};X._setExternalMaterialParameters=function(ca){var R=this._drivenProperties.color;let aa=r.isSome(this.symbolLayer.material)?
this.symbolLayer.material.colorMixMode:null;R?ca.externalColor=p.ONES:(R=r.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,r.isSome(R)?ca.externalColor=l.toUnitRGBA(R):(aa=null,ca.externalColor=p.ONES));aa&&(ca.colorMixMode=aa);ca.castShadows=!!this.symbolLayer.castShadows};X._hasTransparentVertexColors=function(ca){ca=ca.vertexAttributes.color;if(!ca)return!1;for(let R=3;R<ca.length;R+=4)if(255!==ca[R])return!0;return!1};X._getOrCreateMaterial=function(ca,R){var aa=R.material&&
R.material.color,ka=R.material&&R.material.colorTexture,da=R.material&&"blend"===R.material.alphaMode;aa=!(R.material&&"opaque"===R.material.alphaMode)&&(this._hasTransparentVertexColors(ca)||aa&&1>aa.a||ka&&ka.transparent||da);ca=this._materialProperties(ca,R,aa);if(ka=this._materials.get(ca.uid))return ka.material;aa={material:null,isComponentTransparent:aa,alphaMode:R.material?R.material.alphaMode:"opaque"};ka=this._getIdHint();da=null==ca.metallicRoughnessTexture&&null==ca.metallic&&null==ca.roughness;
const fa={usePBR:this._usePBR(da),isSchematic:da,vertexColors:ca.hasVertexColors,symbolColors:ca.hasSymbolVertexColors,vertexTangents:ca.hasVertexTangents,ambient:h.ZEROS,diffuse:h.ONES,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:0,textureAlphaPremultiplied:!0,layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,initTextureTransparent:!0};da||(fa.mrrFactors=[null!=ca.metallic?ca.metallic:1,null!=ca.roughness?ca.roughness:1,.5]);R.material&&(fa.doubleSided=
R.material.doubleSided,fa.cullFace=R.material.doubleSided?0:2,fa.textureAlphaCutoff=R.material.alphaCutoff);this._setInternalMaterialParameters(ca,ka,fa);this._setExternalMaterialParameters(fa);this._setMaterialTransparentParameter(fa,aa);R=new H.DefaultMaterial(fa,`${ka}_${ca.uid}_mat`);aa.material=R;this._materials.set(ca.uid,aa);this._context.stage.add(3,R);return R};X._usePBR=function(ca){return ca?this._context.physicalBasedRenderingEnabled:!0};X._setMaterialTransparentParameter=function(ca,
R){ca.transparent=this.needsDrivenTransparentPass||R.isComponentTransparent||1>ca.layerOpacity||1>ca.opacity||ca.externalColor&&1>ca.externalColor[3];ca.textureAlphaMode="auto"===R.alphaMode?ca.transparent?3:1:"opaque"===R.alphaMode?1:"mask"===R.alphaMode?2:0};X._addDebugNormals=function(ca,R,aa,ka){var da=R.length,fa=ca.spatialReference.isGeographic?20015077/180:1;const ea=.1*Math.max(ca.extent.width*fa,ca.extent.height*fa,ca.extent.zmax-ca.extent.zmin),Y=[];var Z=[];fa=[];ca=[];for(let na=0;na<
da;na++){var ba=R[na],ia=ba.data.getAttribute(L.POSITION),ja=ba.data.getAttribute(L.NORMAL);const oa=ba.data.getIndices(L.POSITION);ba=ba.data.getIndices(L.NORMAL);ia=ia.data;ja=ja.data;for(let ua=0;ua<oa.length;ua++){var la=3*oa[ua];const za=3*ba[ua];for(var qa=0;3>qa;qa++)Y.push(ia[la+qa]);for(qa=0;3>qa;qa++)Y.push(ia[la+qa]+ja[za+qa]*ea);Z.push(Z.length);Z.push(Z.length);if(0===ua%3){this._calculateFaceNormal(ia,oa,ua,Q);this._getFaceVertices(ia,oa,ua,M,T,O);d.add(M,M,T);d.add(M,M,O);d.scale(M,
M,1/3);for(la=0;3>la;la++)fa.push(M[la]);for(la=0;3>la;la++)fa.push(M[la]+Q[la]*ea);ca.push(ca.length);ca.push(ca.length)}}}da={[L.POSITION]:{data:new Float64Array(Y),size:3}};Z={[L.POSITION]:new Uint32Array(Z)};da=new y.GeometryData(da,Z,"line");da=new D(da,"debugVertexNormal");R.push(da);aa.push(this._debugVertexNormalMaterial);ka.push(g.clone(ka[0]));fa={[L.POSITION]:{data:new Float64Array(fa),size:3}};ca={[L.POSITION]:new Uint32Array(ca)};ca=new y.GeometryData(fa,ca,"line");ca=new D(ca,"debugFaceNormal");
R.push(ca);aa.push(this._debugFaceNormalMaterial);ka.push(g.clone(ka[0]))};X._createAs3DShape=function(ca,R,aa,ka,da){ca=ca.geometry;if("mesh"!==ca.type)return null;R=this._createGeometryInfo(ca,R,ka);if(!R)return null;const {geometries:fa,materials:ea,transformations:Y,objectTransformation:Z}=R;x.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(ca,fa,ea,Y);da=new B({geometries:fa,materials:ea,transformations:Y,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:da},idHint:ka});da.objectTransformation=
Z;ka=z.perObjectElevationAligner;R=this._createEdgeMaterial();R=r.isSome(R)?{baseMaterial:ea[0],edgeMaterials:[R],properties:{mergeGeometries:!0,slicePlaneEnabled:this._context.slicePlaneEnabled}}:null;da=new t(this,da,fa,null,null,ka,aa,R);da.needsElevationUpdates=C.needsElevationUpdates3D(aa.mode);aa=ca.extent.center.clone();aa.z=0;da.elevationContext.centerPointInElevationSR=aa;da.alignedSampledElevation=ka(da,da.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);
return da};X._createComponentNormals=function(ca,R,aa,ka){switch(aa.shading||"flat"){case "source":return this._createComponentNormalsSource(ca,R,aa,ka);case "flat":return this._createComponentNormalsFlat(ca,ka);case "smooth":return this._createComponentNormalsSmooth(ca,ka)}};X._createComponentNormalsSource=function(ca,R,aa,ka){if(!R)return this._createComponentNormalsFlat(ca,ka);let da=!1;if(!aa.trustSourceNormals)for(aa=0;aa<ka.length;aa+=3){this._calculateFaceNormal(ca,ka,aa,Q);for(let fa=0;3>
fa;fa++){const ea=3*ka[aa+fa];M[0]=R[ea+0];M[1]=R[ea+1];M[2]=R[ea+2];0>d.dot(Q,M)&&(R[ea+0]=-R[ea+0],R[ea+1]=-R[ea+1],R[ea+2]=-R[ea+2],da=!0)}}return{normals:R,indices:ka,didFlipNormals:da}};X._createComponentNormalsFlat=function(ca,R){const aa=new Float32Array(R.length),ka=new Uint32Array(3*R.length);for(let da=0;da<R.length;da+=3){const fa=this._calculateFaceNormal(ca,R,da,Q);for(let ea=0;3>ea;ea++)aa[da+ea]=fa[ea],ka[da+ea]=da/3}return{normals:aa,indices:ka,didFlipNormals:!1}};X._createComponentNormalsSmooth=
function(ca,R){const aa={};for(var ka=0;ka<R.length;ka+=3){var da=this._calculateFaceNormal(ca,R,ka,Q);for(var fa=0;3>fa;fa++){var ea=R[ka+fa];let Y=aa[ea];Y||(Y={normal:h.create(),count:0},aa[ea]=Y);d.add(Y.normal,Y.normal,da);Y.count++}}ca=new Float32Array(3*R.length);ka=new Uint32Array(3*R.length);for(da=0;da<R.length;da++){fa=aa[R[da]];1!==fa.count&&(d.normalize(fa.normal,fa.normal),fa.count=1);for(ea=0;3>ea;ea++)ca[3*da+ea]=fa.normal[ea];ka[da]=da}return{normals:ca,indices:ka,didFlipNormals:!1}};
X._getFaceVertices=function(ca,R,aa,ka,da,fa){const ea=3*R[aa+0],Y=3*R[aa+1];R=3*R[aa+2];ka[0]=ca[ea+0];ka[1]=ca[ea+1];ka[2]=ca[ea+2];da[0]=ca[Y+0];da[1]=ca[Y+1];da[2]=ca[Y+2];fa[0]=ca[R+0];fa[1]=ca[R+1];fa[2]=ca[R+2]};X._calculateFaceNormal=function(ca,R,aa,ka){this._getFaceVertices(ca,R,aa,M,T,O);d.subtract(T,T,M);d.subtract(O,O,M);d.cross(M,T,O);d.normalize(ka,M);return ka};X._getOrCreateComponents=function(ca){return ca.components?ca.components:U};X._createPositionBuffer=function(ca){const R=
ca.vertexAttributes.position,aa=new Float64Array(R.length);e.projectBuffer(ca.vertexAttributes.position,ca.spatialReference,0,aa,this._context.renderCoordsHelper.spatialReference,0,R.length/3);return aa};X._createNormalBuffer=function(ca,R){const aa=ca.vertexAttributes.normal;if(!aa)return null;if("local"===this._context.layerView.view.viewingMode)return aa;const ka=ca.vertexAttributes.position,da=new Float32Array(aa.length);return m.projectNormalToECEF(aa,ka,R,ca.spatialReference,da)};X._createTangentBuffer=
function(ca,R){const aa=ca.vertexAttributes.tangent;if(!aa)return null;if("local"===this._context.layerView.view.viewingMode)return aa;const ka=ca.vertexAttributes.position,da=new Float32Array(aa.length);return m.projectTangentToECEF(aa,ka,R,ca.spatialReference,da)};X._createColorBuffer=function(ca){return ca.vertexAttributes.color};X._createSymbolColorBuffer=function(ca){if(this._requiresSymbolVertexColors()){ca=this._getVertexOpacityAndColor(ca);const R=J.parseColorMixMode(r.get(this.symbolLayer,
"material","colorMixMode")),aa=new Uint8Array(4);J.encodeSymbolColor(ca,R,aa);return aa}return null};X._createColorIndices=function(ca){ca=new Uint32Array(ca.length);for(let R=0;R<ca.length;R++)ca[R]=0;return ca};X._createBuffers=function(ca,R){var aa=ca.vertexAttributes&&ca.vertexAttributes.position;if(!aa)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var ka=ca.vertexAttributes.normal;const da=ca.vertexAttributes.uv;var fa=ca.vertexAttributes.tangent;if(ka&&
ka.length!==aa.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(fa&&fa.length/4!==aa.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(da&&da.length/2!==aa.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;aa=this._createPositionBuffer(ca);ka=this._createColorBuffer(ca);
R=this._createSymbolColorBuffer(R);fa=this._createNormalBuffer(ca,aa);const ea=this._createTangentBuffer(ca,aa);ca=this._transformCenterLocal(ca,aa,fa);return{positionBuffer:aa,normalBuffer:fa,tangentBuffer:ea,uvBuffer:da,colorBuffer:ka,symbolColorBuffer:R,objectTransformation:ca}};X._transformCenterLocal=function(ca,R,aa){var ka=ca.extent.center;const da=this._context.renderCoordsHelper.spatialReference;S[0]=ka.x;S[1]=ka.y;S[2]=0;ka=g.create();e.computeLinearTransformation(ca.spatialReference,S,
ka,da);c.invert(F,ka);for(ca=0;ca<R.length;ca+=3)M[0]=R[ca+0],M[1]=R[ca+1],M[2]=R[ca+2],d.transformMat4(M,M,F),R[ca+0]=M[0],R[ca+1]=M[1],R[ca+2]=M[2];if(aa)for(q.fromMat4(N,ka),q.transpose(N,N),R=0;R<aa.length;R+=3)M[0]=aa[R+0],M[1]=aa[R+1],M[2]=aa[R+2],d.transformMat3(M,M,N),aa[R+0]=M[0],aa[R+1]=M[1],aa[R+2]=M[2];return ka};X._validateFaces=function(ca,R){ca=ca.vertexAttributes.position.length/3;if(R=R.faces){let aa=-1;for(let ka=0;ka<R.length;ka++){const da=R[ka];da>aa&&(aa=da)}if(ca<=aa)return this.logger.warn(`Vertex index ${aa} is out of bounds of the mesh position buffer`),
!1}else if(0!==ca%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};X._getOrCreateFaces=function(ca,R){if(R.faces)return R.faces;ca=new Uint32Array(ca.vertexAttributes.position.length/3);for(R=0;R<ca.length;R++)ca[R]=R;return ca};X._isOutsideClippingArea=function(ca){if(!this._context.clippingExtent)return!1;var R=ca.vertexAttributes&&ca.vertexAttributes.position;if(!R)return!1;
const aa=this._context.elevationProvider.spatialReference,ka=R.length/3;ca.spatialReference.equals(aa)||(R=new Float64Array(R.length),e.projectBuffer(ca.vertexAttributes.position,ca.spatialReference,0,R,aa,0,ka));u.empty(P);u.expandWithBuffer(P,R,0,ka);return!u.intersectsClippingArea(P,this._context.clippingExtent)};X._createGeometryInfo=function(ca,R,aa){if(!e.canProjectWithoutEngine(ca.spatialReference,this._context.layerView.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),
null;if(this._isOutsideClippingArea(ca))return null;R=this._createBuffers(ca,R);if(!R)return null;const {positionBuffer:ka,uvBuffer:da,colorBuffer:fa,symbolColorBuffer:ea,normalBuffer:Y,tangentBuffer:Z,objectTransformation:ba}=R;var ia=this._getOrCreateComponents(ca);R=[];const ja=[],la=[];let qa=!1;for(const oa of ia){if(!this._validateFaces(ca,oa))return null;ia=this._getOrCreateFaces(ca,oa);if(0===ia.length)continue;var na=this._createComponentNormals(ka,Y,oa,ia);na.didFlipNormals&&(qa=!0);const ua=
{[L.POSITION]:{size:3,data:ka},[L.NORMAL]:{size:3,data:na.normals}};na={[L.POSITION]:ia,[L.NORMAL]:na.indices};fa&&(ua[L.COLOR]={size:4,data:fa},na[L.COLOR]=ia);ea&&(ua[L.SYMBOLCOLOR]={size:4,data:ea},na[L.SYMBOLCOLOR]=this._createColorIndices(ia));ca.vertexAttributes.uv&&(ua[L.UV0]={size:2,data:da},na[L.UV0]=ia);ca.vertexAttributes.tangent&&(ua[L.TANGENT]={size:4,data:Z},na[L.TANGENT]=ia);ia=new y.GeometryData(ua,na);ia=new D(ia,`${aa}_mesh`);R.push(ia);ja.push(g.create());la.push(this._getOrCreateMaterial(ca,
oa))}qa&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:R,transformations:ja,materials:la,objectTransformation:ba}};X._createEdgeMaterial=function(){const ca={opacity:this._getLayerOpacity()};return E.createMaterial(this.symbolLayer,ca)};return W}(G.Graphics3DSymbolLayer);a.validGeometryTypes=["mesh"];const S=h.create(),M=h.create(),
T=h.create(),O=h.create(),Q=h.create(),F=g.create(),N=f.create(),P=u.create(),U=[new w];b.Graphics3DMeshFillSymbolLayer=a;b.default=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../Color ./MeshTexture ./MeshMaterial".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){var m;a=m=function(u){function v(B){B=u.call(this,B)||this;B.emissiveColor=null;B.emissiveTexture=null;B.occlusionTexture=null;B.metallic=1;B.roughness=1;B.metallicRoughnessTexture=null;return B}b._inheritsLoose(v,u);var y=v.prototype;y.clone=function(){return this.cloneWithDeduplication(null,new Map)};y.cloneWithDeduplication=function(B,x){const C=r.isSome(B)?B.get(this):null;if(C)return C;x=new m(this.clonePropertiesWithDeduplication(x));r.isSome(B)&&B.set(this,
x);return x};y.clonePropertiesWithDeduplication=function(B){return{...u.prototype.clonePropertiesWithDeduplication.call(this,B),emissiveColor:this.emissiveColor?this.emissiveColor.clone():null,emissiveTexture:this.emissiveTexture?this.emissiveTexture.cloneWithDeduplication(B):null,occlusionTexture:this.occlusionTexture?this.occlusionTexture.cloneWithDeduplication(B):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:this.metallicRoughnessTexture?this.metallicRoughnessTexture.cloneWithDeduplication(B):
null}};return v}(q);k.__decorate([d.property({type:n,json:{write:!0}})],a.prototype,"emissiveColor",void 0);k.__decorate([d.property({type:w,json:{write:!0}})],a.prototype,"emissiveTexture",void 0);k.__decorate([d.property({type:w,json:{write:!0}})],a.prototype,"occlusionTexture",void 0);k.__decorate([d.property({type:Number,json:{write:!0},range:{min:0,max:1}})],a.prototype,"metallic",void 0);k.__decorate([d.property({type:Number,json:{write:!0},range:{min:0,max:1}})],a.prototype,"roughness",void 0);
k.__decorate([d.property({type:w,json:{write:!0}})],a.prototype,"metallicRoughnessTexture",void 0);return a=m=k.__decorate([e.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],a)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../chunks/persistableUrlUtils ../../core/JSONSupport ../../views/support/screenshotUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){var u;const v=new WeakMap;let y=0;a=u=function(B){function x(z){z=B.call(this,z)||this;z.wrap="repeat";return z}b._inheritsLoose(x,B);var C=x.prototype;C.writeData=function(z,A,t,D){z instanceof HTMLImageElement?(z={type:"image-element",src:w.toJSON(z.src,D),crossOrigin:z.crossOrigin},A[t]=z):z instanceof HTMLCanvasElement?(z=z.getContext("2d").getImageData(0,0,z.width,z.height),z={type:"canvas-element",imageData:this.encodeImageData(z)},A[t]=z):z instanceof
HTMLVideoElement?(z={type:"video-element",src:w.toJSON(z.src,D),autoplay:z.autoplay,loop:z.loop,muted:z.muted,crossOrigin:z.crossOrigin,preload:z.preload},A[t]=z):(z={type:"image-data",imageData:this.encodeImageData(z)},A[t]=z)};C.readData=function(z){switch(z.type){case "image-element":var A=new Image;A.src=z.src;A.crossOrigin=z.crossOrigin;return A;case "canvas-element":return z=this.decodeImageData(z.imageData),A=document.createElement("canvas"),A.width=z.width,A.height=z.height,A.getContext("2d").putImageData(z,
0,0),A;case "image-data":return this.decodeImageData(z.imageData);case "video-element":return A=document.createElement("video"),A.src=z.src,A.crossOrigin=z.crossOrigin,A.autoplay=z.autoplay,A.loop=z.loop,A.muted=z.muted,A.preload=z.preload,A}};C.clone=function(){return new u({url:this.url,data:this.data,wrap:this.cloneWrap()})};C.cloneWithDeduplication=function(z){var A=z.get(this);if(A)return A;A=new u({url:this.url,data:this.data,wrap:this.cloneWrap()});z.set(this,A);return A};C.cloneWrap=function(){return"string"===
typeof this.wrap?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};C.encodeImageData=function(z){let A="";for(let t=0;t<z.data.length;t++)A+=String.fromCharCode(z.data[t]);return{data:btoa(A),width:z.width,height:z.height}};C.decodeImageData=function(z){const A=atob(z.data),t=new Uint8ClampedArray(A.length);for(let D=0;D<A.length;D++)t[D]=A.charCodeAt(D);return m.wrapImageData(t,z.width,z.height)};C.imageDataContainsTransparent=function(z){for(let A=3;A<z.data.length;A+=4)if(255!==
z.data[A])return!0;return!1};x.from=function(z){return"string"===typeof z?new u({url:z}):z instanceof HTMLImageElement||z instanceof HTMLCanvasElement||z instanceof ImageData||z instanceof HTMLVideoElement?new u({data:z}):l.ensureClass(u,z)};b._createClass(x,[{key:"url",get:function(){return this._get("url")||null},set:function(z){this._set("url",z);z&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(z){this._set("data",z);z&&this._set("url",null)}},
{key:"transparent",get:function(){var z=this.data,A=this.url;return z instanceof HTMLCanvasElement?this.imageDataContainsTransparent(z.getContext("2d").getImageData(0,0,z.width,z.height)):z instanceof ImageData?this.imageDataContainsTransparent(z):A&&(z=A.substr(A.length-4,4).toLowerCase(),A=A.substr(0,15).toLocaleLowerCase(),".png"===z||"data:image/png;"===A)?!0:!1},set:function(z){null!=z?this._override("transparent",z):this._clearOverride("transparent")}},{key:"contentHash",get:function(){const z=
"string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",A=(t="")=>`d:${t},t:${this.transparent},w:${z}`;if(null!=this.url)return A(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return A(this.data.src);v.has(this.data)||v.set(this.data,++y);return A(v.get(this.data))}return A()}}]);return x}(q.JSONSupport);k.__decorate([h.property({type:String,json:{write:w.write}})],a.prototype,
"url",null);k.__decorate([h.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),h.property()],a.prototype,"data",null);k.__decorate([f.writer("data")],a.prototype,"writeData",null);k.__decorate([c.reader("data")],a.prototype,"readData",null);k.__decorate([h.property({type:Boolean,dependsOn:["data","url"],json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],a.prototype,"transparent",null);k.__decorate([h.property({json:{write:!0}})],a.prototype,"wrap",
void 0);k.__decorate([h.property({readOnly:!0,dependsOn:["url","data","wrap","transparent"]})],a.prototype,"contentHash",null);return a=u=k.__decorate([e.subclass("esri.geometry.support.MeshTexture")],a)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../Color ./MeshTexture".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){var u;a=u=function(v){function y(x){x=v.call(this,x)||this;x.color=null;x.colorTexture=null;x.normalTexture=null;x.alphaMode="auto";x.alphaCutoff=.5;x.doubleSided=!0;return x}b._inheritsLoose(y,v);var B=y.prototype;B.clone=function(){return this.cloneWithDeduplication(null,new Map)};B.cloneWithDeduplication=function(x,C){const z=l.isSome(x)?x.get(this):null;if(z)return z;C=new u(this.clonePropertiesWithDeduplication(C));l.isSome(x)&&x.set(this,C);return C};
B.clonePropertiesWithDeduplication=function(x){return{color:r.clone(this.color),colorTexture:this.colorTexture?this.colorTexture.cloneWithDeduplication(x):null,normalTexture:this.normalTexture?this.normalTexture.cloneWithDeduplication(x):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}};return y}(w.JSONSupport);k.__decorate([c.property({type:q,json:{write:!0}})],a.prototype,"color",void 0);k.__decorate([c.property({type:m,json:{write:!0}})],a.prototype,"colorTexture",
void 0);k.__decorate([c.property({type:m,json:{write:!0}})],a.prototype,"normalTexture",void 0);k.__decorate([c.property({json:{write:!0}})],a.prototype,"alphaMode",void 0);k.__decorate([c.property({json:{write:!0}})],a.prototype,"alphaCutoff",void 0);k.__decorate([c.property({json:{write:!0}})],a.prototype,"doubleSided",void 0);return a=u=k.__decorate([f.subclass("esri.geometry.support.MeshMaterial")],a)})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){var v;const y=l.getLogger("esri.geometry.support.MeshComponent");a=v=function(B){function x(z){z=B.call(this,z)||this;z.faces=null;z.material=null;z.shading="source";z.trustSourceNormals=!1;return z}b._inheritsLoose(x,B);x.from=function(z){return h.ensureClass(v,z)};var C=x.prototype;C.castFaces=function(z){return u.castArray(z,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},y)};C.castMaterial=function(z){return z&&"object"===typeof z&&("metallic"in
z||"roughness"in z||"metallicRoughnessTexture"in z)?h.ensureClass(m,z):h.ensureClass(q,z)};C.clone=function(){return new v({faces:r.clone(this.faces),shading:this.shading,material:r.clone(this.material),trustSourceNormals:this.trustSourceNormals})};C.cloneWithDeduplication=function(z,A){return new v({faces:r.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(z,A):null,trustSourceNormals:this.trustSourceNormals})};return x}(w);k.__decorate([d.property({json:{write:!0}})],
a.prototype,"faces",void 0);k.__decorate([c.cast("faces")],a.prototype,"castFaces",null);k.__decorate([d.property({type:q,json:{write:!0}})],a.prototype,"material",void 0);k.__decorate([c.cast("material")],a.prototype,"castMaterial",null);k.__decorate([d.property({type:String,json:{write:!0}})],a.prototype,"shading",void 0);k.__decorate([d.property({type:Boolean})],a.prototype,"trustSourceNormals",void 0);return a=v=k.__decorate([f.subclass("esri.geometry.support.MeshComponent")],a)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){function q(B,x,C,z){const {loggerTag:A,stride:t}=x;return 0!==B.length%t?(z.error(A,`Invalid array length, expected a multiple of ${t}`),new C([])):B}function m(B,x,C,z,A){if(!B)return B;if(B instanceof x)return q(B,z,x,A);for(const t of C)if(B instanceof t)return q(new x(B),z,x,A);if(Array.isArray(B))return q(new x(B),z,x,A);C=C.map(t=>`'${t.name}'`);A.error(`Failed to set property, expected one of ${C}, but got ${B.constructor.name}`);return new x([])}function u(B,
x,C){{const z=Array(B.length);for(let A=0;A<B.length;A++)z[A]=B[A];B=z}x[C]=B}var v;const y=h.getLogger("esri.geometry.support.MeshVertexAttributes");b.MeshVertexAttributes=v=function(B){function x(z){z=B.call(this,z)||this;z.color=null;z.position=new Float64Array(0);z.uv=null;z.normal=null;z.tangent=null;return z}k._inheritsLoose(x,B);var C=x.prototype;C.castColor=function(z){return m(z,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},y)};C.castPosition=function(z){z&&z instanceof
Float32Array&&y.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return m(z,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},y)};C.castUv=function(z){return m(z,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},y)};C.castNormal=function(z){return m(z,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},y)};C.castTangent=function(z){return m(z,Float32Array,
[Float64Array],{loggerTag:".tangent\x3d",stride:4},y)};C.clone=function(){const z={position:l.clone(this.position),uv:l.clone(this.uv),normal:l.clone(this.normal),tangent:l.clone(this.tangent),color:l.clone(this.color)};return new v(z)};return x}(w.JSONSupport);a.__decorate([d.property({json:{write:u}})],b.MeshVertexAttributes.prototype,"color",void 0);a.__decorate([c.cast("color")],b.MeshVertexAttributes.prototype,"castColor",null);a.__decorate([d.property({nonNullable:!0,json:{write:u}})],b.MeshVertexAttributes.prototype,
"position",void 0);a.__decorate([c.cast("position")],b.MeshVertexAttributes.prototype,"castPosition",null);a.__decorate([d.property({json:{write:u}})],b.MeshVertexAttributes.prototype,"uv",void 0);a.__decorate([c.cast("uv")],b.MeshVertexAttributes.prototype,"castUv",null);a.__decorate([d.property({json:{write:u}})],b.MeshVertexAttributes.prototype,"normal",void 0);a.__decorate([c.cast("normal")],b.MeshVertexAttributes.prototype,"castNormal",null);a.__decorate([d.property({json:{write:u}})],b.MeshVertexAttributes.prototype,
"tangent",void 0);a.__decorate([c.cast("tangent")],b.MeshVertexAttributes.prototype,"castTangent",null);b.MeshVertexAttributes=v=a.__decorate([f.subclass("esri.geometry.support.MeshVertexAttributes")],b.MeshVertexAttributes);a=b.MeshVertexAttributes;b.castArray=m;b.default=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../spatialReferenceUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../projectionEllipsoid ../../projection ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/mat3 ../../../views/3d/support/buffer/BufferView".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){function p(v,y,B,x,C,z){if(y){var A=C.isWGS84||a.isCGCS2000(C)||a.isMars(C)||a.isMoon(C),t=B.count;if(A)for(B=0;B<t;B++)x.getVec(B,w),y.getVec(B,q),A=h.getSphericalPCPF(C),d.computeLinearTransformation(A,w,m,A),f.fromMat4(u,m),1===v&&f.transpose(u,u),l.transformMat3(q,q,u),z.setVec(B,q);else for(C=0;C<t;C++)x.getVec(C,w),y.getVec(C,q),d.computeLinearTransformation(h.SphericalECEFSpatialReference,w,m,h.SphericalECEFSpatialReference),f.fromMat4(u,m),A=d.webMercator.y2lat(B.get(C,
1)),A=Math.cos(A),0===v&&(A=1/A),u[0]*=A,u[1]*=A,u[2]*=A,u[3]*=A,u[4]*=A,u[5]*=A,1===v&&f.transpose(u,u),l.transformMat3(q,q,u),l.normalize(q,q),z.setVec(C,q);return z}}const n=k.getLogger("esri.geometry.support.meshUtils.normalProjection"),w=r.create(),q=r.create(),m=e.create(),u=c.create();b.projectFromECEF=function(v,y,B){d.projectBuffer(v,h.getSphericalPCPF(B),0,y,B,0,v.length/3);return y};b.projectNormalFromECEF=function(v,y,B,x,C){if(!x.isWebMercator&&!x.isWGS84)return n.error("Cannot convert to PCS spatial reference buffer from ECEF"),
C;p(1,g.BufferViewVec3f.fromTypedArray(v),g.BufferViewVec3f64.fromTypedArray(y),g.BufferViewVec3f64.fromTypedArray(B),x,g.BufferViewVec3f.fromTypedArray(C));return C};b.projectNormalToECEF=function(v,y,B,x,C){if(!x.isWebMercator&&!x.isWGS84)return n.error("Cannot convert PCS spatial reference buffer to ECEF"),C;p(0,g.BufferViewVec3f.fromTypedArray(v),g.BufferViewVec3f64.fromTypedArray(y),g.BufferViewVec3f64.fromTypedArray(B),x,g.BufferViewVec3f.fromTypedArray(C));return C};b.projectTangentFromECEF=
function(v,y,B,x,C){if(!x.isWebMercator&&!x.isWGS84)return n.error("Cannot convert to PCS spatial reference buffer from ECEF"),C;p(1,g.BufferViewVec3f.fromTypedArray(v,16),g.BufferViewVec3f64.fromTypedArray(y),g.BufferViewVec3f64.fromTypedArray(B),x,g.BufferViewVec3f.fromTypedArray(C,16));for(y=3;y<v.length;y+=4)C[y]=v[y];return C};b.projectTangentToECEF=function(v,y,B,x,C){if(!x.isWebMercator&&!x.isWGS84)return n.error("Cannot convert PCS spatial reference buffer to ECEF"),C;p(0,g.BufferViewVec3f.fromTypedArray(v,
4*Float32Array.BYTES_PER_ELEMENT),g.BufferViewVec3f64.fromTypedArray(y),g.BufferViewVec3f64.fromTypedArray(B),x,g.BufferViewVec3f.fromTypedArray(C,4*Float32Array.BYTES_PER_ELEMENT));for(y=3;y<v.length;y+=4)C[y]=v[y];return C};b.projectToECEF=function(v,y,B){d.projectBuffer(v,y,0,B,h.getSphericalPCPF(y),0,v.length/3);return B};b.transformBufferInPlace=function(v,y,B=!1){if(v)for(let C=0;C<v.length;C+=3){for(var x=0;3>x;x++)w[x]=v[C+x];l.transformMat4(w,w,y);B&&l.normalize(w,w);for(x=0;3>x;x++)v[C+
x]=w[x]}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/maybe","../../../../core/mathUtils"],function(b,k,a){b.encodeSymbolColor=function(r,l,h){if(k.isNone(r)||2===l)h[0]=255,h[1]=255,h[2]=255,h[3]=255;else{var d=a.clamp(Math.round(85*r[3]),0,85);l=0===d||4===l?0:3===l?85:170;h[0]=a.clamp(Math.round(255*r[0]),0,255);h[1]=a.clamp(Math.round(255*r[1]),0,255);h[2]=a.clamp(Math.round(255*r[2]),0,255);
h[3]=d+l}};b.parseColorMixMode=function(r){switch(r){case "multiply":return 1;case "ignore":return 2;case "replace":return 3;case "tint":return 4;default:return 1}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Logger ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/vec2 ../../support/buffer/BufferView ../../support/geometryUtils ../lib/geometryDataUtils ../lib/Util ./renderers/utils ../lib/GLMaterial ./internal/MaterialUtil ../lib/Material ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ../shaders/NativeLineTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){const B=r.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");r=function(P){function U(W,X){W=P.call(this,X,W,z)||this;W.techniqueConfig=new y.NativeLineTechniqueConfiguration;return W}k._inheritsLoose(U,P);var V=U.prototype;V.getTechniqueConfig=function(W){this.techniqueConfig.output=W;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.transparent=
1>this.params.color[3]||1>this.params.width;W=a.isSome(this.params.stipplePattern);this.techniqueConfig.stippleEnabled=W;this.techniqueConfig.stippleOffColorEnabled=W&&a.isSome(this.params.stippleOffColor);this.techniqueConfig.stippleIntegerRepeatsEnabled=W&&this.params.stippleIntegerRepeats;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;return this.techniqueConfig};V.getPassParameters=function(){return this.params};V.intersect=function(W,X,ca,R,aa,ka,da,fa,ea){ea?q.intersectDrapedRenderLineGeometry(W,
R,ka,1,da):this.intersectLineGeometry(W,X,ca,R,da)};V.intersectLineGeometry=function(W,X,ca,R,aa){if(R.options.selectionMode&&!n.isInstanceHidden(X))if(p.isTranslationMatrix(ca)){X=W.data.getVertexAttr().position.data;var ka=R.camera,da=S;c.copy(da,R.point);d.set(M[0],da[0]-2,da[1]+2,0);d.set(M[1],da[0]+2,da[1]+2,0);d.set(M[2],da[0]+2,da[1]-2,0);d.set(M[3],da[0]-2,da[1]-2,0);for(W=0;4>W;W++)if(!ka.unprojectFromRenderScreen(M[W],T[W]))return;f.plane.fromPoints(ka.eye,T[0],T[1],O);f.plane.fromPoints(ka.eye,
T[1],T[2],Q);f.plane.fromPoints(ka.eye,T[2],T[3],F);f.plane.fromPoints(ka.eye,T[3],T[0],N);W=Number.MAX_VALUE;for(let ea=0;ea<X.length-5;ea+=3)if(A[0]=X[ea]+ca[12],A[1]=X[ea+1]+ca[13],A[2]=X[ea+2]+ca[14],t[0]=X[ea+3]+ca[12],t[1]=X[ea+4]+ca[13],t[2]=X[ea+5]+ca[14],!(0>f.plane.signedDistance(O,A)&&0>f.plane.signedDistance(O,t)||0>f.plane.signedDistance(Q,A)&&0>f.plane.signedDistance(Q,t)||0>f.plane.signedDistance(F,A)&&0>f.plane.signedDistance(F,t)||0>f.plane.signedDistance(N,A)&&0>f.plane.signedDistance(N,
t))){ka.projectToRenderScreen(A,G);ka.projectToRenderScreen(t,H);if(0>G[2]&&0<H[2]){d.subtract(D,A,t);var fa=ka.frustum;fa=-f.plane.signedDistance(fa.planes[4],A)/d.dot(D,f.plane.normal(fa.planes[4]));d.scale(D,D,fa);d.add(A,A,D);ka.projectToRenderScreen(A,G)}else if(0<G[2]&&0>H[2])d.subtract(D,t,A),fa=ka.frustum,fa=-f.plane.signedDistance(fa.planes[4],t)/d.dot(D,f.plane.normal(fa.planes[4])),d.scale(D,D,fa),d.add(t,t,D),ka.projectToRenderScreen(t,H);else if(0>G[2]&&0>H[2])continue;G[2]=0;H[2]=0;
fa=f.lineSegment.distance2(f.lineSegment.fromPoints(G,H,K),da);fa<W&&(W=fa,d.copy(I,A),d.copy(J,t))}ca=R.rayBeginPoint;R=R.rayEndPoint;4>W&&(W=Number.MAX_VALUE,f.lineSegment.closestLineSegmentPoint(f.lineSegment.fromPoints(I,J,K),f.lineSegment.fromPoints(ca,R,L),E)&&(d.subtract(E,E,ca),W=d.length(E),d.scale(E,E,1/W),W/=d.distance(ca,R)),aa(W,E))}else B.error("intersection assumes a translation-only matrix")};V.computeAttachmentOrigin=function(W,X){W=W.data;return(W="getVertexAttr"in W?W.getVertexAttr():
"vertexAttr"in W?W.vertexAttr:null)?g.computeAttachmentOriginLines(W[p.VertexAttrConstants.POSITION],null,!1,X):null};V.createBufferWriter=function(){const W=this.params.vertexColors?v.PositionColorLayout:v.PositionLayout;return a.isNone(this.params.stipplePattern)?new v.DefaultBufferWriter(W):new C(W.clone().vec3f(p.VertexAttrConstants.AUXPOS1))};V.getGLMaterial=function(W){return 0===W.output||4===W.output?new x(W):void 0};return U}(m.Material);let x=function(P){function U(W){W=P.call(this,W)||
this;W.updateParameters();return W}k._inheritsLoose(U,P);var V=U.prototype;V.updateParameters=function(){this.technique=this.techniqueRep.acquireAndReleaseExisting(y.NativeLineTechnique,this.material.getTechniqueConfig(this.output),this.technique)};V.beginSlot=function(W){return 3===W};V._updateOccludeeState=function(W){W.hasOccludees!==this.material.params.sceneHasOcludees&&(this.material.setParameterValues({sceneHasOcludees:W.hasOccludees}),this.updateParameters())};V.ensureParameters=function(W){0===
this.output&&this._updateOccludeeState(W)};V.bind=function(W,X){W.bindProgram(this.technique.program);this.technique.bindPass(W,this.material.getPassParameters(),X)};V.getPipelineState=function(W,X){return this.technique.getPipelineState(X)};return U}(w),C=function(){function P(V){this.vertexBufferLayout=V}var U=P.prototype;U.allocate=function(V){return this.vertexBufferLayout.createBuffer(V)};U.elementCount=function(V){return V.indices[p.VertexAttrConstants.POSITION].length};U.write=function(V,W,
X,ca){u.writeDefaultAttributes(W,this.vertexBufferLayout,V.transformation,V.invTranspTransformation,X,ca);this.writeAuxpos1(V,W,X,ca)};U.writeAuxpos1=function(V,W,X,ca){var R=X.getField(p.VertexAttrConstants.AUXPOS1,e.BufferViewVec3f);X=W.indices[p.VertexAttrConstants.POSITION];W=W.vertexAttr[p.VertexAttrConstants.POSITION].data;V=V.transformation;const aa=R.typedBufferStride;R=R.typedBuffer;ca*=aa;for(let ea=0;ea<X.length;ea+=2){var ka=3*X[ea],da=W[ka],fa=W[ka+1];const Y=W[ka+2];ka=V[0]*da+V[4]*
fa+V[8]*Y+V[12];const Z=V[1]*da+V[5]*fa+V[9]*Y+V[13];da=V[2]*da+V[6]*fa+V[10]*Y+V[14];for(fa=0;2>fa;++fa)R[ca]=ka,R[ca+1]=Z,R[ca+2]=da,ca+=aa}};return P}();const z={color:[1,1,1,1],vertexColors:!1,slicePlaneEnabled:!1,width:1,stipplePattern:null,stippleIntegerRepeats:!1,stippleOffColor:null,sceneHasOcludees:!1,...m.materialParametersDefaults},A=h.create(),t=h.create(),D=h.create(),E=h.create(),G=l.createRenderScreenPointArray3(),H=l.createRenderScreenPointArray3(),I=h.create(),J=h.create(),K=f.lineSegment.create(),
L=f.lineSegment.create(),S=h.create(),M=[l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3()],T=[h.create(),h.create(),h.create(),h.create()],O=f.plane.create(),Q=f.plane.create(),F=f.plane.create(),N=f.plane.create();b.NativeLineMaterial=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../lib/StencilUtils ../../../../chunks/NativeLine.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){d=function(u){function v(B,x){x=u.call(this,B,x)||this;x.stipplePattern=null;x.stippleTextureBind=null;x.stippleTextureRepository=B.stippleTextureRepository;return x}a._inheritsLoose(v,u);var y=v.prototype;y.initializeProgram=function(B){var x=v.shader.get();const C=this.configuration;x=x.build({output:C.output,attributeColor:C.vertexColors,slicePlaneEnabled:C.slicePlaneEnabled,sliceHighlightDisabled:C.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,
stippleEnabled:C.stippleEnabled,stippleOffColorEnabled:C.stippleOffColorEnabled,stippleUVMaxEnabled:!1,stippleIntegerRepeatsEnabled:C.stippleIntegerRepeatsEnabled});return new f(B.rctx,x.generateSource("vertex"),x.generateSource("fragment"),e.Default3D)};y.dispose=function(){u.prototype.dispose.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};y.bindPass=function(B,x,C){p.View.bindProjectionMatrix(this.program,C.camera.projectionMatrix);
if(this.stipplePattern!==x.stipplePattern){var z=x.stipplePattern;this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,z);this.stipplePattern=z}this.configuration.stippleEnabled&&(z=l.isSome(this.stippleTextureBind)?this.stippleTextureBind(B,0)*C.camera.pixelRatio:1,this.program.setUniform1i("stipplePatternTexture",0),this.program.setUniform1f("stipplePatternPixelSizeInv",1/z),this.program.setUniform2f("ndcToPixel",C.camera.fullViewport[2]/2,C.camera.fullViewport[3]/2));
this.program.setUniform4fv("constantColor",x.color);this.program.setUniform1f("alphaCoverage",Math.min(1,x.width*C.camera.pixelRatio));this.configuration.stippleOffColorEnabled&&(x=l.unwrap(x.stippleOffColor),this.program.setUniform4f("stippleOffColor",x[0],x[1],x[2],3<x.length?x[3]:1));4===this.configuration.output&&w.OutputHighlight.bindOutputHighlight(B,this.program,C)};y.bindDraw=function(B){p.View.bindView(this.program,B);n.Slice.bindUniformsWithOrigin(this.program,this.configuration,B)};y.initializePipeline=
function(){const B=this.configuration,x=g.separateBlendingParams(770,1,771,771),C=(z,A=null,t=null)=>g.makePipelineState({blending:A,depthTest:q.depthCompareLess,depthWrite:t,colorWrite:g.defaultColorWriteParams,stencilWrite:B.sceneHasOcludees?q.stencilWriteMaskOn:null,stencilTest:B.sceneHasOcludees?z?q.stencilToolMaskBaseParams:q.stencilBaseAllZerosParams:null});return 0===B.output?(this._occludeePipelineState=C(!0,B.transparent||B.stippleEnabled?x:null,g.defaultDepthWriteParams),C(!1,B.transparent||
B.stippleEnabled?x:null,g.defaultDepthWriteParams)):C(!1)};y.getPipelineState=function(B){return B?this._occludeePipelineState:this.pipeline};a._createClass(v,[{key:"primitiveType",get:function(){return 1}}]);return v}(d.ShaderTechnique);d.shader=new h.ReloadableShaderModule(m.NativeLineShader,()=>new Promise(function(u,v){b(["./NativeLine.glsl"],u,v)}));h=function(u){function v(){var y=u.apply(this,arguments)||this;y.output=0;y.slicePlaneEnabled=!1;y.sliceHighlightDisabled=!1;y.vertexColors=!1;y.transparent=
!1;y.stippleEnabled=!1;y.stippleOffColorEnabled=!1;y.stippleIntegerRepeatsEnabled=!1;y.sceneHasOcludees=!1;return y}a._inheritsLoose(v,u);return v}(c.ShaderTechniqueConfiguration);r.__decorate([c.parameter({count:8})],h.prototype,"output",void 0);r.__decorate([c.parameter()],h.prototype,"slicePlaneEnabled",void 0);r.__decorate([c.parameter()],h.prototype,"sliceHighlightDisabled",void 0);r.__decorate([c.parameter()],h.prototype,"vertexColors",void 0);r.__decorate([c.parameter()],h.prototype,"transparent",
void 0);r.__decorate([c.parameter()],h.prototype,"stippleEnabled",void 0);r.__decorate([c.parameter()],h.prototype,"stippleOffColorEnabled",void 0);r.__decorate([c.parameter()],h.prototype,"stippleIntegerRepeatsEnabled",void 0);r.__decorate([c.parameter()],h.prototype,"sceneHasOcludees",void 0);k.NativeLineTechnique=d;k.NativeLineTechniqueConfiguration=h;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e){function f(p){const n=new r.ShaderBuilder;n.include(a.Transform,{linearDepth:!1});n.include(c.VertexColor,p);n.include(e.LineStipple,p);n.vertex.uniforms.add("proj","mat4").add("view","mat4");n.attributes.add("position","vec3");n.varyings.add("vpos","vec3");n.vertex.code.add(k.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      gl_Position = transformPosition(proj, view, vpos);
  `);p.stippleEnabled&&(n.attributes.add("auxpos1","vec3"),n.vertex.uniforms.add("ndcToPixel","vec2"),n.vertex.code.add(k.glsl`
    vec4 vpos2 = transformPosition(proj, view, auxpos1);
    float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);

    stipplePatternUv = lineSegmentPixelSize * stipplePatternPixelSizeInv;
    ${p.stippleIntegerRepeatsEnabled?"stipplePatternUv \x3d floor(stipplePatternUv + 0.5);":""}

    // Cancel out perspective correct interpolation because we want this length the really represent
    // the screen distance
    stipplePatternUv *= gl_Position.w;
    `));n.vertex.code.add(k.glsl`
  }
  `);4===p.output&&n.include(h.OutputHighlight);n.include(l.Slice,p);n.fragment.uniforms.add("constantColor","vec4").add("alphaCoverage","float");n.fragment.code.add(k.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${p.attributeColor?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, STIPPLE_ALPHA_COLOR_DISCARD);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${k.glsl.float(d.symbolAlphaCutoff)}) {
      discard;
    }

    ${0===p.output?k.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${4===p.output?k.glsl`outputHighlight();`:""}
  }
  `);return n}var g=Object.freeze({__proto__:null,build:f});b.NativeLineShader=g;b.build=f})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/lang ../../../../core/maybe ../../../../Color ../../../../core/screenUtils ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/projection ../../../../chunks/mat4f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Util ./graphicUtils ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./primitiveObjectSymbolUtils ../../webgl-engine/lib/lodRendering/LodResources ./symbolComplexity ./Graphics3DSymbolLayer ./pointUtils ../../webgl-engine/materials/DefaultMaterial ../support/FastSymbolUpdates ../../../../symbols/support/symbolLayerUtils3D ./Graphics3DLodInstanceGraphicLayer ./lodResourceUtils ./objectResourceUtils ../../webgl-engine/lib/lodRendering/LodRenderer".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J){z=function(O){function Q(N,P,U,V){N=O.call(this,N,P,U,V)||this;N._resources=null;N._optionalFields=[];N._instanceIndexToGraphicUid=new Map;N.ensureDrapedStatus(!1);return N}k._inheritsLoose(Q,O);var F=Q.prototype;F.getCachedSize=function(){const [N,P,U]=r.isSome(this._resources)?this._resources.symbolSize:[1,1,1];return{width:N,depth:P,height:U}};F.doLoad=async function(N){const P=this._getIdHint("_objectmat");if(!this._drivenProperties.size&&
m.validateSymbolLayerSize(this.symbolLayer))throw Error();const U=this.symbolLayer;this._resources=this.isPrimitive?this._createResourcesForPrimitive(U.resource?U.resource.primitive:d.defaultPrimitive,P):await this._createResourcesForUrl(U.resource.href,N);this.complexity=this.computeComplexity()};F.setMaterialTransparencyParams=function(N,P=r.get(this.symbolLayer,"material","color")){P=this._getCombinedOpacity(P);N.transparent=1>P||this.needsDrivenTransparentPass;N.opacity=P;return N};F._createResourcesForPrimitive=
function(N,P){if(!B.isValidPrimitive(N))throw Error(`Unknown object symbol primitive: ${N}`);var U=this.symbolLayer;const V=w.create(E.objectSymbolLayerPrimitiveBoundingBox(N)),W=c.fromArray(w.size(V)),X=c.fromArray(E.objectSymbolLayerSizeWithResourceSize(W,U)),ca=e.length(X);var R={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,instanced:["transformation"],ambient:c.ONES,diffuse:c.ONES,slicePlaneEnabled:this._context.slicePlaneEnabled,sliceHighlightDisabled:!0,castShadows:this.symbolLayer.castShadows,
offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const aa=R.usePBR;this.setMaterialTransparencyParams(R);const ka=this.symbol;if("point-3d"===ka.type&&ka.verticalOffset){const {screenLength:da,minWorldLength:fa,maxWorldLength:ea}=ka.verticalOffset;R.verticalOffset={screenLength:h.pt2px(da),minWorldLength:fa||0,maxWorldLength:null!=ea?ea:Infinity};R.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(R.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);
this._drivenProperties.color?R.externalColor=n.ONES:(U=r.isSome(U.material)&&U.material.color,U=r.isSome(U)?l.toUnitRGBA(U):n.ONES,R.externalColor=U);this._fastUpdates=D.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(V,X,W,r.none));this._fastUpdates.enabled?(a.mixin(R,this._fastUpdates.materialParameters),R.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(R.instanced.push("color"),this._optionalFields.push("color"));
R=new t.DefaultMaterial(R,P);P=B.primitiveLodResources(N,R,P);if(!P)throw Error(`Unknown object symbol primitive: ${N}`);N=x.materialsFromLodResources(P).map(da=>({opacity:1,transparent:da.params.transparent}));R=this._createStageResources(P,aa);U=this._createLodRenderer(P);return{lodResources:P,lodRenderer:U,stageResources:R,symbolSize:X,extentPadding:ca,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:N,physicalBasedRenderingEnabled:aa,resourceBoundingBox:V,resourceSize:W,dispose:r.none,
pivotOffset:r.none}};F._createResourcesForUrl=async function(N,P){var U=["transformation"],V={materialParamsMixin:{instanced:U,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=D.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(r.none,r.none,r.none,r.none));this._fastUpdates.enabled?(a.mixin(V.materialParamsMixin,
this._fastUpdates.materialParameters),U.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(U.push("color"),this._optionalFields.push("color"));U=this.symbol;if("point-3d"===U.type&&U.verticalOffset){const {screenLength:ja,minWorldLength:la,maxWorldLength:qa}=U.verticalOffset;V.materialParamsMixin.verticalOffset={screenLength:h.pt2px(ja),minWorldLength:la||0,maxWorldLength:null!=qa?qa:Infinity};V.materialParamsMixin.castShadows=!1}V.signal=P;V.usePBR=
this._context.physicalBasedRenderingEnabled;P=V.usePBR;var W=await I.fetch(N,V);N=W.isEsriSymbolResource;V=W.isWosr;U=W.remove;const X=H.makeLodResources(W.lods);H.fillEstimatedMinScreenSpaceRadius(X);X.levels.sort((ja,la)=>ja.minScreenSpaceRadius-la.minScreenSpaceRadius);X.levels[0].minScreenSpaceRadius=Math.min(2,X.levels[0].minScreenSpaceRadius);const ca=this._context,R=this._getExternalColorParameters(this.symbolLayer.material);var aa=r.get(this.symbolLayer,"material","color");const ka=this._getCombinedOpacity(aa,
{hasIntrinsicColor:!0}),da=this.needsDrivenTransparentPass;var fa=x.materialsFromLodResources(X);aa=x.materialsFromLodResources(X).map(ja=>{ja=ja.params;return{opacity:ja.opacity||1,transparent:ja.transparent}});fa.forEach(ja=>{const la=ja.params;ja.setParameterValues(R);const qa=la.opacity*ka;ja.setParameterValues({opacity:qa,transparent:1>qa||da||la.transparent});ca.screenSizePerspectiveEnabled&&ja.setParameterValues({screenSizePerspective:ca.sharedResources.screenSizePerspectiveSettings})});W=
W.referenceBoundingBox;const ea=c.fromArray(w.size(W)),Y=c.fromArray(X.levels[0].pivotOffset),Z=c.fromArray(E.objectSymbolLayerSizeWithResourceSize(ea,this.symbolLayer)),ba=e.length(Z);D.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(W,Z,ea,Y))&&fa.forEach(ja=>ja.setParameterValues(this._fastUpdates.materialParameters));fa=this._createStageResources(X,P);const ia=this._createLodRenderer(X);return{lodResources:X,lodRenderer:ia,stageResources:fa,
symbolSize:Z,extentPadding:ba,isEsriSymbolResource:N,isWosr:V,originalMaterialParameters:aa,physicalBasedRenderingEnabled:P,resourceBoundingBox:W,resourceSize:ea,dispose:U,pivotOffset:Y}};F._createStageResources=function(N,P){const U=this._context.stage,V=x.materialsFromLodResources(N);P!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();for(const W of V)U.add(3,W);P=x.texturesFromLodResources(N);for(const W of P)U.add(4,W);N=x.geometriesFromLodResources(N);for(const W of N)U.add(2,
W);return{materials:V,textures:P,geometries:N}};F._createLodRenderer=function(N){const P=this._context.stage;N=new J.LodRenderer(N,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:U=>this._instanceIndexToGraphicUid.get(U),notifyGraphicUpdate:(U,V)=>this._context.notifyGraphicUpdate(this._instanceIndexToGraphicUid.get(U),V)},this._fastUpdates.enabled?{applyTransform:(U,V,W)=>{U.getFeatureAttribute(V,M);f.copy(W,D.evaluateModelTransform(this._fastUpdates.materialParameters,M,W))},scaleFactor:(U,
V,W)=>{V.getFeatureAttribute(W,M);return D.evaluateModelTransformScale(U,this._fastUpdates.materialParameters,M)}}:null);N.slicePlane=this._context.slicePlaneEnabled;P.addRenderPlugin(N.slots,N);return N};F._getExternalColorParameters=function(N){const P={};this._drivenProperties.color?P.externalColor=n.ONES:r.isSome(N)&&r.isSome(N.color)?P.externalColor=l.toUnitRGBA(N.color):(P.externalColor=n.ONES,P.colorMixMode="ignore");return P};F.destroy=function(){O.prototype.destroy.call(this);const N=this._context.stage;
if(r.isSome(this._resources)){N.removeRenderPlugin(this._resources.lodRenderer);this._resources.lodRenderer.destroy();const P=this._resources.stageResources;for(const U of P.materials)N.remove(3,U.id);for(const U of P.textures)N.remove(4,U.id);for(const U of P.geometries)N.remove(2,U.id);r.isSome(this._resources.dispose)&&this._resources.dispose()}this._resources=null};F.createGraphics3DGraphic=function(N){const P=N.graphic;if(!this._validateGeometry(P.geometry))return null;const U=A.placePointOnGeometry(P.geometry);
if(r.isNone(U))return this.logger.warn(`unsupported geometry type for icon symbol: ${P.geometry.type}`),null;const V=this.setGraphicElevationContext(P,new y.ElevationContext);return this._createAs3DShape(P,U,N.renderingInfo,V,P.uid)};F.notifyDestroyGraphicLayer=function(N){this._instanceIndexToGraphicUid.delete(N.instanceIndex)};F.graphicLayerToGraphicId=function(){return 0};F.layerOpacityChanged=function(){if(r.isNone(this._resources))return!0;const N=this._drivenProperties.opacity,P=!this.isPrimitive,
U=this._resources.stageResources.materials,V=this._resources.originalMaterialParameters;for(let X=0;X<U.length;X++){const ca=U[X];var W=r.get(this.symbolLayer,"material","color");const R=V[X];W=this._getCombinedOpacity(W,{hasIntrinsicColor:P})*R.opacity;ca.setParameterValues({opacity:W,transparent:1>W||N||R.transparent})}return!0};F.layerElevationInfoChanged=function(N,P){return this.updateGraphics3DGraphicElevationInfo(N,P,u.needsElevationUpdates3D)};F.slicePlaneEnabledChanged=function(){if(r.isNone(this._resources))return!0;
this._resources.lodRenderer.slicePlane=this._context.slicePlaneEnabled;for(const N of this._resources.stageResources.materials)N.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};F.physicalBasedRenderingChanged=function(){if(r.isNone(this._resources))return!0;const {stageResources:N,isEsriSymbolResource:P,isWosr:U}=this._resources;for(const V of N.materials)this.isPrimitive?V.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):P&&
!U&&V.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!0};F.pixelRatioChanged=function(){return!0};F.applyRendererDiff=function(N,P){if(r.isNone(this._resources))return!0;const {stageResources:{materials:U},lodRenderer:V,resourceBoundingBox:W,symbolSize:X,resourceSize:ca,pivotOffset:R}=this._resources;for(const aa in N.diff)switch(aa){case "visualVariables":if(D.updateFastSymbolUpdatesState(this._fastUpdates,P,this._fastVisualVariableConvertOptions(W,
X,ca,R))){for(const ka of U)ka.setParameterValues(this._fastUpdates.materialParameters);V.notifyShaderTransformationChanged()}else return!1;break;default:return!1}return!0};F.computeComplexity=function(){if(r.isNone(this._resources))return O.prototype.computeComplexity.call(this);const N=x.geometriesFromLodLevelResources(this._resources.lodResources.levels[0]).reduce((U,V)=>U+V.data.getIndices(q.VertexAttrConstants.POSITION).length,0)/3,P=C.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer);
return{primitivesPerFeature:N,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:P}};F.hasLodRenderer=function(){return r.isSome(this._resources)};F._createAs3DShape=function(N,P,U,V,W){if(!this.hasLodRenderer()||r.isNone(this._resources))return null;N=this.getFastUpdateAttrValues(N);const X=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?m.mixinColorAndOpacity(U.color,U.opacity):null;var ca=this._context.clippingExtent;g.projectPointToVector(P,K,this._context.elevationProvider.spatialReference);
if(r.isSome(ca)&&!w.containsPoint(ca,K))return null;ca=this._requiresTerrainElevation(V);const R=this._computeGlobalTransform(P,V,S,ca?T:null);U=this._computeLocalTransform(this._resources,this.symbolLayer,U,L);const aa=this._resources.lodRenderer.instanceData,ka=aa.addInstance();this._instanceIndexToGraphicUid.set(ka,W);aa.setLocalTransform(ka,U,!1);aa.setGlobalTransform(ka,R);N&&aa.setFeatureAttribute(ka,N);X&&aa.setColor(ka,X);W=new G(this,ka,v.perLodInstanceElevationAligner,V);ca&&(W.alignedSampledElevation=
T.sampledElevation);W.needsElevationUpdates=u.needsElevationUpdates3D(V.mode);A.extendPointGraphicElevationContext(W,P,this._context.elevationProvider);return W};F._computeGlobalTransform=function(N,P,U,V){P=u.evaluateElevationAlignmentAtPoint(N,this._context.elevationProvider,P,this._context.renderCoordsHelper,V);K[0]=N.x;K[1]=N.y;K[2]=P;g.computeLinearTransformation(N.spatialReference,K,U,this._context.renderCoordsHelper.spatialReference);return U};F._computeLocalTransform=function(N,P,U,V){f.identity(V);
this._applyObjectRotation(U,!1,V);this._applyObjectRotation(P,!0,V);this._applyObjectScale(N,U,V);this._applyAnchor(N,P,V);return V};F._applyObjectScale=function(N,P,U){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(N=m.computeObjectScale(this._drivenProperties.size&&P.size?P.size:N.symbolSize,N.symbolSize,N.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===N[0]&&1===N[1]&&1===N[2]||f.scale(U,U,N))};F.prepareSymbolLayerPatch=function(N){if("partial"===N.diff.type){var P=
N.diff.diff;this._preparePatchTransform(N,P);this._preparePatchColor(N,P)}};F.updateGeometry=function(N,P){if(r.isNone(this._resources))return!0;const U=P&&A.placePointOnGeometry(P);if(r.isNone(U))return!1;P=this.getGeometryElevationMode(P);if(N.elevationContext.mode!==P)return!1;P=this._requiresTerrainElevation(N.elevationContext);this._computeGlobalTransform(U,N.elevationContext,S,P?T:null);P&&(N.alignedSampledElevation=T.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(N.instanceIndex,
S,!0);A.extendPointGraphicElevationContext(N,U,this._context.elevationProvider);return!0};F._preparePatchTransform=function(N,P){if((P.heading||P.tilt||P.roll||P.width||P.height||P.depth||P.anchor||P.anchorPosition)&&!r.isNone(this._resources)){var U=(ea,Y,Z)=>r.unwrapOr(null!=ea&&"complete"===ea.type?ea.newValue:Y,Z),V=U(P.heading,this.symbolLayer.heading,0),W=U(P.tilt,this.symbolLayer.tilt,0),X=U(P.roll,this.symbolLayer.roll,0),ca=U(P.width,this.symbolLayer.width,void 0),R=U(P.height,this.symbolLayer.height,
void 0),aa=U(P.depth,this.symbolLayer.depth,void 0),ka=U(P.anchor,this.symbolLayer.anchor,void 0);U=U(P.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete P.heading;delete P.tilt;delete P.roll;delete P.width;delete P.height;delete P.depth;delete P.anchor;delete P.anchorPosition;var da={heading:V,tilt:W,roll:X,anchor:ka,anchorPosition:U},fa=this._resources;1===this.loadStatus&&N.symbolLayerStatePatches.push(()=>{fa.symbolSize=c.fromArray(E.objectSymbolLayerSizeWithResourceSize(fa.resourceSize,
{width:ca,height:R,depth:aa,isPrimitive:this.symbolLayer.isPrimitive}))});N.graphics3DGraphicPatches.push((ea,Y)=>{Y=this._computeLocalTransform(fa,da,Y,L);fa.lodRenderer.instanceData.setLocalTransform(ea.instanceIndex,Y,!0)})}};F._preparePatchColor=function(N,P){if(P.material&&"partial"===P.material.type&&(P=P.material.diff,P.color&&"complete"===P.color.type&&null!=P.color.newValue&&null!=P.color.oldValue)){var U=P.color.newValue,V=r.isSome(U)?l.toUnitRGBA(U):n.ONES;delete P.color;var W=this._resources;
r.isNone(W)||N.graphics3DGraphicPatches.push(X=>{this._hasPerInstanceColor()?(W.lodRenderer.instanceData.setColor(X.instanceIndex,V),X=this.setMaterialTransparencyParams({},U)):X=this.setMaterialTransparencyParams({externalColor:V},U);for(const ca of W.stageResources.materials)ca.setParameterValues(X)})}};F._requiresTerrainElevation=function(N){return"absolute-height"!==N.mode};F._applyObjectRotation=function(N,P,U){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&P))return m.computeObjectRotation(N.heading,
N.tilt,N.roll,U)};F._computeAnchor=function(N,P,U){const V=c.create();switch(U.anchor){case "center":e.copy(V,w.center(N));e.negate(V,V);break;case "top":P=w.center(N);e.set(V,-P[0],-P[1],-N[5]);break;case "bottom":P=w.center(N);e.set(V,-P[0],-P[1],-N[2]);break;case "relative":P=w.center(N);N=w.size(N);U=(U=U.anchorPosition)?c.fromValues(U.x,U.y,U.z):c.ZEROS;e.multiply(V,N,U);e.add(V,V,P);e.negate(V,V);break;default:r.isSome(P)?e.negate(V,P):e.copy(V,c.ZEROS)}return V};F._applyAnchor=function(N,P,
U){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(N=this._computeAnchor(N.resourceBoundingBox,N.pivotOffset,P))&&f.translate(U,U,N)};F._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};F._fastVisualVariableConvertOptions=function(N,P,U,V){const W=r.isSome(N)?c.fromArray(w.size(N)):c.ONES;N=r.isSome(N)?this._computeAnchor(N,V,this.symbolLayer):c.ZEROS;V=this._context.renderCoordsHelper.unitInMeters;U=m.computeObjectScale(r.isSome(P)?
P:void 0,P,U,V);const X=c.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:W,symbolSize:r.isSome(P)?P:c.ONES,unitInMeters:V,transformation:{anchor:N,scale:U,rotation:X}}};k._createClass(Q,[{key:"extentPadding",get:function(){return r.isSome(this._resources)?this._resources.extentPadding:0}},{key:"isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",get:function(){return r.get(this._resources,
"lodRenderer")}}]);return Q}(z.Graphics3DSymbolLayer);const K=c.create(),L=p.create(),S=p.create(),M=n.create(),T={verticalDistanceToGround:0,sampledElevation:0};b.Graphics3DObjectSymbolLayer=z;b.default=z;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/symbols/support/symbolLayerUtils3D":function(){define(["exports","../../core/has","../../chunks/vec3f64","../../geometry/support/aaBoundingBox"],function(b,k,a,r){const l=r.fromValues(-.5,-.5,-.5,.5,.5,.5),h=r.fromValues(-.5,-.5,0,.5,.5,
1),d=r.fromValues(-.5,-.5,0,.5,.5,.5);b.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_TETRAHEDRON=d;b.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CUBE=l;b.OBJECT_SYMBOL_LAYER_BOUNDING_BOX_UNIT_CYLINDER=h;b.objectSymbolLayerPrimitiveBoundingBox=function(c){switch(c){case "sphere":case "cube":case "diamond":return l;case "cylinder":case "cone":case "inverted-cone":return h;case "tetrahedron":return d}};b.objectSymbolLayerSizeWithResourceSize=function(c,{isPrimitive:e,width:f,depth:g,height:p}){e=e?10:1;if(null==f&&null==
p&&null==g)return[e*c[0],e*c[1],e*c[2]];f=a.fromValues(f,g,p);let n;for(g=0;3>g;g++)if(p=f[g],null!=p){n=p/c[g];break}for(g=0;3>g;g++)null==f[g]&&(f[g]=c[g]*n);return f};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4f64 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Object3DStateSet ./graphicUtils ./featureExpressionInfoUtils".split(" "),
function(b,k,a,r,l,h,d,c){let e=function(){function q(u,v,y,B){this.graphics3DSymbolLayer=u;this.instanceIndex=v;this.elevationAligner=y;this.elevationContext=B;this.type="lod-instance";this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var m=q.prototype;m.initialize=function(){};m.setVisibility=function(u){const v=this.lodRenderer.instanceData;u!==v.getVisible(this.instanceIndex)&&v.setVisible(this.instanceIndex,u)};m.destroy=function(){null!=this.instanceIndex&&
(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};m.alignWithElevation=function(u,v,y){this.elevationAligner&&(c.setContextFeature(this.elevationContext.featureExpressionInfoContext,y),u=this.elevationAligner(this,this.elevationContext,u,v),null!=u&&(this.alignedSampledElevation=u))};m.getBSRadius=function(){const u=this.lodRenderer;return u.baseBoundingSphere.radius*u.instanceData.getCombinedMaxScaleFactor(this.instanceIndex)};
m.getCenterObjectSpace=function(u=k.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,w);return a.transformMat4(u,this.lodRenderer.baseBoundingSphere.center,w)};m.getBoundingBoxObjectSpace=function(u=l.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,w);const v=this.lodRenderer.baseBoundingBox;l.empty(u);for(let y=0;8>y;++y)a.set(g,0===(y&1)?v[0]:v[3],0===(y&2)?v[1]:v[4],0===(y&4)?v[2]:v[5]),a.transformMat4(g,g,w),l.expandWithVec3(u,
g);return u};m.computeAttachmentOrigin=function(u){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,w);u.render.origin[0]+=w[12];u.render.origin[1]+=w[13];u.render.origin[2]+=w[14];u.render.num++};m.getProjectedBoundingBox=async function(u,v,y,B,x){x=this.getBoundingBoxObjectSpace(x);var C=n;const z=l.isPoint(x)?1:C.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,w);for(var A=0;A<z;A++){const t=C[A];g[0]=x[t[0]];g[1]=x[t[1]];g[2]=x[t[2]];a.transformMat4(g,
g,w);f[3*A]=g[0];f[3*A+1]=g[1];f[3*A+2]=g[2]}if(!u(f,0,z))return null;l.empty(x);u=null;this.calculateRelativeScreenBounds&&(u=this.calculateRelativeScreenBounds());for(C=0;C<3*z;C+=3){for(A=0;3>A;A++)x[A]=Math.min(x[A],f[C+A]),x[A+3]=Math.max(x[A+3],f[C+A]);u&&y.push({location:f.slice(C,C+3),screenSpaceBoundingRect:u})}if(v&&(l.center(x,p),"absolute-height"!==this.elevationContext.mode)){let t;y=d.demResolutionForBoundingBox(x,v);try{t=await v.service.queryElevation(p[0],p[1],B,y,"ground")}catch(D){t=
null}null!=t&&l.offset(x,0,0,-this.alignedSampledElevation+t)}return x};m.addObjectState=function(u,v){0===u&&(u=h.generateObject3DStateId(u),this.addHighlightId(u),v.addExternal(y=>{this.removeHighlightId(y)},u))};m.removeObjectState=function(u){this.highlights&&this.highlights.forEach(v=>u.remove(v))};m.addHighlightId=function(u){this.highlights=this.highlights||new Set;this.highlights.add(u);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};m.removeHighlightId=function(u){this.highlights&&
(this.highlights.delete(u),this.lodRenderer.instanceData.setHighlight(this.instanceIndex,0<this.highlights.size),0===this.highlights.size&&(this.highlights=null))};b._createClass(q,[{key:"lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return q}();const f=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g=k.create(),p=k.create(),n=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],w=r.create();return e})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports",
"../../webgl-engine/lib/lodRendering/LodResources"],function(b,k){function a(l){const h=[];l.stageResources.geometries.forEach((d,c)=>{h.push({material:l.stageResources.materials[c],geometry:d,textures:l.stageResources.textures})});return{components:h,minScreenSpaceRadius:l.lodThreshold,pivotOffset:l.pivotOffset}}function r(l,h=.05){l=k.computeFaceCount(l);return Math.sqrt(l/(h*Math.PI))}b.estimateMinScreenSpaceRadius=r;b.fillEstimatedMinScreenSpaceRadius=function(l){l.levels.forEach(h=>{h.minScreenSpaceRadius||
(h.minScreenSpaceRadius=r(h))})};b.makeLodLevelResources=a;b.makeLodResources=function(l){return{levels:l.map(h=>a(h))}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/devEnvironmentUtils ../../../../chunks/mat4 ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/mat3 ../../support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Geometry ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/lib/Texture ../../glTF/DefaultLoadingContext ../../../../chunks/vec22 ../../../../chunks/vec33 ../../../../chunks/vec43 ../../support/buffer/utils ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../../../chunks/vec42".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t){function D(H){const I=H.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return I?{fileType:"gltf",url:I[1],specifiedLodIndex:null!=I[4]?Number(I[4]):null}:H.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:H,specifiedLodIndex:null}:{fileType:"unknown",url:H,specifiedLodIndex:null}}function E(H,I,J,K){const L=H.model,S=d.create(),M=[],T=new Map,O=new Map;L.lods.forEach((Q,F)=>{if(void 0===K||F===K){var N=0,P={name:Q.name,stageResources:{textures:[],
materials:[],geometries:[]},lodThreshold:k.isSome(Q.lodThreshold)?Q.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:p.empty()};M.push(P);Q.parts.forEach(U=>{var V=U.material+(U.attributes.normal?"_normal":"")+(U.attributes.color?"_color":"")+(U.attributes.texCoord0?"_texCoord0":"")+(U.attributes.tangent?"_tangent":"");const W=L.materials.get(U.material),X=k.isSome(U.attributes.texCoord0);var ca=k.isSome(U.attributes.normal);if(!T.has(V)){if(X){if(k.isSome(W.textureColor)&&!O.has(W.textureColor)){var R=
L.textures.get(W.textureColor);O.set(W.textureColor,new m(R.data,W.textureColor,{...R.parameters,preMultiplyAlpha:!0}))}k.isSome(W.textureNormal)&&!O.has(W.textureNormal)&&(R=L.textures.get(W.textureNormal),O.set(W.textureNormal,new m(R.data,W.textureNormal,{...R.parameters,preMultiplyAlpha:!0})));k.isSome(W.textureOcclusion)&&!O.has(W.textureOcclusion)&&(R=L.textures.get(W.textureOcclusion),O.set(W.textureOcclusion,new m(R.data,W.textureOcclusion,{...R.parameters,preMultiplyAlpha:!0})));k.isSome(W.textureEmissive)&&
!O.has(W.textureEmissive)&&(R=L.textures.get(W.textureEmissive),O.set(W.textureEmissive,new m(R.data,W.textureEmissive,{...R.parameters,preMultiplyAlpha:!0})));k.isSome(W.textureMetallicRoughness)&&!O.has(W.textureMetallicRoughness)&&(R=L.textures.get(W.textureMetallicRoughness),O.set(W.textureMetallicRoughness,new m(R.data,W.textureMetallicRoughness,{...R.parameters,preMultiplyAlpha:!0})))}R=Math.pow(W.color[0],1/q.COLOR_GAMMA);var aa=Math.pow(W.color[1],1/q.COLOR_GAMMA),ka=Math.pow(W.color[2],1/
q.COLOR_GAMMA),da=Math.pow(W.emissiveFactor[0],1/q.COLOR_GAMMA),fa=Math.pow(W.emissiveFactor[1],1/q.COLOR_GAMMA);const ea=Math.pow(W.emissiveFactor[2],1/q.COLOR_GAMMA);T.set(V,new q.DefaultMaterial({...I,transparent:"BLEND"===W.alphaMode,textureAlphaMode:G(W.alphaMode),textureAlphaCutoff:W.alphaCutoff,diffuse:[R,aa,ka],ambient:[R,aa,ka],opacity:W.opacity,doubleSided:W.doubleSided,doubleSidedType:"winding-order",cullFace:W.doubleSided?0:2,vertexColors:!!U.attributes.color,vertexTangents:!!U.attributes.tangent,
normals:ca?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:k.isSome(W.textureColor)&&X?O.get(W.textureColor).id:void 0,colorMixMode:W.colorMixMode,normalTextureId:k.isSome(W.textureNormal)&&X?O.get(W.textureNormal).id:void 0,textureAlphaPremultiplied:!0,occlusionTextureId:k.isSome(W.textureOcclusion)&&X?O.get(W.textureOcclusion).id:void 0,emissiveTextureId:k.isSome(W.textureEmissive)&&X?O.get(W.textureEmissive).id:void 0,metallicRoughnessTextureId:k.isSome(W.textureMetallicRoughness)&&
X?O.get(W.textureMetallicRoughness).id:void 0,emissiveFactor:[da,fa,ea],mrrFactors:[W.metallicFactor,W.roughnessFactor,I.mrrFactors[2]],isSchematic:!1,...J},V))}a:{ca=U.indices||U.attributes.position.count;switch(U.primitiveType){case 4:ca=z.trianglesToTriangles(ca);break a;case 5:ca=z.triangleStripToTriangles(ca);break a;case 6:ca=z.triangleFanToTriangles(ca);break a}ca=void 0}R=ca;aa={};ka={};ca=U.attributes.position.count;da=x.createBuffer(f.BufferViewVec3f,ca);g.transformMat4(da,U.attributes.position,
U.transform);ka.position={data:da.typedBuffer,size:da.elementCount};aa.position=R;k.isSome(U.attributes.normal)&&(da=x.createBuffer(f.BufferViewVec3f,ca),e.normalFromMat4(S,U.transform),g.transformMat3(da,U.attributes.normal,S),ka.normal={data:da.typedBuffer,size:da.elementCount},aa.normal=R);k.isSome(U.attributes.tangent)&&(da=x.createBuffer(f.BufferViewVec4f,ca),e.normalFromMat4(S,U.transform),t.transformMat3(da,U.attributes.tangent,S),ka.tangent={data:da.typedBuffer,size:da.elementCount},aa.tangent=
R);k.isSome(U.attributes.texCoord0)&&(da=x.createBuffer(f.BufferViewVec2f,ca),v.normalizeIntegerBuffer(da,U.attributes.texCoord0),ka.uv0={data:da.typedBuffer,size:da.elementCount},aa.uv0=R);k.isSome(U.attributes.color)&&(da=x.createBuffer(f.BufferViewVec4u8,ca),4===U.attributes.color.elementCount?U.attributes.color instanceof f.BufferViewVec4f?t.scale(da,U.attributes.color,255):U.attributes.color instanceof f.BufferViewVec4u8?B.copy(da,U.attributes.color):U.attributes.color instanceof f.BufferViewVec4u16&&
t.scale(da,U.attributes.color,1/256):(B.fill(da,255,255,255,255),fa=new f.BufferViewVec3u8(da.buffer,0,4),U.attributes.color instanceof f.BufferViewVec3f?g.scale(fa,U.attributes.color,255):U.attributes.color instanceof f.BufferViewVec3u8?y.copy(fa,U.attributes.color):U.attributes.color instanceof f.BufferViewVec3u16&&g.scale(fa,U.attributes.color,1/256)),ka.color={data:da.typedBuffer,size:da.elementCount},aa.color=R);U=new w(new n.GeometryData(ka,aa),`gltf_${Q.name}_${N++}`);P.stageResources.geometries.push(U);
P.stageResources.materials.push(T.get(V));X&&(k.isSome(W.textureColor)&&P.stageResources.textures.push(O.get(W.textureColor)),k.isSome(W.textureNormal)&&P.stageResources.textures.push(O.get(W.textureNormal)),k.isSome(W.textureOcclusion)&&P.stageResources.textures.push(O.get(W.textureOcclusion)),k.isSome(W.textureEmissive)&&P.stageResources.textures.push(O.get(W.textureEmissive)),k.isSome(W.textureMetallicRoughness)&&P.stageResources.textures.push(O.get(W.textureMetallicRoughness)));P.numberOfVertices+=
ca;V=U.boundingInfo;p.expandWithVec3(P.boundingBox,V.getBBMin());p.expandWithVec3(P.boundingBox,V.getBBMax())})}});return M}function G(H){switch(H){case "BLEND":return 0;case "MASK":return 2;case "OPAQUE":return 1;default:return 0}}b.fetch=async function(H,I){var J=D(l.adjustStaticAGOUrl(H));if("wosr"===J.fileType)return H=await (I.cache?I.cache.loadWOSR(J.url,I):A.load(J.url,I)),J=A.processLoadResult(H,I),{lods:[J],referenceBoundingBox:J.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:H.remove};
H=await (I.cache?I.cache.loadGLTF(J.url,I):C.load(new u.DefaultLoadingContext(I.streamDataRequester),J.url,I));var K=k.get(H.model.meta,"ESRI_proxyEllipsoid");if(H.meta.isEsriSymbolResource&&k.isSome(K)&&-1!==H.meta.uri.indexOf("/RealisticTrees/"))a:for(var L=0;L<H.model.lods.length;++L){var S=H.model.lods[L];H.customMeta.esriTreeRendering=!0;for(var M of S.parts){S=M.attributes.normal;if(k.isNone(S))break a;const O=M.attributes.position,Q=O.count,F=a.create(),N=a.create(),P=a.create(),U=x.createBuffer(f.BufferViewVec4u8,
Q),V=x.createBuffer(f.BufferViewVec3f,Q),W=h.invert(c.create(),M.transform);for(let X=0;X<Q;X++){O.getVec(X,N);S.getVec(X,F);r.transformMat4(N,N,M.transform);r.subtract(P,N,K.center);r.divide(P,P,K.radius);const ca=P[2];var T=r.length(P);T=Math.min(.45+.55*T*T,1);r.divide(P,P,K.radius);r.transformMat4(P,P,W);r.normalize(P,P);L+1!==H.model.lods.length&&1<H.model.lods.length&&(-1<ca?r.lerp(P,P,F,.2):r.lerp(P,P,F,Math.min(-4*ca-3.8,1)));V.setVec(X,P);U.set(X,0,255*T);U.set(X,1,255*T);U.set(X,2,255*T);
U.set(X,3,255)}M.attributes.normal=V;M.attributes.color=U}}M=H.meta.isEsriSymbolResource?{usePBR:I.usePBR,isSchematic:!1,treeRendering:H.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:!0,isSchematic:!1,mrrFactors:[0,1,.5]};I={...I.materialParamsMixin,treeRendering:H.customMeta.esriTreeRendering};if(null!=J.specifiedLodIndex)return K=E(H,M,I,J.specifiedLodIndex),L=K[0].boundingBox,0!==J.specifiedLodIndex&&(L=E(H,M,I,0)[0].boundingBox),{lods:K,referenceBoundingBox:L,isEsriSymbolResource:H.meta.isEsriSymbolResource,
isWosr:!1,remove:H.remove};J=E(H,M,I);return{lods:J,referenceBoundingBox:J[0].boundingBox,isEsriSymbolResource:H.meta.isEsriSymbolResource,isWosr:!1,remove:H.remove}};b.gltfToEngineResources=E;b.parseUrl=D;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../core/maybe ../../../core/Error ../../../core/urlUtils ../../../core/promiseUtils ../../../request ../../../core/asyncUtils".split(" "),function(b,k,a,r,l,h,d){let c=
function(){function f(p){this.streamDataRequester=p}var g=f.prototype;g.loadJSON=async function(p,n){return this.load("json",p,n)};g.loadBinary=async function(p,n){return r.isDataProtocol(p)?(l.throwIfAborted(n),r.dataToArrayBuffer(p)):this.load("binary",p,n)};g.loadImage=async function(p,n){return this.load("image",p,n)};g.load=async function(p,n,w){if(k.isNone(this.streamDataRequester))return(await h(n,{responseType:e[p]})).data;p=await d.result(this.streamDataRequester.request(n,p,w));if(!0===
p.ok)return p.value;l.throwIfAbortError(p.error);throw new a("",`Request for resource failed: ${p.error}`);};return f}();const e={image:"image",binary:"array-buffer",json:"json"};b.DefaultLoadingContext=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/vec22":function(){define(["exports","../views/3d/support/buffer/types"],function(b,k){function a(h,d,c){const e=h.typedBuffer;h=h.typedBufferStride;const f=d.typedBuffer,g=d.typedBufferStride;d=c?c.count:d.count;let p=(c&&c.dstIndex?
c.dstIndex:0)*h;c=(c&&c.srcIndex?c.srcIndex:0)*g;for(let n=0;n<d;++n)e[p]=f[c],e[p+1]=f[c+1],p+=h,c+=g}function r(h,d,c){const e=h.typedBuffer,f=h.typedBufferStride,g=d.typedBuffer,p=d.typedBufferStride,n=c?c.count:d.count;let w=(c&&c.dstIndex?c.dstIndex:0)*f,q=(c&&c.srcIndex?c.srcIndex:0)*p;if(k.isInteger(d.elementType))if(c=k.maximumValue(d.elementType),k.isSigned(d.elementType))for(d=0;d<n;++d)e[w]=Math.max(g[q]/c,-1),e[w+1]=Math.max(g[q+1]/c,-1),w+=f,q+=p;else for(d=0;d<n;++d)e[w]=g[q]/c,e[w+
1]=g[q+1]/c,w+=f,q+=p;else a(h,d,c);return h}var l=Object.freeze({__proto__:null,copy:a,normalizeIntegerBuffer:r});b.copy=a;b.normalizeIntegerBuffer=r;b.vec2=l})},"esri/chunks/vec33":function(){define(["exports"],function(b){function k(r,l,h){const d=r.typedBuffer;r=r.typedBufferStride;const c=l.typedBuffer,e=l.typedBufferStride;l=h?h.count:l.count;let f=(h&&h.dstIndex?h.dstIndex:0)*r;h=(h&&h.srcIndex?h.srcIndex:0)*e;for(let g=0;g<l;++g)d[f]=c[h],d[f+1]=c[h+1],d[f+2]=c[h+2],f+=r,h+=e}var a=Object.freeze({__proto__:null,
copy:k});b.copy=k;b.vec3=a})},"esri/chunks/vec43":function(){define(["exports"],function(b){function k(l,h,d){const c=l.typedBuffer;l=l.typedBufferStride;const e=h.typedBuffer,f=h.typedBufferStride;h=d?d.count:h.count;let g=(d&&d.dstIndex?d.dstIndex:0)*l;d=(d&&d.srcIndex?d.srcIndex:0)*f;for(let p=0;p<h;++p)c[g]=e[d],c[g+1]=e[d+1],c[g+2]=e[d+2],c[g+3]=e[d+3],g+=l,d+=f}function a(l,h,d,c,e,f){const g=l.typedBuffer,p=l.typedBufferStride;l=f?f.count:l.count;f=(f&&f.dstIndex?f.dstIndex:0)*p;for(let n=
0;n<l;++n)g[f]=h,g[f+1]=d,g[f+2]=c,g[f+3]=e,f+=p}var r=Object.freeze({__proto__:null,copy:k,fill:a});b.copy=k;b.fill=a;b.vec4=r})},"esri/views/3d/support/buffer/utils":function(){define("exports ./types ../../../../chunks/mat32 ../../../../chunks/mat42 ../../../../chunks/scalar ../../../../chunks/vec22 ../../../../chunks/vec33 ../../../../chunks/vec43".split(" "),function(b,k,a,r,l,h,d,c){b.mat3=a.mat3;b.mat4=r.mat4;b.scalar=l.scalar;b.vec2=h.vec2;b.vec3=d.vec3;b.vec4=c.vec4;b.createBuffer=function(e,
f){return new e(new ArrayBuffer(f*e.ElementCount*k.elementTypeSize(e.ElementType)))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/mat32":function(){define(["exports"],function(b){function k(r,l,h){const d=r.typedBuffer;r=r.typedBufferStride;const c=l.typedBuffer,e=l.typedBufferStride;l=h?h.count:l.count;let f=(h&&h.dstIndex?h.dstIndex:0)*r;h=(h&&h.srcIndex?h.srcIndex:0)*e;for(let g=0;g<l;++g){for(let p=0;9>p;++p)d[f+p]=c[h+p];f+=r;h+=e}}var a=Object.freeze({__proto__:null,copy:k});
b.copy=k;b.mat3=a})},"esri/chunks/mat42":function(){define(["exports"],function(b){function k(r,l,h){const d=r.typedBuffer;r=r.typedBufferStride;const c=l.typedBuffer,e=l.typedBufferStride;l=h?h.count:l.count;let f=(h&&h.dstIndex?h.dstIndex:0)*r;h=(h&&h.srcIndex?h.srcIndex:0)*e;for(let g=0;g<l;++g){for(let p=0;16>p;++p)d[f+p]=c[h+p];f+=r;h+=e}}var a=Object.freeze({__proto__:null,copy:k});b.copy=k;b.mat4=a})},"esri/chunks/scalar":function(){define(["exports"],function(b){function k(l,h,d){const c=
l.typedBuffer;l=l.typedBufferStride;const e=h.typedBuffer,f=h.typedBufferStride;h=d?d.count:h.count;let g=(d&&d.dstIndex?d.dstIndex:0)*l;d=(d&&d.srcIndex?d.srcIndex:0)*f;for(let p=0;p<h;++p)c[g]=e[d],g+=l,d+=f}function a(l,h){const d=l.count;h||(h=new l.TypedArrayConstructor(d));for(let c=0;c<d;c++)h[c]=l.get(c);return h}var r=Object.freeze({__proto__:null,copy:k,makeDense:a});b.copy=k;b.makeDense=a;b.scalar=r})},"esri/views/3d/glTF/loader":function(){define("exports ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource".split(" "),
function(b,k,a,r,l,h,d){function c(m){let u=null;m.json.nodes.forEach(v=>{v=v.extras;k.isSome(v)&&(v.ESRI_proxyEllipsoid||v.ESRI_lod)&&(u=v)});return u}async function e(m,u){async function v(C,z){const A=y.nodes[C];C=m.getNodeTransform(C);n.warnUnsupportedIf(null!=A.weights,"Morph targets are not supported.");if(null!=A.mesh){const t=y.meshes[A.mesh];for(const D of t.primitives)await u(D,C,z,t.name)}for(const t of A.children||[])await v(t,z)}const y=m.json;var B=y.scenes[y.scene||0].nodes;const x=
1<B.length;for(const C of B){B=y.nodes[C];const z=[v(C,0)];B.extensions&&B.extensions.MSFT_lod&&Array.isArray(B.extensions.MSFT_lod.ids)&&!x&&z.push(...B.extensions.MSFT_lod.ids.map((A,t)=>v(A,t+1)));await a.all(z)}}function f(m,u,v){const y=x=>{const C=`${v}_tex_${x&&x.id}${x&&x.name?"_"+x.name:""}`;if(x&&!m.textures.has(C)){const z=h.makeTextureSource(x.data,{wrap:{s:g(x.wrapS),t:g(x.wrapT)},mipmap:w.some(A=>A===x.minFilter),noUnpackFlip:!0});m.textures.set(C,z)}return C},B=`${v}_mat_${u.id}_${u.name}`;
m.materials.has(B)||(u=h.makeMaterialParameters({color:[u.color[0],u.color[1],u.color[2]],opacity:u.color[3],alphaMode:u.alphaMode,alphaCutoff:u.alphaCutoff,doubleSided:u.doubleSided,colorMixMode:u.ESRI_externalColorMixMode,textureColor:u.colorTexture?y(u.colorTexture):void 0,textureNormal:u.normalTexture?y(u.normalTexture):void 0,textureOcclusion:u.occlusionTexture?y(u.occlusionTexture):void 0,textureEmissive:u.emissiveTexture?y(u.emissiveTexture):void 0,textureMetallicRoughness:u.metallicRoughnessTexture?
y(u.metallicRoughnessTexture):void 0,emissiveFactor:[u.emissiveFactor[0],u.emissiveFactor[1],u.emissiveFactor[2]],metallicFactor:u.metallicFactor,roughnessFactor:u.roughnessFactor}),m.materials.set(B,u));return B}function g(m){if(33071===m||33648===m||10497===m)return m;n.error(`Unexpected TextureSampler WrapMode: ${m}`)}let p=0;const n=new l.DefaultErrorContext,w=[9987,9985],q="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ");b.load=async function(m,u,v={}){const y=
await d.Resource.load(m,n,u,v),B=`gltf_${p++}`,x={lods:[],materials:new Map,textures:new Map,meta:c(y)};m=!(!y.json.asset.extras||"symbolResource"!==y.json.asset.extras.ESRI_type);await e(y,async(C,z,A,t)=>{var D=void 0!==C.mode?C.mode:4;a:switch(D){case 4:case 5:case 6:var E=D;break a;default:E=null}k.isNone(E)?n.warnUnsupported("Unsupported primitive mode ("+q[D]+"). Skipping primitive."):y.hasPositions(C)?(D=await y.getMaterial(C,v),z={transform:r.clone(z),attributes:{position:await y.getPositionData(C,
v),normal:null,texCoord0:null,color:null,tangent:null},indices:await y.getIndexData(C,v),primitiveType:E,material:f(x,D,B)},y.hasNormals(C)&&(z.attributes.normal=await y.getNormalData(C,v)),y.hasTangents(C)&&(z.attributes.tangent=await y.getTangentData(C,v)),y.hasTextureCoordinates(C)&&(z.attributes.texCoord0=await y.getTextureCoordinates(C,v)),y.hasVertexColors(C)&&(z.attributes.color=await y.getVertexColors(C,v)),C=null,k.isSome(x.meta)&&k.isSome(x.meta.ESRI_lod)&&"screenSpaceRadius"===x.meta.ESRI_lod.metric&&
(C=x.meta.ESRI_lod.thresholds[A]),x.lods[A]=x.lods[A]||{parts:[],name:t,lodThreshold:C},x.lods[A].parts.push(z)):n.warn("Skipping primitive without POSITION vertex attribute.")});return{model:x,meta:{isEsriSymbolResource:m,uri:y.uri},customMeta:{}}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["exports","../../../core/Logger","../../../core/Error"],function(b,k,a){const r=k.getLogger("esri.views.3d.glTF");k=function(){function l(){}
var h=l.prototype;h.error=function(d){throw new a("gltf-loader-error",d);};h.errorUnsupported=function(d){throw new a("gltf-loader-unsupported-feature",d);};h.errorUnsupportedIf=function(d,c){d&&this.errorUnsupported(c)};h.assert=function(d,c){d||this.error(c)};h.warn=function(d){r.warn(d)};h.warnUnsupported=function(d){this.warn("[Unsupported Feature] "+d)};h.warnUnsupportedIf=function(d,c){d&&this.warnUnsupported(c)};return l}();b.DefaultErrorContext=k;Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/views/3d/glTF/LoaderResult":function(){define(["exports"],function(b){b.makeMaterialParameters=function(k={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...k}};b.makeTextureSource=function(k,a={}){return{data:k,
parameters:{wrap:{s:10497,t:10497,...a.wrap},noUnpackFlip:!0,mipmap:!1,...a}}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../core/compilerUtils ../../../../core/urlUtils ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quatf64 ../../support/buffer/BufferView ../../../../chunks/quat ./BinaryStreamReader ./fillDefaults ./pathUtils ../../../../chunks/scalar".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){function q(t){switch(t.componentType){case 5120:return new e.BufferViewVec2i8(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case 5121:return new e.BufferViewVec2u8(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case 5122:return new e.BufferViewVec2i16(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case 5123:return new e.BufferViewVec2u16(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*
t.entryCount);case 5125:return new e.BufferViewVec2u32(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);case 5126:return new e.BufferViewVec2f(t.raw,t.byteOffset,t.byteStride,t.byteOffset+t.byteStride*t.entryCount);default:k.neverReached(t.componentType)}}async function m(t){return r.create((D,E)=>{const G=new Blob([t]),H=new FileReader;H.onload=()=>{D(JSON.parse(H.result))};H.onerror=I=>{E(I)};H.readAsText(G)})}async function u(t,D){return r.create((E,G)=>{const H=new Blob([t],
{type:D}),I=URL.createObjectURL(H),J=new Image;J.addEventListener("load",()=>{URL.revokeObjectURL(I);"decode"in J?J.decode().then(()=>E(J),()=>E(J)):E(J)});J.addEventListener("error",K=>{URL.revokeObjectURL(I);G(K)});J.src=I})}let v=function(){function t(E,G,H,I,J){this.context=E;this.errorContext=G;this.uri=H;this.json=I;this.glbBuffer=J;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=n.splitURI(this.uri).dirPart;
this.checkVersionSupported();this.checkRequiredExtensionsSupported();G.errorUnsupportedIf(null==I.scenes,"Scenes must be defined.");G.errorUnsupportedIf(null==I.meshes,"Meshes must be defined");G.errorUnsupportedIf(null==I.nodes,"Nodes must be defined.");this.computeNodeParents()}t.load=async function(E,G,H,I){if(a.isDataProtocol(H)){var J=a.dataComponents(H);if("model/gltf-binary"!==J.mediaType)try{const K=JSON.parse(J.isBase64?atob(J.data):J.data);return new t(E,G,H,K)}catch{}J=a.dataToArrayBuffer(H);
if(t.isGLBData(J))return this.fromGLBData(E,G,H,J)}if(H.endsWith(".gltf"))return I=await E.loadJSON(H,I),new t(E,G,H,I);J=await E.loadBinary(H,I);if(t.isGLBData(J))return this.fromGLBData(E,G,H,J);I=await E.loadJSON(H,I);return new t(E,G,H,I)};t.isGLBData=function(E){E=new g.BinaryStreamReader(E);return 4<=E.remainingBytes()&&1179937895===E.readUint32()};t.fromGLBData=async function(E,G,H,I){I=await t.parseGLBData(G,I);return new t(E,G,H,I.json,I.binaryData)};t.parseGLBData=async function(E,G){const H=
new g.BinaryStreamReader(G);E.assert(12<=H.remainingBytes(),"GLB binary data is insufficiently large.");var I=H.readUint32(),J=H.readUint32();const K=H.readUint32();E.assert(1179937895===I,"Magic first 4 bytes do not fit to expected GLB value.");E.assert(G.byteLength>=K,"GLB binary data is smaller than header specifies.");E.errorUnsupportedIf(2!==J,"An unsupported GLB container version was detected. Only version 2 is supported.");G=0;let L,S;for(;8<=H.remainingBytes();)I=H.readUint32(),J=H.readUint32(),
0===G?(E.assert(1313821514===J,"First GLB chunk must be JSON."),E.assert(0<=I,"No JSON data found."),L=await m(H.readUint8Array(I))):1===G?(E.errorUnsupportedIf(5130562!==J,"Second GLB chunk expected to be BIN."),S=H.readUint8Array(I)):E.warnUnsupported("More than 2 GLB chunks detected. Skipping."),G+=1;L||E.error("No GLB JSON chunk detected.");return{json:L,binaryData:S}};var D=t.prototype;D.getBuffer=async function(E,G){const H=this.json.buffers[E],I=this.errorContext;if(null==H.uri)return I.assert(null!=
this.glbBuffer,"GLB buffer not present"),this.glbBuffer;let J=this.bufferCache.get(E);J||(G=await this.context.loadBinary(this.resolveUri(H.uri),G),J=new Uint8Array(G),this.bufferCache.set(E,J),I.assert(J.byteLength===H.byteLength,"Buffer byte lengths should match."));return J};D.getAccessor=async function(E,G){E=this.json.accessors[E];var H=this.errorContext;H.errorUnsupportedIf(null==E.bufferView,"Some accessor does not specify a bufferView.");H.errorUnsupportedIf(E.type in["MAT2","MAT3","MAT4"],
`AttributeType ${E.type} is not supported`);H=this.json.bufferViews[E.bufferView];G=await this.getBuffer(H.buffer,G);const I=C[E.type],J=z[E.componentType],K=I*J,L=H.byteStride||K;return{raw:G.buffer,byteStride:L,byteOffset:G.byteOffset+(H.byteOffset||0)+(E.byteOffset||0),entryCount:E.count,isDenselyPacked:L===K,componentCount:I,componentByteSize:J,componentType:E.componentType,min:E.min,max:E.max,normalized:!!E.normalized}};D.getIndexData=async function(E,G){if(null==E.indices)return null;E=await this.getAccessor(E.indices,
G);if(E.isDenselyPacked)switch(E.componentType){case 5121:return new Uint8Array(E.raw,E.byteOffset,E.entryCount);case 5123:return new Uint16Array(E.raw,E.byteOffset,E.entryCount);case 5125:return new Uint32Array(E.raw,E.byteOffset,E.entryCount)}else switch(E.componentType){case 5121:return w.makeDense(this.wrapAccessor(e.BufferViewUint8,E));case 5123:return w.makeDense(this.wrapAccessor(e.BufferViewUint16,E));case 5125:return w.makeDense(this.wrapAccessor(e.BufferViewUint32,E))}};D.getPositionData=
async function(E,G){const H=this.errorContext;H.errorUnsupportedIf(null==E.attributes.POSITION,"No POSITION vertex data found.");E=await this.getAccessor(E.attributes.POSITION,G);H.errorUnsupportedIf(5126!==E.componentType,"Expected type FLOAT for POSITION vertex attribute, but found "+A[E.componentType]);H.errorUnsupportedIf(3!==E.componentCount,"POSITION vertex attribute must have 3 components, but found "+E.componentCount.toFixed());return this.wrapAccessor(e.BufferViewVec3f,E)};D.getNormalData=
async function(E,G){const H=this.errorContext;H.assert(null!=E.attributes.NORMAL,"No NORMAL vertex data found.");E=await this.getAccessor(E.attributes.NORMAL,G);H.errorUnsupportedIf(5126!==E.componentType,"Expected type FLOAT for NORMAL vertex attribute, but found "+A[E.componentType]);H.errorUnsupportedIf(3!==E.componentCount,"NORMAL vertex attribute must have 3 components, but found "+E.componentCount.toFixed());return this.wrapAccessor(e.BufferViewVec3f,E)};D.getTangentData=async function(E,G){const H=
this.errorContext;H.assert(null!=E.attributes.TANGENT,"No TANGENT vertex data found.");E=await this.getAccessor(E.attributes.TANGENT,G);H.errorUnsupportedIf(5126!==E.componentType,"Expected type FLOAT for TANGENT vertex attribute, but found "+A[E.componentType]);H.errorUnsupportedIf(4!==E.componentCount,"TANGENT vertex attribute must have 4 components, but found "+E.componentCount.toFixed());return new e.BufferViewVec4f(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount)};D.getTextureCoordinates=
async function(E,G){const H=this.errorContext;H.assert(null!=E.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");E=await this.getAccessor(E.attributes.TEXCOORD_0,G);H.errorUnsupportedIf(2!==E.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+E.componentCount.toFixed());if(5126===E.componentType)return this.wrapAccessor(e.BufferViewVec2f,E);H.errorUnsupportedIf(!E.normalized,"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");
return q(E)};D.getVertexColors=async function(E,G){const H=this.errorContext;H.assert(null!=E.attributes.COLOR_0,"No COLOR_0 vertex data found.");E=await this.getAccessor(E.attributes.COLOR_0,G);H.errorUnsupportedIf(4!==E.componentCount&&3!==E.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+E.componentCount.toFixed());if(4===E.componentCount){if(5126===E.componentType)return this.wrapAccessor(e.BufferViewVec4f,E);if(5121===E.componentType)return this.wrapAccessor(e.BufferViewVec4u8,
E);if(5123===E.componentType)return this.wrapAccessor(e.BufferViewVec4u16,E)}else if(3===E.componentCount){if(5126===E.componentType)return this.wrapAccessor(e.BufferViewVec3f,E);if(5121===E.componentType)return this.wrapAccessor(e.BufferViewVec3u8,E);if(5123===E.componentType)return this.wrapAccessor(e.BufferViewVec3u16,E)}H.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+A[E.componentType])};D.hasPositions=function(E){return void 0!==E.attributes.POSITION};D.hasNormals=function(E){return void 0!==
E.attributes.NORMAL};D.hasVertexColors=function(E){return void 0!==E.attributes.COLOR_0};D.hasTextureCoordinates=function(E){return void 0!==E.attributes.TEXCOORD_0};D.hasTangents=function(E){return void 0!==E.attributes.TANGENT};D.getMaterial=async function(E,G){const H=this.errorContext;var I=this.materialCache.get(E.material);if(!I){I=null!=E.material?p.material(this.json.materials[E.material]):p.material();const J=I.pbrMetallicRoughness,K=this.hasVertexColors(E);let L;J.baseColorTexture&&(H.errorUnsupportedIf(0!==
(J.baseColorTexture.texCoord||0),"Only TEXCOORD with index 0 is supported."),L=await this.getTexture(J.baseColorTexture.index,G));let S;I.normalTexture&&(0!==(I.normalTexture.texCoord||0)?H.warnUnsupported("Only TEXCOORD with index 0 is supported for the normal map texture."):S=await this.getTexture(I.normalTexture.index,G));let M;I.occlusionTexture&&(0!==(I.occlusionTexture.texCoord||0)?H.warnUnsupported("Only TEXCOORD with index 0 is supported for the occlusion texture."):M=await this.getTexture(I.occlusionTexture.index,
G));let T;I.emissiveTexture&&(0!==(I.emissiveTexture.texCoord||0)?H.warnUnsupported("Only TEXCOORD with index 0 is supported for the emissive texture."):T=await this.getTexture(I.emissiveTexture.index,G));let O;J.metallicRoughnessTexture&&(0!==(J.metallicRoughnessTexture.texCoord||0)?H.warnUnsupported("Only TEXCOORD with index 0 is supported for the metallicRoughness texture."):O=await this.getTexture(J.metallicRoughnessTexture.index,G));I={alphaMode:I.alphaMode,alphaCutoff:I.alphaCutoff,color:J.baseColorFactor,
doubleSided:!!I.doubleSided,colorTexture:L,normalTexture:S,name:I.name,id:null!=E.material?E.material:-1,occlusionTexture:M,emissiveTexture:T,emissiveFactor:I.emissiveFactor,metallicFactor:J.metallicFactor,roughnessFactor:J.roughnessFactor,metallicRoughnessTexture:O,vertexColors:K,ESRI_externalColorMixMode:I.extras.ESRI_externalColorMixMode}}return I};D.getTexture=async function(E,G){var H=this.errorContext,I=this.json.textures[E];const J=p.textureSampler(null!=I.sampler?this.json.samplers[I.sampler]:
{});H.errorUnsupportedIf(null==I.source,"Source is expected to be defined for a texture.");I=this.json.images[I.source];var K=this.textureCache.get(E);K||(I.uri?H=await this.context.loadImage(this.resolveUri(I.uri),G):(H.errorUnsupportedIf(null==I.bufferView,"Image bufferView must be defined."),H.errorUnsupportedIf(null==I.mimeType,"Image mimeType must be defined."),K=this.json.bufferViews[I.bufferView],G=await this.getBuffer(K.buffer,G),H.errorUnsupportedIf(null!=K.byteStride,"byteStride not supported for image buffer"),
H=await u(new Uint8Array(G.buffer,G.byteOffset+(K.byteOffset||0),K.byteLength),I.mimeType)),K={data:H,wrapS:J.wrapS,wrapT:J.wrapT,minFilter:J.minFilter,name:I.name,id:E},this.textureCache.set(E,K));return K};D.getNodeTransform=function(E){if(void 0===E)return B;var G=this.nodeTransformCache.get(E);if(!G){G=this.getNodeTransform(this.getNodeParent(E));const H=this.json.nodes[E];if(H.matrix)G=h.multiply(d.create(),G,H.matrix);else if(H.translation||H.rotation||H.scale)G=d.clone(G),H.translation&&h.translate(G,
G,H.translation),H.rotation&&(x[3]=f.getAxisAngle(x,H.rotation),h.rotate(G,G,x[3],x)),H.scale&&h.scale(G,G,H.scale);this.nodeTransformCache.set(E,G)}return G};D.wrapAccessor=function(E,G){return new E(G.raw,G.byteOffset,G.byteStride,G.byteOffset+G.byteStride*(G.entryCount-1)+G.componentByteSize*G.componentCount)};D.resolveUri=function(E){return a.makeAbsolute(E,this.baseUri)};D.getNodeParent=function(E){return this.nodeParentMap.get(E)};D.checkVersionSupported=function(){const E=l.Version.parse(this.json.asset.version,
"glTF");y.validate(E)};D.checkRequiredExtensionsSupported=function(){const E=this.json,G=this.errorContext;E.extensionsRequired&&0!==E.extensionsRequired.length&&G.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+E.extensionsRequired.join(", "))};D.computeNodeParents=function(){this.json.nodes.forEach((E,G)=>{E.children&&E.children.forEach(H=>{this.nodeParentMap.set(H,G)})})};return t}();const y=new l.Version(2,0,"glTF"),B=h.fromXRotation(d.create(),Math.PI/
2),x=c.create(),C={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},z={[5120]:1,[5121]:1,[5122]:2,[5123]:2,[5126]:4,[5125]:4},A={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};b.Resource=v;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(b,k){let a=function(){function r(h,d,c=""){this.major=h;this.minor=d;this._context=c}var l=r.prototype;l.lessThan=function(h,d){return this.major<h||h===this.major&&
this.minor<d};l.since=function(h,d){return!this.lessThan(h,d)};l.validate=function(h){if(this.major!==h.major)throw new k((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:h});};l.clone=function(){return new r(this.major,this.minor,this._context)};r.parse=function(h,d=""){const [c,e]=h.split(".");var f=/^\s*\d+\s*$/;if(!c||!c.match||!c.match(f))throw new k((d&&
d+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:h});if(!e||!e.match||!e.match(f))throw new k((d&&d+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:h});h=parseInt(c,10);f=parseInt(e,10);return new r(h,f,d)};return r}();b.Version=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],function(b){let k=function(){function a(l){this.data=
l;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}var r=a.prototype;r.readUint32=function(){const l=this.offset4;this.offset4+=1;return this.dataUint32[l]};r.readUint8Array=function(l){const h=4*this.offset4;this.offset4+=l/4;return new Uint8Array(this.data,h,l)};r.remainingBytes=function(){return this.data.byteLength-4*this.offset4};return a}();b.BinaryStreamReader=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports",
"../../../../core/compilerUtils"],function(b,k){const a={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},r={pbrMetallicRoughness:a,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},l={ESRI_externalColorMixMode:"tint"},h={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};b.material=(d={})=>{const c={...a,...d.pbrMetallicRoughness};var e={...l,...d.extras};switch(e.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:k.neverReached(e.ESRI_externalColorMixMode),
e.ESRI_externalColorMixMode="tint"}return{...r,...d,pbrMetallicRoughness:c,extras:e}};b.textureSampler=d=>({...h,...d});Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(b){b.splitURI=function(k){let a,r;k.replace(/^(.*\/)?([^/]*)$/,(l,h,d)=>{a=h||"";r=d||"";return""});return{dirPart:a,filePart:r}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports",
"../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(b,k,a){function r(l){return a.generateDefaultIndexArray(l)}b.linearIndexArray=r;b.triangleFanToTriangles=function(l){var h="number"===typeof l?l:l.length;if(3>h)return new Uint32Array(0);h-=2;const d=new Uint32Array(3*h);if("number"===typeof l){l=0;for(var c=0;c<h;++c)d[l++]=0,d[l++]=c+1,d[l++]=c+2;return d}{c=l[0];let e=l[1],f=0;for(let g=0;g<h;++g){const p=l[g+2];d[f++]=c;d[f++]=e;e=d[f++]=p}return d}};b.triangleStripToTriangles=
function(l){var h="number"===typeof l?l:l.length;if(3>h)return new Uint32Array(0);h-=2;const d=new Uint32Array(3*h);if("number"===typeof l){l=0;for(var c=0;c<h;c+=1)0===c%2?(d[l++]=c,d[l++]=c+1):(d[l++]=c+1,d[l++]=c),d[l++]=c+2}else{c=0;for(let p=0;p<h;p+=1)if(0===p%2){var e=l[p],f=l[p+1],g=l[p+2];d[c++]=e;d[c++]=f;d[c++]=g}else e=l[p+1],f=l[p],g=l[p+2],d[c++]=e,d[c++]=f,d[c++]=g}return d};b.trianglesToTriangles=function(l){return"number"===typeof l?r(l):k.isUint16Array(l)||k.isUint8Array(l)?new Uint32Array(l):
l};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../core/lang ../../../../core/maybe ../../../../core/Logger ../../../../core/Error ../../../../core/promiseUtils ../../../../request ../../../../core/asyncUtils ../../../../chunks/vec3f64 ../../../../core/Version ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Geometry ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/lib/Texture".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){async function u(t,D){const E=a.isSome(D)&&D.streamDataRequester;if(E)return v(t,E,D);t=await c.result(d(t,a.unwrap(D)));if(!0===t.ok)return t.value.data;h.throwIfAbortError(t.error);y(t.error)}async function v(t,D,E){t=await c.result(D.request(t,"json",E));if(!0===t.ok)return t.value;h.throwIfAbortError(t.error);y(t.error.details.url)}function y(t){throw new l("",`Request for object resource failed: ${t}`);}function B(t){const D=g.empty();t.forEach(E=>{E=
E.boundingInfo;g.expandWithVec3(D,E.getBBMin());g.expandWithVec3(D,E.getBBMax())});return D}async function x(t,D){const E=[];for(const H in t){const I=t[H];var G=I.images[0].data;if(!G){z.warn("Externally referenced texture data is not yet supported");continue}G=I.encoding+";base64,"+G;const J="/textureDefinitions/"+H,K={noUnpackFlip:!0,wrap:{s:10497,t:10497},preMultiplyAlpha:!0};G=a.isSome(D)&&D.disableTextures?h.resolve(null):p.requestImage(G,D);E.push(G.then(L=>({refId:J,image:L,params:K,alphaChannelUsage:"rgba"===
I.channels?I.alphaChannelUsage||"transparency":"none"})))}t=await h.all(E);D={};for(const H of t)D[H.refId]=H;return D}function C(t){switch(t){case "mask":return 2;case "maskAndTransparency":return 3;case "none":return 1;case "transparency":return 0;default:return 0}}const z=r.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),A=new f.Version(1,2,"wosr");b.createTextureResources=x;b.load=async function(t,D){t=await u(t,D);D=await x(t.textureDefinitions,D);return{resource:t,textures:D}};
b.processLoadResult=function(t,D){const E=[],G=[],H=[],I=[],J=t.resource;var K=f.Version.parse(J.version||"1.0","wosr");A.validate(K);K=J.model.name;const L=J.model.geometries,S=J.materialDefinitions;t=t.textures;let M=0;const T=new Map;for(let W=0;W<L.length;W++){var O=L[W],Q=O,F=Q.params,N=F.topology;var P=!0;F.vertexAttributes||(z.warn("Geometry must specify vertex attributes"),P=!1);switch(F.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:N=F.faces;if(!N)z.warn("Indexed geometries must specify faces"),
P=!1;else if(F.vertexAttributes)for(const X in F.vertexAttributes)(F=N[X])&&F.values?(null!=F.valueType&&"UInt32"!==F.valueType&&(z.warn(`Unsupported indexed geometry indices type '${F.valueType}', only UInt32 is currently supported`),P=!1),null!=F.valuesPerElement&&1!==F.valuesPerElement&&(z.warn(`Unsupported indexed geometry values per element '${F.valuesPerElement}', only 1 is currently supported`),P=!1)):(z.warn(`Indexed geometry does not specify face indices for '${X}' attribute`),P=!1);break;
default:z.warn(`Unsupported topology '${N}'`),P=!1}Q.params.material||(z.warn("Geometry requires material"),P=!1);Q=Q.params.vertexAttributes;for(const X in Q)Q[X].values||(z.warn("Geometries with externally defined attributes are not yet supported"),P=!1);if(P){P=O.params;P={id:1,material:P.material,texture:P.texture,region:P.texture};F=O.params.vertexAttributes;Q={};for(const X in F)N=F[X],Q[X]={data:N.values,size:N.valuesPerElement};F={};if("PerAttributeArray"===O.params.topology){O=Q.position.data.length/
Q.position.size;N=new Uint32Array(O);for(var U=0;U<O;U++)N[U]=U;O=N;for(const X in Q)F[X]=O}else{O=O.params.faces;for(const X in O)F[X]=new Uint32Array(O[X].values)}if((O=t&&t[P.texture])&&!T.has(P.texture)){const {image:X,params:ca}=O;N=new m(X,K,ca);I.push(N);T.set(P.texture,N)}N=(N=T.get(P.texture))?N.id:void 0;U=H[P.material]?H[P.material][P.texture]:null;if(!U){U=P.material.substring(P.material.lastIndexOf("/")+1);U=S[U].params;1===U.transparency&&(U.transparency=0);var V=O&&O.alphaChannelUsage;
V=0<U.transparency||"transparency"===V||"maskAndTransparency"===V;O={ambient:e.fromArray(U.diffuse),diffuse:e.fromArray(U.diffuse),opacity:1-(U.transparency||0),transparent:V,textureAlphaMode:O?C(O.alphaChannelUsage):void 0,textureAlphaCutoff:.33,textureId:N,initTextureTransparent:!0,doubleSided:!0,cullFace:0,colorMixMode:U.externalColorMixMode||"tint",textureAlphaPremultiplied:!0};a.isSome(D)&&D.materialParamsMixin&&k.mixin(O,D.materialParamsMixin);U=new q.DefaultMaterial(O,K);H[P.material]||(H[P.material]=
{});H[P.material][P.texture]=U}G.push(U);P=new w(new n.GeometryData(Q,F),K);M+=F.position?F.position.length:0;E.push(P)}}return{name:K,stageResources:{textures:I,materials:G,geometries:E},pivotOffset:J.model.pivotOffset,boundingBox:B(E),numberOfVertices:M,lodThreshold:null}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/vec42":function(){define(["exports","../views/3d/support/buffer/math/common"],function(b,k){function a(c,e,f){if(c.count!==e.count)k.logger.error("source and destination buffers need to have the same number of elements");
else{var g=c.count,p=f[0],n=f[1],w=f[2],q=f[3],m=f[4],u=f[5],v=f[6],y=f[7],B=f[8],x=f[9],C=f[10],z=f[11],A=f[12],t=f[13],D=f[14];f=f[15];var E=c.typedBuffer;c=c.typedBufferStride;var G=e.typedBuffer;e=e.typedBufferStride;for(let I=0;I<g;I++){const J=I*c;var H=I*e;const K=G[H],L=G[H+1],S=G[H+2];H=G[H+3];E[J]=p*K+m*L+B*S+A*H;E[J+1]=n*K+u*L+x*S+t*H;E[J+2]=w*K+v*L+C*S+D*H;E[J+3]=q*K+y*L+z*S+f*H}}}function r(c,e,f){if(c.count!==e.count)k.logger.error("source and destination buffers need to have the same number of elements");
else{var g=c.count,p=f[0],n=f[1],w=f[2],q=f[3],m=f[4],u=f[5],v=f[6],y=f[7];f=f[8];var B=c.typedBuffer;c=c.typedBufferStride;var x=e.typedBuffer;e=e.typedBufferStride;for(let z=0;z<g;z++){const A=z*c;var C=z*e;const t=x[C],D=x[C+1],E=x[C+2];C=x[C+3];B[A]=p*t+q*D+v*E;B[A+1]=n*t+m*D+y*E;B[A+2]=w*t+u*D+f*E;B[A+3]=C}}}function l(c,e,f){const g=Math.min(c.count,e.count),p=c.typedBuffer;c=c.typedBufferStride;const n=e.typedBuffer;e=e.typedBufferStride;for(let w=0;w<g;w++){const q=w*c,m=w*e;p[q]=f*n[m];p[q+
1]=f*n[m+1];p[q+2]=f*n[m+2];p[q+3]=f*n[m+3]}}function h(c,e,f){const g=Math.min(c.count,e.count),p=c.typedBuffer;c=c.typedBufferStride;const n=e.typedBuffer;e=e.typedBufferStride;for(let w=0;w<g;w++){const q=w*c,m=w*e;p[q]=n[m]>>f;p[q+1]=n[m+1]>>f;p[q+2]=n[m+2]>>f;p[q+3]=n[m+3]>>f}}var d=Object.freeze({__proto__:null,transformMat4:a,transformMat3:r,scale:l,shiftRight:h});b.scale=l;b.shiftRight=h;b.transformMat3=r;b.transformMat4=a;b.vec4=d})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat4f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec4f64 ../../../../../geometry/support/aaBoundingBox ../DefaultVertexAttributeLocations ../../../support/buffer/glUtil ../Util ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject ../../materials/renderers/utils ../intersectorUtils ../Camera ../../../support/debugFlags ../../materials/internal/MaterialUtil ../../core/shaderLibrary/output/OutputHighlight.glsl ../../materials/DefaultMaterial ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t){function D(Q,F,N,P){q.encodeDoubleVec3(Q.modelOrigin,F,N.modelOriginHi,N.modelOriginLo,P);N.model.copyFrom(P,Q.model,F);N.modelNormal.copyFrom(P,Q.modelNormal,F);Q.color&&N.color&&N.color.copyFrom(P,Q.color,F);Q.featureAttribute&&N.featureAttribute&&N.featureAttribute.copyFrom(P,Q.featureAttribute,F)}let E=function(Q){const F=Q.baseBoundingSphere.radius;Q=Q.levels.map(N=>N.minScreenSpaceRadius);return new A.LevelSelector(F,Q)},G=function(){function Q(N,
P){const U=N.rctx,V=P.geometry;P=P.material;const W=V.data.toRenderData();this.materialRep=N.materialRep;P.setParameterValues({instancedDoublePrecision:!0});N=P.createBufferWriter();const X=N.vertexBufferLayout,ca=N.elementCount(W),R=N.allocate(ca);N.write({},W,R,0);this.geometry=V;this.material=P;this.glMaterials=q.acquireMaterials(P,this.materialRep);this.vertexBufferLayout=X;this.vbo=p.createVertex(U,35044,R.buffer);this.vao=new w(U,e.Default3D,{geometry:f.glLayout(X)},{geometry:this.vbo});this.vertexCount=
ca}var F=Q.prototype;F.destroy=function(){q.releaseMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};F.intersect=function(N,P,U,V,W,X){const ca=this.geometry.id,R=W.toString();this.material.intersect(this.geometry,null,N.transform.transform,N,U,V,(aa,ka,da,fa)=>{if(0<=aa&&(null==P||P(N.rayBeginPoint,N.rayEndPoint,aa))){var ea={type:"external",metadata:{layerUid:X.layerUid,graphicUid:X.graphicUid(W)}};if(null==N.results.min.drapedLayerOrder||fa>=N.results.min.drapedLayerOrder)if(null==
N.results.min.dist||aa<N.results.min.dist)N.results.min.set(ea,R,aa,ka,N.transform.transform,fa,null,ca,da),N.results.min.intersector="LodRenderer";0!==N.options.store&&(null==N.results.max.drapedLayerOrder||fa>=N.results.max.drapedLayerOrder)&&(null==N.results.max.dist||aa>N.results.max.dist)&&(N.results.max.set(ea,R,aa,ka,N.transform.transform,fa,null,ca,da),N.results.min.intersector="LodRenderer");if(2===N.options.store){const Y=new m.IntersectorResult(N.results.min.ray);Y.set(ea,R,aa,ka,N.transform.transform,
fa,null,ca,da);Y.intersector="LodRenderer";N.results.all.push(Y)}}})};k._createClass(Q,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return Q}(),H=function(){function Q(N,P){this.components=[];this.minScreenSpaceRadius=P.minScreenSpaceRadius;P.components.forEach(U=>{this.components.push(new G(N,U))})}var F=Q.prototype;F.destroy=function(){this.components.forEach(N=>{N.destroy()})};F.intersect=function(N,P,
U,V,W,X){this.components.forEach(ca=>{ca.intersect(N,P,U,V,W,X)})};k._createClass(Q,[{key:"boundingBox",get:function(){if(!this._boundingBox){const N=c.empty();this.components.forEach(P=>{c.expandWithVec3(N,P.boundingInfo.bbMin);c.expandWithVec3(N,P.boundingInfo.bbMax)});this._boundingBox=N}return this._boundingBox}},{key:"boundingSphere",get:function(){if(!this._boundingSphere){const N=this.boundingBox,P=a.create();c.center(N,P);this._boundingSphere={center:P,radius:.5*c.diameter(N)}}return this._boundingSphere}},
{key:"triangleCount",get:function(){return this.components.reduce((N,P)=>N+P.triangleCount,0)}}]);return Q}(),I=function(){function Q(N,P,U,V){this.type="Lod";this.isGround=!1;this._inverseViewport=h.create();this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new u;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.canRender=!0;this._symbol=N;this._optionalFields=P;
this._metadata=U;this._instanceBufferLayout=x.DefaultMaterial.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:P});this._glInstanceBufferLayout=f.glLayout(this._instanceBufferLayout,{divisor:1});this._instanceData=new C.InstanceData(this._optionalFields,V);this._instanceData.on("instance-added",()=>{this.requestUpdateCycle()});this._instanceData.on("instance-removed",()=>{this.requestUpdateCycle()});this._instanceData.on("instance-transform-changed",W=>{this.requestUpdateCycle();this._metadata.notifyGraphicUpdate(W.index,
2)});this._instanceData.on("instance-visibility-changed",W=>{this.requestUpdateCycle(!0);this._metadata.notifyGraphicUpdate(W.index,1)});this._instanceData.on("instance-highlight-changed",()=>{this.requestUpdateCycle(!0)});this._enableLevelSelection=1<this._symbol.levels.length;J.push(this)}var F=Q.prototype;F.destroy=function(){J.splice(J.indexOf(this),1)};F.initializeRenderContext=function(N){this._initContext=N;const P=N.rctx;this._symbol.levels.forEach(U=>{this._levels.push(new H(N,U));this._renderInstanceData.push(new t.RenderInstanceData(P,
this._instanceBufferLayout));this._highlightRenderInstanceData.push(new t.RenderInstanceData(P,this._instanceBufferLayout))});this._levelSelector=E(this)};F.uninitializeRenderContext=function(){this.invalidateOctree();this._levels.forEach(N=>{N.destroy()});this._renderInstanceData.forEach(N=>{N.destroy()});this._highlightRenderInstanceData.forEach(N=>{N.destroy()})};F.prepareRender=function(N){this.runUpdates(N)};F.render=function(N){const P=N.rctx,U=4===N.slot?3:6===N.slot?5:null;if(U){if(!this.baseMaterial.isVisible()||
!this.baseMaterial.isVisibleInPass(N.pass))return!1;var V=N.camera;this._inverseViewport[0]=1/V.fullViewport[2];this._inverseViewport[1]=1/V.fullViewport[3];var W={slot:U,origin:[0,0,0],camera:V,inverseViewport:this._inverseViewport,shadowMap:N.shadowMap,shadowMappingEnabled:!!N.shadowMap&&N.shadowMap.enabled,ssaoEnabled:!!N.ssaoHelper&&N.ssaoHelper.enabled,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:N.sliceHelper&&N.sliceHelper.plane,hudVisibilityTexture:N.offscreenRenderingHelper?
N.offscreenRenderingHelper.hudVisibilityTexture:null,highlightDepthTexture:N.offscreenRenderingHelper?N.offscreenRenderingHelper.depthTexture:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrEnabled:!1,lighting:N.scenelightingData,transparencyPassType:N.transparencyPassType};P.bindVAO();for(let X=0;X<this._levels.length;++X){const ca=N.isHighlightPass?this._highlightRenderInstanceData[X]:this._renderInstanceData[X];
this._levels[X].components.forEach(R=>{this.renderComponent(N,U,W,ca,R,X)})}return!0}};F.intersect=function(N,P,U,V){if(this.baseMaterial.isVisible()){var W=a.create();r.subtract(W,V,U);var X=ca=>{this._instanceData.getCombinedModelTransform(ca,S);N.transform.set(S);r.transformMat4(M,U,N.transform.inverse);r.transformMat4(T,V,N.transform.inverse);const R=this._instanceData.getState(ca),aa=this._instanceData.getLodLevel(ca);g.assert(R&C.StateFlags.ACTIVE,"invalid instance state");g.assert(0<=aa&&aa<
this._levels.length,"invaid lod level");this._levels[aa].intersect(N,P,M,T,ca,this._metadata)};this.baseMaterial.params.verticalOffset?this.octree.forEach(X):this.octree.forEachAlongRay(U,W,X)}};F.queryDepthRange=function(N){return this.queryDepthRangeOctree(N)};F.notifyShaderTransformationChanged=function(){this.invalidateOctree()};F.requestUpdateCycle=function(N=!1){this._updateCyclesWithStaticCamera=-1;N&&(this._needFullCycle=!0);this.needsUpdates&&this._initContext.requestRender()};F.runUpdates=
function(N){if(!v.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var P=N.equals(this._lastCamera);this._lastCamera.copyFrom(N);P||this.requestUpdateCycle()}P=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(N,P);this.needsUpdates&&this._initContext.requestRender()}};F.invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};F.buildOctree=function(){const N=new z.InstanceOctree(this._instanceData,this.baseBoundingSphere);
var P=this._instanceData;P=P.view?P.view.state:null;for(let U=0;U<this._instanceData.capacity;++U)P.get(U)&C.StateFlags.ACTIVE&&N.addInstance(U);return N};F.queryDepthRangeOctree=function(N){var P=N.eye;const U=N.viewForward;var V=this.octree.findClosest(U,"front-to-back",N.frustum);const W=this.octree.findClosest(U,"back-to-front",N.frustum);return null!=V&&null!=W?(this._instanceData.view.boundingSphere.getVec(V,L),r.subtract(L,L,P),V=r.dot(L,U)-L[3],this._instanceData.view.boundingSphere.getVec(W,
L),r.subtract(L,L,P),P=r.dot(L,U)+L[3],{near:Math.max(N.near,V),far:Math.min(N.far,P)}):{near:Infinity,far:-Infinity}};F.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._renderInstanceData.forEach(N=>{N.startUpdateCylce()});this._highlightRenderInstanceData.forEach(N=>{N.startUpdateCylce()});this.needsUpdates&&this._initContext.requestRender()};F.updateInstances=function(N,P){const U=this._enableLevelSelection,V=this._levelSelector;V.updateCamera(N);this._renderInstanceData.forEach(fa=>
{fa.beginUpdate()});this._highlightRenderInstanceData.forEach(fa=>{fa.beginUpdate()});N=this._instanceData;const W=this._instanceData.view,X=N.capacity;let ca=this._instanceIndex;P=Math.min(N.size,P);for(let fa=0;fa<P;++fa){0===ca&&this.startUpdateCycle();const ea=W.state.get(ca);var R=0;if(ea&C.StateFlags.ALLOCATED){var aa=W.lodLevel.get(ca);ea&C.StateFlags.ACTIVE&&this._renderInstanceData[aa].freeTail();ea&C.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[aa].freeTail();if(ea&C.StateFlags.REMOVE)N.freeInstance(ca);
else if(ea&C.StateFlags.VISIBLE){aa=0;U&&(W.modelOrigin.getVec(ca,K),aa=V.selectLevel(K,N.getCombinedMedianScaleFactor(ca)));R=ea&~(C.StateFlags.ACTIVE|C.StateFlags.HIGHLIGHT_ACTIVE|C.StateFlags.TRANSFORM_CHANGED);if(0<=aa){var ka=this._renderInstanceData[aa],da=ka.allocateHead();D(W,ca,ka.view,da);R|=C.StateFlags.ACTIVE;ea&C.StateFlags.HIGHLIGHT&&(ka=this._highlightRenderInstanceData[aa],da=ka.allocateHead(),D(W,ca,ka.view,da),R|=C.StateFlags.HIGHLIGHT_ACTIVE)}W.state.set(ca,R);W.lodLevel.set(ca,
aa)}else R=ea&~(C.StateFlags.ACTIVE|C.StateFlags.HIGHLIGHT_ACTIVE|C.StateFlags.TRANSFORM_CHANGED),W.state.set(ca,R);this._octree&&(aa=!!(ea&C.StateFlags.ACTIVE),R=!!(R&C.StateFlags.ACTIVE),!aa&&R?this._octree.addInstance(ca):aa&&!R?this._octree.removeInstance(ca):aa&&R&&ea&C.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(ca),this._octree.addInstance(ca)));ca=(ca+1)%X}else ca=(ca+1)%X,P++}this._instanceIndex=ca;this._renderInstanceData.forEach(fa=>{fa.endUpdate()});this._highlightRenderInstanceData.forEach(fa=>
{fa.endUpdate()})};F.renderComponent=function(N,P,U,V,W,X){var ca=W.glMaterials.get(N.pass);if(ca&&ca.beginSlot(P)&&0!==V.size){var R=N.rctx,aa=R.capabilities.instancing;ca.ensureParameters(U);var ka=ca.getTechnique();P=ca.getPipelineState(P);R.setPipelineState(P);ca.bind(R,U);R.bindVAO(W.vao);ka.ensureAttributeLocations(W.vao);ca=ka.program;N.isHighlightPass&&B.OutputHighlight.bindOutputHighlight(R,ca,U);ka.bindDraw(U);v.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&0===N.pass&&(ca.setUniform4fv("externalColor",
O[Math.min(X,O.length-1)]),ca.setUniform1i("colorMixMode",y.colorMixModes.replace));N=V.capacity;U=V.headIndex;X=V.tailIndex;ca=V.firstIndex;var da=this._glInstanceBufferLayout;P=(fa,ea)=>{n.bindVertexBufferLayout(R,e.Default3D,V.buffer,da,fa);aa.drawArraysInstanced(ka.primitiveType,0,W.vertexCount,ea-fa);n.unbindVertexBufferLayout(R,e.Default3D,V.buffer,da)};W.material.params.transparent&&null!=ca?U>X?(g.assert(ca>=X&&ca<=U,"invalid firstIndex"),P(ca,U),P(X,ca)):U<X&&(ca<=U?(g.assert(0<=ca&&ca<=
U,"invalid firstIndex"),P(ca,U),P(X,N),P(0,ca)):(g.assert(ca>=X&&ca<=N,"invalid firstIndex"),P(ca,N),P(0,U),P(X,ca))):U>X?P(X,U):U<X&&(P(0,U),P(X,N));R.bindVAO(null)}};k._createClass(Q,[{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-
1].components[0].material}},{key:"slicePlane",get:function(){return this._slicePlane},set:function(N){this._slicePlane=N}},{key:"intersectionHandlerId",get:function(){return this._metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){const N={cpu:0,gpu:0};this._renderInstanceData.forEach(P=>{P=P.memoryUsage;N.cpu+=P.cpu;N.gpu+=P.gpu});this._highlightRenderInstanceData.forEach(P=>{P=P.memoryUsage;N.cpu+=P.cpu;N.gpu+=P.gpu});return N}},
{key:"renderStats",get:function(){const N=this._instanceData.size,P=[];this._levels.forEach((U,V)=>{V=this._renderInstanceData[V].size+this._highlightRenderInstanceData[V].size;U=U.triangleCount;P.push({renderedInstances:V,renderedTriangles:V*U,trianglesPerInstance:U})});return{totalInstances:N,renderedInstances:P.reduce((U,V)=>U+V.renderedInstances,0),renderedTriangles:P.reduce((U,V)=>U+V.renderedTriangles,0),levels:P}}},{key:"slots",get:function(){return[4,6]}},{key:"needsHighlight",get:function(){return 0<
this._highlightRenderInstanceData.reduce((N,P)=>N+P.size,0)}},{key:"needsUpdates",get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}},{key:"octree",get:function(){this._octree||(this._octree=this.buildOctree());return this._octree}}]);return Q}();const J=[],K=a.create(),L=d.create(),S=l.create(),M=a.create(),T=a.create(),O=[[1,0,1,1],[0,0,1,1],[0,1,0,1],[1,1,0,1],[1,0,0,1]];b.LodComponentData=G;b.LodLevelData=H;b.LodRenderer=I;b.lodRenderers=J;b.setLevelSelectorFactory=
function(Q){E=Q};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/mathUtils ../../../../../chunks/mat4 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/mat3 ../../../support/buffer/BufferView ../../../support/buffer/InterleavedLayout ../Util".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){(function(y){y[y.ALLOCATED=1]="ALLOCATED";y[y.ACTIVE=2]="ACTIVE";y[y.VISIBLE=4]="VISIBLE";y[y.HIGHLIGHT=8]="HIGHLIGHT";y[y.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";y[y.REMOVE=32]="REMOVE";y[y.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(b.StateFlags||(b.StateFlags={}));let w=function(y){this.localTransform=y.getField("localTransform",g.BufferViewMat4f64);this.globalTransform=y.getField("globalTransform",g.BufferViewMat4f64);this.modelOrigin=y.getField("modelOrigin",
g.BufferViewVec3f64);this.model=y.getField("model",g.BufferViewMat3f);this.modelNormal=y.getField("modelNormal",g.BufferViewMat3f);this.modelScaleFactors=y.getField("modelScaleFactors",g.BufferViewVec2f);this.boundingSphere=y.getField("boundingSphere",g.BufferViewVec4f64);this.color=y.getField("color",g.BufferViewVec4f);this.featureAttribute=y.getField("featureAttribute",g.BufferViewVec4f);this.state=y.getField("state",g.BufferViewUint8);this.lodLevel=y.getField("lodLevel",g.BufferViewUint8)};a=function(y){function B(C,
z){var A=y.call(this)||this;A._capacity=0;A._size=0;A._next=0;{let t=p.newLayout().mat4f64("localTransform").mat4f64("globalTransform").vec4f64("boundingSphere").vec3f64("modelOrigin").mat3f("model").mat3f("modelNormal").vec2f("modelScaleFactors");0<=C.indexOf("color")&&(t=t.vec4f("color"));0<=C.indexOf("featureAttribute")&&(t=t.vec4f("featureAttribute"));C=t=t.u8("state").u8("lodLevel").alignTo(8)}A._layout=C;A._shaderTransformation=z;return A}k._inheritsLoose(B,y);var x=B.prototype;x.addInstance=
function(){this._size+1>this._capacity&&this.grow();const C=this.findSlot();this._view.state.set(C,b.StateFlags.ALLOCATED);this._size++;this.emit("instance-added",{index:C});return C};x.removeInstance=function(C){const z=this._view.state;n.assert(0<=C&&C<this._capacity&&z.get(C)&b.StateFlags.ALLOCATED,"invalid instance handle");this.getStateFlag(C,b.StateFlags.ACTIVE)?this.setStateFlags(C,b.StateFlags.REMOVE):this.freeInstance(C);this.emit("instance-removed",{index:C})};x.freeInstance=function(C){const z=
this._view.state;n.assert(0<=C&&C<this._capacity&&z.get(C)&b.StateFlags.ALLOCATED,"invalid instance handle");z.set(C,0);this._size--};x.setLocalTransform=function(C,z,A=!0){this._view.localTransform.setMat(C,z);A&&this.updateModelTransform(C)};x.getLocalTransform=function(C,z){this._view.localTransform.getMat(C,z)};x.setGlobalTransform=function(C,z,A=!0){this._view.globalTransform.setMat(C,z);A&&this.updateModelTransform(C)};x.getGlobalTransform=function(C,z){this._view.globalTransform.getMat(C,z)};
x.updateModelTransform=function(C){const z=this._view;var A=q;const t=m;z.localTransform.getMat(C,u);z.globalTransform.getMat(C,v);const D=d.multiply(v,v,u);l.set(A,D[12],D[13],D[14]);z.modelOrigin.setVec(C,A);f.fromMat4(t,D);z.model.setMat(C,t);A=h.scaleFromMatrix(q,D);A.sort();z.modelScaleFactors.set(C,0,A[1]);z.modelScaleFactors.set(C,1,A[2]);f.invert(t,t);f.transpose(t,t);z.modelNormal.setMat(C,t);this.setStateFlags(C,b.StateFlags.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:C})};
x.getModelTransform=function(C,z){const A=this._view;A.model.getMat(C,m);A.modelOrigin.getVec(C,q);z[0]=m[0];z[1]=m[1];z[2]=m[2];z[3]=0;z[4]=m[3];z[5]=m[4];z[6]=m[5];z[7]=0;z[8]=m[6];z[9]=m[7];z[10]=m[8];z[11]=0;z[12]=q[0];z[13]=q[1];z[14]=q[2];z[15]=1};x.applyShaderTransformation=function(C,z){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,C,z)};x.getCombinedModelTransform=function(C,z){this.getModelTransform(C,z);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,
C,z);return z};x.getCombinedLocalTransform=function(C,z){this._view.localTransform.getMat(C,z);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,C,z);return z};x.getCombinedMaxScaleFactor=function(C){let z=this._view.modelScaleFactors.get(C,1);this._shaderTransformation&&(C=this._shaderTransformation.scaleFactor(q,this,C),z*=Math.max(C[0],C[1],C[2]));return z};x.getCombinedMedianScaleFactor=function(C){let z=this._view.modelScaleFactors.get(C,0);this._shaderTransformation&&
(C=this._shaderTransformation.scaleFactor(q,this,C),C.sort(),z*=C[1]);return z};x.getModel=function(C,z){this._view.model.getMat(C,z)};x.setFeatureAttribute=function(C,z){this._view.featureAttribute.setVec(C,z)};x.getFeatureAttribute=function(C,z){this._view.featureAttribute.getVec(C,z)};x.setColor=function(C,z){this._view.color.setVec(C,z)};x.getColor=function(C,z){this._view.color.getVec(C,z)};x.setVisible=function(C,z){z!==this.getVisible(C)&&(this.setStateFlag(C,b.StateFlags.VISIBLE,z),this.emit("instance-visibility-changed",
{index:C}))};x.getVisible=function(C){return this.getStateFlag(C,b.StateFlags.VISIBLE)};x.setHighlight=function(C,z){z!==this.getHighlight(C)&&(this.setStateFlag(C,b.StateFlags.HIGHLIGHT,z),this.emit("instance-highlight-changed",{index:C}))};x.getHighlight=function(C){return this.getStateFlag(C,b.StateFlags.HIGHLIGHT)};x.getState=function(C){return this._view.state.get(C)};x.getLodLevel=function(C){return this._view.lodLevel.get(C)};x.countFlags=function(C){let z=0;for(let A=0;A<this._capacity;++A)this.getState(A)&
C&&++z;return z};x.setStateFlags=function(C,z){const A=this._view.state;z|=A.get(C);A.set(C,z)};x.clearStateFlags=function(C,z){const A=this._view.state;z=A.get(C)&~z;A.set(C,z)};x.setStateFlag=function(C,z,A){A?this.setStateFlags(C,z):this.clearStateFlags(C,z)};x.getStateFlag=function(C,z){return!!(this._view.state.get(C)&z)};x.grow=function(){const C=Math.max(1024,Math.floor(2*this._capacity)),z=this._layout.createBuffer(C);if(this._buffer){const A=new Uint8Array(this._buffer.buffer);(new Uint8Array(z.buffer)).set(A)}this._capacity=
C;this._buffer=z;this._view=new w(this._buffer)};x.findSlot=function(){const C=this._view.state;let z=this._next;for(;C.get(z)&b.StateFlags.ALLOCATED;)z=(z+1)%this._capacity;this._next=(z+1)%this._capacity;return z};k._createClass(B,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}}]);return B}(a);const q=r.create(),m=c.create(),u=e.create(),
v=e.create();b.InstanceData=a;b.View=w;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/mathUtils ../../../../../chunks/mat4f64 ../Octree".split(" "),function(b,k,a,r,l,h,d){d=function(c){function e(g,p){var n=c.call(this,{getCenter:w=>{const q=n._instanceData.view.boundingSphere,m=n._tmpCenter;
m[0]=q.get(w,0);m[1]=q.get(w,1);m[2]=q.get(w,2);return m},getRadius:w=>n._instanceData.view.boundingSphere.get(w,3)},{maximumDepth:25})||this;n._tmpCenter=a.create();n._tmpMat4=h.create();n._instanceData=g;n._boundingSphere=p;return n}k._inheritsLoose(e,c);var f=e.prototype;f.addInstance=function(g){const p=this._instanceData.view.boundingSphere;var n=this._instanceData.getCombinedModelTransform(g,this._tmpMat4);const w=r.transformMat4(this._tmpCenter,this._boundingSphere.center,n);n=this._boundingSphere.radius*
l.maxScale(n);p.set(g,0,w[0]);p.set(g,1,w[1]);p.set(g,2,w[2]);p.set(g,3,n);this.add(g)};f.removeInstance=function(g){this.remove(g)};return e}(d);b.InstanceOctree=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports","../Camera"],function(b,k){let a=function(){function r(h,d){this.thresholdScale=1;this._camera=new k;this._worldSpaceRadius=h;this._thresholds=d.map(c=>c)}var l=r.prototype;l.updateCamera=function(h){this._camera.copyFrom(h)};
l.selectLevel=function(h,d){h=this._camera.computeScreenPixelSizeAt(h);d=this._worldSpaceRadius*d/h;h=this._thresholds;let c=-1;for(let e=0;e<h.length;++e)d>=h[e]*this.thresholdScale&&(c=e);return c};return r}();b.LevelSelector=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../support/buffer/BufferView","../Util","./BackedBufferObject"],function(b,
k,a,r,l){let h=function(c){this.modelOriginHi=c.getField("modelOriginHi",a.BufferViewVec3f);this.modelOriginLo=c.getField("modelOriginLo",a.BufferViewVec3f);this.model=c.getField("model",a.BufferViewMat3f);this.modelNormal=c.getField("modelNormal",a.BufferViewMat3f);this.color=c.getField("instanceColor",a.BufferViewVec4f);this.featureAttribute=c.getField("instanceFeatureAttribute",a.BufferViewVec4f)},d=function(){function c(f,g){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=
!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=f;this._instanceBufferLayout=g;this._elementSize=g.stride;this._capacity=1}var e=c.prototype;e.destroy=function(){this._buffer&&this._buffer.destroy()};e.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};e.startUpdateCylce=function(){this._captureFirstIndex=!0};e.beginUpdate=function(){r.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};e.endUpdate=function(){r.assert(this._updating,
"not updating");this.size<.3*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};e.allocateHead=function(){r.assert(this._updating,"not updating");this.isFull&&this.grow();const f=this.headIndex;this._captureFirstIndex&&(this._firstIndex=f,this._captureFirstIndex=!1);this.incrementHead();r.assert(this._headIndex!==this._tailIndex,"invalid pointers");return f};e.freeTail=function(){r.assert(this._updating,
"not updating");r.assert(0<this.size,"invalid size");const f=this._tailIndex===this._firstIndex;this.incrementTail();f&&(this._firstIndex=this._tailIndex)};e.grow=function(){this.resize(Math.max(1024,Math.floor(2*this._capacity)))};e.shrink=function(){this.resize(Math.max(1024,Math.floor(.5*this._capacity)))};e.resize=function(f){r.assert(this._updating,"not updating");if(f!==this._capacity){var g=new l(this._rctx,34962,35044,this._elementSize,f);if(this._buffer){this._firstIndex&&(this._firstIndex=
(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const p=this.size,n=this.compactInstances(g);r.assert(n===p,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=n;this._prevHeadIndex=0}this._resized=!0;this._capacity=f;this._buffer=g;this._view=new h(this._instanceBufferLayout.createView(this._buffer.array))}};e.compactInstances=function(f){const g=this._headIndex,p=this._tailIndex;return p<g?(this._buffer.copyRange(p,g,f),g-p):p>g?(this._buffer.copyRange(p,
this._capacity,f),0<g&&this._buffer.copyRange(0,g,f,this._capacity-p),g+(this._capacity-p)):0};e.incrementHead=function(f=1){this._headIndex=(this._headIndex+f)%this._capacity};e.incrementTail=function(f=1){this._tailIndex=(this._tailIndex+f)%this._capacity};e.transferRange=function(f,g){f<g?this._buffer.transferRange(f,g):f>g&&(0<g&&this._buffer.transferRange(0,g),this._buffer.transferRange(f,this._capacity))};k._createClass(c,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",
get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){const f=this._headIndex,g=this._tailIndex;return f>=g?f-g:f+this._capacity-g}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},
{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}}]);return c}();b.RenderInstanceData=d;b.View=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../webgl/BufferObject"],function(b,k){return function(){function a(l,h,d,c,e){this._elementSize=c;this._buffer=new k(l,h,d);this.resize(e)}var r=a.prototype;r.destroy=
function(){this._buffer.dispose()};r.copyRange=function(l,h,d,c=0){l=new Uint8Array(this.array,l*this.elementSize,(h-l)*this.elementSize);(new Uint8Array(d.array,c*this.elementSize)).set(l)};r.transferAll=function(){this._buffer.setData(this._array)};r.transferRange=function(l,h){l*=this._elementSize;this._buffer.setSubData(this._array,l,l,h*this._elementSize)};r.resize=function(l){const h=l*this._elementSize,d=new ArrayBuffer(h);this._array&&(l>=this._capacity?(new Uint8Array(d)).set(new Uint8Array(this._array)):
(new Uint8Array(d)).set((new Uint8Array(this._array)).subarray(0,l*this._elementSize)));this._array=d;this._buffer.setData(h);this._capacity=l};b._createClass(a,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return a}()})},
"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/lang ../../../../core/maybe ../../../../core/Error ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../chunks/vec3f32 ../../webgl-engine/lib/Object3D ./graphicUtils ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ../../webgl-engine/lib/Geometry ./Graphics3DSymbolLayer ../../webgl-engine/materials/DefaultMaterial ../support/FastSymbolUpdates ../../../../chunks/mat2 ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/PathMaterial".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D){function E(T,O,Q){switch(O){case "world":for(const F of T.vertices)c.add(L,F.pos,T.offset),Q.worldUpAtPosition(L,K),F.setFrameFromUpVector(K),F.computeRotationAxisAndAngleFromUpVector();break;case "path":c.add(L,T.vertices[0].pos,T.offset);Q.worldUpAtPosition(L,K);t.computeMinimumRotationTangentFrame(T,K);for(const F of T.vertices)T=h.sign(c.dot(F.frame.right,F.vRight)),c.cross(F.rotationFrame.up,F.vRight,F.vLeft),c.scale(F.rotationFrame.up,
F.rotationFrame.up,T),c.normalize(F.rotationFrame.up,F.rotationFrame.up),O=c.dot(F.rotationFrame.up,F.frame.up),Q=c.dot(F.rotationFrame.up,F.frame.right),c.scale(L,F.frame.up,-Q),c.scale(S,F.frame.right,O),c.add(L,L,S),c.normalize(F.rotationFrame.right,L),t.vertexSpaceToProfileSpace(F.rotationRight,F.frame,F.rotationFrame.right),c.negate(L,F.vLeft),F.rotationAngle=-T*(Math.PI-h.acosClamped(c.dot(L,F.vRight))),0<Math.abs(F.rotationAngle)&&(T=h.reciprocalClamped(Math.cos(.5*F.rotationAngle)),A.set(F.miterStretch,
1+(T-1)*F.rotationRight[0]*F.rotationRight[0],(T-1)*F.rotationRight[0]*F.rotationRight[1],(T-1)*F.rotationRight[0]*F.rotationRight[1],1+(T-1)*F.rotationRight[1]*F.rotationRight[1])),F.maxStretchDistance=Math.abs(Math.min(F.vLeftLength,F.vRightLength)*h.reciprocalClamped(Math.cos(.5*(Math.PI-F.rotationAngle))))}}function G(T,O,Q){switch(T){case "symbol-value":return Q;case "proportional":return O;default:return T}}function H(T,O,Q,F){T=T.stageObject;const N=T.geometryRecords,P=N.length;var U=0;J.spatialReference=
F.spatialReference;for(let R=0;R<P;R++){const aa=N[R].geometry,ka=aa.metadata,da=ka.pathGeometry,fa=da.builder.path;{var V=fa;var W=O,X=Q,ca=F;let ea=0;for(const Y of V.vertices){const Z=u.evaluateElevationAlignmentAtPoint(Y.posES,X,W,ca,M);ea+=M.sampledElevation;c.add(K,Y.pos,V.offset);ca.setAltitude(Z,K);c.subtract(Y.pos,K,V.offset)}V.updatePathVertexInformation();V=ea/V.vertices.length}U+=V;"world"!==fa.upVector&&E(fa,ka.upVectorAlignment,F);da.onPathChanged();aa.invalidateBoundingInfo();T.geometryVertexAttrsUpdated(R)}return U/
P}let I=function(T){function O(F,N,P,U){F=T.call(this,F,N,P,U)||this;F._intrinsicSize=f.fromValues(1,1);F.upVectorAlignment="path";F.stencilWidth=.1;F.ensureDrapedStatus(!1);return F}k._inheritsLoose(O,T);var Q=O.prototype;Q.doLoad=async function(){const F=r.isSome(this.symbolLayer.width)?this.symbolLayer.width:r.isSome(this.symbolLayer.height)?this.symbolLayer.height:this.symbolLayer.size,N=r.isSome(this.symbolLayer.height)?this.symbolLayer.height:F;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[F,
1,N],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?z.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};var P=this.symbolLayer.anchor||"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&
(this.upVectorAlignment="world");var U=this.symbolLayer.profile||"circle";switch(U){default:this._profile=t.Profile.circle(10);break;case "quad":this._profile=t.Profile.rect()}var V=[0,0];"center"!==P&&(V={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[P],this._profile.translate(V[0],V[1]));switch(this.symbolLayer.join||"simple"){case "round":this._extruder=new t.MiterExtruder(0,3);break;case "bevel":this._extruder=new t.MiterExtruder(0,1);break;case "miter":this._extruder=new t.MiterExtruder(.8*
Math.PI,1);break;default:this._extruder=new t.SimpleExtruder}P=this.symbolLayer.cap||"butt";switch(P){case "none":this._startCap=new t.NoCapBuilder;this._endCap=new t.NoCapBuilder;break;default:this._startCap=new t.TriangulationCapBuilder(this._profile,0);this._endCap=new t.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new t.TriangulationCapBuilder(this._profile,-.5);this._endCap=new t.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":U="quad"===U?!0:
!1,this._startCap=new t.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:U,subdivisions:3}),this._endCap=new t.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:U,subdivisions:3})}U=this._getIdHint();V=r.get(this.symbolLayer,"material","color");var W=this._getCombinedOpacityAndColor(V);V=d.fromArray(W);W=W[3];P={diffuse:V,ambient:V,opacity:W,transparent:1>W||this.needsDrivenTransparentPass,vertexColors:!1,slicePlaneEnabled:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,
cullFace:"none"===P?0:void 0,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(g.set(this._intrinsicSize,F,N),!m.isValidSize(this._intrinsicSize[0])||!m.isValidSize(this._intrinsicSize[1])))throw new l("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||g.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates.enabled?(a.mixin(P,
this._fastUpdates.materialParameters,{size:[this._intrinsicSize[0],this._intrinsicSize[1],0]}),this._material=new D.PathMaterial(P,`${U}_pathmat`)):(P.vertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new C.DefaultMaterial(P,`${U}_pathmat`));this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(3,this._material)};Q.destroy=function(){T.prototype.destroy.call(this);this._material&&(this._context.stage.remove(3,
this._material.id),this._material=null)};Q.createGraphics3DGraphic=function(F){const N=F.graphic;if(!this._validateGeometryType(N.geometry,O.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(N.geometry))return null;const P="graphic"+N.uid,U=this.setGraphicElevationContext(N,new v.ElevationContext);return this._createAs3DShape(N,F.renderingInfo,U,P,N.uid)};Q.layerOpacityChanged=function(){var F=r.get(this.symbolLayer,"material","color");F=this._getCombinedOpacity(F);this._material.setParameterValues({opacity:F,
transparent:1>F||this.needsDrivenTransparentPass});return!0};Q.layerElevationInfoChanged=function(F,N){return this.updateGraphics3DGraphicElevationInfo(F,N,u.needsElevationUpdates3D)};Q.slicePlaneEnabledChanged=function(){this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};Q.physicalBasedRenderingChanged=function(){this._material.setParameterValues({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};Q.pixelRatioChanged=function(){return!0};
Q.applyRendererDiff=function(F,N){for(const P in F.diff)switch(P){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,N,this._vvConvertOptions))this._material.setParameterValues(this._fastUpdates.materialParameters);else return!1;break;default:return!1}return!0};Q.getVertexData=function(F){let N=0;const P=F.paths,U=[],V=F.spatialReference,W=this._context.elevationProvider.spatialReference,X=this._context.renderCoordsHelper.spatialReference;for(var ca of P)N+=ca.length;ca=new Float64Array(3*
N);const R=new Float64Array(3*N),aa=new Float64Array(3*N);let ka=0;for(const da of P){U.push({index:ka,numVertices:da.length});for(const fa of da)ca[ka++]=fa[0],ca[ka++]=fa[1],ca[ka++]=F.hasZ?fa[2]:0}F=!0;V.equals(W)?this._copyVertices(ca,0,R,0,N):F=e.projectBuffer(ca,V,0,R,W,0,N);W.equals(X)?this._copyVertices(R,0,aa,0,N):e.projectBuffer(R,W,0,aa,X,0,N);return{pathVertexDataInfos:U,vertexDataGS:ca,vertexDataES:R,vertexDataRS:aa,projectionSuccess:F,terrainElevation:0}};Q._copyVertices=function(F,
N,P,U,V){N*=3;U*=3;for(let W=0;W<V;++W)P[U++]=F[N++],P[U++]=F[N++],P[U++]=F[N++]};Q._createAs3DShape=function(F,N,P,U,V){var W=F.geometry,X=[];const ca=[],R=[],aa=W.spatialReference,ka=p.create(),da=this._context.renderCoordsHelper;W=this.getVertexData(W);if(!W.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0<W.pathVertexDataInfos.length){for(let ba=0;ba<W.pathVertexDataInfos.length;++ba){var fa=
W.pathVertexDataInfos[ba],ea=fa.index;fa=fa.numVertices;if(2>fa)this.logger.warn("PathSymbol3DLayer geometry failed to be created (paths should contain at least 2 vertices)");else{if(r.isSome(this._context.clippingExtent)&&(p.empty(ka),p.expandWithBuffer(ka,W.vertexDataES,3*ea,fa),!p.intersectsClippingArea(ka,this._context.clippingExtent)))continue;var Y=[];for(var Z=ea;Z<ea+3*fa;){const ia=Z++,ja=Z++,la=Z++,qa=new t.PathVertex;c.set(qa.posGS,W.vertexDataGS[ia],W.vertexDataGS[ja],W.vertexDataGS[la]);
c.set(qa.posES,W.vertexDataES[ia],W.vertexDataES[ja],W.vertexDataES[la]);const na=u.evaluateElevationAlignmentAtPoint(qa.posES,this._context.elevationProvider,P,da,null);c.set(K,W.vertexDataRS[ia],W.vertexDataRS[ja],W.vertexDataRS[la]);da.setAltitude(na,K);c.set(qa.pos,K[0],K[1],K[2]);Y.push(qa)}ea=new t.Path(Y);E(ea,this.upVectorAlignment,this._context.renderCoordsHelper);ea=new t.Builder(ea,this._profile,this._extruder,this._startCap,this._endCap);fa=null;this._fastUpdates.enabled?(Z=this._fastUpdates.visualVariables,
fa=Z.size?x.getAttributeValue(Z.size.field,F):0,Y=Z.color?x.getAttributeValue(Z.color.field,F):0,Z=Z.opacity?x.getAttributeValue(Z.opacity.field,F):0,fa=new t.FastUpdatePathGeometry(ea,fa,Y,Z)):(fa=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(fa[0]*=G(N.size[0],"symbol-value"===N.size[2]?this.symbolLayer.height||0:N.size[2],this.symbolLayer.width||0),fa[1]*=G(N.size[2],"symbol-value"===N.size[0]?this.symbolLayer.width||0:N.size[0],this.symbolLayer.height||0)),Y=null,
this._drivenProperties.color&&(Y=N.color),this._drivenProperties.opacity&&null!=N.opacity&&(Y=Y?[Y[0],Y[1],Y[2],N.opacity]:[1,1,1,N.opacity]),ea=new t.StaticPathGeometry(ea),ea.bake(fa),Y&&ea.bakeVertexColors(Y),fa=ea);ea=fa.createGeometryData();ea=new B(ea,U+"path"+ba);ea.metadata={pathGeometry:fa,geometrySR:aa,upVectorAlignment:this.upVectorAlignment,stencilWidth:this.stencilWidth};X.push(ea);ca.push(this._material);R.push(fa.xform)}}F={layerUid:this._context.layer.uid,graphicUid:V};if(0<X.length)return U=
new q({geometries:X,materials:ca,transformations:R,castShadow:!0,metadata:F,idHint:U}),X=new y(this,U,X,null,null,H,P),X.alignedSampledElevation=W.terrainElevation,X.needsElevationUpdates=u.needsElevationUpdates3D(P.mode),X}else this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};return O}(x.Graphics3DSymbolLayer);I.validGeometryTypes=["polyline"];const J=n.makeDehydratedPoint(0,0,0,null),K=d.create(),L=w.create(),S=w.create(),M={verticalDistanceToGround:0,
sampledElevation:0};b.Graphics3DPathSymbolLayer=I;b.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;b.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;b.NUM_ROUND_JOIN_SUBDIVISIONS=3;b.default=I;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(b,k){function a(t,D){t[0]=D[0];t[1]=D[1];t[2]=D[2];t[3]=D[3];return t}function r(t){t[0]=1;t[1]=0;t[2]=0;t[3]=1;return t}function l(t,D,E,G,H){t[0]=D;t[1]=E;t[2]=G;t[3]=H;return t}function h(t,D){if(t===D){const E=
D[1];t[1]=D[2];t[2]=E}else t[0]=D[0],t[1]=D[2],t[2]=D[1],t[3]=D[3];return t}function d(t,D){const E=D[0],G=D[1],H=D[2];D=D[3];let I=E*D-H*G;if(!I)return null;I=1/I;t[0]=D*I;t[1]=-G*I;t[2]=-H*I;t[3]=E*I;return t}function c(t,D){const E=D[0];t[0]=D[3];t[1]=-D[1];t[2]=-D[2];t[3]=E;return t}function e(t){return t[0]*t[3]-t[2]*t[1]}function f(t,D,E){const G=D[0],H=D[1],I=D[2];D=D[3];const J=E[0],K=E[1],L=E[2];E=E[3];t[0]=G*J+I*K;t[1]=H*J+D*K;t[2]=G*L+I*E;t[3]=H*L+D*E;return t}function g(t,D,E){const G=
D[0],H=D[1],I=D[2];D=D[3];const J=Math.sin(E);E=Math.cos(E);t[0]=G*E+I*J;t[1]=H*E+D*J;t[2]=G*-J+I*E;t[3]=H*-J+D*E;return t}function p(t,D,E){const G=D[1],H=D[2],I=D[3],J=E[0];E=E[1];t[0]=D[0]*J;t[1]=G*J;t[2]=H*E;t[3]=I*E;return t}function n(t,D){const E=Math.sin(D);D=Math.cos(D);t[0]=D;t[1]=E;t[2]=-E;t[3]=D;return t}function w(t,D){t[0]=D[0];t[1]=0;t[2]=0;t[3]=D[1];return t}function q(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function m(t){return Math.sqrt(Math.pow(t[0],2)+Math.pow(t[1],
2)+Math.pow(t[2],2)+Math.pow(t[3],2))}function u(t,D,E,G){t[2]=G[2]/G[0];E[0]=G[0];E[1]=G[1];E[3]=G[3]-t[2]*E[1];return[t,D,E]}function v(t,D,E){t[0]=D[0]+E[0];t[1]=D[1]+E[1];t[2]=D[2]+E[2];t[3]=D[3]+E[3];return t}function y(t,D,E){t[0]=D[0]-E[0];t[1]=D[1]-E[1];t[2]=D[2]-E[2];t[3]=D[3]-E[3];return t}function B(t,D){return t[0]===D[0]&&t[1]===D[1]&&t[2]===D[2]&&t[3]===D[3]}function x(t,D){const E=t[0],G=t[1],H=t[2];t=t[3];const I=D[0],J=D[1],K=D[2];D=D[3];return Math.abs(E-I)<=k.EPSILON*Math.max(1,
Math.abs(E),Math.abs(I))&&Math.abs(G-J)<=k.EPSILON*Math.max(1,Math.abs(G),Math.abs(J))&&Math.abs(H-K)<=k.EPSILON*Math.max(1,Math.abs(H),Math.abs(K))&&Math.abs(t-D)<=k.EPSILON*Math.max(1,Math.abs(t),Math.abs(D))}function C(t,D,E){t[0]=D[0]*E;t[1]=D[1]*E;t[2]=D[2]*E;t[3]=D[3]*E;return t}function z(t,D,E,G){t[0]=D[0]+E[0]*G;t[1]=D[1]+E[1]*G;t[2]=D[2]+E[2]*G;t[3]=D[3]+E[3]*G;return t}var A=Object.freeze({__proto__:null,copy:a,identity:r,set:l,transpose:h,invert:d,adjoint:c,determinant:e,multiply:f,rotate:g,
scale:p,fromRotation:n,fromScaling:w,str:q,frob:m,LDU:u,add:v,subtract:y,exactEquals:B,equals:x,multiplyScalar:C,multiplyScalarAndAdd:z,mul:f,sub:y});b.LDU=u;b.add=v;b.adjoint=c;b.copy=a;b.determinant=e;b.equals=x;b.exactEquals=B;b.frob=m;b.fromRotation=n;b.fromScaling=w;b.identity=r;b.invert=d;b.mat2=A;b.mul=f;b.multiply=f;b.multiplyScalar=C;b.multiplyScalarAndAdd=z;b.rotate=g;b.scale=p;b.set=l;b.str=q;b.sub=y;b.subtract=y;b.transpose=h})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec2 ../../support/geometryUtils ./Util ./GeometryData ./GeometryUtil ../materials/internal/MaterialUtil ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../materials/PathTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){var u;(function(H){function I(){return{up:a.create(),right:a.create()}}H.makeFrame=I;H.profileSpaceToVertexSpace=function(M,T,O){M[0]=O[0]*T.right[0]+O[1]*T.up[0];M[1]=O[0]*T.right[1]+O[1]*T.up[1];M[2]=O[0]*T.right[2]+O[1]*T.up[2]};H.vertexSpaceToProfileSpace=function(M,T,O){c.set(M,r.dot(O,T.right),r.dot(O,T.up))};var J=function(){function M(){this.pos=a.create();this.posES=a.create();this.posGS=a.create();this.vRight=a.create();this.vLeft=a.create();this.frame=
I();this.rotationFrame=I();this.rotationRight=d.create();this.rotationAngle=0;this.miterStretch=q.create()}var T=M.prototype;T.setFrameFromUpVector=function(O){r.copy(this.frame.up,O);r.add(z,this.vLeft,this.vRight);r.normalize(z,z);r.scale(C,this.frame.up,r.dot(z,this.frame.up));r.subtract(D,z,C);r.normalize(D,D);r.cross(this.frame.right,D,this.frame.up)};T.computeRotationAxisAndAngleFromUpVector=function(){r.copy(this.rotationFrame.up,this.frame.up);r.copy(this.rotationFrame.right,this.frame.right);
c.set(this.rotationRight,1,0);r.scale(C,this.frame.up,r.dot(this.frame.up,this.vLeft));r.subtract(C,this.vLeft,C);r.negate(C,C);r.normalize(C,C);r.scale(z,this.frame.up,r.dot(this.frame.up,this.vRight));r.subtract(z,this.vRight,z);r.normalize(z,z);r.cross(A,this.rotationFrame.up,this.vLeft);this.rotationAngle=k.sign(r.dot(A,this.vRight))*(Math.PI-k.acosClamped(r.dot(C,z)));if(0<Math.abs(this.rotationAngle)){const O=k.reciprocalClamped(Math.cos(.5*this.rotationAngle));w.set(this.miterStretch,1+(O-
1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return M}();H.PathVertex=J;J=function(){function M(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=[];this.uvIndices=this.uvs=null}var T=M.prototype;T.addVertex=function(O,Q){this.vertices.push(d.clone(O));this.vertexNormals.push(d.clone(Q));return this.vertices.length-1};T.addUV=function(O){this.uvs||(this.uvs=[],this.uvIndices=
[]);this.uvs.push(O);return this.uvs.length-1};T.addPole=function(O,Q=null){this.poles.push({position:d.clone(O),normal:Q?d.clone(Q):null});return this.poles.length-1};T.addSegment=function(O,Q=null,F=null){this.vertexIndices.push(O.v0);this.vertexIndices.push(O.v1);Q&&(this.uvIndices.push(Q.v0),this.uvIndices.push(Q.v1));F&&(this.poleIndices.push(F.v0),this.poleIndices.push(F.v1))};T.hasUV=function(){return null!=this.uvs};T.translate=function(O,Q){for(const F of this.vertices)F[0]+=O,F[1]+=Q;for(const F of this.poles)F.position[0]+=
O,F.position[1]+=Q};M.circle=function(O=20){const Q=new M,F={v0:0,v1:0};Q.addPole(d.fromValues(0,0));for(var N=0;N<O;++N){var P=2*N*Math.PI/O,U=Math.cos(P);const V=Math.sin(P);P=d.fromValues(.5*U,.5*V);U=d.fromValues(U,V);Q.addVertex(P,U);Q.addUV(N/O)}Q.addUV(1);for(N=0;N<O-1;++N)U={v0:N,v1:N+1},Q.addSegment(U,U,F);Q.addSegment({v0:O-1,v1:0},{v0:O-1,v1:O},F);return Q};M.rect=function(){const O=new M,Q=d.fromValues(-.5,-.5),F=d.fromValues(.5,-.5),N=d.fromValues(.5,.5),P=d.fromValues(-.5,.5),U=d.fromValues(0,
-1),V=d.fromValues(1,0),W=d.fromValues(0,1),X=d.fromValues(-1,0);O.addUV(0);O.addUV(1);O.addPole(d.fromValues(0,.5),W);O.addPole(d.fromValues(0,.5));O.addPole(d.fromValues(0,-.5));O.addPole(d.fromValues(0,-.5),U);const ca={v0:0,v1:1};O.addVertex(Q,U);O.addVertex(F,U);O.addSegment({v0:0,v1:1},ca,{v0:3,v1:3});O.addVertex(F,V);O.addVertex(N,V);O.addSegment({v0:2,v1:3},ca,{v0:2,v1:1});O.addVertex(N,W);O.addVertex(P,W);O.addSegment({v0:4,v1:5},ca,{v0:0,v1:0});O.addVertex(P,X);O.addVertex(Q,X);O.addSegment({v0:6,
v1:7},ca,{v0:1,v1:2});return O};b._createClass(M,[{key:"numSegments",get:function(){return this.vertexIndices.length/2}}]);return M}();H.Profile=J;J=function(){function M(T){this.vertices=[];this.offset=a.create();this.xform=h.create();this.vertices=T;r.copy(this.offset,this.vertices[Math.floor((T.length-1)/2)].pos);for(const O of this.vertices)r.subtract(O.pos,O.pos,this.offset);l.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}M.prototype.updatePathVertexInformation=
function(){const T=this.vertices.length;let O=this.vertices[0];O.index=0;r.set(O.vLeft,0,0,0);O.vLeftLength=0;r.subtract(O.vRight,this.vertices[1].pos,O.pos);O.vRightLength=r.length(O.vRight);r.normalize(O.vRight,O.vRight);let Q=O;for(let F=1;F<T;++F)O=this.vertices[F],O.index=F,r.copy(O.vLeft,Q.vRight),O.vLeftLength=Q.vRightLength,F<T-1?(r.subtract(O.vRight,this.vertices[F+1].pos,O.pos),O.vRightLength=r.length(O.vRight),r.normalize(O.vRight,O.vRight)):(r.copy(O.vRight,O.vLeft),O.vRightLength=O.vLeftLength),
Q=O};return M}();H.Path=J;H.computeMinimumRotationTangentFrame=function(M,T){let O=null;const Q=M.vertices.length,F=a.create(),N=a.create(),P=a.create(),U=a.create(),V=a.create(),W=a.create(),X=e.plane.create();let ca=M.vertices[0];r.copy(N,T);r.set(F,0,1,0);p.makeOrthoBasisDirUpFallback(ca.vRight,N,F,F,P,N,.99619469809);r.copy(ca.frame.up,N);r.copy(ca.frame.right,P);O=ca;for(T=1;T<Q;++T){ca=M.vertices[T];r.add(V,ca.vLeft,ca.vRight);let R=r.length(V);0<R?(R=1/Math.sqrt(R),V[0]*=R,V[1]*=R,V[2]*=R):
(V[0]=ca.vRight[0],V[1]=ca.vRight[1],V[2]=ca.vRight[2]);r.add(W,O.pos,O.frame.up);e.plane.fromPositionAndNormal(ca.pos,V,X);e.plane.intersectRay(X,e.ray.wrap(W,ca.vLeft),U)?(r.subtract(U,U,ca.pos),r.normalize(N,U),r.cross(P,V,N),r.normalize(P,P)):p.makeOrthoBasisDirUpFallback(V,O.frame.up,O.frame.right,F,P,N,.99619469809);r.copy(ca.frame.up,N);r.copy(ca.frame.right,P);O=ca}};H.Extruder=function(){};J=function(){function M(){}var T=M.prototype;T.numProfilesPerJoin=function(){return 1};T.extrude=function(O,
Q,F){for(let N=0;N<Q.vertices.length;++N)F(O.index,O.frame,Q.vertices[N],Q.vertexNormals[N],!1)};return M}();H.SimpleExtruder=J;J=function(){function M(O=.8*Math.PI,Q=1){this.cutoffAngle=O;this.numBendSubdivisions=Q}var T=M.prototype;T.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};T.extrude=function(O,Q,F){var N=E;if(Math.abs(O.rotationAngle)>=this.cutoffAngle)for(var P=0;P<this.numBendSubdivisions+1;++P){l.identity(G);l.rotate(G,G,.5*-O.rotationAngle+P*O.rotationAngle/this.numBendSubdivisions,
O.rotationFrame.up);var U=N,V=O.frame,W=G;r.transformMat4(U.up,V.up,W);r.transformMat4(U.right,V.right,W);for(U=0;U<Q.vertices.length;++U)0<=c.dot(Q.vertices[U],O.rotationRight)*O.rotationAngle?F(O.index,N,Q.vertices[U],Q.vertexNormals[U],!1):(c.transformMat2(y,Q.vertices[U],O.miterStretch),F(O.index,O.frame,y,Q.vertexNormals[U],!0))}else for(N=0;N<this.numBendSubdivisions+1;++N)for(P=0;P<Q.vertices.length;++P)U=0<=c.dot(Q.vertices[P],O.rotationRight)*O.rotationAngle,c.transformMat2(y,Q.vertices[P],
O.miterStretch),F(O.index,O.frame,y,Q.vertexNormals[P],U?!1:!0)};return M}();H.MiterExtruder=J;const K={generateUV:!1};J=function(){function M(){}M.prototype.rebuildConnectingProfileGeometry=function(T,O,Q){for(let F=0;F<O.vertices.length;++F)Q(T.index,T.frame,O.vertices[F],O.vertexNormals[F],0,0)};return M}();H.CapBuilder=J;var L=function(M){function T(){return M.call(this)||this}b._inheritsLoose(T,M);var O=T.prototype;O.getNumVertices=function(){return 0};O.getNumIndices=function(){return 0};O.rebuildCapGeometry=
function(){};O.buildTopology=function(){};return T}(J);H.NoCapBuilder=L;L=function(M){function T(Q,F=0,N=!1){var P=M.call(this)||this;P.profile=Q;P.profilePlaneOffset=F;P.flip=N;return P}b._inheritsLoose(T,M);var O=T.prototype;O.getNumVertices=function(){return this.profile.vertices.length};O.getNumIndices=function(){return 3*this.profile.numSegments};O.rebuildConnectingProfileGeometry=function(Q,F,N){for(let P=0;P<F.vertices.length;++P)N(Q.index,Q.frame,F.vertices[P],F.vertexNormals[P],this.profilePlaneOffset,
0)};O.rebuildCapGeometry=function(Q,F){const N=B;c.set(N,0,0);const P=this.flip?1:-1;for(let U=0;U<this.profile.vertices.length;++U)F(Q.index,Q.frame,this.profile.vertices[U],N,this.profilePlaneOffset,P)};O.buildTopology=function(Q,F){Q=this.vertexBufferStart+this.profile.vertexIndices[0];for(let N=1;N<this.profile.numSegments;++N){const P=this.vertexBufferStart+this.profile.vertexIndices[2*N],U=this.vertexBufferStart+this.profile.vertexIndices[2*N+1];this.flip?F(U,P,Q):F(Q,P,U)}};return T}(J);H.TriangulationCapBuilder=
L;J=function(M){function T(Q){var F=M.call(this)||this;F.flip=!1;F.sign=0;F.breakNormals=!1;F.numSegments=3;F.profile=Q.profile;F.flip=Q.flip;F.sign=F.flip?1:-1;F.breakNormals=Q.breakNormals;F.numSegments=Q.subdivisions;return F}b._inheritsLoose(T,M);var O=T.prototype;O.getNumVertices=function(){let Q=0;Q=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(Q+=this.profile.vertices.length);return Q+=this.profile.poles.length};O.getNumIndices=function(){let Q;Q=2*this.profile.numSegments*
(this.numSegments-1);for(let F=0;F<this.profile.numSegments;++F)Q=this.profile.poleIndices[this.profile.vertexIndices[2*F]]===this.profile.poleIndices[this.profile.vertexIndices[2*F+1]]?Q+1:Q+2;return 3*Q};O.rebuildCapGeometry=function(Q,F){const N=Q.frame,P=.5*this.sign,U=y,V=B;c.set(V,0,0);for(var W=0;W<this.profile.poles.length;++W){var X=this.profile.poles[W];X.normal?F(Q.index,N,X.position,X.normal,P,0):F(Q.index,N,X.position,V,P,this.sign)}if(this.breakNormals)for(W=0;W<this.profile.vertices.length;++W)F(Q.index,
N,this.profile.vertices[W],this.profile.vertexNormals[W],0,0);for(W=0;W<this.numSegments-1;++W){var ca=(1-(W+1)/this.numSegments)*Math.PI*.5;X=Math.sin(ca);ca=Math.cos(ca);for(let R=0;R<this.profile.vertices.length;++R){const aa=this.profile.poles[this.profile.poleIndices[R]];c.subtract(U,this.profile.vertices[R],aa.position);c.scale(U,U,X);aa.normal?(c.add(U,U,aa.position),F(Q.index,N,U,aa.normal,P*ca,0)):(c.normalize(V,U),c.scale(V,V,X),c.add(U,U,aa.position),F(Q.index,N,U,V,P*ca,this.sign*ca))}}};
O.buildTopology=function(Q,F){Q=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;const N=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let P=0;P<this.profile.numSegments;++P){const U=this.profile.vertexIndices[2*P],V=this.profile.vertexIndices[2*P+1],W=this.vertexBufferStart+this.profile.poleIndices[U],X=this.vertexBufferStart+this.profile.poleIndices[V];
let ca=Q+U,R=Q+V;for(let aa=0;aa<this.numSegments-1;++aa){const ka=N+aa*this.profile.vertices.length+U,da=N+aa*this.profile.vertices.length+V;this.flip?(F(ka,R,ca),F(R,ka,da)):(F(ca,R,ka),F(da,ka,R));ca=ka;R=da}this.flip?(F(W,R,ca),W!==X&&F(W,X,R)):(F(ca,R,W),W!==X&&F(R,X,W))}};return T}(J);H.RoundCapBuilder=J;J=function(){function M(O,Q,F,N,P,U=K){this.options=U;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=
Q;this.path=O;this.extruder=F;this.startCap=N;this.endCap=P;O=this.path.vertices.length-2;this.numExtrusionProfiles=F.numProfilesPerJoin()*O+2;this.numNormalsTotal=this.numVerticesTotal=Q.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;Q=this.startCap.getNumVertices();this.numVerticesTotal+=Q;this.numNormalsTotal+=Q;this.endCap.vertexBufferStart=this.numVerticesTotal;Q=this.endCap.getNumVertices();this.numVerticesTotal+=Q;this.numNormalsTotal+=Q;this.pathVertexData=
new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this.rebuildGeometry();this.buildTopology()}var T=M.prototype;
T.emitVertex=function(O,Q,F,N,P){this.profileRightAxisData[4*this._extrusionVertexCount]=Q.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=Q.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=Q.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=Q.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=Q.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=Q.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=F[0];this.profileVertexAndNormalData[4*
this._extrusionVertexCount+1]=F[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=N[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=N[1];this.pathVertexData[this._extrusionVertexCount]=O;P?(O=this.path.vertices[O],this.profileRightAxisData[4*this._extrusionVertexCount+3]=O.rotationRight[0]*O.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=O.rotationRight[1]*O.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=
0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};T.emitCapVertex=function(O,Q,F,N,P,U){this.profileRightAxisData[4*this._extrusionVertexCount]=Q.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=Q.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=Q.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=Q.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=Q.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+
2]=Q.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=F[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=F[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=N[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=N[1];this.pathVertexData[this._extrusionVertexCount]=O;this.profileRightAxisData[4*this._extrusionVertexCount+3]=P;this.profileUpAxisData[4*this._extrusionVertexCount+3]=U;++this._extrusionVertexCount};T.emitTriangle=function(O,
Q,F){this.vertexIndices[3*this._triangleCount]=O;this.vertexIndices[3*this._triangleCount+1]=Q;this.vertexIndices[3*this._triangleCount+2]=F;this.pathVertexIndices[3*this._triangleCount]=this.pathVertexData[O];this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[Q];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[F];this.normalIndices[3*this._triangleCount]=O;this.normalIndices[3*this._triangleCount+1]=Q;this.normalIndices[3*this._triangleCount+2]=F;++this._triangleCount};
T.rebuildGeometry=function(){var O=(N,P,U,V,W)=>this.emitVertex(N,P,U,V,W);const Q=(N,P,U,V,W,X)=>this.emitCapVertex(N,P,U,V,W,X);this._extrusionVertexCount=0;for(var F of this.path.vertices)this.originData[3*F.index]=F.pos[0],this.originData[3*F.index+1]=F.pos[1],this.originData[3*F.index+2]=F.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,Q);for(F=1;F<this.path.vertices.length-1;++F)this.extruder.extrude(this.path.vertices[F],this.profile,O);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-
1],this.profile,Q);this.startCap.rebuildCapGeometry(this.path.vertices[0],Q);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],Q);if(this.profile.hasUV()&&this.options.generateUV)for(O=0;O<this.profile.uvs.length;++O)this.uvData[2*O]=this.profile.uvs[O],this.uvData[2*O+1]=0};T.buildTopology=function(){const O=(U,V,W)=>this.emitTriangle(U,V,W);this._triangleCount=0;const Q=this.profile.vertices.length,F=this.profile.numSegments,N=this.numExtrusionProfiles-1;var P=F*N*6;
this.startCap.indexBufferStart=P;this.startCap.firstProfileVertexIndex=0;P+=this.startCap.getNumIndices();this.endCap.indexBufferStart=P;this.endCap.firstProfileVertexIndex=Q*(this.numExtrusionProfiles-1);P+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(P);this.normalIndices=new Uint32Array(P);this.pathVertexIndices=new Uint32Array(P);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(P));for(P=0;P<F;++P){const U=this.profile.vertexIndices[2*P],V=this.profile.vertexIndices[2*
P+1];for(let W=0;W<N;++W){const X=W*Q+U,ca=(W+1)*Q+V,R=W*Q+V;O(X,(W+1)*Q+U,ca);O(X,ca,R)}}this.startCap.buildTopology(this.path.vertices[0],O);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],O)};T.onPathChanged=function(){this.rebuildGeometry()};return M}();H.Builder=J;J=function(){function M(T){this.builder=T}M.prototype.onPathChanged=function(){this.builder.onPathChanged()};b._createClass(M,[{key:"xform",get:function(){return this.builder.path.xform}}]);return M}();H.PathGeometry=
J;let S=function(M){function T(Q){Q=M.call(this,Q)||this;Q.vertexAttributePosition=null;Q.vertexAttributeNormal=null;Q.vertexAttributeColor=null;Q.vertexAttributePosition=new Float32Array(3*Q.builder.numVerticesTotal);Q.vertexAttributeNormal=new Float32Array(3*Q.builder.numNormalsTotal);Q.vertexAttributeColor=new Uint8Array(4);Q.vertexAttributeColor[0]=255;Q.vertexAttributeColor[1]=255;Q.vertexAttributeColor[2]=255;Q.vertexAttributeColor[3]=255;return Q}b._inheritsLoose(T,M);var O=T.prototype;O.bakeVertexColors=
function(Q){this.vertexAttributeColor[0]=255*Q[0];this.vertexAttributeColor[1]=255*Q[1];this.vertexAttributeColor[2]=255*Q[2];this.vertexAttributeColor[3]=255*(3<Q.length?Q[3]:1)};O.bake=function(Q){this.size=Q;for(let U=0;U<this.builder.numVerticesTotal;++U){var F=this.builder.pathVertexData[U],N=0===F||F===this.builder.path.vertices.length-1,P=v;r.set(P,this.builder.originData[3*F],this.builder.originData[3*F+1],this.builder.originData[3*F+2]);const V=C,W=y;F=z;const X=A,ca=t;let R=0,aa=0;r.set(X,
this.builder.profileRightAxisData[4*U],this.builder.profileRightAxisData[4*U+1],this.builder.profileRightAxisData[4*U+2]);r.set(ca,this.builder.profileUpAxisData[4*U],this.builder.profileUpAxisData[4*U+1],this.builder.profileUpAxisData[4*U+2]);c.set(W,this.builder.profileVertexAndNormalData[4*U]*Q[0],this.builder.profileVertexAndNormalData[4*U+1]*Q[1]);if(N)r.cross(F,ca,X),R=this.builder.profileRightAxisData[4*U+3]*Q[0],aa=this.builder.profileUpAxisData[4*U+3];else{N=B;const ka=x;c.set(N,this.builder.profileRightAxisData[4*
U+3],this.builder.profileUpAxisData[4*U+3]);const da=c.length(N);c.normalize(N,N);const fa=c.dot(W,N);if(Math.abs(fa)>da){c.set(ka,-N[1],N[0]);const ea=c.dot(W,ka);c.scale(N,N,da*k.sign(fa));c.scale(ka,ka,ea);c.add(W,N,ka)}r.set(F,0,0,0)}r.set(V,X[0]*W[0]+ca[0]*W[1],X[1]*W[0]+ca[1]*W[1],X[2]*W[0]+ca[2]*W[1]);this.vertexAttributePosition[3*U]=P[0]+V[0]+F[0]*R;this.vertexAttributePosition[3*U+1]=P[1]+V[1]+F[1]*R;this.vertexAttributePosition[3*U+2]=P[2]+V[2]+F[2]*R;P=y;c.set(P,this.builder.profileVertexAndNormalData[4*
U+2],this.builder.profileVertexAndNormalData[4*U+3]);this.vertexAttributeNormal[3*U]=X[0]*P[0]+ca[0]*P[1]+F[0]*aa;this.vertexAttributeNormal[3*U+1]=X[1]*P[0]+ca[1]*P[1]+F[1]*aa;this.vertexAttributeNormal[3*U+2]=X[2]*P[0]+ca[2]*P[1]+F[2]*aa}};O.createGeometryData=function(){const Q={};Q[f.VertexAttrConstants.POSITION]=this.builder.vertexIndices;Q[f.VertexAttrConstants.NORMAL]=this.builder.normalIndices;this.vertexAttributeColor&&(Q[f.VertexAttrConstants.COLOR]=new Uint32Array(Q[f.VertexAttrConstants.POSITION].length));
const F={};F[f.VertexAttrConstants.POSITION]={size:3,data:this.vertexAttributePosition};F[f.VertexAttrConstants.NORMAL]={size:3,data:this.vertexAttributeNormal};this.vertexAttributeColor&&(F[f.VertexAttrConstants.COLOR]={size:4,data:this.vertexAttributeColor});return new g.GeometryData(F,Q,"triangle")};O.onPathChanged=function(){M.prototype.onPathChanged.call(this);this.bake(this.size)};O.intersect=function(Q,F,N){const P=this.builder.vertexIndices;n.intersectTriangles(Q,F,0,P.length/3,P,{size:3,
offsetIdx:0,strideIdx:3,data:this.vertexAttributePosition},void 0,void 0,N)};return T}(J);H.StaticPathGeometry=S;J=function(M){function T(O,Q,F,N){var P=M.call(this,O)||this;P.sizeAttributeValue=Q;P.colorAttributeValue=F;P.opacityAttributeValue=N;P.vvData=null;P.baked=new S(O);P.vvData=new Float32Array(4*P.builder.path.vertices.length);for(O=0;O<P.builder.path.vertices.length;++O)P.vvData[4*O]=Q,P.vvData[4*O+1]=F,P.vvData[4*O+2]=N,P.vvData[4*O+3]=0===O||O===P.builder.path.vertices.length-1?1:0;return P}
b._inheritsLoose(T,M);T.prototype.createGeometryData=function(){const O={};O[m.PathVertexAttrConstants.POSITION]=this.builder.pathVertexIndices;O[m.PathVertexAttrConstants.PROFILERIGHT]=this.builder.vertexIndices;O[m.PathVertexAttrConstants.PROFILEUP]=this.builder.vertexIndices;O[m.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]=this.builder.vertexIndices;O[m.PathVertexAttrConstants.FEATUREVALUE]=this.builder.pathVertexIndices;const Q={};Q[m.PathVertexAttrConstants.POSITION]={size:3,data:this.builder.originData};
Q[m.PathVertexAttrConstants.PROFILERIGHT]={size:4,data:this.builder.profileRightAxisData};Q[m.PathVertexAttrConstants.PROFILEUP]={size:4,data:this.builder.profileUpAxisData};Q[m.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL]={size:4,data:this.builder.profileVertexAndNormalData};Q[m.PathVertexAttrConstants.FEATUREVALUE]={size:4,data:this.vvData};return new g.GeometryData(Q,O,"triangle")};return T}(J);H.FastUpdatePathGeometry=J})(u||(u={}));const v=a.create(),y=d.create(),B=d.create(),x=d.create(),
C=a.create(),z=a.create(),A=a.create(),t=a.create(),D=a.create(),E=u.makeFrame(),G=h.create();return u})},"esri/chunks/mat2f64":function(){define(["exports"],function(b){function k(){return[1,0,0,1]}function a(d){return[d[0],d[1],d[2],d[3]]}function r(d,c,e,f){return[d,c,e,f]}function l(d,c){return new Float64Array(d,c,4)}var h=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,createView:l});b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.mat2f64=h})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../lib/OrderIndependentTransparency ../lib/StencilUtils ../core/shaderLibrary/shading/ReadShadowMap.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../../../../chunks/Path.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){const v={position:0,profileRight:1,profileUp:2,profileVertexAndNormal:3,featureValue:4};h=function(y){function B(){return y.apply(this,arguments)||this}a._inheritsLoose(B,y);var x=B.prototype;x.initializeProgram=function(C){var z=B.shader.get();const A=this.configuration;z=z.build({OITEnabled:0===A.transparencyPassType,output:A.output,viewingMode:C.viewingMode,slicePlaneEnabled:A.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,
receiveShadows:A.receiveShadows,vvSize:A.vvSize,vvColor:A.vvColor,vvInstancingEnabled:!0,vvOpacity:A.vvOpacity,useOldSceneLightInterface:!1,pbrMode:0,useCustomDTRExponentForWater:!1,receiveAmbientOcclusion:A.receiveSSAO,doubleSidedMode:A.doubleSidedMode});return new c(C.rctx,z.generateSource("vertex"),z.generateSource("fragment"),v)};x.bindPass=function(C,z,A){f.View.bindProjectionMatrix(this.program,A.camera.projectionMatrix);this.program.setUniform3fv("size",z.size);0!==this.configuration.output&&
7!==this.configuration.output||this.program.setUniform1f("opacity",z.opacity);0===this.configuration.output?(A.lighting.setUniforms(this.program,!1),this.program.setUniform3fv("ambient",z.ambient),this.program.setUniform3fv("diffuse",z.diffuse),this.program.setUniform3fv("specular",z.specular),this.program.setUniform1f("opacity",z.opacity)):1!==this.configuration.output&&3!==this.configuration.output||f.View.bindNearFar(this.program,A.camera.nearFar);m.setVVUniforms(this.program,z)};x.bindDraw=function(C){f.View.bindView(this.program,
C);g.Slice.bindUniformsWithOrigin(this.program,this.configuration,C);0!==this.configuration.output&&7!==this.configuration.output||f.View.bindCamPosition(this.program,C.origin,C.camera.viewInverseTransposeMatrix);0===this.configuration.output&&w.ReadShadowMap.bindView(this.program,C);2===this.configuration.output&&q.VertexNormal.bindUniforms(this.program,C.camera.viewInverseTransposeMatrix)};x.setPipelineState=function(C){const z=this.configuration,A=3===C,t=2===C;return e.makePipelineState({blending:0!==
z.output&&7!==z.output||!z.transparent?null:A?p.blendingDefault:p.OITBlending(C),culling:(z.slicePlaneEnabled?!1:!z.transparent&&0!==z.doubleSidedMode)&&{face:1028,mode:2305},depthTest:{func:p.OITDepthTest(C)},depthWrite:A||t?e.defaultDepthWriteParams:null,colorWrite:e.defaultColorWriteParams,stencilWrite:z.sceneHasOcludees?n.stencilWriteMaskOn:null,stencilTest:z.sceneHasOcludees?n.stencilBaseAllZerosParams:null,polygonOffset:A||t?null:p.OITPolygonOffset})};x.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};
return B}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(u.PathShader,()=>new Promise(function(y,B){b(["../shaders/Path.glsl"],y,B)}));l=function(y){function B(){var x=y.apply(this,arguments)||this;x.output=0;x.doubleSidedMode=0;x.receiveShadows=!1;x.receiveSSAO=!1;x.vvSize=!1;x.vvColor=!1;x.vvOpacity=!1;x.slicePlaneEnabled=!1;x.shadowMap=!1;x.transparent=!1;x.sceneHasOcludees=!1;x.transparencyPassType=3;return x}a._inheritsLoose(B,y);return B}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter({count:8})],
l.prototype,"output",void 0);r.__decorate([d.parameter({count:3})],l.prototype,"doubleSidedMode",void 0);r.__decorate([d.parameter()],l.prototype,"receiveShadows",void 0);r.__decorate([d.parameter()],l.prototype,"receiveSSAO",void 0);r.__decorate([d.parameter()],l.prototype,"vvSize",void 0);r.__decorate([d.parameter()],l.prototype,"vvColor",void 0);r.__decorate([d.parameter()],l.prototype,"vvOpacity",void 0);r.__decorate([d.parameter()],l.prototype,"slicePlaneEnabled",void 0);r.__decorate([d.parameter()],
l.prototype,"shadowMap",void 0);r.__decorate([d.parameter()],l.prototype,"transparent",void 0);r.__decorate([d.parameter()],l.prototype,"sceneHasOcludees",void 0);r.__decorate([d.parameter({count:4})],l.prototype,"transparencyPassType",void 0);k.PathTechnique=h;k.PathTechniqueConfiguration=l;k.PathVertexAttrConstants={POSITION:"position",PROFILERIGHT:"profileRight",PROFILEUP:"profileUp",PROFILEVERTEXANDNORMAL:"profileVertexAndNormal",FEATUREVALUE:"featureValue"};k.pathVertexAttributeLocations=v;Object.defineProperty(k,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define(["exports","../../shaderModules/interfaces","./PositionAttribute.glsl"],function(b,k,a){b.PathVertexPosition=function(r,l){r.attributes.add("featureValue","vec4");r.vertex.code.add(k.glsl`
  bool isCapVertex() {
    return featureValue.w == 1.0;
  }
  `);r.vertex.uniforms.add("size","vec3");l.vvSize?(r.vertex.uniforms.add("vvSizeMinSize","vec3"),r.vertex.uniforms.add("vvSizeMaxSize","vec3"),r.vertex.uniforms.add("vvSizeOffset","vec3"),r.vertex.uniforms.add("vvSizeFactor","vec3"),r.vertex.code.add(k.glsl`
    vec2 getSize() {
      return size.xy*clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):r.vertex.code.add(k.glsl`
    vec2 getSize(){
      return size.xy;
    }
    `);l.vvOpacity?(r.vertex.defines.addInt("VV_OPACITY_N",8),r.vertex.code.add(k.glsl`
    uniform float vvOpacityValues[VV_OPACITY_N];
    uniform float vvOpacityOpacities[VV_OPACITY_N];

    vec4 applyOpacity(vec4 color) {
      float value = featureValue.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < VV_OPACITY_N; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[VV_OPACITY_N - 1]);
    }
    `)):r.vertex.code.add(k.glsl`
    vec4 applyOpacity(vec4 color){
      return color;
    }
    `);l.vvColor?(r.vertex.defines.addInt("VV_COLOR_N",8),r.vertex.code.add(k.glsl`
    uniform float vvColorValues[VV_COLOR_N];
    uniform vec4 vvColorColors[VV_COLOR_N];

    vec4 getColor() {
      float value = featureValue.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < VV_COLOR_N; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[VV_COLOR_N - 1]);
    }
    `)):r.vertex.code.add(k.glsl`
    vec4 getColor(){
      return applyOpacity(vec4(1, 1, 1, 1));
    }
    `);r.include(a.PositionAttribute);r.attributes.add("profileRight","vec4");r.attributes.add("profileUp","vec4");r.attributes.add("profileVertexAndNormal","vec4");r.vertex.code.add(k.glsl`
  vec3 calculateVPos() {
    vec2 size = getSize();
    vec3 origin = position;
    vec3 right = profileRight.xyz;
    vec3 up = profileUp.xyz;
    vec3 forward = cross(up, right);
    vec2 profileVertex = profileVertexAndNormal.xy * size;
    vec2 profileNormal = profileVertexAndNormal.zw;
    float positionOffsetAlongProfilePlaneNormal = 0.0;
    float normalOffsetAlongProfilePlaneNormal = 0.0;
    `);r.vertex.code.add(k.glsl`
    if(!isCapVertex()) {
      vec2 rotationRight = vec2(profileRight.w, profileUp.w);
      float maxDistance = length(rotationRight);
  `);r.vertex.code.add(k.glsl`
      rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);

      // decompose vertex into rotationRight and rotationUp
      // limit rotation right component to maxDistance
      // and reassemble profile vertex from rotationRight and rotationUp
      float rx = dot(profileVertex, rotationRight);
      if (abs(rx) > maxDistance) {
        // NB: we do the tangent by x=-y and y=x
        vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
        float ry = dot(profileVertex, rotationUp);
        profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
      }
    }else{
       positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
       normalOffsetAlongProfilePlaneNormal = profileUp.w;
    }

    vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;

    return origin + offset; // localPosition
  }
  `);r.vertex.code.add(k.glsl`
  vec3 localNormal() {
    vec3 right = profileRight.xyz;
    vec3 up = profileUp.xyz;
    vec3 forward = cross(up, right);
    vec2 profileNormal = profileVertexAndNormal.zw;

    vec3 normal = right * profileNormal.x + up * profileNormal.y;

    if(isCapVertex()) {
      normal += forward * profileUp.w;
    }

    return normal;
  }
  `)};b.setVVUniforms=function(r,l){l.vvSizeEnabled&&(r.setUniform3fv("vvSizeMinSize",l.vvSizeMinSize),r.setUniform3fv("vvSizeMaxSize",l.vvSizeMaxSize),r.setUniform3fv("vvSizeOffset",l.vvSizeOffset),r.setUniform3fv("vvSizeFactor",l.vvSizeFactor));l.vvColorEnabled&&(r.setUniform1fv("vvColorValues",l.vvColorValues),r.setUniform4fv("vvColorColors",l.vvColorColors));l.vvOpacityEnabled&&(r.setUniform1fv("vvOpacityValues",l.vvOpacityValues),r.setUniform1fv("vvOpacityOpacities",l.vvOpacityOpacities))};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){function m(v){const y=new r.ShaderBuilder;y.vertex.uniforms.add("proj","mat4").add("view","mat4").add("camPos","vec3").add("localOrigin","vec3");y.varyings.add("vpos","vec3");y.include(q.PathVertexPosition,v);if(0===v.output||7===v.output)y.include(a.Transform,{linearDepth:!1}),v.receiveShadows&&y.include(e.ReadShadowMap,v),y.include(f.ForwardLinearDepth,v),y.varyings.add("vnormal","vec3"),y.varyings.add("vcolor","vec4"),y.vertex.code.add(k.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        gl_Position = transformPosition(proj, view, vpos);

        ${0===v.output?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);7===v.output&&(y.include(h.Slice,v),y.fragment.uniforms.add("camPos","vec3"),y.fragment.uniforms.add("localOrigin","vec3"),y.fragment.uniforms.add("opacity","float"),y.fragment.code.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `));0===v.output&&(y.include(h.Slice,v),y.include(n.EvaluateSceneLighting,v),y.include(p.EvaluateAmbientOcclusion,v),v.receiveShadows&&y.include(e.ReadShadowMap,v),y.include(w.Normals,v),y.fragment.uniforms.add("camPos","vec3").add("localOrigin","vec3").add("ambient","vec3").add("diffuse","vec3").add("specular","vec3").add("opacity","float"),y.fragment.include(l.ColorConversion),y.fragment.code.add(k.glsl`
      void main() {
        discardBySlice(vpos);

        shadingParams.viewDirection = normalize(vpos - camPos);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = _oldHeuristicLighting(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
    `),v.receiveShadows?y.fragment.code.add(k.glsl`
        float shadow = readShadowMap(vpos, linearDepth);
      `):1===v.viewingMode?y.fragment.code.add(k.glsl`
        float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);
      `):y.fragment.code.add(k.glsl`
        float shadow = 0.0;
      `),y.fragment.code.add(k.glsl`
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${v.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(1===v.output||3===v.output)y.include(a.Transform,{linearDepth:!0}),y.vertex.uniforms.add("nearFar","vec2"),y.varyings.add("depth","float"),y.vertex.code.add(k.glsl`
        void main() {
          vpos = calculateVPos();
          gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
        }
    `),y.include(h.Slice,v),y.include(c.OutputDepth,v),y.fragment.uniforms.add("timeElapsed","float"),y.fragment.code.add(k.glsl`
        void main() {
          discardBySlice(vpos);
          outputDepth(depth);
        }
    `);2===v.output&&(y.include(a.Transform,{linearDepth:!1}),y.include(g.NormalUtils,v),y.vertex.uniforms.add("viewNormal","mat4"),y.varyings.add("vnormal","vec3"),y.vertex.code.add(k.glsl`
        void main(void) {
          vpos = calculateVPos();
          vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),y.include(h.Slice,v),y.fragment.uniforms.add("waterColor","vec4"),y.fragment.code.add(k.glsl`
        void main() {
          discardBySlice(vpos);
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) normal = -normal;
          gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
        }
    `));4===v.output&&(y.include(a.Transform,{linearDepth:!1}),y.include(g.NormalUtils,v),y.vertex.uniforms.add("viewNormal","mat4"),y.varyings.add("vnormal","vec3"),y.vertex.code.add(k.glsl`
        void main(void) {
          vpos = calculateVPos();
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),y.include(h.Slice,v),y.include(d.OutputHighlight),y.fragment.code.add(k.glsl`
      void main() {
        discardBySlice(vpos);
        outputHighlight();
      }
    `));return y}var u=Object.freeze({__proto__:null,build:m});b.PathShader=u;b.build=m})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../support/buffer/BufferView ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../lib/geometryDataUtils ../lib/Util ../lib/GLMaterial ./internal/MaterialUtil ../lib/Material ./internal/bufferWriterUtils ./VisualVariableMaterialParameters ./PathTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){const q=c.assert;c=function(y){function B(C,z){C=y.call(this,z,C,u)||this;C.supportsEdges=!0;C._vertexAttributeLocations=w.pathVertexAttributeLocations;C.techniqueConfig=new w.PathTechniqueConfiguration;C.vertexBufferLayout=B.getVertexBufferLayout(C.params);return C}k._inheritsLoose(B,y);var x=B.prototype;x.getTechniqueConfig=function(C,z){this.techniqueConfig.output=C;this.techniqueConfig.vvSize=this.params.vvSizeEnabled;this.techniqueConfig.vvColor=this.params.vvColorEnabled;
this.techniqueConfig.vvOpacity=this.params.vvOpacityEnabled;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.sceneHasOcludees=this.params.sceneHasOcludees;if(0===C||7===C)this.techniqueConfig.doubleSidedMode=this.params.doubleSided&&"normal"===this.params.doubleSidedType?1:this.params.doubleSided&&"winding-order"===this.params.doubleSidedType?2:0,this.techniqueConfig.receiveShadows=this.params.receiveShadows,
this.techniqueConfig.receiveSSAO=this.params.receiveSSAO;this.techniqueConfig.transparencyPassType=z?z.transparencyPassType:3;return this.techniqueConfig};x.getPassParameters=function(){return this.params};x.isVisibleInPass=function(C){return 4===C?this.params.castShadows:!0};x.isVisible=function(){const C=this.params;return y.prototype.isVisible.call(this)?0<C.opacity:!1};x.intersect=function(C,z,A,t,D,E,G){if(C.metadata){z=C.metadata.pathGeometry;A=[this.params.size[0],this.params.size[1]];if(this.params.vvSizeEnabled){var H=
this.params.vvSizeOffset,I=this.params.vvSizeFactor;const J=this.params.vvSizeMinSize,K=this.params.vvSizeMaxSize,L=z.sizeAttributeValue;A[0]*=a.clamp(H[0]+L*I[0],J[0],K[0]);A[1]*=a.clamp(H[2]+L*I[2],J[2],K[2])}H=Math.max(A[0],A[1]);C=l.fromValues(C.boundingInfo.bbMin[0]-H,C.boundingInfo.bbMin[1]-H,C.boundingInfo.bbMin[2]-H,C.boundingInfo.bbMax[0]+H,C.boundingInfo.bbMax[1]+H,C.boundingInfo.bbMax[2]+H);H=[E[0]-D[0],E[1]-D[1],E[2]-D[2]];I=Math.sqrt(H[0]*H[0]+H[1]*H[1]+H[2]*H[2]);f.intersectAabbInvDir(C,
D,[I/H[0],I/H[1],I/H[2]],t.tolerance)&&(z.baked.size&&z.baked.size[0]===A[0]&&z.baked.size[1]===A[1]||z.baked.bake(A),z.baked.intersect(D,E,G))}};x.computeAttachmentOrigin=function(C,z){C=C.data;return(C="getVertexAttr"in C?C.getVertexAttr():"vertexAttr"in C?C.vertexAttr:null)?d.computeAttachmentOriginLines(C[w.PathVertexAttrConstants.POSITION],null,!1,z):null};x.createBufferWriter=function(){return new v(this.vertexBufferLayout)};x.getGLMaterial=function(C){if(0===C.output||7===C.output||1===C.output||
2===C.output||4===C.output||3===C.output&&this.params.castShadows)return new m(C)};B.getVertexBufferLayout=function(C){let z=h.newLayout().vec3f(w.PathVertexAttrConstants.POSITION).vec4f(w.PathVertexAttrConstants.PROFILERIGHT).vec4f(w.PathVertexAttrConstants.PROFILEUP).vec4f(w.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL);if(C.vvColorEnabled||C.vvSizeEnabled||C.vvOpacityEnabled)z=z.vec4f(w.PathVertexAttrConstants.FEATUREVALUE);return z};return B}(g.Material);let m=function(y){function B(C){C=y.call(this,
C)||this;C.updateParameters();return C}k._inheritsLoose(B,y);var x=B.prototype;x.updateParameters=function(C){this.technique=this.techniqueRep.acquireAndReleaseExisting(w.PathTechnique,this.material.getTechniqueConfig(this.output,C),this.technique)};x.beginSlot=function(C){return C===(this.technique.configuration.transparent?5:3)};x._updateOccludeeState=function(C){C.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:C.hasOccludees})};x._updateShadowState=
function(C){C.shadowMappingEnabled!==this.technique.configuration.receiveShadows&&this.material.setParameterValues({receiveShadows:C.shadowMappingEnabled})};x.ensureParameters=function(C){if(0===this.output||7===this.output)this._updateShadowState(C),this._updateOccludeeState(C);this.updateParameters(C)};x.bind=function(C,z){C.bindProgram(this.technique.program);this.technique.bindPass(C,this.material.getPassParameters(),z)};return B}(e);const u={size:[1,1,1],ambient:[.2,.2,.2],diffuse:[.8,.8,.8],
specular:[0,0,0],opacity:1,doubleSided:!1,doubleSidedType:"normal",receiveSSAO:!0,receiveShadows:!1,castShadows:!0,slicePlaneEnabled:!1,transparent:!1,sceneHasOcludees:!1,...n.Default,...g.materialParametersDefaults};let v=function(){function y(x){this.vertexBufferLayout=x}var B=y.prototype;B.allocate=function(x){return this.vertexBufferLayout.createBuffer(x)};B.elementCount=function(x){return x.indices[w.PathVertexAttrConstants.POSITION].length};B.write=function(x,C,z,A){const t=D=>{if(D in C.vertexAttr){const E=
C.vertexAttr[D],G=C.indices[D];q(4===E.size);const H=z.getField(D,r.BufferViewVec4f);if(H)p.writeBufferVec4(G,E.data,H,A);else throw Error("unable to acquire view for "+D);}};t(w.PathVertexAttrConstants.PROFILERIGHT);t(w.PathVertexAttrConstants.PROFILEUP);t(w.PathVertexAttrConstants.PROFILEVERTEXANDNORMAL);this.vertexBufferLayout.hasField(w.PathVertexAttrConstants.FEATUREVALUE)&&t(w.PathVertexAttrConstants.FEATUREVALUE);p.writeDefaultAttributes(C,this.vertexBufferLayout,x.transformation,x.invTranspTransformation,
z,A)};return y}();b.PathMaterial=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../Color ../../../../core/screenUtils ../../../../chunks/mat4f64 ../../../../core/libs/earcut/earcut ../../support/buffer/BufferView ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Util ../../webgl-engine/lib/Object3D ./graphicUtils ./elevationAlignmentUtils ../../webgl-engine/materials/PatternMaterial ../support/uvUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ../../webgl-engine/lib/Geometry ./Graphics3DSymbolLayer ../../webgl-engine/materials/RibbonLineMaterial ../../webgl-engine/materials/lineStippleUtils ./polygonUtils ./Graphics3DDrapedGraphicLayer ../../webgl-engine/lib/RenderGeometry ./lineUtils ../../webgl-engine/materials/NativeLineMaterial ../support/patternUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G){B=function(K){function L(M,T,O,Q){M=K.call(this,M,T,O,Q)||this;M._needsUV=!1;M._hasOutline=!1;return M}k._inheritsLoose(L,K);var S=L.prototype;S.doLoad=async function(){};S.ensureMaterials=function(){this.ensureFillMaterial();this.ensureOutlineMaterial()};S.ensureFillMaterial=function(){if(!a.isSome(this._material)){var M=a.get(this.symbolLayer,"material","color");M=this._getCombinedOpacityAndColor(M);this._material=G.createMaterial(this.symbolLayer,
{color:M,transparent:1>M[3]||this.needsDrivenTransparentPass,polygonOffset:!1,vertexColors:!0,writeLinearDepth:!0,slicePlaneEnabled:this._context.slicePlaneEnabled},{isDraped:this.draped,idHint:this._getIdHint()});this._needsUV=this._material instanceof w.PatternMaterial;this._context.stage.add(3,this._material)}};S.ensureOutlineMaterial=function(){const M=this.symbolLayer.outline;!a.isSome(this._outlineMaterial)&&this._isValidOutline(M)&&(this._hasOutline=!0,this._outlineMaterial=(T=>{const O=M.stipplePattern?
C.createStipplePattern(M.stipplePattern.map(l.pt2px)):null,Q=M.stippleOffColor?r.toUnitRGBA(M.stippleOffColor):null;return 1.5<T?new x.RibbonLineMaterial({width:T,color:this._getOutlineColor(),polygonOffset:!0,slicePlaneEnabled:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:O,stippleIntegerRepeats:!0,stippleOffColor:Q},this._getIdHint("_outline_ribbonlinemat")):new E.NativeLineMaterial({color:this._getOutlineColor(),slicePlaneEnabled:this._context.slicePlaneEnabled,width:T,stipplePattern:O,
stippleIntegerRepeats:!0,stippleOffColor:Q},this._getIdHint("_outline_nativelinemat"))})(l.pt2px(M.size)),this._context.stage.add(3,this._outlineMaterial))};S._isValidOutline=function(M){return a.isSome(M)&&M.size&&0<M.size&&a.isSome(M.color)};S.destroy=function(){K.prototype.destroy.call(this);a.isSome(this._material)&&(this._context.stage.remove(3,this._material.id),this._material=null);a.isSome(this._outlineMaterial)&&(this._context.stage.remove(3,this._outlineMaterial.id),this._outlineMaterial=
null)};S.createGraphics3DGraphic=function(M){const T=M.graphic;if(!this._validateGeometryType(T.geometry,L.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(T.geometry))return null;const O="graphic"+T.uid;M=this._getVertexOpacityAndColor(M.renderingInfo,Uint8Array,255);const Q=this.setGraphicElevationContext(T,new u.ElevationContext);this.ensureDrapedStatus("on-the-ground"===Q.mode);this.ensureMaterials();return this.draped?this._createAsOverlay(T,M,O):this._createAs3DShape(T,M,Q,
O)};S.layerOpacityChanged=function(){if(a.isSome(this._material)){var M=this._material.params.color,T=a.get(this.symbolLayer,"material","color");T=this._getCombinedOpacity(T);this._material.setParameterValues({color:[M[0],M[1],M[2],T],transparent:1>T||this.needsDrivenTransparentPass})}a.isSome(this._outlineMaterial)&&(M=this._outlineMaterial.params.color,this._outlineMaterial.setParameterValues({color:[M[0],M[1],M[2],this._getOutlineOpacity()]}));return!0};S.layerElevationInfoChanged=function(M,T,
O){const Q=this._elevationContext.mode;O=n.elevationModeChangeUpdateType(L.elevationModeChangeTypes,O,Q);if(O!==n.SymbolUpdateType.UPDATE)return O;const F=n.needsElevationUpdates2D(Q);return this.updateGraphics3DGraphicElevationInfo(M,T,()=>F)};S.slicePlaneEnabledChanged=function(){a.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});a.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});
return!0};S.physicalBasedRenderingChanged=function(){return!0};S.pixelRatioChanged=function(){return!0};S._createAs3DShape=function(M,T,O,Q){const F=z.geometryAsPolygon(M.geometry);if(a.isNone(F))return null;I.renderData=z.geometryToRenderInfo(F,this._context.elevationProvider,this._context.renderCoordsHelper,O);I.idHint=Q;I.color=T;T=I.renderData.position.length/3;this._needsUV&&(I.uvMapSpace=new Float32Array(4*T),I.bound1=new Float64Array(3*T),I.bound2=new Float64Array(3*T),I.bound3=new Float64Array(3*
T));I.outNum=0;I.outGeometries=[];I.outTransforms=[];I.outMaterials=[];this._createAs3DShapeFill(I);this._hasOutline&&this._createAs3DShapeOutline(I);this._logGeometryCreationWarnings(I.renderData,F.rings,"rings","FillSymbol3DLayer");if(0===I.outNum)return null;this._needsUV&&q.createMapSpaceUVCoords(c.BufferViewVec4f.fromTypedArray(I.uvMapSpace),c.BufferViewVec3f64.fromTypedArray(I.renderData.position),this._context.layerView.view.renderCoordsHelper,c.BufferViewVec3f64.fromTypedArray(I.bound1),c.BufferViewVec3f64.fromTypedArray(I.bound2),
c.BufferViewVec3f64.fromTypedArray(I.bound3));M=new g({geometries:I.outGeometries,materials:I.outMaterials,transformations:I.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:M.uid},idHint:Q});M=new v(this,M,I.outGeometries,null,null,m.uvElevationAligner,O);M.alignedSampledElevation=I.renderData.sampledElevation;M.needsElevationUpdates=n.needsElevationUpdates2D(O.mode);return M};S._createAs3DShapeFill=function(M){var T=M.renderData.polygons;for(const {position:O,mapPosition:Q,
holeIndices:F,index:N,count:P}of T){if(a.isSome(this._context.clippingExtent)&&(e.empty(H),e.expandWithBuffer(H,Q),!e.intersectsClippingArea(H,this._context.clippingExtent)))continue;T=d.earcut(Q,F,3);0!==T.length&&(T=new Uint32Array(T),T=z.createColorGeometryData({indices:T,attributeData:{position:O,color:M.color,mapPosition:Q,uvMapSpace:this._needsUV?new Float32Array(M.uvMapSpace.buffer,4*N*M.uvMapSpace.BYTES_PER_ELEMENT,4*P):null,bound1:this._needsUV?new Float64Array(M.bound1.buffer,3*N*M.bound1.BYTES_PER_ELEMENT,
3*P):null,bound2:this._needsUV?new Float64Array(M.bound2.buffer,3*N*M.bound2.BYTES_PER_ELEMENT,3*P):null,bound3:this._needsUV?new Float64Array(M.bound3.buffer,3*N*M.bound3.BYTES_PER_ELEMENT,3*P):null}}),T=new y(T,M.idHint),M.outGeometries.push(T),M.outMaterials.push(a.unwrap(this._material)),M.outTransforms.push(h.IDENTITY),M.outNum++)}};S._createAs3DShapeOutline=function(M){if(this._hasOutline){var T=M.renderData.outlines,O=this._outlineMaterial instanceof E.NativeLineMaterial;for(let F=0;F<T.length;++F){const {mapPosition:N,
position:P}=T[F];if(a.isSome(this._context.clippingExtent)&&(e.empty(H),e.expandWithBuffer(H,N),!e.intersectsClippingArea(H,this._context.clippingExtent)))continue;var Q=D.createGeometryData({removeDuplicateStartEnd:O?0:1,attributeData:{position:P,mapPosition:N}});const U=Q.vertexAttributes[f.VertexAttrConstants.POSITION];U.data===P&&(U.data=new Float64Array(P));Q=new y(Q,M.idHint+"outline"+F);M.outGeometries.push(Q);M.outMaterials.push(a.unwrap(this._outlineMaterial));M.outTransforms.push(h.IDENTITY);
M.outNum++}}};S._createAsOverlay=function(M,T,O){const Q=z.geometryAsPolygon(M.geometry);if(a.isNone(Q))return null;a.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;a.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);J.renderData=z.geometryToRenderInfoDraped(Q,this._context.overlaySR);J.idHint=O;J.color=T;T=J.renderData.position.length/3;this._needsUV&&(J.uvMapSpace=new Float32Array(4*T));J.outNum=0;J.outGeometries=[];
J.outBoundingBox=e.empty();J.layerUid=this._context.layer.uid;J.graphicsUid=M.uid;this._createAsOverlayFill(J);this._hasOutline&&this._createAsOverlayOutline(J);this._logGeometryCreationWarnings(J.renderData,Q.rings,"rings","FillSymbol3DLayer");if(0===J.outNum)return null;this._needsUV&&q.createMapSpaceUVCoordsDraped(c.BufferViewVec4f.fromTypedArray(J.uvMapSpace),c.BufferViewVec3f64.fromTypedArray(J.renderData.position),this._context.overlaySR);return 0<J.outNum?new A(this,J.outGeometries,J.outBoundingBox):
null};S._createAsOverlayFill=function(M){var T=M.renderData.polygons;for(const {position:O,holeIndices:Q,index:F,count:N}of T){e.empty(H);e.expandWithBuffer(H,O);if(!e.intersectsClippingArea(H,this._context.clippingExtent))continue;T=d.earcut(O,Q,3);if(0===T.length)continue;e.expandWithAABB(M.outBoundingBox,H);T=new Uint32Array(T);T=z.createColorGeometryData({indices:T,attributeData:{position:O,color:M.color,uvMapSpace:this._needsUV?new Float32Array(M.uvMapSpace.buffer,4*F*M.uvMapSpace.BYTES_PER_ELEMENT,
4*N):null}});T=new t(T);T.data.layerUid=M.layerUid;T.data.graphicUid=M.graphicsUid;T.material=a.unwrap(this._material);const P=H;T.center=[.5*(P[0]+P[3]),.5*(P[1]+P[4]),0];T.bsRadius=.5*Math.sqrt((P[3]-P[0])*(P[3]-P[0])+(P[4]-P[1])*(P[4]-P[1]));M.outGeometries.push(T);M.outNum++}};S._createAsOverlayOutline=function(M){if(this._hasOutline){var T=M.renderData.outlines;for(let Q=0;Q<T.length;++Q){var {position:O}=T[Q];e.empty(H);e.expandWithBuffer(H,O);if(!e.intersectsClippingArea(H,this._context.clippingExtent))continue;
e.expandWithAABB(M.outBoundingBox,H);O=D.createGeometryData({removeDuplicateStartEnd:this._outlineMaterial instanceof E.NativeLineMaterial?0:1,attributeData:{position:O}});O=new t(O);O.data.layerUid=M.layerUid;O.data.graphicUid=M.graphicsUid;O.material=a.unwrap(this._outlineMaterial);const F=H;O.center=[.5*(F[0]+F[3]),.5*(F[1]+F[4]),0];O.bsRadius=.5*Math.sqrt((F[3]-F[0])*(F[3]-F[0])+(F[4]-F[1])*(F[4]-F[1]));M.outGeometries.push(O);M.outNum++}}};S._getOutlineOpacity=function(){const M=a.get(this.symbolLayer,
"outline","color");return(this.draped?1:this._getLayerOpacity())*(a.isSome(M)?M.a:0)};S._getOutlineColor=function(){const M=a.get(this.symbolLayer,"outline","color"),T=this._getOutlineOpacity();return p.mixinColorAndOpacity(a.isSome(M)?r.toUnitRGB(M):null,T)};k._createClass(L,[{key:"test",get:function(){return{createAsOverlay:(M,T,O)=>this._createAsOverlay(M,T,O),createAs3DShape:(M,T,O,Q)=>this._createAs3DShape(M,T,O,Q)}}}]);return L}(B.Graphics3DSymbolLayer);B.validGeometryTypes=["polyline","polygon",
"extent"];B.elevationModeChangeTypes={definedChanged:n.SymbolUpdateType.RECREATE,staysOnTheGround:n.SymbolUpdateType.NONE,onTheGroundChanged:n.SymbolUpdateType.RECREATE};const H=e.create(),I={idHint:null,renderData:null,color:null,uvMapSpace:null,bound1:null,bound2:null,bound3:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},J={idHint:null,renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};
b.Graphics3DPolygonFillSymbolLayer=B;b.default=B;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec4f64 ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/ColorMaterial".split(" "),function(b,k,a,r,l,h){function d(e,f,g){if(a.isSome(e)){if("none"===e.style||"solid"===e.style)return"none"===e.style&&(f.color=r.fromValues(0,0,0,0),f.transparent=
!0),new h.ColorMaterial(f,g.idHint+"_colormat");f.style=c(e.style);f.draped=g.isDraped;return new l.PatternMaterial(f,g.idHint+"_patternmat")}return new h.ColorMaterial(f,g.idHint+"_colormat")}function c(e){switch(e){case "horizontal":return 0;case "vertical":return 1;case "cross":return 2;case "forward-diagonal":return 3;case "backward-diagonal":return 4;case "diagonal-cross":return 5}}b.createMaterial=function(e,f,g){return d(e&&e.pattern||null,f,g)};b.createMaterialFromPattern=d;b.parsePatternStyle=
c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../lib/GLMaterial ./internal/MaterialUtil ../lib/Material ../lib/OrderIndependentTransparency ./internal/DefaultBufferWriter ../shaders/ColorMaterialTechnique".split(" "),function(b,k,a,r,l,h,d,c){let e=function(p){function n(q,m){q=p.call(this,m,q,g)||this;q.supportsEdges=!0;q.techniqueConfig=new c.ColorMaterialTechniqueConfiguration;
return q}k._inheritsLoose(n,p);var w=n.prototype;w.getTechniqueConfig=function(q,m){this.techniqueConfig.output=q;this.techniqueConfig.cullFace=this.params.cullFace;this.techniqueConfig.vertexColors=this.params.vertexColors;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.polygonOffset=this.params.polygonOffset;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.sceneHasOcludees=
this.params.sceneHasOcludees;this.techniqueConfig.transparencyPassType=m?m.transparencyPassType:3;this.techniqueConfig.enableOffset=m?m.camera.relativeElevation<h.OITPolygonOffsetLimit:!0;return this.techniqueConfig};w.getPassParameters=function(){return this.params};w.intersect=function(q,m,u,v,y,B,x){r.intersectTriangleGeometry(q,m,v,y,B,void 0,x)};w.getGLMaterial=function(q){return 0===q.output||7===q.output||4===q.output||1===q.output&&this.params.writeLinearDepth?new f(q):void 0};w.createBufferWriter=
function(){return new d.DefaultBufferWriter(d.PositionColorLayout)};return n}(l.Material),f=function(p){function n(q){q=p.call(this,q)||this;q.updateParameters();return q}k._inheritsLoose(n,p);var w=n.prototype;w.updateParameters=function(q){this.technique=this.techniqueRep.acquireAndReleaseExisting(c.ColorMaterialTechnique,this.material.getTechniqueConfig(this.output,q),this.technique)};w.beginSlot=function(q){return 4===this.output?3===q:q===(this.technique.configuration.transparent?this.technique.configuration.writeDepth?
5:8:3)};w._updateOccludeeState=function(q){q.hasOccludees!==this.material.params.sceneHasOcludees&&this.material.setParameterValues({sceneHasOcludees:q.hasOccludees})};w.ensureParameters=function(q){0!==this.output&&7!==this.output||this._updateOccludeeState(q);this.updateParameters(q)};w.bind=function(q,m){q.bindProgram(this.technique.program);this.technique.bindPass(q,this.material.getPassParameters(),m)};w.getPipelineState=function(q,m){return this.technique.getPipelineState(m)};return n}(a);const g=
{color:[1,1,1,1],transparent:!1,writeDepth:!0,writeLinearDepth:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1,cullFace:0,sceneHasOcludees:!1,...l.materialParametersDefaults};b.ColorMaterial=e;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../core/shaderLibrary/util/View.glsl ../core/shaderLibrary/Slice.glsl ../core/shaderLibrary/output/OutputHighlight.glsl ../lib/OrderIndependentTransparency ../lib/StencilUtils ../../../../chunks/ColorMaterial.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){h=function(v){function y(){return v.apply(this,arguments)||this}a._inheritsLoose(y,v);var B=y.prototype;B.initializeProgram=function(x){var C=y.shader.get();const z=this.configuration;C=C.build({output:z.output,OITEnabled:0===z.transparencyPassType,attributeColor:z.vertexColors,slicePlaneEnabled:z.slicePlaneEnabled,sliceHighlightDisabled:z.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1});return new e(x.rctx,C.generateSource("vertex"),C.generateSource("fragment"),
c.Default3D)};B.bindPass=function(x,C,z){g.View.bindProjectionMatrix(this.program,z.camera.projectionMatrix);this.program.setUniform4fv("eColor",C.color);4===this.configuration.output&&n.OutputHighlight.bindOutputHighlight(x,this.program,z);1===this.configuration.output&&this.program.setUniform2fv("nearFar",z.camera.nearFar)};B.bindDraw=function(x){g.View.bindView(this.program,x);p.Slice.bindUniformsWithOrigin(this.program,this.configuration,x)};B.setPipelineState=function(x,C){const z=this.configuration,
A=3===x,t=2===x;return f.makePipelineState({blending:0!==z.output&&7!==z.output||!z.transparent?null:A?w.blendingDefault:w.OITBlending(x),culling:(D=>0!==D&&{face:1===D?1028:1029,mode:2305})(z.cullFace),depthTest:{func:w.OITDepthTest(x)},depthWrite:A||t?z.writeDepth&&f.defaultDepthWriteParams:null,colorWrite:f.defaultColorWriteParams,stencilWrite:z.sceneHasOcludees?q.stencilWriteMaskOn:null,stencilTest:z.sceneHasOcludees?C?q.stencilToolMaskBaseParams:q.stencilBaseAllZerosParams:null,polygonOffset:A||
t?z.polygonOffset&&u:w.getOITPolygonOffset(z.enableOffset)})};B.initializePipeline=function(){this._occludeePipelineState=this.setPipelineState(this.configuration.transparencyPassType,!0);return this.setPipelineState(this.configuration.transparencyPassType,!1)};B.getPipelineState=function(x){return x?this._occludeePipelineState:this.pipeline};return y}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(m.ColorMaterialShader,()=>new Promise(function(v,y){b(["./ColorMaterial.glsl"],v,y)}));const u=
{factor:1,units:1};l=function(v){function y(){var B=v.apply(this,arguments)||this;B.output=0;B.cullFace=0;B.slicePlaneEnabled=!1;B.sliceHighlightDisabled=!1;B.vertexColors=!1;B.transparent=!1;B.polygonOffset=!1;B.enableOffset=!0;B.writeDepth=!0;B.sceneHasOcludees=!1;B.transparencyPassType=3;return B}a._inheritsLoose(y,v);return y}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter({count:8})],l.prototype,"output",void 0);r.__decorate([d.parameter({count:3})],l.prototype,"cullFace",void 0);
r.__decorate([d.parameter()],l.prototype,"slicePlaneEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"sliceHighlightDisabled",void 0);r.__decorate([d.parameter()],l.prototype,"vertexColors",void 0);r.__decorate([d.parameter()],l.prototype,"transparent",void 0);r.__decorate([d.parameter()],l.prototype,"polygonOffset",void 0);r.__decorate([d.parameter()],l.prototype,"enableOffset",void 0);r.__decorate([d.parameter()],l.prototype,"writeDepth",void 0);r.__decorate([d.parameter()],l.prototype,
"sceneHasOcludees",void 0);r.__decorate([d.parameter({count:4})],l.prototype,"transparencyPassType",void 0);k.ColorMaterialTechnique=h;k.ColorMaterialTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f){function g(n){const w=new r.ShaderBuilder,q=1===n.output;w.include(a.Transform,{linearDepth:q});w.include(e.VertexColor,n);w.vertex.uniforms.add("proj","mat4").add("view","mat4");w.attributes.add("position","vec3");w.varyings.add("vpos","vec3");q&&(w.include(f.OutputDepth,n),w.vertex.uniforms.add("nearFar","vec2"),w.varyings.add("linearDepth","float"));w.vertex.code.add(k.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      gl_Position = ${q?k.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:k.glsl`transformPosition(proj, view, vpos);`}
    }
  `);w.include(h.Slice,n);w.fragment.include(l.ColorConversion);w.fragment.uniforms.add("eColor","vec4");4===n.output&&w.include(d.OutputHighlight);w.fragment.code.add(k.glsl`
  void main() {
    discardBySlice(vpos);
    vec4 color = ${n.attributeColor?"vColor * eColor;":"eColor;"}

    if (color.a < ${k.glsl.float(c.symbolAlphaCutoff)}) {
      discard;
    }

    ${7===n.output?k.glsl`gl_FragColor = vec4(color.a);`:""}

    ${0===n.output?k.glsl`gl_FragColor = highlightSlice(color, vpos); ${n.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
    ${4===n.output?k.glsl`outputHighlight();`:""};
    ${1===n.output?k.glsl`outputDepth(linearDepth);`:""};
  }
  `);return w}var p=Object.freeze({__proto__:null,build:g});b.ColorMaterialShader=p;b.build=g})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Error ../../../../core/ObjectPool ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ../../../../chunks/vec2f64 ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/materials/HUDMaterial ./graphicUtils ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ../../webgl-engine/lib/Geometry ./Graphics3DSymbolLayer ./pointUtils ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTexture".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x){function C(D,E,G){D&&D.forEach(H=>{const I=E(H);a.isSome(I)&&G(I,H.graphic)})}const z=[0,0,1];v=function(D){function E(H,I,J,K){H=D.call(this,H,I,J,K)||this;H._geometryDataPool=new l(e.GeometryData,(L,S,M)=>{const T=S.translation;M=a.isSome(M)?[M.displayWidth,M.displayHeight]:[0,0];S=S.centerOffset;0===L.indexCount?f.createPointGeometry(z,T,null,M,S,[0,0],null,L):f.updatePointGeometry(null,T,null,M,S,null,null,L)});H._elevationOptions={supportsOffsetAdjustment:!0,
supportsOnTheGround:!1};H.ensureDrapedStatus(!1);return H}k._inheritsLoose(E,D);var G=E.prototype;G.doLoad=async function(){if(!this._drivenProperties.size){const H=p.validateSymbolLayerSize(this.symbolLayer.size);if(H)throw new r("graphics3dtextsymbollayer:invalid-size",H);}this._createTextRenderParameters()};G._createTextRenderParameters=function(){this._textRenderParameters=B.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.layerView.view.pixelRatio)};G.destroy=function(){D.prototype.destroy.call(this);
this._geometryDataPool.destroy()};G.createGraphics3DGraphic=function(H){H=H.graphic;const I=y.placePointOnGeometry(H.geometry);if(a.isNone(I))return this.logger.warn(`unsupported geometry type for text symbol: ${H.geometry.type}`),null;const J=this.symbolLayer.text;if(!J)return null;const K=d.isCalloutSupport(this.symbol)&&this.symbol.hasVisibleVerticalOffset()?this.symbol:null;return this._createAs3DShape(H,I,J,K)};G.onRemoveGraphic=function(H){this._geometryDataPool.release(H.stageObject.geometries[0].data)};
G.createLabel=function(H,I,J,K){H=H.graphic;const L=y.placePointOnGeometry(H.geometry);if(a.isNone(L))return this.logger.warn(`unsupported geometry type for label: ${H.geometry.type}`),null;const S=I.text;return!S||/^\s+$/.test(S)?null:this._createAs3DShape(H,L,S,I,I,J,K)};G.setGraphicElevationContext=function(H,I,J=0){H=D.prototype.setGraphicElevationContext.call(this,H,I);H.addOffsetRenderUnits(J);return H};G.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");
return!1};G.layerElevationInfoChanged=function(H,I){C(H,I,(J,K)=>{this.updateGraphicElevationContext(K,J)});return n.SymbolUpdateType.UPDATE};G.slicePlaneEnabledChanged=function(H,I){C(H,I,J=>{for(const K of J.stageObject.geometryRecords)K.material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled})});return!0};G.physicalBasedRenderingChanged=function(){return!0};G.pixelRatioChanged=function(){return!1};G.updateGraphicElevationContext=function(H,I){this.setGraphicElevationContext(H,
I.elevationContext,I.metadata.elevationOffset);I.needsElevationUpdates=n.needsElevationUpdates2D(I.elevationContext.mode)||"absolute-height"===I.elevationContext.mode};G._defaultElevationInfoNoZ=function(){return A};G._createAs3DShape=function(H,I,J,K,L=t,S,M){const T=this.setGraphicElevationContext(H,new q.ElevationContext,L.elevationOffset);var O=this._context.layer.id+"_label_"+H.uid;const Q="polyline"===a.get(H.geometry,"type");var F=H.uid;H=this._context.stage.renderView.renderingContext;var N=
p.namedAnchorToHUDMaterialAnchorPos[L.anchor in p.namedAnchorToHUDMaterialAnchorPos?L.anchor:"center"];H=a.isNone(M)?new x(H,J,this._textRenderParameters,O):null;N={occlusionTest:!0,screenOffset:L.screenOffset,anchorPos:N,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:L.centerOffsetUnits,debugDrawBorder:L.debugDrawBorder,drawInSecondSlot:!0};a.isSome(H)&&(N.textureId=H.id,N.texCoordScale=H.texcoordScale);a.isSome(M)&&(N.textureId=M.textureId);if(a.isSome(K)&&a.isSome(K.verticalOffset)){const {screenLength:V,
minWorldLength:W,maxWorldLength:X}=K.verticalOffset;N.verticalOffset={screenLength:h.pt2px(V),minWorldLength:W||0,maxWorldLength:null!=X?X:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:V,screenSizePerspectiveSettingsLabels:W}=this._context.sharedResources;N.screenSizePerspective=W.overridePadding(this._textRenderParameters.haloSize);N.screenSizePerspectiveAlignment=V}Q&&(N.shaderPolygonOffset=1E-4);N.slicePlaneEnabled=this._context.slicePlaneEnabled;
K=null;a.isSome(S)?(M=JSON.stringify(N),K=S.getMaterial(M),null==K&&(K=new g.HUDMaterial(N,O),S.addMaterial(M,K))):K=new g.HUDMaterial(N,O);K=[K];M=this._geometryDataPool.acquire(L,H);M=[new u(M,O)];O=y.createStageObjectForHUD(this._context,I,M,K,null,null,T,O,this._context.layer.uid,F);if(null===O)return null;F=w.perObjectElevationAligner;S=new m(this,O.object,M,a.isNone(S)?K:null,a.isSome(H)?[H]:null,F,T);S.alignedSampledElevation=O.sampledElevation;S.needsElevationUpdates=n.needsElevationUpdates2D(T.mode)||
"absolute-height"===T.mode;const {displayWidth:P,displayHeight:U}=a.isSome(H)?H:L;S.getScreenSize=(V=c.create())=>{V[0]=P;V[1]=U;return V};S.metadata={labelText:J,elevationOffset:L.elevationOffset};y.extendPointGraphicElevationContext(S,I,this._context.elevationProvider);return S};return E}(v.Graphics3DSymbolLayer);const A={mode:"relative-to-ground",offset:0},t={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],anchor:"center",verticalOffset:null,centerOffsetUnits:null,
debugDrawBorder:!1,displayWidth:0,displayHeight:0};b.Graphics3DTextSymbolLayer=v;b.default=v;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Evented ../../../../core/mathUtils ../../../webgl/Texture ../../../webgl/capabilities/isWebGL2Context ./Texture ./TextRenderer".split(" "),function(b,k,a,r,l,h,d,c){const e={canvas:null};return function(){function f(p,
n,w,q){this._idHint=q;this._glTexture=null;this.events=new a;this._requiresPowerOfTwo=!h(p.gl);this._renderer=new c.TextRenderer(n,w)}var g=f.prototype;g.createDescriptor=function(p){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:p.parameters.maxMaxAnisotropy}};g.load=function(p){if(k.isSome(this._glTexture))return this._glTexture;const n=c.getTextHelperCanvas(e,this.textureWidth,this.textureHeight),w=n.getContext("2d");
w.save();this._renderer.render(w,0,this.textureHeight-this._renderer.renderedHeight);this._glTexture=new l(p,this.createDescriptor(p),n);w.restore();return this._glTexture};g.unload=function(){k.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);this.events.emit("unloaded")};b._createClass(f,[{key:"id",get:function(){null==this._id&&(this._id=d.idGen.gen(this._idHint));return this._id}},{key:"width",get:function(){return this._renderer.renderedWidth}},{key:"height",get:function(){return this._renderer.renderedHeight}},
{key:"textureWidth",get:function(){const p=this.width;return this._requiresPowerOfTwo?r.nextHighestPowerOfTwo(p):p}},{key:"textureHeight",get:function(){const p=this.height;return this._requiresPowerOfTwo?r.nextHighestPowerOfTwo(p):p}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}},{key:"texcoordScale",get:function(){return[this._renderer.renderedWidth/this.textureWidth,this._renderer.renderedHeight/
this.textureHeight]}},{key:"requiresFrameUpdates",get:function(){return!1}}]);return f}()})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../Color ../../../../chunks/common ../../../../core/unitUtils ../../../../geometry/support/aaBoundingRect ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../core/libs/earcut/earcut ../../../../chunks/vec2 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Object3D ./elevationAlignmentUtils ./ElevationAligners ./ElevationContext ./Graphics3DObject3DGraphicLayer ../../webgl-engine/lib/Geometry ./Graphics3DSymbolLayer ./polygonUtils ./Graphics3DDrapedGraphicLayer ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/internal/waterMaterialUtils ../../webgl-engine/materials/WaterMaterial".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t){B=function(K){function L(M,T,O,Q){return K.call(this,M,T,O,Q)||this}k._inheritsLoose(L,K);var S=L.prototype;S.doLoad=async function(){};S.destroy=function(){K.prototype.destroy.call(this);a.isSome(this._material)&&(this._context.stage.remove(3,this._material.id),this._material=null)};S.createGraphics3DGraphic=function(M){M=M.graphic;if(!this._validateGeometryType(M.geometry,L.validGeometryTypes,this.symbolLayer.type)||!this._validateGeometry(M.geometry))return null;
const T="graphic"+M.uid,O=this.setGraphicElevationContext(M,new u.ElevationContext);this.ensureDrapedStatus("on-the-ground"===O.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(M,T):this._createAs3DShape(M,O,T,M.uid)};S.ensureMaterial=function(){if(!a.isSome(this._material)){var M={...A.defaultWaterMaterialParameters},T=this.symbolLayer.color;a.isSome(T)&&(M.color=r.toUnitRGBA(T));T=this._getCombinedOpacity(T,{hasIntrinsicColor:!0});M.color=[M.color[0],M.color[1],M.color[2],T];
M.transparent=1>T||this.needsDrivenTransparentPass;M.waveDirection=a.isSome(this.symbolLayer.waveDirection)?L.headingVectorFromAngle(this.symbolLayer.waveDirection):e.fromValues(0,0);T=A.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];M.waveStrength=T.waveStrength;M.waveTextureRepeat=T.textureRepeat;M.waveVelocity=T.waveVelocity;M.flowStrength=T.perturbationStrength;M.slicePlaneEnabled=this._context.slicePlaneEnabled;M.isDraped=this.draped;this._material=new t.WaterMaterial(M,
"water");this._context.stage.add(3,this._material)}};S.layerOpacityChanged=function(){if(a.isNone(this._material))return!0;const M=this._material.params.color,T=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameterValues({color:[M[0],M[1],M[2],T],transparent:1>T||this.needsDrivenTransparentPass});return!0};S.layerElevationInfoChanged=function(M,T,O){const Q=this._elevationContext.mode;O=q.elevationModeChangeUpdateType(L.elevationModeChangeTypes,O,Q);if(O!==
q.SymbolUpdateType.UPDATE)return O;const F=q.needsElevationUpdates2D(Q);return this.updateGraphics3DGraphicElevationInfo(M,T,()=>F)};S.slicePlaneEnabledChanged=function(){a.isSome(this._material)&&this._material.setParameterValues({slicePlaneEnabled:this._context.slicePlaneEnabled});return!0};S.physicalBasedRenderingChanged=function(){return!0};S.pixelRatioChanged=function(){return!0};S._createAs3DShape=function(M,T,O,Q){M=x.geometryAsPolygon(M.geometry);if(a.isNone(M))return null;I.renderData=x.geometryToRenderInfo(M,
this._context.elevationProvider,this._context.renderCoordsHelper,T);const F=I.renderData.position.length/3;I.uvCoords=new Float64Array(2*F);I.idHint=O;I.outNum=0;I.outGeometries=[];I.outTransforms=[];I.outMaterials=[];this._create3DShapeGeometries(I);this._logGeometryCreationWarnings(I.renderData,M.rings,"rings","WaterSymbol3DLayer");if(0===I.outNum)return null;this._createUVCoordsFromVertices(I.uvCoords,I.renderData.mapPosition,F,this._context.elevationProvider.spatialReference);O=new w({geometries:I.outGeometries,
materials:I.outMaterials,transformations:I.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:Q},idHint:O});O=new v(this,O,I.outGeometries,null,null,m.perVertexElevationAligner,T);O.alignedSampledElevation=I.renderData.sampledElevation;O.needsElevationUpdates=q.needsElevationUpdates2D(T.mode);return O};S._createUVCoordsFromVertices=function(M,T,O,Q){Q=h.getMetersPerUnitForSR(Q);d.empty(E);for(var F=0;F<O;F++)g.set(G,T[3*F],T[3*F+1]),d.expandPointInPlace(E,G);p.scale(E,
E,Q);F=E[1]%L.unitSizeOfTexture;D[0]=E[0]-E[0]%L.unitSizeOfTexture;D[1]=E[1]-F;for(F=0;F<O;F++)M[2*F]=(T[3*F]*Q-D[0])/L.unitSizeOfTexture,M[2*F+1]=(T[3*F+1]*Q-D[1])/L.unitSizeOfTexture};S._create3DShapeGeometries=function(M){var T=M.renderData.polygons;const O=M.uvCoords;for(const {count:Q,index:F,position:N,mapPosition:P,holeIndices:U}of T){if(a.isSome(this._context.clippingExtent)&&(n.empty(H),n.expandWithBuffer(H,P),!n.intersectsClippingArea(H,this._context.clippingExtent)))continue;T=f.earcut(P,
U,3);if(0===T.length)continue;T=new Uint32Array(T);const V=new Float64Array(O.buffer,2*F*O.BYTES_PER_ELEMENT,2*Q);T=x.createWaterGeometryData({indices:T,attributeData:{position:N,uv0:V,mapPosition:P}});T=new y(T,M.idHint);M.outGeometries.push(T);M.outMaterials.push(a.unwrap(this._material));M.outTransforms.push(c.IDENTITY);M.outNum++}};S._createAsOverlay=function(M,T){const O=x.geometryAsPolygon(M.geometry);if(a.isNone(O))return null;a.unwrap(this._material).renderPriority=this._renderPriority;J.renderData=
x.geometryToRenderInfoDraped(O,this._context.overlaySR);J.idHint=T;T=J.renderData.position.length/3;J.uvCoords=new Float64Array(2*T);J.outNum=0;J.outGeometries=[];J.outBoundingBox=n.empty();J.layerUid=this._context.layer.uid;J.graphicsUid=M.uid;this._createAsOverlayWater(J);this._logGeometryCreationWarnings(J.renderData,O.rings,"rings","WaterSymbol3DLayer");if(0===J.outNum)return null;this._createUVCoordsFromVertices(J.uvCoords,J.renderData.position,T,this._context.overlaySR);return 0<J.outNum?new C(this,
J.outGeometries,J.outBoundingBox):null};S._createAsOverlayWater=function(M){const T=M.uvCoords;var O=M.renderData.polygons;for(const {position:F,holeIndices:N,index:P,count:U}of O)if(n.empty(H),n.expandWithBuffer(H,F),n.intersectsClippingArea(H,this._context.clippingExtent)&&(n.expandWithAABB(M.outBoundingBox,H),O=f.earcut(F,N,3),0!==O.length)){O=new Uint32Array(O);var Q=new Float64Array(T.buffer,2*P*T.BYTES_PER_ELEMENT,2*U);O=x.createWaterGeometryData({indices:O,attributeData:{position:F,uv0:Q}});
O=new z(O);O.data.layerUid=M.layerUid;O.data.graphicUid=M.graphicsUid;O.material=a.unwrap(this._material);Q=H;O.center=[.5*(Q[0]+Q[3]),.5*(Q[1]+Q[4]),0];O.bsRadius=.5*Math.sqrt((Q[3]-Q[0])*(Q[3]-Q[0])+(Q[4]-Q[1])*(Q[4]-Q[1]));M.outGeometries.push(O);M.outNum++}};L.headingVectorFromAngle=function(M){const T=e.create();M=l.toRadian(M);T[0]=Math.sin(M);T[1]=Math.cos(M);return T};k._createClass(L,[{key:"test",get:function(){return{create3DShape:M=>this._createAs3DShape(M.graphic,M.elevationContext,M.idHint,
M.graphicUid),ensureMaterial:()=>this.ensureMaterial()}}}]);return L}(B.Graphics3DSymbolLayer);B.validGeometryTypes=["polyline","polygon","extent"];B.unitSizeOfTexture=100;B.elevationModeChangeTypes={definedChanged:q.SymbolUpdateType.RECREATE,staysOnTheGround:q.SymbolUpdateType.NONE,onTheGroundChanged:q.SymbolUpdateType.RECREATE};const D=e.create(),E=d.create(),G=e.create(),H=n.create(),I={idHint:null,renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,
outTransforms:null},J={idHint:null,renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};b.Graphics3DWaterSymbolLayer=B;b.default=B;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports","../../../../../chunks/vec2f64","../../lib/Material"],function(b,k,a){k={waveStrength:.06,waveTextureRepeat:32,waveDirection:k.fromValues(1,0),waveVelocity:.05,
flowStrength:.015,flowOffset:-.5,animationSpeed:.35,color:[0,0,0,0],transparent:!0,writeDepth:!0,slicePlaneEnabled:!1,isDraped:!1,receiveShadows:!0,ssrEnabled:!1,...a.materialParametersDefaults};b.defaultWaterMaterialParameters=k;b.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,
waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,
perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ./internal/MaterialUtil ../lib/Material ../lib/OrderIndependentTransparency ./internal/DefaultBufferWriter ./WaterTechnique ./WaterGLMaterial ../lib/AnimationTimer ./internal/waterMaterialUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f){r=function(g){function p(w,q){w=g.call(this,q,w,f.defaultWaterMaterialParameters)||this;w.animation=new e.AnimationTimer;w.techniqueConfig=new d.WaterTechniqueConfiguration;return w}k._inheritsLoose(p,g);var n=p.prototype;n.getTechniqueConfig=function(w,q){this.techniqueConfig.output=w;this.techniqueConfig.writeDepth=this.params.writeDepth;this.techniqueConfig.receiveShadows=this.params.receiveShadows;this.techniqueConfig.slicePlaneEnabled=this.params.slicePlaneEnabled;
this.techniqueConfig.transparent=this.params.transparent;this.techniqueConfig.useSSR=this.params.ssrEnabled;this.techniqueConfig.isDraped=this.params.isDraped;this.techniqueConfig.transparencyPassType=q?q.transparencyPassType:3;this.techniqueConfig.enableOffset=q?q.camera.relativeElevation<l.OITPolygonOffsetLimit:!0;return this.techniqueConfig};n.update=function(w){this.animation.enabled=35E3>Math.sqrt(this.params.waveTextureRepeat/this.params.waveStrength)*Math.min(w.camera.relativeElevation,w.camera.distance);
this.animation.advance(w.dt);return this.animation.enabled};n.intersect=function(w,q,m,u,v,y,B){a.intersectTriangleGeometry(w,q,u,v,y,void 0,B)};n.getGLMaterial=function(w){if(0===w.output&&this.params.isDraped)return w.output=5,new c.WaterGLMaterial(w);switch(w.output){case 0:case 2:case 4:case 7:return new c.WaterGLMaterial(w)}};n.createBufferWriter=function(){return new h.DefaultBufferWriter(h.PositionUVLayout)};return p}(r.Material);b.WaterMaterial=r;Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../layers/support/timeUtils"],function(b,k,a,r){let l=function(){function h(c=!0){this.enabled=c;this._time=0}var d=h.prototype;d.advance=function(c){this.enabled&&(this._time+=c)};d.stopAtTime=function(c){this._forcedTime=c};k._createClass(h,[{key:"time",get:function(){return a.isSome(this._forcedTime)?this._forcedTime:r.Milliseconds(this._time)}}]);
return h}();b.AnimationTimer=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./Loadable","./symbolComplexity"],function(b,k,a,r){return function(l){function h(c,e){var f=l.call(this)||this;f.symbol=c;f.convert=e;f.graphics3DSymbol=null;f.referenced=0;return f}b._inheritsLoose(h,l);var d=h.prototype;d.getSymbolLayerSize=function(c){return k.isSome(this.graphics3DSymbol)?
this.graphics3DSymbol.getSymbolLayerSize(c):null};d.doLoad=async function(c){c=await this.symbol.fetchSymbol({signal:c});c.id=this.symbol.id;this.graphics3DSymbol=this.convert(c);await this.graphics3DSymbol.load()};d.createGraphics3DGraphic=function(c){return k.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(c,this):null};d.globalPropertyChanged=function(c,e){return k.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(c,e):!1};d.applyRendererDiff=
function(c,e){return k.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(c,e):!1};d.prepareSymbolPatch=function(c){k.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(c)};d.updateGeometry=function(c,e){return k.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.updateGeometry(c,e):!1};d.onRemoveGraphic=function(){};d.getFastUpdateStatus=function(){return k.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};
d.destroy=function(){k.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;this.abortLoad()};b._createClass(h,[{key:"extentPadding",get:function(){return k.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}},{key:"complexity",get:function(){return k.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:r.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]);return h}(a.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/materials/HUDMaterial ./graphicSymbolUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){function p(t){t=g.getGraphics3DSymbol(t.graphics3DGraphic.graphics3DSymbol);return a.isSome(t)?t.symbol.symbolLayers.getItemAt(0):null}function n(t,D){var E=D.graphics3DGraphic.graphic.geometry;if(a.isNone(E))return null;if(a.isSome(D.disablePlacement))return D.labelClass.labelPlacement?(B.warnOncePerTick(w(t.placement,D.disablePlacement.logEntityDescription)),q(D)):t;E=E.type;switch(E){case "polyline":case "polygon":case "extent":case "multipoint":if(D.labelClass.labelPlacement)return B.warnOncePerTick(w(t.placement,
`'${E}' geometries`)),q(D)}return t}function w(t,D){return`the requested label placement '${t}' is currently unsupported for ${D} in SceneView`}function q(t){const D=t.graphics3DGraphic.graphic.geometry;if(a.isNone(D))return null;switch(D.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return t=p(t),a.isSome(t)&&"extrude"===t.type?x["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};
case "point":return x["above-center"];case "mesh":return x["above-center"]}}function m(t,D=z){({graphics3DGraphic:t}=t);t=t._graphics[0];(t=a.isSome(t)?t.stageObject.geometryRecords[0].material:null)&&t instanceof f.HUDMaterial?(t=t.params.anchorPos,D[0]=2*(t[0]-.5),D[1]=2*(t[1]-.5)):(D[0]=0,D[1]=0);return D}function u(t,D,E){E=E.graphics3DGraphic._graphics[0];E=a.isSome(E)?E.getBoundingBoxObjectSpace(A):A;E=l.fromValues(E[3]-E[0],E[4]-E[1],E[5]-E[2]);t.centerOffset[0]=Math.sqrt(E[0]*E[0]+E[1]*E[1])/
2*D.normalizedOffset[0];const G=t.translation[2],H=E[2]/2*D.normalizedOffset[1];t.translation[2]=0;t.elevationOffset=G+H;E=h.length(E);t.centerOffset[2]=E/2*D.normalizedOffset[2]}function v(t){const D=t.labelClass.labelPlacement,{labelSymbol:E,graphics3DGraphic:G}=t;var H=g.getGraphics3DSymbol(G.graphics3DSymbol);H=a.isSome(H)?H.symbol:null;t=x[D]||q(t);if("point-3d"===H.type&&H.supportsCallout()&&H.hasVisibleVerticalOffset()&&!G.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:y(H.verticalOffset),
anchor:null,normalizedOffset:null};if(E&&E.hasVisibleVerticalOffset()&&("point-3d"!==H.type||!H.supportsCallout()||!H.verticalOffset||G.isDraped)){a:switch(t.placement){case "above-center":H=!0;break a;default:H=!1}return H?{placement:"above-center",verticalOffset:y(E.verticalOffset),anchor:"bottom",normalizedOffset:[0,t.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(B.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+
D+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function y(t){const {screenLength:D,minWorldLength:E,maxWorldLength:G}=t;return{screenLength:D,minWorldLength:E,maxWorldLength:G}}const B=r.getLogger("esri.views.3d.layers.graphics.labelPlacement"),x={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",
normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",
normalizedOffset:[1,0,0],anchor:"left"}};k={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],
"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const t in k){const D=x[t];k[t].forEach(E=>{x[E]=D})}Object.freeze&&(Object.freeze(x),Object.keys(x).forEach(function(t){Object.freeze(x[t]);Object.freeze(x[t].normalizedOffset)}));const C=[0,0],z=[0,0],A=e.create();b.get=function(t){var D=v(t);if(a.isNone(D))return null;if(D.anchor)var E=D;else{E=t.labelClass.labelPlacement;var G=x[E],H=G||q(t);E&&!G&&B.warnOncePerTick(`the requested label placement '${E}' is not currently supported in SceneView`);
E=n(H,t)}if(a.isNone(E))return null;G=!!D.hasLabelVerticalOffset;D={anchor:E.anchor,verticalOffset:D.verticalOffset,screenOffset:d.create(),centerOffset:c.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:l.create(),elevationOffset:0,hasLabelVerticalOffset:G};G=t.graphics3DGraphic.graphic.geometry;if(a.isNone(G))t=null;else{switch(G.type){case "point":G=p(t);if(!a.isNone(G))switch(t.graphics3DGraphic.getCenterObjectSpace(D.translation),G.type){case "icon":case "text":({graphics3DGraphic:G}=
t);H=G._graphics[0];H=a.isSome(H)?H.getScreenSize():null;!G.isDraped&&a.isSome(H)?(t=m(t),C[0]=H[0]/2*(E.normalizedOffset[0]-t[0]),C[1]=H[1]/2*(E.normalizedOffset[1]-t[1]),D.screenOffset[0]=C[0],D.hasLabelVerticalOffset?(D.centerOffset[1]=C[1],D.centerOffsetUnits="screen"):D.screenOffset[1]=C[1]):D.hasLabelVerticalOffset||"center"===D.anchor||(x[t.labelClass.labelPlacement]&&B.warnOncePerTick(`the requested placement '${E.placement}' is currently unsupported for draped graphics`),D.anchor="center");
break;case "object":u(D,E,t)}break;case "polygon":G=p(t);if(!a.isNone(G))switch(G.type){case "extrude":G=t.graphics3DGraphic._graphics[0],a.isSome(G)&&G.getBoundingBoxObjectSpace(A),e.center(A,D.translation),D.translation[2]=e.height(A)/2,u(D,E,t)}break;case "mesh":u(D,E,t)}t=D}return t};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(function(){return function(){function b(a){this.materials={};this.stage=a}var k=b.prototype;
k.getMaterial=function(a){return this.materials[a]};k.addMaterial=function(a,r){this.materials[a]=r;this.stage.add(3,r)};k.dispose=function(){for(const a in this.materials)this.stage.remove(3,this.materials[a].id);this.materials={}};return b}()})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../core/mathUtils ../../../support/Scheduler ../../../../core/MapUtils ../../../webgl/Texture ./Texture".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){var x;b.TextTextureAtlas=x=function(C){function z(t){t=C.call(this,t)||this;t.events=new q;t.glTexture=null;t.needsClear=!1;t.elementsToAddOrUpdate=new Map;t.elementsToRemove=new Map;t.elementsToRender=new Map;t.elements=new Map;t.stageObjects=new Map;t.updating=!1;return t}k._inheritsLoose(z,C);var A=z.prototype;A.initialize=function(){this.id=B.idGen.gen(this.idHint);this.stage=this.view._stage;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");
this.stage.add(4,this);const t=this.computeAtlasResolution(this.view.width,this.view.height);this.createAtlasRegion(t);this.update2DCanvasSize();this.resetAtlasCursor()};A.unload=function(){l.isSome(this.glTexture)&&(this.glTexture.dispose(),this.glTexture=null);this.events.emit("unloaded")};A.createDescriptor=function(t){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,flipped:!0,samplingMode:9987,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:t.parameters.maxMaxAnisotropy}};A.load=
function(t){if(l.isSome(this.glTexture))return this.glTexture;this.glTexture=new y(t,this.createDescriptor(t),this.canvas);this.frameWorker=this.view.resourceController.scheduler.registerTask(u.Task.TEXT_TEXTURE_ATLAS,D=>this.run(D,!0),()=>this.updating);this.setDirty();return this.glTexture};A.dispose=function(){this.elementsToRender=this.elementsToRemove=this.elementsToAddOrUpdate=this.elements=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.glTexture&&(this.stage.remove(4,
this.id),this.glTexture=null);this.canvas.width=0;this.canvas.height=0;this.ctx=this.canvas=null};A.create2DCanvas=function(){const t=document.createElement("canvas");t.setAttribute("id","canvas2d");t.setAttribute("style","display:none");t.setAttribute("width",(512).toString());t.setAttribute("height",(512).toString());return t};A.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};A.createAtlasRegion=
function(t=512){this.atlas={size:{width:t,height:t},cursor:{x:0,y:0},lineHeight:0}};A.computeAtlasResolution=function(t,D){t=Math.max(t,D);t=m.nextHighestPowerOfTwo(t+256);return t=Math.min(t,4096)};A.resizeAtlas=function(t,D){D=D||t;const E=this.atlas;E.size.width=t;E.size.height=D;l.isSome(this.glTexture)&&this.glTexture.resize(t,D);this.update2DCanvasSize()};A.resetAtlasCursor=function(){const t=this.atlas;t.cursor.x=2;t.cursor.y=4;t.lineHeight=0;this.needsClear=!0};A.getAtlasUsage=function(){const t=
this.atlas;return(t.cursor.x+t.cursor.y*t.size.width)/(t.size.width*t.size.height)};A.getExpectedAtlasUsage=function(){const t=this.elementsToRemove.size,D=this.elementsToAddOrUpdate.size,E=this.elements.size;return this.getAtlasUsage()/E*(E+D-t)};A.addAtlasElement=function(t,D,E,G){const H=this.atlas,{renderedWidth:I,renderedHeight:J,displayWidth:K,displayHeight:L}=t.textRenderer;t.placement.offset.x=H.cursor.x;t.placement.offset.y=H.cursor.y;t.placement.size.width=I;t.placement.size.height=J;t.placement.size.displayWidth=
K;t.placement.size.displayHeight=L;t.placement.uvMinMax=[t.placement.offset.x/H.size.width,1-(t.placement.offset.y+J)/H.size.height,(t.placement.offset.x+I)/H.size.width,1-t.placement.offset.y/H.size.height];H.cursor.x+=E;H.lineHeight=Math.max(H.lineHeight,G);this.elements.set(D,t)};A.removeAtlasElement=function(t){if(t&&this.elements.has(t.textId)){const D=t.placement.offset,E=t.placement.size;this.ctx.clearRect(D.x,D.y,E.width,E.height);this.elements.delete(t.textId)}};A.ensureStageObjects=function(t){var D=
this.stageObjects.get(t);if(D)return D;D=new Set;this.stageObjects.set(t,D);return D};A.addStageObject=function(t,D){this.ensureStageObjects(t).add(D)};A.removeStageObject=function(t,D){(t=this.stageObjects.get(t))&&t.delete(D)&&(D.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),D.geometryVertexAttrsUpdated(0))};A._processAddition=function(t,D){const E=this.atlas;var G=t.textId;const H=t.textRenderer.renderedWidth+2,I=t.textRenderer.renderedHeight+2+2;if(E.cursor.x+H<E.size.width&&
E.cursor.y+I<E.size.height)this.addAtlasElement(t,G,H,I),this.elementsToRender.set(G,t),this.elementsToAddOrUpdate.delete(G);else if(E.cursor.y+I+E.lineHeight<E.size.height)E.cursor.x=2,E.cursor.y+=E.lineHeight,E.lineHeight=0,this.addAtlasElement(t,G,H,I),this.elementsToRender.set(G,t),this.elementsToAddOrUpdate.delete(G);else{t=this.getExpectedAtlasUsage();(G=.85<t&&4096>E.size.width)&&this.resizeAtlas(2*E.size.width,2*E.size.height);if(!D||!G&&.95<t&&4096===E.size.width)return this.processRemovals(),
0;this.repack();return 1}return 0};A.processRemovals=function(){this.elementsToRemove.forEach((t,D)=>{const E=this.stageObjects.get(D);E&&0!==E.size||this.removeAtlasElement(t);E&&0===E.size&&this.stageObjects.delete(D)});this.elementsToRemove.clear()};A.repack=function(){this.processRemovals();this.elements.forEach((t,D)=>{t.rendered=!1;this.elementsToAddOrUpdate.set(D,t)});this.elements.clear();this.resetAtlasCursor();this.elementsToRender.clear()};A.processRenderingRequest=function(t){this.ctx.clearRect(t.placement.offset.x,
t.placement.offset.y,t.placement.size.width,t.placement.size.height);t.textRenderer.render(this.ctx,t.placement.offset.x,t.placement.offset.y);const D=this.stageObjects.get(t.textId);D&&D.forEach(E=>{E.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(t.placement.uvMinMax);E.geometries[0].data.vertexAttributes.size.data=new Float32Array([t.placement.size.displayWidth,t.placement.size.displayHeight]);E.geometryVertexAttrsUpdated(0)});t.rendered=!0};A.run=function(t,D){if(this.glTexture){var E=
!1;v.someMap(this.elementsToAddOrUpdate,(H,I)=>(H=this.elements.get(I))&&H.rendered?((H=this.stageObjects.get(I))&&H.forEach(J=>{const K=J.geometries[0].data.vertexAttributes,L=this.elements.get(I);K.uv0.data=new Float32Array(L.placement.uvMinMax);K.size.data=new Float32Array([L.placement.size.displayWidth,L.placement.size.displayHeight]);J.geometryVertexAttrsUpdated(0)}),this.elementsToAddOrUpdate.delete(I),!1):1===this._processAddition(this.elementsToAddOrUpdate.get(I),D)?E=!0:!1);if(E)this.run(u.noBudget,
!1);else{var G=!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);v.someMap(this.elementsToRender,(H,I)=>{this.processRenderingRequest(H);this.elementsToRender.delete(I);G=!0;t.madeProgress();return t.done});G&&l.isSome(this.glTexture)&&this.glTexture.setData(this.canvas);this.updating=0<this.elementsToRender.size;!this.updating&&x.test.orderedRepackingEnabled&&this.repackOrdered()}}};A.addTextTexture=function(t,D){const E=
t.key;this.elementsToAddOrUpdate.has(E)||this.elementsToAddOrUpdate.set(E,{textId:E,placement:{offset:{x:0,y:0},size:{width:0,height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:t,rendered:!1});this.addStageObject(E,D);this.elementsToRemove.delete(E);this.setDirty()};A.removeTextTexture=function(t,D){t=t.key;this.elementsToRemove.set(t,this.elements.get(t));this.removeStageObject(t,D)};A.setDirty=function(){this.updating=!0};A.repackOrdered=function(){if(0!==this.elements.size){var t=
[];this.elements.forEach((E,G)=>t.push({element:E,key:G}));var D=!0;for(let E=0;E<t.length-1;E++)if(0<t[E].key.localeCompare(t[E+1].key)){D=!1;break}if(!D||this.elementsToRemove.size){t.sort((E,G)=>E.key.localeCompare(G.key));this.elements.clear();for(const {element:E,key:G}of t)this.elements.set(G,E);this.repack();this.setDirty()}}};k._createClass(z,[{key:"width",get:function(){return this.atlas.size.width}},{key:"height",get:function(){return this.atlas.size.height}},{key:"requiresFrameUpdates",
get:function(){return!1}},{key:"textureId",get:function(){return this.id}},{key:"test",get:function(){const {elements:t,stageObjects:D,elementsToRemove:E,atlas:G}=this,H=this;return{elements:t,stageObjects:D,elementsToRemove:E,atlas:G,resizeAtlas:(I,J)=>H.resizeAtlas(I,J),run:(I,J)=>H.run(I,J)}}}]);return z}(w);b.TextTextureAtlas.test={orderedRepackingEnabled:!1};a.__decorate([c.property({constructOnly:!0})],b.TextTextureAtlas.prototype,"idHint",void 0);a.__decorate([c.property({constructOnly:!0})],
b.TextTextureAtlas.prototype,"view",void 0);a.__decorate([c.property({type:Boolean})],b.TextTextureAtlas.prototype,"updating",void 0);b.TextTextureAtlas=x=a.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],b.TextTextureAtlas);b.default=b.TextTextureAtlas;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/handleUtils ../../../../core/promiseUtils ../../../../core/Handles ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),
function(b,k,a,r,l,h,d,c,e){let f=function(){function p(){this.gltfCache=new Map;this.wosrCache=new Map;this.evictHandles=new h}var n=p.prototype;n.loadGLTF=function(w,q){return this.fromCache(this.gltfCache,`gltf:${w}`,m=>c.load(new d.DefaultLoadingContext(m.streamDataRequester),w,m),q)};n.loadWOSR=function(w,q){return this.fromCache(this.wosrCache,`wosr:${w}:${q.disableTextures}`,m=>e.load(w,m),q)};n.destroy=function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};n.fromCache=
function(w,q,m,u){return l.create((v,y)=>{if(l.isAborted(u))y(l.createAbortError());else{var B=l.onAbort(u,()=>{this.remove(w,q);y(l.createAbortError())}),x=w.get(q);if(x)this.evictHandles.remove(q),x.refCount++,x.item.then(v,y);else{x=l.createAbortController();var C={refCount:1,abortController:x,item:m({...u,signal:x.signal}).then(z=>{C.abortController=null;z.remove=()=>this.remove(w,q);return z})};w.set(q,C);C.item.then(z=>{a.isSome(B)&&B.remove();v(z)},z=>{a.isSome(B)&&B.remove();y(z)})}}})};n.remove=
function(w,q){const m=w.get(q);m&&(m.refCount--,0===m.refCount&&this.evictHandles.add(r.timeoutHandle(()=>{w.delete(q);a.isSome(m.abortController)&&m.abortController.abort()},g),q))};k._createClass(p,[{key:"size",get:function(){return this.wosrCache.size+this.gltfCache.size}}]);return p}(),g=1E4;b.ObjectResourceCache=f;b.test={overrideEvictDelay(p){g=p;return{remove(){g=1E4}}}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/PooledArray ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){const A=h.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");b.FeatureTileTree3D=function(E){function G(I){I=E.call(this,I)||this;I.tiles=new m;I.tileSize=512;I._idToTile=new Map;I._handles=new u;I._clients=new Set;I._dirty=!1;I._newTiles=new w;return I}k._inheritsLoose(G,E);var H=G.prototype;H.initialize=function(){this._handles.add(this.watch(["tilingScheme","tileSize"],()=>this._reset(),!0));this._handles.add(v.init(this,["tileSize",
"cameraOnSurface.location","tilingScheme","viewState.camera","focus.location"],()=>this._setDirty(),!0));this.scheduler&&(this._frameWorker=this.scheduler.registerTask(B.Task.FEATURE_TILE_TREE,I=>this._update(I),()=>this.updating))};H.destroy=function(){this._frameWorker=l.removeMaybe(this._frameWorker);this._handles=l.destroyMaybe(this._handles)};H.addClient=function(){const I=t++;this._clients.add(I);1===this._clients.size&&this._setDirty();return{remove:()=>this._removeClient(I)}};H._removeClient=
function(I){this._clients.delete(I);this._hasClients||this._clear()};H._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this._update(B.noBudget))};H._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};H._update=function(I){this._dirty=!1;this._pendingTiles||(this._startUpdate(),l.isSome(this._frameWorker)&&(this._frameWorker.task=B.Task.FEATURE_TILE_TREE_ACTIVE));
this._subdivideTilesForView(I);!this._pendingTiles&&l.isSome(this._frameWorker)&&(this._frameWorker.task=B.Task.FEATURE_TILE_TREE);this.notifyChange("updating")};H._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new C.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:10})),this._tileMeasurements.begin(this.viewState.camera,this.focus.location,
this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()):this._clear())};H._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};H._getRootTiles=function(){return this.rootTileIds.map(I=>new x.FeatureTileDescriptor3D(I[0],I[1],I[2],this.tilingScheme))};H._purgeHorizonTiles=function(I){I.sort((J,K)=>{J=J.measures.screenRect;K=K.measures.screenRect;return J[1]+J[3]-(K[1]+K[3])});y.empty(D);for(let J=0;J<I.length;J++)if(y.expand(D,
I.data[J].measures.screenRect),10<y.height(D))return I.data.slice(J,I.length);return[]};H._subdivideTilesForView=function(I){if(this._pendingTiles){for(;0<this._pendingTiles.length&&!I.done;){const J=this._pendingTiles.pop();I.madeProgress();if(!this.filterExtentRect||y.intersects(this.filterExtentRect,J.extent))this._tileMeasurements.updateTile(J),0!==J.measures.visibility&&(J.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(J.lij[0]+1),this._pendingTiles.push(...J.getChildren())):this._newTiles.push(J))}0===
this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};H._updateTiles=function(I){for(var J of this.tiles.items)J.used=!1;I=I.filter(K=>{const L=this._idToTile.get(K.id);L?(L.copyMeasurementsFrom(K),L.used=!0):this._idToTile.set(K.id,K);return!L});J=this.tiles.items.filter(K=>K.used?!1:(this._idToTile.delete(K.id),!0));this.tiles.removeMany(J);this.tiles.addMany(I);this.sortTiles()};H.sortTiles=
function(){this.tiles.sort((I,J)=>I.measures.visibility!==J.measures.visibility?2===I.measures.visibility?-1:1:I.measures.distance-J.measures.distance);this.tiles.forEach((I,J)=>I.loadPriority=J)};k._createClass(G,[{key:"tilingScheme",get:function(){const I=this.tilingSchemeOwner.tilingScheme;return I?I.clone():null}},{key:"filterExtent",set:function(I){if(I&&!I.spatialReference.equals(this.viewState.spatialReference))A.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");
else{var J=this._get("filterExtent");J===I||J&&I&&J.equals(I)||(I=I?I.clone():null,this._set("filterExtent",I),this._setDirty())}}},{key:"filterExtentRect",get:function(){if(!this.filterExtent||!this.tilingScheme)return null;const I=y.create();z.toBoundingRect(this.filterExtent,I,this.tilingScheme.spatialReference);return I}},{key:"rootTileIds",get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}},{key:"suspended",set:function(I){I!==this._get("suspended")&&
(this._set("suspended",I),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}}]);return G}(q);a.__decorate([c.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"scheduler",void 0);a.__decorate([c.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);a.__decorate([c.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);
a.__decorate([c.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);a.__decorate([c.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"focus",void 0);a.__decorate([c.property({constructOnly:!0})],b.FeatureTileTree3D.prototype,"viewState",void 0);a.__decorate([c.property()],b.FeatureTileTree3D.prototype,"tiles",void 0);a.__decorate([c.property()],b.FeatureTileTree3D.prototype,"tileSize",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],
b.FeatureTileTree3D.prototype,"tilingScheme",null);a.__decorate([c.property()],b.FeatureTileTree3D.prototype,"filterExtent",null);a.__decorate([c.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],b.FeatureTileTree3D.prototype,"filterExtentRect",null);a.__decorate([c.property({readOnly:!0,dependsOn:["filterExtentRect"]})],b.FeatureTileTree3D.prototype,"rootTileIds",null);a.__decorate([c.property({value:!1})],b.FeatureTileTree3D.prototype,"suspended",null);a.__decorate([c.property({readOnly:!0})],
b.FeatureTileTree3D.prototype,"updating",null);b.FeatureTileTree3D=a.__decorate([f.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],b.FeatureTileTree3D);let t=0;const D=y.create();b.default=b.FeatureTileTree3D;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],function(b,k){let a=function(){function r(h,d,c,e=null){this.lij=[0,0,0];this.extent=k.create();this.loadPriority=
this.resolution=0;this.measures={visibility:2,screenRect:k.create(),distance:0,shouldSplit:!1};this.used=!1;e&&this.acquire(h,d,c,e)}var l=r.prototype;l.acquire=function(h,d,c,e){this.tilingScheme=e;this.id=r.id(h,d,c);this.lij[0]=h;this.lij[1]=d;this.lij[2]=c;e.getExtent(h,d,c,this.extent);this.resolution=e.resolutionAtLevel(h)};l.release=function(){this.tilingScheme=null};l.getChildren=function(h){const d=this.lij[0]+1,c=2*this.lij[1],e=2*this.lij[2];if(!h)return[new r(d,c,e,this.tilingScheme),
new r(d,c+1,e,this.tilingScheme),new r(d,c,e+1,this.tilingScheme),new r(d,c+1,e+1,this.tilingScheme)];h[0].acquire(d,c,e,this.tilingScheme);h[1].acquire(d,c+1,e,this.tilingScheme);h[2].acquire(d,c,e+1,this.tilingScheme);h[3].acquire(d,c+1,e+1,this.tilingScheme);return h};l.copyMeasurementsFrom=function(h){this.measures.visibility=h.measures.visibility;this.measures.shouldSplit=h.measures.shouldSplit;this.measures.distance=h.measures.distance;k.set(h.measures.screenRect,this.measures.screenRect)};
r.id=function(h,d,c){return`${h}/${d}/${c}`};return r}();b.FeatureTileDescriptor3D=a;b.default=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/support/aaBoundingRect ../../support/geometryUtils ../../webgl-engine/lib/Camera ./FeatureTileVisibility3D".split(" "),function(b,k,a,r,l,h,d,c){let e=function(){function v(B){this.camera=
new d;this.focusOnMap=[0,0];this.screenRect=l.create();this.tileSize=B.tileSize;this.maxVerticalScreenSize=B.maxVerticalScreenSize;this.renderCoordsHelper=B.renderCoordsHelper;this.tilingScheme=B.tilingScheme;this.visibility=new c({renderCoordsHelper:B.renderCoordsHelper})}var y=v.prototype;y.begin=function(B,x,C){this.camera.copyFrom(B);this.surfaceElevation=C;this.focusOnMap[0]=x.x;this.focusOnMap[1]=x.y;l.fromValues(0,0,B.fullWidth,B.fullHeight,this.screenRect);this.visibility.begin(this.camera,
C)};y.end=function(){this.visibility.end()};y.updateTile=function(B){B.measures.visibility=this.visibility.calculate(B);0!==B.measures.visibility&&this.updateScreenMeasure(B);this.updateDistanceMeasure(B)};y.updateDistanceMeasure=function(B){B.measures.distance=l.distance(B.extent,this.focusOnMap)};y.updateScreenMeasure=function(B){const x=B.measures.screenRect;l.empty(x);let C=0;const z=B.lij[0]+2,A=B.lij[1]<<2,t=B.lij[2]<<2;var D=this.tileSizeWithBias(B);D*=D;var E=!1;for(let G=0;4>G;G++){for(let H=
0;4>H&&!(E=this.computeScreenArea(B,z,A+G,t+H,x),C+=E.area,E=C>D&&l.height(x)>this.maxVerticalScreenSize);H++);if(E)break}B.measures.shouldSplit=C>D};y.tileSizeWithBias=function(B){return 1===B.measures.visibility?5*this.tileSize:this.tileSize};y.computeScreenArea=function(B,x,C,z,A){const t=p.points;this.projectToScreen(x,C,z,1===B.measures.visibility,t);l.empty(f);for(B=0;4>B;B++)l.expandPointInPlace(f,t[B]);l.expand(A,f);l.intersection(f,this.screenRect,g);p.screenOverlap=l.area(g)/l.area(f);p.area=
h.triangle.areaPoints2d(t[0],t[1],t[2])+h.triangle.areaPoints2d(t[0],t[2],t[3]);return p};y.projectToScreen=function(B,x,C,z,A){this.tilingScheme.ensureMaxLod(B);this.tilingScheme.getExtent(B,x,C,n);this.toRenderCoords(n,0,3,q[0]);this.toRenderCoords(n,2,3,q[1]);this.toRenderCoords(n,2,1,q[2]);this.toRenderCoords(n,0,1,q[3]);z&&(this.projectToPlane(q,this.camera.frustum.planes[4]),this.projectToPlane(q,this.camera.frustum.planes[3]),this.projectToPlane(q,this.camera.frustum.planes[2]));for(B=0;4>
B;B++)this.camera.projectToRenderScreen(q[B],u),this.camera.renderToScreen(u,A[B])};y.projectToPlane=function(B,x){for(var C=0;4>C;C++)m[C]=h.plane.signedDistance(x,B[C]);C=Math.max(m[0],m[1],m[2],m[3]);if(0<C)for(x=r.scale(w,h.plane.normal(x),-C),C=0;4>C;C++)r.add(B[C],B[C],x)};y.toRenderCoords=function(B,x,C,z){w[0]=B[x];w[1]=B[C];w[2]=this.surfaceElevation;this.renderCoordsHelper.toRenderCoords(w,this.tilingScheme.spatialReference,z);return z};return v}();const f=l.create(),g=l.create(),p={points:[k.createScreenPointArray(),
k.createScreenPointArray(),k.createScreenPointArray(),k.createScreenPointArray()],area:0,screenOverlap:0},n=l.create(),w=a.create(),q=[a.create(),a.create(),a.create(),a.create()],m=[0,0,0,0],u=k.createRenderScreenPointArray3();b.FeatureTileMeasurements3D=e;b.default=e;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("../../../../core/ObjectPool ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../support/geometryUtils ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(b,k,a,r,l,h,d,c,e){let f=function(){function q(u){this.surfaceElevation=0;this.cache=new Map;({renderCoordsHelper:u}=u);this.frustum=new c.Frustum({renderCoordsHelper:u});this.extendedFrustum=new c.Frustum({renderCoordsHelper:u});this.intersector=new e.FrustumExtentIntersection({renderCoordsHelper:u});this.renderCoordsHelper=u}var m=q.prototype;m.begin=function(u,v){this.surfaceElevation=v;this.aboveGround=this.renderCoordsHelper.getAltitude(u.eye)>v;this.frustum.update(u);this.shortenFrustumFarPlane(this.frustum);
this.updateExtendedFrustum(u)};m.end=function(){this.cache.clear()};m.calculate=function(u){if(this.allTilesInvisible)return 0;const v=1===this.renderCoordsHelper.viewingMode&&2<=u.lij[0]&&6>u.lij[0],y=this.getOrCalculateSingleTileVisibility(u,!v);return 0!==y&&v?this.calculateAggregatedChildrenVisibility(u):y};m.shortenFrustumFarPlane=function(u){var v=c.Frustum.nearFarLineIndices;const y=u.mutablePoints;for(const B of v){const [x,C]=B;v=y[x];r.subtract(g,y[C],v);r.scale(g,g,.95);r.add(y[C],v,g)}u.updatePoints(y)};
m.calculateAggregatedChildrenVisibility=function(u){let v=0;var y=this.cache.get(u.id);if(null!=y)return y;y=w.acquire();u.getChildren(y);for(const B of y){const x=this.calculate(B);if(0!==x&&(v=x,2===x))break}w.release(y);this.cache.set(u.id,v);return v};m.getOrCalculateSingleTileVisibility=function(u,v){var y=this.cache.get(u.id);if(null!=y)return y;y=this.calculateSingleTileVisibility(u);v&&this.cache.set(u.id,y);return y};m.calculateSingleTileVisibility=function(u){if(!this.aboveGround&&1===this.renderCoordsHelper.viewingMode&&
12>u.lij[0]){if(0===this.calculateSingleTileVisibilitySided(u,!1))return this.calculateSingleTileVisibilitySided(u,!0)}else return this.calculateSingleTileVisibilitySided(u,this.aboveGround)};m.calculateSingleTileVisibilitySided=function(u,v){this.intersector.update(u.extent,u.tilingScheme.spatialReference,this.surfaceElevation,v);u=l.getReferenceEllipsoid(u.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,u)?this.intersector.isVisibleInFrustum(this.frustum,
u,!0)?2:1:0};m.updateExtendedFrustum=function(u){this.extendedFrustum.update(u);this.shortenFrustumFarPlane(this.extendedFrustum);var v=this.renderCoordsHelper.worldUpAtPosition(u.eye,g);this.aboveGround||r.negate(v,v);v=k.acosClamped(-r.dot(v,u.viewForward));this.allTilesInvisible=v>(Math.PI+u.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=v>u.fovY/2)){u=this.extendedFrustumParameters();v=this.extendedFrustum.mutablePoints;for(let y=0;4>y;y++){const B=u.pointIndices[y],x=v[B],C=this.renderCoordsHelper.getAltitude(x);
if(u.needsAltitudeAdjustment(C)){this.renderCoordsHelper.worldUpAtPosition(x,g);switch(B){case 4:case 7:case 0:case 3:h.plane.projectVector(this.extendedFrustum.planes[0],g,g);break;case 5:case 6:case 1:case 2:h.plane.projectVector(this.extendedFrustum.planes[1],g,g)}r.scale(g,g,u.direction);this.renderCoordsHelper.intersectInfiniteManifold(h.ray.wrap(x,g),u.zWithMargin,x)}}this.extendedFrustum.updatePoints(v);h.plane.fromPoints(v[0],v[1],v[2],p);h.plane.fromPoints(v[1],v[2],v[3],n);0>r.dot(h.plane.normal(p),
h.plane.normal(n))&&(u=this.extendedFrustum.mutablePoints,this.aboveGround?[u[0],u[1]]=[u[1],u[0]]:[u[3],u[2]]=[u[2],u[3]],this.extendedFrustum.updatePoints(u))}};m.extendedFrustumParameters=function(){return this.aboveGround?this.extendedFrustumParametersAboveSurface():this.extendedFrustumParametersBelowSurface()};m.extendedFrustumParametersAboveSurface=function(){const u=this.surfaceElevation-1;return{zWithMargin:u,pointIndices:c.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(v){return v>
u}}};m.extendedFrustumParametersBelowSurface=function(){const u=this.surfaceElevation+1;return{zWithMargin:u,pointIndices:c.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(v){return v<u}}};return q}();const g=a.create(),p=h.plane.create(),n=h.plane.create(),w=new b(Array,q=>{4!==q.length&&(q[0]=new d.FeatureTileDescriptor3D,q[1]=new d.FeatureTileDescriptor3D,q[2]=new d.FeatureTileDescriptor3D,q[3]=new d.FeatureTileDescriptor3D)},q=>{q[0].release();q[1].release();q[2].release();q[3].release()});
return f})},"esri/views/3d/state/Frustum":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/vec3f64 ../../../chunks/vec3 ../support/mathUtils ../../../chunks/frustum".split(" "),function(b,k,a,r,l,h){let d=function(){function c(f){this.frustum=h.create();this.lines=Array(12);this.origin=a.create();this.direction=a.create();this._altitude=null;this.renderCoordsHelper=f?f.renderCoordsHelper:null;for(f=0;12>f;f++)this.lines[f]={origin:null,direction:a.create(),endpoint:null}}
var e=c.prototype;e.update=function(f){h.fromMatrix(f.viewMatrix,f.projectionMatrix,this.frustum);r.copy(this.origin,f.eye);r.copy(this.direction,f.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);this.updateLines()};e.updatePoints=function(f){for(let g=0;g<this.frustum.points.length;g++)r.copy(this.frustum.points[g],f[g]);h.recomputePlanes(this.frustum);this.updateLines()};e.intersectsSphere=function(f){return h.intersectsSphere(this.frustum.planes,f)};e.intersectsRay=
function(f){return h.intersectsRay(this.frustum.planes,f)};e.intersectsLineSegment=function(f,g){return h.intersectsLineSegment(this.frustum.planes,f,g)};e.intersectsPoint=function(f){return h.intersectsPoint(this.frustum.planes,f)};e.updateLines=function(){const {points:f}=this.frustum;for(let g=0;4>g;g++){const p=g,n=g+4;this.updateLine(this.lines[g],f[p],f[n]);this.updateLine(this.lines[g+4],f[p],3===g?f[0]:f[p+1]);this.updateLine(this.lines[g+8],f[n],3===g?f[4]:f[n+1])}};e.updateLine=function(f,
g,p){f.origin=g;f.endpoint=p;l.directionFromTo(f.direction,g,p)};k._createClass(c,[{key:"planes",get:function(){return this.frustum.planes}},{key:"points",get:function(){return this.frustum.points}},{key:"mutablePoints",get:function(){return this.frustum.points}},{key:"altitude",get:function(){return this._altitude}}]);return c}();d.planePointIndices=h.planePointIndices;d.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];b.Frustum=d;b.default=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ./mathUtils ../../../geometry/projectionEllipsoid ../../../chunks/mat4 ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../../chunks/mat4f64 ../../../geometry/support/aaBoundingBox ./geometryUtils ./intersectionUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){const q=.5*Math.PI,m=q/Math.PI*180;let u=function(){function A(D){this.renderCoordsHelper=D.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:r.create(),direction:r.create()};for(D=0;4>D;D++)this.extent[D]={origin:r.create(),direction:r.create(),cap:{next:null,direction:r.create()}},this.planes[D]=n.plane.create();this.planes[4]=n.plane.create();this.planes[5]=n.plane.create();this.planesWithoutFar=this.planes.slice(0,
5)}var t=A.prototype;t.update=function(D,E,G,H=!0){const I=this.extent;this.toRenderBoundingExtent(D,E,G);l.add(this.center.origin,I[0].origin,I[2].origin);l.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);H||l.scale(this.center.direction,this.center.direction,-1);for(G=0;4>G;G++){const J=I[G];this.renderCoordsHelper.worldUpAtPosition(J.origin,J.direction);const K=I[3===G?0:G+1];J.cap.next=K.origin;h.directionFromTo(J.cap.direction,
J.origin,K.origin);n.plane.fromVectorsAndPoint(J.direction,J.cap.direction,J.origin,this.planes[G]);H||l.scale(J.direction,J.direction,-1)}n.plane.fromVectorsAndPoint(I[0].cap.direction,I[1].cap.direction,I[0].origin,this.planes[4]);H?n.plane.negate(this.planes[4],this.planes[5]):(n.plane.copy(this.planes[4],this.planes[5]),n.plane.negate(this.planes[4],this.planes[4]));this.maxSpan=Math.max(Math.abs(D[0]-D[2]),Math.abs(D[1]-D[3]));this.maxSpanSpatialReference=E;this.minGlobalAltitude=.9*d.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};
t.isVisibleInFrustum=function(D,E,G=!1){if(null==D)return!1;if(1===this.renderCoordsHelper.viewingMode){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?m:q*E))return!0;if(D.altitude>=this.minGlobalAltitude)return this.isVisibleInFrustumGlobal(D)}if(0===this.maxSpan)return E=this.extent[0],!G&&D.intersectsRay(n.ray.wrap(E.origin,E.direction))?!0:!1;for(E=0;E<this.extent.length;E++){var H=this.extent[E];if(!G&&D.intersectsRay(n.ray.wrap(H.origin,H.direction))||D.intersectsLineSegment(n.lineSegment.fromPoints(H.origin,
H.cap.next,z),H.cap.direction))return!0}G=G?this.planes:this.planesWithoutFar;for(E=0;E<D.lines.length;E++)if(H=D.lines[E],w.frustumLineSegment(G,H.origin,H.endpoint,H.direction))return!0;return!1};t.toRenderBoundingExtentGlobal=function(D,E,G){e.center(D,y);y[2]=G;f.computeLinearTransformation(E,y,B,this.renderCoordsHelper.spatialReference);c.invert(x,B);p.empty(C);for(const {x0:H,x1:I,y0:J,y1:K}of v)for(let L=0;5>L;L++){const S=L/4;y[0]=a.lerp(D[H],D[I],S);y[1]=a.lerp(D[J],D[K],S);y[2]=G;f.projectVectorToVector(y,
E,y,this.renderCoordsHelper.spatialReference);l.transformMat4(y,y,x);p.expandWithVec3(C,y)}l.set(this.extent[0].origin,C[0],C[1],C[2]);l.set(this.extent[1].origin,C[3],C[1],C[2]);l.set(this.extent[2].origin,C[3],C[4],C[2]);l.set(this.extent[3].origin,C[0],C[4],C[2]);for(D=0;4>D;++D)l.transformMat4(this.extent[D].origin,this.extent[D].origin,B)};t.toRenderBoundingExtentLocal=function(D,E){l.set(this.extent[0].origin,D[0],D[1],E);l.set(this.extent[1].origin,D[2],D[1],E);l.set(this.extent[2].origin,
D[2],D[3],E);l.set(this.extent[3].origin,D[0],D[3],E)};t.toRenderBoundingExtent=function(D,E,G){switch(this.renderCoordsHelper.viewingMode){case 1:this.toRenderBoundingExtentGlobal(D,E,G);break;case 2:this.toRenderBoundingExtentLocal(D,G);break;default:k.neverReached(this.renderCoordsHelper.viewingMode)}};t.isVisibleInFrustumGlobal=function(D){if(0>l.dot(this.center.direction,D.direction))return!0;for(let E=0;4>E;E++)if(0>l.dot(this.extent[E].direction,D.direction))return!0;return!1};return A}();
const v=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],y=r.create(),B=g.create(),x=g.create(),C=p.create(),z=n.lineSegment.create();b.FrustumExtentIntersection=u;b.default=u;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection"],function(b,k,a,r){const l=a.create();b.projectToBoundingBox=function(h,d,c){if(null==h||
k.isNone(c))return!1;let e;l[0]=null!=h.xmin?h.xmin:0;l[1]=null!=h.ymin?h.ymin:0;l[2]=null!=h.zmin?h.zmin:0;e=r.projectBuffer(l,h.spatialReference,0,d,c,0,1);l[0]=null!=h.xmax?h.xmax:0;l[1]=null!=h.ymax?h.ymax:0;l[2]=null!=h.zmax?h.zmax:0;e=e&&r.projectBuffer(l,h.spatialReference,0,d,c,3,1);null==h.xmin&&(d[0]=-Infinity);null==h.ymin&&(d[1]=-Infinity);null==h.zmin&&(d[2]=-Infinity);null==h.xmax&&(d[3]=Infinity);null==h.ymax&&(d[4]=Infinity);null==h.zmax&&(d[5]=Infinity);return e};b.toBoundingRect=
function(h,d,c){if(null==h)return!1;let e;l[0]=null!=h.xmin?h.xmin:0;l[1]=null!=h.ymin?h.ymin:0;l[2]=null!=h.zmin?h.zmin:0;e=r.projectBuffer(l,h.spatialReference,0,l,c,0,1);d[0]=l[0];d[1]=l[1];l[0]=null!=h.xmax?h.xmax:0;l[1]=null!=h.ymax?h.ymax:0;l[2]=null!=h.zmax?h.zmax:0;e=e&&r.projectBuffer(l,h.spatialReference,0,l,c,0,1);d[2]=l[0];d[3]=l[1];null==h.xmin&&(d[0]=-Infinity);null==h.ymin&&(d[1]=-Infinity);null==h.xmax&&(d[2]=Infinity);null==h.ymax&&(d[3]=Infinity);return e};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/support/PropertiesPool":function(){define(["exports","../../../core/ReentrantObjectPool","../../../core/accessorSupport/watch"],function(b,k,a){let r=function(){function l(d,c){this.owner=c;this.properties={};this.afterDispatchHandle=null;for(const e in d)c=new k.ReentrantObjectPool(d[e],null,null,2,2),this.properties[e]={pool:c,acquired:[]};this.afterDispatchHandle=a.afterDispatch(()=>this.release())}var h=l.prototype;h.destroy=function(){this.afterDispatchHandle&&
(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);for(const d in this.properties){const c=this.properties[d];for(const e of c.acquired)a.isValueInUse(e)||c.pool.release(e);c.pool.destroy();c.pool=null;c.acquired=null}this.owner=this.properties=null};h.get=function(d){const c=this.owner._get(d);d=this.properties[d];let e=d.pool.acquire();for(d.acquired.push(e);e===c;)d.acquired.push(e),e=d.pool.acquire();return e};h.release=function(){for(const d in this.properties){const c=this.properties[d];
let e=0;for(const f of c.acquired)a.isValueInUse(f)?c.acquired[e++]=f:c.pool.release(f);c.acquired.length=e}};return l}();b.PropertiesPool=r;b.default=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/accessorSupport/watch ../../../core/Accessor ../../../core/Evented ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ./Constraints ../webgl-engine/lib/Camera ./controllers/CameraController ./controllers/AnimationController ../support/PropertiesPool".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){a=function(E){function G(){var I=E.call(this)||this;I._propertiesPool=new z.PropertiesPool({camera:B},b._assertThisInitialized(I));I._lastSeenCameraProjectionValues=new B;I.events=new q;I.mode=1;I._cameraChanged=!1;I.updateQueue=[];I.processingUpdates=!1;return I}b._inheritsLoose(G,E);var H=G.prototype;H.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new z.PropertiesPool({camera:B},this)};H.init=
function(I,J){this._set("mode",I);this._set("spatialReference",J);1===this.mode?(I=u.getReferenceEllipsoid(J).radius,I=new B(m.fromValues(4*I,0,0),m.fromValues(I,0,0),m.fromValues(0,0,1))):I=new B(m.fromValues(0,0,100),m.fromValues(0,0,0),m.fromValues(0,1,0));this.camera=I;this._set("constraints",new y["default"]({mode:this.mode}))};H.switchCameraController=function(I){this.cameraController=I;return I.state!==x.State.Rejected};H.stopActiveCameraController=function(){return this.cameraController&&
!this.cameraController.stopController()?!1:!0};H.updateCamera=function(I){this.updateQueue.push(I);this.processUpdateQueue()};H.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var I=this.updateQueue.shift();A.copyFrom(this._get("camera"));I(A);this.camera=A;this.processingUpdates=!1;this.processUpdateQueue()}};H.cameraProjectionChanged=function(I,J){return I.fov!==J.fov||I.fullViewport[0]!==J.fullViewport[0]||I.fullViewport[1]!==J.fullViewport[1]||
I.fullViewport[2]!==J.fullViewport[2]||I.fullViewport[3]!==J.fullViewport[3]||I.padding[0]!==J.padding[0]||I.padding[1]!==J.padding[1]||I.padding[2]!==J.padding[2]||I.padding[3]!==J.padding[3]?!0:!1};b._createClass(G,[{key:"animation",get:function(){return this.cameraController instanceof C.AnimationController&&r.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},{key:"camera",get:function(){return this._get("camera")},set:function(I){I!==A&&A.copyFrom(I);A.markViewDirty();
A.computeUp(this.mode);t.camera=A;this.events.emit("before-camera-change",t);I=this._get("camera");this.cameraProjectionChanged(this._lastSeenCameraProjectionValues,A)&&(this._lastSeenCameraProjectionValues.copyFrom(A),D.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",D));if(!I||!I.equals(A))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(A)),this._cameraChanged=!I||!I.almostEquals(A)){const J=n.afterDispatch(()=>{this._cameraChanged=!1;J.remove()})
}}},{key:"isGlobal",get:function(){return!this.isLocal}},{key:"isLocal",get:function(){return 2===this.mode}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},set:function(I){this.stopActiveCameraController()?(I&&(I.watch("state",J=>{if(J===x.State.Finished||J===x.State.Stopped)this._set("cameraController",
null),this.updateCamera(K=>I.onControllerEnd(K))},!0),I.onControllerStart(this.camera)),this._set("cameraController",I)):I&&(I.state=x.State.Rejected)}}]);return G}(w);k.__decorate([d.property({readOnly:!0,type:v,dependsOn:["cameraController"]})],a.prototype,"animation",null);k.__decorate([d.property({type:B})],a.prototype,"camera",null);k.__decorate([d.property({readOnly:!0})],a.prototype,"constraints",void 0);k.__decorate([d.property({readOnly:!0})],a.prototype,"events",void 0);k.__decorate([d.property({readOnly:!0,
dependsOn:["isLocal"]})],a.prototype,"isGlobal",null);k.__decorate([d.property({readOnly:!0,dependsOn:["mode"]})],a.prototype,"isLocal",null);k.__decorate([d.property({readOnly:!0})],a.prototype,"mode",void 0);k.__decorate([d.property({constructOnly:!0})],a.prototype,"spatialReference",void 0);k.__decorate([d.property({readOnly:!0,dependsOn:["cameraController"]})],a.prototype,"navigating",null);k.__decorate([d.property({readOnly:!0,dependsOn:["navigating","_cameraChanged"]})],a.prototype,"stationary",
null);k.__decorate([d.property()],a.prototype,"_cameraChanged",void 0);k.__decorate([d.property()],a.prototype,"cameraController",null);k=a=k.__decorate([e.subclass("esri.views.3d.state.ViewState")],a);const A=new B,t={camera:null},D={camera:null};return k})},"esri/views/3d/state/ViewStateManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/scheduling ../../../core/Accessor ../../../geometry/support/webMercatorUtils ../../../geometry/Point ../../../geometry/Extent ../../../core/screenUtils ../../../Camera ../../../core/Handles ../../../Viewpoint ../../../core/watchUtils ../../../chunks/vec4f64 ../../../chunks/vec4 ../camera/intersectionUtils ../camera/constraintUtils ../webgl-engine/lib/Camera ../support/cameraUtils ./Frustum ../support/PropertiesPool ./ConstraintsManager ./controllers/SurfaceCollisionCorrectionController ../support/viewpointUtils ./GoToOperation".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S){const M=l.getLogger("esri.views.3d.state.ViewStateManager");a=function(U){function V(X){X=U.call(this,X)||this;X.propertiesPool=new I.PropertiesPool({frustum:H.Frustum},b._assertThisInitialized(X));X.handles=new B;X.cameraSetByUser=!1;X.internalSetOrder=[];X.gotoOperation=null;X.ready=!1;X.updateDevicePixelRatio=null;return X}b._inheritsLoose(V,U);var W=V.prototype;W.paddingToArray=function(X,ca,R){X?A.set(R,X.top||0,X.right||
0,X.bottom||0,X.left||0):A.set(R,0,0,0,0);for(X=0;4>X;X++)R[X]=Math.round(R[X]*ca)};W.initialize=function(){this.handles.add([this.view.state.watch("camera",X=>this.cameraChangedSync(X),!0),C.on(this.view,"state.events","before-camera-change",X=>this.updateElevation(X.camera))]);C.once(this.view.state,"camera",X=>this.updateElevation(X),!0);this.handles.add(n.addFrameTask({prepare:()=>this.prepareFrame()}));this.handles.add(this.view.state.watch("cameraController",()=>{this.cameraSetByUser=!0;this.handles.remove("pending-initial-view")}));
this.handles.add(C.on(this.view,"state.events","camera-projection-changed",()=>this.notifyChange("scale")))};W.destroy=function(){this.deinit();this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};W.init=function(){this.constraintsManager=new J["default"]({view:this.view});this.prepareFrame();var X=this.getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(const ca of X)this.set(ca.name,ca.value);
this.cameraSetByUser||((X=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(X)?this.setInitialView(X):2===this.view.state.mode&&this.handles.add(C.whenOnce(this.view.basemapTerrain,"ready",()=>{this.handles.remove("pending-initial-view");this.setInitialView(this.view.groundExtent)}),"pending-initial-view"))};W.deinit=function(){this.cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),
this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove("pending-initial-view"),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};W.goTo=async function(X,ca){ca={animate:!0,...ca};return this.gotoOperation=r.isSome(this.gotoOperation)?this.gotoOperation.goTo(X,ca):new S.GoToOperation(X,ca,this.view)};W.debugSetCameraOnContent=function(){this.setStateCamera(t.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};W.step=function(X){const ca=
this.view.state,R=ca&&this.view.state.cameraController;R&&(ca.updateCamera(aa=>{R.stepController(X,aa)}),R.steppingFinished&&R.finishController())};W.cancelGoToOperation=function(){r.isSome(this.gotoOperation)&&(this.gotoOperation.abort(),this.gotoOperation=null)};W.getInitialProperties=function(){const X=new Set,ca=[];for(const {propertyName:R,overrides:aa}of O){const ka=X.has(R),da=this._isOverridden(R);!ka&&da&&ca.push({name:R,value:this._get(R)});this._clearOverride(R);(ka||da)&&aa.forEach(fa=>
X.add(fa))}return ca};W.setInitialView=function(X){if(X&&!this.cameraSetByUser)if(X instanceof y)this.setStateCamera(G.externalToInternal(this.view,X),{applyConstraints:!1});else if(X instanceof x)if(X.targetGeometry instanceof u){var ca=G.fromExtent(this.view,X.targetGeometry,0,.5,0);r.isSome(ca)&&this.setStateCamera(G.externalToInternal(this.view,ca),{applyConstraints:!0})}else ca={applyConstraints:!X.camera},X=this.viewpointToCamera(X),this.setStateCamera(X,ca);else ca=G.fromExtent(this.view,X,
0,.5,0),r.isSome(ca)&&this.setStateCamera(G.externalToInternal(this.view,ca),{applyConstraints:!0})};W.updatePropertyBeforeReady=function(X,ca){if(!this.ready){this._override(X,ca);const R=this.internalSetOrder.indexOf(X);-1!==R&&(this.internalSetOrder=this.internalSetOrder.splice(R,1));ca&&(this.internalSetOrder.push(X),-1!==T.indexOf(X)&&this._override("hasInitialView",!0));return!0}return!1};W.isCompatible=function(X){return r.isNone(X)?!1:X instanceof x?X.camera?this.isCompatible(X.camera):this.isCompatible(X.targetGeometry):
X instanceof y?this.isCompatible(X.position):X.spatialReference&&q.canProject(X.spatialReference,this.view.spatialReference)};W.getPreservingHeadingTilt=function(X=Q){this.cameraSetByUser?(X.heading=this.camera.heading,X.tilt=this.camera.tilt):(X.heading=0,X.tilt=.5);return X};W.centerPointAtDistanceToCamera=function(X,ca,R=N){const {heading:aa,tilt:ka}=this.getPreservingHeadingTilt();X=G.getObserverForPointAtDistance(this.view,aa,ka,X,ca,1);if(r.isNone(X))return null;R.copyFrom(this.view.state.camera);
R.eye=X.eye;R.center=X.center;R.up=X.up;return R};W.centerToCamera=function(X){const ca=this.view.pointsOfInterest.centerOnContent;ca.update();return this.centerPointAtDistanceToCamera(X,ca.distance)};W.extentToCamera=function(X){const {heading:ca,tilt:R}=this.getPreservingHeadingTilt();X=G.fromExtent(this.view,X,ca,R,1,F);return r.isSome(X)?G.externalToInternal(this.view,X):null};W.scaleToCamera=function(X){if(null==X)return null;const ca=this.view.pointsOfInterest.centerOnContent;ca.update();const R=
ca.renderLocation;X=G.scaleToDistance(this.view,X,ca.location.latitude);return this.centerPointAtDistanceToCamera(R,X)};W.zoomToCamera=function(X){return this.scaleToCamera(G.zoomToScale(this.view,X))};W.viewpointToCamera=function(X){X=L.toCamera(this.view,X);return r.isSome(X)?G.externalToInternal(this.view,X):null};W.setStateCamera=function(X,ca){if(r.isNone(X)||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;ca.doNotCancelGoToOperation||this.cancelGoToOperation();
this.view.state.updateCamera(R=>{ca.positionAndOrientationOnly?(R.eye=X.eye,R.center=X.center,R.up=X.up):R.copyFrom(X);ca.applyConstraints&&D.applyAll(this.view,R)});ca.applyConstraints||(this.view.state.cameraController=new K.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:X}));return!0};W.prepareFrame=function(){const {container:X,canvas:ca}=this.view;if(X&&ca){r.isSome(this.updateDevicePixelRatio)&&this.updateDevicePixelRatio();var R=this.view.pixelRatio,aa=Math.round(X.clientWidth*
R),ka=Math.round(X.clientHeight*R);if(0!==aa&&0!==ka){if(ca.width!==aa||ca.height!==ka)ca.width=aa,ca.height=ka;if(this.view.state){const da=this.view.state.camera;if(da.fullWidth!==aa||da.fullHeight!==ka||da.pixelRatio!==R)N.copyFrom(da),N.pixelRatio!==R&&(this.paddingToArray(this.padding,R,P),N.padding=P),N.fullWidth=aa,N.fullHeight=ka,N.pixelRatio=R,this.view.state.camera=N}}}};W.updateElevation=function(X){var ca=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference;const R=this.view.renderCoordsHelper.getAltitude(X.eye);
ca=ca?t.surfaceElevationBelowRenderLocation(this.view,X.eye):0;X.relativeElevation=R-ca};W.cameraChangedSync=function(X){X&&this.view._stage&&this.view._stage.setCamera(X)};b._createClass(V,[{key:"camera",get:function(){if(!this.ready)return this._get("camera");const X=G.internalToExternal(this.view,this.view.state.camera),ca=this._get("camera");return X&&ca&&X.equals(ca)?ca:X},set:function(X){this.updatePropertyBeforeReady("camera",X)||this.setStateCamera(G.externalToInternal(this.view,X),{applyConstraints:!1})||
M.error("#camera\x3d","Invalid camera",X)}},{key:"center",get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(X){this.updatePropertyBeforeReady("center",X)||(X?this.isCompatible(X)?this.setStateCamera(this.centerToCamera(X),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.update():M.error("#center\x3d","Invalid center",X):M.error("#center\x3d","Center has an incompatible spatial reference (center: "+(X.spatialReference?
X.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",X):M.error("#center\x3d","Center may not be null or undefined"))}},{key:"extent",get:function(){if(!this.ready)return this._get("extent");var X=this.view;X=G.toExtent(X,X.state.camera,X.pointsOfInterest.centerOnContent.renderLocation);return r.isSome(X)?X:this._get("extent")},set:function(X){this.updatePropertyBeforeReady("extent",X)||(X?this.isCompatible(X)?this.setStateCamera(this.extentToCamera(X),{applyConstraints:!0})||
M.error("#extent\x3d","Invalid extent",X):M.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(X.spatialReference?X.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",X):M.error("#extent\x3d","Extent may not be null or undefined"))}},{key:"frustum",get:function(){const X=this.propertiesPool.get("frustum");X.renderCoordsHelper=this.view.renderCoordsHelper;X.update(this.view.state.camera);return X}},{key:"hasInitialView",get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")}},
{key:"scale",get:function(){if(!this.ready)return this._get("scale");const X=this.view.pointsOfInterest.centerOnContent;return G.distanceToScale(this.view,X.distance,X.location.latitude)},set:function(X){this.updatePropertyBeforeReady("scale",X)||this.setStateCamera(this.scaleToCamera(X),{applyConstraints:!0})||M.error("#scale\x3d","Invalid scale",X)}},{key:"padding",get:function(){if(!this.ready)return this._get("padding");var X=this.view.state.camera,ca=X.padding;const R=X.pixelRatio;X=this._get("padding");
const aa=Math.round(ca[0]/R),ka=Math.round(ca[1]/R),da=Math.round(ca[2]/R);ca=Math.round(ca[3]/R);return null!=X&&X.top===aa&&X.right===ka&&X.bottom===da&&X.left===ca?X:{top:aa,right:ka,bottom:da,left:ca}},set:function(X){this.updatePropertyBeforeReady("padding",X)||(this.paddingToArray(X,this.view.state.camera.pixelRatio,P),this.view.state.updateCamera(ca=>ca.padding=P))}},{key:"screenCenter",get:function(){const X=this.padding;return v.createScreenPoint((this.view.width-(X.left+X.right))/2+X.left,
(this.view.height-(X.top+X.bottom))/2+X.top)}},{key:"viewpoint",get:function(){return this.ready?L.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(X){if(!this.updatePropertyBeforeReady("viewpoint",X))if(X)if(this.isCompatible(X))this.setStateCamera(this.viewpointToCamera(X),{applyConstraints:!X.camera})||M.error("#viewpoint\x3d","Invalid viewpoint",X);else{var ca=r.isSome(X.camera)?X.camera.position:X.targetGeometry;ca=r.isSome(ca)&&ca.spatialReference;M.error("#viewpoint\x3d",
"Viewpoint has an incompatible spatial reference (viewpoint: "+(ca?ca.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",X)}else M.error("#viewpoint\x3d","Viewpoint may not be null or undefined")}},{key:"zoom",get:function(){return this.ready?G.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(X){this.updatePropertyBeforeReady("zoom",X)||this.setStateCamera(this.zoomToCamera(X),{applyConstraints:!0})||M.error("#zoom\x3d","Invalid zoom",X)}}]);return V}(w);k.__decorate([d.property({type:y,
dependsOn:["view.state.camera","ready"],autoTracked:!1})],a.prototype,"camera",null);k.__decorate([d.property({type:m,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],a.prototype,"center",null);k.__decorate([d.property({type:u,dependsOn:["view.state.camera","ready","view.pointsOfInterest.centerOnContent.location"]})],a.prototype,"extent",null);k.__decorate([d.property({readOnly:!0,dependsOn:["view.state.camera","ready"]})],a.prototype,"frustum",null);k.__decorate([d.property({readOnly:!0,
dependsOn:["view.map.initialViewProperties?.viewpoint"]})],a.prototype,"hasInitialView",null);k.__decorate([d.property({readOnly:!0,type:Boolean})],a.prototype,"ready",void 0);k.__decorate([d.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],type:Number})],a.prototype,"scale",null);k.__decorate([d.property({dependsOn:["view.state.camera","ready"]})],a.prototype,"padding",null);k.__decorate([d.property({readOnly:!0,dependsOn:["view.width","view.height","padding"]})],a.prototype,
"screenCenter",null);k.__decorate([d.property({constructOnly:!0})],a.prototype,"view",void 0);k.__decorate([d.property({type:x,dependsOn:["camera","ready"]})],a.prototype,"viewpoint",null);k.__decorate([d.property({type:Number,dependsOn:["scale"]})],a.prototype,"zoom",null);k.__decorate([d.property({constructOnly:!0})],a.prototype,"updateDevicePixelRatio",void 0);k=a=k.__decorate([e.subclass("esri.views.3d.state.ViewStateManager")],a);const T="camera viewpoint extent scale center zoom".split(" "),
O=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],Q={heading:0,tilt:0},F=new y,N=new E,P=z.create();return k})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../core/mathUtils ../../../core/Handles ../../../core/watchUtils ../camera/intersectionUtils ../camera/constraintUtils ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x){b.ConstraintsManager=function(C){function z(t){var D=C.call(this,t)||this;D._handles=new m;D.nearFarHeuristic=B.createNearFarHeuristic(t.view.state.mode,t.view.basemapTerrain,t.view.renderCoordsHelper.spatialReference);return D}k._inheritsLoose(z,C);var A=z.prototype;A.initialize=function(){this._handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],()=>this._clipDistanceNearFarChanged()),this.view.watch("constraints.clipDistance.mode",
()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",t=>this._updateCameraNearFar(t.camera)),this.view.watch("dataExtent",()=>this._updateNearFar(),!0),this.view.watch(["constraints.altitude.min","constraints.altitude.max"],()=>this._updateAltitude(),!0),this.view.watch("constraints.tilt.max",()=>this._updateTiltMax(),!0),this.view.watch("constraints.tilt.mode",()=>this._updateTilt(),!0),this.view.watch("state.camera",()=>this._updateTiltAutoMax(),!0),this.view.watch(["map.ground.navigationConstraint.type",
"constraints.collision.enabled"],()=>this._updateCollision(),!0)]);this.view.state.isLocal&&this._handles.add(u.init(this.view,"dataExtent",t=>this._updateLocalSurfaceDistance(t)));this._updateNearFar();2!==this.view.state.mode&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new x["default"]({view:this.view}))};A.destroy=function(){this._handles=l.destroyMaybe(this._handles);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),
this._set("surfaceCollisionConstraint",null))};A._clipDistanceNearFarChanged=function(){const t=this.view.constraints&&this.view.constraints.clipDistance;t&&"auto"!==t.mode&&this.view.state.updateCamera(D=>{this._updateCameraNearFarManual(D,t);return!0})};A._updateNearFar=function(){this.view.state.updateCamera(t=>{this._updateCameraNearFar(t);return!0})};A._updateCameraNearFar=function(t){const D=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(D?D.mode:"auto")?this._updateCameraNearFarManual(t,
D):this._updateCameraNearFarAuto(t,D)};A._updateCameraNearFarAuto=function(t,D){this.nearFarHeuristic.compute(t.eye,t.center,this.view.dataExtent,v.surfaceElevationBelowRenderLocation(this.view,t.eye),t);D&&D.autoUpdate(t.near,t.far)};A._updateCameraNearFarManual=function(t,D){D&&(t.near=D.near,t.far=D.far)};A._updateCollision=function(){var t=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,D=this.view.constraints&&this.view.constraints.collision.enabled;t=t?"stay-above"===
t.type:D;D=this.view.state.constraints.collision;t!==D.enabled&&((D.enabled=t)&&this._reapplyConstraints(8),(t=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==t.mode||this._updateTiltAuto())};A._updateAltitude=function(){const t=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=t&&2!==this.view.state.mode?{min:t.min,max:t.max}:null;this._reapplyConstraints()};A._updateTiltMax=function(){const t=this.view.constraints&&this.view.constraints.tilt;
t&&"auto"!==t.mode&&(this._updateTiltManual(t),this._reapplyConstraints())};A._updateTilt=function(){const t=this.view.constraints&&this.view.constraints.tilt;"manual"===(t?t.mode:"auto")?this._updateTiltManual(t):this._updateTiltAuto();this._reapplyConstraints()};A._updateTiltManual=function(t){const D=this.view.state.constraints;D.tilt=D.createConstantMaxTilt(q.deg2rad(t.max))};A._updateTiltAuto=function(){const t=this.view.state.constraints;t.tilt=t.createDefaultTilt();this._updateTiltAutoMax()};
A._updateTiltAutoMax=function(){const t=this.view.constraints&&this.view.constraints.tilt;if(t&&"auto"===t.mode){var D=this.view.state.constraints;D.tilt&&(D=D.tilt(this.view.state.camera.distance).max,t.autoUpdate(q.rad2deg(D)))}};A._updateLocalSurfaceDistance=function(t){var D=Math.max(t.width,t.height);0>=D||(t.hasZ&&(D=Math.max(D,t.zmax-t.zmin)),t=this.view.state,D=3*D/Math.atan(t.camera.fov/2),D!==t.constraints.distance&&(t.constraints.distance=D))};A._reapplyConstraints=function(t=15){this.view.state.updateCamera(D=>
y.applyAll(this.view,D,{selection:t,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0}))};return z}(w);a.__decorate([c.property({constructOnly:!0})],b.ConstraintsManager.prototype,"view",void 0);a.__decorate([c.property({readOnly:!0})],b.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);b.ConstraintsManager=a.__decorate([f.subclass("esri.views.3d.state.ConstraintsManager")],b.ConstraintsManager);b.default=b.ConstraintsManager;
Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../core/unitUtils".split(" "),function(b,k,a,r,l,h){function d(p,n,w,q){w=2/w;p/n>w?(q.far=p,q.near=q.far/n):(q.near=w,q.far=q.near*n);return q}let c=function(){function p(n,w){this.elevationProvider=n;this._referenceEllipsoid=l.getReferenceEllipsoid(w);this.unitInMeters=
h.getMetersPerUnitForSR(w,this._referenceEllipsoid.metersPerDegree)}p.prototype.compute=function(n,w,q,m,u){u||(u={near:0,far:0});var v=n[2]*this.unitInMeters,y=v;m=v-m;var B=this.elevationProvider?this.elevationProvider.elevationBounds:null;B&&(v=0<=m?y-this.unitInMeters*B.min:this.unitInMeters*B.max-y);y=Math.max(q.xmax-q.xmin,q.ymax-q.ymin,4*Math.max(q.xmax-q.xmin,q.ymax-q.ymin));r.subtract(g,w,n);f[0]=0<g[0]?q.xmax:q.xmin;f[1]=0<g[1]?q.ymax:q.ymin;f[2]=0<g[2]?y/2:-y/2;r.subtract(f,f,n);r.normalize(g,
g);n=1.1*r.dot(f,g)*this.unitInMeters;w=Math.sqrt(v*(v+2*this._referenceEllipsoid.radius));q=Math.max(q.xmax-q.xmin,q.ymax-q.ymin);B=1E-4*q*this.unitInMeters;v=k.clamp((v-B)/(.001*q*this.unitInMeters-B),0,1);v=k.lerp(w,n,v*v*v);v*=Math.max(Math.log(Math.abs(m)),1);v=Math.min(v,Math.max(34064E4,y));v/=this.unitInMeters;return d(v,2E4,this.unitInMeters,u)};return p}(),e=function(){function p(n){this._referenceEllipsoid=l.getReferenceEllipsoid(n)}p.prototype.compute=function(n,w,q,m,u){u||(u={near:0,
far:0});n=r.length(n)-this._referenceEllipsoid.radius;n=Math.max(Math.abs(n-m),Math.abs(n));m=Math.sqrt(n*(n+2*(this._referenceEllipsoid.radius+Math.min(0,m))));n=k.clamp(2E4-(Math.log(n)-7.983)/9.011*19E3,1E3,2E4);return d(1.2*m,n,1,u)};return p}();const f=a.create(),g=a.create();b.createNearFarHeuristic=function(p,n,w){return 1===p?new e(w):new c(n,w)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../core/mathUtils ../support/mathUtils ../../../core/Handles ../../../geometry/projectionEllipsoid ../support/stack ../../../chunks/lineSegment ../../../chunks/ray ../../../chunks/boundedPlane ../../../chunks/clipRay ../../../chunks/frustum ../../../chunks/sphere ../../../chunks/triangle ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E){b.SurfaceCollisionConstraint=function(G){function H(J){J=G.call(this,J)||this;J.handles=new m;return J}k._inheritsLoose(H,G);var I=H.prototype;I.initialize=function(){this.handles.add(this.view.basemapTerrain.on("elevation-change",J=>this.handleElevationChangeEvent(J)))};I.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};I.handleElevationChangeEvent=function(J){this.view.state.cameraController||D.eyeWithinExtent(this.view,
this.view.state.camera,J.extent,J.spatialReference)&&this.applyToCurrentCamera()};I.applyToCurrentCamera=function(){this.view.state.updateCamera(J=>{E.applySurfaceCollisionConstraint(this.view,J,1)})};return H}(n);a.__decorate([d.property({constructOnly:!0})],b.SurfaceCollisionConstraint.prototype,"view",void 0);b.SurfaceCollisionConstraint=a.__decorate([e.subclass("esri.views.3d.state.ElevationCollisionConstraint")],b.SurfaceCollisionConstraint);b.default=b.SurfaceCollisionConstraint;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/mathUtils ../../support/mathUtils ../../../../core/Handles ../../../../geometry/projectionEllipsoid ../../support/stack ../../../../chunks/lineSegment ../../../../chunks/ray ../../../../chunks/boundedPlane ../../../../chunks/clipRay ../../../../chunks/frustum ../../../../chunks/sphere ../../../../chunks/triangle ../../camera/intersectionUtils ../../camera/constraintUtils/surfaceCollision ./CameraController".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E){b.SurfaceCollisionCorrectionController=function(G){function H(J){J=G.call(this,J)||this;J.handles=new q;return J}k._inheritsLoose(H,G);var I=H.prototype;I.onControllerStart=function(){this.state=E.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",J=>this.handleElevationChangeEvent(J)));this.applyCorrection()};I.onControllerEnd=function(){this.handles.removeAll()};I.stepController=function(){};I.handleElevationChangeEvent=
function(J){t.eyeWithinExtent(this.view,this.desiredCamera,J.extent,J.spatialReference)&&this.applyCorrection()};I.applyCorrection=function(){this.view.state.updateCamera(J=>{J.copyViewFrom(this.desiredCamera);D.applySurfaceCollisionConstraint(this.view,J,1)||this.constraintEnabled||(this.state=E.State.Stopped)})};k._createClass(H,[{key:"desiredCamera",set:function(J){this._set("desiredCamera",J.clone())}},{key:"canStop",get:function(){return!0}},{key:"constraintEnabled",get:function(){return this.view.state.constraints.collision.enabled}}]);
return H}(E.CameraController);a.__decorate([d.property({constructOnly:!0})],b.SurfaceCollisionCorrectionController.prototype,"view",void 0);a.__decorate([d.property({constructOnly:!0})],b.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);b.SurfaceCollisionCorrectionController=a.__decorate([e.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],b.SurfaceCollisionCorrectionController);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../core/has ../../../core/maybe ../../../core/Error ../../../core/promiseUtils ../../../geometry/SpatialReference ../../../geometry/Geometry ../../../geometry/support/webMercatorUtils ../../../geometry/Point ../../../geometry/Extent ../../../geometry ../../../Graphic ../../../core/asyncUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ./mathUtils ../../../Camera ../../../Viewpoint ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/mat3 ../../../geometry/support/aaBoundingBox ./ElevationProvider ./geometryUtils ../camera/intersectionUtils ./cameraUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G){function H(ja){return 360-m.cyclicalDeg.normalize(ja)}function I(ja){return m.cyclicalDeg.normalize(360-ja)}function J(ja){a.isSome(ja)&&ja.resolver&&ja.resolver.reject();return null}function K(ja,la,qa,na=null){if(!la)return J(na);var oa=ja.spatialReference||h.WGS84;if(a.isSome(la.camera)){ja=la.get("camera.position.spatialReference");if(!c.canProject(ja,oa))return J(na);la=la.camera.clone();ja.equals(oa)||(la.position=c.project(la.position,
oa));ja=la;a.isSome(na)&&na.resolver&&na.resolver.resolve(ja);return ja}if(a.isNone(la.targetGeometry))return J(na);var ua=la.get("targetGeometry.spatialReference");if(ua&&!c.canProject(ua,oa))return J(na);oa=G.internalToExternal(ja,ja.state.camera);ua=1;null!=la.rotation&&(oa.heading=H(la.rotation),ua=0);null!=qa&&(oa.tilt=qa);if("point"===la.targetGeometry.type){const za=la.targetGeometry;qa=la.targetGeometry.clone();la=null!=la.scale?G.scaleToDistance(ja,la.scale,za.latitude):ja.state.camera.distance;
return G.fromCenterDistance(ja,qa,la,oa,ua,na)}return G.fromExtent(ja,la.targetGeometry.extent,oa.heading,oa.tilt,ua,na)}function L(ja,la){return null==la.scale&&null!=la.zoom?G.zoomToScale(ja,la.zoom):la.scale}function S(ja,la){let qa=!1;null!=la.heading?(ja.heading=la.heading,qa=!0):null!=la.rotation&&(ja.heading=H(la.rotation),qa=!0);null!=la.tilt&&(ja.tilt=la.tilt,qa=!0);null!=la.fov&&(ja.fov=la.fov);return qa}function M(ja,la,qa,na){const oa=ja.spatialReference||h.WGS84;la=a.isSome(la)?la:G.externalToInternal(ja,
qa);na.targetGeometry=B.projectVectorToPoint(la.center,ja.renderSpatialReference,oa);na.scale=G.computeScale(ja,la);na.rotation=I(qa.heading);na.camera=qa;return na}function T(ja,la,qa){if(la){if(!c.canProject(la.spatialReference,ja.spatialReference))throw new r("viewpointutils:incompatible-spatialreference",`Spatial reference (${la.spatialReference?la.spatialReference.wkid:"unknown"}) is incompatible with the view (${ja.spatialReference.wkid})`,{geometry:la});var na=[];if(!la.hasZ&&ja.basemapTerrain){switch(la.type){case "point":var oa=
la;break;case "multipoint":case "polyline":case "mesh":oa=la.extent.center;break;case "extent":oa=la.center;break;case "polygon":oa=la.centroid}oa&&c.canProject(oa,ja.basemapTerrain.spatialReference)?ca[2]=t.getElevationAtPoint(ja.elevationProvider,oa)||0:ca[2]=0}(0,ia[la.type])(la,za=>{na.push(za[0],za[1],za[2])},ca);var ua=na.length/3;if(0!==ua&&(oa=Array(na.length),B.projectBuffer(na,la.spatialReference,0,oa,ja.spatialReference,0,ua)))for(la.hasZ&&(qa.hasZ=!0),ja=0;ja<oa.length;ja+=3)la.hasZ?(ca[0]=
oa[ja+0],ca[1]=oa[ja+1],ca[2]=oa[ja+2]):(ca[0]=oa[ja+0],ca[1]=oa[ja+1]),A.expandWithVec3(qa.boundingBox,ca)}}async function O(ja,la,qa,na){const oa=await n.result(ja.whenViewForGraphic(la));if(!1!==oa.ok&&!a.isNone(oa.value)&&"whenGraphicBounds"in oa.value)if(qa=await n.result(oa.value.whenGraphicBounds(la,{minDemResolution:qa})),!1===qa.ok)T(ja,la.geometry,na);else{var {screenSpaceObjects:ua,boundingBox:za}=qa.value;A.expandWithAABB(na.boundingBox,za);ua&&ua.forEach(Fa=>{na.screenSpaceObjects.push(Fa)});
isFinite(za[2])&&(na.hasZ=!0)}else T(ja,la.geometry,na)}async function Q(ja,la,qa,na){if(Array.isArray(la)&&2===la.length){const oa=la[0],ua=la[1];if("number"===typeof oa&&"number"===typeof ua){ba.x=oa;ba.y=ua;ba.z=void 0;ba.spatialReference=ja.spatialReference.isGeographic?ja.spatialReference:h.WGS84;T(ja,ba,na);return}}la&&"function"===typeof la.map?await l.eachAlways(la.map(oa=>Q(ja,oa,qa,na))):la instanceof d?T(ja,la,na):la instanceof p&&await O(ja,la,qa,na)}async function F(ja,la,qa,na,oa){if(a.isSome(la.camera))return N(ja,
la.camera,oa);oa.scale=la.scale;oa.rotation=la.rotation;oa.targetGeometry=a.isSome(la.targetGeometry)?la.targetGeometry.clone():null;oa.camera=null;null!=qa.heading?oa.rotation=I(qa.heading):null!=qa.rotation&&(oa.rotation=qa.rotation);la=L(ja,qa);null!=la&&(oa.scale=la);na=new G.AsyncContext(na);K(ja,oa,qa.tilt,na);oa.camera=await na.resolver.promise;return oa}function N(ja,la,qa){const na=ja.spatialReference,oa=la.position.spatialReference;if(!c.canProject(oa,na))return null;la=la.clone();la.fov=
ja.camera.fov;oa.equals(na)||(la.position=c.project(la.position,na));return M(ja,null,la,qa)}async function P(ja,la,qa,na,oa,ua){if(a.isNone(qa))throw new r("createfromcenter","invalid point");ua.targetGeometry=qa.clone();const za=E.cameraOnContentAlongViewDirection(ja);if(la.position)return qa=ua.targetGeometry,oa=ja.renderSpatialReference,B.projectPointToVector(la.position,ea,oa),B.projectPointToVector(qa,Y,oa),ua.targetGeometry=new e(qa),na.position=new e(la.position),q.subtract(fa,Y,ea),G.directionToHeadingTilt(ja,
ea,fa,za.up,na),ua.scale=G.distanceToScale(ja,q.distance(ea,Y),ua.targetGeometry.latitude),ua.rotation=I(na.heading),ua.camera=na,ua;if(la.zoomFactor){var Fa=za.distance/la.zoomFactor;const La=q.scale(ca,za.viewForward,-Fa);q.add(za.eye,za.center,La);za.markViewDirty();ua.scale=G.distanceToScale(ja,Fa,qa.latitude)}G.internalToExternal(ja,za,na);Fa=S(na,la)?0:1;la.zoomFactor||(ua.scale=L(ja,la),null==ua.scale&&(B.projectPointToVector(qa,ca,ja.renderSpatialReference),D.frustum.intersectsPoint(za.frustum.planes,
ca)?ua.scale=G.distanceToScale(ja,q.distance(za.eye,ca),qa.latitude):ua.scale=G.computeScale(ja,za)),la=new G.AsyncContext(oa),G.fromCenterScale(ja,ua.targetGeometry,ua.scale,na,Fa,la),ua.camera=await la.resolver.promise);return ua}async function U(ja,la,qa,na,oa){var ua=E.cameraOnContentAlongViewDirection(ja);ua=B.projectVectorToPoint(ua.center,ja.renderSpatialReference,ja.spatialReference,ba);return P(ja,la,ua,qa,na,oa)}async function V(ja,la,qa,na,oa,ua){ua.targetGeometry=qa.clone();const za=E.cameraOnContentAlongViewDirection(ja);
G.internalToExternal(ja,za,na);la=S(na,la)?0:1;oa=new G.AsyncContext(oa);G.fromExtent(ja,qa,na.heading,na.tilt,la,oa);ua.camera=await oa.resolver.promise;return ua}async function W(ja,la,qa,na,oa,ua,za,Fa){Fa.targetGeometry=qa.clone();const La=E.cameraOnContentAlongViewDirection(ja);var Sa=0;qa.hasZ?Sa=qa.z:ja.basemapTerrain&&(Sa=t.getElevationAtPoint(ja.elevationProvider,qa));q.set(ca,qa.x,qa.y,Sa);B.computeLinearTransformation(ja.spatialReference,ca,R,ja.renderSpatialReference);z.fromMat4(aa,R);
z.transpose(aa,aa);A.empty(ka);qa=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var Ia=0;Ia<qa.length;Ia++){const Qa=qa[Ia];let Pa=na[Qa[2]];isFinite(Pa)||(Pa=Sa);q.set(ca,na[Qa[0]],na[Qa[1]],Pa);B.projectVectorToVector(ca,ja.spatialReference,ca,ja.renderSpatialReference);A.expandWithVec3(ka,q.transformMat3(ca,ca,aa))}na=A.width(ka);Sa=A.height(ka);qa=A.depth(ka);Ia=1/Math.tan(La.fovY/2);oa=Math.max(.5*Math.sqrt(na*na+qa*qa)*Math.max(Ia,1/Math.tan(La.fovX/2))+.5*Sa,.5*Sa*Ia+
.5*Math.max(na,qa))/oa;G.internalToExternal(ja,La,ua);la=S(ua,la)?0:1;Fa.scale=G.distanceToScale(ja,oa,Fa.targetGeometry.latitude);za=new G.AsyncContext(za);G.fromCenterScale(ja,Fa.targetGeometry,Fa.scale,ua,la,za);Fa.camera=await za.resolver.promise;return Fa}function X(ja){ja&&a.isSome(ja.camera)&&(ja.rotation=I(ja.camera.heading));return ja}const ca=w.create(),R=C.create(),aa=x.create(),ka=A.create(),da=y.create(),fa=w.create(),ea=w.create(),Y=w.create(),Z={heading:0,tilt:0},ba=new e,ia={point(ja,
la,qa){qa[0]=ja.x;qa[1]=ja.y;ja.hasZ&&(qa[2]=ja.z);la(qa)},polygon(ja,la,qa){const na=ja.hasZ;for(let oa=0;oa<ja.rings.length;oa++){const ua=ja.rings[oa];for(let za=0;za<ua.length;za++)qa[0]=ua[za][0],qa[1]=ua[za][1],na&&(qa[2]=ua[za][2]),la(qa)}},polyline(ja,la,qa){const na=ja.hasZ;for(let oa=0;oa<ja.paths.length;oa++){const ua=ja.paths[oa];for(let za=0;za<ua.length;za++)qa[0]=ua[za][0],qa[1]=ua[za][1],na&&(qa[2]=ua[za][2]),la(qa)}},multipoint(ja,la,qa){const na=ja.points;ja=ja.hasZ;for(let oa=0;oa<
na.length;oa++)qa[0]=na[oa][0],qa[1]=na[oa][1],ja&&(qa[2]=na[oa][2]),la(qa)},extent(ja,la,qa){ja.hasZ?(la(q.set(qa,ja.xmin,ja.ymin,ja.zmin)),la(q.set(qa,ja.xmax,ja.ymin,ja.zmin)),la(q.set(qa,ja.xmin,ja.ymax,ja.zmin)),la(q.set(qa,ja.xmax,ja.ymax,ja.zmin)),la(q.set(qa,ja.xmin,ja.ymin,ja.zmax)),la(q.set(qa,ja.xmax,ja.ymin,ja.zmax)),la(q.set(qa,ja.xmin,ja.ymax,ja.zmax)),la(q.set(qa,ja.xmax,ja.ymax,ja.zmax))):(la(q.set(qa,ja.xmin,ja.ymin,qa[2])),la(q.set(qa,ja.xmax,ja.ymin,qa[2])),la(q.set(qa,ja.xmin,
ja.ymax,qa[2])),la(q.set(qa,ja.xmax,ja.ymax,qa[2])))},mesh(ja,la,qa){if(ja=ja.vertexAttributes&&ja.vertexAttributes.position)for(let na=0;na<ja.length;na+=3)la(q.set(qa,ja[na+0],ja[na+1],ja[na+2]))}};b.create=async function(ja,la,qa){if(la&&ja.spatialReference){var na={target:null};if("declaredClass"in la||Array.isArray(la))na.target=la;else{for(var oa in la)na[oa]=la[oa];la.center&&!na.target&&(na.target=la.center)}la=na}else la=null;if(!la)throw new r("viewpointutils-create:no-target","Missing target for creating viewpoint");
na=new u({fov:ja.camera.fov});oa=new v({camera:na});if(la.target instanceof v)return ja=await F(ja,la.target,la,qa,oa),X(ja);if(la.target instanceof u)return X(N(ja,la.target,oa));var ua=null!=la.scale||null!=la.zoom;if(la.target instanceof f){var za=la.target.xmin===la.target.xmax||la.target.ymin===la.target.ymax;return ua||za?X(await P(ja,la,la.target.center,na,qa,oa)):X(await V(ja,la,la.target,na,qa,oa))}za={boundingBox:A.empty(),hasZ:!1,screenSpaceObjects:[]};var Fa=ua?G.scaleToResolution(ja,
L(ja,la)):void 0;await Q(ja,la.target,Fa,za);if(isFinite(za.boundingBox[0])){A.center(za.boundingBox,ca);ba.x=ca[0];ba.y=ca[1];ba.z=ca[2];ba.spatialReference=ja.spatialReference;isFinite(ba.z)&&za.hasZ?Fa=A.isPoint(za.boundingBox):(ba.z=void 0,Fa=y.isPoint(A.toRect(za.boundingBox,da)));if(ua||Fa)return X(await P(ja,la,ba,na,qa,oa));ua=za.screenSpaceObjects;if(ua.length){Fa=Number.NEGATIVE_INFINITY;for(let La=0;La<ua.length;La++){const Sa=ua[La].screenSpaceBoundingRect;Fa=Math.max(Fa,Math.abs(Sa[0]),
Math.abs(Sa[1]),Math.abs(Sa[2]),Math.abs(Sa[3]))}ua=.66-Fa/Math.min(ja.width,ja.height)*2}else ua=.66;return X(await W(ja,la,ba,za.boundingBox,ua,na,qa,oa))}return la.position?(qa=E.cameraOnContentAlongViewDirection(ja),q.copy(fa,qa.viewForward),G.directionToHeadingTilt(ja,qa.eye,fa,qa.up,Z),na.position=new e(la.position),na.heading=null!=la.heading?la.heading:Z.heading,na.tilt=null!=la.tilt?la.tilt:Z.tilt,ja=M(ja,null,na,oa),X(ja)):X(await U(ja,la,na,qa,oa))};b.fromCamera=function(ja,la,qa=null){a.isNone(qa)&&
(qa=new v);return M(ja,null,la.clone(),qa)};b.headingToRotation=I;b.rotationToHeading=H;b.toCamera=K;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../core/maybe ../../../core/Error ../../../core/promiseUtils ../../../Camera ../../../Viewpoint ../../../core/watchUtils ../camera/constraintUtils/surfaceCollision ../../animation/easing ../camera/constraintUtils ./controllers/CameraController ./controllers/PointToPointAnimationController ../support/cameraUtils ./controllers/SurfaceCollisionCorrectionController ../support/viewpointUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){let m=function(){function u(y,B,x){this.target=y;this.options=B;this.view=x;this.state="pending";this.animationController=this.abortController=null;this.promise=r.create((C,z)=>{this.resolveCallback=C;this.rejectCallback=z;C=r.createAbortController();if(k.isSome(this.options.signal))r.onAbort(this.options.signal,()=>{this.abort()});this.abortController=C;this.waitForReady()})}var v=u.prototype;v.then=function(y,B){return this.promise.then(y,B)};v.catch=function(y){return this.promise.catch(y)};
v.resolve=function(y){this.state="finished";return this.resolveCallback(y)};v.reject=function(y){this.state="finished";return this.rejectCallback(y)};v.goTo=function(y,B){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":B.animate&&this.options.animate?this.reject(new a("AbortError")):this.abort()}return new u(y,B,this.view)};v.waitForReady=function(){this.state="wait-for-ready";this.view.stateManager.view.ready?this.createViewPoint():
d.whenOnce(this.view.stateManager.view,"ready",this.abortController.signal).then(()=>{this.createViewPoint()},y=>{this.reject(y)})};v.createViewPoint=function(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this.getAnimationController():null,q.create(this.view.stateManager.view,this.target,this.abortController.signal).then(y=>{"finished"!==this.state&&(y=this.getCameraFromViewpoint(y),k.isNone(y)||(this.options.animate?k.isNone(this.animationController)||
this.startAnimation(y,this.animationController):(this.view.stateManager.setStateCamera(y.camera,{applyConstraints:!y.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve())))},y=>{this.reject(y)}))};v.internalAnimateOptions=function(y){const B={};y&&(null!=y.speedFactor&&(B.speedFactor=y.speedFactor),null!=y.duration&&(B.duration=y.duration/1E3),null!=y.maxDuration&&(B.maxDuration=y.maxDuration/1E3),null!=y.easing&&(B.easing="string"===typeof y.easing?e.named[y.easing]:
y.easing));return B};v.getCameraFromViewpoint=function(y){const B=!!(this.target instanceof h&&this.target.camera||this.target instanceof l);var x=y.camera;if(k.isNone(x))return null;if(!this.view.stateManager.isCompatible(x))return y=(y=x.position)&&y.spatialReference,this.reject(new a("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${y?y.wkid:"none"}, view: ${this.view.stateManager.view.spatialReference.wkid})`,{camera:x})),null;x=n.externalToInternal(this.view.stateManager.view,
x);return x?{viewpoint:y,camera:x,isFullySpecified:B}:(this.reject(new a("GotoAnimation:invalid-camera","Resulting camera is invalid")),null)};v.startAnimation=function(y,B){this.state="wait-for-animation-finish";const x=B.viewAnimation;if(k.isNone(x))this.reject(new a("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{x.update(y.viewpoint,"running");if(!B.active||k.isNone(B.viewAnimation)||B.viewAnimation.target!==y.viewpoint||this.view.stateManager.view.state.cameraController!==
B)return this.abort();if(y.isFullySpecified){var C=new w.SurfaceCollisionCorrectionController({view:this.view.stateManager.view,desiredCamera:y.camera});c.applySurfaceCollisionConstraint(this.view.stateManager.view,y.camera,1)}else f.applyAll(this.view.stateManager.view,y.camera);B.begin(y.camera,this.internalAnimateOptions(this.options));var z=A=>{if(!k.isNone(this.view.stateManager.view.state))switch(B.state){case g.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;
case g.State.Ready:case g.State.Rejected:case g.State.Running:case g.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(A)}}};x.when(()=>{const A=this.view.stateManager.view.state.cameraController;C&&(A&&A.active?A instanceof p.PointToPointAnimationController&&k.isSome(A.viewAnimation)&&A.viewAnimation.target===y.viewpoint&&(this.view.stateManager.view.state.cameraController=C):k.isSome(B.viewAnimation)&&B.viewAnimation.target===
y.viewpoint&&"finished"===B.state&&(this.view.stateManager.view.state.cameraController=C))},A=>z(A));B.asyncResult={resolve:()=>z(),reject:A=>z(A)}}};v.getAnimationController=function(){let y;var B=null;B=this.view.stateManager.view.state.cameraController;B instanceof p.PointToPointAnimationController&&(B.updateStateFromViewAnimation(),B.active&&(y=B,B=y.viewAnimation));return null!=y||(y=new p.PointToPointAnimationController({view:this.view.stateManager.view,mode:"animation"}),B=y.viewAnimation,
this.view.stateManager.view.state.switchCameraController(y))?y:(k.isSome(B)&&B.stop(),this.reject(new a("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};v.abort=function(){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":this.reject(r.createAbortError());break;case "wait-for-animation-finish":k.isSome(this.animationController)&&this.view.stateManager.view.state.cameraController===this.animationController&&this.animationController.active&&
this.animationController.stopController(),this.reject(r.createAbortError())}};return u}();b.GoToOperation=m;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/stack ../../../../chunks/ray ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/lib/Intersector".split(" "),
function(b,k,a,r,l,h,d,c,e,f){function g(v,y,B){for(const x of v)y&&!y(x)||B.push(x);return B}function p(v){w||(w=new f.Intersector(v));w.viewingMode=v;return w}let n=function(){function v(B,x,C){this.viewingMode=B;this.layerProvider=x;this.view=C;this.externalIntersectionHandlers=new a;this.tolerance=f.Intersector.DEFAULT_TOLERANCE;this.tmpRay=c.create();this.validateHUDIntersector=new f.Intersector(this.viewingMode);this.validateHUDIntersector.options.hud=!1}var y=v.prototype;y.intersectScreen=
function(B,x){return this.intersectRay(this.getPickRay(B,this.tmpRay),p(this.viewingMode),x)};y.intersectScreenFreePointFallback=function(B,x){return this.intersectRayFreePointFallback(this.getPickRay(B,this.tmpRay),x)};y.intersectRayFreePointFallback=function(B,x){return this.intersectRay(B,p(this.viewingMode),x)||this.intersectRayFreePointLocal(B,x)};y.intersectRay=function(B,x,C,z){x.options.selectionMode=!1;x.options.store=0;this.computeIntersection(B,x,z);return x.results.min?x.results.min.getIntersectionPoint(C):
!1};y.getCenterRayWithSubpixelOffset=function(B,x,C=.5,z=.5){B.getRenderCenter(u,C,z);u[0]+=.0466;u[1]-=.0123;return c.fromRenderAtEye(B,u,x)};y.intersectIntersectorScreen=function(B,x,C){this.computeIntersection(this.getPickRay(B,this.tmpRay),x,C)};y.intersectToolIntersectorScreen=function(B,x,C){B=this.getPickRay(B,this.tmpRay);this.intersectToolIntersectorRay(B,x,C)};y.intersectToolIntersectorRay=function(B,x,C){x.options.selectionMode=!0;this.computeIntersection(B,x,C);const z=x.results.min;this.view.basemapTerrain&&
this.view.basemapTerrain.isOpaque()||z.hasIntersectionPoint&&"TerrainRenderer"!==z.intersector||(x.options.selectionMode=!1,this.computeIntersection(B,x,C))};y.setTolerance=function(B=f.Intersector.DEFAULT_TOLERANCE){this.tolerance=B};y.addIntersectionHandler=function(B){this.externalIntersectionHandlers.push(B);this.externalIntersectionHandlers.sort((x,C)=>"Terrain"===x.type?1:"Terrain"===C.type?-1:0)};y.removeIntersectionHandler=function(B){this.externalIntersectionHandlers.removeUnordered(B);this.externalIntersectionHandlers.sort((x,
C)=>"Terrain"===x.type?1:"Terrain"===C.type?-1:0)};y.getPickRay=function(B,x=c.create()){return c.fromScreen(this.view.state.camera,B,x)};y.intersectRayFreePointLocal=function(B,x){if(2!==this.viewingMode||k.isNone(B))return!1;var C=this.view.dataExtent,z=Math.max(C.xmax-C.xmin,C.ymax-C.ymin,8*Math.max(C.xmax-C.xmin,C.ymax-C.ymin));if(0===z)return h.add(x,B.origin,h.normalize(d.sv3d.get(),B.direction)),!0;var A=this.view.state.camera;const t=Math.max(0,C.xmin-A.eye[0],A.eye[0]-C.xmax);C=Math.max(0,
C.ymin-A.eye[1],A.eye[1]-C.ymax);A=z/Math.max(1,Math.pow(Math.max(0,Math.log(z/(Math.abs(A.relativeElevation)+Number.MIN_VALUE))),2));A=Math.max(A,Math.min(Math.sqrt(t*t+C*C),z));z=h.scale(d.sv3d.get(),B.direction,A/h.length(B.direction));h.add(x,B.origin,z);return!0};y.intersectElevationFromScreen=function(B,x,C=0){return this.intersectElevation(this.getPickRay(B,this.tmpRay),x,C)};y.intersectElevation=function(B,x,C=0){if(k.isNone(B))return null;var z=k.isSome(x)?x.mode:"absolute-height",A=k.isSome(x)?
k.unwrapOr(x.offset,0):0,t="on-the-ground"!==z?A+C:0;x=t/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===z)return this.view.renderCoordsHelper.intersectManifold(B,t,m)?(C=this.view.computeMapPointFromVec3d(m),C.z-=A,C):null;A=this.view.state.camera;const D=r.castRenderScreenPointArray3(d.sv3d.get());A.projectToRenderScreen(B.origin,D);t=this.prepareFilters(null,q);const E=this.view.slicePlane,G=k.isSome(E)?e.sliceFilterPredicate(E):null,H=new f.Intersector(this.viewingMode);H.options.store=
0;H.options.verticalOffset=x;x=B.origin;B=h.add(d.sv3d.get(),x,B.direction);H.reset(x,B);H.point=D;H.camera=A;H.filterPredicate=null;switch(z){case "relative-to-scene":H.intersect(t.layers,D,A,this.tolerance,null,I=>I.metadata&&I.metadata.isElevationSource);this.externalIntersectionHandlers.forAll(I=>{"I3S"!==I.type&&"Terrain"!==I.type||I.intersect(H,I.slicePlane?G:null,H.rayBeginPoint,H.rayEndPoint,D)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forAll(I=>
{I.isGround&&I.intersect(H,I.slicePlane?G:null,H.rayBeginPoint,H.rayEndPoint,D)})}return H.results.min.getIntersectionPoint(m)?(z=this.view.computeMapPointFromVec3d(m),z.z=C,z):null};y.computeIntersection=function(B,x,C){if(!k.isNone(B)){var z=this.view.state.camera,A=r.castRenderScreenPointArray3(d.sv3d.get());z.projectToRenderScreen(B.origin,A);var t=this.prepareFilters(C,q);x.options.selectOpaqueTerrainOnly=!C||!("include"in C||"exclude"in C);var D=B.origin,E=h.add(d.sv3d.get(),B.origin,B.direction);
x.reset(D,E);x.intersect(t.layers,A,z,this.tolerance);B=this.view.slicePlane;var G=k.isSome(B)?e.sliceFilterPredicate(B):null;x.intersect(t.sliceableLayers,A,z,this.tolerance,G);var H=C&&(C.requiresGroundFeedback||C.enableDraped);this.externalIntersectionHandlers.forAll(I=>{x.options.isFiltered=!t.filterLayerUid(I.intersectionHandlerId);(I.isGround&&H||!x.options.isFiltered)&&I.intersect(x,I.slicePlane?G:null,D,E,A)});B=d.sv3d.get();if(C&&C.enableDraped&&x.results.ground.getIntersectionPoint(B)){C=
this.view.basemapTerrain.overlayManager.renderer;const I=this.view.renderCoordsHelper.spatialReference,J=d.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(B,J,this.view.spatialReference);J[2]=this.view.elevationProvider.getElevation(B[0],B[1],B[2],I,"ground")||0;C.intersect(x,J,t.filterRenderGeometry)}x.sortResults();B=x.results.hud;if(B.hasIntersectionPoint){const I=r.castRenderScreenPointArray3(d.sv3d.get()),J=d.sv3d.get(),K=d.sv3d.get();this.unprojectHUDResultRay(B.center,I,J,K);C=h.distance(B.center,
J)/h.distance(J,K)*.99;this.validateHUDIntersector.reset(J,K);this.validateHUDIntersector.intersect(t.layers,I,z,this.tolerance);this.validateHUDIntersector.intersect(t.sliceableLayers,I,z,this.tolerance,G);this.externalIntersectionHandlers.forAll(L=>{t.filterLayerUid(L.intersectionHandlerId)&&L.intersect(this.validateHUDIntersector,L.slicePlane?G:null,J,K,I)});z=this.validateHUDIntersector.results.min;if(null==z.dist||C<=z.dist)x.results.min.copyFrom(B),x.results.all.splice(0,0,B)}}};y.prepareFilters=
function(B,x){const C=[],z=[];this.layerProvider.forEachLayer(A=>{A.isPickable&&(A.isSliceable?z:C).push(A)});x.include=B&&B.include;x.exclude=B&&B.exclude;x.layers.length=0;x.sliceableLayers.length=0;g(C,x.filterLayer,x.layers);g(z,x.filterLayer,x.sliceableLayers);return x};y.unprojectHUDResultRay=function(B,x,C,z){const A=this.view.state.camera;A.projectToRenderScreen(B,x);B=r.castRenderScreenPointArray3(d.sv3d.get());B[0]=x[0];B[1]=x[1];B[2]=0;A.unprojectFromRenderScreen(B,C);B[2]=1;A.unprojectFromRenderScreen(B,
z)};return v}(),w;const q={include:null,exclude:null,layers:[],sliceableLayers:[],filterLayer(v){return q.filterLayerUid(v.apiLayerUid)},filterLayerUid(v){const {include:y,exclude:B}=q;return k.isNone(v)?null==y&&null==B:(null==y||y.has(v))&&(null==B||!B.has(v))},filterRenderGeometry(v){return q.filterLayerUid(v.data.layerUid)}},m=l.create(),u=r.createRenderScreenPointArray();b.SceneIntersectionHelper=n;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/Accessor ../../../core/Evented ../layers/graphics/ElevationQuery".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){function v(y,B,x,C,z,A,t){for(const D of B)B=D.getElevation(x,C,z,A,t),null!=B&&(y=null!=y?Math.max(B,y):B);return y}b.CombinedElevationProvider=function(y){function B(C){C=y.call(this,C)||this;C.im=[];C.ground=[];C.scene=[];C.handles=new Map;return C}k._inheritsLoose(B,y);var x=B.prototype;x.destroy=function(){this._elevationQuery=l.destroyMaybe(this._elevationQuery)};x.getElevation=function(C,z,A,t,D){let E;E=v(null,this.im,C,z,A,t,D);null==E&&(E=v(E,
this.ground,C,z,A,t,D));"scene"===D&&(E=v(E,this.scene,C,z,A,t,D));return E};x.queryElevation=function(C,z,A,t,D,E=null,G=0){const H=w.createResolver();this.elevationQuery.queryElevation(C,z,E,G).then(I=>{"scene"===D&&(I=v(I,this.scene,C,z,A,t,D));H.resolve(I)}).catch(I=>{w.isAbortError(I)?H.reject(I):H.resolve(this.getElevation(C,z,A,t,D))});return H.promise};x.register=function(C,z){this.handles.set(z,z.on("elevation-change",A=>this.emit("elevation-change",A)));this[C].push(z)};x.unregister=function(C){this.handles.has(C)&&
(this.handles.get(C).remove(),this.handles.delete(C));for(const z of[this.im,this.ground,this.scene]){const A=z.indexOf(C);-1<A&&z.splice(A,1)}};k._createClass(B,[{key:"elevationQuery",get:function(){l.isNone(this._elevationQuery)&&(this._elevationQuery=new u.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQuery}}]);return B}(m.EventedMixin(q));a.__decorate([c.property({constructOnly:!0})],
b.CombinedElevationProvider.prototype,"view",void 0);a.__decorate([c.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],b.CombinedElevationProvider.prototype,"spatialReference",void 0);b.CombinedElevationProvider=a.__decorate([f.subclass("esri.views.3d.support.CombinedElevationProvider")],b.CombinedElevationProvider);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../../geometry/Multipoint ../../../../geometry ../../../support/Scheduler".split(" "),
function(b,k,a,r,l,h,d,c){d=function(){function f(p,n){this.spatialReference=p;this.view=n}var g=f.prototype;g.getElevation=function(p,n,w){return this.view.elevationProvider.getElevation(p,n,0,this.spatialReference,w)};g.queryElevation=async function(p,n,w,q,m){return this.view.elevationProvider.queryElevation(p,n,0,this.spatialReference,m,w,q)};return f}();let e=function(){function f(p,n,w,q){this.spatialReference=n;this._getElevationQueryProvider=w;this._queries=[];this._queryOptions={...q,ignoreInvisibleLayers:!0};
this._frameTask=p.registerTask(c.Task.ELEVATION_QUERY,()=>this._update(),()=>0<this._queries.length)}var g=f.prototype;g.destroy=function(){this._frameTask.remove()};g.queryElevation=function(p,n,w,q=0){return l.create((m,u)=>{const v={x:p,y:n,minDemResolution:q,result:{resolve:m,reject:u},signal:w};this._queries.push(v);l.onAbort(w,()=>{r.remove(this._queries,v);u(l.createAbortError())})})};g._update=function(){const p=this._queries;this._queries=[];const n=this._getElevationQueryProvider();if(n){var w=
p.map(v=>[v.x,v.y]),q=p.reduce((v,y)=>Math.min(v,y.minDemResolution),Infinity);w=new h({points:w,spatialReference:this.spatialReference});var m=1<p.length&&p.some(v=>!!v.signal)?l.createAbortController():null,u=a.isSome(m)?m.signal:p[0].signal;if(a.isSome(m)){let v=0;p.forEach(y=>l.onAbort(y.signal,()=>{v++;y.result.reject(l.createAbortError());v===p.length&&m.abort()}))}n.queryElevation(w,{...this._queryOptions,minDemResolution:q,signal:u}).then(v=>{p.forEach((y,B)=>{a.isSome(y.signal)&&y.signal.aborted?
y.result.reject(l.createAbortError()):y.result.resolve(v.geometry.points[B][2])})}).catch(v=>{p.forEach(y=>y.result.reject(v))})}else p.forEach(v=>v.result.reject())};k._createClass(f,[{key:"test",get:function(){const p=this;return{update:()=>0<p._queries.length&&p._update()}}}]);return f}();b.ElevationQuery=e;b.ViewElevationProvider=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has"],function(b){function k(){const r=
!!b("esri-mobile");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,
physicalBasedRenderingEnabled:!1,orderIndependentTransparencyEnabled:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:r?.8:1,polylineLodFactor:r?1.2:1.5},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},
uncompressedTextureDownsamplingEnabled:r},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!b("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!1,orderIndependentTransparencyEnabled:!0,memoryLimit:r?600:750,additionalCacheMemory:r?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:r?1.2:2,polylineLodFactor:r?
1.2:2},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!b("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,orderIndependentTransparencyEnabled:!0,memoryLimit:r?900:1500,
additionalCacheMemory:0,frameRate:0,maximumRenderResolution:r?null:4096,maximumPixelRatio:r?1:null}}}let a=function(){function r(){}r.isValidProfile=function(l){return l in r.profiles};r.getDefaultProfile=function(){return b("trident")||b("esri-iPhone")?"low":"medium"};r.apply=function(l,h){l=r.profiles[l];h.graphics3D.maxTotalNumberOfFeatures=l.graphics3D.maxTotalNumberOfFeatures;h.graphics3D.maxTotalNumberOfPrimitives=l.graphics3D.maxTotalNumberOfPrimitives;h.graphics3D.polygonLodFactor=l.graphics3D.polygonLodFactor;
h.graphics3D.polylineLodFactor=l.graphics3D.polylineLodFactor;{const d=h.sceneService["3dObject"],c=l.sceneService["3dObject"];d.lodFactor=c.lodFactor;d.lodCrossfadeinDuration=c.lodCrossfadeinDuration;d.lodCrossfadeoutDuration=c.lodCrossfadeoutDuration;d.lodCrossfadeUncoveredDuration=c.lodCrossfadeUncoveredDuration}h.sceneService.point.lodFactor=l.sceneService.point.lodFactor;h.sceneService.integratedMesh.lodFactor=l.sceneService.integratedMesh.lodFactor;h.sceneService.pointCloud.lodFactor=l.sceneService.pointCloud.lodFactor;
h.sceneService.uncompressedTextureDownsamplingEnabled=l.sceneService.uncompressedTextureDownsamplingEnabled;h.tiledSurface.lodBias=l.tiledSurface.lodBias;h.tiledSurface.angledSplitBias=l.tiledSurface.angledSplitBias;h.tiledSurface.reduceTileLevelDifferences=l.tiledSurface.reduceTileLevelDifferences;h.tiledSurface.textureFadeDuration=l.tiledSurface.textureFadeDuration;h.antialiasingEnabled=l.antialiasingEnabled;h.physicallyBasedRenderingEnabled=l.physicalBasedRenderingEnabled;h.orderIndependentTransparencyEnabled=
l.orderIndependentTransparencyEnabled;h.memoryLimit=l.memoryLimit;h.additionalCacheMemory=l.additionalCacheMemory;h.frameRate=l.frameRate;h.maximumRenderResolution=l.maximumRenderResolution;h.maximumPixelRatio=l.maximumPixelRatio};return r}();a.debug={reset(){const r=k();for(const l in r)a.profiles[l]=r[l]}};(a||(a={})).profiles=k();return a})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../Color ../../../chunks/vec4f32".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){a=function(m){function u(){var v=m.apply(this,arguments)||this;v.color=new w([0,255,255]);v.haloColor=null;v.haloOpacity=1;v.fillOpacity=.25;return v}b._inheritsLoose(u,m);u.toEngineOptions=function(v){const y=w.toUnitRGBA(v.color),B=r.isSome(v.haloColor)?w.toUnitRGBA(v.haloColor):y;return{color:q.fromValues(y[0],y[1],y[2],y[3]),haloColor:q.fromValues(B[0],B[1],B[2],B[3]),haloOpacity:v.haloOpacity,haloOpacityOccluded:.25*v.haloOpacity,fillOpacity:v.fillOpacity,
fillOpacityOccluded:.25*v.fillOpacity}};return u}(n);k.__decorate([d.property({type:w})],a.prototype,"color",void 0);k.__decorate([d.property({type:w})],a.prototype,"haloColor",void 0);k.__decorate([d.property()],a.prototype,"haloOpacity",void 0);k.__decorate([d.property()],a.prototype,"fillOpacity",void 0);return a=k.__decorate([e.subclass("esri.views.3d.support.HighlightOptions")],a)})},"esri/chunks/vec4f32":function(){define(["exports"],function(b){function k(){return new Float32Array(4)}function a(y){const B=
new Float32Array(4);B[0]=y[0];B[1]=y[1];B[2]=y[2];B[3]=y[3];return B}function r(y,B,x,C){const z=new Float32Array(4);z[0]=y;z[1]=B;z[2]=x;z[3]=C;return z}function l(y,B){return new Float32Array(y,B,4)}function h(){return k()}function d(){return r(1,1,1,1)}function c(){return r(1,0,0,0)}function e(){return r(0,1,0,0)}function f(){return r(0,0,1,0)}function g(){return r(0,0,0,1)}const p=k(),n=d(),w=c(),q=e(),m=f(),u=g();var v=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,createView:l,
zeros:h,ones:d,unitX:c,unitY:e,unitZ:f,unitW:g,ZEROS:p,ONES:n,UNIT_X:w,UNIT_Y:q,UNIT_Z:m,UNIT_W:u});b.ONES=n;b.UNIT_W=u;b.UNIT_X=w;b.UNIT_Y=q;b.UNIT_Z=m;b.ZEROS=p;b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.ones=d;b.unitW=g;b.unitX=c;b.unitY=e;b.unitZ=f;b.vec4f32=v;b.zeros=h})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../core/Error ../../../geometry/SpatialReference ../../../geometry/Point ../../../geometry ../../../core/asyncUtils ../../../core/unitUtils ../../../tasks/support/ProjectParameters ../../../portal/support/geometryServiceUtils".split(" "),
function(b,k,a,r,l,h,d,c,e){l=function(){function f(p,n,w=null){this.spatialReference=n;this.unitInMeters=d.getMetersPerUnitForSR(this.spatialReference);this._geometryServicePromise=h.result(this.loadGeometryService(p,w))}var g=f.prototype;g.loadGeometryService=async function(p,n){if(n)return n;try{return await e.create(p&&p.get("portalItem"))}catch{throw new k("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");}};g.awaitGeometryService=async function(){const p=
await this._geometryServicePromise;if(!0===p.ok)return p.value;throw p.error;};g.toGeographic=async function(p){var n=await this.awaitGeometryService();let w=!0;Array.isArray(p[0])&&"number"!==typeof p[0]||(p=[p],w=!1);p=p.map(q=>q instanceof r?q:new r(q,this.spatialReference));p=new c({geometries:p,outSpatialReference:a.WGS84});n=(await n.project(p)).map(q=>"point"===q.type?[q.x,q.y]:void 0);return w?n:n[0]};return f}();b.MapCoordsHelper=l;b.default=l;Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/tasks/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../geometry/support/jsonUtils".split(" "),function(b,k,a,r,l,h,d,c,e,f,g,p,n){const w=r.getLogger("esri.tasks.support.ProjectParameters");
a=function(q){function m(u){u=q.call(this,u)||this;u.geometries=null;u.outSpatialReference=null;u.transformation=null;u.transformForward=null;return u}b._inheritsLoose(m,q);m.prototype.toJSON=function(){const u=this.geometries.map(function(B){return B.toJSON()}),v=this.geometries[0],y={};y.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());y.inSR=v.spatialReference.wkid||JSON.stringify(v.spatialReference.toJSON());y.geometries=JSON.stringify({geometryType:n.getJsonType(v),
geometries:u});this.transformation&&(y.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(y.transformForward=this.transformForward);return y};b._createClass(m,[{key:"outSR",get:function(){w.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");return this.outSpatialReference},set:function(u){w.warn("ProjectParameters.outSR is deprecated. Use outSpatialReference instead.");this.outSpatialReference=u}}]);return m}(p.JSONSupport);
k.__decorate([h.property()],a.prototype,"geometries",void 0);k.__decorate([h.property({json:{read:{source:"outSR"}}})],a.prototype,"outSpatialReference",void 0);k.__decorate([h.property({json:{read:!1}})],a.prototype,"outSR",null);k.__decorate([h.property()],a.prototype,"transformation",void 0);k.__decorate([h.property()],a.prototype,"transformForward",void 0);return a=k.__decorate([c.subclass("esri.tasks.support.ProjectParameters")],a)})},"esri/portal/support/geometryServiceUtils":function(){define("require exports ../../config ../../core/Error ../Portal ../../tasks/support/ProjectParameters".split(" "),
function(b,k,a,r,l,h){async function d(c=null,e){if(a.geometryServiceUrl)return new (await new Promise(function(f,g){b(["../../tasks/GeometryService"],function(p){f(Object.freeze({__proto__:null,"default":p}))},g)})).default({url:a.geometryServiceUrl});if(!c)throw new r("internal:geometry-service-url-not-configured");c="portal"in c?c.portal||l.getDefault():c;await c.load({signal:e});if(c.helperServices&&c.helperServices.geometry&&c.helperServices.geometry.url)return new (await new Promise(function(f,
g){b(["../../tasks/GeometryService"],function(p){f(Object.freeze({__proto__:null,"default":p}))},g)})).default({url:c.helperServices.geometry.url});throw new r("internal:geometry-service-url-not-configured");}k.create=d;k.projectGeometry=async function(c,e,f=null,g){f=await d(f,g);const p=new h;p.geometries=[c];p.outSpatialReference=e;if((c=await f.project(p,{signal:g}))&&Array.isArray(c)&&1===c.length)return c[0];throw new r("internal:geometry-service-projection-failed");};Object.defineProperty(k,
"__esModule",{value:!0})})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor".split(" "),function(b,k,a,r,l,h,d,c,
e,f,g,p){let n=function(v){function y(){var B=v.apply(this,arguments)||this;B.minTotalNumberOfFeatures=2E3;B.maxTotalNumberOfFeatures=5E4;B.maxTotalNumberOfPrimitives=17E5;B.polygonLodFactor=1;B.polylineLodFactor=1;return B}b._inheritsLoose(y,v);return y}(p);k.__decorate([h.property()],n.prototype,"minTotalNumberOfFeatures",void 0);k.__decorate([h.property()],n.prototype,"maxTotalNumberOfFeatures",void 0);k.__decorate([h.property()],n.prototype,"maxTotalNumberOfPrimitives",void 0);k.__decorate([h.property()],
n.prototype,"polygonLodFactor",void 0);k.__decorate([h.property()],n.prototype,"polylineLodFactor",void 0);n=k.__decorate([c.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],n);let w=function(v){function y(){var B=v.apply(this,arguments)||this;B.lodFactor=1;return B}b._inheritsLoose(y,v);return y}(p);k.__decorate([h.property()],w.prototype,"lodFactor",void 0);w=k.__decorate([c.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],w);let q=function(v){function y(){var B=
v.apply(this,arguments)||this;B.lodCrossfadeinDuration=0;B.lodCrossfadeoutDuration=0;B.lodCrossfadeUncoveredDuration=0;return B}b._inheritsLoose(y,v);return y}(w);q=k.__decorate([c.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],q);let m=function(v){function y(){var B=v.apply(this,arguments)||this;B["3dObject"]=new q;B.point=new w;B.integratedMesh=new w;B.pointCloud=new w;B.uncompressedTextureDownsamplingEnabled=!1;return B}b._inheritsLoose(y,v);return y}(p);k.__decorate([h.property({type:q})],
m.prototype,"3dObject",void 0);k.__decorate([h.property({type:w})],m.prototype,"point",void 0);k.__decorate([h.property({type:w})],m.prototype,"integratedMesh",void 0);k.__decorate([h.property({type:w})],m.prototype,"pointCloud",void 0);k.__decorate([h.property()],m.prototype,"uncompressedTextureDownsamplingEnabled",void 0);m=k.__decorate([c.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],m);let u=function(v){function y(){var B=v.apply(this,arguments)||this;B.lodBias=0;B.angledSplitBias=
1;B.reduceTileLevelDifferences=!0;B.textureFadeDuration=500;return B}b._inheritsLoose(y,v);return y}(p);k.__decorate([h.property()],u.prototype,"lodBias",void 0);k.__decorate([h.property()],u.prototype,"angledSplitBias",void 0);k.__decorate([h.property()],u.prototype,"reduceTileLevelDifferences",void 0);k.__decorate([h.property()],u.prototype,"textureFadeDuration",void 0);u=k.__decorate([c.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],u);a=function(v){function y(){var B=
v.apply(this,arguments)||this;B.graphics3D=new n;B.sceneService=new m;B.tiledSurface=new u;B.antialiasingEnabled=!0;B.physicallyBasedRenderingEnabled=!1;B.orderIndependentTransparencyEnabled=!0;return B}b._inheritsLoose(y,v);return y}(p);k.__decorate([h.property({type:n})],a.prototype,"graphics3D",void 0);k.__decorate([h.property({type:m})],a.prototype,"sceneService",void 0);k.__decorate([h.property({type:u})],a.prototype,"tiledSurface",void 0);k.__decorate([h.property()],a.prototype,"antialiasingEnabled",
void 0);k.__decorate([h.property()],a.prototype,"physicallyBasedRenderingEnabled",void 0);k.__decorate([h.property()],a.prototype,"orderIndependentTransparencyEnabled",void 0);k.__decorate([h.property()],a.prototype,"memoryLimit",void 0);k.__decorate([h.property()],a.prototype,"additionalCacheMemory",void 0);k.__decorate([h.property()],a.prototype,"frameRate",void 0);k.__decorate([h.property()],a.prototype,"maximumRenderResolution",void 0);k.__decorate([h.property()],a.prototype,"maximumPixelRatio",
void 0);return a=k.__decorate([c.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],a)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ../../../core/maybe ../../../geometry/SpatialReference ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../core/unitUtils ../../../chunks/mat4 ../../../geometry/projection ../../../layers/graphics/dehydratedFeatures ./stack ./geometryUtils ./geometryUtils/coordinateSystem".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){a=function(){function m(v,y,B,x){this.viewingMode=v;this.spatialReference=y;this.unitInMeters=B;this.coordinateSystem=x;this._coordinateSystem=w.create(x)}var u=m.prototype;u.getAltitude=function(v){return w.altitudeAt(this.coordinateSystem,v)};u.setAltitude=function(v,y){w.setAltitudeAt(this.coordinateSystem,y,v,y)};u.setAltitudeOfTransformation=function(v,y){w.setAltitudeOfTransformation(this.coordinateSystem,y,v,y)};u.worldUpAtPosition=function(v,y){return w.normalAt(this.coordinateSystem,
v,y)};u.worldBasisAtPosition=function(v,y,B){return w.axisAt(this.coordinateSystem,v,y,B)};u.basisMatrixAtPosition=function(v,y){const B=this.worldBasisAtPosition(v,0,p.sv3d.get()),x=this.worldBasisAtPosition(v,1,p.sv3d.get());v=this.worldBasisAtPosition(v,2,p.sv3d.get());e.set(y,B[0],B[1],B[2],0,x[0],x[1],x[2],0,v[0],v[1],v[2],0,0,0,0,1);return y};u.intersectManifoldClosestSilhouette=function(v,y,B){w.elevate(this.coordinateSystem,y,this._coordinateSystem);w.intersectRayClosestSilhouette(this._coordinateSystem,
v,B);return B};u.intersectManifold=function(v,y,B){w.elevate(this.coordinateSystem,y,this._coordinateSystem);y=p.sv3d.get();return w.intersectRay(this._coordinateSystem,v,y)?(h.copy(B,y),!0):!1};u.intersectInfiniteManifold=function(v,y,B){if(1===this.viewingMode)return this.intersectManifold(v,y,B);w.elevate(this.coordinateSystem,y,this._coordinateSystem);y=this._coordinateSystem.value;const x=p.sv3d.get();return n.plane.intersectRay(y.plane,v,x)?(h.copy(B,x),!0):!1};u.toRenderCoords=function(v,y,
B){return g.isDehydratedPoint(v)?f.projectPointToVector(v,y,this.spatialReference):f.projectVectorToVector(v,y,B,this.spatialReference)};u.fromRenderCoords=function(v,y,B){return g.isDehydratedPoint(y)?f.projectVectorToDehydratedPoint(v,this.spatialReference,y,B):y instanceof l?f.projectVectorToPoint(v,this.spatialReference,y):f.projectVectorToVector(v,this.spatialReference,y,r.unwrap(B))};m.createGlobal=function(v){const y=w.fromValues(n.sphere,n.sphere.fromValues(d.getReferenceEllipsoid(v).radius,
[0,0,0]));return new m(1,v,1,y)};m.createLocal=function(v){const y=w.fromValues(n.boundedPlane,n.boundedPlane.fromValues([0,0,0],[q,0,0],[0,q,0])),B=c.getMetersPerUnitForSR(v);return new m(2,v,B,y)};m.createMode=function(v,y){switch(v){case 2:return m.createLocal(y);case 1:return m.createGlobal(y)}};k._createClass(m,[{key:"extent",set:function(v){v&&w.setExtent(this.coordinateSystem,v,this.coordinateSystem)}}]);return m}();const q=Math.pow(2,50);b.RenderCoordsHelper=a;Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/scheduling ../../../core/Accessor ../../../core/Handles ../../support/Scheduler ./index ./MemoryController ./StreamDataLoader".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){b.ResourceControllerMain=function(C){function z(){var A=C.apply(this,arguments)||this;A.updating=!1;return A}k._inheritsLoose(z,C);return z}(q);a.__decorate([c.property({readOnly:!0})],b.ResourceControllerMain.prototype,"updating",void 0);b.ResourceControllerMain=a.__decorate([f.subclass("esri.views.3d.support.ResourceController")],b.ResourceControllerMain);var x;(function(C){let z=function(A){function t(){var E=A.apply(this,arguments)||this;E._scheduler=
null;E._memoryController=null;E._streamDataLoader=null;E._cameraChangeTime=0;E._handles=new m;E._frameTask=null;return E}k._inheritsLoose(t,A);var D=t.prototype;D.initialize=function(){this._cameraChangeTime=this.now();this._scheduler=u.newScheduler(this.now);this._memoryController=y.newMemoryController(this.view);this._streamDataLoader=new B["default"];this._streamDataLoader.setup(v.maxDownloadSlots,v.downloadSlotsPerClient,this._scheduler);this._handles.add([this.view.watch("state.camera",(E,G)=>
this._cameraChangedHandler(E,G),!0),this.view.watch("stationary",()=>this._stationaryChangedHandler()),this._memoryController.events.on("updating-changed",()=>this.notifyChange("updating"))]);this._frameTask=w.addFrameTask({update:E=>this.frame(E)})};D.destroy=function(){this._handles=l.destroyMaybe(this._handles);this._frameTask=l.removeMaybe(this._frameTask);this._streamDataLoader=l.destroyMaybe(this._streamDataLoader);this._memoryController=l.destroyMaybe(this._memoryController);this._scheduler=
l.destroyMaybe(this._scheduler)};D.createStreamDataRequester=function(E){const G=this._streamDataLoader;return{request(H,I,J){return G.request(H,I,E,J)},get busy(){return!G.hasDownloadSlots(E)}}};D.frame=function(E){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(E.deltaTime/1E3),!this._scheduler))return;this._scheduler.state=this.state;this._scheduler.updateBudget(E)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};
D._cameraChangedHandler=function(E,G){E&&G&&E.almostEquals(G)||(this._cameraChangeTime=this._scheduler.now,this._scheduler.state=this.state)};D._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};k._createClass(t,[{key:"updating",get:function(){var E,G;return!!(null!=(E=this._memoryController)&&E.updating||null!=(G=this._streamDataLoader)&&G.updating)}},{key:"scheduler",get:function(){return this._scheduler}},{key:"memoryController",get:function(){return this._memoryController}},
{key:"state",get:function(){const E=this.view;return E.animation?0:E.interacting||300>=this._scheduler.now-this._cameraChangeTime?1:2}},{key:"test",get:function(){return{getQueueStats:E=>this._streamDataLoader.test.loadQueue.getStatsForType(E),state:this.state}}}]);return t}(b.ResourceControllerMain);a.__decorate([c.property({constructOnly:!0})],z.prototype,"view",void 0);a.__decorate([c.property({constructOnly:!0})],z.prototype,"now",void 0);a.__decorate([c.property()],z.prototype,"_memoryController",
void 0);a.__decorate([c.property()],z.prototype,"_streamDataLoader",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["_memoryController.updating","_streamDataLoader.updating"]})],z.prototype,"updating",null);z=a.__decorate([f.subclass("esri.views.3d.support.ResourceController")],z);C.ResourceController=z})(x||(x={}));b.newResourceController=function(C,z=()=>performance.now()){return new x.ResourceController({view:C,now:z})};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/index":function(){define(["exports"],
function(b){b.downloadSlotsPerClient=[10,10,10,10,5];b.maxDownloadSlots=30;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/Logger ../../../core/Evented ../../../core/MemCache ../layers/support/MemoryManagedLayerView".split(" "),function(b,k,a,r,l,h,d){const c=r.getLogger("esri.views.3d.support.MemoryController");let e=function(){function f(p){this._view=
p;this.events=new l;this.minQuality=.1;this._maxMemory=500;this._additionalCacheMemory=100;this._quality=1;this._downscaleMemoryUsed=this._stableQuality=0;this._canFastRecover=!1;this._memoryPredicted=this._memoryUsed=0;this._cacheStorage=new h.MemCacheStorage;this._numQualityChanges=0;this._updating=!1}var g=f.prototype;g.destroy=function(){this.events=null};g.getMemCache=function(p,n){return new h.MemCache(p,this._cacheStorage,n)};g.disableMemCache=function(){this._additionalCacheMemory=-4096};
g.resetStableQuality=function(){this._stableQuality=0};g.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var p=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(p){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&
this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,p=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=this._quality,p=this._updateQuality(this._quality+.05)):1>this._quality&&
(this._canFastRecover=!0));this.updating!==p&&(this._updating=p,this.events.emit("updating-changed",this.updating))}};g._updateQuality=function(p){p=Math.min(Math.max(p,this.minQuality),1);if(p===this._quality)return!1;this._quality=p;this.events.emit("quality-changed",this._quality);++this._numQualityChanges;return!0};g._layersUpdating=function(){return this._view.allLayerViews.some(p=>!!p.updating)};g._updateMemory=function(){let p=0,n=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&
(p+=this._view.basemapTerrain.getUsedMemory());var w=this._view._stage&&this._view._stage.renderView&&this._view._stage.renderView.edgeView;a.isSome(w)&&(p+=w.getUsedMemory());this._view.allLayerViews&&this._view.allLayerViews.forEach(m=>{if(d.isMemoryManagedLayerView(m)){const u=m.ignoresMemoryFactor()?this._quality:1;p+=m.getUsedMemory()*u;n+=m.getUnloadedMemory()*u}});var q=null==this._warnMemoryUsage||Math.round(10*p)!==Math.round(10*this._warnMemoryUsage);w=1048576*this._maxMemory;if(p>w&&q){this._warnMemoryUsage=
p;q=u=>(u/1048576).toLocaleString(void 0,{maximumFractionDigits:1})+" MB";const m=Math.round(100*this._quality);c.warn(`Memory Limit exceeded! Limit: ${q(w)} Current: ${q(p)} Projected: ${q(p+n)} Quality: ${m}%`)}this._memoryUsed=p/w;this._memoryPredicted=(p+n)/w;this._cacheStorage.maxSize=Math.max(0,w-p+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};k._createClass(f,[{key:"maxMemory",set:function(p){null!=p&&0<p&&(this._stableQuality=0,this._canFastRecover=
!1,this._maxMemory<p&&this._updateQuality(1),this._maxMemory=p)},get:function(){return this._maxMemory}},{key:"additionalCacheMemory",set:function(p){null!=p&&0<=p&&(this._additionalCacheMemory=p)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._memoryUsed}},{key:"test",get:function(){return{cacheStorage:this._cacheStorage,numQualityChanges:this._numQualityChanges}}}]);return f}();b.newMemoryController=
function(f){return new e(f)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports"],function(b){b.isMemoryManagedLayerView=function(k){return"function"===typeof k.getUsedMemory};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/arrayUtils ../../../core/promiseUtils ../../../core/Accessor ../../../request ../../support/Scheduler ../webgl-engine/lib/Util ./AsyncWorkerQueue ./StreamDataLoaderTask".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){function A(D){if(2>D.byteLength)return"unknown";D=new Uint8Array(D,0,D.byteLength);return 137===D[0]&&80===D[1]?"image/png":71===D[0]&&73===D[1]?"image/gif":66===D[0]&&77===D[1]?"image/bmp":255===D[0]&&216===D[1]?"image/jpeg":"unknown"}b.StreamDataLoader=function(D){function E(){var H=D.apply(this,arguments)||this;H.tasks=new Map;H.onLoadQueue=[];H.doneQueue=[];H.updating=!1;return H}k._inheritsLoose(E,D);var G=E.prototype;G.setup=function(H,
I,J){this.loadQueue=new C.AsyncWorkerQueue((K,L)=>this.startLoading(K,L),(K,L)=>this.doneLoadingCallback(K,L),H,I);J&&(this.taskHandle=J.registerTask(B.Task.STREAM_DATA_LOADER,K=>this.update(K),()=>0<this.doneQueue.length||0<this.onLoadQueue.length))};G.destroy=function(){this.taskHandle&&(this.taskHandle.remove(),this.taskHandle=null);this.tasks.forEach(H=>{H.abortController&&H.abortController.abort()});this.loadQueue.destroy();this.tasks=this.doneQueue=this.onLoadQueue=this.loadQueue=null};G.hasDownloadSlots=
function(H){return this.loadQueue.hasQuota(H)};G.request=function(H,I,J,K={}){const L=u.createResolver();L.__signal=h.isSome(K)?K.signal:null;const S=this.createOrUpdateTask(H,I,J,K,L);u.onAbort(K,()=>this.cancelRequest(S,L));return L.promise};G.createTask=function(H,I,J,K,L,S){H=new z(H,I,J,K,L);this.updateTask(H,S);this.tasks.set(L,H);1===this.tasks.size&&this._set("updating",!0);this.loadQueue.push(H);return H};G.cancelRequest=function(H,I){m.removeUnordered(H.resolvers,I);I.reject(u.createAbortError());
0===H.resolvers.length&&(2===H.status&&(H.status=4,this.loadQueue.cancel(H),H.abortController.abort(),H.request=null,H.abortController=null),H.status=4,this.tasks.delete(H.key),0===this.tasks.size&&this._set("updating",!1))};G.taskKey=function(H,I,J){return`${H}:${I}:${J}`};G.updateTask=function(H,I){H.resolvers.push(I)};G.createOrUpdateTask=function(H,I,J,K,L){var S=h.isSome(K)&&K.uid||H;S=this.taskKey(S,I,J);const M=this.tasks.get(S);return M?(this.updateTask(M,L),M):this.createTask(H,K,I,J,S,L)};
G.doneLoadingCallback=function(H,I){this.loadQueue&&(x.assert(2===H.status),H.status=3,this.taskHandle?this.doneQueue.push({task:H,err:I}):this.doneLoading(H,I))};G.update=function(H){for(;!H.done&&0<this.onLoadQueue.length;){var I=this.onLoadQueue.shift();u.throwIfAborted(I.task.abortController);I.task.abortController=null;I.callback(I.task);H.madeProgress()}for(;!H.done&&0<this.doneQueue.length;)I=this.doneQueue.shift(),3!==I.task.status&&(I.err=I.err||u.createAbortError()),this.doneLoading(I.task,
I.err),H.madeProgress()};G.doneLoading=function(H,I){let J=H.result instanceof HTMLImageElement?0:H.resolvers.length;for(const K of H.resolvers)if(I)u.isAbortError(I)?K.reject(I):K.reject(new p("stream-data-loader:request-error",`Failed to request resource at '${H.url}'. ${I}`,{url:H.url,error:I}));else{--J;const L=0>=J?H.result:l.clone(H.result);K.resolve(L)}this.tasks.delete(H.key);0===this.tasks.size&&this._set("updating",!1)};G.startLoading=function(H,I){if(4===H.status)return!1;H.startTime=performance.now();
H.status=2;let J,K;switch(H.docType){case "binary":K="array-buffer";J=0;break;case "image":K="image";break;case "image+type":K="array-buffer";break;default:K="json"}H.abortController=u.createAbortController();const L=H.abortController.signal;H.request=y(H.url,{...H.options,responseType:K,timeout:J,signal:L});let S=()=>{};const M=O=>{H.duration=performance.now()-H.startTime;H.size=O instanceof ArrayBuffer?O.byteLength:H.size||0;H.result=O;this.taskHandle?this.onLoadQueue.push({callback:I,task:H}):
(H.abortController=null,I(H))},T=O=>{2===H.status&&I(H,O);S()};if("image+type"!==H.docType)return H.request.then(O=>M(O.data),T),!0;H.request.then(O=>{O=O.data;const Q=A(O);K="image";H.size=O.byteLength;if("unknown"===Q)H.request=y(H.url,{responseType:K,timeout:J,signal:L}),H.request.then(N=>M(N.data),T);else{O=new Blob([O],{type:Q});var F=window.URL.createObjectURL(O);S=()=>window.URL.revokeObjectURL(F);H.request=y(F,{responseType:K,timeout:J,signal:L});H.request.then(N=>M(new t(N.data,Q,S)),T)}},
T);return!0};k._createClass(E,[{key:"test",get:function(){return{loadQueue:this.loadQueue}}}]);return E}(v);a.__decorate([e.property({readOnly:!0})],b.StreamDataLoader.prototype,"updating",void 0);b.StreamDataLoader=a.__decorate([g.subclass("esri.views.3d.support.StreamDataLoader")],b.StreamDataLoader);let t=function(){function D(E,G,H){this.image=E;this.type=G;this.release=H}k._createClass(D,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return D}();a=b.StreamDataLoader;b.ImageWithType=
t;b.default=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(b,k,a){let r=function(d){this.typeWorkerQuota=d;this.tasks=[];this.numWorkers=0;this.statistics=new l},l=function(){this.speed=this.duration=this.size=this.requests=0},h=function(){function d(e,f,g,p){this._workerFunc=e;this._callbackFunc=f;this._maxTotalNumWorkers=g;this._totalNumWorkers=
0;this._clients=p.map(n=>new r(n))}var c=d.prototype;c.hasQuota=function(e){return(e=this._clients[e])?e.typeWorkerQuota>e.numWorkers+e.tasks.length:!1};c.push=function(e){const f=this._clients[e.client];f&&(this._totalNumWorkers<this._maxTotalNumWorkers?(f.numWorkers++,this._totalNumWorkers++,this._workerFunc(e,(g,p)=>this._taskCallback(g,p))):f.tasks.push(e))};c.getStatsForType=function(e){return(e=this._clients[e])?{quota:e.typeWorkerQuota,workers:e.numWorkers,queueSize:e.tasks.length,requestStats:e.statistics}:
null};c.cancel=function(e){this._taskFinished(e);e._cancelled=!0};c.destroy=function(){this._clients.length=0};c._taskFinished=function(e){const f=this._clients[e.client];this._totalNumWorkers--;f.numWorkers--;f.statistics.requests++;f.statistics.size+=e.size||0;f.statistics.duration+=e.duration||0;f.statistics.speed=0<f.statistics.duration?f.statistics.size/f.statistics.duration:0;a.assert(0<=f.numWorkers);this._next()};c._next=function(){for(const e of this._clients)if(e&&e.numWorkers<e.typeWorkerQuota&&
this._processQueue(e))return;for(const e of this._clients)if(e&&this._processQueue(e))break};c._processQueue=function(e){for(;0<e.tasks.length;)if(this._workerFunc(e.tasks.shift(),(f,g)=>this._taskCallback(f,g)))return e.numWorkers++,this._totalNumWorkers++,!0;return!1};c._taskCallback=function(e,f){e._cancelled||(this._callbackFunc(e,f),this._taskFinished(e))};k._createClass(d,[{key:"test",get:function(){const e=this;return{set workerFunc(f){e._workerFunc=f}}}}]);return d}();b.AsyncWorkerQueue=h;
b.BaseTask=function(d){this.client=d;this._cancelled=!1;this.duration=this.size=0};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/StreamDataLoaderTask":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./AsyncWorkerQueue"],function(b,k){return function(a){function r(l,h,d,c,e){c=a.call(this,c)||this;c.url=l;c.options=h;c.docType=d;c.key=e;c.result=null;c.status=1;c.request=null;c.abortController=null;c.resolvers=[];c.startTime=0;return c}b._inheritsLoose(r,
a);return r}(k.BaseTask)})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/maybe ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../support/StreamDataLoader ../../2d/engine/vectorTiles/VectorTile ./RasterTile ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical ./TileTexture".split(" "),function(b,k,a,r,l,h,d,c,e,f,g){function p(z){return"imagery-tile"===z.type||"wcs"===z.type}function n(z){return z&&"esri.views.3d.layers.ImageryTileLayerView3D"===
z.declaredClass}function w(z){return z&&"esri.views.3d.layers.TileLayerView3D"===z.declaredClass}function q(z){return z&&"esri.views.3d.layers.VectorTileLayerView3D"===z.declaredClass}function m(z){return z&&"esri.views.3d.layers.WMTSLayerView3D"===z.declaredClass}function u(z){return z&&"esri.views.3d.layers.ElevationLayerView3D"===z.declaredClass}function v(z,A,t,D){return y[2===D||"planar"===D?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(z,t,A)}const y={planar:e.terrainUtilsPlanar,spherical:f.terrainUtilsSpherical},
B=80/180*Math.PI,x=110/180*Math.PI,C={force512VTL:!1};b.checkIfTileInfoSupportedForView=v;b.computeSkirtScale=function(z,A,t){var D=y[z.manifold];if(D.isInsideExtent(z,A))z=z.getElevation(A[0],A[1],A[1],z.spatialReference);else{if(!D.isInsideExtent(z,A,1.2))return 0;D=D.tiltToExtentEdge(z,A);if(D>B&&D<x)return 0;z=z.elevationBounds;z=.5*(z.min+z.max)}A=A[2]-z;return Math.abs(A)<t?0:0>A?-1:1};b.getLayerWithExtentRange=function(z){return n(z)?{fullExtent:z.fullExtent,minScale:z.layer.minScale,maxScale:z.layer.maxScale,
tilemapCache:null}:z.layer};b.getTiledLayerInfo=function(z,A,t){let D,E;if("wmts"===z.type){if(z=z.activeLayer){const G=z.tileMatrixSet;if(G)D=G.tileInfo,E=G.fullExtent;else if(z=z.tileMatrixSets)if(z=z.find(H=>null==v(H.tileInfo,H.fullExtent,A,t)))return{tileInfo:z.tileInfo,fullExtent:z.fullExtent}}}else E=p(z)?z.getCompatibleFullExtent(A):z.fullExtent,D="vector-tile"!==z.type||C.force512VTL?p(z)?z.getCompatibleTileInfo(A,E):z.tileInfo:z.compatibleTileInfo256;return D&&E&&null==v(D,E,A,t)?{tileInfo:D,
fullExtent:E}:{tileInfo:null,fullExtent:null}};b.isElevationLayerView=u;b.isImageryTileLayerView=n;b.isImageryTileRenderInfo=function(z){return z&&z.sourceLayerInfo&&z.sourceLayerInfo.data instanceof c};b.isProjectableRasterLayer=p;b.isRasterTileRenderInfo=function(z){z=z&&z.sourceLayerInfo&&z.sourceLayerInfo.data;return z instanceof HTMLImageElement||z instanceof h.ImageWithType||z instanceof HTMLCanvasElement||z instanceof ImageData};b.isSurfaceLayerView=function(z){return z&&(w(z)||n(z)||u(z)||
q(z)||m(z))};b.isTextureTileRenderInfo=function(z){return z&&z.sourceLayerInfo&&z.sourceLayerInfo.data instanceof g};b.isTileLayerView=w;b.isVectorTileLayer=function(z){return z&&z instanceof l};b.isVectorTileLayerView=q;b.isVectorTileRenderInfo=function(z){return z&&z.sourceLayerInfo&&z.sourceLayerInfo.data instanceof d.VectorTile};b.isWMTSLayerView=m;b.releaseTileData=function(z){!k.isSome(z)||z instanceof HTMLImageElement||z instanceof HTMLCanvasElement||z instanceof ImageData||z.release();return null};
b.test=C;b.useFetchTileForLayer=function(z){return z.fetchTile&&!(z.fetchTile===r.prototype.fetchTile||z.fetchTile===a.prototype.fetchTile)};b.weakAssert=function(z,A){z||console.warn("Terrain: "+A)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/ElevationLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ../request ./Layer ../core/MultiOriginJSONSupport ../geometry/HeightModelInfo ./support/commonProperties ./mixins/OperationalLayer ./mixins/ArcGISService ./mixins/PortalLayer ./mixins/ArcGISCachedService ./support/LercDecoder".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D){const E=h.getLogger("esri.layers.ElevationLayer");r=function(G){function H(...J){J=G.call(this,...J)||this;J.copyright=null;J.heightModelInfo=null;J.path=null;J.opacity=1;J.operationalLayerType="ArcGISTiledElevationServiceLayer";J.sourceJSON=null;J.type="elevation";J.url=null;J.version=null;J._lercDecoder=D.acquireDecoder();return J}k._inheritsLoose(H,G);var I=H.prototype;I.normalizeCtorArgs=function(J,K){return"string"===typeof J?{url:J,
...K}:J};I.destroy=function(){D.releaseDecoder(this._lercDecoder);this._lercDecoder=null};I.readVersion=function(J,K){(J=K.currentVersion)||(J=9.3);return J};I.load=function(J){const K=l.isSome(J)?J.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"],supportsData:!1,validateItem:L=>{for(let S=0;S<L.typeKeywords.length;S++)if("elevation 3d layer"===L.typeKeywords[S].toLowerCase())return!0;throw new p("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}' ",
{type:"Image Service",expectedType:"Image Service Elevation 3D Layer"});}},J).then(()=>this._fetchImageService(K),()=>this._fetchImageService(K)));return m.resolve(this)};I.fetchTile=function(J,K,L,S){S=S||{signal:null};const M=l.isSome(S.signal)?S.signal:S.signal=m.createAbortController().signal,T={responseType:"array-buffer",signal:M},O={noDataValue:S.noDataValue,returnFileInfo:!0};return this.load().then(()=>this._fetchTileAvailability(J,K,L,S)).then(()=>u(this.getTileUrl(J,K,L),T)).then(Q=>this._lercDecoder.decode(Q.data,
O,M)).then(Q=>({values:Q.pixelData,width:Q.width,height:Q.height,maxZError:Q.fileInfo.maxZError,noDataValue:Q.noDataValue,minValue:Q.minValue,maxValue:Q.maxValue}))};I.getTileUrl=function(J,K,L){const S=n.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null});return`${this.parsedUrl.path}/tile/${J}/${K}/${L}${S?"?"+S:""}`};I.queryElevation=async function(J,K){const {ElevationQuery:L}=await new Promise(function(S,M){b(["./support/ElevationQuery"],S,M)});
m.throwIfAborted(K);return(new L).query(this,J,K)};I.createElevationSampler=async function(J,K){const {ElevationQuery:L}=await new Promise(function(S,M){b(["./support/ElevationQuery"],S,M)});m.throwIfAborted(K);return(new L).createSampler(this,J,K)};I._fetchTileAvailability=function(J,K,L,S){return this.tilemapCache?this.tilemapCache.fetchAvailability(J,K,L,S):m.resolve("unknown")};I._fetchImageService=async function(J){if(this.sourceJSON)return this.sourceJSON;J=await u(this.parsedUrl.path,{query:{f:"json",
...this.parsedUrl.query},responseType:"json",signal:J});J.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=J.data;this.read(J.data,{origin:"service",url:this.parsedUrl})};k._createClass(H,[{key:"minScale",set:function(J){this.constructed&&E.warn(`${this.declaredClass}.minScale support has been removed (since 4.5)`)},get:function(){}},{key:"maxScale",set:function(J){this.constructed&&E.warn(`${this.declaredClass}.maxScale support has been removed (since 4.5)`)},get:function(){}}]);
return H}(t.ArcGISCachedService(z.ArcGISService(C.OperationalLayer(A.PortalLayer(y.MultiOriginJSONMixin(v))))));a.__decorate([c.property({json:{read:{source:"copyrightText"}}})],r.prototype,"copyright",void 0);a.__decorate([c.property({readOnly:!0,type:B})],r.prototype,"heightModelInfo",void 0);a.__decorate([c.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],r.prototype,"path",void 0);a.__decorate([c.property({type:["show","hide"]})],r.prototype,"listMode",void 0);
a.__decorate([c.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],r.prototype,"minScale",null);a.__decorate([c.property({json:{read:!1,write:!1,origins:{service:{read:!1,write:!1},"portal-item":{read:!1,write:!1},"web-document":{read:!1,write:!1}}}})],r.prototype,"maxScale",null);a.__decorate([c.property({json:{read:!1,write:!1,origins:{"web-document":{read:!1,write:!1}}}})],r.prototype,"opacity",void 0);a.__decorate([c.property({type:["ArcGISTiledElevationServiceLayer"]})],
r.prototype,"operationalLayerType",void 0);a.__decorate([c.property()],r.prototype,"sourceJSON",void 0);a.__decorate([c.property({json:{read:!1},value:"elevation",readOnly:!0})],r.prototype,"type",void 0);a.__decorate([c.property(x.url)],r.prototype,"url",void 0);a.__decorate([c.property()],r.prototype,"version",void 0);a.__decorate([f.reader("version",["currentVersion"])],r.prototype,"readVersion",null);return r=a.__decorate([g.subclass("esri.layers.ElevationLayer")],r)})},"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../geometry/SpatialReference ../../geometry ../support/serviceTileInfoProperty ../support/TilemapCache".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){b.ArcGISCachedService=v=>{v=function(y){function B(){var C=y.apply(this,arguments)||this;C.copyright=null;C.minScale=0;C.maxScale=0;C.spatialReference=null;C.tileInfo=null;C.tilemapCache=null;return C}k._inheritsLoose(B,y);var x=B.prototype;x.readMinScale=function(C,z){return null!=z.minLOD&&null!=z.maxLOD?C:0};x.readMaxScale=function(C,z){return null!=z.minLOD&&null!=z.maxLOD?C:0};x.readTilemapCache=function(C,z){return z.capabilities&&-1<z.capabilities.indexOf("Tilemap")?
new u.TilemapCache({layer:this}):null};k._createClass(B,[{key:"supportsBlankTile",get:function(){return 10.2<=this.version}}]);return B}(v);a.__decorate([d.property({json:{read:{source:"copyrightText"}}})],v.prototype,"copyright",void 0);a.__decorate([d.property()],v.prototype,"minScale",void 0);a.__decorate([e.reader("service","minScale")],v.prototype,"readMinScale",null);a.__decorate([d.property()],v.prototype,"maxScale",void 0);a.__decorate([e.reader("service","maxScale")],v.prototype,"readMaxScale",
null);a.__decorate([d.property({type:w})],v.prototype,"spatialReference",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:["version"]})],v.prototype,"supportsBlankTile",null);a.__decorate([d.property(m.serviceTileInfoProperty)],v.prototype,"tileInfo",void 0);a.__decorate([d.property()],v.prototype,"tilemapCache",void 0);a.__decorate([e.reader("service","tilemapCache",["capabilities"])],v.prototype,"readTilemapCache",null);a.__decorate([d.property()],v.prototype,"version",void 0);return v=a.__decorate([f.subclass("esri.layers.mixins.ArcGISCachedService")],
v)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/support/serviceTileInfoProperty":function(){define(["exports","./TileInfo"],function(b,k){function a(l,h,d,c){if(!l)return null;const {minScale:e,maxScale:f,minLOD:g,maxLOD:p}=h;if(null!=g&&null!=p)return c&&c.ignoreMinMaxLOD?k.fromJSON(l):k.fromJSON({...l,lods:l.lods.filter(({level:n})=>null!=n&&n>=g&&n<=p)});if(0!==e&&0!==f){const n=e?Math.round(1E4*e)/1E4:Infinity,w=f?Math.round(1E4*f)/1E4:-Infinity;return k.fromJSON({...l,lods:l.lods.filter(q=>
{q=Math.round(1E4*q.scale)/1E4;return q<=n&&q>=w})})}return k.fromJSON(l)}const r={type:k,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:a}}}}};b.readServiceTileInfo=a;b.serviceTileInfoProperty=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/PooledArray ../../core/promiseUtils ../../core/scheduling ../../core/Accessor ../../request ../../core/Handles ../../core/LRUCache ../../core/watchUtils ./Tilemap".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C){var z;const A=l.getLogger("esri.layers.support.TilemapCache");b.TilemapCache=z=function(t){function D(G){G=t.call(this,G)||this;G._handles=new y;G._pendingTilemapRequests={};G._availableLevels={};G.levels=5;G.cacheByteSize=2097152;G.request=v;G._prefetchingEnabled=!0;return G}k._inheritsLoose(D,t);var E=D.prototype;E.initialize=function(){this._tilemapCache=new B(this.cacheByteSize);this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],
()=>this._initializeTilemapDefinition()),x.init(this,"layer.tileInfo.lods",G=>this._initializeAvailableLevels(G),!0)]);this._initializeTilemapDefinition()};E.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)};E.castLevels=function(G){return 2>=G?(A.error("Minimum levels for Tilemap is 3, but got ",G),3):G};E.fetchTilemap=function(G,H,I,J){if(!this._availableLevels[G])return q.reject(new f("tilemap-cache:level-unavailable",`Level ${G} is unavailable in the service`));const K=
this._tmpTilemapDefinition;if(G=this._tilemapFromCache(G,H,I,K))return q.resolve(G);const L=J&&J.signal;J={...J,signal:null};return q.create((S,M)=>{q.onAbort(L,()=>M(q.createAbortError()));const T=C.tilemapDefinitionId(K);let O=this._pendingTilemapRequests[T];if(!O){O=C.Tilemap.fromDefinition(K,J).then(F=>{this._tilemapCache.put(T,F,F.byteSize);return F});const Q=()=>delete this._pendingTilemapRequests[T];this._pendingTilemapRequests[T]=O;O.then(Q,Q)}O.then(S,M)})};E.getAvailability=function(G,H,
I){return this._availableLevels[G]?(G=this._tilemapFromCache(G,H,I,this._tmpTilemapDefinition))?G.getAvailability(H,I):"unknown":"unavailable"};E.getAvailabilityUpsample=function(G,H,I,J){J.level=G;J.row=H;J.col=I;G=this.layer.tileInfo;for(G.updateTileInfo(J);;)if(H=this.getAvailability(J.level,J.row,J.col),"unavailable"===H){if(!G.upsampleTile(J))return"unavailable"}else return H};E.fetchAvailability=function(G,H,I,J){return this._availableLevels[G]?this.fetchTilemap(G,H,I,J).catch(K=>K).then(K=>
{if(K instanceof C.Tilemap)return K=K.getAvailability(H,I),"unavailable"===K?q.reject(new f("tile-map:tile-unavailable","Tile is not available",{level:G,row:H,col:I})):K;if(q.isAbortError(K))throw K;return"unknown"}):q.reject(new f("tilemap-cache:level-unavailable",`Level ${G} is unavailable in the service`))};E.fetchAvailabilityUpsample=function(G,H,I,J,K){J.level=G;J.row=H;J.col=I;const L=this.layer.tileInfo;L.updateTileInfo(J);const S=this.fetchAvailability(G,H,I,K).catch(M=>{if(q.isAbortError(M))throw M;
if(L.upsampleTile(J))return this.fetchAvailabilityUpsample(J.level,J.row,J.col,J);throw M;});this._fetchAvailabilityUpsamplePrefetch(J.id,G,H,I,K,S);return S};E._fetchAvailabilityUpsamplePrefetch=async function(G,H,I,J,K,L){if(this._prefetchingEnabled){var S=`prefetch-${G}`;if(!this._handles.has(S)){var M=q.createAbortController();L.then(()=>M.abort(),()=>M.abort());var T=!1;this._handles.add({remove(){T||(T=!0,M.abort())}},S);await m.waitTicks(10,M.signal).catch(()=>{});T||(T=!0,this._handles.remove(S));
if(!q.isAborted(M))for(G={id:G,level:H,row:I,col:J},K={...K,signal:M.signal},H=this.layer.tileInfo,I=0;z._prefetches.length<z._maxPrefetch&&H.upsampleTile(G);++I){const O=this.fetchAvailability(G.level,G.row,G.col,K);z._prefetches.push(O);J=()=>{z._prefetches.removeUnordered(O)};O.then(J,J)}}}};E._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var G=this.layer.parsedUrl,H=G.query;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:G.path,query:H?g.objectToQuery(H):
null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}};E._tilemapFromCache=function(G,H,I,J){J.level=G;J.row=H-H%this.size;J.col=I-I%this.size;G=C.tilemapDefinitionId(J);return this._tilemapCache.get(G)};E._initializeAvailableLevels=function(G){this._availableLevels={};G&&G.forEach(H=>this._availableLevels[H.level]=!0)};k._createClass(D,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const G=
this;return{get prefetchingEnabled(){return G._prefetchingEnabled},set prefetchingEnabled(H){G._prefetchingEnabled=H},hasTilemap(H,I,J){return!!G._tilemapFromCache(H,I,J,G._tmpTilemapDefinition)}}}}]);return D}(u);b.TilemapCache._maxPrefetch=4;b.TilemapCache._prefetches=new w({initialSize:z._maxPrefetch});a.__decorate([h.property({constructOnly:!0,type:Number})],b.TilemapCache.prototype,"levels",void 0);a.__decorate([d.cast("levels")],b.TilemapCache.prototype,"castLevels",null);a.__decorate([h.property({readOnly:!0,
dependsOn:["levels"],type:Number})],b.TilemapCache.prototype,"size",null);a.__decorate([h.property({constructOnly:!0,type:Number})],b.TilemapCache.prototype,"cacheByteSize",void 0);a.__decorate([h.property({constructOnly:!0})],b.TilemapCache.prototype,"layer",void 0);a.__decorate([h.property({constructOnly:!0})],b.TilemapCache.prototype,"request",void 0);b.TilemapCache=z=a.__decorate([e.subclass("esri.layers.support.TilemapCache")],b.TilemapCache);Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/layers/support/Tilemap":function(){define(["exports","../../core/lang","../../core/Error","../../core/arrayUtils","../../request"],function(b,k,a,r,l){function h(c){if("vector-tile"===c.service.type)var e=`${c.service.url}/tilemap/${c.level}/${c.row}/${c.col}/${c.width}/${c.height}`;else e=c.service.tileServers,e=`${e&&e.length?e[c.row%e.length]:c.service.url}/tilemap/${c.level}/${c.row}/${c.col}/${c.width}/${c.height}`;(c=c.service.query)&&(e=`${e}?${c}`);return e}let d=function(){function c(){this.location=
{left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var e=c.prototype;e.getAvailability=function(f,g){if("unknown"!==this._allAvailability)return this._allAvailability;f=(f-this.location.top)*this.location.width+(g-this.location.left);g=f>>3;const p=this._tileAvailabilityBitSet;return 0>g||g>p.length?"unknown":p[g]&1<<f%8?"available":"unavailable"};e._updateFromData=function(f){let g=!0,p=!0;const n=new Uint8Array(Math.ceil(this.location.width*this.location.height/8));
let w=0;for(let q=0;q<f.length;q++){const m=q%8;f[q]?(p=!1,n[w]|=1<<m):g=!1;7===m&&++w}p?this._allAvailability="unavailable":g?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=n,this.byteSize+=n.length)};c.fromDefinition=function(f,g){const p=f.service.request||l,{row:n,col:w,width:q,height:m}=f,u={query:{f:"json"}};g=g?{...u,...g}:u;return p(h(f),g).then(v=>v.data).catch(v=>{if(v&&v.details&&422===v.details.httpStatus)return{location:{top:n,left:w,width:q,
height:m},valid:!0,data:r.constant(q*m,0)};throw v;}).then(v=>{if(v.location&&(v.location.top!==n||v.location.left!==w||v.location.width!==q||v.location.height!==m))throw new a("tilemap:location-mismatch","Tilemap response for different location than requested",{response:v,definition:{top:n,left:w,width:q,height:m}});return c.fromJSON(v)})};c.fromJSON=function(f){c.validateJSON(f);const g=new c;g.location=Object.freeze(k.clone(f.location));g._updateFromData(f.data);return Object.freeze(g)};c.validateJSON=
function(f){if(!f||!f.location)throw new a("tilemap:missing-location","Location missing from tilemap response");if(!1===f.valid)throw new a("tilemap:invalid","Tilemap response was marked as invalid");if(!f.data)throw new a("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(f.data))throw new a("tilemap:data-mismatch","Data must be an array of numbers");if(f.data.length!==f.location.width*f.location.height)throw new a("tilemap:data-mismatch","Number of data items does not match width/height of tilemap");
};return c}();b.Tilemap=d;b.default=d;b.tilemapDefinitionId=function(c){return`${c.level}/${c.row}/${c.col}/${c.width}/${c.height}`};b.tilemapDefinitionUrl=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/promiseUtils","../../views/3d/support/WorkerHandle"],function(b,k,a,r){let l=function(d){function c(f){var g=d.call(this,"LercWorker","_decode",f,{strategy:"dedicated"})||this;
g.scheduler=f;return g}k._inheritsLoose(c,d);var e=c.prototype;e.decode=function(f,g,p){return f&&0!==f.byteLength?this.invoke({buffer:f,options:g},p):a.resolve(null)};e.getTransferList=function(f){return[f.buffer]};return c}(r.WorkerHandle);const h=new Map;b.acquireDecoder=function(d){let c=h.get(d);c||(c={instance:new l(d),ref:0},h.set(d,c));++c.ref;return c.instance};b.releaseDecoder=function(d){if(null!=d){d=d.scheduler;var c=h.get(d);c&&0>=--c.ref&&(c.instance.destroy(),h.delete(d))}};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/support/WorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Logger","../../../core/promiseUtils","../../../core/workers/workers"],function(b,k,a,r,l){const h=a.getLogger("esri.views.3d.support.WorkerHandle");a=function(){function d(e,f,g,p={}){this._methodName=f;this._promise=l.open(e,{...p,scheduler:g}).then(n=>{void 0===this._thread?(this._thread=n,this._promise=null,p.hasInitialize&&this.broadcast({},"initialize")):
n.close()});this._promise.catch(n=>h.error(`Failed to initialize ${e} worker: ${n}`))}var c=d.prototype;c.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null};c.invoke=function(e,f){if(this._thread){const g=this.getTransferList(e);return this._thread.invoke(this._methodName,e,{transferList:g,signal:f})}return this._promise?this._promise.then(()=>{r.throwIfAborted(f);return this.invoke(e,f)}):r.reject(null)};c.broadcast=function(e,f){return this._thread?r.all(this._thread.broadcast(f,
e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,f)):r.reject()};k._createClass(d,[{key:"promise",get:function(){return this._promise}}]);return d}();b.WorkerHandle=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/TileLayer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ../geometry/SpatialReference ../geometry ../request ./Layer ../core/MultiOriginJSONSupport ./support/arcgisLayerUrl ./support/commonProperties ./mixins/OperationalLayer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ../core/HandleOwner ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./support/Sublayer ./mixins/SublayersOwner".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M){const T="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");
a=function(O){function Q(...N){N=O.call(this,...N)||this;N.listMode="show";N.isReference=null;N.operationalLayerType="ArcGISTiledMapServiceLayer";N.resampling=!0;N.sourceJSON=null;N.spatialReference=null;N.path=null;N.sublayers=null;N.type="tile";N.url=null;return N}b._inheritsLoose(Q,O);var F=Q.prototype;F.normalizeCtorArgs=function(N,P){return"string"===typeof N?{url:N,...P}:N};F.load=function(N){const P=r.isSome(N)?N.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},
N).then(()=>this._fetchService(P),()=>this._fetchService(P)));return m.resolve(this)};F.readSpatialReference=function(N,P){return(N=N||P.tileInfo&&P.tileInfo.spatialReference)&&u.fromJSON(N)};F.writeSublayers=function(N,P,U,V){if(this.loaded&&N){N=N.slice().reverse().flatten(({sublayers:ca})=>ca&&ca.toArray().reverse()).toArray();var W=[],X={writeSublayerStructure:!1,...V};N.forEach(ca=>{ca=ca.write({},X);W.push(ca)});W.some(ca=>1<Object.keys(ca).length)&&(P.layers=W)}};F.castTileServers=function(N){return Array.isArray(N)?
N.map(P=>n.urlToObject(P).path):null};F.fetchTile=function(N,P,U,V={}){const {signal:W,timestamp:X}=V;N=this.getTileUrl(N,P,U);P={responseType:"image",signal:W};null!=X&&(P.query={_ts:V.timestamp});return y(N,P).then(ca=>ca.data)};F.getTileUrl=function(N,P,U){const V=n.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null,...this.customParameters}),W=this.tileServers;return`${W&&W.length?W[P%W.length]:this.parsedUrl.path}/tile/${N}/${P}/${U}${V?"?"+V:
""}`};F._fetchService=function(N){return m.create((P,U)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new p("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");P({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new p("tile-layer:undefined-url","layer's url is not defined");var V=C.parse(this.parsedUrl.path);if(r.isSome(V)&&"ImageServer"===V.serverType)throw new p("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
y(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters},responseType:"json",signal:N}).then(P,U)}}).then(P=>{P.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=P.data;this.read(P.data,{origin:"service",url:this.parsedUrl});if(10.1===this.version&&!C.isHostedAgolService(this.url))return this._fetchServerVersion(this.url,N).then(U=>{this.read({currentVersion:U})}).catch(()=>{})})};F._fetchServerVersion=function(N,P){if(!C.isArcGISUrl(N))return m.reject();
N=N.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return y(N,{query:{f:"json",...this.customParameters},responseType:"json",signal:P}).then(U=>{if(U.data&&U.data.currentVersion)return U.data.currentVersion;throw new p("tile-layer:version-not-available");})};F._getMapName=function(N){return(N=N.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&N[2]};F._getDefaultAttribution=function(N){if(N){N=
N.toLowerCase();for(let U=0,V=T.length;U<V;U++){var P=T[U];if(-1<P.toLowerCase().indexOf(N))return n.makeAbsolute("//static.arcgis.com/attribution/"+P)}}};F._getDefaultTileServers=function(N){const P=-1!==N.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),U=-1!==N.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return P||U?[N,N.replace(P?/server\.arcgisonline/i:/services\.arcgisonline/i,P?"services.arcgisonline":"server.arcgisonline")]:[]};b._createClass(Q,[{key:"attributionDataUrl",
get:function(){var N;const P=null==(N=this.parsedUrl)?void 0:N.path.toLowerCase();return P&&this._getDefaultAttribution(this._getMapName(P))}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl.path)}}]);return Q}(D.BlendLayer(M.SublayersOwner(I.ScaleRangeLayer(H.RefreshableLayer(A.OperationalLayer(G.PortalLayer(K.ArcGISCachedService(L.ArcGISMapService(t.ArcGISService(x.MultiOriginJSONMixin(J.HandleOwnerMixin(E.CustomParametersMixin(B)))))))))))));k.__decorate([h.property({readOnly:!0,
dependsOn:["parsedUrl"]})],a.prototype,"attributionDataUrl",null);k.__decorate([h.property({type:["show","hide","hide-children"]})],a.prototype,"listMode",void 0);k.__decorate([h.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],a.prototype,"isReference",void 0);k.__decorate([h.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],a.prototype,"operationalLayerType",void 0);k.__decorate([h.property({type:Boolean})],a.prototype,"resampling",void 0);
k.__decorate([h.property()],a.prototype,"sourceJSON",void 0);k.__decorate([h.property({type:u})],a.prototype,"spatialReference",void 0);k.__decorate([e.reader("spatialReference",["spatialReference","tileInfo"])],a.prototype,"readSpatialReference",null);k.__decorate([h.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],a.prototype,"path",void 0);k.__decorate([h.property({readOnly:!0})],a.prototype,"sublayers",void 0);k.__decorate([g.writer("sublayers",{layers:{type:[S]}})],
a.prototype,"writeSublayers",null);k.__decorate([h.property({json:{read:!1,write:!1}})],a.prototype,"popupEnabled",void 0);k.__decorate([h.property({dependsOn:["parsedUrl"]})],a.prototype,"tileServers",null);k.__decorate([d.cast("tileServers")],a.prototype,"castTileServers",null);k.__decorate([h.property({readOnly:!0,json:{read:!1}})],a.prototype,"type",void 0);k.__decorate([h.property(z.url)],a.prototype,"url",void 0);return a=k.__decorate([f.subclass("esri.layers.TileLayer")],a)})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/SpatialReference ../../geometry/Extent ../../request ../support/commonProperties".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){b.ArcGISMapService=y=>{y=function(B){function x(){var z=B.apply(this,arguments)||this;z.capabilities=void 0;z.copyright=null;z.fullExtent=null;z.legendEnabled=!0;z.spatialReference=null;z.version=null;return z}k._inheritsLoose(x,B);var C=x.prototype;C.readCapabilities=function(z,A){var t=A.capabilities&&A.capabilities.split(",").map(K=>K.toLowerCase().trim());if(!t)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};z=this.type;const D=-1!==t.indexOf("query"),E=-1!==t.indexOf("map"),G=!!A.exportTilesAllowed;t=-1!==t.indexOf("tilemap");const H="tile"!==z&&!!A.supportsDynamicLayers,I="tile"!==z&&(!A.tileInfo||H),J="tile"!==z&&(!A.tileInfo||H);return{operations:{supportsQuery:D,supportsExportMap:E,supportsExportTiles:G,supportsTileMap:t},exportMap:E?{supportsSublayersChanges:"tile"!==z,supportsDynamicLayers:H,supportsSublayerVisibility:I,supportsSublayerDefinitionExpression:J}:null,
exportTiles:G?{maxExportTilesCount:+A.maxExportTilesCount}:null}};C.readVersion=function(z,A){(z=A.currentVersion)||(z=A.hasOwnProperty("capabilities")||A.hasOwnProperty("tables")?10:A.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return z};C.fetchSublayerInfo=async function(z,A){await this.fetchAllLayersAndTables(A);return this._allLayersAndTablesMap.get(z)};C.fetchAllLayersAndTables=async function(z){await this.load(z);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=u(g.urlToObject(this.url).path+
"/layers",{responseType:"json",query:{f:"json",...this.customParameters}}).then(t=>{this._allLayersAndTablesMap=new Map;for(const D of t.data.layers)this._allLayersAndTablesMap.set(D.id,D);return{result:t.data}},t=>({error:t})));const A=await this._allLayersAndTablesPromise;w.throwIfAborted(z);if("result"in A)return A.result;throw A.error;};return x}(y);a.__decorate([d.property({readOnly:!0})],y.prototype,"capabilities",void 0);a.__decorate([e.reader("service","capabilities",["capabilities","exportTilesAllowed",
"maxExportTilesCount","supportsDynamicLayers","tileInfo"])],y.prototype,"readCapabilities",null);a.__decorate([d.property({json:{read:{source:"copyrightText"}}})],y.prototype,"copyright",void 0);a.__decorate([d.property({type:m})],y.prototype,"fullExtent",void 0);a.__decorate([d.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],y.prototype,"id",void 0);a.__decorate([d.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],
y.prototype,"legendEnabled",void 0);a.__decorate([d.property(v.popupEnabled)],y.prototype,"popupEnabled",void 0);a.__decorate([d.property({type:q})],y.prototype,"spatialReference",void 0);a.__decorate([d.property()],y.prototype,"version",void 0);a.__decorate([e.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],y.prototype,"readVersion",null);return y=a.__decorate([f.subclass("esri.layers.mixins.ArcGISMapService")],y)};Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/Error ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/PropertyOrigin ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/Extent ../../geometry ../../core/Collection ./fieldUtils ../../core/Identifiable ../../PopupTemplate ../../request ../../core/Loadable ../../chunks/symbols ../../renderers/Renderer ../../renderers/ClassBreaksRenderer ../../renderers/UniqueValueRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/SimpleRenderer ../../renderers/support/types ../../renderers/support/jsonUtils ../../core/MultiOriginJSONSupport ./Field ./FieldsIndex ./LabelClass ./FeatureType ./source/MapLayerSource ../../chunks/DataLayerSource ../../support/popupUtils ../../tasks/support/Query ../../core/HandleOwner".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q,F,N,P,U,V,W,X,ca,R,aa){function ka(la){return la&&"esriSMS"===la.type}function da(la,qa,na){var oa;return{ignoreOrigin:!0,enabled:na?"map-image"===(null==(oa=na.layer)?void 0:oa.type)&&(na.writeSublayerStructure||this.originIdOf(qa)>=v.nameToId(na.origin)):!1}}function fa(la,qa,na){var oa;return{enabled:na?"tile"===(null==(oa=na.layer)?void 0:oa.type)&&this._isOverridden(qa):!1}}function ea(la,qa,na){return{ignoreOrigin:!0,
enabled:na&&na.writeSublayerStructure||!1}}function Y(la,qa,na){return{ignoreOrigin:!0,enabled:na?na.writeSublayerStructure||this.originIdOf(qa)>=v.nameToId(na.origin):!1}}var Z;const ba=h.getLogger("esri.layers.support.Sublayer");let ia=0;const ja=new Set;ja.add("layer");ja.add("parent");ja.add("loaded");ja.add("loadStatus");ja.add("loadError");ja.add("loadWarnings");r=Z=function(la){function qa(oa){oa=la.call(this,oa)||this;oa.capabilities=void 0;oa.fields=null;oa.fullExtent=null;oa.globalIdField=
null;oa.legendEnabled=!0;oa.objectIdField=null;oa.popupEnabled=!0;oa.popupTemplate=null;oa.sourceJSON=null;oa.title=null;oa.typeIdField=null;oa.types=null;return oa}k._inheritsLoose(qa,la);var na=qa.prototype;na.load=async function(oa){this.addResolvingPromise((async()=>{var ua;if(!this.layer&&!this.url)throw new q("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:this});let za=null;if(!this.layer||2<this.originIdOf("url")||"data-layer"===(null==(ua=this.source)?
void 0:ua.type))za=(await E(this.url,{responseType:"json",query:{f:"json"},...oa})).data;else{var Fa;ua=this.id;"map-layer"===(null==(Fa=this.source)?void 0:Fa.type)&&(ua=this.source.mapLayerId);za=await this.layer.fetchSublayerInfo(ua,oa)}za&&(this.sourceJSON=za,this.read({layerDefinition:za},{origin:"service"}))})());return this};na.readCapabilities=function(oa,ua){ua=ua.layerDefinition||ua;oa=(oa=ua.capabilities||oa)?oa.toLowerCase().split(",").map(za=>za.trim()):[];return{exportMap:{supportsModification:!!ua.canModifyLayer},
operations:{supportsQuery:-1!==oa.indexOf("query")}}};na.readGlobalIdFieldFromService=function(oa,ua){ua=ua.layerDefinition||ua;if(ua.globalIdField)return ua.globalIdField;if(ua.fields)for(const za of ua.fields)if("esriFieldTypeGlobalID"===za.type)return za.name};na.writeLabelingInfo=function(oa,ua,za,Fa){oa&&oa.length&&(ua.layerDefinition={drawingInfo:{labelingInfo:oa.map(La=>La.write({},Fa))}})};na.readMinScale=function(oa,ua){return ua.minScale||ua.layerDefinition&&ua.layerDefinition.minScale||
0};na.readMaxScale=function(oa,ua){return ua.maxScale||ua.layerDefinition&&ua.layerDefinition.maxScale||0};na.readObjectIdFieldFromService=function(oa,ua){ua=ua.layerDefinition||ua;if(ua.objectIdField)return ua.objectIdField;if(ua.fields)for(const za of ua.fields)if("esriFieldTypeOID"===za.type)return za.name};na.readOpacity=function(oa,ua){oa=ua.layerDefinition;return 1-.01*(null!=oa.transparency?oa.transparency:oa.drawingInfo.transparency)};na.writeOpacity=function(oa,ua,za,Fa){ua.layerDefinition=
{drawingInfo:{transparency:100-100*oa}}};na.writeParent=function(oa,ua){ua.parentLayerId=this.parent&&this.parent!==this.layer?d.ensureInteger(this.parent.id):-1};na.castSublayers=function(oa){return d.ensureType(z.ofType(Z),oa)};na.writeSublayers=function(oa,ua,za){this.get("sublayers.length")&&(ua[za]=this.sublayers.map(Fa=>Fa.id).toArray().reverse())};na.readTypeIdField=function(oa,ua){ua=ua.layerDefinition||ua;if(oa=ua.typeIdField)if(ua=A.getField(ua.fields,oa))return ua.name;return null};na.writeVisible=
function(oa,ua,za,Fa){ua[za]=this.getAtOrigin("defaultVisibility","service")||oa};na.clone=function(){const {store:oa}=c.getProperties(this),ua=new Z;c.getProperties(ua).store=oa.clone(ja);this.url;ua._lastParsedUrl=this._lastParsedUrl;return ua};na.createPopupTemplate=function(oa){return ca.createPopupTemplate(this,oa)};na.createQuery=function(){return new R({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};na.createFeatureLayer=async function(){var oa,ua;if(this.hasOwnProperty("sublayers"))return null;
const za=null==(oa=this.layer)?void 0:oa.parsedUrl;oa=new (await new Promise(function(Fa,La){b(["../FeatureLayer"],function(Sa){Fa(Object.freeze({__proto__:null,"default":Sa}))},La)})).default({url:za.path});za&&this.source&&("map-layer"===this.source.type?oa.layerId=this.source.mapLayerId:oa.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&(oa.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(oa.definitionExpression=this.definitionExpression);2<this.originIdOf("labelingInfo")&&
(oa.labelingInfo=l.clone(this.labelingInfo));0<this.originIdOf("labelsVisible")&&(oa.labelsVisible=this.labelsVisible);0<this.originIdOf("legendEnabled")&&(oa.legendEnabled=this.legendEnabled);0<this.originIdOf("visible")&&(oa.visible=this.visible);0<this.originIdOf("minScale")&&(oa.minScale=this.minScale);0<this.originIdOf("maxScale")&&(oa.maxScale=this.maxScale);0<this.originIdOf("opacity")&&(oa.opacity=this.opacity);0<this.originIdOf("popupTemplate")&&(oa.popupTemplate=l.clone(this.popupTemplate));
2<this.originIdOf("renderer")&&(oa.renderer=l.clone(this.renderer));"data-layer"===(null==(ua=this.source)?void 0:ua.type)&&(oa.dynamicDataSource=this.source.clone());0<this.originIdOf("title")&&(oa.title=this.title);"map-image"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(oa.customParameters=this.layer.customParameters);"tile"===this.layer.type&&0<this.layer.originIdOf("customParameters")&&(oa.customParameters=this.layer.customParameters);return oa};na.getFeatureType=function(oa){const {typeIdField:ua,
types:za}=this;if(!ua||!oa)return null;const Fa=oa.attributes?oa.attributes[ua]:void 0;if(null==Fa)return null;let La=null;za.some(Sa=>{const {id:Ia}=Sa;if(null==Ia)return!1;Ia.toString()===Fa.toString()&&(La=Sa);return!!La});return La};na.getFieldDomain=function(oa,ua){return(ua=this.getFeatureType(ua&&ua.feature))&&(ua=ua.domains&&ua.domains[oa])&&"inherited"!==ua.type?ua:this._getLayerDomain(oa)};na.queryFeatures=function(oa=this.createQuery(),ua){return this.load().then(()=>{if(!this.get("capabilities.operations.supportsQuery"))throw new q("Sublayer.queryFeatures",
"this layer doesn't support queries.");return B.all([new Promise(function(za,Fa){b(["../../tasks/operations/query"],za,Fa)}),new Promise(function(za,Fa){b(["../../tasks/support/FeatureSet"],function(La){za(Object.freeze({__proto__:null,"default":La}))},Fa)})])}).then(([{executeQuery:za},{default:Fa}])=>za(this.url,R.from(oa),this.layer?this.layer.spatialReference:null,{...ua,query:{...this.layer.customParameters}}).then(La=>Fa.fromJSON(La.data))).then(za=>{za&&za.features&&za.features.forEach(Fa=>
{Fa.sourceLayer=this});return za})};na.toExportImageJSON=function(){var oa;const ua={id:this.id,source:(null==(oa=this.source)?void 0:oa.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};this.definitionExpression&&(ua.definitionExpression=this.definitionExpression);const za=["renderer","labelingInfo","opacity","labelsVisible"].reduce((Fa,La)=>{Fa[La]=this.originIdOf(La);return Fa},{});Object.keys(za).some(Fa=>2<za[Fa])&&(oa=ua.drawingInfo={},2<za.renderer&&(oa.renderer=this.renderer?this.renderer.toJSON():
null),2<za.labelsVisible&&(oa.showLabels=this.labelsVisible),this.labelsVisible&&2<za.labelingInfo&&(oa.labelingInfo=this.labelingInfo?this.labelingInfo.map(Fa=>Fa.write({},{origin:"service"})):null,oa.showLabels=!0),2<za.opacity&&(oa.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(oa.renderer));return ua};na._assignDefaultSymbolColors=function(oa){this._forEachSimpleMarkerSymbols(oa,ua=>{ua.color||"esriSMSX"!==ua.style&&"esriSMSCross"!==ua.style||(ua.color=ua.outline&&ua.outline.color?
ua.outline.color:[0,0,0,0])})};na._forEachSimpleMarkerSymbols=function(oa,ua){if(oa){const za="uniqueValueInfos"in oa?oa.uniqueValueInfos:"classBreakInfos"in oa?oa.classBreakInfos:[];for(const Fa of za)ka(Fa.symbol)&&ua(Fa.symbol);"symbol"in oa&&ka(oa.symbol)&&ua(oa.symbol);"defaultSymbol"in oa&&ka(oa.defaultSymbol)&&ua(oa.defaultSymbol)}};na._setAndNotifyLayer=function(oa,ua){const za=this.layer,Fa=this._get(oa);let La,Sa;switch(oa){case "definitionExpression":La="supportsSublayerDefinitionExpression";
case "minScale":case "maxScale":case "visible":La="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":La="supportsDynamicLayers",Sa="supportsModification"}const Ia=c.getProperties(this).getDefaultOrigin();if("service"!==Ia){if(La&&!1===this.get(`layer.capabilities.exportMap.${La}`)){this._logLockedError(oa,`capability not available 'layer.capabilities.exportMap.${La}'`);return}if(Sa&&!1===this.get(`capabilities.exportMap.${Sa}`)){this._logLockedError(oa,
`capability not available 'capabilities.exportMap.${Sa}'`);return}}"source"===oa&&"not-loaded"!==this.loadStatus?this._logLockedError(oa,"'source' can't be changed after calling sublayer.load()"):(this._set(oa,ua),"service"!==Ia&&Fa!==ua&&za&&za.emit&&za.emit("sublayer-update",{propertyName:oa,target:this}))};na._handleSublayersChange=function(oa,ua){ua&&(ua.forEach(za=>{za.parent=null;za.layer=null}),this.handles.removeAll());oa&&(oa.forEach(za=>{za.parent=this;za.layer=this.layer}),this.handles.add([oa.on("after-add",
({item:za})=>{za.parent=this;za.layer=this.layer}),oa.on("after-remove",({item:za})=>{za.parent=null;za.layer=null}),oa.on("before-changes",za=>{const Fa=this.get("layer.capabilities.exportMap.supportsSublayersChanges");null==Fa||Fa||(ba.error(new q("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),za.preventDefault())})]))};na._logLockedError=function(oa,ua){ba.error(new q("sublayer:locked",`Property '${oa}' can't be changed on Sublayer from the layer '${this.layer.id}'`,
{reason:ua,sublayer:this,layer:this.layer}))};na._getLayerDomain=function(oa){return(oa=this.fieldsIndex.get(oa))?oa.domain:null};k._createClass(qa,[{key:"definitionExpression",set:function(oa){this._setAndNotifyLayer("definitionExpression",oa)}},{key:"fieldsIndex",get:function(){return new P(this.fields||[])}},{key:"id",get:function(){const oa=this._get("id");return null==oa?ia++:oa},set:function(oa){this._get("id")!==oa&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id",
"capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",oa))}},{key:"labelingInfo",set:function(oa){this._setAndNotifyLayer("labelingInfo",oa)}},{key:"labelsVisible",set:function(oa){this._setAndNotifyLayer("labelsVisible",oa)}},{key:"layer",set:function(oa){this._set("layer",oa);this.sublayers&&this.sublayers.forEach(ua=>ua.layer=oa)}},{key:"listMode",set:function(oa){this._set("listMode",oa)}},{key:"minScale",set:function(oa){this._setAndNotifyLayer("minScale",
oa)}},{key:"maxScale",set:function(oa){this._setAndNotifyLayer("maxScale",oa)}},{key:"opacity",set:function(oa){this._setAndNotifyLayer("opacity",oa)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(oa){if(oa)for(const ua of oa.getSymbols())if(H.isSymbol3D(ua)){ba.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",oa)}},{key:"source",get:function(){return this._get("source")||new W.MapLayerSource({mapLayerId:this.id})},
set:function(oa){this._setAndNotifyLayer("source",oa)}},{key:"sublayers",set:function(oa){this._handleSublayersChange(oa,this._get("sublayers"));this._set("sublayers",oa)}},{key:"url",get:function(){var oa,ua;const za=null!=(oa=null==(ua=this.layer)?void 0:ua.parsedUrl)?oa:this._lastParsedUrl;oa=this.source;if(!za)return null;this._lastParsedUrl=za;if("map-layer"===(null==oa?void 0:oa.type))return`${za.path}/${oa.mapLayerId}`;oa={layer:JSON.stringify({source:this.source})};return`${za.path}/dynamicLayer?${m.objectToQuery(oa)}`},
set:function(oa){oa?this._override("url",oa):this._clearOverride("url")}},{key:"visible",set:function(oa){this._setAndNotifyLayer("visible",oa)}}]);return qa}(aa.HandleOwnerMixin(F.MultiOriginJSONMixin(t.IdentifiableMixin(G))));r.test={isMapImageLayerOverridePolicy:la=>la===ea||la===da,isTileImageLayerOverridePolicy:la=>la===fa};a.__decorate([e.property({readOnly:!0})],r.prototype,"capabilities",void 0);a.__decorate([p.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],
r.prototype,"readCapabilities",null);a.__decorate([e.property({type:String,value:null,json:{read:{source:"layerDefinition.definitionExpression"},write:{target:"layerDefinition.definitionExpression",overridePolicy:da}}})],r.prototype,"definitionExpression",null);a.__decorate([e.property({type:[N],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],r.prototype,"fields",void 0);a.__decorate([e.property({readOnly:!0,dependsOn:["fields"]})],r.prototype,"fieldsIndex",null);a.__decorate([e.property({type:x,
json:{read:{source:"layerDefinition.extent"}}})],r.prototype,"fullExtent",void 0);a.__decorate([e.property({type:String})],r.prototype,"globalIdField",void 0);a.__decorate([p.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],r.prototype,"readGlobalIdFieldFromService",null);a.__decorate([e.property({type:d.Integer,json:{write:{ignoreOrigin:!0}}})],r.prototype,"id",null);a.__decorate([e.property({value:null,type:[U],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},
write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ea}}})],r.prototype,"labelingInfo",null);a.__decorate([w.writer("labelingInfo")],r.prototype,"writeLabelingInfo",null);a.__decorate([e.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ea}}})],r.prototype,"labelsVisible",null);a.__decorate([e.property({value:null})],r.prototype,"layer",null);a.__decorate([e.property({type:Boolean,
value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:Y}}})],r.prototype,"legendEnabled",void 0);a.__decorate([e.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],r.prototype,"listMode",null);a.__decorate([e.property({type:Number,value:0,json:{write:{overridePolicy:ea}}})],r.prototype,"minScale",null);a.__decorate([p.reader("minScale",["minScale","layerDefinition.minScale"])],
r.prototype,"readMinScale",null);a.__decorate([e.property({type:Number,value:0,json:{write:{overridePolicy:ea}}})],r.prototype,"maxScale",null);a.__decorate([p.reader("maxScale",["maxScale","layerDefinition.maxScale"])],r.prototype,"readMaxScale",null);a.__decorate([e.property({type:String})],r.prototype,"objectIdField",void 0);a.__decorate([p.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],r.prototype,"readObjectIdFieldFromService",null);a.__decorate([e.property({type:Number,
value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ea}}})],r.prototype,"opacity",null);a.__decorate([p.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],r.prototype,"readOpacity",null);a.__decorate([w.writer("opacity")],r.prototype,"writeOpacity",null);a.__decorate([e.property({json:{type:d.Integer,write:{target:"parentLayerId",allowNull:!0,overridePolicy:ea}}})],r.prototype,"parent",void 0);a.__decorate([w.writer("parent")],
r.prototype,"writeParent",null);a.__decorate([e.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(la,qa){return!qa.disablePopup}},write:{target:"disablePopup",overridePolicy:Y,writer(la,qa,na){qa[na]=!la}}}})],r.prototype,"popupEnabled",void 0);a.__decorate([e.property({type:D,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:Y}}})],r.prototype,"popupTemplate",void 0);a.__decorate([e.property({readOnly:!0,dependsOn:["fields","title"]})],r.prototype,"defaultPopupTemplate",
null);a.__decorate([e.property({types:O.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ea},origins:{"web-scene":{types:O.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ea}}}}})],r.prototype,"renderer",null);a.__decorate([e.property({types:{key:"type",base:null,typeMap:{"data-layer":X.DataLayerSource,"map-layer":W.MapLayerSource}},cast(la){if(la){if("mapLayerId"in la)return d.ensureClass(W.MapLayerSource,la);
if("dataSource"in la)return d.ensureClass(X.DataLayerSource,la)}return la},json:{name:"layerDefinition.source",write:{overridePolicy:ea}}})],r.prototype,"source",null);a.__decorate([e.property()],r.prototype,"sourceJSON",void 0);a.__decorate([e.property({value:null,json:{type:[d.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ea}}})],r.prototype,"sublayers",null);a.__decorate([f.cast("sublayers")],r.prototype,"castSublayers",null);a.__decorate([w.writer("sublayers")],r.prototype,
"writeSublayers",null);a.__decorate([e.property({type:String,json:{read:{source:"name"},write:{target:"name",allowNull:!0,overridePolicy:Y}}})],r.prototype,"title",void 0);a.__decorate([e.property({type:String})],r.prototype,"typeIdField",void 0);a.__decorate([p.reader("typeIdField",["layerDefinition.typeIdField"])],r.prototype,"readTypeIdField",null);a.__decorate([e.property({type:[V],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],r.prototype,"types",void 0);a.__decorate([e.property({type:String,
dependsOn:["layer","source"],json:{read:{source:"layerUrl"},write:{target:"layerUrl",overridePolicy:fa}}})],r.prototype,"url",null);a.__decorate([e.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:ea}}})],r.prototype,"visible",null);a.__decorate([w.writer("visible")],r.prototype,"writeVisible",null);return r=Z=a.__decorate([n.subclass("esri.layers.support.Sublayer")],r)})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/PropertyOrigin ../../portal/support/resourceExtension ../../core/Collection ../../core/CollectionFlattener ../support/Sublayer ../support/sublayerUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){function B(A,t){const D=[],E={};if(!A)return D;A.forEach(G=>{const H=new v;H.read(G,t);E[H.id]=H;null!=G.parentLayerId&&-1!==G.parentLayerId?(G=E[G.parentLayerId],G.sublayers||(G.sublayers=[]),G.sublayers.unshift(H)):D.unshift(H)});return D}function x(A,t){A&&A.forEach(D=>{t(D);D.sublayers&&D.sublayers.length&&x(D.sublayers,t)})}const C=l.getLogger("esri.layers.TileLayer"),z=m.ofType(v);b.SublayersOwner=A=>{A=function(t){function D(...G){var H=t.call(this,
...G)||this;H.allSublayers=new u({root:k._assertThisInitialized(H),rootCollectionNames:["sublayers"],getChildrenFunction(I){return I.sublayers}});H.sublayersSourceJSON={[2]:{},[3]:{},[4]:{},[5]:{}};H.watch("sublayers",(I,J)=>H._handleSublayersChange(I,J),!0);return H}k._inheritsLoose(D,t);var E=D.prototype;E.readSublayers=function(G,H){if(H&&G){var {sublayersSourceJSON:I}=this,J=w.nameToId(H.origin);if(!(2>J||(I[J]={context:H,visibleLayers:G.visibleLayers||I[J].visibleLayers,layers:G.layers||I[J].layers},
2<J))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:K,origin:L}=this.createSublayersForOrigin("web-document");G=d.getProperties(this);G.setDefaultOrigin(L);this._set("sublayers",new z(K));G.setDefaultOrigin("user")}}};E.findSublayerById=function(G){return this.allSublayers.find(H=>H.id===G)};E.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};E.createSublayersForOrigin=function(G){const H="web-document"===
G?w.nameToId("web-map"):w.nameToId(G);let I=2;G=this.sublayersSourceJSON[2].layers;let J=this.sublayersSourceJSON[2].context,K=null;var L=[3,4,5].filter(F=>F<=H);for(var S of L)L=this.sublayersSourceJSON[S],y.isSublayerOverhaul(L.layers)&&(I=S,G=L.layers,J=L.context,L.visibleLayers&&(K={visibleLayers:L.visibleLayers,context:L.context}));S=[3,4,5].filter(F=>F>I&&F<=H);let M=null;for(var T of S){const {layers:F,visibleLayers:N,context:P}=this.sublayersSourceJSON[T];F&&(M={layers:F,context:P});N&&(K=
{visibleLayers:N,context:P})}T=B(G,J);const O=new Map,Q=new Set;if(M)for(const F of M.layers)O.set(F.id,F);if(K)for(const F of K.visibleLayers)Q.add(F);x(T,F=>{M&&F.read(O.get(F.id),M.context);K&&F.read({defaultVisibility:Q.has(F.id)},K.context)});return{origin:w.idToName(I),sublayers:new z({items:T})}};E.read=function(G,H){t.prototype.read.call(this,G,H);this.readSublayers(G,H)};E._handleSublayersChange=function(G,H){H&&(H.forEach(I=>{I.parent=null;I.layer=null}),this.handles.remove("sublayers-owner"));
G&&(G.forEach(I=>{I.parent=this;I.layer=this}),this.handles.add([G.on("after-add",({item:I})=>{I.parent=this;I.layer=this}),G.on("after-remove",({item:I})=>{I.parent=null;I.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(G.on("before-changes",I=>{C.error(new g("tilelayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));I.preventDefault()}),"sublayers-owner"))};return D}(A);a.__decorate([c.property({readOnly:!0})],
A.prototype,"allSublayers",void 0);a.__decorate([c.property({readOnly:!0,type:m.ofType(v)})],A.prototype,"serviceSublayers",void 0);a.__decorate([c.property({value:null,type:z,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],A.prototype,"sublayers",void 0);a.__decorate([c.property({readOnly:!0})],A.prototype,"sublayersSourceJSON",void 0);return A=a.__decorate([f.subclass("esri.layers.mixins.SublayersOwner")],A)};b.forEachSublayer=x;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/support/sublayerUtils":function(){define(["exports"],
function(b){function k(a,r){if(!a||!a.length)return!0;r=r.slice().reverse().flatten(({sublayers:d})=>d&&d.toArray().reverse()).map(d=>d.id).toArray();if(a.length>r.length)return!1;let l=0;const h=r.length;for(const {id:d}of a){for(;l<h&&r[l]!==d;)l++;if(l>=h)return!1}return!0}b.isExportDynamic=function(a,r,l){return a.some(h=>{const d=h.source;return!(!d||"map-layer"===d.type&&d.mapLayerId===h.id&&(!d.gdbVersion||d.gdbVersion===l.gdbVersion))||2<h.originIdOf("renderer")||2<h.originIdOf("labelingInfo")||
2<h.originIdOf("opacity")||2<h.originIdOf("labelsVisible")})?!0:!k(a,r)};b.isSublayerOverhaul=function(a){return!!a&&a.some(r=>null!=r.minScale||r.layerDefinition&&null!=r.layerDefinition.minScale)};b.shouldWriteSublayerStructure=function(a,r,l){return r.flatten(({sublayers:h})=>h).length!==a.length||a.some(h=>h.originIdOf("minScale")>l||h.originIdOf("maxScale")>l||h.originIdOf("renderer")>l||h.originIdOf("labelingInfo")>l||h.originIdOf("opacity")>l||h.originIdOf("labelsVisible")>l||h.originIdOf("source")>
l)?!0:!k(a,r)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/VectorTileLayer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/global ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ../geometry/SpatialReference ../geometry/Extent ../request ./Layer ../core/MultiOriginJSONSupport ./mixins/OperationalLayer ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/TileInfo ./support/TilemapCache ./mixins/ArcGISCachedService ./support/imageUtils ./support/SpriteSource ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/2d/engine/vectorTiles/SchemaHelper ../views/2d/engine/vectorTiles/tileInfoUtils ../views/2d/engine/vectorTiles/style/StyleRepository ../views/webgl/capabilities".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q){r=function(F){function N(...U){U=F.call(this,...U)||this;U._spriteSourceMap=new Map;U.currentStyleInfo=null;U.style=null;U.isReference=null;U.operationalLayerType="VectorTileLayer";U.type="vector-tile";U.url=null;return U}b._inheritsLoose(N,F);var P=N.prototype;P.normalizeCtorArgs=function(U,V){return"string"===typeof U?{url:U,...V}:U};P.destroy=function(){this._spriteSourceMap.clear()};P.prefetchResources=async function(U){await this.loadSpriteSource(a.devicePixelRatio||
1,U)};P.load=function(U){const V=this.loadFromPortal({supportedTypes:["Vector Tile Service"],supportsData:!1},U).then(async()=>{if(this.portalItem&&this.portalItem.id){var W=`${this.portalItem.itemUrl}/resources/styles/root.json`;(await B(W,{...U,query:{f:"json"}})).data&&this.read({url:W},S.createForItem(this.portalItem))}}).then(()=>this._loadStyle(U),()=>this._loadStyle(U));this.addResolvingPromise(V);return u.resolve(this)};P.writeStyleUrl=function(U,V){U&&w.isProtocolRelative(U)&&(U=`https:${U}`);
V.styleUrl=U};P.readVersion=function(U,V){return V.version?parseFloat(V.version):parseFloat(V.currentVersion)};P.loadSpriteSource=async function(U=1,V){if(!this._spriteSourceMap.has(U)){var W=Q();W=new K(this.styleRepository.sprite,U,W.maxTextureSize,this.currentStyleInfo.spriteFormat);await W.load(V);this._spriteSourceMap.set(U,W)}return u.resolve(this._spriteSourceMap.get(U))};P.loadStyle=async function(U,V){const W=U||this.style||this.url;if(this._loadingPromise&&"string"===typeof W&&this.url===
W&&!u.isAborted(this._abortController))return this._loadingPromise;(U=this._abortController)&&U.abort();const X=u.createAbortController();this._loadingPromise=u.create((ca,R)=>{const aa={signal:X.signal};this._spriteSourceMap.clear();this._getSourceAndStyle(W,aa).then(ca,R);u.onAbort(V,()=>{X.abort()})});this._abortController=X;return this._loadingPromise};P.getStyleLayerId=function(U){return this.styleRepository.getStyleLayerId(U)};P.getStyleLayerIndex=function(U){return this.styleRepository.getStyleLayerIndex(U)};
P.getPaintProperties=function(U){return l.clone(this.styleRepository.getPaintProperties(U))};P.setPaintProperties=function(U,V){const W=this.styleRepository.isPainterDataDriven(U);this.styleRepository.setPaintProperties(U,V);const X=this.styleRepository.isPainterDataDriven(U);this.emit("paint-change",{layerName:U,paint:V,isDataDriven:W||X})};P.getStyleLayer=function(U){return l.clone(this.styleRepository.getStyleLayer(U))};P.setStyleLayer=function(U,V){this.styleRepository.setStyleLayer(U,V);this.emit("style-layer-change",
{layer:U,index:V})};P.deleteStyleLayer=function(U){this.styleRepository.deleteStyleLayer(U);this.emit("delete-style-layer",{layerName:U})};P.getLayoutProperties=function(U){return l.clone(this.styleRepository.getLayoutProperties(U))};P.setLayoutProperties=function(U,V){this.styleRepository.setLayoutProperties(U,V);this.emit("layout-change",{layer:U,layout:V})};P.setStyleLayerVisibility=function(U,V){this.styleRepository.setStyleLayerVisibility(U,V);this.emit("style-layer-visibility-change",{layer:U,
visibility:V})};P.getStyleLayerVisibility=function(U){return this.styleRepository.getStyleLayerVisibility(U)};P.getTileUrl=function(U,V,W){let X=this.tileServers[V%this.tileServers.length];return X=X.replace(/\{z\}/gi,U.toString()).replace(/\{y\}/gi,V.toString()).replace(/\{x\}/gi,W.toString())};P.write=function(U,V){return V&&V.origin&&!this.styleUrl?(V.messages&&V.messages.push(new n("vectortilelayer:unsupported",`VectorTileLayer (${this.title}, ${this.id}) with style defined by JSON only are not supported`,
{layer:this})),null):F.prototype.write.call(this,U,V)};P._getSourceAndStyle=async function(U,V){if(!U)throw Error("invalid style!");V=await L.loadMetadata(U,V);"webp"!==V.spriteFormat||await J.checkWebPSupport("lossy")||(V.spriteFormat="png");this._set("currentStyleInfo",{...V});"string"===typeof U?(this.url=U,this.style=null):(this.url=null,this.style=U);this._set("sourceNameToSource",V.sourceNameToSource);this._set("primarySourceName",V.primarySourceName);this._set("styleRepository",new O(V.style,
V));this.read(V.layerDefinition,{origin:"service"});this.emit("load-style",{})};P._getDefaultAttribution=function(U){var V=U.match(/^https?:\/\/(?:basemaps|basemapsbeta|basemapsdev)(?:-api)?\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);U="OpenStreetMap_v2 OpenStreetMap_Daylight_v2 OpenStreetMap_Export_v2 OpenStreetMap_FTS_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84 World_Contours_v2".split(" ");
if(V){var W=V[2]&&V[2].toLowerCase();if(W){V=V[1]||"";for(const X of U)if(-1<X.toLowerCase().indexOf(W))return w.normalize(`//static.arcgis.com/attribution/Vector${V}/${X}`)}}};P._getPrimarySource=function(){return this.sourceNameToSource&&this.primarySourceName in this.sourceNameToSource?this.sourceNameToSource[this.primarySourceName]:null};P._loadStyle=async function(U){return this._loadingPromise?this._loadingPromise:this.loadStyle(null,U)};b._createClass(N,[{key:"attributionDataUrl",get:function(){var U=
this.currentStyleInfo;return(U=U&&U.serviceUrl&&w.urlToObject(U.serviceUrl))?this._getDefaultAttribution(U.path):null}},{key:"capabilities",get:function(){const U=this._getPrimarySource();return U?U.capabilities:{operations:{supportsExportTiles:!1,supportsTileMap:!1},exportTiles:null}}},{key:"fullExtent",get:function(){const U=this._getPrimarySource();return U?U.fullExtent:null}},{key:"parsedUrl",get:function(){return this.serviceUrl?w.urlToObject(this.serviceUrl):null}},{key:"serviceUrl",get:function(){return this.currentStyleInfo&&
this.currentStyleInfo.serviceUrl||null}},{key:"spatialReference",get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null}},{key:"styleUrl",get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null}},{key:"tileIndexType",get:function(){const U=this._getPrimarySource();return U?U.type:""}},{key:"tileIndexUrl",get:function(){const U=this._getPrimarySource();return U?U.tileMapURL:""}},{key:"tileInfo",get:function(){var U;const V=[];for(var W in this.sourceNameToSource)V.push(this.sourceNameToSource[W]);
W=(null==(U=this._getPrimarySource())?void 0:U.tileInfo)||new G;if(1<V.length)for(U=0;U<V.length;U++)T.areSchemasOverlapping(W,V[U].tileInfo)&&(W=T.unionTileInfos(W,V[U].tileInfo));return W}},{key:"tilemapCache",get:function(){const U=this._getPrimarySource();return U?U.capabilities.operations.supportsTileMap?U.tilemapCache:null:null}},{key:"tileServers",get:function(){const U=this._getPrimarySource();return U?U.tileServers:[]}},{key:"compatibleTileInfo256",get:function(){return M.create256x256CompatibleTileInfo(this.tileInfo)}},
{key:"compatibleTileInfo512",get:function(){return M.create512x512CompatibleTileInfo(this.tileInfo)}}]);return N}(t.BlendLayer(E.ScaleRangeLayer(I.ArcGISCachedService(A.ArcGISService(z.OperationalLayer(D.PortalLayer(C.MultiOriginJSONMixin(x))))))));k.__decorate([c.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],r.prototype,"attributionDataUrl",null);k.__decorate([c.property({type:["show","hide"]})],r.prototype,"listMode",void 0);k.__decorate([c.property({readOnly:!0,dependsOn:["sourceNameToSource",
"primarySourceName"],autoTracked:!1,json:{read:!1}})],r.prototype,"capabilities",null);k.__decorate([c.property({readOnly:!0})],r.prototype,"currentStyleInfo",void 0);k.__decorate([c.property({json:{read:!1},readOnly:!0,type:y,dependsOn:["sourceNameToSource","primarySourceName"]})],r.prototype,"fullExtent",null);k.__decorate([c.property()],r.prototype,"style",void 0);k.__decorate([c.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],r.prototype,"isReference",
void 0);k.__decorate([c.property({type:["VectorTileLayer"]})],r.prototype,"operationalLayerType",void 0);k.__decorate([c.property({readOnly:!0,dependsOn:["serviceUrl"]})],r.prototype,"parsedUrl",null);k.__decorate([c.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],r.prototype,"serviceUrl",null);k.__decorate([c.property({type:v,dependsOn:["tileInfo"],readOnly:!0})],r.prototype,"spatialReference",null);k.__decorate([c.property({readOnly:!0})],r.prototype,"styleRepository",void 0);k.__decorate([c.property({readOnly:!0})],
r.prototype,"sourceNameToSource",void 0);k.__decorate([c.property({readOnly:!0})],r.prototype,"primarySourceName",void 0);k.__decorate([c.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],r.prototype,"styleUrl",null);k.__decorate([p.writer(["portal-item","web-document"],"styleUrl")],r.prototype,"writeStyleUrl",null);k.__decorate([c.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource",
"primarySourceName"]})],r.prototype,"tileIndexType",null);k.__decorate([c.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],r.prototype,"tileIndexUrl",null);k.__decorate([c.property({json:{read:!1,origins:{service:{read:!1}}},readOnly:!0,type:G,dependsOn:["sourceNameToSource","primarySourceName"]})],r.prototype,"tileInfo",null);k.__decorate([c.property({json:{read:!1},readOnly:!0,type:H.TilemapCache,dependsOn:["sourceNameToSource","primarySourceName"]})],
r.prototype,"tilemapCache",null);k.__decorate([c.property({json:{read:!1},readOnly:!0,dependsOn:["sourceNameToSource","primarySourceName"]})],r.prototype,"tileServers",null);k.__decorate([c.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],r.prototype,"type",void 0);k.__decorate([c.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],r.prototype,"url",void 0);k.__decorate([c.property({readOnly:!0})],r.prototype,"version",
void 0);k.__decorate([f.reader("version",["version","currentVersion"])],r.prototype,"readVersion",null);k.__decorate([c.property({readOnly:!0,dependsOn:["tileInfo"]})],r.prototype,"compatibleTileInfo256",null);k.__decorate([c.property({readOnly:!0,dependsOn:["tileInfo"]})],r.prototype,"compatibleTileInfo512",null);return r=k.__decorate([g.subclass("esri.layers.VectorTileLayer")],r)})},"esri/layers/support/imageUtils":function(){define(["exports"],function(b){b.checkWebPSupport=function(k){const a=
{lossy:"UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",lossless:"UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA\x3d\x3d",alpha:"UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA\x3d\x3d",animation:"UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"};return new Promise(r=>{const l=new Image;l.onload=()=>{l.onload=l.onerror=null;r(0<l.width&&0<l.height)};l.onerror=
()=>{l.onload=l.onerror=null;r(!1)};l.src="data:image/webp;base64,"+a[k]})};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/support/SpriteSource":function(){define("../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/Error ../../core/urlUtils ../../core/promiseUtils ../../request".split(" "),function(b,k,a,r,l,h){const d=k.getLogger("esri.layers.support.SpriteSource");return function(){function c(f,g,p,n){this.baseURL=f;this.devicePixelRatio=g;this.maxTextureSize=
p;this._spriteImageFormat=n;this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;this.loadStatus="not-loaded"}var e=c.prototype;e.getSpriteInfo=function(f){return this._spritesData[f]};e.load=async function(f){if(this.baseURL){this.loadStatus="loading";try{await this._loadSprites(f),this.loadStatus="loaded"}catch{this.loadStatus="failed"}}else this.loadStatus="failed"};e._loadSprites=function(f){this._isRetina=1.15<this.devicePixelRatio?!0:!1;const g=r.urlToObject(this.baseURL),
p=g.query?"?"+r.objectToQuery(g.query):"",n=this._isRetina?"@2x":"",w=`${g.path}${n}.${this._spriteImageFormat}${p}`;return l.all([h(`${g.path}${n}.json${p}`,f),h(w,{responseType:"image",...f})]).then(([q,m])=>{var u=Object.keys(q.data);if(!u||0===u.length||1===u.length&&"_ssl"===u[0]||!m||!m.data)return this._spritesData=this.image=null,this.width=this.height=0,l.resolve(null);this._spritesData=q.data;q=m.data;m=Math.max(this.maxTextureSize,4096);if(q.width>m||q.height>m)throw q=`Sprite resource for style ${g.path} is bigger than the maximum allowed of ${m} pixels}`,
d.error(q),new a("SpriteSource",q);this.width=q.width;this.height=q.height;m=document.createElement("canvas");u=m.getContext("2d");m.width=q.width;m.height=q.height;u.drawImage(q,0,0,q.width,q.height);q=u.getImageData(0,0,q.width,q.height);q=new Uint8Array(q.data);for(u=0;u<q.length;u+=4)m=q[u+3]/255,q[u]*=m,q[u+1]*=m,q[u+2]*=m;this.image=q})};b._createClass(c,[{key:"spriteNames",get:function(){const f=[];for(const g in this._spritesData)f.push(g);f.sort();return f}}]);return c}()})},"esri/layers/support/vectorTileLayerLoader":function(){define("exports ../../config ../../core/urlUtils ../../core/promiseUtils ../../request ../../views/2d/engine/vectorTiles/style/VectorTileSource".split(" "),
function(b,k,a,r,l,h){function d(n){n&&(n=a.getOrigin(n),p&&-1===p.indexOf(n)&&p.push(n))}function c(...n){let w=void 0;for(let q=0;q<n.length;++q)a.isProtocolRelative(n[q])?w&&(w=w.split("://")[0]+":"+n[q].trim()):w=a.isAbsolute(n[q])?n[q]:a.join(w,n[q]);return a.removeTrailingSlash(w)}async function e(n,w,q,m,u){r.throwIfAborted(u);if("string"===typeof q){m=a.normalize(q);d(m);var v=a.urlToObject(m);v=await l(v.path,{query:{f:"json"},responseType:"json",...u});q=m}else v={data:q},q=q.jsonUrl||null;
const y=v.data;v.ssl&&(q&&(q=q.replace(/^http:/i,"https:")),m&&(m=m.replace(/^http:/i,"https:")));return y.sources?(n.styleUrl=q||null,f(n,y,m,u)):y.sources?r.reject("You must specify the URL or the JSON for a service or for a style."):n.sourceUrl?g(n,y,m,!1,w,u):(n.sourceUrl=q||null,g(n,y,m,!0,w,u))}async function f(n,w,q,m){q=q?a.removeFile(q):a.appBaseUrl;n.styleBase=q;n.style=w;n.styleUrl&&d(n.styleUrl);w["sprite-format"]&&"webp"===w["sprite-format"].toLowerCase()&&(n.spriteFormat="webp");const u=
[];if(w.sources&&w.sources.esri){const v=w.sources.esri;v.url?await e(n,"esri",c(q,v.url),void 0,m):u.push(e(n,"esri",v,q,m))}for(const v of Object.keys(w.sources))"esri"!==v&&"vector"===w.sources[v].type&&(w.sources[v].url?u.push(e(n,v,c(q,w.sources[v].url),void 0,m)):u.push(e(n,v,w.sources[v],q,m)));await r.all(u)}async function g(n,w,q,m,u,v){q=q?a.removeTrailingSlash(q)+"/":a.appBaseUrl;if(w.hasOwnProperty("tileInfo"))var y=w;else{var B={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,
ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},x=78271.51696400007,C=2.958287637957775E8,z=[],A=w.hasOwnProperty("minzoom")?parseFloat(w.minzoom):0,t=w.hasOwnProperty("maxzoom")?parseFloat(w.maxzoom):22;for(let D=0;D<=t;D++)D>=A&&z.push({level:D,scale:C,resolution:x}),x/=2,C/=2;for(y of w.tiles)d(c(q,y));y={capabilities:"TilesOnly",initialExtent:B,fullExtent:B,minScale:0,maxScale:0,tiles:w.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},
lods:z,spatialReference:{wkid:102100}}}}B=new h(u,q,y);if(!m&&n.primarySourceName in n.sourceNameToSource){x=n.sourceNameToSource[n.primarySourceName];if(!x.isCompatibleWith(B))return r.resolve();null!=B.fullExtent&&(null!=x.fullExtent?x.fullExtent.union(B.fullExtent):x.fullExtent=B.fullExtent.clone());x.tileInfo.lods.length<B.tileInfo.lods.length&&(x.tileInfo=B.tileInfo)}m?(n.sourceBase=q,n.source=w,n.validatedSource=y,n.primarySourceName=u,n.sourceUrl&&d(n.sourceUrl)):d(q);n.sourceNameToSource[u]=
B;if(!n.style)return null==w.defaultStyles?r.reject():"string"===typeof w.defaultStyles?e(n,"",c(q,w.defaultStyles,"root.json"),void 0,v):e(n,"",w.defaultStyles,c(q,"root.json"),v)}const p=k.defaults&&k.defaults.io.corsEnabledServers;b.loadMetadata=async function(n,w){const q={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},[m,u]="string"===typeof n?[n,null]:[null,n.jsonUrl],v=m?
a.urlToObject(m):null;await e(q,"esri",n,u,w);n={layerDefinition:q.validatedSource,url:m,parsedUrl:v,serviceUrl:q.sourceUrl,style:q.style,styleUrl:q.styleUrl,spriteUrl:q.style.sprite&&c(q.styleBase,q.style.sprite),spriteFormat:q.spriteFormat,glyphsUrl:q.style.glyphs&&c(q.styleBase,q.style.glyphs),sourceNameToSource:q.sourceNameToSource,primarySourceName:q.primarySourceName};d(n.spriteUrl);d(n.glyphsUrl);return n};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/VectorTileSource":function(){define("../../../../../core/lang ../../../../../core/urlUtils ../../../../../core/promiseUtils ../../../../../geometry/Extent ../../../../../layers/support/serviceTileInfoProperty ../../../../../layers/support/TilemapCache ../TileIndex".split(" "),
function(b,k,a,r,l,h,d){return function(){function c(f,g,p){this.tileMapURL="";this.fullExtent=this.tileIndex=this.capabilities=this.tileInfo=this.parsedUrl=this.tilemapCache=null;this.name=f;if(this.sourceUrl=g)this.parsedUrl=k.urlToObject(this.sourceUrl);const n=this.parsedUrl.path,w=this.parsedUrl.query?"?"+k.objectToQuery(this.parsedUrl.query):"";f=b.clone(p);const q=f.tiles;g&&q.forEach((v,y)=>{k.isAbsolute(v)||(q[y]=k.join(n,v)+w)});this.tileServers=q;p.tileMap&&(this.tileMapURL=k.join(g,p.tileMap));
var m=p.capabilities&&p.capabilities.split(",").map(v=>v.toLowerCase().trim());g=!!p.exportTilesAllowed;m=!!m&&-1!==m.indexOf("tilemap");const u=g&&p.hasOwnProperty("maxExportTilesCount")?p.maxExportTilesCount:0;this.capabilities={operations:{supportsExportTiles:g,supportsTileMap:m},exportTiles:g?{maxExportTilesCount:+u}:null};this.tileInfo=l.readServiceTileInfo(f.tileInfo,f,null,{ignoreMinMaxLOD:!0});m&&(this.type="vector-tile",this.tilemapCache=new h.TilemapCache({layer:this}),this.tileIndex=new d(this.tilemapCache));
this.fullExtent=r.fromJSON(p.fullExtent)}var e=c.prototype;e.getRefKey=function(f,g){return this.tileIndex?this.tileIndex.dataKey(f,g):a.resolve(f)};e.getSourceTileUrl=function(f,g,p){let n=this.tileServers[g%this.tileServers.length];return n=n.replace(/\{z\}/gi,f.toString()).replace(/\{y\}/gi,g.toString()).replace(/\{x\}/gi,p.toString())};e.isCompatibleWith=function(f){var g=this.tileInfo;f=f.tileInfo;if(!g.spatialReference.equals(f.spatialReference)||!g.origin.equals(f.origin)||Math.round(g.dpi)!==
Math.round(f.dpi))return!1;g=g.lods;f=f.lods;const p=Math.min(g.length,f.length);for(let n=0;n<p;n++){const w=g[n],q=f[n];if(w.level!==q.level||Math.round(w.scale)!==Math.round(q.scale))return!1}return!0};return c}()})},"esri/views/2d/engine/vectorTiles/TileIndex":function(){define(["../../../../core/promiseUtils","../../../../layers/support/TilemapCache","../../tiling/TileKey"],function(b,k,a){return function(){function r(h){if(h instanceof k.TilemapCache)this._tilemapCache=h;else if(h&&"index"in
h)this._tilemap=h.index;else throw Error("Invalid tilemap!");}var l=r.prototype;l.dataKey=function(h,d){if(this._tilemapCache){const {level:c,row:e,col:f}=h,g=new a(h);return this._tilemapCache.fetchAvailabilityUpsample(c,e,f,g,d).then(()=>{g.world=h.world;return g}).catch(p=>{if(b.isAbortError(p))throw p;return null})}return this._getIndexedDataKey(h)};l.forEach=function(h,d,c,e,f){this._callback=f;this._maxLevel=d+h;this._forEach(this._tilemap,d,c,e)};l._forEach=function(h,d,c,e){0!==h&&(this._callback(d,
c,e),d!==this._maxLevel&&"object"===typeof h&&(this._forEach(h[0],d+1,2*c,2*e),this._forEach(h[1],d+1,2*c,2*e+1),this._forEach(h[2],d+1,2*c+1,2*e),this._forEach(h[3],d+1,2*c+1,2*e+1)))};l._getIndexedDataKey=function(h){const d=[h];if(0>h.level||0>h.row||0>h.col||0<h.row>>h.level||0<h.col>>h.level)return b.resolve(null);for(;0!==h.level;)h=new a(h.level-1,h.row>>1,h.col>>1,h.world),d.push(h);h=this._tilemap;let c=d.pop(),e,f;if(1===h)return b.resolve(c);for(;d.length;)if(e=d.pop(),f=(e.col&1)+((e.row&
1)<<1),h){if(0===h[f]){c=null;break}if(1===h[f]){c=e;break}c=e;h=h[f]}return b.resolve(c)};return r}()})},"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],function(b,k){let a=function(){function r(h,d,c,e){this.set(h,d,c,e)}r.getId=function(h,d,c,e){return"object"===typeof h?`${h.level}/${h.row}/${h.col}/${h.world}`:`${h}/${d}/${c}/${e}`};var l=r.prototype;l.acquire=function(h,d,c,e){this.set(h,d,c,e)};l.contains=function(h){const d=
h.level-this.level;return this.row===h.row>>d&&this.col===h.col>>d&&this.world===h.world};l.equals=function(h){return this.level===h.level&&this.row===h.row&&this.col===h.col&&this.world===h.world};l.clone=function(){return new r(this)};l.release=function(){this.world=this.col=this.row=this.level=0};l.set=function(h,d,c,e){if(null==h)this.world=this.col=this.row=this.level=0;else if("object"===typeof h)this.level=h.level||0,this.row=h.row||0,this.col=h.col||0,this.world=h.world||0;else if("string"===
typeof h){const [f,g,p,n]=h.split("/");this.level=parseFloat(f);this.row=parseFloat(g);this.col=parseFloat(p);this.world=parseFloat(n)}else this.level=+h,this.row=+d,this.col=+c,this.world=+e||0;return this};l.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};l.getParentKey=function(){return 0>=this.level?null:new r(this.level-1,this.row>>1,this.col>>1,this.world)};l.getChildKeys=function(){const h=this.level+1,d=this.row<<1,c=this.col<<1,e=this.world;return[new r(h,
d,c,e),new r(h,d,c+1,e),new r(h,d+1,c,e),new r(h,d+1,c+1,e)]};l.compareRowMajor=function(h){return this.row<h.row?-1:this.row>h.row?1:this.col<h.col?-1:this.col>h.col?1:0};b._createClass(r,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(h){this.set(h)}}]);return r}();a.pool=new k(a,null,null,25,50);return a})},"esri/portal/support/jsonContext":function(){define(["exports","../../core/urlUtils","../Portal"],function(b,k,a){b.createForItem=function(r){return{origin:"portal-item",
url:k.urlToObject(r.itemUrl),portal:r.portal||a.getDefault(),portalItem:r,readResourcePaths:[]}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/SchemaHelper":function(){define(["../../../../layers/support/LOD","../../../../layers/support/TileInfo"],function(b,k){return function(){function a(l,h){this.lockedSchemaPixelSize=l;this.isGCS=h}var r=a.prototype;r.getLevelRowColumn=function(l){return this.isGCS?[l[0],l[1]>>1,l[2]>>1]:256===this.lockedSchemaPixelSize&&
0<l[0]?[l[0]-1,l[1]>>1,l[2]>>1]:l};r.adjustLevel=function(l){return this.isGCS?l:256===this.lockedSchemaPixelSize?0<l?l-1:0:l};r.getShift=function(l,h){let d=0,c=0;if(256===this.lockedSchemaPixelSize||this.isGCS)l[2]%2&&(d=h),l[1]%2&&(c=h);return[d,c]};r.getScale=function(l){if(this.isGCS){if(512===this.lockedSchemaPixelSize)return 4}else if(256===this.lockedSchemaPixelSize&&0===l)return 1;return 2};a.create256x256CompatibleTileInfo=function(l){if(!l)return null;if(256===l.size[0]&&256===l.size[1])return l;
const h=l.spatialReference.isGeographic,d=[],c=l.lods.length;for(let e=0;e<c;e++){const f=l.lods[e];d.push(new b({level:f.level,scale:f.scale,resolution:h?f.resolution:2*f.resolution}))}return new k({size:[256,256],dpi:l.dpi,format:l.format,compressionQuality:l.compressionQuality,origin:l.origin,spatialReference:l.spatialReference,lods:d})};a.create512x512CompatibleTileInfo=function(l){if(!l||256===l.size[0]||256===l.size[1])return null;const h=[],d=l.lods.length;for(let c=0;c<d;c++){const e=l.lods[c];
h.push(new b({level:e.level,scale:e.scale,resolution:.5*e.resolution}))}return new k({size:[512,512],dpi:l.dpi,format:l.format,compressionQuality:l.compressionQuality,origin:l.origin,spatialReference:l.spatialReference,lods:h})};return a}()})},"esri/views/2d/engine/vectorTiles/tileInfoUtils":function(){define(["exports","../../../../layers/support/TileInfo"],function(b,k){b.areSchemasOverlapping=function(a,r){if(a===r)return!0;if(!a&&null!=r||null!=a&&!r||!a.spatialReference.equals(r.spatialReference)||
a.dpi!==r.dpi)return!1;var l=a.origin;const h=r.origin;if(1E-6<=Math.abs(l.x-h.x)||1E-6<=Math.abs(l.y-h.y))return!1;a.lods[0].scale>r.lods[0].scale?(l=a,a=r):l=r;for(r=l.lods[0].scale;r>=a.lods[a.lods.length-1].scale-1E-6;r/=2)if(1E-6>Math.abs(r-a.lods[0].scale))return!0;return!1};b.unionTileInfos=function(a,r){if(a===r)return a;if(!a&&null!=r)return r;if(null!=a&&!r)return a;const l=a.size[0],h=a.format,d=a.dpi,c={x:a.origin.x,y:a.origin.y},e=a.spatialReference.toJSON();var f=a.lods[0].scale>r.lods[0].scale?
a.lods[0]:r.lods[0];a=(a.lods[a.lods.length-1].scale<=r.lods[r.lods.length-1].scale?a.lods[a.lods.length-1]:r.lods[r.lods.length-1]).scale;r=[];let g=f.scale;f=f.resolution;let p=0;for(;g>a;)r.push({level:p,resolution:f,scale:g}),p++,g/=2,f/=2;return new k({size:[l,l],dpi:d,format:h||"pbf",origin:c,lods:r,spatialReference:e})};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["../../../../../core/has","./StyleLayer"],function(b,
k){return function(){function a(l,h){this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;l.layers||(l.layers=[]);this.version=parseFloat(l.version);this.sprite=h?h.spriteUrl:l.sprite;this.glyphs=h?h.glyphsUrl:l.glyphs;if(this.layers=l.layers.map((d,c,e)=>this._create(d,c,e)))for(h=0;h<this.layers.length;h++)l=this.layers[h],this._layerByName[l.id.toLowerCase()]=l,this._uidToLayer.set(l.uid,l),0===l.type&&this.backgroundBucketIds.push(l.id);this._identifyRefLayers()}
var r=a.prototype;r.isPainterDataDriven=function(l){return(l=this._layerByName[l.toLowerCase()])?l.isPainterDataDriven():!1};r.getStyleLayerId=function(l){return l>=this.layers.length?null:this.layers[l].id};r.getStyleLayerByUID=function(l){l=this._uidToLayer.get(l);return null!=l?l:null};r.getStyleLayerIndex=function(l){return(l=this._layerByName[l.toLowerCase()])?this.layers.indexOf(l):-1};r.setStyleLayer=function(l,h){if(l&&l.id){h&&h>=this.layers.length&&(h=this.layers.length-1);var d=!0,c;if(c=
this._layerByName[l.id.toLowerCase()]){const e=this.layers.indexOf(c);h||(h=e);h===e?(d=!1,c=a._recreateLayer(l,c),this.layers[h]=c):(this.layers.splice(e,1),c=this._create(l,h,this.layers),this.layers.splice(h,0,c))}else c=this._create(l,h,this.layers),!h||h>=this.layers.length?this.layers.push(c):this.layers.splice(h,0,c);this._layerByName[l.id.toLowerCase()]=c;this._uidToLayer.set(c.uid,c);d&&this._recomputeZValues();this._identifyRefLayers()}};r.getStyleLayer=function(l){return(l=this._layerByName[l.toLowerCase()])?
{type:l.typeName,id:l.id,source:l.source,"source-layer":l.sourceLayer,minzoom:l.minzoom,maxzoom:l.maxzoom,filter:l.filter,layout:l.layout,paint:l.paint}:null};r.deleteStyleLayer=function(l){const h=this._layerByName[l.toLowerCase()];h&&(delete this._layerByName[l.toLowerCase()],this._uidToLayer.delete(h.uid),l=this.layers.indexOf(h),this.layers.splice(l,1),this._recomputeZValues(),this._identifyRefLayers())};r.getLayerById=function(l){return this._layerByName[l.toLowerCase()]};r.getLayoutProperties=
function(l){return(l=this._layerByName[l.toLowerCase()])?l.layout:null};r.getPaintProperties=function(l){return(l=this._layerByName[l.toLowerCase()])?l.paint:null};r.setPaintProperties=function(l,h){l=this._layerByName[l.toLowerCase()];if(!l)return"";h=a._recreateLayer({type:l.typeName,id:l.id,source:l.source,"source-layer":l.sourceLayer,minzoom:l.minzoom,maxzoom:l.maxzoom,filter:l.filter,layout:l.layout,paint:h},l);const d=this.layers.indexOf(l);this.layers[d]=h;this._layerByName[l.id.toLowerCase()]=
h;this._uidToLayer.set(l.uid,h);return l.id};r.setLayoutProperties=function(l,h){l=this._layerByName[l.toLowerCase()];if(!l)return"";h=a._recreateLayer({type:l.typeName,id:l.id,source:l.source,"source-layer":l.sourceLayer,minzoom:l.minzoom,maxzoom:l.maxzoom,filter:l.filter,layout:h,paint:l.paint},l);const d=this.layers.indexOf(l);this.layers[d]=h;this._layerByName[l.id.toLowerCase()]=h;this._uidToLayer.set(l.uid,h);return l.id};r.setStyleLayerVisibility=function(l,h){if(l=this._layerByName[l.toLowerCase()]){var d=
l.layout||{};d.visibility=h;h=a._recreateLayer({type:l.typeName,id:l.id,source:l.source,"source-layer":l.sourceLayer,minzoom:l.minzoom,maxzoom:l.maxzoom,filter:l.filter,layout:d,paint:l.paint},l);d=this.layers.indexOf(l);this.layers[d]=h;this._layerByName[l.id.toLowerCase()]=h;this._uidToLayer.set(l.uid,h)}};r.getStyleLayerVisibility=function(l){var h;l=this._layerByName[l.toLowerCase()];if(!l)return"none";l=l.layout;return null!=(h=null==l?void 0:l.visibility)?h:"visible"};r._recomputeZValues=function(){const l=
this.layers,h=1/(l.length+1);for(let d=0;d<l.length;d++)l[d].z=1-(1+d)*h};r._identifyRefLayers=function(){const l=[],h=[];let d=0;for(const f of this.layers){if(1===f.type){var c=f,e=f.source+"|"+f.sourceLayer;e+="|"+JSON.stringify(f.layout&&f.layout.visibility);e+="|"+JSON.stringify(f.minzoom);e+="|"+JSON.stringify(f.maxzoom);e+="|"+JSON.stringify(f.filter);if(c.hasDataDrivenFill||c.hasDataDrivenOutline)e+="|"+JSON.stringify(d);l.push({key:e,layer:f})}2===f.type&&(c=f,e=f.source+"|"+f.sourceLayer,
e+="|"+JSON.stringify(f.layout&&f.layout.visibility),e+="|"+JSON.stringify(f.minzoom),e+="|"+JSON.stringify(f.maxzoom),e+="|"+JSON.stringify(f.filter),e+="|"+JSON.stringify(f.layout&&f.layout["line-cap"]),e+="|"+JSON.stringify(f.layout&&f.layout["line-join"]),c.hasDataDrivenLine&&(e+="|"+JSON.stringify(d)),h.push({key:e,layer:f}));++d}this._assignRefLayers(l);this._assignRefLayers(h)};r._assignRefLayers=function(l){l.sort((e,f)=>e.key<f.key?-1:e.key>f.key?1:0);let h,d;const c=l.length;for(let e=0;e<
c;e++){const f=l[e];if(f.key===h)f.layer.refLayerId=d;else if(h=f.key,d=f.layer.id,1===f.layer.type&&!f.layer.getPaintProperty("fill-outline-color"))for(let g=e+1;g<c;g++){const p=l[g];if(p.key===h){if(p.layer.getPaintProperty("fill-outline-color")){l[e]=p;l[g]=f;d=p.layer.id;break}}else break}}};r._create=function(l,h,d){h=1-1/(d.length+1)*(1+h);d=this._runningId++;switch(l.type){case "background":return new k.BackgroundStyleLayer(0,l,h,d);case "fill":return new k.FillStyleLayer(1,l,h,d);case "line":return new k.LineStyleLayer(2,
l,h,d);case "symbol":return new k.SymbolStyleLayer(3,l,h,d);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new k.CircleStyleLayer(4,l,h,d)}throw Error("Unknown vector tile layer");};a._recreateLayer=function(l,h){switch(l.type){case "background":return new k.BackgroundStyleLayer(0,l,h.z,h.uid);case "fill":return new k.FillStyleLayer(1,l,h.z,h.uid);case "line":return new k.LineStyleLayer(2,l,h.z,h.uid);case "symbol":return new k.SymbolStyleLayer(3,l,h.z,h.uid);
case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new k.CircleStyleLayer(4,l,h.z,h.uid)}};return a}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),function(b,k,a,r,l,h){let d=function(){function n(q,m,u,v){this.type=q;this.typeName=m.type;this.id=m.id;this.source=m.source;this.sourceLayer=m["source-layer"];
this.minzoom=m.minzoom;this.maxzoom=m.maxzoom;this.filter=m.filter;this.layout=m.layout;this.paint=m.paint;this.z=u;this.uid=v;switch(q){case 0:this._layoutDefinition=r.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=r.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=r.StyleDefinition.fillLayoutDefinition;this._paintDefinition=r.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=r.StyleDefinition.lineLayoutDefinition;this._paintDefinition=
r.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=r.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=r.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=r.StyleDefinition.circleLayoutDefinition,this._paintDefinition=r.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}var w=n.prototype;w.getFeatureFilter=function(){return void 0!==this._featureFilter?
this._featureFilter:this._featureFilter=a.createFilter(this.filter)};w.getLayoutProperty=function(q){return this._layoutProperties[q]};w.getPaintProperty=function(q){return this._paintProperties[q]};w.getLayoutValue=function(q,m,u){let v;const y=this._layoutProperties[q];y&&(v=y.getValue(m,u));const B=this._layoutDefinition[q];void 0===v&&(v=B["default"]);"enum"===B.type?v=B.values.indexOf(v):"array"===B.type&&"enum"===B.value&&(v=v.map(x=>B.values.indexOf(x)));return v};w.getPaintValue=function(q,
m,u){let v;const y=this._paintProperties[q];y&&(v=y.getValue(m,u));q=this._paintDefinition[q];void 0===v&&(v=q["default"]);"enum"===q.type&&(v=q.values.indexOf(v));return v};w.isPainterDataDriven=function(){const q=this._paintProperties;if(q)for(const m in q)if(q[m].isDataDriven)return!0;return!1};w._parseLayout=function(q){const m={};for(const u in q){const v=this._layoutDefinition[u];v&&(m[u]=new l(v,q[u]))}return m};w._parsePaint=function(q){const m={};for(const u in q){const v=this._paintDefinition[u];
v&&(m[u]=new l(v,q[u]))}return m};return n}(),c=function(n){function w(q,m,u,v){return n.call(this,q,m,u,v)||this}k._inheritsLoose(w,n);return w}(d),e=function(n){function w(q,m,u,v){q=n.call(this,q,m,u,v)||this;m=q.getPaintProperty("fill-color");q.hasDataDrivenColor=m?m.isDataDriven:!1;m=q.getPaintProperty("fill-opacity");q.hasDataDrivenOpacity=m?m.isDataDriven:!1;q.hasDataDrivenFill=q.hasDataDrivenColor||q.hasDataDrivenOpacity;m=q.getPaintProperty("fill-outline-color");q.outlineUsesFillColor=!m;
q.hasDataDrivenOutlineColor=m?m.isDataDriven:!1;q.hasDataDrivenOutline=(m?q.hasDataDrivenOutlineColor:q.hasDataDrivenColor)||q.hasDataDrivenOpacity;return q}k._inheritsLoose(w,n);return w}(d),f=function(n){function w(q,m,u,v){q=n.call(this,q,m,u,v)||this;u=q.getPaintProperty("line-color");q.hasDataDrivenColor=u?u.isDataDriven:!1;u=q.getPaintProperty("line-opacity");q.hasDataDrivenOpacity=u?u.isDataDriven:!1;u=q.getPaintProperty("line-width");q.hasDataDrivenWidth=u?u.isDataDriven:!1;q.hasDataDrivenLine=
q.hasDataDrivenColor||q.hasDataDrivenOpacity||q.hasDataDrivenWidth;m=m.paint["line-width"];m||(m=r.StyleDefinition.linePaintDefinition["line-width"].default);q.isThinLine=!q.hasDataDrivenWidth&&"number"===typeof m&&m<h.THIN_LINE_THRESHOLD;return q}k._inheritsLoose(w,n);return w}(d),g=function(n){function w(q,m,u,v){q=n.call(this,q,m,u,v)||this;m=q.getPaintProperty("icon-color");q.hasDataDrivenIconColor=m?m.isDataDriven:!1;m=q.getPaintProperty("icon-opacity");q.hasDataDrivenIconOpacity=m?m.isDataDriven:
!1;m=q.getLayoutProperty("icon-size");q.hasDataDrivenIconSize=m?m.isDataDriven:!1;q.hasDataDrivenIcon=q.hasDataDrivenIconColor||q.hasDataDrivenIconOpacity||q.hasDataDrivenIconSize;m=q.getPaintProperty("text-color");q.hasDataDrivenTextColor=m?m.isDataDriven:!1;m=q.getPaintProperty("text-opacity");q.hasDataDrivenTextOpacity=m?m.isDataDriven:!1;m=q.getLayoutProperty("text-size");q.hasDataDrivenTextSize=m?m.isDataDriven:!1;q.hasDataDrivenText=q.hasDataDrivenTextColor||q.hasDataDrivenTextOpacity||q.hasDataDrivenTextSize;
return q}k._inheritsLoose(w,n);return w}(d),p=function(n){function w(q,m,u,v){q=n.call(this,q,m,u,v)||this;m=q.getPaintProperty("circle-radius");q.hasDataDrivenRadius=m?m.isDataDriven:!1;m=q.getPaintProperty("circle-color");q.hasDataDrivenColor=m?m.isDataDriven:!1;m=q.getPaintProperty("circle-opacity");q.hasDataDrivenOpacity=m?m.isDataDriven:!1;m=q.getPaintProperty("circle-stroke-width");q.hasDataDrivenStrokeWidth=m?m.isDataDriven:!1;m=q.getPaintProperty("circle-stroke-color");q.hasDataDrivenStrokeColor=
m?m.isDataDriven:!1;m=q.getPaintProperty("circle-stroke-opacity");q.hasDataDrivenStrokeOpacity=m?m.isDataDriven:!1;m=q.getPaintProperty("circle-blur");q.hasDataDrivenBlur=m?m.isDataDriven:!1;return q}k._inheritsLoose(w,n);return w}(d);b.BackgroundStyleLayer=c;b.CircleStyleLayer=p;b.FillStyleLayer=e;b.IconLayout=function(n,w,q,m){this.allowOverlap=n.getLayoutValue("icon-allow-overlap",w,m);this.anchor=n.getLayoutValue("icon-anchor",w,m);this.ignorePlacement=n.getLayoutValue("icon-ignore-placement",
w,m);this.keepUpright=n.getLayoutValue("icon-keep-upright",w,m);this.offset=n.getLayoutValue("icon-offset",w,m);this.optional=n.getLayoutValue("icon-optional",w,m);this.padding=n.getLayoutValue("icon-padding",w,m);this.rotate=n.getLayoutValue("icon-rotate",w,m);this.rotationAlignment=n.getLayoutValue("icon-rotation-alignment",w,m);this.size=n.getLayoutValue("icon-size",w,m);2===this.rotationAlignment&&(this.rotationAlignment=q?0:1)};b.LineStyleLayer=f;b.StyleLayer=d;b.SymbolStyleLayer=g;b.TextLayout=
function(n,w,q,m){this.allowOverlap=n.getLayoutValue("text-allow-overlap",w,m);this.anchor=n.getLayoutValue("text-anchor",w,m);this.fontArray=n.getLayoutValue("text-font",w,m);this.ignorePlacement=n.getLayoutValue("text-ignore-placement",w,m);this.justify=n.getLayoutValue("text-justify",w,m);this.keepUpright=n.getLayoutValue("text-keep-upright",w,m);this.letterSpacing=n.getLayoutValue("text-letter-spacing",w,m);this.lineHeight=n.getLayoutValue("text-line-height",w,m);this.maxAngle=n.getLayoutValue("text-max-angle",
w,m);this.maxWidth=n.getLayoutValue("text-max-width",w,m);this.offset=n.getLayoutValue("text-offset",w,m);this.optional=n.getLayoutValue("text-optional",w,m);this.padding=n.getLayoutValue("text-padding",w,m);this.rotate=n.getLayoutValue("text-rotate",w,m);this.rotationAlignment=n.getLayoutValue("text-rotation-alignment",w,m);this.size=n.getLayoutValue("text-size",w,m);this.transform=n.getLayoutValue("text-transform",w,m);this.writingMode=n.getLayoutValue("text-writing-mode",w,m);2===this.rotationAlignment&&
(this.rotationAlignment=q?0:1)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../../../../../chunks/expression"],function(b){return function(){function k(a){this._expression=a}k.prototype.filter=function(a,r){if(!this._expression)return!0;try{return this._expression.evaluate(a,r)}catch(l){return console.log(l.message),!0}};k.createFilter=function(a){if(!a)return null;this.isLegacyFilter(a)&&(a=this.convertLegacyFilter(a));try{const r=
b.createExpression(a);return new k(r)}catch(r){return console.log(r.message),null}};k.isLegacyFilter=function(a){if(!Array.isArray(a)||0===a.length)return!0;switch(a[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===a.length&&"string"===typeof a[1]&&!Array.isArray(a[2]);case "in":return 3<=a.length&&"string"===typeof a[1]&&!Array.isArray(a[2]);case "!in":return!0;case "any":case "all":for(let r=1;r<a.length;r++)if(!this.isLegacyFilter(a[1]))return!1;
return!0;case "none":return!0;case "has":return 2===a.length&&("$id"===a[1]||"$type"===a[1]);case "!has":return!0;default:return!1}};k.convertLegacyFilter=function(a){if(!Array.isArray(a)||0===a.length)return!0;const r=a[0];if(1===a.length)return"any"!==r;switch(r){case "\x3d\x3d":return k.convertComparison("\x3d\x3d",a[1],a[2]);case "!\x3d":return k.negate(k.convertComparison("\x3d\x3d",a[1],a[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return k.convertComparison(r,a[1],a[2]);case "in":return k.convertIn(a[1],
a.slice(2));case "!in":return k.negate(k.convertIn(a[1],a.slice(2)));case "any":case "all":case "none":return k.convertCombining(r,a.slice(1));case "has":return k.convertHas(a[1]);case "!has":return k.negate(k.convertHas(a[1]));default:throw Error("Unexpected legacy filter.");}};k.convertComparison=function(a,r,l){switch(r){case "$type":return[a,["geometry-type"],l];case "$id":return[a,["id"],l];default:return[a,["get",r],l]}};k.convertIn=function(a,r){switch(a){case "$type":return["in",["geometry-type"],
["literal",r]];case "$id":return["in",["id"],["literal",r]];default:return["in",["get",a],["literal",r]]}};k.convertHas=function(a){switch(a){case "$type":return!0;case "$id":return["has-id"];default:return["has",a]}};k.convertCombining=function(a,r){return[a].concat(r.map(this.convertLegacyFilter))};k.negate=function(a){return["!",a]};return k}()})},"esri/chunks/expression":function(){define("exports ./_rollupPluginBabelHelpers ../Color ../views/2d/engine/vectorTiles/expression/data ../views/2d/unitBezier ../views/2d/engine/vectorTiles/GeometryUtils".split(" "),
function(b,k,a,r,l,h){function d(Ea){return Ea>V?Math.pow(Ea,1/3):Ea/U+N}function c(Ea){return Ea>P?Ea*Ea*Ea:U*(Ea-N)}function e(Ea){return 255*(.0031308>=Ea?12.92*Ea:1.055*Math.pow(Ea,1/2.4)-.055)}function f(Ea){Ea/=255;return.04045>=Ea?Ea/12.92:Math.pow((Ea+.055)/1.055,2.4)}function g(Ea){var ya=f(Ea.r);const xa=f(Ea.g),wa=f(Ea.b),ma=d((.4124564*ya+.3575761*xa+.1804375*wa)/.95047),ta=d(.2126729*ya+.7151522*xa+.072175*wa);ya=d((.0193339*ya+.119192*xa+.9503041*wa)/1.08883);return{l:116*ta-16,a:500*
(ma-ta),b:200*(ta-ya),alpha:Ea.a}}function p(Ea){let ya=(Ea.l+16)/116,xa=isNaN(Ea.a)?ya:ya+Ea.a/500,wa=isNaN(Ea.b)?ya:ya-Ea.b/200;ya=1*c(ya);xa=.95047*c(xa);wa=1.08883*c(wa);return new a([e(3.2404542*xa-1.5371385*ya-.4985314*wa),e(-.969266*xa+1.8760108*ya+.041556*wa),e(.0556434*xa-.2040259*ya+1.0572252*wa),Ea.alpha])}function n(Ea,ya,xa){return{l:h.interpolate(Ea.l,ya.l,xa),a:h.interpolate(Ea.a,ya.a,xa),b:h.interpolate(Ea.b,ya.b,xa),alpha:h.interpolate(Ea.alpha,ya.alpha,xa)}}function w(Ea){const {l:ya,
a:xa,b:wa}=g(Ea),ma=Math.atan2(wa,xa)*X;return{h:0>ma?ma+360:ma,c:Math.sqrt(xa*xa+wa*wa),l:ya,alpha:Ea.a}}function q(Ea){const ya=Ea.h*W,xa=Ea.c;return p({l:Ea.l,a:Math.cos(ya)*xa,b:Math.sin(ya)*xa,alpha:Ea.alpha})}function m(Ea,ya,xa){{var wa=Ea.h;const ma=ya.h-wa;wa+=xa*(180<ma||-180>ma?ma-360*Math.round(ma/360):ma)}return{h:wa,c:h.interpolate(Ea.c,ya.c,xa),l:h.interpolate(Ea.l,ya.l,xa),alpha:h.interpolate(Ea.alpha,ya.alpha,xa)}}function u(Ea,ya){return{kind:"array",itemType:Ea,n:ya}}function v(Ea){if("array"===
Ea.kind){const ya=v(Ea.itemType);return"number"===typeof Ea.n?`array<${ya}, ${Ea.n}>`:"value"===Ea.itemType.kind?"array":`array<${ya}>`}return Ea.kind}function y(Ea){if(null===Ea)return Sa;if("string"===typeof Ea)return Qa;if("boolean"===typeof Ea)return Pa;if("number"===typeof Ea)return Ia;if(Ea instanceof a)return sa;if(Array.isArray(Ea)){let ya;for(const xa of Ea){const wa=y(xa);if(ya){if(ya!==wa){ya=Ra;break}}else ya=wa}return u(ya||Ra,Ea.length)}return Ga}function B(Ea,ya){if("error"===Ea.kind)return null;
if("array"===ya.kind){if("array"===Ea.kind&&(0===Ea.n&&"value"===Ea.itemType.kind||!B(Ea.itemType,ya.itemType))&&("number"!==typeof ya.n||ya.n===Ea.n))return null}else{if(ya.kind===Ea.kind)return null;if("value"===ya.kind)for(const xa of Ua)if(!B(xa,Ea))return null}return`Expected ${v(ya)} but found ${v(Ea)} instead.`}function x(Ea){const ya=typeof Ea;return null===Ea?"":"string"===ya||"number"===ya||"boolean"===ya?String(Ea):Ea instanceof a?Ea.toString():JSON.stringify(Ea)}function C(Ea){if(null===
Ea||"string"===typeof Ea||"boolean"===typeof Ea||"number"===typeof Ea)Ea=["literal",Ea];if(!Array.isArray(Ea)||0===Ea.length)throw Error("Expression must be a non empty array");const ya=Ea[0];if("string"!==typeof ya)throw Error("First element of expression must be a string");const xa=mb[ya];if(void 0===xa)throw Error(`Invalid expression operator "${ya}"`);if(!xa)throw Error(`Unimplemented expression operator "${ya}"`);return xa.parse(Ea)}let z=function(){function Ea(ya){this.args=ya}Ea.parse=function(ya){if(4!==
ya.length)throw Error('"rgb" expects 3 arguments.');ya=ya.slice(1).map(xa=>C(xa));return new Ea(ya)};Ea.prototype.evaluate=function(ya,xa){const wa=this.args[1].evaluate(ya,xa),ma=this.args[2].evaluate(ya,xa);ya=this.args[3].evaluate(ya,xa);return`rgb(${Math.round(wa)},${Math.round(ma)},${Math.round(ya)})`};return Ea}(),A=function(){function Ea(ya){this.args=ya}Ea.parse=function(ya){if(5!==ya.length)throw Error('"rgba" expects 4 arguments.');ya=ya.slice(1).map(xa=>C(xa));return new z(ya)};Ea.prototype.evaluate=
function(ya,xa){const wa=this.args[1].evaluate(ya,xa),ma=this.args[2].evaluate(ya,xa),ta=this.args[3].evaluate(ya,xa);ya=this.args[4].evaluate(ya,xa);return`rgb(${Math.round(wa)},${Math.round(ma)},${Math.round(ta)},${ya})`};return Ea}(),t=function(){function Ea(ya){this.color=ya}Ea.parse=function(ya){if(2!==ya.length)throw Error('"to-rgba" expects 1 argument.');ya=C(ya[1]);return new Ea(ya)};Ea.prototype.evaluate=function(ya,xa){return(new a(this.color.evaluate(ya,xa))).toRgba()};return Ea}(),D=function(){function Ea(ya,
xa,wa){this.lhs=ya;this.rhs=xa;this.compare=wa}Ea.parse=function(ya,xa){if(3!==ya.length&&4!==ya.length)throw Error(`"${ya[0]}" expects 2 or 3 arguments`);if(4===ya.length)throw Error(`"${ya[0]}" collator not supported`);return new Ea(C(ya[1]),C(ya[2]),xa)};Ea.prototype.evaluate=function(ya,xa){return this.compare(this.lhs.evaluate(ya,xa),this.rhs.evaluate(ya,xa))};return Ea}(),E=function(Ea){function ya(){return Ea.apply(this,arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){return D.parse(xa,
(wa,ma)=>wa===ma)};return ya}(D),G=function(Ea){function ya(){return Ea.apply(this,arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){return D.parse(xa,(wa,ma)=>wa!==ma)};return ya}(D),H=function(Ea){function ya(){return Ea.apply(this,arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){return D.parse(xa,(wa,ma)=>wa<ma)};return ya}(D),I=function(Ea){function ya(){return Ea.apply(this,arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){return D.parse(xa,(wa,ma)=>wa<=
ma)};return ya}(D),J=function(Ea){function ya(){return Ea.apply(this,arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){return D.parse(xa,(wa,ma)=>wa>ma)};return ya}(D),K=function(Ea){function ya(){return Ea.apply(this,arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){return D.parse(xa,(wa,ma)=>wa>=ma)};return ya}(D),L=function(){function Ea(ya){this.arg=ya}Ea.parse=function(ya){if(2!==ya.length)throw Error('"!" expects 1 argument');return new Ea(C(ya[1]))};Ea.prototype.evaluate=
function(ya,xa){return!this.arg.evaluate(ya,xa)};return Ea}(),S=function(){function Ea(ya){this.args=ya}Ea.parse=function(ya){const xa=[];for(let wa=1;wa<ya.length;wa++)xa.push(C(ya[wa]));return new Ea(xa)};Ea.prototype.evaluate=function(ya,xa){for(const wa of this.args)if(!wa.evaluate(ya,xa))return!1;return!0};return Ea}(),M=function(){function Ea(ya){this.args=ya}Ea.parse=function(ya){const xa=[];for(let wa=1;wa<ya.length;wa++)xa.push(C(ya[wa]));return new Ea(xa)};Ea.prototype.evaluate=function(ya,
xa){for(const wa of this.args)if(wa.evaluate(ya,xa))return!0;return!1};return Ea}(),T=function(){function Ea(ya){this.args=ya}Ea.parse=function(ya){const xa=[];for(let wa=1;wa<ya.length;wa++)xa.push(C(ya[wa]));return new Ea(xa)};Ea.prototype.evaluate=function(ya,xa){for(const wa of this.args)if(wa.evaluate(ya,xa))return!1;return!0};return Ea}(),O=function(){function Ea(ya,xa){this.args=ya;this.fallback=xa}Ea.parse=function(ya){if(4>ya.length)throw Error('"case" expects at least 3 arguments');if(1===
ya.length%2)throw Error('"case" expects an odd number of arguments');const xa=[];for(let wa=1;wa<ya.length-1;wa+=2)xa.push({condition:C(ya[wa]),output:C(ya[wa+1])});return new Ea(xa,C(ya[ya.length-1]))};Ea.prototype.evaluate=function(ya,xa){for(const wa of this.args)if(wa.condition.evaluate(ya,xa))return wa.output.evaluate(ya,xa);return this.fallback.evaluate(ya,xa)};return Ea}(),Q=function(){function Ea(ya){this.args=ya}Ea.parse=function(ya){if(2>ya.length)throw Error('"coalesce" expects at least 1 argument');
const xa=[];for(let wa=1;wa<ya.length;wa++)xa.push(C(ya[wa]));return new Ea(xa)};Ea.prototype.evaluate=function(ya,xa){for(const wa of this.args){const ma=wa.evaluate(ya,xa);if(null!==ma)return ma}return null};return Ea}(),F=function(){function Ea(ya,xa,wa,ma){this.input=ya;this.labels=xa;this.outputs=wa;this.fallback=ma}Ea.parse=function(ya){if(3>ya.length)throw Error('"match" expects at least 3 arguments');if(0===ya.length%2)throw Error('"case" expects an even number of arguments');const xa=C(ya[1]),
wa=[],ma={};let ta;for(let Oa=2;Oa<ya.length-1;Oa+=2){var Da=ya[Oa];Array.isArray(Da)||(Da=[Da]);for(const Ja of Da){Da=typeof Ja;if("string"!==Da&&"number"!==Da)throw Error('"match" requires string or number literal as labels');if(!ta)ta=Da;else if(Da!==ta)throw Error('"match" requires labels to have the same type');ma[Ja]=wa.length}wa.push(C(ya[Oa+1]))}return new Ea(xa,ma,wa,C(ya[ya.length-1]))};Ea.prototype.evaluate=function(ya,xa){const wa=this.input.evaluate(ya,xa);return(this.outputs[this.labels[wa]]||
this.fallback).evaluate(ya,xa)};return Ea}();const N=4/29,P=6/29,U=3*P*P,V=P*P*P,W=Math.PI/180,X=180/Math.PI;let ca=function(){function Ea(ya,xa,wa,ma){this.operator=ya;this.input=xa;this.stops=wa;this.interpolation=ma}Ea.parse=function(ya){if(5>ya.length)throw Error(`"${ya[0]}" expects at least 4 arguments.`);const xa=ya[1];if(!Array.isArray(xa)||0===xa.length)throw Error(`"${ya[0]}" expects an interpolation type expression.`);switch(xa[0]){case "linear":break;case "exponential":if("number"!==typeof xa[1])throw Error(`"${ya[0]}" expects a numeric base for exponential interpolation.`);
break;case "cubic-bezier":if(5!==xa.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.");for(var wa=1;5>wa;wa++){var ma=xa[wa];if("number"!==typeof ma||0>ma||1<ma)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.");}break;default:throw Error(`"${ya[0]}" unknown interpolation type "${xa[0]}".`);}if(1!==ya.length%2)throw Error(`"${ya[0]}" expects an even number of arguments.`);wa=C(ya[2]);ma=
[];for(let ta=3;ta<ya.length;ta+=2){const Da=ya[ta];if("number"!==typeof Da)throw Error(`"${ya[0]}" requires stop inputs as literal numbers.`);if(ma.length&&ma[ma.length-1][0]>=Da)throw Error(`"${ya[0]}" requires strictly ascending stop inputs.`);ma.push([Da,C(ya[ta+1])])}return new Ea(ya[0],wa,ma,xa)};Ea.prototype.evaluate=function(ya,xa){const wa=this.stops;if(1===wa.length)return wa[0][1].evaluate(ya,xa);var ma=this.input.evaluate(ya,xa);if(ma<=wa[0][0])return wa[0][1].evaluate(ya,xa);if(ma>=wa[wa.length-
1][0])return wa[wa.length-1][1].evaluate(ya,xa);let ta=0;for(;++ta<wa.length&&!(ma<wa[ta][0]););const Da=Ea.interpolationRatio(this.interpolation,ma,wa[ta-1][0],wa[ta][0]);ma=wa[ta-1][1].evaluate(ya,xa);const Oa=wa[ta][1].evaluate(ya,xa);return"interpolate"===this.operator?Array.isArray(ma)?ma.map((Ja,ra)=>h.interpolate(Ja,Oa[ra],Da)):h.interpolate(ma,Oa,Da):"interpolate-hcl"===this.operator?q(m(w(ma),w(Oa),Da)):p(n(g(ma),g(Oa),Da))};Ea.interpolationRatio=function(ya,xa,wa,ma){let ta=0;"exponential"===
ya[0]?ta=Ea.exponentialInterpolationRatio(xa,ya[1],wa,ma):"linear"===ya[0]?ta=Ea.exponentialInterpolationRatio(xa,1,wa,ma):"cubic-bezier"===ya[0]&&(ta=l.unitBezier(ya[1],ya[2],ya[3],ya[4])(Ea.exponentialInterpolationRatio(xa,1,wa,ma),1E-5));return ta};Ea.exponentialInterpolationRatio=function(ya,xa,wa,ma){ma-=wa;if(0===ma)return 0;ya-=wa;return 1===xa?ya/ma:(Math.pow(xa,ya)-1)/(Math.pow(xa,ma)-1)};return Ea}(),R=function(){function Ea(ya,xa){this.input=ya;this.stops=xa}Ea.parse=function(ya){if(5>
ya.length)throw Error('"step" expects at least 4 arguments.');if(1!==ya.length%2)throw Error('"step" expects an even number of arguments.');const xa=C(ya[1]),wa=[];wa.push([-Infinity,C(ya[2])]);for(let ma=3;ma<ya.length;ma+=2){const ta=ya[ma];if("number"!==typeof ta)throw Error('"step" requires stop inputs as literal numbers.');if(wa.length&&wa[wa.length-1][0]>=ta)throw Error('"step" requires strictly ascending stop inputs.');wa.push([ta,C(ya[ma+1])])}return new Ea(xa,wa)};Ea.prototype.evaluate=function(ya,
xa){const wa=this.stops;if(1===wa.length)return wa[0][1].evaluate(ya,xa);const ma=this.input.evaluate(ya,xa);let ta=0;for(;++ta<wa.length&&!(ma<wa[ta][0]););return this.stops[ta-1][1].evaluate(ya,xa)};return Ea}(),aa=function(){function Ea(ya,xa){this.index=ya;this.array=xa}Ea.parse=function(ya){if(3!==ya.length)throw Error('"at" expects 2 arguments.');const xa=C(ya[1]);ya=C(ya[2]);return new Ea(xa,ya)};Ea.prototype.evaluate=function(ya,xa){const wa=this.index.evaluate(ya,xa);ya=this.array.evaluate(ya,
xa);if(0>wa||wa>=ya.length)throw Error('"at" index out of bounds.');if(wa!==Math.floor(wa))throw Error('"at" index must be an integer.');return ya[wa]};return Ea}(),ka=function(){function Ea(ya,xa){this.key=ya;this.obj=xa}Ea.parse=function(ya){let xa;switch(ya.length){case 2:return xa=C(ya[1]),new Ea(xa);case 3:return xa=C(ya[1]),ya=C(ya[2]),new Ea(xa,ya);default:throw Error('"get" expects 1 or 2 arguments');}};Ea.prototype.evaluate=function(ya,xa){const wa=this.key.evaluate(ya,xa);return this.obj?
this.obj.evaluate(ya,xa)[wa]:ya.values[wa]};return Ea}(),da=function(){function Ea(ya,xa){this.key=ya;this.obj=xa}Ea.parse=function(ya){let xa;switch(ya.length){case 2:return xa=C(ya[1]),new Ea(xa);case 3:return xa=C(ya[1]),ya=C(ya[2]),new Ea(xa,ya);default:throw Error('"has" expects 1 or 2 arguments');}};Ea.prototype.evaluate=function(ya,xa){const wa=this.key.evaluate(ya,xa);return this.obj?(ya=this.obj.evaluate(ya,xa),wa in ya):void 0!==ya.values[wa]};return Ea}(),fa=function(){function Ea(ya,xa){this.key=
ya;this.vals=xa}Ea.parse=function(ya){if(3!==ya.length)throw Error('"in" expects 2 arguments');return new Ea(C(ya[1]),C(ya[2]))};Ea.prototype.evaluate=function(ya,xa){const wa=this.key.evaluate(ya,xa);return-1!==this.vals.evaluate(ya,xa).indexOf(wa)};return Ea}(),ea=function(){function Ea(ya,xa,wa){this.item=ya;this.array=xa;this.from=wa}Ea.parse=function(ya){if(3>ya.length||4<ya.length)throw Error('"index-of" expects 3 or 4 arguments.');const xa=C(ya[1]),wa=C(ya[2]);return 4===ya.length?(ya=C(ya[3]),
new Ea(xa,wa,ya)):new Ea(xa,wa)};Ea.prototype.evaluate=function(ya,xa){const wa=this.item.evaluate(ya,xa),ma=this.array.evaluate(ya,xa);if(this.from){ya=this.from.evaluate(ya,xa);if(ya!==Math.floor(ya))throw Error('"index-of" index must be an integer.');return ma.indexOf(wa,ya)}return ma.indexOf(wa)};return Ea}(),Y=function(){function Ea(ya){this.arg=ya}Ea.parse=function(ya){if(2!==ya.length)throw Error('"length" expects 2 arguments.');ya=C(ya[1]);return new Ea(ya)};Ea.prototype.evaluate=function(ya,
xa){ya=this.arg.evaluate(ya,xa);if("string"===typeof ya||Array.isArray(ya))return ya.length;throw Error('"length" expects string or array.');};return Ea}(),Z=function(){function Ea(ya,xa,wa){this.array=ya;this.from=xa;this.to=wa}Ea.parse=function(ya){if(3>ya.length||4<ya.length)throw Error('"slice" expects 2 or 3 arguments.');const xa=C(ya[1]),wa=C(ya[2]);return 4===ya.length?(ya=C(ya[3]),new Ea(xa,wa,ya)):new Ea(xa,wa)};Ea.prototype.evaluate=function(ya,xa){const wa=this.array.evaluate(ya,xa),ma=
this.from.evaluate(ya,xa);if(0>ma||ma>=wa.length)throw Error('"slice" index out of bounds.');if(ma!==Math.floor(ma))throw Error('"slice" index must be an integer.');if(this.to){ya=this.to.evaluate(ya,xa);if(0>ya||ya>=wa.length)throw Error('"slice" index out of bounds.');if(ya!==Math.floor(ya))throw Error('"slice" index must be an integer.');return wa.slice(ma,ya)}return wa.slice(ma)};return Ea}(),ba=function(){function Ea(){}Ea.parse=function(ya){if(1!==ya.length)throw Error('"has-id" expects no arguments');
return new Ea};Ea.prototype.evaluate=function(ya,xa){return void 0!==ya.id};return Ea}(),ia=function(){function Ea(ya,xa){this.args=ya;this.calculate=xa}Ea.parse=function(ya,xa){ya=ya.slice(1).map(wa=>C(wa));return new Ea(ya,xa)};Ea.prototype.evaluate=function(ya,xa){let wa;this.args&&(wa=this.args.map(ma=>ma.evaluate(ya,xa)));return this.calculate(wa)};return Ea}(),ja=function(Ea){function ya(){return Ea.apply(this,arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){switch(xa.length){case 2:return ia.parse(xa,
wa=>-wa[0]);case 3:return ia.parse(xa,wa=>wa[0]-wa[1]);default:throw Error('"-" expects 1 or 2 arguments');}};return ya}(ia),la=function(Ea){function ya(){return Ea.apply(this,arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){return ia.parse(xa,wa=>{let ma=1;for(const ta of wa)ma*=ta;return ma})};return ya}(ia),qa=function(Ea){function ya(){return Ea.apply(this,arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){if(3===xa.length)return ia.parse(xa,wa=>wa[0]/wa[1]);throw Error('"/" expects 2 arguments');
};return ya}(ia),na=function(Ea){function ya(){return Ea.apply(this,arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){if(3===xa.length)return ia.parse(xa,wa=>wa[0]%wa[1]);throw Error('"%" expects 2 arguments');};return ya}(ia),oa=function(Ea){function ya(){return Ea.apply(this,arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){if(3===xa.length)return ia.parse(xa,wa=>Math.pow(wa[0],wa[1]));throw Error('"^" expects 1 or 2 arguments');};return ya}(ia),ua=function(Ea){function ya(){return Ea.apply(this,
arguments)||this}k._inheritsLoose(ya,Ea);ya.parse=function(xa){return ia.parse(xa,wa=>{let ma=0;for(const ta of wa)ma+=ta;return ma})};return ya}(ia),za=function(){function Ea(ya,xa){this.args=ya;this.calculate=xa}Ea.parse=function(ya){const xa=ya.slice(1).map(wa=>C(wa));return new Ea(xa,Ea.ops[ya[0]])};Ea.prototype.evaluate=function(ya,xa){let wa;this.args&&(wa=this.args.map(ma=>ma.evaluate(ya,xa)));return this.calculate(wa)};return Ea}();za.ops={abs:Ea=>Math.abs(Ea[0]),acos:Ea=>Math.acos(Ea[0]),
asin:Ea=>Math.asin(Ea[0]),atan:Ea=>Math.atan(Ea[0]),ceil:Ea=>Math.ceil(Ea[0]),cos:Ea=>Math.cos(Ea[0]),e:()=>Math.E,floor:Ea=>Math.floor(Ea[0]),ln:Ea=>Math.log(Ea[0]),ln2:()=>Math.LN2,log10:Ea=>Math.log(Ea[0])/Math.LN10,log2:Ea=>Math.log(Ea[0])/Math.LN2,max:Ea=>Math.max(...Ea),min:Ea=>Math.min(...Ea),pi:()=>Math.PI,round:Ea=>Math.round(Ea[0]),sin:Ea=>Math.sin(Ea[0]),sqrt:Ea=>Math.sqrt(Ea[0]),tan:Ea=>Math.tan(Ea[0])};let Fa=function(){function Ea(ya){this.args=ya}Ea.parse=function(ya){return new Ea(ya.slice(1).map(xa=>
C(xa)))};Ea.prototype.evaluate=function(ya,xa){return this.args.map(wa=>wa.evaluate(ya,xa)).join("")};return Ea}(),La=function(){function Ea(ya,xa){this.arg=ya;this.calculate=xa}Ea.parse=function(ya){if(2!==ya.length)throw Error(`${ya[0]} expects 1 argument.`);const xa=C(ya[1]);return new Ea(xa,Ea.ops[ya[0]])};Ea.prototype.evaluate=function(ya,xa){return this.calculate(this.arg.evaluate(ya,xa))};return Ea}();La.ops={downcase:Ea=>Ea.toLowerCase(),upcase:Ea=>Ea.toUpperCase()};const Sa={kind:"null"},
Ia={kind:"number"},Qa={kind:"string"},Pa={kind:"boolean"},sa={kind:"color"},Ga={kind:"object"},Ra={kind:"value"},Ua=[Sa,Ia,Qa,Pa,sa,Ga,u(Ra)];let ha=function(){function Ea(ya,xa){this.type=ya;this.args=xa}Ea.parse=function(ya){var xa=ya[0];if(2>ya.length)throw Error(`${xa} expects at least one argument.`);let wa=1,ma;if("array"===xa){if(2<ya.length){switch(ya[1]){case "string":ma=Qa;break;case "number":ma=Ia;break;case "boolean":ma=Pa;break;default:throw Error('"array" type argument must be string, number or boolean');
}wa++}else ma=Ra;if(3<ya.length){var ta=ya[2];if(null!==ta&&("number"!==typeof ta||0>ta||ta!==Math.floor(ta)))throw Error('"array" length argument must be a positive integer literal');wa++}ma=u(ma,ta)}else switch(xa){case "string":ma=Qa;break;case "number":ma=Ia;break;case "boolean":ma=Pa;break;case "object":ma=Ga}for(xa=[];wa<ya.length;wa++)ta=C(ya[wa]),xa.push(ta);return new Ea(ma,xa)};Ea.prototype.evaluate=function(ya,xa){for(const wa of this.args){const ma=wa.evaluate(ya,xa);if(!B(y(ma),this.type))return ma}return null};
return Ea}(),Ya=function(){function Ea(ya,xa){this.type=ya;this.args=xa}Ea.parse=function(ya){var xa=ya[0];if("to-boolean"===xa||"to-string"===xa){if(2!==ya.length)throw Error(`${xa} expects one argument.`);}else if(2>ya.length)throw Error(`${xa} expects at least one argument.`);xa=Ea.types[xa];const wa=[];for(let ma=1;ma<ya.length;ma++){const ta=C(ya[ma]);wa.push(ta)}return new Ea(xa,wa)};Ea.prototype.evaluate=function(ya,xa){if(this.type===Pa)return!!this.args[0].evaluate(ya,xa);if(this.type===
Qa)return x(this.args[0].evaluate(ya,xa));if(this.type===Ia){for(var wa of this.args){var ma=wa.evaluate(ya,xa);if(null===ma)return 0;ma=Number(ma);if(!isNaN(ma))return ma}return null}if(this.type===sa){for(ma of this.args){wa=ma.evaluate(ya,xa);if(wa instanceof a)return wa;if("string"===typeof wa)return a.fromString(wa);if(Array.isArray(wa)&&(3===wa.length||4===wa.length))return a.fromArray(wa)}return null}};return Ea}();Ya.types={"to-boolean":Pa,"to-color":sa,"to-number":Ia,"to-string":Qa};let Wa=
function(){function Ea(ya){this.val=ya}Ea.parse=function(ya){if(2!==ya.length)throw Error('"literal" expects 1 argument');return new Ea(ya[1])};Ea.prototype.evaluate=function(ya,xa){return this.val};return Ea}(),db=function(){function Ea(ya){this.arg=ya}Ea.parse=function(ya){if(2!==ya.length)throw Error('"typeof" expects 1 argument');return new Ea(C(ya[1]))};Ea.prototype.evaluate=function(ya,xa){return v(y(this.arg.evaluate(ya,xa)))};return Ea}();const mb={array:ha,"boolean":ha,collator:null,format:null,
literal:Wa,image:null,number:ha,"number-format":null,object:ha,string:ha,"to-boolean":Ya,"to-color":Ya,"to-number":Ya,"to-string":Ya,"typeof":db,accumulated:null,"feature-state":null,"geometry-type":r.GeomType,id:r.ID,"line-progress":null,properties:r.Properties,at:aa,get:ka,has:da,"in":fa,"index-of":ea,length:Y,slice:Z,"!":L,"!\x3d":G,"\x3c":H,"\x3c\x3d":I,"\x3d\x3d":E,"\x3e":J,"\x3e\x3d":K,all:S,any:M,"case":O,coalesce:Q,match:F,within:null,interpolate:ca,"interpolate-hcl":ca,"interpolate-lab":ca,
step:R,let:null,"var":null,concat:Fa,downcase:La,"is-supported-script":null,"resolved-locale":null,upcase:La,rgb:z,rgba:A,"to-rgba":t,"-":ja,"*":la,"/":qa,"%":na,"^":oa,"+":ua,abs:za,acos:za,asin:za,atan:za,ceil:za,cos:za,e:za,floor:za,ln:za,ln2:za,log10:za,log2:za,max:za,min:za,pi:za,round:za,sin:za,sqrt:za,tan:za,zoom:r.Zoom,"heatmap-density":null,"has-id":ba,none:T};b.ALL=S;b.ANY=M;b.Add=ua;b.Assert=ha;b.At=aa;b.BooleanType=Pa;b.Calculate=za;b.Case=O;b.Coalesce=Q;b.Coerce=Ya;b.ColorType=sa;b.Concat=
Fa;b.Div=qa;b.EQ=E;b.ErrorType={kind:"error"};b.GE=K;b.GT=J;b.Get=ka;b.Has=da;b.HasID=ba;b.In=fa;b.IndexOf=ea;b.Interpolate=ca;b.LE=I;b.LT=H;b.Length=Y;b.Literal=Wa;b.Match=F;b.Mod=na;b.Mul=la;b.NE=G;b.NONE=T;b.NOT=L;b.NullType=Sa;b.NumberType=Ia;b.ObjectType=Ga;b.Pow=oa;b.Rgb=z;b.Rgba=A;b.Slice=Z;b.Step=R;b.String=La;b.StringType=Qa;b.Sub=ja;b.ToRgba=t;b.TypeOf=db;b.ValueType=Ra;b.array=u;b.createExpression=C;b.ops=mb;b.typeToString=v;b.valueToString=x})},"esri/views/2d/engine/vectorTiles/expression/data":function(){define(["exports"],
function(b){let k=function(){function h(){}h.parse=function(d){if(1<d.length)throw Error('"id" does not expect arguments');return new h};h.prototype.evaluate=function(d,c){return d.id};return h}(),a=function(){function h(){}h.parse=function(d){if(1<d.length)throw Error('"geometry-type" does not expect arguments');return new h};h.prototype.evaluate=function(d,c){switch(d.type){case 0:return"Unknown";case 1:return"Point";case 2:return"LineString";case 3:return"Polygon"}};return h}(),r=function(){function h(){}
h.parse=function(d){if(1<d.length)throw Error('"properties" does not expect arguments');return new h};h.prototype.evaluate=function(d,c){return d.values};return h}(),l=function(){function h(){}h.parse=function(d){if(1<d.length)throw Error('"zoom" does not expect arguments');return new h};h.prototype.evaluate=function(d,c){return c};return h}();b.GeomType=a;b.ID=k;b.Properties=r;b.Zoom=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/unitBezier":function(){define(["exports"],function(b){function k(l,
h,d,c){function e(m,u){var v;let y,B;y=m;for(v=0;8>v;v++){B=((p*y+g)*y+f)*y-m;if(Math.abs(B)<u)return y;var x=(3*p*y+2*g)*y+f;if(1E-6>Math.abs(x))break;y-=B/x}x=0;v=1;y=m;if(y<x)return x;if(y>v)return v;for(;x<v;){B=((p*y+g)*y+f)*y;if(Math.abs(B-m)<u)break;m>B?x=y:v=y;y=.5*(v-x)+x}return y}const f=3*l,g=3*(d-l)-f,p=1-f-g,n=3*h,w=3*(c-h)-n,q=1-n-w;return function(m,u=1E-6){m=e(m,u);return((q*m+w)*m+n)*m}}const a=/^cubic-bezier\((.*)\)/,r={};r.ease=k(.25,.1,.25,1);r.linear=k(0,0,1,1);r.easeIn=r["ease-in"]=
k(.42,0,1,1);r.easeOut=r["ease-out"]=k(0,0,.58,1);r.easeInOut=r["ease-in-out"]=k(.42,0,.58,1);b.easingFunctions=r;b.parse=function(l){let h=r[l]||null;!h&&(l=a.exec(l))&&(l=l[1].split(",").map(d=>parseFloat(d.trim())),4!==l.length||l.some(d=>isNaN(d))||(h=k.apply(k,l)));return h};b.unitBezier=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/GeometryUtils":function(){define(["exports"],function(b){function k(c,e){c%=e;return 0<=c?c:c+e}const a=Number.POSITIVE_INFINITY,
r=Math.PI,l=128/r,h=256/360,d=1/Math.LN2;b.C_256_TO_RAD=r/128;b.C_2PI=2*r;b.C_DEG_TO_256=h;b.C_DEG_TO_RAD=r/180;b.C_INFINITY=a;b.C_PI=r;b.C_PI_BY_2=r/2;b.C_RAD_TO_256=l;b.C_SQRT2=1.414213562;b.C_SQRT2_INV=1/1.414213562;b.between=function(c,e,f){return c>=e&&c<=f||c>=f&&c<=e};b.degToByte=function(c){return k(c*h,256)};b.interpolate=function(c,e,f){return c*(1-f)+e*f};b.log2=function(c){return Math.log(c)*d};b.positiveMod=k;b.radToByte=function(c){return k(c*l,256)};b.sqr=function(c){return c*c};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleDefinition":function(){define(["exports"],function(b){let k=function(){};k.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};k.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};k.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},
"line-join":{type:"enum",values:["bevel","round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};k.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-avoid-edges":{type:"boolean",default:!1},"symbol-placement":{type:"enum",values:["point","line","line-center"],default:"point"},"symbol-sort-key":{type:"number",default:-1},"symbol-spacing":{type:"number",minimum:1,default:250},"icon-allow-overlap":{type:"boolean",
default:!1},"icon-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"icon-ignore-placement":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"icon-optional":{type:"boolean",default:!1},"icon-padding":{type:"number",minimum:0,default:2},"icon-rotate":{type:"number",default:0},"icon-rotation-alignment":{type:"enum",
values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"text-allow-overlap":{type:"boolean",default:!1},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},"text-field":{type:"string"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-ignore-placement":{type:"boolean",default:!1},"text-justify":{type:"enum",values:["auto",
"left","center","right"],default:"center"},"text-keep-upright":{type:"boolean",default:!0},"text-letter-spacing":{type:"number",default:0},"text-line-height":{type:"number",default:1.2},"text-max-angle":{type:"number",minimum:0,default:45},"text-max-width":{type:"number",minimum:0,default:10},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-optional":{type:"boolean",default:!1},"text-padding":{type:"number",minimum:0,default:2},"text-rotate":{type:"number",default:0},"text-rotation-alignment":{type:"enum",
values:["map","viewport","auto"],default:"auto"},"text-size":{type:"number",minimum:0,default:16},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-writing-mode":{type:"array",value:"enum",values:["horizontal","vertical"],default:["horizontal"]}};k.circleLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};k.backgroundPaintDefinition={"background-color":{type:"color",default:[0,0,0,1]},"background-opacity":{type:"number",
minimum:0,maximum:1,default:1},"background-pattern":{type:"string"}};k.fillPaintDefinition={"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-pattern":{type:"string"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};k.linePaintDefinition={"line-blur":{type:"number",
minimum:0,default:0},"line-color":{type:"color",default:[0,0,0,1]},"line-dasharray":{type:"array",value:"number",default:[]},"line-gap-width":{type:"number",minimum:0,default:0},"line-offset":{type:"number",default:0},"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-pattern":{type:"string"},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1}};
k.symbolPaintDefinition={"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-translate":{type:"array",value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-blur":{type:"number",
minimum:0,default:0},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};k.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",
minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};k.circlePaintDefinition={"circle-blur":{type:"number",minimum:0,default:0},"circle-color":{type:"color",default:[0,0,0,1]},"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",
minimum:0,default:5},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"}};b.StyleDefinition=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color",
"../../../../../chunks/expression","../GeometryUtils"],function(b,k,a){return function(){function r(h,d){this.isDataDriven=!1;let c;switch(h.type){case "number":c=!0;break;case "color":c=!0;d=r._parseColor(d);break;case "array":c="number"===h.value;break;default:c=!1}null==d&&(d=h.default);if(Array.isArray(d)&&0<d.length&&k.ops[d[0]])try{var e=k.createExpression(d);this.getValue=this._buildExpression(e,h);this.isDataDriven=!0}catch(f){console.log(f.message),this.getValue=this._buildSimple(h.default)}else{c&&
"interval"===d.type&&(c=!1);if(e=d&&d.stops&&0<d.stops.length)for(const f of d.stops)f[1]=this._validate(f[1],h);if(this.isDataDriven=d?!!d.property:!1)if(void 0!==d.default&&(d.default=this._validate(d.default,h)),e)switch(d.type){case "identity":this.getValue=this._buildIdentity(d,h);break;case "categorical":this.getValue=this._buildCategorical(d,h);break;default:this.getValue=c?this._buildInterpolate(d,h):this._buildInterval(d,h)}else this.getValue=this._buildIdentity(d,h);else e?this.getValue=
c?this._buildZoomInterpolate(d):this._buildZoomInterval(d):(d=this._validate(d,h),this.getValue=this._buildSimple(d))}}var l=r.prototype;l._validate=function(h,d){if("number"===d.type){if(h<d.minimum)return d.minimum;if(h>d.maximum)return d.maximum}return h};l._buildSimple=function(h){return()=>h};l._buildExpression=function(h,d){return(c,e)=>{try{let f=h.evaluate(e,c);"color"===d.type&&(f=r._parseColor(f));return void 0===f?d.default:this._validate(f,d)}catch(f){return console.log(f.message),d.default}}};
l._buildIdentity=function(h,d){return(c,e)=>{let f;e&&(f=e.values[h.property],"color"===d.type&&(f=r._parseColor(f)));void 0===f&&(f=h.default);return void 0!==f?this._validate(f,d):d.default}};l._buildCategorical=function(h,d){return(c,e)=>{let f;e&&(f=e.values[h.property]);f=this._categorical(f,h.stops);return void 0!==f?f:void 0!==h.default?h.default:d.default}};l._buildInterval=function(h,d){return(c,e)=>{let f;e&&(f=e.values[h.property]);return"number"===typeof f?this._interval(f,h.stops):void 0!==
h.default?h.default:d.default}};l._buildInterpolate=function(h,d){return(c,e)=>{let f;e&&(f=e.values[h.property]);return"number"===typeof f?this._interpolate(f,h.stops,h.base||1):void 0!==h.default?h.default:d.default}};l._buildZoomInterpolate=function(h){return d=>this._interpolate(d,h.stops,h.base||1)};l._buildZoomInterval=function(h){return d=>this._interval(d,h.stops)};l._categorical=function(h,d){const c=d.length;for(let e=0;e<c;e++)if(d[e][0]===h)return d[e][1]};l._interval=function(h,d){const c=
d.length;let e=0;for(let f=0;f<c;f++)if(d[f][0]<=h)e=f;else break;return d[e][1]};l._interpolate=function(h,d,c){const e=d.length;for(let p=0;p<e;p++){const n=d[p];if(n[0]<=h)var f=n;else{var g=n;break}}if(f&&g){d=g[0]-f[0];h-=f[0];c=1===c?h/d:(Math.pow(c,h)-1)/(Math.pow(c,d)-1);if(Array.isArray(f[1])){f=f[1];g=g[1];h=[];for(d=0;d<f.length;d++)h.push(a.interpolate(f[d],g[d],c));return h}return a.interpolate(f[1],g[1],c)}if(f)return f[1];if(g)return g[1]};r._isEmpty=function(h){for(const d in h)if(h.hasOwnProperty(d))return!1;
return!0};r._parseColor=function(h){if(Array.isArray(h))return h;if("string"===typeof h){if(h=new b(h),!this._isEmpty(h))return b.toUnitRGBA(h)}else return h&&h.default&&(h.default=r._parseColor(h.default)),h&&h.stops&&(h.stops=h.stops.map(d=>[d[0],r._parseColor(d[1])])),h};return r}()})},"esri/views/2d/engine/webgl/definitions":function(){define(["exports"],function(b){b.ANGLE_FACTOR_256=256/360;b.ATTRIBUTE_DATA_ANIMATION=1;b.ATTRIBUTE_DATA_DD0=3;b.ATTRIBUTE_DATA_DD1=3;b.ATTRIBUTE_DATA_FILTER_FLAGS=
0;b.ATTRIBUTE_DATA_VV=2;b.ATTRIBUTE_STORE_TEXTURE_SIZE=1024;b.AVERAGE_GLYPH_MOSAIC_ITEM={metrics:{width:15,height:17,left:0,top:-7,advance:14}};b.COLLISION_BOX_PADDING=16;b.COLLISION_BUCKET_SIZE=128;b.COLLISION_EARLY_REJECT_BUCKET_SIZE=16;b.COLLISION_MAX_ZOOM_DELTA=1;b.COLLISION_PLACEMENT_PADDING=8;b.COLLISION_TILE_BOX_SIZE=4;b.DEBUG_LABELS=!1;b.DOT_DENSITY_MAX_FIELDS=8;b.EFFECT_FLAG_0=4;b.EXTRUDE_SCALE=64;b.FILTER_FLAG_0=2;b.GLYPH_SIZE=24;b.HEURISTIC_GLYPHS_PER_FEATURE=10;b.HEURISTIC_GLYPHS_PER_LINE=
50;b.HIGHLIGHT_FLAG=1;b.HITTEST_SEARCH_SIZE=6;b.MAGIC_LABEL_LINE_HEIGHT=29;b.MAX_FILTERS=2;b.MAX_GPU_UPLOADS_PER_FRAME=2;b.NAN_MAGIC_NUMBER=1E-30;b.PICTURE_FILL_COLOR=4294967295;b.RASTER_TILE_SIZE=256;b.SPRITE_PADDING=2;b.TEXTURE_BINDING_ATTRIBUTE_DATA_0=1;b.TEXTURE_BINDING_ATTRIBUTE_DATA_1=2;b.TEXTURE_BINDING_ATTRIBUTE_DATA_2=3;b.TEXTURE_BINDING_ATTRIBUTE_DATA_3=4;b.TEXTURE_BINDING_BITMAP=0;b.TEXTURE_BINDING_GLYPH_ATLAS=0;b.TEXTURE_BINDING_HIGHLIGHT_0=5;b.TEXTURE_BINDING_HIGHLIGHT_1=6;b.TEXTURE_BINDING_RENDERER_0=
5;b.TEXTURE_BINDING_RENDERER_1=6;b.TEXTURE_BINDING_SPRITE_ATLAS=0;b.TEXT_PLACEMENT_PADDING=8;b.THIN_LINE_THRESHOLD=2.5;b.TILE_SIZE=512;b.VTL_HIGH_RES_CUTOFF=1.15;b.VTL_TEXTURE_BINDING_UNIT_GLYPHS=6;b.VTL_TEXTURE_BINDING_UNIT_SPRITES=5;b.WEBGL_MAX_INNER_STOPS=6;b.WEBGL_MAX_STOPS=8;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./decluttering/config ./RenderBucket ../webgl/TiledDisplayObject".split(" "),
function(b,k,a,r,l,h,d){d=function(c){function e(g,p,n,w){n=c.call(this,g,n,w,[4096,4096])||this;n._referenced=0;n._hasSymbolBuckets=!1;n._memoryUsedByLayerData=0;n.layerData=new Map;n.layerCount=0;n.status="loading";n.allSymbolsFadingOut=!1;n.lastOpacityUpdate=0;n.symbols=new Map;n.isCoverage=!1;n.neededForCoverage=!1;n.decluttered=!1;n.invalidating=!1;n.parentTile=null;n.childrenTiles=new Set;n._processed=!1;n._referenced=1;n.styleRepository=p;n.id=g.id;n.transforms.tileUnitsToPixels=r.create();
return n}k._inheritsLoose(e,c);var f=e.prototype;f.setData=function(g){this.changeDataImpl(g);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};f.deleteLayerData=function(g){let p=!1;for(const n of g)this.layerData.has(n)&&(g=this.layerData.get(n),this._memoryUsedByLayerData-=g.memoryUsed,3===g.type&&this.symbols.has(n)&&(this.symbols.delete(n),p=!0),g.destroy(),this.layerData.delete(n),this.layerCount--);p&&this.emit("symbols-changed");this.requestRender()};f.processed=function(){return this._processed};
f.hasData=function(){return 0<this.layerCount};f.dispose=function(){e._destroyRenderBuckets(this.layerData);this.layerData=null;this._memoryUsedByLayerData=this.layerCount=0;this.destroy()};f.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};f.reference=function(){++this._referenced};f.getMemoryUsage=function(){return this._memoryUsedByLayerData/(this._referenced||1)};f.changeDataImpl=function(g){let p=!1;if(g){g=this._createRenderBuckets(g);for(const [n,w]of g)this.layerData.has(n)&&
(g=this.layerData.get(n),this._memoryUsedByLayerData-=w.memoryUsed,g.destroy(),this.layerData.delete(n),this.layerCount--),3===w.type&&(this.symbols.set(n,w.symbols),p=!0),this._memoryUsedByLayerData+=w.memoryUsed,this.layerData.set(n,w),this.layerCount++}this._hasSymbolBuckets=!1;for(const [,n]of this.layerData)3===n.type&&(this._hasSymbolBuckets=!0);p&&this.emit("symbols-changed")};f.attachWithContext=function(g){this.stage={context:g,trashDisplayObject(p){p.processDetach()},untrashDisplayObject(){return!1}}};
f.setTransform=function(g,p){c.prototype.setTransform.call(this,g,p);var n=p/(g.resolution*g.pixelRatio);p=this.size[0]/this.coordRange[0]*n;n*=this.size[1]/this.coordRange[1];const w=[0,0];g.toScreen(w,this.coords);const q=this.transforms.tileUnitsToPixels;a.identity(q);a.translate(q,q,w);a.rotate(q,q,Math.PI*g.rotation/180);a.scale(q,q,[p,n,1])};e._destroyRenderBuckets=function(g){const p=new Set;g.forEach(n=>{p.has(n)||(n.destroy(),p.add(n))});g.clear()};f._createRenderBuckets=function(g){const p=
new Map,n=new Map;for(const w of g){g=this._deserializeBucket(w,n);for(const q of g.layerUIDs)p.set(q,g)}return p};f._deserializeBucket=function(g,p){let n=p.get(g);if(n)return n;switch((new Uint32Array(g))[0]){case 1:n=new h.FillRenderBucket(g);break;case 2:n=new h.LineRenderBucket(g);break;case 3:n=new h.SymbolRenderBucket(g,this);break;case 4:n=new h.CircleRenderBucket(g)}p.set(g,n);return n};k._createClass(e,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",
get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<l.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<l.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}}]);return e}(d.TiledDisplayObject);b.VectorTile=d;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/chunks/mat3f32":function(){define(["exports"],function(b){function k(){const d=new Float32Array(9);d[0]=1;d[4]=1;d[8]=1;return d}function a(d){const c=new Float32Array(9);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];c[4]=d[4];c[5]=d[5];c[6]=d[6];c[7]=d[7];c[8]=d[8];return c}function r(d,c,e,f,g,p,n,w,q){const m=new Float32Array(9);m[0]=d;m[1]=c;m[2]=e;m[3]=f;m[4]=g;m[5]=p;m[6]=n;m[7]=w;m[8]=q;return m}function l(d,c){return new Float32Array(d,c,9)}var h=Object.freeze({__proto__:null,
create:k,clone:a,fromValues:r,createView:l});b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.mat3f32=h})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(b){b.COLLISION_GRID_CELL_SIZE=32;b.DECLUTTER_BUDGET=1.5;b.DECLUTTER_TILES=!0;b.FADE_DURATION=200;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../webgl/Program ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ./decluttering/util".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){r=function(){function w(m){this.layerUIDs=[];this.isDestroyed=!1;this.data=m;this.memoryUsed=m.byteLength;let u=1;m=new Uint32Array(m);this.layerUIDs=[];const v=m[u++];for(let y=0;y<v;y++)this.layerUIDs[y]=m[u++];this.bufferDataOffset=u}var q=w.prototype;q.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};q.prepareForRendering=function(m,u){a.isNone(this.data)||(this.doPrepareForRendering(m,u,this.data,this.bufferDataOffset),this.data=
null)};k._createClass(w,[{key:"isPreparedForRendering",get:function(){return a.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return w}();h=function(w){function q(u){var v=w.call(this,u)||this;v.type=2;v.lineIndexStart=0;v.lineIndexCount=0;let y=v.bufferDataOffset;u=new Uint32Array(u);v.lineIndexStart=u[y++];v.lineIndexCount=u[y++];v.isLineDataDriven=!!u[y++];v.bufferDataOffset=y;return v}k._inheritsLoose(q,w);var m=q.prototype;m.hasData=function(){return 0<this.lineIndexCount};
m.triangleCount=function(){return this.lineIndexCount/3};m.doDestroy=function(){a.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();a.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();a.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=null;this.memoryUsed=0};m.doPrepareForRendering=function(u,v,y,B){y=new Uint32Array(y);var x=new Int32Array(y.buffer);const C=y[B++];this.lineVertexBuffer=
l.createVertex(u,35044,new Int32Array(x.buffer,4*B,C));B+=C;x=y[B++];this.lineIndexBuffer=l.createIndex(u,35044,new Uint32Array(y.buffer,4*B,x));B+=x;this.lineVertexArrayObject=new d(u,v.getProgramAttributes(3),this.isLineDataDriven?q.lineVertexAttributesDD:q.lineVertexAttributes,{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return q}(r);h.lineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,
offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]};h.lineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},
{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};c=function(w){function q(u){var v=w.call(this,u)||this;v.type=1;v.fillIndexStart=0;v.fillIndexCount=0;v.outlineIndexStart=0;v.outlineIndexCount=0;let y=v.bufferDataOffset;u=new Uint32Array(u);v.fillIndexStart=u[y++];v.fillIndexCount=u[y++];v.outlineIndexStart=u[y++];v.outlineIndexCount=u[y++];v.isFillDataDriven=!!u[y++];v.isOutlineDataDriven=!!u[y++];v.bufferDataOffset=y;return v}k._inheritsLoose(q,w);var m=q.prototype;
m.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};m.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};m.doDestroy=function(){a.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();a.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();a.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;a.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();
a.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();a.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};m.doPrepareForRendering=function(u,v,y,B){y=new Uint32Array(y);var x=new Int32Array(y.buffer),C=y[B++];this.fillVertexBuffer=l.createVertex(u,35044,new Int32Array(x.buffer,4*B,C));B+=C;C=y[B++];this.fillIndexBuffer=l.createIndex(u,35044,new Uint32Array(y.buffer,
4*B,C));B+=C;C=y[B++];this.outlineVertexBuffer=l.createVertex(u,35044,new Int32Array(x.buffer,4*B,C));B+=C;x=y[B++];this.outlineIndexBuffer=l.createIndex(u,35044,new Uint32Array(y.buffer,4*B,x));B+=x;this.fillVertexArrayObject=new d(u,v.getProgramAttributes(1),this.isFillDataDriven?q.fillVertexAttributesDD:q.fillVertexAttributes,{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new d(u,v.getProgramAttributes(2),this.isOutlineDataDriven?q.outlineVertexAttributesDD:
q.outlineVertexAttributes,{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return q}(r);c.fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};c.fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};c.outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,
divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]};c.outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,
divisor:0}]};e=function(w){function q(u,v){var y=w.call(this,u)||this;y.type=3;y.iconPerPageElementsMap=new Map;y.glyphPerPageElementsMap=new Map;y.symbolInstances=[];y.isIconSDF=!1;y.opacityChanged=!1;y.lastOpacityUpdate=0;y.symbols=[];let B=y.bufferDataOffset;const x=new Uint32Array(u),C=new Int32Array(u);u=new Float32Array(u);y.isIconSDF=!!x[B++];y.isIconDataDriven=!!x[B++];y.isTextDataDriven=!!x[B++];var z=x[B++];for(var A=0;A<z;A++){var t=x[B++],D=x[B++],E=x[B++];y.iconPerPageElementsMap.set(t,
[D,E])}z=x[B++];for(A=0;A<z;A++)t=x[B++],D=x[B++],E=x[B++],y.glyphPerPageElementsMap.set(t,[D,E]);z=x[B++];A=x[B++];y.iconOpacity=new Int32Array(z);y.textOpacity=new Int32Array(A);B=n.deserializeSymbols(x,C,u,B,y.symbols,v);y.bufferDataOffset=B;return y}k._inheritsLoose(q,w);var m=q.prototype;m.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};m.triangleCount=function(){let u=0;this.iconPerPageElementsMap.forEach(v=>{u+=v[1]});this.glyphPerPageElementsMap.forEach(v=>
{u+=v[1]});return u/3};m.doDestroy=function(){a.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();a.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();a.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();a.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;a.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();a.isSome(this.textVertexBuffer)&&
this.textVertexBuffer.dispose();a.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();a.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};m.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var u=a.unwrap(this.iconOpacity),v=a.unwrap(this.iconOpacityBuffer);0<u.length&&u.byteLength===v.size&&v.setSubData(u);u=a.unwrap(this.textOpacity);
v=a.unwrap(this.textOpacityBuffer);0<u.length&&u.byteLength===v.size&&v.setSubData(u)}};m.doPrepareForRendering=function(u,v,y,B){y=new Uint32Array(y);var x=new Int32Array(y.buffer),C=y[B++];this.iconVertexBuffer=l.createVertex(u,35044,new Int32Array(x.buffer,4*B,C));B+=C;C=y[B++];this.iconIndexBuffer=l.createIndex(u,35044,new Uint32Array(y.buffer,4*B,C));B+=C;C=y[B++];this.textVertexBuffer=l.createVertex(u,35044,new Int32Array(x.buffer,4*B,C));B+=C;x=y[B++];this.textIndexBuffer=l.createIndex(u,35044,
new Uint32Array(y.buffer,4*B,x));B+=x;this.iconOpacityBuffer=l.createVertex(u,35044,a.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=l.createVertex(u,35044,a.unwrap(this.textOpacity).buffer);this.iconVertexArrayObject=new d(u,v.getProgramAttributes(4),this.isIconDataDriven?q.vertexAttributesDD:q.vertexAttributes,{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new d(u,v.getProgramAttributes(6),this.isTextDataDriven?q.vertexAttributesDD:
q.vertexAttributes,{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return q}(r);e.vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",
count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}]};e.vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_texAngleRange",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},
{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}],opacity:[{name:"a_opacityInfo",count:1,type:5121,offset:0,stride:1,normalized:!1,divisor:0}]};f=function(w){function q(u){var v=w.call(this,u)||this;v.type=4;v.circleIndexStart=0;v.circleIndexCount=0;let y=v.bufferDataOffset;u=new Uint32Array(u);v.circleIndexStart=u[y++];v.circleIndexCount=u[y++];v.bufferDataOffset=y;return v}k._inheritsLoose(q,w);var m=q.prototype;m.hasData=function(){return 0<this.circleIndexCount};m.triangleCount=
function(){return this.circleIndexCount/3};m.doDestroy=function(){a.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();a.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();a.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};m.doPrepareForRendering=function(u,v,y,B){y=new Uint32Array(y);var x=new Int32Array(y.buffer);const C=y[B++];this.circleVertexBuffer=
l.createVertex(u,35044,new Int32Array(x.buffer,4*B,C));B+=C;x=y[B++];this.circleIndexBuffer=l.createIndex(u,35044,new Uint32Array(y.buffer,4*B,x));B+=x;this.circleVertexArrayObject=new d(u,v.getProgramAttributes(5),q.circleVertexAttributes,{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return q}(r);f.circleVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},
{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};b.CircleRenderBucket=f;b.FillRenderBucket=c;b.LineRenderBucket=h;b.RenderBucketBase=r;b.SymbolRenderBucket=e;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./core"],function(b,
k,a,r){let l=function(e){this.tile=e;this.parent=null;this.children=new Set},h=function(){function e(){this.nodes=new Map;this.roots=new Set}var f=e.prototype;f.create=function(g){const p=new l(g);let n;const w=[];this.nodes.forEach(q=>{this._canConnectDirectly(p,q)&&w.push(q);!n&&this._canConnectDirectly(q,p)&&(n=q)});if(n){for(const q of w)n.children.delete(q),p.children.add(q),q.parent=p;n.children.add(p);p.parent=n}else{this.roots.add(p);for(const q of w)p.children.add(q),q.parent=p,this.roots.delete(q)}this.nodes.set(g.key.id,
p);return p};f.destroy=function(g){a.isSome(g.parent)?(g.parent.children.delete(g),g.children.forEach(p=>{a.isSome(g.parent)&&g.parent.children.add(p)})):this.roots.delete(g);g.children.forEach(p=>{(p.parent=g.parent)||this.roots.add(p)});this.nodes.delete(g.tile.key.id)};f.clear=function(){this.roots.clear();this.nodes.clear()};f._canConnectDirectly=function(g,p){let {level:n,row:w,col:q}=p.tile.key;for({world:p}=p.tile.key;0<n;){n--;w>>=1;q>>=1;if(g.tile.key.level===n&&g.tile.key.row===w&&g.tile.key.col===
q&&g.tile.key.world===p)return!0;if(this.nodes.has(`${n}/${w}/${q}/${p}`))break}return!1};return e}(),d=function(){function e(){this._tileGraph=new h;this._tileArray=null}var f=e.prototype;f.has=function(g){return"string"===typeof g?this._tileGraph.nodes.has(g):this._tileGraph.nodes.has(g.key.id)};f.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(g=>{this._tileArray.push(g.tile)}));return this._tileArray};f.getRoots=function(){const g=[];this._tileGraph.roots.forEach(p=>
{g.push(p.tile)});return g};f.getParent=function(g){g=this._tileGraph.nodes.get("string"===typeof g?g:g.key.id);return a.isSome(g.parent)&&g.parent.tile};f.getChildren=function(g){const p=[];this._tileGraph.nodes.get("string"===typeof g?g:g.key.id).children.forEach(n=>{p.push(n.tile)});return p};f.get=function(g){return this._tileGraph.nodes.get(g).tile};f.removeKey=function(g){g=this._tileGraph.nodes.get(g);this._tileGraph.destroy(g);this._tileArray=null};f.forEach=function(g){this._tileGraph.nodes.forEach((p,
n)=>g(p.tile,n))};f.add=function(g){this._tileGraph.create(g);this._tileArray=null};f.remove=function(g){g=this._tileGraph.nodes.get(g.key.id);this._tileGraph.destroy(g);this._tileArray=null};f.clear=function(){this._tileGraph.clear();this._tileArray=[]};return e}(),c=function(){function e(g,p,n){this._rows=Math.ceil(p/n);this._columns=Math.ceil(g/n);this._cellSize=n;this.cells=Array(this._rows);for(g=0;g<this._rows;g++)for(this.cells[g]=Array(this._columns),p=0;p<this._columns;p++)this.cells[g][p]=
[]}var f=e.prototype;f.getCell=function(g,p){p=Math.min(Math.max(Math.floor(p/this._cellSize),0),this._rows-1);g=Math.min(Math.max(Math.floor(g/this._cellSize),0),this._columns-1);return this.cells[p]&&this.cells[p][g]||null};f.getCellSpan=function(g,p,n,w){return[Math.min(Math.max(Math.floor(g/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(p/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(n/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(w/this._cellSize),
0),this.rows-1)]};k._createClass(e,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return e}();b.GridIndex=c;b.TileForest=d;b.TileGraph=h;b.TileNode=l;b.deserializeSymbols=function(e,f,g,p,n,w){const q=f[p++];for(let v=0;v<q;v++){const y=new r.VTLSymbol(w);y.xTile=f[p++];y.yTile=f[p++];y.hash=f[p++];y.priority=f[p++];var m=f[p++];for(var u=0;u<m;u++){const B=f[p++],x=f[p++],C=f[p++],z=f[p++],
A=!!f[p++],t=f[p++],D=g[p++],E=g[p++],G=f[p++],H=f[p++];y.colliders.push({xTile:B,yTile:x,dxPixels:C,dyPixels:z,hard:A,partIndex:t,width:G,height:H,minLod:D,maxLod:E})}m=e[p++];for(u=0;u<m;u++)y.textVertexRanges.push([e[p++],e[p++]]);m=e[p++];for(u=0;u<m;u++)y.iconVertexRanges.push([e[p++],e[p++]]);n.push(y)}return p};b.tileCoordChange=function(e,f,g,p,n,w){g-=n;if(0<=g)return(f>>g)+(p-(w<<g))*(e>>g);g=-g;return f-(w-(p<<g))*(e>>g)<<g};b.writeOpacityToBuffers=function(e,f,g){for(const [v,y]of e.symbols){{var p=
e,n=f,w=g,q=y;const B=p.layerData.get(v);if(3===B.type){for(const x of q){q=x.unique;var m=void 0;if(x.selectedForRendering){var u=q.parts[0];m=u.startOpacity;u=u.targetOpacity;p.allSymbolsFadingOut=p.allSymbolsFadingOut&&0===u;m=w?Math.floor(127*m)|u<<7:u?255:0;m|=m<<24|m<<16|m<<8}else m=0;for(const [C,z]of x.iconVertexRanges)for(u=C;u<C+z;u+=4)B.iconOpacity[u/4]=m;x.selectedForRendering?(m=q.parts[1],q=m.startOpacity,m=m.targetOpacity,p.allSymbolsFadingOut=p.allSymbolsFadingOut&&0===m,q=w?Math.floor(127*
q)|m<<7:m?255:0,m=q<<24|q<<16|q<<8|q):m=0;for(const [C,z]of x.textVertexRanges)for(q=C;q<C+z;q+=4)B.textOpacity[q/4]=m}B.lastOpacityUpdate=n;B.opacityChanged=!0}}}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(b){b.VTLSymbol=function(k){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=k};b.VTLUniqueSymbol=function(){this.tileSymbols=
[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/mat3 ../../tiling/TileKey ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(b,k,a,r,l,h,d){a=function(c){function e(g,p,n,w=n){var q=c.call(this)||
this;q.triangleCountReportedInDebug=0;q.transforms={dvs:h.create(),tileMat3:h.create()};q.triangleCount=0;q.key=new l(g);q.bounds=p;q.size=n;q.coordRange=w;return q}k._inheritsLoose(e,c);var f=e.prototype;f.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};f.setTransform=function(g,p){p/=g.resolution*g.pixelRatio;const n=this.transforms.tileMat3,[w,q]=g.toScreenNoRotation([0,0],this.coords);r.set(n,this.size[0]/this.coordRange[0]*p,0,0,0,this.size[1]/this.coordRange[1]*
p,0,w,q,1);r.multiply(this.transforms.dvs,g.displayViewMat3,n)};k._createClass(e,[{key:"coords",get:function(){return this._coords}},{key:"bounds",get:function(){return this._bounds},set:function(g){this._coords=[g[0],g[3]];this._bounds=g}}]);return e}(d.DisplayObject);b.TiledDisplayObject=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/DisplayObject":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/has","../../../core/promiseUtils",
"../../../core/Evented"],function(b,k,a,r,l){const h=1/a("mapview-transitions-duration");a=function(d){function c(){var f=d.apply(this,arguments)||this;f._fadeOutResolver=null;f._fadeInResolver=null;f._clips=null;f.computedVisible=!0;f.computedOpacity=1;f.fadeTransitionEnabled=!1;f.inFadeTransition=!1;f._isReady=!1;f._opacity=1;f._stage=null;f._visible=!0;return f}k._inheritsLoose(c,d);var e=c.prototype;e.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&
(this._fadeOutResolver(),this._fadeOutResolver=null);this.computedOpacity=0;this.fadeTransitionEnabled=!0;this._fadeInResolver=r.createResolver();this.requestRender();return this._fadeInResolver.promise};e.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=r.createResolver();this.requestRender();return this._fadeOutResolver.promise};e.beforeRender=
function(f){this.updateTransitionProperties(f.deltaTime,f.state.scale)};e.afterRender=function(f){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};e.setTransform=function(f){};e.processRender=function(f){this.stage&&this.computedVisible&&this.doRender(f)};e.requestRender=function(){this.stage&&this.stage.requestRender()};e.processDetach=
function(){this.onDetach();this.emit("detach")};e.updateTransitionProperties=function(f,g){if(this.fadeTransitionEnabled){g=this._fadeOutResolver||!this.visible?0:this.opacity;const p=this.computedOpacity;p===g?this.computedVisible=this.visible:(f*=h,this.computedOpacity=p>g?Math.max(g,p-f):Math.min(g,p+f),this.computedVisible=0<this.computedOpacity,f=g===this.computedOpacity,this.inFadeTransition=!f,f||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible};
e.onAttach=function(){};e.onDetach=function(){};e.doRender=function(f){};e.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};k._createClass(c,[{key:"clips",get:function(){return this._clips},set:function(f){this._clips=f;this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(f){this._opacity!==f&&(this._opacity=Math.min(1,Math.max(f,0)),this.requestRender())}},{key:"stage",
get:function(){return this._stage},set:function(f){if(this._stage!==f){var g=this._stage;(this._stage=f)?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):g.trashDisplayObject(this)}}},{key:"visible",get:function(){return this._visible},set:function(f){this._visible!==f&&(this._visible=f,this.requestRender())}}]);return c}(l);b.DisplayObject=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/RasterTile":function(){define(["../../../chunks/_rollupPluginBabelHelpers",
"../../../core/maybe","../../webgl/rasterUtils"],function(b,k,a){const r={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,type:"stretch"};return function(){function l(d,c,e=null,f=null){this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=this._transformGrid=
null;this.scale=1;this.offset=[0,0];this.opacity=1;this.lij=d;this.source=c;this.width=e||c.width;this.height=f||c.height}var h=l.prototype;h.bind=function(d){if(!(this.source&&this.source.pixels&&0<this.source.pixels.length))return!1;this._rasterTexture&&!this._dirty||this._updateRasterTexture(d,this.bandIds);this._rasterTexture&&(this._updateColormapTexture(d),this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=a.createTransformTexture(d,this.transformGrid)));return!0};
h.getUniforms=function(){const d=a.getBasicGridUniforms(this.scale,this.offset),{symbolizerParameters:c,transformGrid:e,width:f,height:g,opacity:p}=this,n=a.getCommonUniforms(e,[f,g],[this.source.width,this.source.height],p),w=c.colormap?a.getColormapUniforms(c.colormap,c.colormapOffset):null,q="stretch"===this.symbolizerParameters.type?a.getStretchUniforms(this.symbolizerParameters):null,m="hillshade"===this.symbolizerParameters.type?a.getShadedReliefUniforms(this.symbolizerParameters):null;return{basic:d,
common:n,colormap:w,stretch:q,hillshade:m}};h.getTextures=function(){if(!this._rasterTexture)return null;const d=[],c=[];this._transformGridTexture&&(c.push(this._transformGridTexture),d.push("u_transformGrid"));this._rasterTexture&&(c.push(this._rasterTexture),d.push("u_image"));this._colormapTexture&&(c.push(this._colormapTexture),d.push("u_colormap"));return{names:d,textures:c}};h.getMemoryUsage=function(){if(k.isNone(this._memoryUsed)){const d=this.getTextures();if(null==d)return 0;this._memoryUsed=
d.textures.map(c=>c.descriptor.width*c.descriptor.height*4).reduce((c,e)=>c+e)}return this._memoryUsed};h.release=function(){this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null);this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null);this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null);this.rawPixelData=this.transformGrid=this.source=null;return!0};h._updateRasterTexture=function(d,c){const e=this.source?
this.source.extractBands(c):null;if(e&&e.pixels&&0<e.pixels.length){c=k.isNone(c)&&k.isNone(this.bandIds)||k.isSome(c)&&k.isSome(this.bandIds)&&c.join("")===this.bandIds.join("");if(this._rasterTexture){if(c)return;this._rasterTexture.dispose();this._rasterTexture=null}this._rasterTexture=a.createRasterTexture(d,e,this.interpolation||"nearest")}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null)};h._updateColormapTexture=function(d){const c=this._colormap,e=this.symbolizerParameters.colormap;
if(!e)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!c)this._colormapTexture=a.createColormapTexture(d,e),this._colormap=e;else if(e.length!==c.length||e.some((f,g)=>f!==c[g]))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=a.createColormapTexture(d,e),this._colormap=e};b._createClass(l,[{key:"source",get:function(){return this._source},set:function(d){this._source=d;this._rasterTexture&&
(this._rasterTexture.dispose(),this._memoryUsed=this._rasterTexture=null)}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||r},set:function(d){this._symbolizerParameters=d}},{key:"bandIds",get:function(){return this._bandIds},set:function(d){k.isSome(d)&&0<d.length?this._bandIds&&d.every((c,e)=>this._bandIds[e]?c===this._bandIds[e]:!1)||(this._bandIds=d,this._dirty=!0):this._bandIds=null}},{key:"interpolation",get:function(){return this._interpolation},set:function(d){this._interpolation=
d;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===d?9729:9728)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(d){this._transformGrid=d;this._transformGridTexture&&(this._transformGridTexture.dispose(),this._memoryUsed=this._transformGridTexture=null)}}]);return l}()})},"esri/views/webgl/rasterUtils":function(){define("exports ./Program ./BufferObject ./Texture ./VertexArrayObject ./Renderbuffer ./FramebufferObject ./ProgramCache ./RenderingContext ./ShaderCompiler".split(" "),
function(b,k,a,r,l,h,d,c,e,f){b.createColormapTexture=function(g,p){return new r(g,{width:p.length/4,height:1,target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,flipped:!1},p)};b.createFrameBuffer=function(g,p,n,w){w=new r(g,{width:p,height:n,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:9728,dataType:w?5121:5126,wrapMode:33071,flipped:!1});return new d(g,{colorTarget:0,depthStencilTarget:3,width:p,height:n},w)};b.createRasterTexture=function(g,
p,n="nearest",w=!1){var q,m=!(w&&"u8"===p.pixelType);w=m?5126:5121;m=null==p.pixels||0===p.pixels.length?null:m?p.getAsRGBAFloat():p.getAsRGBA();const u=null==(q=g.capabilities.textureFloat)?void 0:q.textureFloatLinear;return new r(g,{width:p.width,height:p.height,target:3553,pixelFormat:6408,internalFormat:6408,samplingMode:!u||"bilinear"!==n&&"cubic"!==n?9728:9729,dataType:w,wrapMode:33071,flipped:!1},m)};b.createTransformTexture=function(g,p){var n=4*p.size[0],w=p.size[1];const q={width:n,height:w,
target:3553,pixelFormat:6408,internalFormat:6408,dataType:5126,samplingMode:9728,wrapMode:33071,flipped:!1};n=new Float32Array(n*w*4);w=0;for(let m=0;m<p.coefficients.length;m++)n[w++]=p.coefficients[m],2===m%3&&(n[w++]=1);return new r(g,q,n)};b.getBasicGridUniforms=function(g,p){return{u_scale:g,u_offset:p}};b.getColormapUniforms=function(g,p){return{u_colormapOffset:p||0,u_colormapMaxIndex:g?g.length/4-1:null}};b.getCommonUniforms=function(g,p,n,w=1,q=!0,m=!1){return{u_flipY:q,u_isFloatTexture:m,
u_applyTransform:g?!0:!1,u_opacity:w,u_transformSpacing:g?g.spacing:null,u_transformGridSize:g?g.size:null,u_targetImageSize:p,u_srcImageSize:n}};b.getShadedReliefUniforms=function(g){return{u_hillshadeType:g.hillshadeType,u_sinZcosAs:g.sinZcosAs,u_sinZsinAs:g.sinZsinAs,u_cosZs:g.cosZs,u_weights:g.weights,u_factor:g.factor,u_minValue:g.minValue,u_maxValue:g.maxValue}};b.getStretchUniforms=function(g){return{u_bandCount:g.bandCount,u_minOutput:g.outMin,u_maxOutput:g.outMax,u_minCutOff:g.minCutOff,
u_maxCutOff:g.maxCutOff,u_factor:g.factor,u_useGamma:g.useGamma,u_gamma:g.gamma,u_gammaCorrection:g.gammaCorrection}};b.getUniformLocationInfos=function(g,p){g=g.gl;p=p.glName;const n=g.getProgramParameter(p,g.ACTIVE_UNIFORMS),w=new Map;let q;for(let m=0;m<n;m++)(q=g.getActiveUniform(p,m))&&w.set(q.name,{location:g.getUniformLocation(p,q.name),info:q});return w};b.setTextures=function(g,p,n,w){n.length===w.length&&(w.some(q=>null==q)||n.some(q=>null==q)||n.forEach((q,m)=>{p.setUniform1i(q,m);g.bindTexture(w[m],
m)}))};b.setUniforms=function(g,p,n){Object.keys(n).forEach(w=>{var q=p.get(w)||p.get(w+"[0]");if(q){var m=n[w];if(null!==q&&null!=m)switch({info:q}=q,q.type){case 5126:1<q.size?g.setUniform1fv(w,m):g.setUniform1f(w,m);break;case 35664:g.setUniform2fv(w,m);break;case 35665:g.setUniform3fv(w,m);break;case 35666:g.setUniform4fv(w,m);break;case 35675:g.setUniformMatrix3fv(w,m);break;case 35676:g.setUniformMatrix4fv(w,m);break;case 5124:1<q.size?g.setUniform1iv(w,m):g.setUniform1i(w,m);break;case 35670:g.setUniform1i(w,
m?1:0);break;case 35667:case 35671:g.setUniform2iv(w,m);break;case 35668:case 35672:g.setUniform3iv(w,m);break;case 35669:case 35673:g.setUniform4iv(w,m)}}})};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ./vec3f64 ./vec3 ../geometry/support/aaBoundingRect ../views/3d/terrain/TilingScheme ../views/3d/terrain/TerrainConst".split(" "),function(b,k,a,r,l,h,d){function c(m,u,v=0){m=m.extent;return 0===v?l.containsPoint(m,
u):l.containsPointWithMargin(m,u,v*Math.min(m[2]-m[0],m[3]-m[1]))}function e(m,u,v,y){r.copy(p,v);p[y]=u[y];y=r.subtract(p,p,u);var B=r.subtract(n,m,u);B=r.dot(B,y);const x=r.dot(y,y);u=0>=B?u:x<=B?v:r.add(p,u,r.scale(y,y,B/x));m=r.subtract(p,m,u);return Math.PI/2-Math.atan(m[2]/Math.sqrt(m[0]*m[0]+m[1]*m[1]))}function f(m,u){var v=m.elevationBounds;m=m.extent;v=.5*(v.min+v.max);w[0]=m[0];w[1]=m[1];w[2]=v;q[0]=m[2];q[1]=m[3];q[2]=v;m=v=Infinity;u[0]<w[0]?v=e(u,w,q,0):u[0]>q[0]&&(v=e(u,q,w,0));u[1]<
w[1]?m=e(u,w,q,1):u[1]>q[1]&&(m=e(u,q,w,1));return Math.min(v,m)}function g(m,u,v){if(m.spatialReference.isGeographic)return new k("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var y=h.checkUnsupported(m);if(y)return y;{var B=m.lods;y=B[0].resolution*Math.pow(2,B[0].level);var x=[y*m.size[0],y*m.size[1]];const C=[m.origin.x,m.origin.y];v=l.fromExtent(v);const z=l.create();h.computeRowColExtent(v,x,C,z);x=(z[2]-z[0])*(z[3]-z[1]);x>d.MAX_ROOT_TILES?
(B=B[0].scale*Math.pow(2,B[0].level),y=Math.max((v[3]-v[1])/m.size[1],(v[2]-v[0])/m.size[0])*B/y,v=Math.floor(Math.log(y)/Math.log(10)),y=Math.ceil(y/Math.pow(10,v))*Math.pow(10,v),y=new k("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(B).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+y.toLocaleString()+".",{level0Scale:B,suggestedLevel0Scale:y,requiredNumRootTiles:x,allowedNumRootTiles:d.MAX_ROOT_TILES})):y=null}return y?y:
u&&!m.spatialReference.equals(u)?new k("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}const p=a.create(),n=a.create(),w=a.create(),q=a.create();a=Object.freeze({__proto__:null,isInsideExtent:c,tiltOnEdge:e,tiltToExtentEdge:f,checkIfTileInfoSupportedForViewSR:g});b.checkIfTileInfoSupportedForViewSR=g;b.isInsideExtent=c;b.terrainUtilsPlanar=a;b.tiltOnEdge=e;b.tiltToExtentEdge=f})},"esri/chunks/terrainUtilsSpherical":function(){define(["exports",
"../core/Error","../geometry/support/spatialReferenceUtils","../geometry/projection","../views/3d/terrain/TilingScheme"],function(b,k,a,r,l){function h(){return!0}function d(){return 0}function c(f,g){const p=f.lods.length-1,n=f.spatialReference,w=r.canProjectToWGS84ComparableLonLat(n)||a.isMars(n)||a.isMoon(n);if(n.isWebMercator){if(!l.makeWebMercatorAuxiliarySphere(p).compatibleWith(f))return new k("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(w){if(!l.makeGCSWithTileSize(f.spatialReference,
f.size[0],p).compatibleWith(f))return f.spatialReference.isWGS84?new k("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new k("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new k("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(g&&!f.spatialReference.equals(g))return new k("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}var e=Object.freeze({__proto__:null,isInsideExtent:h,tiltToExtentEdge:d,checkIfTileInfoSupportedForViewSR:c});b.checkIfTileInfoSupportedForViewSR=c;b.isInsideExtent=h;b.terrainUtilsSpherical=e;b.tiltToExtentEdge=d})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(b){return function(){function k(r){this._texture=r;this._refCount=1}var a=k.prototype;a.retain=function(){++this._refCount};
a.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};a.generateMipmap=function(){this._texture.generateMipmap()};b._createClass(k,[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}}]);return k}()})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/maybe","../layers/support/MemoryManagedLayerView","../terrain/terrainUtils","./LayerPerformanceInfo"],function(b,k,a,r){return function(l){this.usedMemory=
this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];var h=l.resourceController.memoryController;this.totalMemory=1048576*h.maxMemory;this.usedMemory=Math.round(h.usedMemory*this.totalMemory);this.quality=h.memoryFactor;this.load=l.resourceController.scheduler.load;this.terrainMemory=l.basemapTerrain?l.basemapTerrain.getUsedMemory():0;h=l._stage&&l._stage.renderView&&l._stage.renderView.edgeView;this.edgesMemory=b.isSome(h)?h.getUsedMemory():
0;l.allLayerViews.items.forEach(d=>{(k.isMemoryManagedLayerView(d)||a.isSurfaceLayerView(d))&&this.layerPerformanceInfos.push(new r(d,l))});this.layerPerformanceInfos.sort((d,c)=>c.memory-d.memory)}})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],function(b,k){return function(a,r){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=
a.layer;this.memory=k.isSurfaceLayerView(a)?r.basemapTerrain.getUsedMemoryForLayerView(a):a.getUsedMemory();b.isPerformanceInfoLayerView(a)&&(a=a.performanceInfo,this.displayedNumberOfFeatures=a.displayedNumberOfFeatures,this.maximumNumberOfFeatures=a.maximumNumberOfFeatures,this.totalNumberOfFeatures=a.totalNumberOfFeatures)}})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],function(b){b.isPerformanceInfoLayerView=function(k){return"performanceInfo"in k};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../core/arrayUtils ../../../core/Handles ../../../geometry/projectionEllipsoid ../webgl-engine/lib/screenSizePerspectiveUtils ./TextureCollection".split(" "),function(b,k,a,r,l,h){let d=function(){function e(g){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=null;this.viewState=g.viewState;this.view=g.view;this.pointsOfInterest=
g.pointsOfInterest;this.objectResourceCache=g.objectResourceCache;this.streamDataRequester=g.resourceController.createStreamDataRequester(4);this.textures=new h.TextureCollection(this.streamDataRequester,g.view._stage,{preMultiplyAlpha:!0,wrap:{s:33071,t:33071}},g.resourceController.scheduler);const p=r.getReferenceEllipsoid(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=l.getSettings(g.viewingMode,p);this.screenSizePerspectiveSettingsLabels=l.getLabelSettings(g.viewingMode,
p)}var f=e.prototype;f.destroy=function(){this.textures.destroy();this.streamDataRequester=this.textures=null};f.addGraphicsOwner=function(g){if(!g)return{remove(){}};this.graphicsOwners.push(g);const p="layer"in g?g.watch("layer.screenSizePerspectiveEnabled",()=>this.updateScreenSizePerspectiveEnabled()):null;this.updateScreenSizePerspectiveEnabled();return{remove:()=>{p&&(p.remove(),k.removeUnordered(this.graphicsOwners,g),this.updateScreenSizePerspectiveEnabled())}}};f.updateScreenSizePerspectiveEnabled=
function(){var g=this.graphicsOwners.some(p=>!0===p.get("layer.screenSizePerspectiveEnabled"));g&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new a,g=()=>this.updateScreenSizePerspectiveSettings(),this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",g,!0),this.viewState.events.on("camera-projection-changed",g)]),this.updateScreenSizePerspectiveSettings()):!g&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),
this.screenSizePerspectiveHandles=null)};f.updateScreenSizePerspectiveSettings=function(){c.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;c.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(c);this.screenSizePerspectiveSettingsLabels.update(c);this.view._stage.renderView.setNeedsRender()};return e}();const c={distance:0,fovY:0};b.SharedSymbolResources=d;b.default=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/TextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/urlUtils ../../../core/promiseUtils ../../support/Scheduler ../webgl-engine/lib/Texture".split(" "),
function(b,k,a,r,l,h,d){let c=function(){function e(g,p,n,w){this._streamDataRequester=g;this._stage=p;this._textureOptions=n;this._textureRequests=new Map;this._frameTask=a.isSome(w)?w.registerTask(h.Task.TEXTURE_UNLOAD,()=>{},()=>!1):h.ImmediateTask}var f=e.prototype;f.destroy=function(){this._frameTask.remove();this._textureRequests.forEach(g=>this.releaseTextureRequest(g));this._textureRequests.clear()};f.fromUrl=async function(g,p,n){l.throwIfAborted(n);const w=a.isSome(n)&&n.signal,q=this.makeUid(g,
p);let m=this._textureRequests.get(q);if(!m){n=l.createAbortController();const u=this._streamDataRequester.request(g,"image",{uid:q,signal:n.signal});m={referenceCount:0,texture:null,textureAsync:null,abortController:n};this._textureRequests.set(q,m);m.textureAsync=u.then(v=>{v=this.createTexture(g,v,p);m.texture=v;m.abortController=null;this.addToStage(v);return{uid:q,texture:v}},v=>{m.abortController=null;throw v;})}m.referenceCount++;return l.create((u,v)=>{l.onAbort(w,()=>{v(l.createAbortError())});
m.textureAsync.then(u,v)}).catch(u=>{this.release(q);throw u;})};f.fromData=function(g,p){g=this.makeUid(g);let n=this._textureRequests.get(g);n||(n={referenceCount:0,texture:p(),textureAsync:null,abortController:null},this.addToStage(n.texture),this._textureRequests.set(g,n));n.referenceCount++;return{uid:g,texture:n.texture}};f.release=function(g){if(this._textureRequests){var p=this._textureRequests.get(g);p?(1>p.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+
g),p.referenceCount--,1>p.referenceCount&&this._frameTask.schedule(()=>this.releaseNow(g))):console.warn(`TextureCollection: texture doesn't exist: '${g}'`)}};f.releaseNow=function(g){if(this._textureRequests){var p=this._textureRequests.get(g);!p||0<p.referenceCount||(this.releaseTextureRequest(p),this._textureRequests.delete(g))}};f.releaseTextureRequest=function(g){g.texture?this.removeFromStage(g.texture):g.abortController&&(g.abortController.abort(),g.abortController=null)};f.createTexture=function(g,
p,n){r.isSVG(g)&&(n||0===p.width&&0===p.height)&&(g=p.width?p.height/p.width:1,n=n||64,1<g?(p.width=Math.round(n/g),p.height=n):(p.width=n,p.height=Math.round(n*g)));return new d(p,"symbol",{...this._textureOptions,width:p.width,height:p.height,powerOfTwoResizeMode:2})};f.addToStage=function(g){this._stage.add(4,g)};f.removeFromStage=function(g){this._stage.remove(4,g.id)};f.makeUid=function(g,p){return null!=p?`${g}.${p}px`:g};k._createClass(e,[{key:"test",get:function(){return{textureRequests:this._textureRequests}}}]);
return e}();b.TextureCollection=c;b.default=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/Handles ../../../support/Scheduler ../../../../chunks/ray ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/lib/Intersector ../PropertiesPool ./disposeMembers ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H){b.PointsOfInterest=function(L){function S(T){T=L.call(this,T)||this;T.handles=new u;T.surfaceAltitudeAtCenter=0;T.surfaceAltitudeAtCenterDirty=!0;T.surfaceAltitudeAtCenterWithContent=0;T.surfaceAltitudeAtCenterWithContentDirty=!0;T.propertiesPool=new C.PropertiesPool({renderPointOfView:I},k._assertThisInitialized(T));T.renderPointOfView=q.create();return T}k._inheritsLoose(S,L);var M=S.prototype;M.initialize=function(){const {state:T,
basemapTerrain:O,renderCoordsHelper:Q,map:F}=this.view;this.surfaceIntersector=new x.Intersector(T.mode);this.surfaceIntersector.options.backfacesTerrain=T.isGlobal?!1:!0;this.surfaceIntersector.options.invisibleTerrain=!1;this.contentIntersector=new x.Intersector(T.mode);this.contentIntersectorOptions={exclude:new Set([B.TERRAIN_ID])};const N=()=>this.estimateSurfaceAltitudeAtCenter(),P={state:T,scheduler:this.view.resourceController.scheduler,surface:O,renderCoordsHelper:Q};this._set("centerOnSurfaceInfrequent",
new t["default"]({...P,task:v.Task.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:N}));this._set("centerOnSurfaceFrequent",new t["default"]({...P,task:v.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:N}));this._set("centerOnContent",new t["default"]({...P,task:v.Task.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this.estimateSurfaceAltitudeAtCenterWithContent()}));this._set("cameraOnSurface",new A["default"]({...P,task:v.Task.POINT_OF_INTEREST_INFREQUENT,
map:F}));this._set("surfaceGeometryUpdates",new H["default"]({...P,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new D.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:Q}));this._set("surfaceOrigin",new G["default"]({view:this.view}));this._set("focus",new E["default"]({state:T,surface:O,renderCoordsHelper:Q,centerOnSurface:this.centerOnSurfaceFrequent}));E.setupFocusDebugGraphic(this.view.graphics);
this.handles.add([T.watch("camera",U=>this.cameraChanged(U),!0),O.watch("extent",()=>this.updateCenterPointsOfInterest()),this.surfaceGeometryUpdates.events.on("request-update",()=>this.updateCenterPointsOfInterest()),this.contentGeometryUpdates.events.on("request-update",()=>this.updateCenterOnContent())]);this.cameraChanged(this.view.state.camera);this.centerOnContent.update();this.centerOnSurfaceFrequent.update();this.centerOnSurfaceInfrequent.update();this.cameraOnSurface.update()};M.destroy=
function(){z.disposeMembers(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};M.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;const T=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,K);if(l.isNone(T))return this.surfaceAltitudeAtCenterWithContent;
this.view.sceneIntersectionHelper.intersectRay(T,this.contentIntersector,J,this.contentIntersectorOptions)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(J):this.surfaceAltitudeAtCenterWithContent=this.estimateSurfaceAltitudeAtCenter(T);return this.surfaceAltitudeAtCenterWithContent};M.estimateSurfaceAltitudeAtCenter=function(T=null){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=
!1;const O=this.view.state.camera;if(l.isNone(T)&&(T=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(O,K),l.isNone(T)))return this.surfaceAltitudeAtCenter;const Q=T.origin,F=m.add(J,T.origin,T.direction);this.surfaceIntersector.resetWithRay(T);this.surfaceIntersector.intersect(null,null,O);this.view.basemapTerrain.intersect(this.surfaceIntersector,null,Q,F);this.surfaceIntersector.results.min.getIntersectionPoint(J)&&(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(J));
return this.surfaceAltitudeAtCenter};M.cameraChanged=function(T){this.updateCenterPointsOfInterest();T=T.eye;m.exactEquals(this.renderPointOfView,T)||this._set("renderPointOfView",m.copy(this.propertiesPool.get("renderPointOfView"),T))};M.updateCenterPointsOfInterest=function(){this.surfaceAltitudeAtCenterWithContentDirty=this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.updateRenderLocation();this.centerOnSurfaceInfrequent.updateRenderLocation();this.cameraOnSurface.updateRenderLocation();
this.focus.updateRenderLocation();this.centerOnContent.updateRenderLocation()};M.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.updateRenderLocation()};k._createClass(S,[{key:"updating",get:function(){var T,O,Q,F,N,P;return!!(null!=(T=this.surfaceGeometryUpdates)&&T.updating||null!=(O=this.centerOnContent)&&O.updating||null!=(Q=this.centerOnSurfaceInfrequent)&&Q.updating||null!=(F=this.centerOnSurfaceFrequent)&&F.updating||null!=(N=this.cameraOnSurface)&&
N.updating||null!=(P=this.focus)&&P.updating)}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.update();this.centerOnSurfaceFrequent.update();this.centerOnSurfaceInfrequent.update()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return S}(w);a.__decorate([c.property({readOnly:!0})],b.PointsOfInterest.prototype,"centerOnContent",void 0);a.__decorate([c.property({readOnly:!0})],b.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);a.__decorate([c.property({readOnly:!0})],
b.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);a.__decorate([c.property({readOnly:!0})],b.PointsOfInterest.prototype,"cameraOnSurface",void 0);a.__decorate([c.property({readOnly:!0})],b.PointsOfInterest.prototype,"focus",void 0);a.__decorate([c.property({readOnly:!0})],b.PointsOfInterest.prototype,"renderPointOfView",void 0);a.__decorate([c.property({readOnly:!0})],b.PointsOfInterest.prototype,"surfaceOrigin",void 0);a.__decorate([c.property({readOnly:!0})],b.PointsOfInterest.prototype,
"contentGeometryUpdates",void 0);a.__decorate([c.property({readOnly:!0})],b.PointsOfInterest.prototype,"surfaceGeometryUpdates",void 0);a.__decorate([c.property({constructOnly:!0})],b.PointsOfInterest.prototype,"view",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:"surfaceGeometryUpdates.updating centerOnContent.updating centerOnSurfaceInfrequent.updating centerOnSurfaceFrequent.updating cameraOnSurface.updating focus.updating".split(" ")})],b.PointsOfInterest.prototype,"updating",null);
b.PointsOfInterest=a.__decorate([f.subclass("esri.views.3d.support.PointsOfInterest")],b.PointsOfInterest);const I=Array,J=q.create(),K=y.create();b.default=b.PointsOfInterest;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["exports","../../../../core/Accessor"],function(b,k){function a(r,...l){if(r instanceof k&&r.destroyed)try{throw Error("instance is already destroyed");}catch(h){console.warn(h.stack)}else for(const h of l){if(!(h in
r))throw Error(`Property '${h}' does not exist and cannot be disposed`);(l=r[h])&&("function"===typeof l.destroy?l.destroy():"function"===typeof l.dispose?l.dispose():"function"===typeof l.remove&&l.remove());r instanceof k&&h in r.__accessor__.metadatas?r._set(h,null):r[h]=null}}b.default=a;b.disposeMembers=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../geometry/Point ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/watchUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){const B=Array;b.CameraOnSurface=function(z){function A(D){D=z.call(this,D)||this;D._dirty=!1;D._propertiesPool=new v.PropertiesPool({location:w,renderLocation:B},k._assertThisInitialized(D));D._estimatedSurfaceAltitude=0;D._pendingElevationQueryController=null;D.renderLocation=q.create();return D}k._inheritsLoose(A,z);var t=A.prototype;t.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,()=>this._measureSurfaceAltitude(),
()=>this._needsUpdate()));this._measureSurfaceAltitude();if(this.map){const D=()=>this._setDirty();this.handles.add([u.on(this.map,"ground.layers","change",D,D,D)])}};t.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};t.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};t.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};t._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};
t._needsUpdate=function(){return!this._pendingElevationQueryController&&this._dirty};t._cancelPendingRequest=function(){const D=this._pendingElevationQueryController;D&&(this._pendingElevationQueryController=null,D.abort(),this.notifyChange("updating"))};t._measureSurfaceAltitude=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,C,this.state.spatialReference);var D=n.createAbortController();
this.map.ground.queryElevation(C,{signal:D.signal}).then(E=>this._updateSurfaceAltitude(E.geometry.z)).catch(E=>{n.isAbortError(E)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===D&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));D=null});this._pendingElevationQueryController=D}else this._updateSurfaceAltitude(0)};t._updateSurfaceAltitude=function(D){this._estimatedSurfaceAltitude!==D&&(this._estimatedSurfaceAltitude=D,this._updateRenderLocation())};
t._updateRenderLocation=function(){m.copy(x,this.state.camera.eye);this.renderCoordsHelper.setAltitude(this._estimatedSurfaceAltitude,x);m.exactEquals(this._get("renderLocation"),x)||this._set("renderLocation",m.copy(this._propertiesPool.get("renderLocation"),x))};k._createClass(A,[{key:"location",get:function(){const D=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,D,this.state.spatialReference);return D}},{key:"updating",get:function(){return this._dirty||
null!=this._pendingElevationQueryController}}]);return A}(y.PointOfInterest);a.__decorate([d.property({constructOnly:!0})],b.CameraOnSurface.prototype,"scheduler",void 0);a.__decorate([d.property({constructOnly:!0})],b.CameraOnSurface.prototype,"task",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:["renderLocation"]})],b.CameraOnSurface.prototype,"location",null);a.__decorate([d.property({constructOnly:!0})],b.CameraOnSurface.prototype,"map",void 0);a.__decorate([d.property({readOnly:!0})],
b.CameraOnSurface.prototype,"renderLocation",void 0);a.__decorate([d.property({readOnly:!0})],b.CameraOnSurface.prototype,"updating",null);b.CameraOnSurface=a.__decorate([e.subclass("esri.views.3d.support.CameraOnSurface")],b.CameraOnSurface);const x=q.create(),C=new w;b.default=b.CameraOnSurface;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Handles ./disposeMembers".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){b.PointOfInterest=function(m){function u(v){v=m.call(this,v)||this;v.handles=new w;return v}k._inheritsLoose(u,m);u.prototype.destroy=function(){q.disposeMembers(this,"handles")};return u}(n);a.__decorate([d.property({constructOnly:!0})],b.PointOfInterest.prototype,"renderCoordsHelper",void 0);a.__decorate([d.property({constructOnly:!0})],b.PointOfInterest.prototype,"surface",void 0);a.__decorate([d.property({constructOnly:!0})],b.PointOfInterest.prototype,
"state",void 0);b.PointOfInterest=a.__decorate([e.subclass("esri.views.3d.support.PointOfInterest")],b.PointOfInterest);b.default=b.PointOfInterest;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../geometry/Point ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../debugFlags ../PropertiesPool ./PointOfInterest".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){const x=Array;b.CenterOnSurface=function(A){function t(E){E=A.call(this,E)||this;E._propertiesPool=new y.PropertiesPool({location:n,renderLocation:x},k._assertThisInitialized(E));E._currentSurfaceAltitude=0;E._latestSurfaceAltitude=0;E.distance=0;E.renderLocation=q.create();E.updating=!1;return E}k._inheritsLoose(t,A);var D=t.prototype;D.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,()=>this._measureSurfaceAltitude(),
()=>this.updating);this._measureSurfaceAltitude()};D.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this._propertiesPool.destroy();this._propertiesPool=null};D.updateRenderLocation=function(){this._set("updating",!0);this._updateRenderLocation()};D.update=function(){this._measureSurfaceAltitude();this._updateRenderLocation()};D._measureSurfaceAltitude=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();
this._set("updating",!1)};D._updateRenderLocation=function(){const E=C;var G=this.calculateSurfaceIntersection(this._currentSurfaceAltitude,E),H=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;!G&&H&&(G=this.calculateSurfaceIntersection(this._latestSurfaceAltitude,E))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);H=z;G&&this.latestSurfaceAltitudeChangesDistanceSignificantly(E,H)&&(m.copy(E,H),this._currentSurfaceAltitude=this._latestSurfaceAltitude);G?(G=m.distance(this.state.camera.eye,
E),G!==this._get("distance")&&this._set("distance",G)):(G=this.state.camera,m.scale(E,G.viewForward,this._get("distance")),m.add(E,E,G.eye));m.exactEquals(this._get("renderLocation"),E)||this._set("renderLocation",m.copy(this._propertiesPool.get("renderLocation"),E))};D.calculateSurfaceIntersection=function(E,G){var H=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(H.ray,E,G))return!1;if(this.state.isGlobal){const I=u.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;
E=I+E;const J=m.squaredLength(H.eye),K=J<E*E,L=m.distance(H.eye,G);K&&L>I/4&&(m.scale(G,H.viewForward,E-Math.sqrt(J)),m.add(G,G,H.eye))}else if(H=this.surface.ready&&this.surface.extent)G[0]=w.clamp(G[0],H[0],H[2]),G[1]=w.clamp(G[1],H[1],H[3]);return!0};D.latestSurfaceAltitudeChangesDistanceSignificantly=function(E,G){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==E)return!1;if(this.calculateSurfaceIntersection(this._latestSurfaceAltitude,G)){const H=this.state.camera.eye;E=
m.distance(H,E);G=m.distance(H,G);if(v.TESTS_DISABLE_UPDATE_THRESHOLDS||.05<Math.abs(G-E)/E)return!0}return!1};k._createClass(t,[{key:"location",get:function(){const E=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,E,this.state.spatialReference);return E}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}}]);return t}(B.PointOfInterest);a.__decorate([d.property({constructOnly:!0})],b.CenterOnSurface.prototype,"scheduler",
void 0);a.__decorate([d.property({constructOnly:!0})],b.CenterOnSurface.prototype,"task",void 0);a.__decorate([d.property({readOnly:!0})],b.CenterOnSurface.prototype,"distance",void 0);a.__decorate([d.property({constructOnly:!0})],b.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:["renderLocation"]})],b.CenterOnSurface.prototype,"location",null);a.__decorate([d.property({readOnly:!0})],b.CenterOnSurface.prototype,"renderLocation",
void 0);a.__decorate([d.property({readOnly:!0})],b.CenterOnSurface.prototype,"updating",void 0);b.CenterOnSurface=a.__decorate([e.subclass("esri.views.3d.support.CenterOnSurface")],b.CenterOnSurface);const C=q.create(),z=q.create();b.default=b.CenterOnSurface;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../core/Evented","../../../../core/Handles"],function(b,k,a){let r=function(){function h(c){this.handles=
new a;this.events=new k;this.contentLayerViews=c.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",e=>this.layerViewsChanged(e)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}var d=h.prototype;d.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};d.layerViewsChanged=function(c){c.added.forEach(e=>{"esri.views.3d.layers.SceneLayerView3D"===e.declaredClass&&this.handles.add(e.on("visible-geometry-changed",
()=>this.contentChanged()),e.uid)});c.removed.forEach(e=>this.handles.remove(e.uid))};d.contentChanged=function(){this.events.emit("request-update",l)};return h}();const l={};b.ContentGeometryUpdates=r;b.default=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../geometry/Point ../../../../core/mathUtils ../../../../core/screenUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../geometryUtils ../debugFlags ../PropertiesPool ./PointOfInterest ../debugUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){const A=Array;b.Focus=function(I){function J(L){L=I.call(this,L)||this;L._propertiesPool=new x.PropertiesPool({location:w,renderLocation:A},k._assertThisInitialized(L));return L}k._inheritsLoose(J,I);var K=J.prototype;K.destroy=function(){this._propertiesPool.destroy();this._propertiesPool=null;H=l.removeMaybe(H)};K.calculateScreenHorizontalEdgeOnSurface=function(L){const S=this.state.camera,M=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);
var T=this.renderCoordsHelper.getAltitude(S.eye)>=M;const O=S.getRenderCenter(m.createRenderScreenPointArray3());O[1]=T?S.padding[2]:S.fullHeight-S.padding[0];if(S.unprojectFromRenderScreen(O,E)&&(v.subtract(E,E,S.eye),T=v.normalize(E,E),this.renderCoordsHelper.intersectManifold(y.ray.wrap(S.eye,T),M,L)))return L;v.copy(L,S.eye);this.renderCoordsHelper.setAltitude(M,L);return L};K.updateRenderLocation=function(){};k._createClass(J,[{key:"location",get:function(){const L=this._propertiesPool.get("location");
this.renderCoordsHelper.fromRenderCoords(this.renderLocation,L,this.state.spatialReference);return L}},{key:"renderLocation",get:function(){const L=this.centerOnSurface.renderLocation;var S=this.renderCoordsHelper;const M=this.calculateScreenHorizontalEdgeOnSurface(G);v.subtract(t,L,this.state.camera.eye);v.normalize(t,t);S.worldUpAtPosition(L,D);var T=Math.abs(Math.acos(v.dot(D,t))-.5*Math.PI);S=this._propertiesPool.get("renderLocation");Number.isNaN(T)?v.copy(S,L):(T=1-q.clamp(T/(.5*Math.PI),0,
1),v.lerp(S,L,M,T*T*T));l.isSome(H)&&(B.SHOW_POI?H.showPoint(S,this.renderCoordsHelper.spatialReference):H.remove());return S}}]);return J}(C.PointOfInterest);a.__decorate([c.property({constructOnly:!0})],b.Focus.prototype,"centerOnSurface",void 0);a.__decorate([c.property({readOnly:!0})],b.Focus.prototype,"location",null);a.__decorate([c.property({readOnly:!0})],b.Focus.prototype,"renderLocation",null);a.__decorate([c.property({readOnly:!0,aliasOf:"centerOnSurface.updating"})],b.Focus.prototype,
"updating",void 0);b.Focus=a.__decorate([f.subclass("esri.views.3d.support.CenterOnSurface")],b.Focus);const t=u.create(),D=u.create(),E=u.create(),G=u.create();let H;b.default=b.Focus;b.setupFocusDebugGraphic=function(I){l.removeMaybe(H);H=new z.GraphicsHandle(I,"green")};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../core/maybe ../../../geometry/Point ../../../geometry ../../../symbols/SimpleMarkerSymbol ../../../chunks/symbols ../../../Graphic".split(" "),
function(b,k,a,r,l,h,d){const c={red:[255,0,0],green:[0,255,0],blue:[0,0,255]};r=function(){function e(g,p){this.graphics=g;this._symbol=new l({color:c[p],outline:{color:[255,255,255],width:2}})}var f=e.prototype;f.showPoint=function(g,p){k.isNone(p)||(this.remove(),g=new a({x:g[0],y:g[1],z:g[2],spatialReference:p}),this._graphic=new d({geometry:g,symbol:this._symbol}),this.graphics.add(this._graphic))};f.remove=function(){k.isSome(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=
null)};return e}();b.GraphicsHandle=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../geometry/Point ../../../../chunks/vec3f64 ../../../../core/Handles ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){b.StableSurfaceCenter=function(B){function x(z){z=B.call(this,z)||this;z.location=null;z._updateController=null;z._handles=new u;return z}k._inheritsLoose(x,B);var C=x.prototype;C.initialize=function(){this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference","surfaceView.extent"],()=>this._update()),v.on(this,"surface.layers","change",()=>this._update())]),this._update())};C.destroy=function(){this._handles.destroy()};
C._update=function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var z=y.center(this.surfaceView.extent);z=new q({x:z[0],y:z[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=n.createAbortController(),this.surface.queryElevation(z,{noDataValue:0,signal:this._updateController.signal}).then(A=>
{this._updateController=null;this._set("location",A.geometry)}).catch(A=>{n.isAbortError(A)||A&&"elevation-query:invalid-layer"===A.name||console.error("StableSurfaceCenter failed to update: ",A)})):this._set("location",z)}else this._set("location",null)};k._createClass(x,[{key:"renderLocation",get:function(){if(!this.location)return null;const z=m.create();this.view.renderCoordsHelper.toRenderCoords(this.location,z);return z}}]);return x}(w);a.__decorate([d.property({constructOnly:!0})],b.StableSurfaceCenter.prototype,
"view",void 0);a.__decorate([d.property({readOnly:!0,aliasOf:"view.map.ground"})],b.StableSurfaceCenter.prototype,"surface",void 0);a.__decorate([d.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],b.StableSurfaceCenter.prototype,"surfaceView",void 0);a.__decorate([d.property({readOnly:!0})],b.StableSurfaceCenter.prototype,"location",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:["location"]})],b.StableSurfaceCenter.prototype,"renderLocation",null);b.StableSurfaceCenter=a.__decorate([e.subclass("esri.views.3d.terrain.StableSurfaceCenter")],
b.StableSurfaceCenter);b.default=b.StableSurfaceCenter;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../chunks/vec3f64 ../../../../core/Handles ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){b.SurfaceGeometryUpdates=function(z){function A(){var D=z.apply(this,arguments)||this;D.handles=new m;D._tileGeometryUpdateExtent=u.empty();D._tileGeometryUpdateSpatialReference=null;D.events=new w;D.updating=!1;return D}k._inheritsLoose(A,z);var t=A.prototype;t.initialize=function(){this.handles.add([this.surface.on("elevation-change",D=>this._tileGeometryChanged(D)),this.scheduler.registerTask(v.Task.SURFACE_GEOMETRY_UPDATES,()=>this.update(),()=>this.updating)])};
t.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};t.update=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",y),u.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};t._tileGeometryChanged=function(D){this._tileGeometryUpdateSpatialReference=D.spatialReference;u.expand(this._tileGeometryUpdateExtent,D.tile.extent);this._set("updating",!0)};t._furthestCenterOnSurface=
function(){let D=this.centerOnSurfaces[0];for(let E=1;E<this.centerOnSurfaces.length;E++){const G=this.centerOnSurfaces[E];G.distance>D.distance&&(D=G)}return D};t._centerIntersectsExtent=function(D,E){const G=this.state.camera.eye,H=C,I=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(G,B,E);this.renderCoordsHelper.fromRenderCoords(I.renderLocation,x,E);B[0]<x[0]?(H[0]=B[0],H[2]=x[0]):(H[0]=x[0],H[2]=B[0]);B[1]<x[1]?(H[1]=B[1],H[3]=x[1]):(H[1]=x[1],H[3]=B[1]);return u.intersects(H,
D)};return A}(n);a.__decorate([d.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"state",void 0);a.__decorate([d.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);a.__decorate([d.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);a.__decorate([d.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,"scheduler",void 0);a.__decorate([d.property({constructOnly:!0})],b.SurfaceGeometryUpdates.prototype,
"surface",void 0);a.__decorate([d.property({readOnly:!0})],b.SurfaceGeometryUpdates.prototype,"updating",void 0);b.SurfaceGeometryUpdates=a.__decorate([e.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],b.SurfaceGeometryUpdates);const y={},B=q.create(),x=q.create(),C=u.empty();b.default=b.SurfaceGeometryUpdates;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/aliasOf ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/ObjectPool ../../../core/arrayUtils ../../../core/PooledArray ../../../core/promiseUtils ../../../core/Accessor ../../../geometry/support/spatialReferenceUtils ../../../core/Evented ../../../core/mathUtils ../../../Color ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/Handles ../../../core/CollectionFlattener ../../../geometry/projectionEllipsoid ../../../core/watchUtils ../../../chunks/mat4 ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../support/Scheduler ../../../chunks/mat4f64 ../../../chunks/vec4f64 ../../../layers/support/LercDecoder ../../../layers/support/layerUtils ./TerrainConst ../../../chunks/mat3f32 ../support/geometryUtils ../support/debugFlags ../support/extentUtils ./terrainUtils ../../2d/engine/vectorTiles/decluttering/jobsUtil ../layers/ElevationLayerView3D ./ElevationBounds ./ElevationData ./OverlayManager ./tileUtils ./Tile ./PlanarPatch ./SphericalPatch ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./UpsampleInfo".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q,F,N,P,U,V,W,X,ca,R,aa,ka,da,fa,ea,Y,Z,ba,ia,ja){function la(Ia,Qa){return Ia[0]===Qa[0]&&Ia[1]===Qa[1]&&Ia[2]===Qa[2]}function qa(Ia){return Ia.isLeaf?!1:Ia.children[0].shouldRender||Ia.children[1].shouldRender||Ia.children[2].shouldRender||Ia.children[3].shouldRender||qa(Ia.children[0])||qa(Ia.children[1])||qa(Ia.children[2])||qa(Ia.children[3])}const na=h.getLogger("esri.views.3d.terrain.TerrainSurface");r=function(Ia){function Qa(sa){sa=
Ia.call(this,sa)||this;sa._clippingExtent=null;sa._dataExtent=null;sa._elevationBounds=new ca.ElevationBounds;sa._rootExtent=J.create();sa._iteratorPool=new q(ka.IteratorPreorder);sa._postorderIterator=new ka.IteratorPostorder;sa.pendingUpdates=!1;sa._asyncWorkItems=0;sa._allTilesDirty=!0;sa._allTilesSorted=!0;sa._visible=!1;sa._usedMemory=-1;sa._performanceInfo=new ia;sa._viewChanged=!1;sa._inFrameTask=!1;sa._viewChangeUpdateDirty=!1;sa._overlayOpacity=1;sa._eyePosRenderSR=A.create();sa._eyePosSurfaceSR=
A.create();sa._splitLimits=new da.SplitLimits;sa._snapLevel=Infinity;sa._frustum=N.frustum.create();sa._viewProjectionMatrix=S.create();sa._layerViews=[[],[]];sa._layerIndexByLayerViewId=[new Map,new Map];sa._basemapLayerViewHandles=new Map;sa._handles=new D;sa._allTiles=new u;sa._upsampleInfoPool=new q(ja.UpsampleInfo);sa._visibleLevels=new u({deallocator:null});sa._getElevationData={spatialReference:null,rootTiles:null};sa.maxTextureScale=1.2;sa.rootTiles=null;sa.backgroundImage=Q.DEFAULT_TILE_BACKGROUND;
sa.backgroundColor=null;sa._layerViewsDirty=!1;return sa}k._inheritsLoose(Qa,Ia);var Pa=Qa.prototype;Pa.initialize=function(){this._stage=this.view._stage;this._lercDecoder=T.acquireDecoder(this.view.resourceController.scheduler);this._tilePool="planar"===this.manifold?new q(fa.PlanarPatch):new q(ea.SphericalPatch);this._upsampleMapCache=this.view.resourceController.memoryController.getMemCache("esri.views.3d.terrain.upsample",Ga=>Ga.unloadMapData());this._set("overlayManager",new aa.OverlayManager({surface:this}));
this._handles.add([this.watch("overlayManager.hasHighlights",Ga=>this._renderer.setNeedsHighlight(Ga)),this.watch("overlayManager.rendersOccluded",Ga=>this._renderer.setRenderOccludedOverlay(Ga))],"overlayManager");this._renderer=new ba({manifold:this.manifold,overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:G.getReferenceEllipsoid(this.view.spatialReference).radius});this._renderer.install(this.view._stage);this._handles.add([H.init(this,"baseOpacity",Ga=>{this._handleLayerViewChanges();
this._updateBaseOpacity(Ga)},!0),H.init(this,"_background",()=>{this._handleLayerViewChanges();this._renderer.setTileBackground(this._background)},!0),this.view.watch("pointsOfInterest",Ga=>{this._renderer.pointsOfInterest=Ga;this._handles.remove("poi");Ga&&this._handles.add(Ga.focus.watch("renderLocation",()=>this._allTilesSorted=!1),"poi")}),H.whenTrue(P,"TERRAIN_DEBUG_POPUP",()=>{(new Promise(function(Ga,Ra){b(["./support/TerrainDebugPopupOpener"],Ga,Ra)})).then(Ga=>{const Ra=new Ga.TerrainDebugPopupOpener({surface:this});
H.whenFalseOnce(P,"TERRAIN_DEBUG_POPUP",()=>Ra.destroy())})})]);var sa={layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,spatialReference:this.view.spatialReference};this.extentHelper="spherical"===this.manifold?new Y.SurfaceExtentHelperGlobal(sa):new Y.SurfaceExtentHelperLocal(sa);this._handles.add(H.init(this.extentHelper,"stencilEnabledExtents",Ga=>this._renderer.setStencilEnabledLayerExtents(Ga)),"extentHelper");sa=this.view.defaultsFromMap?new E({root:this.view.map,rootCollectionNames:this.view.defaultsFromMap.mapCollectionPaths,
getChildrenFunction:Ga=>Ga.layers}):this.view.map.allLayers;sa=new Z({layers:sa,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",sa);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",()=>this._updateTilingSchemeAndExtent(),!0),this.tilingSchemeLogic.watch("extent",()=>this._updateTilingSchemeAndExtent(),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(0);
this._mapDataRequester=this.view.resourceController.createStreamDataRequester(1);this._frameTask=this.view.resourceController.scheduler.registerTask(L.Task.TERRAIN_SURFACE,Ga=>this._update(Ga),()=>this.updating);this.view.resourceController.memoryController.events.on("quality-changed",()=>this._viewChangeUpdate());this._handles.add([this.view.on("resize",()=>this._viewChangeUpdate()),this.view.watch("state.camera",()=>this._viewChangeUpdate(),!0),this.view.watch("qualitySettings.tiledSurface.lodBias",
()=>this._viewChangeUpdate()),H.init(this.view,"qualitySettings.tiledSurface.textureFadeDuration",Ga=>this._renderer.textureFadingEnabled=0<Ga),this.view.watch("lodSnapping",()=>this._viewChangeUpdate()),this.view.watch("clippingArea",()=>this._clippingChanged())]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges();this._updateClippingExtent();this.notifyChange("extent")};Pa.destroy=function(){this._frameTask.remove();
this._handles.destroy();T.releaseDecoder(this._lercDecoder);this._lercDecoder=null;this._removeAllTiles();this._upsampleMapCache=l.destroyMaybe(this._upsampleMapCache);this._set("tilingSchemeLogic",l.destroyMaybe(this.tilingSchemeLogic));this.extentHelper=l.destroyMaybe(this.extentHelper);this._basemapLayerViewHandles.forEach((sa,Ga)=>this._unregisterTiledLayerView(Ga));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",l.destroyMaybe(this.overlayManager));this._tilePool=
l.destroyMaybe(this._tilePool);da.pruneAgents();this._renderer.uninstall(this._stage);this._renderer=l.destroyMaybe(this._renderer);this._iteratorPool=l.destroyMaybe(this._iteratorPool);this._set("view",null);this._stage=null;this._upsampleInfoPool=l.destroyMaybe(this._upsampleInfoPool)};Pa.isOpaque=function(){return this._renderer.opaque};Pa.intersect=function(sa,Ga,Ra,Ua){this._renderer.intersect(sa,Ga,Ra,Ua)};Pa.getElevation=function(sa,Ga,Ra,Ua){const ha=this._getElevationData.rootTiles;if(!ha||
!ha.length||0===ha[0].layerInfo[0].length)return null;const Ya=oa;Ya[0]=sa;Ya[1]=Ga;Ya[2]=Ra;if(!K.projectVectorToVector(Ya,Ua,Ya,this._getElevationData.spatialReference))return na.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(var Wa of ha)if(Wa.containsPoint(Ya)){for(;Wa&&!Wa.rendered&&!Wa.isLeaf;)sa=0,Ya[0]>.5*(Wa.extent[0]+Wa.extent[2])&&(sa+=1),Ya[1]<.5*(Wa.extent[1]+Wa.extent[3])&&(sa+=2),Wa=Wa.children[sa];if(Wa=(Wa=Wa.renderData)&&
Wa.geometryState?Wa.geometryState.samplerData:null)return R.ElevationData.sample(Ya[0],Ya[1],Wa);break}return null};Pa.getScale=function(sa){if(this.tilingScheme){if(!K.projectPointToVector(sa,oa,this.spatialReference))return na.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;if(sa=this.rootTiles)for(let Ga of sa)if(Ga.containsPoint(oa)){for(;null!=Ga.children[0];)sa=0,oa[0]>Ga.children[0].extent[2]&&(sa+=1),oa[1]<Ga.children[0].extent[1]&&
(sa+=2),Ga=Ga.children[sa];return this._getLodBiasCorrectedScale(Ga.level)}}return 1E100};Pa.queryVisibleScaleRange=function(sa,Ga,Ra,Ua){Ga=Ga?this.tilingScheme.levelAtScale(Ga):0;Ra=Ra?this.tilingScheme.levelAtScale(Ra):Infinity;const ha=this.lodBias;this._renderer.queryVisibleLevelRange(sa,Ga+ha,Ra+ha,Ua)};Pa._updateBaseOpacity=function(sa){const Ga=this._renderer.opaque;this._renderer.opaque=1<=sa;this._renderer.isTransparent=this.allTransparentSurfaceLayers();this._updateTileTextures(Ga!==this._renderer.opaque)};
Pa._updateTilingSchemeAndExtent=function(){var sa=this.tilingSchemeLogic.extent;const Ga=sa&&!J.equals(sa,this._dataExtent);Ga&&(this._dataExtent?J.set(this._dataExtent,sa):this._dataExtent=J.create(sa));sa=this.tilingSchemeLogic.tilingScheme;const Ra=sa!==this.tilingScheme;Ra&&(V.weakAssert(!!sa,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",sa),this._updateClippingExtent(),sa&&(this._updateTiledLayers(),this._renderer.setTileSize(sa.pixelSize),
this.overlayManager.setSpatialReference(sa.spatialReference,"spherical"===this.manifold)));(Ga||Ra)&&this._updateRootTiles()};Pa._acquireTile=function(sa,Ga,Ra,Ua){const ha=this._tilePool.acquire();za[0]=sa;za[1]=Ga;za[2]=Ra;ha.init(za,Ua,this);return ha};Pa._updateRootTiles=function(){var sa=this._clippingExtent||this._dataExtent;const Ga=this.tilingScheme;if(sa&&Ga){var Ra=ua,Ua=Ga.rootTilesInExtent(sa,Ra,5*Q.MAX_ROOT_TILES),ha=Ya=>{Ya=this._acquireTile(0,Ya[1],Ya[2],null);2===Ya.shouldSplit(this._splitLimits,
this._eyePosRenderSR,this.lodSnapping)&&Ya.setPendingUpdate(2);this._loadTile(Ya);return Ya};if(this.rootTiles){if(Ua.length>Q.MAX_ROOT_TILES){na.warn(Q.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}sa=this.rootTiles.map(Wa=>Wa.lij);const Ya=m.difference(sa,Ua,la);if(0<Ya.removed.length||0<Ya.added.length){const Wa=this.rootTiles.filter(db=>-1<Ya.removed.findIndex(la.bind(null,db.lij))?(this._purgeTile(db),!1):!0);Ya.added.forEach(db=>Wa.push(ha(db)));this._setRootTiles(Wa)}}else Ua.length>Q.MAX_ROOT_TILES&&
(na.warn(Q.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),Ua=Ga.rootTilesInExtent(sa,Ra,Q.MAX_ROOT_TILES)),this._setRootTiles(Ua.map(Ya=>ha(Ya)));J.equals(Ra,this._rootExtent)||(this._rootExtent=J.create(Ra),this._hasFixedExtent()||this.notifyChange("extent"));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setOverlayPlacementDirty();this.notifyChange("ready")}};Pa._setRootTiles=function(sa){this._set("rootTiles",sa);this._allTiles.clear();if(sa){const Ga=this._iteratorPool.acquire();for(Ga.reset(sa);!Ga.done;)this._allTiles.push(Ga.next());
this._iteratorPool.release(Ga)}this._getElevationData.rootTiles=sa;this._renderer.setRootTiles(this.rootTiles);this._updateTileVisibility(sa)};Pa._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};Pa._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateSkirts(),
this.updateOverlayOpacity(),this._updateTileVisibility(this.rootTiles)))};Pa._updateClippingStatus=function(sa){sa.updateClippingStatus(this._clippingExtent)&&sa.resetPendingUpdate(32)&&this._updateTileGeometry(sa)};Pa._updateTileVisibility=function(sa){if(sa){var Ga=this._iteratorPool.acquire();Ga.reset(sa);if(ka.hasVisibleSiblings(sa)){sa=this._elevationBounds.min;var Ra=this._elevationBounds.max}else sa=Infinity,Ra=-Infinity;for(;!Ga.done;){const Ua=Ga.next();this._updateClippingStatus(Ua);Ua.updateVisibility();
Ua.setPendingUpdate(16);Ua.visible?(Ua.updateScreenDepth(this._viewProjectionMatrix),Ua.renderData&&(sa=Math.min(Ua.elevationBounds[0],sa),Ra=Math.max(Ua.elevationBounds[1],Ra))):Ga.skipSubtree()}this._iteratorPool.release(Ga);this._allTilesDirty=this._viewChanged=!0;isFinite(sa)&&isFinite(Ra)&&(this._elevationBounds.min!==sa||this._elevationBounds.max!==Ra)&&(this._elevationBounds.min=sa,this._elevationBounds.max=Ra,this.emit("elevation-bounds-change",null))}};Pa._updateViewDependentParameters=function(){const sa=
this.view.state.camera,Ga=Math.tan(.5*sa.fovX),Ra=Math.tan(.5*sa.fovY),Ua=this.tilingScheme.pixelSize,ha=Math.pow(2,-this.lodBias)*sa.pixelRatio;this._splitLimits.aboveGround=sa.aboveGround;this._splitLimits.fovX=Ga;this._splitLimits.fovY=Ra;this._splitLimits.relativeWidthLimit=Ua/sa.width*this.maxTextureScale*ha;this._splitLimits.relativeHeightLimit=Ua/sa.height*this.maxTextureScale*ha;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;
N.frustum.copy(sa.frustum,this._frustum);I.multiply(this._viewProjectionMatrix,sa.projectionMatrix,sa.viewMatrix);t.copy(this._eyePosRenderSR,sa.eye);K.projectVectorToVector(this._eyePosRenderSR,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};Pa._updateSnapLevel=function(){if(0===this.lodSnapping)return!1;const sa=this._computeSnapLevel();if(.25>Math.abs(this._snapLevel-sa))return!1;const Ga=this.snapLevel;this._snapLevel=sa;return Ga!==this.snapLevel};Pa._computeSnapLevel=
function(){if(0>=this._visibleLevels.length)return this._snapLevel;const sa=this._visibleLevels,Ga=Math.round(sa.length*(Math.abs(this.view.camera.tilt-90)/90*.4+.3));if(Ga>=sa.length)return this._snapLevel;sa.sort((ha,Ya)=>ha-Ya);let Ra=0;for(var Ua=Ga;Ua<sa.length;++Ua)Ra+=sa.getItemAt(Ua);Ua=sa.getItemAt(Math.round(.95*sa.length)-1);return C.clamp(Ra/(sa.length-Ga),Ua-1,this._splitLimits.maxLod)};Pa._updateSkirts=function(){const sa=this.view.state.camera;this.skirtScale=V.computeSkirtScale(this,
this._eyePosSurfaceSR,this.view.state.constraints.collision.enabled?0:1.11*sa.near)};Pa._updateRenderData=function(sa){sa.rendered&&!sa.shouldRender&&(qa(sa)?this._loadChildren(sa):sa.isLeaf&&sa.parent&&sa.parent.shouldRender&&this._loadParent(sa))};Pa._updateTileGeometry=function(sa){sa.updateVisibility();this._renderer.updateTileGeometry(sa);this._elevationUpdate(sa);this._usedMemory=-1};Pa._elevationUpdate=function(sa){La.spatialReference=this.spatialReference;La.tile=sa;La.extent=sa.extent;this.emit("elevation-change",
La);J.containsPoint(sa.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};Pa._update=function(sa){this._handleLayerViewChanges(sa);this._inFrameTask=!0;this.pendingUpdates=!1;this._updateTileStatus(sa);this._sortTiles(sa);this._mergeAndSplit(sa);sa.run(()=>this._updateElevation(sa));sa.run(()=>this._updateTextures(sa));this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();sa.done&&(this.pendingUpdates=!0)};Pa._updateTileStatus=function(sa){if(this._viewChanged&&this.rootTiles&&!sa.done){this._viewChanged=
!1;var Ga=this._iteratorPool.acquire();for(Ga.reset(this.rootTiles);!Ga.done;){var Ra=Ga.next();if(Ra.visible){var Ua=Ra.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(2===Ua){Ra.resetPendingUpdate(8);Ra.isLeaf&&(Ra.setPendingUpdate(2),Ga.skipSubtree());continue}Ra.resetPendingUpdate(2)&&Ra.updateAgentSuspension();4===Ua&&Ra.updateAgents(0)}Ga.skipSubtree();if(!Ra.isLeaf){Ra.setPendingUpdate(8);Ra.resetPendingUpdate(2);Ua=this._iteratorPool.acquire();Ua.resetOne(Ra);for(Ra=
Ua.next();!Ua.done;Ra=Ua.next())this._updateClippingStatus(Ra),Ra.updateVisibility(),Ra.visible&&Ra.updateScreenDepth(this._viewProjectionMatrix);this._iteratorPool.release(Ua)}}this._iteratorPool.release(Ga);this.pendingUpdates=!0;sa.madeProgress()}};Pa._sortTiles=function(sa){sa.done||this._allTilesSorted||(ka.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,sa.madeProgress())};Pa._mergeAndSplit=function(sa){if(!this.suspended&&this._allTilesDirty&&
!sa.done){this._allTilesDirty=!1;this.pendingUpdates=!0;for(var Ga=this._eyePosRenderSR,Ra=0,Ua=1===this.lodSnapping?ha=>{const Ya=ha.shouldSplit(this._splitLimits,Ga,0);ha.visible&&(2!==Ya&&ha.parent&&2===ha.parent.shouldSplit(this._splitLimits,Ga,0)?1===Ya?this._visibleLevels.fill(ha.level+1,4):this._visibleLevels.push(ha.level):ha.isLeaf&&2===Ya&&this._visibleLevels.fill(ha.level+1,3))}:()=>{};!sa.done;){let ha=!1;Ra=0;this._visibleLevels.clear();const Ya=!this._allTiles.some(Wa=>{Ra+=Wa.usedMemory;
Ua(Wa);Wa.resetPendingUpdate(8)?(this._mergeTile(Wa),ha=!0,sa.madeProgress()):Wa.resetPendingUpdate(2)&&(this._splitTile(Wa),ha=!0,sa.madeProgress());Wa.resetPendingUpdate(16)&&(this._updateRenderData(Wa),sa.madeProgress());return sa.done});ha&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(Ya){if(this._usedMemory=Ra,!ha)if(this._updateSnapLevel())this._updateTileVisibility(this.rootTiles);else break}else this._allTilesDirty=!0}0===Ra&&(this._allTilesDirty=!0);this._visibleLevels.clear();this._sortTiles(sa)}};
Pa._updateElevation=function(sa){this._allTiles.some(Ga=>{Ga.resetPendingUpdate(32)&&(this._updateTileGeometry(Ga),sa.madeProgress());return sa.done});return sa.hasProgressed};Pa._updateTextures=function(sa){this._allTiles.some(Ga=>{Ga.resetPendingUpdate(64)&&(this._renderer.updateTileTexture(Ga),this._usedMemory=-1,sa.madeProgress());return sa.done});return sa.hasProgressed};Pa._updateClippingExtent=function(){if(!this.spatialReference)return!1;const sa=J.create();let Ga=null;U.toBoundingRect(this.view.clippingArea,
sa,this.spatialReference)&&(Ga=sa);if(J.equals(Ga,this._clippingExtent))return!1;this._clippingExtent=Ga;this._renderer.clippingExtent=Ga;this.notifyChange("extent");this.updateTileOverlayParams();this.overlayManager.setOverlayPlacementDirty();return!0};Pa._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};Pa._getLodBiasCorrectedScale=function(sa){const Ga=this.tilingScheme.levels;sa=C.clamp(sa-this.lodBias,0,Ga.length-1);const Ra=sa-Math.floor(sa);return Ga[Math.floor(sa)].scale*
(1-Ra)+Ga[Math.ceil(sa)].scale*Ra};Pa._removeAllTiles=function(){this.rootTiles&&(this.rootTiles.forEach(sa=>this._purgeTile(sa)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.visible=!1};Pa._purgeChildTiles=function(sa){if(sa.isLeaf)return!1;let Ga=this._purgeTile(sa.children[0]);Ga=this._purgeTile(sa.children[1])||Ga;Ga=this._purgeTile(sa.children[2])||Ga;Ga=this._purgeTile(sa.children[3])||Ga;sa.unsetChildren();return Ga};Pa._purgeTile=function(sa){const Ga=this._purgeChildTiles(sa)||
sa.rendered;this._allTiles.removeUnordered(sa);sa.unload(this._renderer);this._tilePool.release(sa);return Ga};Pa._splitTile=function(sa){V.weakAssert(sa.isLeaf,"tile that is already split should not be split again!");const Ga=sa.level+1,Ra=2*sa.lij[1],Ua=2*sa.lij[2];sa.setChildren(this._createTile(Ga,Ra,Ua,sa),this._createTile(Ga,Ra,Ua+1,sa),this._createTile(Ga,Ra+1,Ua,sa),this._createTile(Ga,Ra+1,Ua+1,sa));sa.setPendingUpdate(16);sa.updateAgentSuspension();this._allTiles.pushArray(sa.children);
this._allTilesDirty=!0;this._emitTileScaleChange(sa,Ga);++this._performanceInfo.numSplit};Pa._emitTileScaleChange=function(sa,Ga=sa.level){Sa.spatialReference=this.spatialReference;Sa.extent=sa.extent;Sa.scale=this._getLodBiasCorrectedScale(Ga);this.emit("scale-change",Sa)};Pa._createTile=function(sa,Ga,Ra,Ua){V.weakAssert(!!Ua,"_createTile sanity check");sa=this._acquireTile(sa,Ga,Ra,Ua);sa.updateClippingStatus(this._clippingExtent);sa.visible&&(sa.updateScreenDepth(this._viewProjectionMatrix),2===
sa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)&&sa.setPendingUpdate(2));return sa};Pa._mergeTile=function(sa){V.weakAssert(!sa.hasPendingUpdate(2),"_mergeTile sanity check");this._purgeChildTiles(sa)&&(V.weakAssert(!sa.renderData,"_mergeTile sanity check"),this._loadTile(sa));this._allTilesDirty=!0;++this._performanceInfo.numMerged;this._emitTileScaleChange(sa)};Pa._loadChildren=function(sa){V.weakAssert(sa.rendered,"parent should be rendered");sa.unload(this._renderer);this._loadTile(sa.children[0]);
this._loadTile(sa.children[1]);this._loadTile(sa.children[2]);this._loadTile(sa.children[3])};Pa._loadParent=function(sa){sa=sa.parent;this._unloadChildren(sa);this._loadTile(sa)};Pa._unloadChildren=function(sa){sa.isLeaf||(this._unloadChildren(sa.children[0]),sa.children[0].unload(this._renderer),this._unloadChildren(sa.children[1]),sa.children[1].unload(this._renderer),this._unloadChildren(sa.children[2]),sa.children[2].unload(this._renderer),this._unloadChildren(sa.children[3]),sa.children[3].unload(this._renderer))};
Pa._loadTile=function(sa){sa.load(this._renderer);sa.setPendingUpdate(16);this.pendingUpdates=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(sa);this._elevationUpdate(sa)};Pa._elevationDataArrived=function(sa,Ga,Ra){Ra=new R.ElevationData(sa.lij,sa.extent,Ra);sa.dataArrived(Ga,0,Ra);Ra=[sa];sa=sa.level;const Ua=this._iteratorPool.acquire();for(Ua.reset(Ra);!Ua.done;){const ha=Ua.next();ha.findElevationBoundsForLayer(Ga,sa);ha.computeElevationBounds()}this._iteratorPool.release(Ua);
this._updateTileVisibility(Ra)};Pa._handleLayerViewChanges=function(sa=L.noBudget){if(this._layerViewsDirty){var Ga=this._layerViewsDirty=!1,Ra=new Set,Ua=-1;for(const Ya of this.view.allLayerViews.items)if(Ra.add(Ya.uid),V.isSurfaceLayerView(Ya))if(this._basemapLayerViewHandles.has(Ya.uid)){var ha=this.layerClassFromLayerView(Ya);ha=this._layerIndexByLayerViewId[ha].get(Ya.uid);ha<Ua&&(Ga=!0);Ua=ha}else this._registerTiledLayerView(Ya),Ya.layer.loaded&&(Ga=!0);this._basemapLayerViewHandles.forEach((Ya,
Wa)=>{Ra.has(Wa)||(this._unregisterTiledLayerView(Wa),Ga=!0)});Ga&&this._updateTiledLayers();this._renderer.isTransparent=this.allTransparentSurfaceLayers();sa.madeProgress()}};Pa.allTransparentSurfaceLayers=function(){let sa=0===this.view.map.ground.opacity;for(const Ga of this.view.allLayerViews.items)if(V.isSurfaceLayerView(Ga)&&!V.isElevationLayerView(Ga)&&!O.isBaseLayer(Ga.layer)&&0!==Ga.fullOpacity){sa=!1;break}return sa};Pa.layerClassFromLayerView=function(sa){return V.isElevationLayerView(sa)?
0:1};Pa._registerTiledLayerView=function(sa){const Ga=[],Ra=this.layerClassFromLayerView(sa);Ga.push(sa.watch("suspended",()=>this._updateTiledLayers()));Ga.push(sa.watch("fullOpacity",()=>this._updateTileTextures(!1)));Ga.push(sa.layer.watch("scaleRangeId",()=>this._restartAllAgents(Ra)));sa.on("data-changed",()=>{const Ua=this._layerIndexByLayerViewId[Ra].get(sa.uid);null!=Ua&&this._invalidateLayerData(Ua,Ra)});this._basemapLayerViewHandles.set(sa.uid,Ga)};Pa._unregisterTiledLayerView=function(sa){const Ga=
this._basemapLayerViewHandles.get(sa);if(Ga){for(let Ra=0;Ra<Ga.length;Ra++)Ga[Ra].remove();this._basemapLayerViewHandles.delete(sa)}};Pa._updateTiledLayers=function(){if(this.tilingScheme&&!this.view.suspended){var sa=this.view.allLayerViews,Ga=[[],[]],Ra=null,Ua=J.empty();sa.forEach(Ya=>{var Wa=Ya.layer;if(Wa&&!Ya.suspended&&V.isSurfaceLayerView(Ya)){var db=Ya.fullExtent;db?this.tilingScheme.compatibleWith(Ya.tileInfo)?(J.expand(Ua,db),Wa=this.layerClassFromLayerView(Ya),1===Wa&&(db=Ya.displayLevelRange,
Infinity!==db.maxLevel&&(null===Ra||db.maxLevel>Ra)&&(Ra=db.maxLevel)),Ga[Wa].push(Ya)):na.warn("Terrain: tiling scheme of layer "+Wa.id+" is incompatible with other tiled layers, will not be drawn"):na.warn("Terrain: Map or elevation layer does not have fullExtent: "+Wa.id)}});for(sa=0;2>sa;sa++){var ha=this._layerViews[sa];const Ya=Ga[sa];Ya.reverse();const Wa=Ya.length;let db=ha.length!==Wa;const mb=Array(Wa),Ea=Array(ha.length);this._layerIndexByLayerViewId[sa].clear();for(let ya=0;ya<Wa;ya++){this._layerIndexByLayerViewId[sa].set(Ya[ya].uid,
ya);const xa=ha.indexOf(Ya[ya]);mb[ya]=xa;ya!==xa&&(db=!0);-1<xa&&(Ea[xa]=ya)}if(db){ha=this._postorderIterator;for(ha.reset(this.rootTiles);!ha.done;)ha.next().modifyLayers(Ea,mb,sa);this._layerViews[sa]=Ya;this._restartAllAgents(sa);this._updateTileVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(Ra)&&this._viewChangeUpdate()}};Pa._restartAllAgents=function(sa){const Ga=this._postorderIterator;for(Ga.reset(this.rootTiles);!Ga.done;){const Ra=Ga.next();Ra.restartAgents(sa);0===sa&&Ra.computeElevationBounds()}};
Pa._hasFixedExtent=function(){return!!this._clippingExtent};Pa.layerViewByIndex=function(sa,Ga){return this._layerViews[Ga][sa]};Pa.numLayers=function(sa){return this._layerViews[sa].length};Pa._updateTileTextures=function(sa){this._allTiles.forAll(Ga=>{Ga.updateAgents(1);sa?this.renderer.updateTileTexture(Ga):Ga.updateRenderData(1)});this._renderer.isTransparent=this.allTransparentSurfaceLayers()};Pa._invalidateLayerData=function(sa,Ga){this._allTiles.forAll(Ra=>Ra.removeLayerAgent(sa,Ga));this._allTiles.forAll(Ra=>
Ra.invalidateLayerData(sa,Ga))};Pa.setTileTreeDirty=function(){this._allTilesDirty=!0};Pa.requestRender=function(sa=1){this.renderer.setNeedsRender(sa)};Pa.requestTileData=function(sa,Ga,Ra,Ua){const ha=this.layerViewByIndex(Ga,Ra);Ga=ha.layer;if(!Ga.tilemapCache||V.isVectorTileLayerView(ha))return this._requestTileData(sa,Ra,ha,Ua);++this._asyncWorkItems;return Ga.tilemapCache.fetchAvailability(sa.lij[0],sa.lij[1],sa.lij[2],{...Ua,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(Ya=>{--this._asyncWorkItems;
v.isAbortError(Ya)||this._dataMissing(sa,Ra,ha,{notInTilemap:!0});throw Ya;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(sa,Ra,ha,Ua),Ua.signal))};Pa._requestTileData=function(sa,Ga,Ra,Ua){return 0===Ga?this._requestElevationTileData(sa,Ra,Ua):this._requestMapTileData(sa,Ra,Ua)};Pa._requestElevationTileData=function(sa,Ga,Ra){if(V.isElevationLayerView(Ga)){var Ua=Wa=>{--this._asyncWorkItems;if(!v.isAborted(Ra)){var db=this._layerIndexByLayerViewId[0].get(Ga.uid);null==db?na.warn("TerrainSurface: received data from unknown layer %d %s",
0,sa.lij.toString()):(this._usedMemory=-1,this.pendingUpdates=!0,this._elevationDataArrived(sa,db,Wa))}},ha=Wa=>{--this._asyncWorkItems;v.isAbortError(Wa)||(this._dataMissing(sa,0,Ga,Wa),this.pendingUpdates=!0)};++this._asyncWorkItems;if(V.useFetchTileForLayer(Ga.layer))return Ga.layer.fetchTile(sa.lij[0],sa.lij[1],sa.lij[2],{noDataValue:Q.ELEVATION_NODATA_VALUE,signal:Ra.signal}).then(Wa=>{v.isAborted(Ra)?(na.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),
ha(v.createAbortError())):Ua(Wa)},ha);var Ya=Ga.getTileUrl(sa.lij[0],sa.lij[1],sa.lij[2]);return this._elevationDataRequester.request(Ya,"binary",Ra).then(Wa=>this._lercDecoder.decode(Wa,{noDataValue:Q.ELEVATION_NODATA_VALUE},Ra.signal)).then(Wa=>{Ua({values:Wa.pixelData,width:Wa.width,height:Wa.height,noDataValue:Wa.noDataValue,minValue:Wa.minValue,maxValue:Wa.maxValue})},ha)}V.weakAssert(!1,"_requestElevationTileData can only be called for elevation layer views")};Pa._requestMapTileData=function(sa,
Ga,Ra){if(Ga instanceof X)return v.reject();++this._asyncWorkItems;const Ua=Wa=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.pendingUpdates=!0;v.isAborted(Ra)?V.releaseTileData(Wa):this._dataArrived(sa,1,Ga,Wa)},Ra.signal).catch(ha),ha=Wa=>this._frameTask.schedule(()=>{--this._asyncWorkItems;v.isAborted(Ra)||(this._dataMissing(sa,1,Ga,Wa),this.pendingUpdates=!0)});if(V.isVectorTileLayerView(Ga)){var Ya=Ga.schemaHelper.getLevelRowColumn(sa.lij);return Ga.tileHandler.getVectorTile(Ya[0],
Ya[1],Ya[2],Ra).then(Wa=>{Wa.neededForCoverage=!0;Wa.transforms.tileUnitsToPixels=F.fromValues(.125,0,0,0,.125,0,0,0,1);W.declutterSingleTile(Wa,Ga.layer.styleRepository);Ua(Wa)},ha)}if(V.isImageryTileLayerView(Ga))return Ga.fetchTile(sa.lij[0],sa.lij[1],sa.lij[2],Ra).then(Ua,ha);if(V.useFetchTileForLayer(Ga.layer)&&V.isTileLayerView(Ga))return Ga.layer.fetchTile(sa.lij[0],sa.lij[1],sa.lij[2],Ra).then(Wa=>{v.isAborted(Ra)?(na.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),
ha(v.createAbortError())):Ua(Wa)},ha);Ya=Ga.getTileUrl(sa.lij[0],sa.lij[1],sa.lij[2]);null!=Ga.refreshInterval&&Ga.refreshTimestamp&&(Ya+=`${-1<Ya.indexOf("?")?"\x26":"?"}_ts=${Ga.refreshTimestamp}`);return this._mapDataRequester.request(Ya,Ga.hasMixedImageFormats?"image+type":"image",Ra).then(Ua,ha)};Pa._dataArrived=function(sa,Ga,Ra,Ua){Ra=this._layerIndexByLayerViewId[Ga].get(Ra.uid);null!=Ra?sa.dataArrived(Ra,Ga,Ua):na.warn("TerrainSurface: received data from unknown layer")};Pa._dataMissing=
function(sa,Ga,Ra,Ua){Ra=this._layerIndexByLayerViewId[Ga].get(Ra.uid);null!=Ra?sa.dataMissing(Ra,Ga,Ua):na.warn("TerrainSurface: received data from unknown layer")};Pa.updateTileOverlayParams=function(){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(sa=>{sa.renderData&&this.overlayManager.setTileParameters(sa)}),this._renderer.setNeedsRender())};Pa.updateOverlayOpacity=function(){if(this.overlayManager){var sa=this.overlayManager.computeOpacity(this._eyePosSurfaceSR[2]);sa!==this._overlayOpacity&&
(this._overlayOpacity=sa,this._renderer.overlayOpacity=sa,this._renderer.setNeedsRender())}};Pa.getUsedMemory=function(){if(!this.tilingScheme)return 0;-1===this._usedMemory&&(this._usedMemory=0,this._allTiles.forAll(sa=>this._usedMemory+=sa.usedMemory));return this._usedMemory};Pa.getUsedMemoryForLayerView=function(sa){let Ga=0;const Ra=this.layerClassFromLayerView(sa),Ua=this._layerIndexByLayerViewId[Ra].get(sa.uid);this._allTiles.forAll(ha=>Ga+=ha.getUsedMemoryForLayer(Ra,Ua));return Ga};Pa.getTile=
function(sa){const Ga=sa.split("/").map(Ya=>+Ya);if(0===Ga[0])return this.rootTiles.find(Ya=>Ya.lij[1]===Ga[1]&&Ya.lij[2]===Ga[2]);sa=Math.pow(2,Ga[0]);const Ra=Math.floor(Ga[1]/sa),Ua=Math.floor(Ga[2]/sa);let ha;this.rootTiles.some(Ya=>Ya.lij[1]===Ra&&Ya.lij[2]===Ua?(ha=Ya,!0):!1);if(ha){for(sa=1<<Ga[0]-1;ha.lij[0]<Ga[0];){let Ya=Ga[1]&sa?2:0;0<(Ga[2]&sa)&&Ya++;if(!ha.children[Ya])return null;ha=ha.children[Ya];sa>>=1}V.weakAssert(ha.lij[0]===Ga[0]&&ha.lij[1]===Ga[1]&&ha.lij[2]===Ga[2],"not the right tile?");
return ha}return null};Pa.getRenderedTiles=function(){Fa.clear();this._allTiles.forAll(sa=>{sa.visible&&sa.rendered&&Fa.push(sa)});ka.sortTiles(this.renderOrder,Fa);return Fa.toArray()};k._createClass(Qa,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",get:function(){return Math.round(this._snapLevel)}},{key:"upsampleInfoPool",get:function(){return this._upsampleInfoPool}},{key:"upsampleMapCache",get:function(){return this._upsampleMapCache}},
{key:"extent",get:function(){return this._clippingExtent||this._rootExtent}},{key:"updating",get:function(){return!(!(this.pendingUpdates||this._viewChanged||this._allTilesDirty||0<this._asyncWorkItems||!this._allTilesSorted||this._renderer.updating||this.overlayManager.updating||this._layerViewsDirty||this._frameTask.updating)||!this.ready||this.suspended)}},{key:"ready",get:function(){return!!this.rootTiles}},{key:"renderOrder",set:function(sa){this._renderer.renderOrder=sa;this._set("renderOrder",
sa)}},{key:"skirtScale",set:function(sa){this._renderer.skirtScale=sa},get:function(){return this._renderer.skirtScale}},{key:"spatialReference",get:function(){const sa=this.tilingScheme&&this.tilingScheme.spatialReference||null;return this._getElevationData.spatialReference=sa}},{key:"_background",get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage}},{key:"slicePlaneEnabled",set:function(sa){this._renderer.slicePlane=sa;this._set("slicePlaneEnabled",sa)}},{key:"velvetOverground",
set:function(sa){sa!==this.velvetOverground&&(this._renderer.velvetOverground=sa);this._set("velvetOverground",sa)}},{key:"visible",set:function(sa){sa!==this._visible&&(this._visible=sa,this._renderer.setVisibility(sa),this.suspended=!sa)}},{key:"suspended",set:function(sa){this._set("suspended",sa);this._viewChangeUpdate()}},{key:"lodSnapping",get:function(){return B.isEarth(this.spatialReference)?this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?1:0:0}},{key:"elevationBounds",get:function(){return this._elevationBounds}},
{key:"lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*Q.MAX_MEMORY_LOD_BIAS}},{key:"performanceInfo",get:function(){const sa=this._performanceInfo;sa.numNodes=this._allTiles.length;sa.numLeaves=sa.numVisible=sa.numRendered=sa.numLoadedPerLevel.length=sa.numRenderedPerLevel.length=0;this._allTiles.forAll(Ga=>{Ga.isLeaf&&sa.numLeaves++;const Ra=Ga.level;Ga.renderData&&(sa.numLoadedPerLevel[Ra]=(sa.numLoadedPerLevel[Ra]||
0)+1);Ga.visible&&(sa.numVisible++,Ga.rendered&&(sa.numRenderedPerLevel[Ra]=(sa.numRenderedPerLevel[Ra]||0)+1,sa.numRendered++))});return sa}},{key:"test",get:function(){const sa=this;return{renderer:sa._renderer,lercDecoder:sa._lercDecoder,forceReload:()=>{sa._mergeTile(sa.rootTiles[0]);sa._viewChangeUpdate()},getTiles:()=>sa._allTiles.toArray()}}}]);return Qa}(x.EventedMixin(y));a.__decorate([c.property()],r.prototype,"_renderer",void 0);a.__decorate([c.property()],r.prototype,"pendingUpdates",
void 0);a.__decorate([c.property()],r.prototype,"_asyncWorkItems",void 0);a.__decorate([c.property()],r.prototype,"_allTilesDirty",void 0);a.__decorate([c.property()],r.prototype,"_allTilesSorted",void 0);a.__decorate([c.property()],r.prototype,"_viewChanged",void 0);a.__decorate([c.property()],r.prototype,"_frameTask",void 0);a.__decorate([c.property({constructOnly:!0})],r.prototype,"view",void 0);a.__decorate([e.aliasOf("_renderer.cullBackFaces")],r.prototype,"cullBackFaces",void 0);a.__decorate([c.property({readOnly:!0,
dependsOn:[],autoTracked:!1})],r.prototype,"extent",null);a.__decorate([c.property({readOnly:!0,dependsOn:"ready suspended pendingUpdates _asyncWorkItems _allTilesDirty _allTilesSorted _renderer.updating _layerViewsDirty overlayManager.updating _frameTask.updating".split(" ")})],r.prototype,"updating",null);a.__decorate([c.property({aliasOf:"view.map.ground.opacity"})],r.prototype,"baseOpacity",void 0);a.__decorate([c.property({readOnly:!0})],r.prototype,"overlayManager",void 0);a.__decorate([c.property({constructOnly:!0})],
r.prototype,"manifold",void 0);a.__decorate([c.property()],r.prototype,"maxTextureScale",void 0);a.__decorate([c.property({readOnly:!0,autoTracked:!0})],r.prototype,"ready",null);a.__decorate([c.property({value:1})],r.prototype,"renderOrder",null);a.__decorate([c.property({readOnly:!0})],r.prototype,"rootTiles",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["tilingScheme.spatialReference"]})],r.prototype,"spatialReference",null);a.__decorate([c.property()],r.prototype,"backgroundImage",
void 0);a.__decorate([c.property({type:z,aliasOf:"view.map.ground.surfaceColor"})],r.prototype,"backgroundColor",void 0);a.__decorate([c.property({dependsOn:["backgroundColor","backgroundImage"]})],r.prototype,"_background",null);a.__decorate([c.property({value:!1})],r.prototype,"slicePlaneEnabled",null);a.__decorate([c.property({readOnly:!0})],r.prototype,"tilingScheme",void 0);a.__decorate([c.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],r.prototype,"tilingSchemeLocked",
void 0);a.__decorate([c.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],r.prototype,"tilingSchemeDone",void 0);a.__decorate([c.property({readOnly:!0})],r.prototype,"tilingSchemeLogic",void 0);a.__decorate([c.property({value:!0})],r.prototype,"velvetOverground",null);a.__decorate([e.aliasOf("_renderer.wireframe")],r.prototype,"wireframe",void 0);a.__decorate([c.property({value:!1})],r.prototype,"suspended",null);a.__decorate([c.property({readOnly:!0,dependsOn:["view.qualitySettings.tiledSurface.reduceTileLevelDifferences"]})],
r.prototype,"lodSnapping",null);a.__decorate([c.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],r.prototype,"textureFadeDuration",void 0);a.__decorate([c.property()],r.prototype,"_layerViewsDirty",void 0);a.__decorate([e.aliasOf("_renderer.renderPatchBorders")],r.prototype,"renderPatchBorders",void 0);a.__decorate([e.aliasOf("_renderer.renderingDisabled")],r.prototype,"renderingDisabled",void 0);a=r=a.__decorate([g.subclass("esri.views.3d.terrain.TerrainSurface")],
r);const oa=M.create(),ua=J.create(),za=[0,0,0],Fa=new u,La={spatialReference:null,tile:null,extent:null,context:"ground"},Sa={spatialReference:null,extent:null,scale:0};return a})},"esri/views/2d/engine/vectorTiles/decluttering/jobsUtil":function(){define("exports ./core ./util ./jobs ./SymbolDeclutterer ./SymbolRepository".split(" "),function(b,k,a,r,l,h){b.declutterSingleTile=function(d,c){const e=[],f=new h.SymbolRepository(4096,e,()=>{const p=new k.VTLUniqueSymbol;p.show=!1;p.parts.push({startTime:0,
startOpacity:0,targetOpacity:0,show:!1});p.parts.push({startTime:0,startOpacity:0,targetOpacity:0,show:!1});return p}),g=new l.SymbolDeclutterer(e,f,(p,n,w)=>new r.CollisionJob(p,n,w,d.styleRepository,d.key.level,0),(p,n)=>{a.writeOpacityToBuffers(p,n,!1)},()=>0,p=>(p=c.getStyleLayerByUID(p).getLayoutProperty("visibility"))&&"none"===p.getValue()?!1:!0);e.push(d);f.add(d);g.setScreenSize(512,512);g.continue(Infinity)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports",
"../../../../../chunks/mat3f32","./config","./util"],function(b,k,a,r){let l=function(){function h(c,e,f,g,p,n){this._symbols=c;this._styleRepository=g;this._zoom=p;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new r.GridIndex(e,f,a.COLLISION_GRID_CELL_SIZE);this._si=Math.sin(Math.PI*n/180);this._co=Math.cos(Math.PI*n/180);for(const w of c)for(const q of w.symbols)this._allNeededMatrices.has(q.tile)||this._allNeededMatrices.set(q.tile,
k.clone(q.tile.transforms.tileUnitsToPixels))}var d=h.prototype;d.work=function(c){const e=this._gridIndex,f=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const x=this._symbols[this._currentLayerCursor],C=this._getProperties(x.styleLayerUID);for(;this._currentSymbolCursor<x.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-f>c)return!1;var g=x.symbols[this._currentSymbolCursor];
if(!g.unique.show)continue;{var p=g,n=this._si,w=this._co,q=this._allNeededMatrices.get(g.tile),m=this._zoom;const {iconRotationAlignment:E,textRotationAlignment:G,iconTranslate:H,iconTranslateAnchor:I,textTranslate:J,textTranslateAnchor:K}=C;var u=0;for(const L of p.colliders){const [S,M]=0===L.partIndex?H:J;var v=0===L.partIndex?I:K,y=L.minLod<=m&&m<=L.maxLod;u+=y?0:1;L.enabled=y;L.xScreen=L.xTile*q[0]+L.yTile*q[3]+q[6];L.yScreen=L.xTile*q[1]+L.yTile*q[4]+q[7];0===v?(L.xScreen+=w*S-n*M,L.yScreen+=
n*S+w*M):(L.xScreen+=S,L.yScreen+=M);1===(0===L.partIndex?E:G)?(L.dxScreen=L.dxPixels,L.dyScreen=L.dyPixels):(L.dxScreen=w*(L.dxPixels+L.width/2)-n*(L.dyPixels+L.height/2)-L.width/2,L.dyScreen=n*(L.dxPixels+L.width/2)+w*(L.dyPixels+L.height/2)-L.height/2)}0<p.colliders.length&&u===p.colliders.length&&(p.unique.show=!1)}p=g.unique;if(!p.show)continue;const {iconAllowOverlap:z,iconIgnorePlacement:A,textAllowOverlap:t,textIgnorePlacement:D}=C;for(const E of g.colliders)if(E.enabled&&(n=p.parts[E.partIndex],
n.show)){if(w=!(E.partIndex?t:z))a:{w=E.xScreen+E.dxScreen;q=E.yScreen+E.dyScreen;m=w+E.width;u=q+E.height;const [G,H,I,J]=e.getCellSpan(w,q,m,u);for(v=H;v<=J;v++)for(y=G;y<=I;y++){var B=e.cells[v][y];for(const K of B){B=K.xScreen+K.dxScreen;const L=K.yScreen+K.dyScreen,S=B+K.width,M=L+K.height;if(!(m<B||w>S||u<L||q>M)){w=!0;break a}}}w=!1}w&&(E.hard?p.show=!1:n.show=!1)}if(p.show)for(const E of g.colliders){if(!E.enabled)continue;if(E.partIndex?D:A)continue;if(!p.parts[E.partIndex].show)continue;
g=E.xScreen+E.dxScreen;n=E.yScreen+E.dyScreen;const [G,H,I,J]=this._gridIndex.getCellSpan(g,n,g+E.width,n+E.height);for(g=H;g<=J;g++)for(n=G;n<=I;n++)this._gridIndex.cells[g][n].push(E)}}}return!0};d._getProperties=function(c){var e=this._styleProps.get(c);if(e)return e;e=this._zoom;const f=this._styleRepository.getStyleLayerByUID(c);var g=0!==f.getLayoutValue("symbol-placement",e);let p=f.getLayoutValue("icon-rotation-alignment",e);2===p&&(p=g?0:1);let n=f.getLayoutValue("text-rotation-alignment",
e);2===n&&(n=g?0:1);g=f.getPaintValue("icon-translate",e);const w=f.getPaintValue("icon-translate-anchor",e),q=f.getPaintValue("text-translate",e),m=f.getPaintValue("text-translate-anchor",e);e={iconAllowOverlap:f.getLayoutValue("icon-allow-overlap",e),iconIgnorePlacement:f.getLayoutValue("icon-ignore-placement",e),textAllowOverlap:f.getLayoutValue("text-allow-overlap",e),textIgnorePlacement:f.getLayoutValue("text-ignore-placement",e),iconRotationAlignment:p,textRotationAlignment:n,iconTranslateAnchor:w,
iconTranslate:g,textTranslateAnchor:m,textTranslate:q};this._styleProps.set(c,e);return e};return h}();b.CollisionJob=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./config"],function(b,k,a){function r(h,d){if(h.priority-d.priority)return h.priority-d.priority;const c=h.tile.key,e=d.tile.key;return c.world-e.world?c.world-e.world:c.level-e.level?
c.level-e.level:c.row-e.row?c.row-e.row:c.col-e.col?c.col-e.col:h.xTile-d.xTile?h.xTile-d.xTile:h.yTile-d.yTile}let l=function(){function h(c,e,f,g,p,n){this._visibleTiles=c;this._symbolRepository=e;this._createCollisionJob=f;this._assignTileSymbolsOpacity=g;this._symbolLayerSorter=p;this._isLayerVisible=n;this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}var d=h.prototype;
d.setScreenSize=function(c,e){this._screenWidth===c&&this._screenHeight===e||this.restart();this._screenWidth=c;this._screenHeight=e};d.restart=function(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0};d.continue=function(c){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var e=performance.now();if(!this._selectionJob.work(c))return!1;
this._selectionJobCompleted=!0;c=Math.max(0,c-(performance.now()-e));if(0===c)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){e=performance.now();if(!this._collisionJob.work(c))return!1;this._collisionJobCompleted=!0;c=Math.max(0,c-(performance.now()-e));if(0===c)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());if(!this._opacityJobCompleted){e=performance.now();
if(!this._opacityJob.work(c))return!1;this._opacityJobCompleted=!0;c=Math.max(0,c-(performance.now()-e));if(0===c)return!1}this._running=!1;return!0};d._createSelectionJob=function(){const c=this._symbolRepository.uniqueSymbols,e=[];let f=0,g=0;const p=this._isLayerVisible,n=this._symbolLayerSorter;return{work:function(w){const q=performance.now();for(;g<c.length;g++,f=0){const u=c[g];var m=u.styleLayerUID;if(!p(m)){e[g]||(e[g]={styleLayerUID:m,symbols:[]});continue}e[g]=e[g]||{styleLayerUID:m,symbols:[]};
const v=e[g];for(;f<u.uniqueSymbols.length;f++){m=u.uniqueSymbols[f];if(99===f%100&&performance.now()-q>w)return!1;let y=null,B=!1,x=!1;for(const C of m.tileSymbols)if(C.selectedForRendering=!1,!x||!B){const z=C.tile;if(!y||z.isCoverage||z.neededForCoverage&&!B){y=C;if(z.neededForCoverage||z.isCoverage)x=!0;z.isCoverage&&(B=!0)}}y.selectedForRendering=!0;if(x){v.symbols.push(y);m.show=!0;for(const C of m.parts)C.show=!0}else m.show=!1}}for(const u of e)u.symbols.sort(r);return!0},get sortedSymbols(){return e.sort(n)}}};
d._createOpacityJob=function(){function c(p,n){var w=p.symbols;for(const [,m]of w){var q=m;w=n;for(const u of q){q=u.unique;for(const v of q.parts)v.startOpacity+=(w-v.startTime)/a.FADE_DURATION*(.5<v.targetOpacity?1:-1),v.startOpacity=Math.min(Math.max(v.startOpacity,0),1),v.startTime=w,v.targetOpacity=q.show&&v.show?1:0}}e(p,n);for(const m of p.childrenTiles)c(m,n)}const e=this._assignTileSymbolsOpacity,f=this._visibleTiles;let g=0;return{work(p){const n=performance.now();for(;g<f.length;g++){if(performance.now()-
n>p)return!1;const w=f[g];if(w.parentTile)continue;const q=performance.now();c(w,q)}return!0}}};k._createClass(h,[{key:"running",get:function(){return this._running}}]);return h}();b.SymbolDeclutterer=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./util"],function(b,k,a,r){let l=function(){function h(c,e,f){this.tileCoordRange=
c;this._visibleTiles=e;this._createUnique=f;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}var d=h.prototype;d.add=function(c,e){this._uniqueSymbolLayerArray=null;let f=this._tiles.get(c.id);f||(f={symbols:new Map},this._tiles.set(c.id,f));var g=new Map;if(e)for(var p of e)f.symbols.has(p)&&(g.set(p,f.symbols.get(p)),f.symbols.delete(p));else for(var [n]of c.layerData)f.symbols.has(n)&&(g.set(n,f.symbols.get(n)),f.symbols.delete(n));this._removeSymbols(g);e=c.symbols;g=new Map;for(const [w,
q]of e)if(p=q.length,32<=p){n=this.tileCoordRange;do n/=2,p/=4;while(8<p&&64<n);p=new r.GridIndex(this.tileCoordRange,this.tileCoordRange,n);g.set(w,{flat:q,index:p});f.symbols.set(w,{flat:q,index:p});for(const m of q)p.getCell(m.xTile,m.yTile).push(m)}else g.set(w,{flat:q}),f.symbols.set(w,{flat:q});this._addSymbols(c.key,e)};d.deleteStyleLayers=function(c){this._uniqueSymbolLayerArray=null;for(const [e,f]of this._tiles){const g=new Map;for(const p of c)f.symbols.has(p)&&(g.set(p,f.symbols.get(p)),
f.symbols.delete(p));this._removeSymbols(g);0===f.symbols.size&&this._tiles.delete(e)}};d.removeTile=function(c){this._uniqueSymbolLayerArray=null;const e=this._tiles.get(c.id);if(e){var f=new Map;for(const [g]of c.symbols)e.symbols.has(g)&&(f.set(g,e.symbols.get(g)),e.symbols.delete(g));this._removeSymbols(f);0===e.symbols.size&&this._tiles.delete(c.id)}};d._removeSymbols=function(c){for(const [f,{flat:g}]of c)for(const p of g){c=p.unique;var e=c.tileSymbols;const n=e.length-1;for(let w=0;w<n;w++)if(e[w]===
p){e[w]=e[n];break}e.length=n;0===n&&(e=this._uniqueSymbolsReferences.get(f),e.delete(c),0===e.size&&this._uniqueSymbolsReferences.delete(f));p.unique=null}};d._addSymbols=function(c,e){if(0!==e.size){var f=this._visibleTiles;for(const g of f)g.parentTile||g.key.world!==c.world||g.key.level===c.level&&!g.key.equals(c)||this._matchSymbols(g,c,e);for(const [g,p]of e)for(const n of p)a.isNone(n.unique)&&(c=this._createUnique(),n.unique=c,c.tileSymbols.push(n),e=this._uniqueSymbolsReferences.get(g),e||
(e=new Set,this._uniqueSymbolsReferences.set(g,e)),e.add(c))}};d._matchSymbols=function(c,e,f){if(c.key.level>e.level){var g=c.key.level-e.level;if(c.key.row>>g!==e.row||c.key.col>>g!==e.col)return}if(e.level>c.key.level&&(g=e.level-c.key.level,e.row>>g!==c.key.row||e.col>>g!==c.key.col))return;if(e.equals(c.key))for(var p of c.childrenTiles)this._matchSymbols(p,e,f);else{p=new Map;for(const [q,m]of f){var n=[];for(const v of m)f=r.tileCoordChange(this.tileCoordRange,v.xTile,e.level,e.col,c.key.level,
c.key.col),g=r.tileCoordChange(this.tileCoordRange,v.yTile,e.level,e.row,c.key.level,c.key.row),0<=f&&f<this.tileCoordRange&&0<=g&&g<this.tileCoordRange&&n.push({symbol:v,xTransformed:f,yTransformed:g});f=[];g=c.key.level<e.level?1:1<<c.key.level-e.level;const u=this._tiles.get(c.id).symbols.get(q);if(u){const v=u.flat;for(const y of n){var w=!1;let B;const x=y.xTransformed,C=y.yTransformed;B=a.isSome(u.index)?u.index.getCell(x,C):v;n=y.symbol;const z=n.hash;for(const A of B)if(z===A.hash&&Math.abs(x-
A.xTile)<=g&&Math.abs(C-A.yTile)<=g){w=A.unique;n.unique=w;w.tileSymbols.push(n);w=!0;break}w||f.push(n)}}0<f.length&&p.set(q,f)}for(const q of c.childrenTiles)this._matchSymbols(q,e,p)}};d._createUniqueSymbolLayerArray=function(){var c=this._uniqueSymbolsReferences;const e=Array(c.size);let f=0;for(const [g,p]of c){const n=Array(p.size);c=0;for(const w of p)n[c++]=w;e[f]={styleLayerUID:g,uniqueSymbols:n};f++}return e};k._createClass(h,[{key:"uniqueSymbols",get:function(){a.isNone(this._uniqueSymbolLayerArray)&&
(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}}]);return h}();b.SymbolRepository=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){a=function(u){function v(){return u.apply(this,arguments)||this}b._inheritsLoose(v,u);v.prototype.initialize=function(){var y=this.get("view.map.allLayers");y=y&&y.includes(this.layer);var B=this.get("view.map.ground.layers");B=B&&B.includes(this.layer);y&&!B&&(y=new e("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(n.reject(y)));this._addTilingSchemeMatchPromise()};return v}(q.TiledLayerView3D(w.LayerView3D(m)));
k.__decorate([h.property({readOnly:!0,aliasOf:"layer.fullExtent"})],a.prototype,"fullExtent",void 0);k.__decorate([h.property()],a.prototype,"layer",void 0);k.__decorate([h.property({readOnly:!0,aliasOf:"layer.tileInfo"})],a.prototype,"tileInfo",void 0);return a=k.__decorate([c.subclass("esri.views.3d.layers.ElevationLayerView3D")],a)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/watchUtils ../../../geometry/support/heightModelInfoUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){b.LayerView3D=q=>{q=function(m){function u(){var y=m.apply(this,arguments)||this;y.slicePlaneEnabled=!1;y.supportsHeightUnitConversion=!1;return y}k._inheritsLoose(u,m);var v=u.prototype;v.postscript=function(y){m.prototype.postscript.call(this,y);w.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};v._validateHeightModelInfo=async function(){var y=n.whenFalseOnce(this.view.defaultsFromMap,"isHeightModelInfoSearching");
this.handles.add(y);await y;if(y=w.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw y;};return u}(q);a.__decorate([d.property()],q.prototype,"view",void 0);a.__decorate([d.property()],q.prototype,"slicePlaneEnabled",void 0);return q=a.__decorate([e.subclass("esri.views.3d.layers.LayerView3D")],q)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/watchUtils ../terrain/terrainUtils ./support/layerViewUpdatingProperties".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){b.TiledLayerView3D=v=>{v=function(y){function B(){return y.apply(this,arguments)||this}k._inheritsLoose(B,y);var x=B.prototype;x.getTileUrl=function(C,z,A){return this.layer.getTileUrl(C,z,A)};x._addTilingSchemeMatchPromise=function(){var C=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent);C?this.addResolvingPromise(w.reject(C)):(C=q.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(()=>{const z=this._getTileInfoCompatibilityError(this.tileInfo,
this.view.basemapTerrain.tilingScheme);if(z)throw z;}),this.addResolvingPromise(C))};x._getTileInfoSupportError=function(C,z){if(C=m.checkIfTileInfoSupportedForView(C,z,this.view.spatialReference,this.view.basemapTerrain.manifold)){z={layer:this.layer,error:C};switch(C.name){case "tilingscheme:local-gcs-not-supported":C=new f("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",z);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":C=
new f("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",z);break;default:C=new f("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",z)}return C}return null};x._getTileInfoCompatibilityError=function(C,z){return z.compatibleWith(C)?null:new f("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};x.levelRangeFromScaleRange=
function(C,z){const A={minLevel:0,maxLevel:Infinity};var t=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!t)return A;const D=t.levels[0];t=E=>{E=Math.log(D.scale/E)/Math.LN2;return 1E-9>.5-Math.abs(.5-E%1)?Math.round(E):Math.ceil(E)};null!=C&&0<C&&(A.minLevel=Math.max(0,t(C)));null!=z&&0<z&&(A.maxLevel=Math.max(0,t(z)));return A};x.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};k._createClass(B,[{key:"imageFormatIsOpaque",
get:function(){return!1}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataLevelRange",get:function(){const C=this.tileInfo.lods;return this.levelRangeFromScaleRange(C[0].scale,C[C.length-1].scale)}},{key:"displayLevelRange",get:function(){var C=this.tileInfo.lods;C=this.levelRangeFromScaleRange(this.layer.minScale||C[0].scale,this.layer.maxScale||C[C.length-1].scale);this.layer.maxScale&&C.maxLevel++;return C}}]);return B}(v);a.__decorate([d.property({readOnly:!0})],
v.prototype,"imageFormatIsOpaque",null);a.__decorate([d.property({readOnly:!0,dependsOn:["view.basemapTerrain.updating"]})],v.prototype,"updating",void 0);a.__decorate([d.property(u.updatingProgress)],v.prototype,"updatingProgress",void 0);a.__decorate([d.property(u.updatingProgressValue)],v.prototype,"updatingProgressValue",void 0);a.__decorate([d.property({readOnly:!0})],v.prototype,"fullExtent",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:["fullOpacity","imageFormatIsOpaque"]})],v.prototype,
"isOpaque",null);a.__decorate([d.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme"]})],v.prototype,"dataLevelRange",null);a.__decorate([d.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme","layer.minScale","layer.maxScale"]})],v.prototype,"displayLevelRange",null);a.__decorate([d.property()],v.prototype,"layer",void 0);a.__decorate([d.property({readOnly:!0})],v.prototype,"tileInfo",void 0);return v=a.__decorate([e.subclass("esri.views.3d.layers.TiledLayerView3D")],
v)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["exports"],function(b){b.updatingProgress={dependsOn:["updating","updatingProgressValue"],readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};b.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(b){let k=function(){function a(r=
0,l=0){this.min=r;this.max=l;this.level=0;this.hasNoDataValues=!1}a.prototype.copyFrom=function(r){this.min=r.min;this.max=r.max;this.level=r.level;this.hasNoDataValues=r.hasNoDataValues};return a}();b.ElevationBounds=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports","../../../core/mathUtils","../support/mathUtils","./TerrainConst"],function(b,k,a,r){let l=function(){function h(c,e,f){this.samplerData=null;this.level=c[0];this.i=
c[1];this.j=c[2];this.extent=e;c=f.noDataValue;const g=f.values;let p=Infinity,n=-Infinity,w=!0,q=!1;for(let m=0;m<g.length;m++){const u=g[m];u!==c?(p=u<p?u:p,n=u>n?u:n,w=!1):q=!0}w&&(n=p=0);this.samplerData={pixelData:f.values,width:f.width,height:f.height,noDataValue:c,safeWidth:.99999999*(f.width-1),dx:(f.width-1)/(e[2]-e[0]),dy:(f.width-1)/(e[3]-e[1]),x0:e[0],y1:e[3]};this.bounds=[p,-3E38<n?n:0];this.hasNoDataValues=q}var d=h.prototype;d.release=function(){this.bounds=this.samplerData=null};d.computeMinMaxValue=
function(c,e,f,g){g.min=Infinity;g.max=-Infinity;g.hasNoDataValues=!1;c-=this.level;if(0>=c)return g;var p=Math.pow(2,c);if(Math.floor(e/p)!==this.i||Math.floor(f/p)!==this.j)return g;var n=Infinity,w=-Infinity,q=this.samplerData.width,m=this.samplerData.pixelData,u=.5*r.ELEVATION_NODATA_VALUE;c=(q-1)/p;f=(f-this.j*p)*c;let v=(e-this.i*p)*c;if(1>c){const x=Math.floor(f),C=Math.floor(v);var y=x+C*q;e=m[y];p=m[y+1];var B=m[y+q];y=m[y+q+1];if(e+p+B+y<u)return n=f-x,u=v-C,w=a.bilerp(e,p,B,y,n,u),q=a.bilerp(e,
p,B,y,n+c,u),m=a.bilerp(e,p,B,y,n,u+c),c=a.bilerp(e,p,B,y,n+c,u+c),g.min=Math.min(w,q,m,c),g.max=Math.max(w,q,m,c),g;f=x;v=C;c=1}else f=Math.floor(f),v=Math.floor(v),c=Math.ceil(c);for(e=f;e<=f+c;e++)for(p=v;p<=v+c;p++)B=m[e+p*q],B<u?(n=Math.min(n,B),w=Math.max(w,B)):g.hasNoDataValues=!0;g.min=n;g.max=w;return g};h.sample=function(c,e,f){for(const q of f){if(!q)continue;var g=q.safeWidth,p=q.width,n=q.pixelData;f=k.clamp(q.dy*(q.y1-e),0,g);g=k.clamp(q.dx*(c-q.x0),0,g);const m=Math.floor(f),u=Math.floor(g);
var w=m*p+u;const v=w+p,y=n[w];p=n[v];w=n[w+1];n=n[v+1];if(y+p+w+n<.5*r.ELEVATION_NODATA_VALUE)return f-=m,g-=u,c=y+(w-y)*g,c+(p+(n-p)*g-c)*f}return null};return h}();b.ElevationData=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/scheduling ../../../core/Accessor ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../support/mathUtils ../../../core/Handles ../../../geometry/projectionEllipsoid ../../../core/unitUtils ../../../layers/support/timeUtils ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../support/Scheduler ../../../chunks/vec4f64 ../../../chunks/vec2 ../../../chunks/vec4 ../support/geometryUtils ../webgl-engine/lib/Intersector ../state/utils/viewUtils ../support/debugFlags ../webgl-engine/lib/localOrigin ./OverlayRenderer ../support/debugUtils ../support/animationUtils ../webgl-engine/parts/requireUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q){function F(ka,da){const fa=L.TESTS_DISABLE_UPDATE_THRESHOLDS?0:1E-5*Math.max(ka[2]-ka[0],ka[3]-ka[1],da[2]-da[0],da[3]-da[1]);for(let ea=0;4>ea;ea++)if(Math.abs(da[ea]-ka[ea])>fa)return!0;return!1}const N=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let P;b.OverlayManager=function(ka){function da(ea){ea=ka.call(this,ea)||this;
ea._handles=new B;ea._overlaySR=null;ea._renderSR=null;ea._overlaySREqualsRenderSR=!0;ea._drapeSources=new Map;ea._drapeTargets=new Set;ea._drapeSourceTypes=[0,0];ea._drapeTargetTypes=[0,0];ea._renderedAltitude=0;ea._placementDirty=!1;ea._drawTexturesDirty=!1;ea._drawTexturesAnimateDirty=!1;ea._layerViewsDirty=!0;ea._hasUnusedRenderTargets=!1;ea._isSpherical=!1;ea._longitudeCyclical=null;ea._latestOriginId=0;ea._maxResolution=r("esri-mobile")?2048:4096;ea._animationTimeLast=0;ea._forceAnimation=!1;
return ea}k._inheritsLoose(da,ka);var fa=da.prototype;fa.initialize=function(){const ea=this.view._stage.renderView,Y=this.view.state.isGlobal&&l.isSome(this._overlaySR)?C.getMetersPerUnitForSR(this._overlaySR):1;this.renderer=new M.OverlayRenderer({renderView:ea,globalUnitScale:Y});this._drapeTargetTypes[0]++;this.renderer.onHasHighlightsChanged=()=>{this._setDrawTexturesDirty();this.notifyChange("hasHighlights")};this.renderer.onRendersOccludedChanged=()=>{this._setDrawTexturesDirty();this.notifyChange("rendersOccluded")};
this.renderer.onContentChanged=()=>{this._setDrawTexturesDirty()};this.groundIntersector=new J.Intersector(this.view.state.mode);this.groundIntersector.options.backfacesTerrain=!0;this.groundIntersector.options.invisibleTerrain=!0;this.groundIntersector.options.hud=!1;this._handles.add([this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location","pixelRatio"],()=>this.setOverlayPlacementDirty()),this.surface.on("elevation-change",()=>this.setOverlayPlacementDirty()),
this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0),this.view.on("resize",()=>this.setOverlayPlacementDirty()),w.addFrameTask({preRender:Z=>{this.renderer.commitChanges();this._updateLayerViews();this.renderer.hasOverlays&&(this._dispatchRendererUpdate(Z),this._drawOverlayTextures(this.renderer.overlays));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),this.view.resourceController.scheduler.registerTask(D.Task.OVERLAY_MANAGER,()=>this.updateOverlays(),
()=>this._needsUpdate),this.view._stage.renderView.events.on("force-camera-for-screenshot",Z=>{this.updateOverlays(Z);this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays)})]);this._updateLayerViews()};fa.destroy=function(){this._drapeSources.forEach((ea,Y)=>this.unregisterDrapeSource(Y));this._drapeTargets.forEach(ea=>this._unregisterDrapeTarget(ea));this._drapeTargetTypes[0]--;this._disposeOverlays();this.renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=
null);l.isSome(P)&&(P.remove(),P=null)};fa.setSpatialReference=function(ea,Y){this._overlaySR=ea;this._longitudeCyclical=null;const Z=this.view.renderSpatialReference;if(l.isSome(ea)&&l.isSome(Z)){this._renderSR=Z;this._overlaySREqualsRenderSR=ea.equals(this._renderSR);if(this._isSpherical=Y)this._longitudeCyclical=ea.isWebMercator?new y.Cyclical(-2.0037508342787E7,2.0037508342787E7):new y.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical;this.renderer&&(this.renderer.globalUnitScale=
Y&&l.isSome(this._overlaySR)?C.getMetersPerUnitForSR(this._overlaySR):1)}else this._disposeOverlays()};fa.getGpuMemoryUsage=function(){return this.renderer.gpuMemoryUsage};fa._updateLayerViews=function(){if(this._layerViewsDirty){var ea=new Set;for(const Y of this.view.allLayerViews.items)ea.add(Y.uid),"drapeSourceType"in Y&&!this._drapeSources.has(Y)&&this._registerDrapeSource(Y,0),"drapeTargetType"in Y&&!this._drapeTargets.has(Y)&&this._registerDrapeTarget(Y);this._drapeSources.forEach((Y,Z)=>{0!==
Y||ea.has(Z.uid)||this.unregisterDrapeSource(Z)});this._drapeTargets.forEach(Y=>{ea.has(Y.uid)||this._unregisterDrapeTarget(Y)});this.renderer.updateLayerOrder();this._setDrawTexturesDirty();this._layerViewsDirty=!1}};fa.registerDrapeSource=function(ea){this._registerDrapeSource(ea,1)};fa._registerDrapeSource=function(ea,Y){this._drapeSourceTypes[ea.drapeSourceType]++;this._drapeSources.set(ea,Y);this.renderer.forEachOverlay((Z,ba)=>this._updateDrapeSource(ea,ba,Z));this._setOverlayContentDirty();
this.notifyChange("_needsUpdate")};fa._updateDrapeSource=function(ea,Y,Z){l.isSome(ea.setDrapingExtent)&&l.isSome(this._overlaySR)&&ea.setDrapingExtent(Y,Z.extent,this._overlaySR,Z.resolution,Z.renderLocalOrigin,Z.pixelRatio)};fa.unregisterDrapeSource=function(ea){this._drapeSources.has(ea)&&(this._drapeSourceTypes[ea.drapeSourceType]--,this._drapeSources.delete(ea),this._setOverlayContentDirty(),this.notifyChange("_needsUpdate"))};fa._registerDrapeTarget=function(ea){this._drapeTargets.add(ea);this._updateDrapeTarget(ea);
this._drapeTargetTypes[ea.drapeTargetType]++};fa._updateDrapeTarget=function(ea){this.renderer.forEachOverlay((Y,Z)=>{var ba=Y.renderTargets;const ia=this.needsColorWithoutRasterImage()?ba.colorWithoutRasterImage:this.hasDrapedFeatures()?ba.color:null,ja=ba.highlight;ba=ba.water;ea.setDrapingTextures(Z,Y.extent,ia&&ia.valid?ia.fbo.getTexture():null,ja.valid?ja.fbo.getTexture():null,ba.valid?ba.fbo.getTexture():null)})};fa._unregisterDrapeTarget=function(ea){this._drapeTargets.delete(ea);this._drapeTargetTypes[ea.drapeTargetType]--};
fa._setOverlayContentDirty=function(){this.setOverlayPlacementDirty();this._setDrawTexturesDirty()};fa.setOverlayPlacementDirty=function(){this._placementDirty=!0};fa.updateOverlays=function(ea=this.view.state.camera){if(this._overlaySR){this._updateLayerViews();var Y=m.nextHighestPowerOfTwo(Math.max(ea.fullWidth,ea.fullHeight)+256);var Z=Math.min(Y,this._maxResolution);this._computeOverlayExtents(ea,Y,X);Y=A.width(X.inner)/A.width(X.outer);this.renderer.ensureOverlays();ea=this._updateOverlay(0,
X.inner,Z,1);Z=this._updateOverlay(1,X.outer,Z,Y);if(ea||Z)this.surface.updateTileOverlayParams(),this._setDrawTexturesDirty();this._placementDirty=!1;this.surface.updateOverlayOpacity()}};fa._updateOverlay=function(ea,Y,Z,ba){if(l.isNone(this.renderer.overlays))return!1;const ia=this.renderer.overlays[ea];if(!F(Y,ia.extent)&&Z===ia.resolution&&ia.pixelRatio===ba)return!1;A.set(ia.extent,Y);ia.resolution=Z;ia.pixelRatio=ba;Y=A.center(ia.extent);ia.renderLocalOrigin=S.fromValues(Y[0],Y[1],0,`OV_${this._latestOriginId++}`);
this._drapeSources.forEach((ja,la)=>this._updateDrapeSource(la,ea,ia));return!0};fa.computeOpacity=function(ea){return this.renderer.hasOverlays?3.5*ea<this._renderedAltitude?Math.sqrt(m.clamp((ea-this._renderedAltitude/10)/(this._renderedAltitude/3.5-this._renderedAltitude/10),0,1)):1:1};fa.setTileParameters=function(ea){const Y=ea.renderData.overlay;if(l.isSome(this.renderer.overlays)){const Z=this.renderer.overlays[0],ba=this.renderer.overlays[1];ea=A.intersection(ea.extent,ea.surface.extent,ca);
this._rectInsideRect(ea,Z.extent)?(this._setTileOverlayData(ea,0,Y),this._clearTileOverlayData(1,Y)):this._rectanglesOverlap(ea,Z.extent)?(this._setTileOverlayData(ea,0,Y),this._setTileOverlayData(ea,1,Y)):this._rectanglesOverlap(ea,ba.extent)?(this._clearTileOverlayData(0,Y),this._setTileOverlayData(ea,1,Y)):(this._clearTileOverlayData(0,Y),this._clearTileOverlayData(1,Y))}else this._clearTileOverlayData(0,Y),this._clearTileOverlayData(1,Y)};fa.overlayPixelSizeInMapUnits=function(ea){if(l.isNone(this.renderer.overlays))return 0;
const Y=this.renderer.overlays[0],Z=this.renderer.overlays[1];ea=this._pointIsInExtent(ea,Y.extent)?Y:Z;return(ea.extent[2]-ea.extent[0])/ea.resolution};fa._setTileOverlayData=function(ea,Y,Z){if(!l.isNone(this.renderer.overlays)){var ba=this.renderer.overlays[Y].extent;Z.setScale(Y,(ea[2]-ea[0])/(ba[2]-ba[0]),(ea[3]-ea[1])/(ba[3]-ba[1]));var ia=ea[0];if(this._longitudeCyclical){ia=this._longitudeCyclical.minimalMonotonic(ba[0],ia);const ja=this._longitudeCyclical.minimalMonotonic(ba[0],ea[2]);ia>
ja&&(ia=ja-(ea[2]-ea[0]))}Z.setOffset(Y,(ia-ba[0])/(ba[2]-ba[0]),(ea[1]-ba[1])/(ba[3]-ba[1]))}};fa._clearTileOverlayData=function(ea,Y){Y.setScale(ea,-1,-1);Y.setOffset(ea,-1,-1)};fa._disposeOverlays=function(){this.renderer.disposeOverlays()};fa.reloadShaders=async function(){Q.removeLoadedShaderModules();await this.renderer.reloadShaders();this.updateOverlays()};fa.stopAnimationsAtTime=function(ea){this.renderer.stopAnimationsAtTime(ea);this._forceAnimation=!0};fa._dispatchRendererUpdate=function(ea){const Y=
z.Milliseconds(ea.time-this._animationTimeLast);Y<O.DESIRED_DRAPED_ANIMATION_MS&&!this._forceAnimation||(this._animationTimeLast=ea.time,this.renderer.updateLogic({dt:Y,camera:this.view._stage.getCamera()})&&(this._drawTexturesAnimateDirty=!0))};fa._setDrawTexturesDirty=function(){this.renderer.hasOverlays?this._drawTexturesDirty=!0:this.setOverlayPlacementDirty()};fa._intersectGroundFromView=function(ea,Y,Z,ba){Z=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(ea,aa,Y,Z);if(l.isNone(Z))return!1;
Y=Z.origin;Z=v.add(W,Z.origin,Z.direction);this.groundIntersector.reset(Y,Z);this.groundIntersector.intersect([],null,ea);this.view.basemapTerrain.intersect(this.groundIntersector,null,Y,Z);return this.groundIntersector.results.min.getIntersectionPoint(ba)};fa._findHorizonBasedPointOfInterest=function(ea,Y){var Z=.5;Z=this.view.renderCoordsHelper.getAltitude(ea.eye);const ba=this.view.pointsOfInterest.centerOnSurfaceFrequent;var ia=m.clamp(ba.estimatedSurfaceAltitude,ea.aboveGround?-Infinity:Z+1E-5,
ea.aboveGround?Z-1E-5:Infinity);Z=ea.aboveGround;if("global"===this.view.viewingMode){var ja=W;I.sphere.closestPointOnSilhouette(I.sphere.wrap(x.getReferenceEllipsoid(this.view.spatialReference).radius+ia),I.ray.wrap(ea.eye,ea.viewForward),ja);v.subtract(ja,ja,ea.eye);ia=y.cyclicalPI.normalize(I.vector.angleAroundAxis(ea.viewForward,ja,ea.viewRight))/ea.fovY+.5;ja=0>=ia||1<=ia?.5:.55;Z=Z?ja*ia:ia+ja*(1-ia)}else ia=E.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-ea.viewForward[2])),1,0),ia=H.transformMat4(ia,
ia,ea.projectionMatrix)[1],ia=m.clamp(.5+.5*ia,0,1),Z=1===ia||0===ia?.5:Z?.55*ia:1-.55*(1-ia);return this._intersectGroundFromView(ea,.5,Z,Y)?v.sqrDist(Y,ea.eye)<ba.distance*ba.distance:!1};fa._computeOverlayExtents=function(ea,Y,Z){var ba=this.surface.extent,ia=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;const ja=u.create();this._findHorizonBasedPointOfInterest(ea,ja)||v.copy(ja,ia);this._renderedAltitude=this.view.renderCoordsHelper.getAltitude(ea.eye);var la=v.distance(ea.eye,
ja);ia=K.viewAngle(this.view.renderCoordsHelper,ia,ea.eye);ia=Math.PI/2-Math.abs(ia-Math.PI/2);L.OVERLAY_SHOW_CENTER?(l.isNone(P)&&(P=new T.GraphicsHandle(this.view.graphics,"red")),P.showPoint(ja,this._renderSR)):l.isSome(P)&&P.remove();this._overlaySREqualsRenderSR||t.projectVectorToVector(ja,this._renderSR,ja,this._overlaySR);la=Y*ea.perRenderPixelRatio*la/2;var qa=!1;let na=Infinity;this._isSpherical&&l.isSome(this._overlaySR)&&(this._overlaySR.isWebMercator?(la/=Math.cos(t.webMercator.y2lat(ja[1])),
na=this.surface.extent[3]):(qa=!0,la/=x.getReferenceEllipsoid(this._overlaySR).metersPerDegree,na=90),la>=na&&(la=na,ja[1]=0,this._overlaySR.isWebMercator&&(ja[0]=0)));let oa=1;qa&&(oa=1/Math.max(.2,Math.cos(Math.abs(m.deg2rad(ja[1])))),180<la*oa&&(oa=180/la));qa=Math.log(2)/12;la=Math.exp(Math.round(Math.log(la)/qa)*qa);qa=la*oa;const ua=.5*Y/(32*qa);Y=.5*Y/(32*la);ja[0]=Math.round(ja[0]*ua)/ua;ja[1]=Math.round(ja[1]*Y)/Y;Y=Z.inner;Y[0]=ja[0]-qa;Y[1]=ja[1]-la;Y[2]=ja[0]+qa;Y[3]=ja[1]+la;this._isSpherical&&
this._shiftExtentToFitBounds(Y,Infinity,na);Z=Z.outer;A.set(Z,Y);6*qa>ba[2]-ba[0]?A.set(Z,ba):ia<=.25*Math.PI?(Z[0]-=qa,Z[1]-=la,Z[2]+=qa,Z[3]+=la):(t.projectVectorToVector(ea.eye,this._renderSR,W,this._overlaySR),G.subtract(V,ja,W),ea=-Math.atan2(V[1],V[0])+.125*Math.PI,0>ea&&(ea+=2*Math.PI),H.scale(V,N[Math.floor(ea/(.25*Math.PI))],2*la),V[0]*=oa,V[2]*=oa,H.add(Z,Z,V));this._isSpherical&&(Z[0]=this._longitudeCyclical.clamp(Z[0]),Z[2]=this._longitudeCyclical.clamp(Z[2]),Z[1]=Math.max(Z[1],-na),Z[3]=
Math.min(Z[3],na));!this._isSpherical&&ba&&(ea=A.intersection(Y,ba,ca),ba=A.intersection(Z,ba,R),A.contains(ea,ba)&&(Z[2]=Z[0],Z[3]=Z[1]))};fa._drawOverlayTextures=function(ea){if(!l.isNone(ea)&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var Y=this._drawOverlay(ea,0);ea=this._drawOverlay(ea,1);0!==Y&&0!==ea||this.surface.updateTileOverlayParams();this._collectUnusedRenderTargetMemory();this._drapeTargets.forEach(Z=>this._updateDrapeTarget(Z));this._drawTexturesDirty?(this._drawTexturesAnimateDirty=
this._drawTexturesDirty=!1,this.surface.requestRender(),this.surface.pendingUpdates=!0):(this._drawTexturesAnimateDirty=!1,this.surface.requestRender(0))}};fa._setupGeometryViewsCyclical=function(ea,Y,Z){this._setupGeometryViewsDirect(ea,Y,Z);const ba=.001*this._longitudeCyclical.range;if(Y[0]-ba<=this._longitudeCyclical.min){const ia=ea.views[ea.numViews++];H.set(ia.viewport,0,0,Z,Z);A.offset(Y,this._longitudeCyclical.range,0,ia.extent)}Y[2]+ba>=this._longitudeCyclical.max&&(ea=ea.views[ea.numViews++],
H.set(ea.viewport,0,0,Z,Z),A.offset(Y,-this._longitudeCyclical.range,0,ea.extent))};fa._setupGeometryViewsDirect=function(ea,Y,Z){ea.numViews=1;ea=ea.views[0];A.set(ea.extent,Y);H.set(ea.viewport,0,0,Z,Z)};fa._drawOverlay=function(ea,Y){const Z=ea[Y];ea=Z.computeRenderTargetValidityBitfield();const {extent:ba,resolution:ia,pixelRatio:ja}=Z;this._longitudeCyclical?this._setupGeometryViewsCyclical(U,ba,ia):this._setupGeometryViewsDirect(U,ba,ia);U.width=ia;U.height=ia;U.pixelRatio=ja*this.view.state.camera.pixelRatio;
U.index=Y;Z.drawRenderTargets(this.renderer,U,this.needsColorWithoutRasterImage());Y=Z.computeRenderTargetValidityBitfield();return ea^Y?0:1};fa.needsColorWithoutRasterImage=function(){return 0<this._drapeSourceTypes[0]&&0<this._drapeSourceTypes[1]&&0<this._drapeTargetTypes[1]};fa.hasDrapedFeatures=function(){return 0<this._drapeSourceTypes[1]};fa._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;if(this.renderer.hasOverlays){const ea=performance.now();this.renderer.forEachOverlay(Y=>
this._hasUnusedRenderTargets=Y.collectUnusedMemory(ea)||this._hasUnusedRenderTargets)}};fa._rectanglesOverlap=function(ea,Y){return this._longitudeCyclical?(this._longitudeCyclical.contains(Y[0],Y[2],ea[0])||this._longitudeCyclical.contains(Y[0],Y[2],ea[2])||this._longitudeCyclical.contains(ea[0],ea[2],Y[0]))&&!(ea[1]>Y[3]||ea[3]<Y[1]):A.intersects(ea,Y)};fa._rectInsideRect=function(ea,Y){return this._longitudeCyclical?this._longitudeCyclical.contains(Y[0],Y[2],ea[0])&&this._longitudeCyclical.contains(Y[0],
Y[2],ea[2])&&ea[1]>Y[1]&&ea[3]<Y[3]:A.contains(Y,ea)};fa._pointIsInExtent=function(ea,Y){if(this._longitudeCyclical)return this._longitudeCyclical.contains(Y[0],Y[2],ea.x)&&ea.y>=Y[1]&&ea.y<=Y[3];const Z=ea.x;ea=ea.y;return Z>Y[0]&&Z<Y[2]&&ea>Y[1]&&ea<Y[3]};fa._shiftExtentToFitBounds=function(ea,Y,Z){let ba=0,ia=0;ea[0]<-Y?ba=ea[0]+Y:ea[2]>Y&&(ba=Y-ea[2]);ea[1]<-Z?ia=ea[1]+Z:ea[3]>Z&&(ia=Z-ea[3]);A.offset(ea,ba,ia)};k._createClass(da,[{key:"_needsUpdate",get:function(){return(this._placementDirty||
this._layerViewsDirty)&&(0<this._drapeSources.size||0<this.view.graphics.length||L.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._overlaySR&&!this.suspended&&this.surface.ready}},{key:"view",get:function(){return this.surface.view}},{key:"updating",get:function(){return this._needsUpdate||this.renderer.updating}},{key:"hasHighlights",get:function(){return this.renderer.hasHighlights}},{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},
{key:"test",get:function(){return{renderer:this.renderer}}}]);return da}(q);a.__decorate([c.property()],b.OverlayManager.prototype,"_overlaySR",void 0);a.__decorate([c.property({readOnly:!0})],b.OverlayManager.prototype,"_needsUpdate",null);a.__decorate([c.property()],b.OverlayManager.prototype,"_placementDirty",void 0);a.__decorate([c.property()],b.OverlayManager.prototype,"_layerViewsDirty",void 0);a.__decorate([c.property()],b.OverlayManager.prototype,"renderer",void 0);a.__decorate([c.property({constructOnly:!0})],
b.OverlayManager.prototype,"surface",void 0);a.__decorate([c.property({readOnly:!0,aliasOf:"surface.suspended"})],b.OverlayManager.prototype,"suspended",void 0);a.__decorate([c.property({readOnly:!0})],b.OverlayManager.prototype,"updating",null);a.__decorate([c.property({type:Boolean})],b.OverlayManager.prototype,"hasHighlights",null);a.__decorate([c.property({type:Boolean})],b.OverlayManager.prototype,"rendersOccluded",null);b.OverlayManager=a.__decorate([f.subclass("esri.views.3d.terrain.OverlayManager")],
b.OverlayManager);const U={width:0,height:0,pixelRatio:0,views:[{viewport:A.create(),extent:A.create()},{viewport:A.create(),extent:A.create()},{viewport:A.create(),extent:A.create()}],numViews:0,index:0},V=E.create(),W=u.create(),X={inner:A.create(),outer:A.create()},ca=A.create(),R=A.create(),aa=I.ray.create();Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/animationUtils":function(){define(["exports","../../../layers/support/timeUtils"],function(b,k){const a=k.Milliseconds(40);
k=k.Milliseconds(50);b.DESIRED_ANIMATION_FPS=25;b.DESIRED_ANIMATION_MS=a;b.DESIRED_DRAPED_ANIMATION_FPS=20;b.DESIRED_DRAPED_ANIMATION_MS=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports","../../../../core/global"],function(b,k){b.removeLoadedShaderModules=function(){var a;const r=null==(a=k.require)?void 0:a.modules;if(r){a=Object.keys(r);for(const l of a)-1!==l.search(".glsl")&&delete r[l]}};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/PooledArray"],function(b,k,a,r){function l(f){return f?f[0]+"/"+f[1]+"/"+f[2]:"null"}function h(f,g){g(f);if(!f.isLeaf)for(const p of f.children)h(p,g)}function d(f,g,p){f=f.screenDepth;g=g.screenDepth;return f<g?-p:f>g?p:0}let c=function(){function f(){this.q=new r;this._last=null}var g=f.prototype;g.resetOne=function(p){this.q.clear();
this.q.push(p);this._last=null};g.reset=function(p){this.q.clear();p&&this.q.pushArray(p);this._last=null};g.skipSubtree=function(){this._last=null};g.next=function(){this._last&&!this._last.isLeaf&&this.q.pushArray(this._last.children);return this._last=this.q.pop()};k._createClass(f,[{key:"done",get:function(){return 0===this.q.length&&(!this._last||this._last.isLeaf)}}]);return f}(),e=function(){function f(){this.q=new r}var g=f.prototype;g.reset=function(p){this.q.clear();if(p)for(this.q.pushArray(p),
p=0;p<this.q.length;++p){const n=this.q.data[p];n.isLeaf||this.q.pushArray(n.children)}};g.next=function(){return this.q.pop()};k._createClass(f,[{key:"done",get:function(){return 0===this.q.length}}]);return f}();b.IteratorPostorder=e;b.IteratorPreorder=c;b.compareTiles=d;b.computeUpsampleInfo=function(f,g,p){let n=1,w=0,q=0;for(;f!==g;)if(n*=.5,w*=.5,q*=.5,f.lij[2]&1&&(w+=.5),0===(f.lij[1]&1)&&(q+=.5),f=f.parent,null==f)throw Error("tile was not a descendant of upsampleTile");p.init(g,w,q,n)};b.fallsWithinLayer=
function(f,g,p){if(a.isNone(g))return!1;const n=g.fullExtent,w=f.extent;if(p){if(w[0]<n.xmin||w[1]<n.ymin||w[2]>n.xmax||w[3]>n.ymax)return!1}else if(n.xmin>w[2]||n.ymin>w[3]||n.xmax<w[0]||n.ymax<w[1])return!1;f=f.surface.tilingScheme.levels[f.lij[0]].scale;return 0<g.minScale&&f>1.00000001*g.minScale||0<g.maxScale&&f<.99999999*g.maxScale?!1:!0};b.hasVisibleSiblings=function(f){for(let g=0;g<f.length;g++){const p=f[g],n=p.parent;if(n)for(let w=0;4>w;w++){const q=n.children[w];if(q&&q!==p&&q.visible)return!0}}return!1};
b.lij2str=l;b.sortTiles=function(f,g){g.sort((p,n)=>d(p,n,f))};b.sortTilesByPOI=function(f,g){const p=new Map;f.forAll(n=>p.set(n,n.distanceToSquared(g)));f.sort((n,w)=>p.get(n)-p.get(w))};b.tile2str=function(f){return f?l(f.lij):"null"};b.tilesAreRelated=function(f,g){if(!f||!g||f[0]===g[0])return!1;const p=f[0]<g[0],n=p?f:g;f=p?g:f;g=1<<f[0]-n[0];return Math.floor(f[1]/g)===n[1]&&Math.floor(f[2]/g)===n[2]};b.traverseTilesPreorder=function(f,g){if(Array.isArray(f))for(let p=0;p<f.length;p++)h(f[p],
g);else h(f,g)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/ObjectPool ../../../core/arrayUtils ../../../core/promiseUtils ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../chunks/vec2f64 ../../../chunks/vec4f64 ../../../chunks/vec2 ../../../chunks/vec4 ./TerrainConst ../../webgl/Util ../support/StreamDataLoader ../../2d/engine/vectorTiles/VectorTile ./RasterTile ./TileTexture ./terrainUtils ./ElevationBounds ./tileUtils ./TileAgent ./ElevationTileAgent ./MapTileAgent ./TilePerLayerInfo".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E){function G(O){O.dispose();O instanceof t?M.release(O):O instanceof D&&S.release(O)}const H=x.weakAssert,I=d.create(),J=d.create(),K=d.create(),L=p.create();p=function(){function O(F){this._numSubdivisionAtLevel=F;this.lij=[0,0,0];this._children=[null,null,null,null];this._dirty=!0;this._previouslyRendered=!1;this.extent=f.create();this._elevationBounds=g.create();this.layerInfo=Array(2);this.extentInRadians=f.create();this.centerAtSeaLevel=
d.create();this._center=[d.create(),d.create(),d.create()];this.up=d.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._maxTesselation=0;this._usedMemory=-1;this._curvatureHeight=this._radius=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=this._mapDataRefCount=this._mapTileMemory=0}var Q=O.prototype;Q.init=function(F,N,P){this.lij[0]=F[0];this.lij[1]=F[1];this.lij[2]=F[2];this.ellipsoid=e.getReferenceEllipsoid(P.tilingScheme.spatialReference);
P.tilingScheme.getExtent(F[0],F[1],F[2],this.extent);P.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;P.upsampleMapCache.pop(z.tile2str(this));this._radius=this._edgeLen2=this._edgeLen=0;this.vlevel=F?F[0]:0;N&&N._elevationBounds?n.copy(this._elevationBounds,N.elevationBounds):n.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=
0;this._previouslyRendered=this._visible=!1;this._parent=N;this.unsetChildren();this._surface=P;this.updateVisibility();for(F=0;2>F;F++){N=P.numLayers(F);let U=this.layerInfo[F];this.layerInfo[F]?U.length=N:(U=Array(N),this.layerInfo[F]=U);for(let V=0;V<N;V++)U[V]=E.TilePerLayerInfo.makeEmptyLayerInfo(F,this._surface.upsampleInfoPool,U[V]),0===F&&this.findElevationBoundsForLayer(V,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(P.tilingScheme.pixelSize,q.MAX_PATCH_TESSELATION)};Q.release=
function(){H(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(z.tile2str(this));for(let F=0;2>F;F++)for(const N of this.layerInfo[F])N.dispose();this._surface=this._parent=null;this._usedMemory=-1};Q.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(z.tile2str(this))};Q.unrefMapData=function(){--this._mapDataRefCount;if(this.isCached){const F=this.cachedMemory;0<F&&(this._surface.upsampleMapCache.put(z.tile2str(this),
this,F),this.setMemoryDirty())}};Q.setMemoryDirty=function(){this._usedMemory=-1};Q._updateMemoryUsed=function(){this._mapTileMemory=this._usedMemory=0;var F=this.cpuImageMemorySize;for(const N of this.layerInfo[1]){const P=N.data;P instanceof B?this._mapTileMemory+=m.getGpuMemoryUsage(P.texture):P instanceof HTMLImageElement||P instanceof u.ImageWithType?this._mapTileMemory+=F:P instanceof y&&(this._mapTileMemory+=P.getMemoryUsage())}for(const N of this.layerInfo[0])this._usedMemory+=N.data?F:0;
this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,F=this.renderData.textureDescriptor)&&(this._mapTileMemory+=m.getGpuMemoryUsage(F));this.isCached&&this._surface.upsampleMapCache.updateSize(z.tile2str(this),this,this.cachedMemory)};Q.getUsedMemoryForLayer=function(F,N){N=this.layerInfo[F][N];if(!N||!N.data)return 0;if(1===F&&!this.isCached){F=N.data;if(F instanceof B)return m.getGpuMemoryUsage(F.texture);if(F instanceof HTMLImageElement||F instanceof u.ImageWithType)return this.cpuImageMemorySize;
if(F instanceof v.VectorTile||F instanceof y)return F.getMemoryUsage()}else if(0===F)return this.cpuImageMemorySize;return 0};Q.updateScreenDepth=function(F){c.copy(L,this._center[0]);L[3]=1;w.transformMat4(L,L,F);this._screenDepth=0>L[2]?0:L[2]/L[3]};Q.shouldSplit=function(F,N,P){const U=this.level;c.subtract(I,this._center[0],N);var V=c.squaredLength(I);let W=0;c.subtract(J,this._center[1],N);var X=c.squaredLength(J);X<V&&(V=X,W=1);c.subtract(J,this._center[2],N);X=c.squaredLength(J);X<V&&(V=X,
W=2);if(this._edgeLen2>V&&U<F.maxLod)return 2;V=Math.sqrt(V);const ca=this._edgeLen/(F.fovX*V*2);X=()=>{const ka=U+Math.ceil(-h.log2(F.relativeWidthLimit/ca));return ka!==this.vlevel?(this.vlevel=ka,4):1};if(1===P&&1===this._surface.snapLevel-U)return U>=F.maxLod?X():2;const R=c.dot(this.up,I);P=this._elevationBounds[1]-this._elevationBounds[0];const aa=P/this.edgeLen;return F.aboveGround&&0<R&&.001>aa&&0<R/V-Math.sin(this._curvatureHeight/(this.edgeLen*Math.SQRT1_2)*Math.PI)-aa?0:ca<F.relativeWidthLimit?
this.vlevel!==this.level?(this.vlevel=this.level,4):0:U>=F.maxLod?X():6<U&&(c.subtract(J,this._center[W],N),c.scale(K,this.up,R),c.subtract(K,K,J),X=c.squaredLength(K),X>this._radius*this._radius&&(c.scale(K,K,this._radius/Math.sqrt(X)),c.add(K,K,this._center[W]),c.subtract(K,N,K),Math.min(1,(Math.abs(c.dot(K,this.up))+.5*P+this._curvatureHeight)/c.length(K))*(this._edgeLen/(F.fovY*V*2))<.1/F.angledSplitBias*F.relativeHeightLimit))?0:2};Q.setChildren=function(F,N,P,U){H(!!(F&&N&&P&&U),"Null child passed");
this._children[0]=F;this._children[1]=N;this._children[2]=P;this._children[3]=U};Q.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};Q.load=function(F){this.refMapData();for(let N=0;2>N;N++)this.layerInfo[N]&&this._createOrUpdateAgents(0,N);F.loadTile(this)};Q.unload=function(F){F.unloadTile(this);for(F=0;2>F;F++){const N=this.layerInfo[F];for(const P of N)P.loadingAgent&&P.loadingAgent!==A.TILE_AGENT_DONE&&(G(P.loadingAgent),P.loadingAgent=
null),P.pendingUpdates=0}this.resetPendingUpdate(32);this.resetPendingUpdate(64);this.unrefMapData()};Q.unloadMapData=function(){const F=this.layerInfo[1];for(const N of F)N.loadingAgent&&N.loadingAgent!==A.TILE_AGENT_DONE&&(G(N.loadingAgent),N.loadingAgent=null),N.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};Q.updateClippingStatus=function(F){if(f.equals(F,this._clippingArea))return!1;var N=this._intersectsClippingArea;const P=this._isWithinClippingArea;
F?(this._intersectsClippingArea=this.intersectsExtent(F),this._isWithinClippingArea=this.isWithinExtent(F)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=F;this.updateVisibility();F=P&&this._isWithinClippingArea;N=!P&&!N&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||F||N||this.setPendingUpdate(32);return!0};Q.updateVisibility=function(){this._dirty=!0;this._surface.setTileTreeDirty()};Q.getLayerInfo=function(F,N){return this.layerInfo[N][F]};
Q.hasLayerData=function(F,N){F=this.layerInfo[N][F];return!(!F||!F.data||F.dataInvalidated)};Q.isSuspended=function(F){return this.hasPendingUpdate(2)?!0:0===F?!1:!this.visible};Q.hasPendingUpdate=function(F){return(this._pendingUpdates&F)===F};Q.setPendingUpdate=function(F){this._pendingUpdates|=F;2===F||8===F?this._surface.setTileTreeDirty():this._surface.pendingUpdates=!0};Q.resetPendingUpdate=function(F){return this.hasPendingUpdate(F)?(this._pendingUpdates&=~F,!0):!1};Q.requestLayerData=function(F,
N,P){const U=this.layerInfo[N][F];if(-1<U.waitingAgents.indexOf(P))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),P.tile.lij.toString(),N,F),!0;U.waitingAgents.push(P);if(U.data&&!U.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),P.tile.lij.toString(),N,F),P.dataArrived(this),!0;if(U.requestPromise)return!0;U.requestAbort=l.createAbortController();
const V=this._surface.requestTileData(this,F,N,U.requestAbort);if(!V)return U.requestAbort=null,!1;F=()=>{U.requestPromise===V&&(U.requestPromise=null,U.requestAbort=null)};U.requestPromise=V;V.then(F,F);return!!U.requestPromise};Q.hasLij=function(F){return this.lij[0]===F[0]&&this.lij[1]===F[1]&&this.lij[2]===F[2]};Q.findByLij=function(F){return this.hasLij(F)?this:this.isLeaf?null:(F=this._children[0].findByLij(F)||this._children[1].findByLij(F)||this._children[2].findByLij(F)||this._children[3].findByLij(F))?
F:null};Q.distanceToSquared=function(F){return c.squaredLength(c.subtract(K,this._center[0],F))};Q.containsPoint=function(F){const N=this.extent;return F[0]>=N[0]&&F[1]>=N[1]&&F[0]<=N[2]&&F[1]<=N[3]};Q.unrequestLayerData=function(F,N,P){F=this.layerInfo[N][F];N=F.waitingAgents;P=null!=r.removeUnordered(N,P);H(P,"agent has not requested this piece of map data");1>N.length&&(F.abortRequest(),this._updateMemoryUsed())};Q.dataArrived=function(F,N,P){F=this.layerInfo[N][F];F.data=P;F.dataInvalidated=!1;
for(P=0;P<F.waitingAgents.length;P++)F.waitingAgents[P].dataArrived(this);F.waitingAgents.length=0;this._updateMemoryUsed()};Q.dataMissing=function(F,N,P){P.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${N}/${F} error ${P}`);F=this.layerInfo[N][F];F.dataMissing=!0;for(N=0;N<F.waitingAgents.length;N++)F.waitingAgents[N].dataMissing();F.waitingAgents.length=0;this._updateMemoryUsed()};Q.updateRenderData=function(F){switch(F){case 1:return this.updateTexture();case 0:return this.updateGeometry()}};
Q.updateTexture=function(){this.renderData&&this.setPendingUpdate(64)};Q.updateGeometry=function(){this.setPendingUpdate(32);for(const F of this.layerInfo[0])F.pendingUpdates|=32};Q.invalidateLayerData=function(F,N){this.layerInfo[N][F].invalidateSourceData();this.restartAgents(N)};Q.computeElevationBounds=function(){n.set(this._elevationBounds,Number.MAX_VALUE,-Number.MAX_VALUE);const F=this.layerInfo[0];let N=!0;for(const P of F)P.elevationBounds&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],
P.elevationBounds.min),this._elevationBounds[1]=Math.max(this._elevationBounds[1],P.elevationBounds.max),P.elevationBounds.hasNoDataValues||(N=!1));N&&(this._elevationBounds[0]=Math.min(this._elevationBounds[0],0),this._elevationBounds[1]=Math.max(this._elevationBounds[1],0));this.updateRadiusAndCenter();this.surface.setTileTreeDirty()};Q._updateCenter=function(){c.scale(K,this.up,.5*(this._elevationBounds[0]+this._elevationBounds[1]));c.add(this._center[0],this.centerAtSeaLevel,K);c.scale(K,this.up,
this._elevationBounds[0]);c.add(this._center[1],this.centerAtSeaLevel,K);c.scale(K,this.up,this._elevationBounds[1]);c.add(this._center[2],this.centerAtSeaLevel,K)};Q.findElevationBoundsForLayer=function(F,N){const P=this.layerInfo[0][F];if(!P.elevationBounds||P.elevationBounds.level<N)if(N=this._surface.layerViewByIndex(F,0),N=x.getLayerWithExtentRange(N),z.fallsWithinLayer(this,N,!1)){N=T;let U=!1;if(P.data)F=P.data,N.min=F.bounds[0],N.max=F.bounds[1],N.hasNoDataValues=F.hasNoDataValues,N.level=
this.lij[0],U=!0;else{let V=0,W,X;for(let ca=this._parent;ca&&(!X||V<q.ELEVATION_DESIRED_RESOLUTION_LEVEL)&&!(V=this.vlevel-ca.level,W=X||W,X=ca.layerInfo[0][F].data,!X&&W&&V>=q.ELEVATION_DESIRED_RESOLUTION_LEVEL);ca=ca._parent);if(X=X||W)X.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],N),Infinity!==N.min&&(N.level=X.level,U=!0)}U&&(P.elevationBounds||(P.elevationBounds=new C.ElevationBounds),P.elevationBounds.copyFrom(N))}};Q.modifyLayers=function(F,N,P){const U=this.layerInfo[P];for(var V of U)V.loadingAgent&&
V.loadingAgent!==A.TILE_AGENT_DONE&&(G(V.loadingAgent),V.loadingAgent=null),V.waitingAgents.length=0;if(1===P)for(V=0;V<U.length;++V)void 0===F[V]&&U[V].dispose();F=N.length;V=Array(F);for(let W=0;W<F;W++){const X=N[W];V[W]=-1<X?U[X]:E.TilePerLayerInfo.makeEmptyLayerInfo(P,this._surface.upsampleInfoPool)}this.layerInfo[P]=V;this._updateMemoryUsed()};Q.restartAgents=function(F){this.renderData&&(this._createOrUpdateAgents(0,F),this.updateRenderData(F))};Q.updateAgents=function(F){if(this.renderData){const N=
this.layerInfo[F];for(let P=0;P<N.length;P++){const U=N[P];U.loadingAgent===A.TILE_AGENT_DONE&&(U.loadingAgent=null)}this._createOrUpdateAgents(0,F)}};Q.updateAgentSuspension=function(){for(let F=0;2>F;F++){const N=this.isSuspended(F);for(const P of this.layerInfo[F])P.loadingAgent&&P.loadingAgent!==A.TILE_AGENT_DONE&&(P.loadingAgent.setSuspension(N),P.loadingAgent===A.TILE_AGENT_DONE&&this.updateRenderData(F))}};Q.removeLayerAgent=function(F,N){F=this.layerInfo[N][F];F.loadingAgent&&F.loadingAgent!==
A.TILE_AGENT_DONE&&F.loadingAgent.dispose();F.loadingAgent=null};Q.agentDone=function(F,N){const P=this.layerInfo[N][F];P.loadingAgent=A.TILE_AGENT_DONE;P.data||P.upsampleInfo||this._createOrUpdateAgents(F+1,N)};Q._createOrUpdateAgents=function(F,N){const P=this.isSuspended(N),U=this.layerInfo[N];for(;F<U.length;++F){const ca=U[F];var V=!1;const R=this._surface.layerViewByIndex(F,N);var W=x.getLayerWithExtentRange(R);if(ca.loadingAgent)z.fallsWithinLayer(this,W,!1)?(ca.loadingAgent!==A.TILE_AGENT_DONE&&
ca.loadingAgent.setSuspension(P),ca.loadingAgent!==A.TILE_AGENT_DONE&&(V=ca.loadingAgent.update())):ca.dispose();else if(z.fallsWithinLayer(this,W,!1)){{V=F;W=N;var X=P;const aa=0===W?M.acquire():S.acquire();aa.init(this,V,W,X);V=aa}ca.loadingAgent=V;(V=ca.loadingAgent.startLoading())?ca.loadingAgent===A.TILE_AGENT_DONE&&this.setPendingUpdate(32):(G(ca.loadingAgent),ca.loadingAgent=A.TILE_AGENT_DONE)}ca.loadingAgent===A.TILE_AGENT_DONE&&this.updateRenderData(N);if(V&&R.isOpaque)break}};Q.isWithinExtent=
function(F){const N=this.extent;return N[0]>=F[0]&&F[2]>=N[2]&&N[1]>=F[1]&&F[3]>=N[3]};Q.intersectsExtent=function(F){const N=this.extent;return N[2]>=F[0]&&F[2]>=N[0]&&N[3]>=F[1]&&F[3]>=N[1]};k._createClass(O,[{key:"usedMemory",get:function(){-1===this._usedMemory&&this._updateMemoryUsed();return this._usedMemory+(this.isCached?0:this.mapTileMemory)}},{key:"cachedMemory",get:function(){return this.isCached?this.mapTileMemory:0}},{key:"mapTileMemory",get:function(){-1===this._usedMemory&&this._updateMemoryUsed();
let F=this._mapTileMemory;for(const {data:N}of this.layerInfo[1])N instanceof v.VectorTile&&(F+=N.getMemoryUsage());return F}},{key:"isCached",get:function(){return!this.shouldRender&&0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},{key:"numSubdivisionsAtLevel",get:function(){return this._numSubdivisionAtLevel}},{key:"isWithinClippingArea",get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",get:function(){return this._intersectsClippingArea}},
{key:"clippingArea",get:function(){return this._clippingArea}},{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},{key:"edgeLen",get:function(){return this._edgeLen}},{key:"radius",get:function(){return this._radius}},{key:"screenDepth",get:function(){return this._screenDepth}},
{key:"visible",get:function(){if(this._dirty){const F=this._isVisible();F!==this._visible&&(this._visible=F,this.updateAgentSuspension(),this.surface.emit("tiles-visibility-changed"),this.surface.renderer.setNeedsRender());this._dirty=!1}return this._visible}},{key:"rendered",get:function(){const F=!!this.renderData;F!==this._previouslyRendered&&(this.surface.emit("tiles-visibility-changed"),this._previouslyRendered=F,this.surface.renderer.setNeedsRender());return F}},{key:"shouldRender",get:function(){if(!this.visible)return!1;
if(1===this.surface.lodSnapping){const F=this.level-this._surface.snapLevel;if(0===F)return!0;if(1===F)return!1}return this.isLeaf}},{key:"cpuImageMemorySize",get:function(){const F=this._surface.tilingScheme.pixelSize;return F*F*4}},{key:"updating",get:function(){if(this.hasPendingUpdates)return!0;for(let F=0;2>F;F++){const N=this.layerInfo[F];for(const P of N)if(P.loadingAgent&&P.loadingAgent!==A.TILE_AGENT_DONE&&P.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==
this._pendingUpdates}},{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this.cachedMemory}}}]);return O}();const S=new a(D),M=new a(t),T=new C.ElevationBounds;b.SplitLimits=function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0};b.default=p;b.pruneAgents=function(){S.prune(0);M.prune(0)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ./TerrainConst ./terrainUtils ./tileUtils".split(" "),
function(b,k,a,r,l,h){const d=Error("Abstract method called on TileAgent");let c=function(){function f(){}var g=f.prototype;g.init=function(p,n,w,q){this.tile=p;this._layerIdx=n;this._layerClass=w;this._suspended=q;this._tileLayerInfo=p.getLayerInfo(n,w);this._tileRequested=null;p=this._findAncestorWithData();this._setUpsampleTile(p)};g.startLoading=function(){return this._requestNext()};g.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,
this),this._tileRequested=null);this._tileLayerInfo=this.tile=null};g.setSuspension=function(p){p!==this._suspended&&((this._suspended=p)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};g.update=function(){const p=this._findAncestorWithData();this._setUpsampleTile(p);return this._requestNext()};g.dataArrived=function(p){this._setUpsampleTile(p);this._tileRequested=null;p===this.tile?
this.tile.updateRenderData(this._layerClass):this._requestNext()};g.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};g._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};g._requestNext=function(){if(this._suspended)return!0;const p=this._findNextDownload();if(this._tileRequested){if(p===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=
null}p?p.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=p):this._agentDone();return!!this._tileRequested};g._findNextDownload=function(){const p=this._layerIdx,n=this._layerClass;var w=this.tile.surface.layerViewByIndex(p,n);const q=l.getLayerWithExtentRange(w),{minLevel:m,maxLevel:u}=w.dataLevelRange;w=this._desiredMinLevelDelta;const v=this._loadingLevelDelta+w,y=this._scaleRangeEnabled?h.fallsWithinLayer:()=>!0;let B,x=this.tile,C=0;var z=this._tileLayerInfo.upsampleInfo;
z=z?z.tile.level:-1;const A=a.get(q,"tilemapCache");for(;x&&y(x,q,!1)&&x.level>=m;){const t=x.level,D=x.layerInfo[n][p];if(D.data&&C>=w){t>z&&this._setUpsampleTile(x);D.dataInvalidated&&(B=x);break}if((a.isNone(A)||"unavailable"!==A.getAvailability(x.lij[0],x.lij[1],x.lij[2]))&&t<=u&&!D.data&&!D.dataMissing){if(!B||0===t%r.LOADING_LEVEL_MODULO||this.tile.level-B.level<w)B=x;if(C>=v)break}x=x.parent;C++}B&&this.tile.level-B.level<w&&this._tileLayerInfo.upsampleInfo&&(B=null);return B};g._findAncestorWithData=
function(){const p=this.tile.vlevel,n=this._desiredMinLevelDelta;let w;for(let q=this.tile;q;q=q.parent)if(q.hasLayerData(this._layerIdx,this._layerClass)){if(p-q.level>=n)return q;w=q}return w};g._setUpsampleTile=function(p){this._tileLayerInfo.setUpsampleInfo(this.tile,p);this.tile.updateRenderData(this._layerClass)};k._createClass(f,[{key:"updating",get:function(){return!!this._tileRequested}},{key:"test",get:function(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}]);
return f}();const e=new (function(f){function g(){return f.apply(this,arguments)||this}k._inheritsLoose(g,f);k._createClass(g,[{key:"_desiredMinLevelDelta",get:function(){throw d;}},{key:"_loadingLevelDelta",get:function(){throw d;}}]);return g}(c));b.TILE_AGENT_DONE=e;b.TileAgent=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(b,k,a){return function(r){function l(){var h=
r.apply(this,arguments)||this;h._scaleRangeEnabled=!1;return h}b._inheritsLoose(l,r);b._createClass(l,[{key:"_desiredMinLevelDelta",get:function(){return k.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])}},{key:"_loadingLevelDelta",get:function(){return 0}}]);return l}(a.TileAgent)})},"esri/views/3d/terrain/MapTileAgent":function(){define(["../../../chunks/_rollupPluginBabelHelpers","./TileAgent"],function(b,k){return function(a){function r(){var l=a.call(this)||this;l._scaleRangeEnabled=
!0;return l}b._inheritsLoose(r,a);b._createClass(r,[{key:"_desiredMinLevelDelta",get:function(){return 0}},{key:"_loadingLevelDelta",get:function(){return 8}}]);return r}(k.TileAgent)})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./terrainUtils","./tileUtils","./TileAgent"],function(b,k,a,r,l){let h=function(){function d(e,f){this._pool=f;this.waitingAgents=[];this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=
this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(e)}var c=d.prototype;c.init=function(e){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.requestAbort=this.requestPromise=this.loadingAgent=null;this.pendingUpdates=0;0===e&&(this.elevationBounds=null)};c.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};c.abortRequest=function(){this.requestPromise&&(this.requestAbort.abort(),
this.requestAbort=this.requestPromise=null)};c.dispose=function(){this.loadingAgent&&this.loadingAgent!==l.TILE_AGENT_DONE&&this.loadingAgent.dispose();this.loadingAgent=null;this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this.disposeData()};c.disposeData=function(){this.data=a.releaseTileData(this.data)};c._unsetUpsampleInfo=function(){this._upsampleInfo&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};c.setUpsampleInfo=
function(e,f){if(e===f||null==f)this._unsetUpsampleInfo();else{if(null==this._upsampleInfo)this._upsampleInfo=this._pool.acquire();else{if(this._upsampleInfo.tile===f)return;this._upsampleInfo.tile.unrefMapData()}f.refMapData();r.computeUpsampleInfo(e,f,this._upsampleInfo)}};d.makeEmptyLayerInfo=function(e,f,g){return g?(g.init(e),g):new d(e,f)};k._createClass(d,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}}]);return d}();b.TilePerLayerInfo=h;Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ../support/geometryUtils ./PatchGeometryFactory ./Tile".split(" "),function(b,k,a,r,l,h,d){d=function(c){function e(g,p,n){var w=c.call(this,e.NumSubdivisionsAtLevel)||this;void 0!==g&&w.init(g,p,n);return w}k._inheritsLoose(e,c);var f=e.prototype;f.init=function(g,p,n){c.prototype.init.call(this,g,p,n);this._edgeLen=
this.extent[2]-this.extent[0];this._edgeLen2=this._edgeLen*this._edgeLen;this.centerAtSeaLevel[0]=a.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=a.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};f.updateRadiusAndCenter=function(){this._updateCenter();const g=(this.extent[2]-this.extent[0])*Math.SQRT1_2,p=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this._radius=Math.sqrt(g*g+p*p)};f._isVisible=function(){return this.intersectsClippingArea&&
l.frustum.intersectsAABB(this.surface.frustum.planes,r.wrap(this.extent[0],this.extent[1],this.elevationBounds[0],this.extent[2],this.extent[3],this.elevationBounds[1]))};f.createGeometry=function(g,p){h.createPlanarGlobePatch(g,this.extent,p,this.renderData);this.setMemoryDirty()};return e}(d["default"]);d.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];b.PlanarPatch=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/maybe ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../chunks/vec4f64 ../../../chunks/vec4 ../../../geometry/support/aaBoundingBox ./TerrainConst ../support/buffer/InterleavedLayout ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ./ElevationData ../support/buffer/BufferPool".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){function q(I,J,K,L){const S=0<(K&2),M=J+(L?1024:0)+(S?2048:0);var T=C.get(M);if(!T){{T=J-1;const N=J-1,P=J*J;var O=2*T+2*N;let U=T*N*6,V=6*O,W=6*(2*T+N-1);L&&(U*=2,V*=2,W*=2);O=65536<P+O?new Uint32Array(U+V):new Uint16Array(U+V);let X=0,ca=0,R=U,aa,ka;let da=0;for(let fa=0;fa<=N;fa++){S&&(da=0===fa?W:fa===N?-W:0);R+=da;for(let ea=0;ea<=T;ea++){var Q=v(ea,fa,T,N);if(-1<Q){var F=0===fa&&ea!==T?1:ea===T&&fa!==N?T+1:fa===N&&0!==ea?-1:0===ea&&0!==fa?-(T+1):0;0!==F&&
(aa=X,ka=P+Q,Q=P+(0===ea&&1===fa?0:Q+1),F=X+F,L?(O[R+0]=aa,O[R+1]=ka,O[R+2]=ka,O[R+3]=Q,O[R+4]=Q,O[R+5]=aa,O[R+6]=Q,O[R+7]=F,O[R+8]=F,O[R+9]=aa,O[R+10]=aa,O[R+11]=Q,R+=12):(O[R+0]=aa,O[R+1]=ka,O[R+2]=Q,O[R+3]=Q,O[R+4]=F,O[R+5]=aa,R+=6))}++X;ea<T&&fa<N&&(aa=fa*(T+1)+ea,ka=aa+1,Q=ka+(T+1),F=Q-1,L?(O[ca+0]=aa,O[ca+1]=ka,O[ca+2]=ka,O[ca+3]=Q,O[ca+4]=Q,O[ca+5]=aa,O[ca+6]=Q,O[ca+7]=F,O[ca+8]=F,O[ca+9]=aa,O[ca+10]=aa,O[ca+11]=Q,ca+=12):(O[ca+0]=aa,O[ca+1]=ka,O[ca+2]=Q,O[ca+3]=Q,O[ca+4]=F,O[ca+5]=aa,ca+=
6))}R-=da}T=new x(O,U,V)}C.set(M,T)}I.indices=T.values;I.numSurfaceIndices=T.numSurfaceIndices;I.numSkirtIndices=T.numSkirtIndices;I.numWithoutSkirtIndices=I.numSurfaceIndices+(K?6*(J-1)*(L?2:1):0)}function m(I,J,K,L){I<L[0]&&(L[0]=I);I>L[3]&&(L[3]=I);J<L[1]&&(L[1]=J);J>L[4]&&(L[4]=J);K<L[2]&&(L[2]=K);K>L[5]&&(L[5]=K)}function u(I,J){const K=J>I?1:0;return 2+4*K+(1-2*K)*(I+J)}function v(I,J,K,L){return 0===J?I:I===K?K+J:J===L?K+L+(K-I):0===I&&0<J?2*K+L+(L-J):-1}const y=f.newLayout().vec3f(g.VertexAttrConstants.POSITION).vec2f(g.VertexAttrConstants.UV0),
B=new w.BufferPool(I=>y.createBuffer(I),I=>I.count);let x=function(I,J,K){this.values=I;this.numSurfaceIndices=J;this.numSkirtIndices=K};const C=new Map,z=2**-52,A=Array(e.MAX_PATCH_TESSELATION+1),t=Array(e.MAX_PATCH_TESSELATION+1),D=Array(e.MAX_PATCH_TESSELATION+1),E=Array(e.MAX_PATCH_TESSELATION+1),G=r.create(),H=r.create();b.PatchGeometry=function(){this.vertexAttributes=this.indices=null;this.boundingBox=c.empty();this.skirtLength=this.numVertsPerRow=this.numWithoutSkirtIndices=this.numSkirtIndices=
this.numSurfaceIndices=0;this.uvOffsetAndScale=h.create()};b.clearCaches=function(){B.clear();C.clear()};b.createPlanarGlobePatch=function(I,J,K,L){const S=J[0],M=J[1],T=J[2]-S,O=J[3]-M,Q=I.clippingArea,F=Q?Math.max(0,(Q[0]-J[0])/T):0,N=Q?Math.max(0,(Q[1]-J[1])/O):0,P=Q?Math.min(1,(Q[2]-J[0])/T):1;J=Q?Math.min(1,(Q[3]-J[1])/O):1;const U=P>F?1/(P-F):1,V=J>N?1/(J-N):1,W=-F*U,X=-N*V,ca=.1*T,R=I.numVertsPerRow-1,aa=I.numVertsPerRow-1,ka=I.numVertsPerRow*I.numVertsPerRow,da=B.acquire(ka+(2*R+2*aa)),fa=
da.position.typedBuffer,ea=da.uv0.typedBuffer,Y=L.geometryInfo.boundingBox;c.empty(Y);let Z=0;for(let qa=0;qa<=aa;qa++){var ba=qa/aa;let na=X+ba*V;ba=M+ba*O;Q&&(ba<Q[1]?(ba=Q[1],na=0):ba>Q[3]&&(ba=Q[3],na=1));for(let oa=0;oa<=R;oa++){var ia=oa/R;let ua=W+ia*U;ia=S+ia*T;Q&&(ia<Q[0]?(ia=Q[0],ua=0):ia>Q[2]&&(ia=Q[2],ua=1));var ja=I.samplerData?n.ElevationData.sample(ia,ba,I.samplerData)||0:0;ia-=K[0];const za=ba-K[1];ja-=K[2];m(ia,za,ja,Y);var la=e.GEOMETRY_VERTEX_STRIDE*Z;fa[la+0]=ia;fa[la+1]=za;fa[la+
2]=ja;ea[la+0]=ua;ea[la+1]=na;la=v(oa,qa,R,R);-1<la&&(la=e.GEOMETRY_VERTEX_STRIDE*(ka+la),fa[la+0]=ia,fa[la+1]=za,fa[la+2]=ja,ea[la+0]=u(ua,na),ea[la+1]=ca);++Z}}L.geometryInfo.numVertsPerRow=I.numVertsPerRow;L.geometryInfo.vertexAttributes=da;L.geometryInfo.skirtLength=ca;d.set(L.geometryInfo.uvOffsetAndScale,F,N,P-F,J-N);q(L.geometryInfo,I.numVertsPerRow,0,I.wireframe)};b.createSphericalGlobePatch=function(I,J,K,L,S,M,T,O){var Q=S[0];const F=S[1];var N=S[2];S=S[3];const P=.1*T.radius*(S-F),U=I.numVertsPerRow-
1,V=I.numVertsPerRow-1,W=I.numVertsPerRow*I.numVertsPerRow,X=B.acquire(W+(2*U+2*V)),ca=X.position.typedBuffer,R=X.uv0.typedBuffer,aa=L.geometryInfo.boundingBox;c.empty(aa);var ka=J[2]-J[0];const da=J[3]-J[1];var fa=N-Q;N=K[0];const ea=K[1];K=K[2];for(var Y=0;Y<=U;Y++){var Z=Y/U,ba=Q+Z*fa;A[Y]=Math.sin(ba);t[Y]=Math.cos(ba);D[Y]=Z;E[Y]=J[0]+Z*ka}Q=M&&!!(O&1);ka=M&&!!(O&2);fa=0;for(Y=0;Y<=V;Y++){Z=Y/V;var ia=a.lerp(F,S,Z);ba=Math.cos(ia);const oa=Math.sin(ia);M?(ia=T.halfSemiMajorAxis*Math.log((1+oa)/
(1-oa)),Z=(ia-J[1])/da):ia=180*ia/Math.PI;for(let ua=0;ua<=U;ua++){const za=D[ua];var ja=A[ua],la=t[ua],qa=T.radius;I.samplerData&&(qa+=n.ElevationData.sample(E[ua],ia,I.samplerData)||0);la=la*ba*qa-N;ja=ja*ba*qa-ea;qa=oa*qa-K;m(la,ja,qa,aa);var na=e.GEOMETRY_VERTEX_STRIDE*fa;ca[na+0]=la;ca[na+1]=ja;ca[na+2]=qa;R[na+0]=za;R[na+1]=Z;na=v(ua,Y,U,V);if(-1<na){na=e.GEOMETRY_VERTEX_STRIDE*(W+na);const Fa=Q&&0===Y?-1:ka&&Y===V?1:0;la=0===Fa?la:-N;ja=0===Fa?ja:-ea;qa=0===Fa?qa:T.radius*Fa-K;ca[na+0]=la;
ca[na+1]=ja;ca[na+2]=qa;R[na+0]=0===Fa?u(za,Z):za;R[na+1]=0===Fa?P:Z;0!==Fa&&m(la,ja,qa,aa)}++fa}}L.geometryInfo.numVertsPerRow=I.numVertsPerRow;L.geometryInfo.vertexAttributes=X;L.geometryInfo.skirtLength=P;d.set(L.geometryInfo.uvOffsetAndScale,0,0,1,1);q(L.geometryInfo,I.numVertsPerRow,M?O:0,I.wireframe)};b.intersectSkirts=function(I,J,K,L,S,M,T,O,Q){const F=M.position;M=M.uv0;const N=I[0],P=I[1];I=I[2];const U=J[0]-N,V=J[1]-P;J=J[2]-I;K*=3;for(L*=3;K<L;K+=3){var W=S[K],X=S[K+1],ca=S[K+2],R=F.get(W,
0),aa=F.get(W,1),ka=F.get(W,2),da=F.get(X,0),fa=F.get(X,1),ea=F.get(X,2),Y=F.get(ca,0),Z=F.get(ca,1),ba=F.get(ca,2);W=M.get(W,0);X=M.get(X,0);ca=M.get(ca,0);2<=W&&(l.set(G,R,aa,ka),T(G),R+=G[0],aa+=G[1],ka+=G[2]);2<=X&&(l.set(G,da,fa,ea),T(G),da+=G[0],fa+=G[1],ea+=G[2]);2<=ca&&(l.set(G,Y,Z,ba),T(G),Y+=G[0],Z+=G[1],ba+=G[2]);k.isSome(O)&&([R,aa,ka]=O.applyToVertex(R,aa,ka),[da,fa,ea]=O.applyToVertex(da,fa,ea),[Y,Z,ba]=O.applyToVertex(Y,Z,ba));da-=R;fa-=aa;ea-=ka;Y-=R;Z-=aa;ba-=ka;W=V*ba-Z*J;X=J*Y-
ba*U;const ia=U*Z-Y*V;ca=da*W+fa*X+ea*ia;const ja=N-R,la=P-aa,qa=I-ka;ka=la*ea-fa*qa;aa=qa*da-ea*ja;R=ja*fa-da*la;if(ca>z){W=ja*W+la*X+qa*ia;if(0>W||W>ca)continue;X=U*ka+V*aa+J*R;if(0>X||W+X>ca)continue}else if(ca<-z){W=ja*W+la*X+qa*ia;if(0<W||W<ca)continue;X=U*ka+V*aa+J*R;if(0<X||W+X<ca)continue}else continue;ka=(Y*ka+Z*aa+ba*R)/ca;0<=ka&&(da=p.computeNormal(da,fa,ea,Y,Z,ba,H),Q(ka,da))}};b.releaseGeometry=function(I){B.release(I.vertexAttributes);I.vertexAttributes=null;I.indices=null};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/support/buffer/BufferPool":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray"],function(b,k,a){let r=function(){function l(d,c){this._factoryCallback=d;this._lengthCallback=c;this._pool=new Map}var h=l.prototype;h.acquire=function(d){if(!l.test.disabled){var c=this._pool.get(d);if(c&&0!==c.length)return c.pop()}try{return this._factoryCallback(d)}catch(e){c=window.performance&&window.performance.memory;
let f="";c&&(f=`\n  totalJSHeapSize: ${c.totalJSHeapSize}, usedJSHeapSize: ${c.usedJSHeapSize}, jsHeapSizeLimit: ${c.jsHeapSizeLimit}`);console.log("Array allocation of size "+d+" failed: "+e+f);throw e;}};h.release=function(d){if(!l.test.disabled){var c=this._lengthCallback(d),e=this._pool.get(c);e||(e=new a({shrink:!0}),this._pool.set(c,e));e.push(d)}};h.clear=function(){this._pool.clear()};k._createClass(l,[{key:"test",get:function(){return{size:this._pool.size}}}]);return l}();r.test={disabled:!1};
b.BufferPool=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../geometry/projection ../../../chunks/plane ../support/geometryUtils ./PatchGeometryFactory ./Tile".split(" "),function(b,k,a,r,l,h,d,c,e,f,g){g=function(w){function q(u,v,y){var B=w.call(this,p)||this;B.obb=Array(8);
B.isWebMercator=!1;for(let x=0;8>x;x++)B.obb[x]=r.create();void 0!==u&&B.init(u,v,y);return B}k._inheritsLoose(q,w);var m=q.prototype;m.init=function(u,v,y){w.prototype.init.call(this,u,v,y);this.isWebMercator=y.tilingScheme.spatialReference.isWebMercator;v=this.ellipsoid.radius;y=this.extentInRadians[0];const B=this.extentInRadians[1],x=this.extentInRadians[2],C=this.extentInRadians[3];u=u[0];const z=a.lerp(B,C,.5),A=a.lerp(y,x,.5);this._edgeLen=(x-y)*Math.cos(0===u?0:Math.min(Math.abs(B),Math.abs(C)))*
v;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=v-Math.sqrt(v*v-this._edgeLen2/4);d.lonLatToSphericalPCPF(this.centerAtSeaLevel,A,z,this.ellipsoid.radius,0);v=r.fromArray(this.centerAtSeaLevel);l.normalize(v,v);this.up=v;this._updateOBB();this.updateRadiusAndCenter()};m.updateRadiusAndCenter=function(){if(0===this.lij[0])l.set(this._center[0],0,0,0),l.set(this._center[1],0,0,0),l.set(this._center[2],0,0,0),this.ellipsoid||(this.ellipsoid=h.getReferenceEllipsoid(this.surface.tilingScheme.spatialReference)),
this._radius=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const u=Math.max(l.squaredDistance(this._center[0],this.obb[0]),l.squaredDistance(this._center[0],this.obb[1]));this._radius=Math.sqrt(u)}};m._isVisible=function(){if(!this.intersectsClippingArea)return!1;const u=this.surface.frustum.planes;if(10>this.lij[0])return e.frustum.intersectsSphere(u,e.sphere.wrap(this._radius,this._center[0]));const v=this.obb;for(let y=0;6>y;y++){let B=u[y];4===y&&(B=c.copy(B,n),n[3]-=
this.surface.view.state.camera.near);let x;for(x=0;8>x&&!c.isPointOutside(B,v[x]);x++);if(8===x)return!1}return!0};m.computeElevationBounds=function(){w.prototype.computeElevationBounds.call(this);this._updateOBB()};m.createGeometry=function(u,v){const y=this._isPole(this.lij[1],this.lij[0]);f.createSphericalGlobePatch(u,this.extent,v,this.renderData,this.extentInRadians,this.isWebMercator,this.ellipsoid,y);this.setMemoryDirty()};m._updateOBB=function(){var u=this.extentInRadians;const v=this.obb;
for(let y=0;2>y;y++){const B=this.elevationBounds[y];let x=4*y;d.lonLatToSphericalPCPF(v[x++],u[0],u[1],this.ellipsoid.radius,B);d.lonLatToSphericalPCPF(v[x++],u[0],u[3],this.ellipsoid.radius,B);d.lonLatToSphericalPCPF(v[x++],u[2],u[3],this.ellipsoid.radius,B);d.lonLatToSphericalPCPF(v[x++],u[2],u[1],this.ellipsoid.radius,B)}this.isWebMercator&&(u=this._isPole(this.lij[1],this.lij[0]),2===u?(l.set(v[1],0,0,this.ellipsoid.radius),l.set(v[2],0,0,this.ellipsoid.radius),l.set(v[5],0,0,this.ellipsoid.radius),
l.set(v[6],0,0,this.ellipsoid.radius)):1===u&&(l.set(v[0],0,0,-this.ellipsoid.radius),l.set(v[3],0,0,-this.ellipsoid.radius),l.set(v[4],0,0,-this.ellipsoid.radius),l.set(v[7],0,0,-this.ellipsoid.radius)))};m._isPole=function(u,v){let y=0;u===(1<<v)-1&&(y+=1);0===u&&(y+=2);return y};return q}(g["default"]);const p=[128,64,32,16,16,8,8,4],n=c.create();b.SphericalPatch=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../geometry/support/webMercatorUtils ../../../core/Handles ../../../core/watchUtils ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ./TerrainConst ./terrainUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){function x(C,z){C&&!C.spatialReference.equals(z)&&(C=w.canProject(C.spatialReference,z)?w.project(C,z):null);return C}r=function(C){function z(t){t=C.call(this,t)||this;t._handles=new q;return t}k._inheritsLoose(z,C);var A=z.prototype;A.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};A.destroy=function(){this._handles.destroy();this._handles=null};A._computeStencilEnabledExtents=
function(t,D){const E=[];for(const G of t.items)t=G.layer,"IntegratedMeshLayer"===t.operationalLayerType&&null!=D&&(t=x(t.fullExtent,D),null!=t&&E.push(u.fromExtent(t)));return E};k._createClass(z,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)}},{key:"spatialReference",
set:function(t){this.tilingScheme||this._set("spatialReference",t)}},{key:"tilingScheme",set:function(t){this._set("tilingScheme",t);this._set("spatialReference",t.spatialReference)}}]);return z}(n);a.__decorate([d.property({readOnly:!0,dependsOn:[],autoTracked:!1})],r.prototype,"layerViewsExtent",null);a.__decorate([d.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"],autoTracked:!1})],r.prototype,"tiledLayersExtent",null);a.__decorate([d.property({readOnly:!0,dependsOn:["spatialReference"],
autoTracked:!1})],r.prototype,"stencilEnabledExtents",null);a.__decorate([d.property()],r.prototype,"spatialReference",null);a.__decorate([d.property()],r.prototype,"tilingScheme",null);a.__decorate([d.property()],r.prototype,"defaultTiledLayersExtent",void 0);a.__decorate([d.property({constructOnly:!0})],r.prototype,"layers",void 0);a.__decorate([d.property({constructOnly:!0})],r.prototype,"layerViews",void 0);r=a.__decorate([e.subclass("esri.views.3d.terrain.SurfaceExtentHelperBase")],r);b.SurfaceExtentHelperGlobal=
function(C){function z(){return C.apply(this,arguments)||this}k._inheritsLoose(z,C);var A=z.prototype;A._computeLayerViewsExtent=function(){return this._getGlobalExtent()};A._computeTiledLayersExtent=function(){return this._getGlobalExtent()};A._getGlobalExtent=function(){return this.spatialReference.isWebMercator?y.WEBMERCATOR_WORLD_EXTENT:y.GEOGRAPHIC_WORLD_EXTENT};return z}(r);a.__decorate([d.property({dependsOn:["spatialReference"]})],b.SurfaceExtentHelperGlobal.prototype,"layerViewsExtent",void 0);
b.SurfaceExtentHelperGlobal=a.__decorate([e.subclass("esri.views.3d.terrain.SurfaceExtentHelperGlobal")],b.SurfaceExtentHelperGlobal);b.SurfaceExtentHelperLocal=function(C){function z(){return C.apply(this,arguments)||this}k._inheritsLoose(z,C);var A=z.prototype;A.initialize=function(){this._handles.add([this.layers.on("change",t=>this._handleLayersChanged(t)),this.layerViews.on("change",()=>this.notifyChange("layerViewsExtent"))])};A._handleLayersChanged=function(t){for(const D of t.removed)this._handles.remove(D.uid);
for(const D of t.added)this._handles.add(m.init(D,"loaded",()=>this.notifyChange("tiledLayersExtent")),D.uid)};A._computeLayerViewsExtent=function(){const t=u.empty(),D=this.spatialReference;this.layerViews.forEach(H=>{H.isResolved()&&(H=x("fullExtentInLocalViewSpatialReference"in H&&H.fullExtentInLocalViewSpatialReference||H.layer.fullExtent,D))&&u.expand(t,H)});const E=u.allFinite(t)?t:null,G=this._get("layerViewsExtent");return u.equals(E,G)?G:E};A._computeTiledLayersExtent=function(){const t=
this.tilingScheme;if(!t)return null;const D=this.spatialReference,E=u.empty();this.layers.forEach(function(I){if(I.loaded&&v.isTiledLayer(I)){const {tileInfo:J,fullExtent:K}=B.getTiledLayerInfo(I,D,2);J&&B.isProjectableRasterLayer(I)&&K?u.expand(E,K):J&&t.compatibleWith(J)&&K&&K.spatialReference.equals(D)&&u.expand(E,K)}});this.defaultTiledLayersExtent&&u.expand(E,this.defaultTiledLayersExtent);const G=u.allFinite(E)?E:null,H=this._get("tiledLayersExtent");return u.equals(G,H)?H:G};return z}(r);b.SurfaceExtentHelperLocal=
a.__decorate([e.subclass("esri.views.3d.terrain.SurfaceExtentHelperLocal")],b.SurfaceExtentHelperLocal);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../geometry/support/spatialReferenceUtils ../../../core/Handles ../../../geometry/projection ../../../layers/support/layerUtils ./TilingScheme ./terrainUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){a=function(y){function B(C){C=y.call(this,C)||this;C._changeHandles=new w;return C}b._inheritsLoose(B,y);var x=B.prototype;x.initialize=function(){this._changeHandles.add(this.layers.on("change",()=>this._update()));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};x.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};x._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var C;this.layers.some(A=>!m.isTiledLayer(A)||A.isRejected()?!1:!A.isFulfilled()||v.getTiledLayerInfo(A,this.viewSpatialReference,this.manifold).tileInfo?(C=A,"vector-tile"!==A.type&&!v.isProjectableRasterLayer(A)):!1);if(C)if(C.isResolved()){var {tileInfo:z}=v.getTiledLayerInfo(C,this.viewSpatialReference,this.manifold);z=new u(z);this._set("tilingSchemeDone",!0);this._lockTilingScheme(z)}else this._updateWhen(C);
else this._set("tilingSchemeDone",!0)}};x._updateWhen=function(C){const z=C.when().catch(A=>A).then(()=>{z===this._waitTask&&this._update()});this._waitTask=z};x._lockTilingScheme=function(C){if("spherical"===this.manifold){const z=C.levels.length-1;C.spatialReference.isWebMercator?C=u.makeWebMercatorAuxiliarySphere(z):q.canProjectToWGS84ComparableLonLat(C.spatialReference)&&(C=u.makeGCSWithTileSize(C.spatialReference,C.pixelSize,z))}this.tilingSchemeLocked=!0;this.tilingScheme=C;this.extentHelper.tilingScheme=
this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",()=>this._updateTiledLayerExtent()))};x._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};x._setAdHocTilingScheme=function(){if("spherical"===this.manifold){var C=this.extentHelper.spatialReference;const z=q.canProjectToWGS84ComparableLonLat(C)||n.isMars(C)||n.isMoon(C);C.isWebMercator?this.tilingScheme=u.WebMercatorAuxiliarySphere:
z&&(this.tilingScheme=u.makeGCSWithTileSize(C,256));this.extent=this.extentHelper.layerViewsExtent}else if(C=this.extentHelper.layerViewsExtent)this.tilingScheme=u.fromExtent(C,this.extentHelper.spatialReference),this.extent=C};return B}(p);k.__decorate([h.property()],a.prototype,"tilingScheme",void 0);k.__decorate([h.property()],a.prototype,"extent",void 0);k.__decorate([h.property({value:!1})],a.prototype,"tilingSchemeLocked",void 0);k.__decorate([h.property({readOnly:!0,value:!1})],a.prototype,
"tilingSchemeDone",void 0);k.__decorate([h.property({constructOnly:!0})],a.prototype,"viewSpatialReference",void 0);k.__decorate([h.property({constructOnly:!0})],a.prototype,"layers",void 0);k.__decorate([h.property({constructOnly:!0})],a.prototype,"extentHelper",void 0);k.__decorate([h.property({constructOnly:!0})],a.prototype,"manifold",void 0);return a=k.__decorate([c.subclass("esri.views.3d.terrain.SurfaceTilingSchemeLogic")],a)})},"esri/views/3d/terrain/TerrainRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/ObjectPool ../../../core/PooledArray ../../../core/Accessor ../../../Color ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec4f64 ../../../chunks/vec4 ../support/buffer/BufferView ../../../geometry/support/aaBoundingBox ../../../support/requestImageUtils ../webgl-engine/core/shaderLibrary/util/View.glsl ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/intersectorUtils ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/core/shaderLibrary/Slice.glsl ../webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl ./OverlayRenderer ./PatchGeometryFactory ./tileUtils ./PatchRenderData ./TileRenderer ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/statistics/tracer".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q,F){function N(da,fa,ea){C.set(ea,da[0]*fa[2]+fa[0],da[1]*fa[3]+fa[1],da[2]*fa[2],da[3]*fa[3])}const P=A.create(),U=x.create();let V=function(){this.extent=x.create();this.maxLevel=this.minLevel=0;this.callback=null};a=function(da){function fa(Y){Y=da.call(this,Y)||this;Y.type="Terrain";Y.isGround=!0;Y.tileSize=256;Y.rctx=null;Y._isTransparent=!1;Y.renderDataPool=new n(T.PatchRenderData);Y.patchGroups=new w({allocator:Z=>
Z||{root:null,origin:null,patches:new w},deallocator:Z=>{Z.root=null;Z.origin=null;Z.patches.clear();return Z}});Y.patchGroupsDirty=!0;Y.patchGroupsMap=new Map;Y.tileIterator=new M.IteratorPreorder;Y.highestVisibleLODTile=null;Y.visible=!0;Y._opaque=!0;Y._skirtScale=1;Y._velvetOverground=!0;Y.castShadows=!0;Y._ssrEnabled=!1;Y.emptyTex=null;Y.tileRenderer=null;Y.tileBackgroundInitialized=!1;Y.tileBackgroundUpdating=!1;Y.stencilEnabledLayerExtents=[];Y.numTrianglesRendered=0;Y.numTilesRendered=0;Y.numTilesCulled=
0;Y.numOriginsRendered=0;Y.clippingExtent=null;Y.overlayOpacity=1;Y.needsHighlight=!1;Y.renderOccludedFlags=1;Y.visibleScaleRangeQueries=new w({initialSize:10});Y.visibleScaleRangeQueriesInvPtr=0;Y.visibleScaleRangeQueryQueue=new w({initialSize:30});Y.visibleScaleRangeQueryPool=new n(V);return Y}b._inheritsLoose(fa,da);var ea=fa.prototype;ea.destroy=function(){S.clearCaches()};ea.install=function(Y){Y.addRenderPlugin([2,7,9],this)};ea.uninstall=function(Y){Y.removeRenderPlugin(this)};ea.setDebugScreenSizePerspective=
function(Y){this.shaderTechniqueConfig.screenSizePerspective!==Y&&(this.shaderTechniqueConfig.screenSizePerspective=Y,this.setNeedsRender())};ea.setRootTiles=function(Y){this.rootTiles=Y;this.setNeedsRender()};ea.setNeedsHighlight=function(Y){this.needsHighlight=Y;this.setNeedsRender()};ea.setRenderOccludedOverlay=function(Y){this.renderOccludedFlags=Y?L.overlayRenderOccludedFlag:1;this.setNeedsRender()};ea.setStencilEnabledLayerExtents=function(Y){this.stencilEnabledLayerExtents=Y;this.setNeedsRender()};
ea.setTileSize=function(Y){this.tileSize=Y;this.tileRenderer&&(this.tileRenderer.tileSize=Y);this.setNeedsRender()};ea.loadTile=function(Y){Y.renderData||(Y.renderData=this.renderDataPool.acquire(),Y.renderData.init(Y),Y.renderData.localOrigin=this._getLocalOriginOfTile(Y));this.updateTileGeometry(Y);this.updateTileTexture(Y)};ea.queryVisibleLevelRange=function(Y,Z,ba,ia){const ja=this.visibleScaleRangeQueryPool.acquire();C.copy(ja.extent,Y);ja.minLevel=Z?Z:-Number.MAX_VALUE;ja.maxLevel=null!=ba?
ba:Number.MAX_VALUE;ja.callback=ia;this.visibleScaleRangeQueryQueue.push(ja);this.setNeedsRender()};ea.updateTileTexture=function(Y){this.tileRenderer&&this.tileBackgroundInitialized&&(this.tileRenderer.updateTileTexture(Y),this.setNeedsRender(),Y.resetPendingUpdate(64))};ea.updateTileGeometry=function(Y){for(const Z of Y.layerInfo[0])Z.pendingUpdates&=-33;Y.resetPendingUpdate(32);Y.renderData.updateGeometry(this.rctx,this.wireframe)&&this.setNeedsRender()};ea.unloadTile=function(Y){Y.renderData&&
(this.releaseTileGeometry(Y.renderData),Y.renderData.clear(),Y.renderData=null,Y.setMemoryDirty(),this.setNeedsRender())};ea._getLocalOriginOfTile=function(Y){const Z=Math.max(0,7*Math.floor((Y.lij[0]-3)/7));if("spherical"===this.manifold&&0===Z)return u.ZEROS;for(;Y.parent&&Y.lij[0]>Z;)Y=Y.parent;return Y.centerAtSeaLevel};ea.setVisibility=function(Y){this.visible=Y;this.setNeedsRender()};ea.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,
numOriginsRendered:this.numOriginsRendered}};ea.setNeedsRender=function(Y=1){this.patchGroupsDirty=!0;this.initContext.requestRender(Y)};ea.setTileBackground=function(Y){this.tileBackground=Y;this._updateTileBackground()};ea.initializeRenderContext=function(Y){this.initContext=Y;this.rctx=Y.rctx;this.shaderTechniques=Y.shaderTechniqueRep;this.shaderTechniqueConfig=new Q.TerrainTechniqueConfiguration;this.tileRenderer=new O(this.rctx,this.tileSize,this.shaderTechniques);this.tileBackground&&this._updateTileBackground();
this.emptyTex=E.createEmptyTexture(this.rctx)};ea.uninitializeRenderContext=function(){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};ea.intersect=function(Y,Z,ba,ia){if(this.rootTiles&&(!Y.options.selectOpaqueTerrainOnly||!Y.options.selectionMode||this._opaque)){var ja=ca,la=R;v.subtract(ja,ia,ba);v.set(la,1/ja[0],1/ja[1],1/ja[2]);var qa=Y.results.min,na=Y.results.max,oa=Y.results.ground,ua=0===Y.options.store,
za=!!Y.results.ground.target,Fa=null,La=this.clippingExtent,Sa=this.tileIterator;Sa.reset(this.rootTiles);for(var Ia=G.getVerticalOffsetTerrain(Y.verticalOffset);!Sa.done;){const Ga=Sa.next();if(null===Ga.renderData||za&&this._useStencilForTile(Ga))continue;if(Y.options.invisibleTerrain){if(!Ga.visible&&La&&!Ga.intersectsExtent(La))continue}else if(!Ga.visible)continue;var Qa=Ga.renderData.geometryInfo,Pa=Ga.renderData.localOrigin;const Ra=-this._skirtScale*Qa.skirtLength;A.set(P,Qa.boundingBox);
r.isSome(Ia)&&(Ia.localOrigin=Pa,Ia.applyToAabb(P));if(0!==Ra){var sa=Ga.up;A.expandWithOffset(P,Ra*sa[0],Ra*sa[1],Ra*sa[2])}sa=P;v.subtract(aa,ba,Pa);if(!I.intersectAabbInvDirBefore(sa,aa,la,Y.tolerance,ua&&null!=qa.dist?qa.dist:Infinity))continue;const Ua=(db,mb,Ea,ya)=>{db.set(void 0,M.tile2str(mb),Ea,ya,B.IDENTITY,void 0);db.intersector="TerrainRenderer";db.target={type:"external",metadata:{tile:mb}}};sa=(db,mb)=>{0<=db&&(Y.options.backfacesTerrain||0>v.dot(mb,ja))&&(Y.options.invisibleTerrain||
!Y.options.selectionMode||null==Z||Z(ba,ia,db))&&((null==oa.dist||db<oa.dist)&&Ua(oa,Ga,db,mb),Y.options.isFiltered||(2===Y.options.store&&(r.isNone(Fa)?(Fa=new G.IntersectorResult(Y.ray),Ua(Fa,Ga,db,mb),Y.results.all.push(Fa)):db<Fa.dist&&Ua(Fa,Ga,db,mb)),(null==qa.dist||db<qa.dist)&&Ua(qa,Ga,db,mb),0!==Y.options.store&&(null==na.dist||db>na.dist)&&Ua(na,Ga,db,mb)))};const ha=ka;v.subtract(ha,ia,Pa);Pa=Qa.indices;const Ya=Qa.vertexAttributes,Wa={data:Ya.getField("position",z.BufferViewVec3f).typedBuffer,
size:3,offsetIdx:0,strideIdx:Ya.stride/4};Qa=Qa.numWithoutSkirtIndices/3;I.intersectTriangles(aa,ha,0,Qa,Pa,Wa,null,Ia,sa);0!==Ra&&S.intersectSkirts(aa,ha,Qa,Pa.length/3,Pa,Ya,"spherical"===this.manifold?db=>v.scale(db,db,Ra/v.length(db)):db=>v.set(db,0,0,Ra),Ia,sa)}}};ea.render=function(Y){if(9===Y.slot){if(0===(Y.renderOccludedMask&L.overlayRenderOccludedFlag))return!1}else if(Y.slot!==(this.opaque?2:7))return!1;F.trace("# BEGIN RENDER TERRAIN");var Z=Y.pass;const ba=1===Y.scenelightingData.globalFactor,
ia=this._updatePatchGroups();switch(Z){case 0:Z=Y.shadowMap&&Y.shadowMap.enabled;this.shaderTechniqueConfig.receiveShadows!==Z&&(this.shaderTechniqueConfig.receiveShadows=Z);Z=this.overlayRenderer.isEmpty()?0:this.overlayRenderer.hasWater?2:1;this.shaderTechniqueConfig.overlayMode!==Z&&(this.shaderTechniqueConfig.overlayMode=Z);this._renderMaterialPass(Y,0,ia,9===Y.slot?3:1);break;case 4:this.castShadows&&ba&&this._renderAuxiliaryPass(Y,3,ia,0);break;case 2:this.isTransparent&&this.overlayRenderer.isEmpty()||
this._renderAuxiliaryPass(Y,1,ia,0);break;case 3:this._renderAuxiliaryPass(Y,2,ia,0);break;case 5:this.needsHighlight&&(this._renderAuxiliaryPass(Y,4,ia,2),Y.rctx.clearSafe(256))}F.trace("# END RENDER TERRAIN");0!==this.visibleScaleRangeQueryQueue.length&&this.setNeedsRender();return!0};ea._renderMaterialPass=function(Y,Z,ba,ia){const ja=Y.rctx,la=Y.camera;this._ssrEnabled=Y.ssrParams.ssrEnabled;this._setTerrainTechnique(Z,3===ia);const qa=this.shaderTechnique.program;Y.rctx.bindProgram(qa);ja.bindProgram(qa);
1===ia&&Y.ssrParams&&(Y.ssrParams.lastFrameColorTextureID=9,Y.ssrParams.linearDepthTextureID=8,K.ScreenSpaceReflections.bindUniforms(qa,ja,Y.ssrParams));Y.shadowMap&&Y.shadowMap.bind(qa,7);Y.ssaoHelper&&Y.ssaoHelper.setUniforms(qa,6);qa.setUniform1i("tex",0);qa.setUniform1i("texNext",1);this._bindOverlayData(qa,ia);qa.setUniformMatrix4fv("viewNormal",la.viewInverseTransposeMatrix);D.View.bindProjectionMatrix(qa,la.projectionMatrix);Y.scenelightingData.setUniforms(qa,!0);Z=la.viewMatrix;v.set(X,Z[12],
Z[13],Z[14]);v.normalize(X,X);qa.setUniform3fv("viewDirection",X);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();this.opaque?this._renderPatchGroups(Y,qa,ba,ia):Y.offscreenRenderingHelper.renderToTargets(()=>this._renderPatchGroups(Y,qa,ba,ia),Y.offscreenRenderingHelper.tmpColor,Y.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries()};ea._renderAuxiliaryPass=function(Y,Z,ba,ia){this._setTerrainTechnique(Z,
3===ia);Z=this.shaderTechnique.program;Y.rctx.bindProgram(Z);if(5===Y.pass){const ja=Y.offscreenRenderingHelper;Y.rctx.bindTexture(ja.depthTexture,6);Z.setUniform1i("depthTex",6);Z.setUniform4f("highlightViewportPixelSz",0,0,1/ja.width,1/ja.height)}else Z.setUniformMatrix4fv("viewNormal",Y.camera.viewInverseTransposeMatrix),2!==Y.pass&&4!==Y.pass||Z.setUniform2fv("nearFar",Y.camera.nearFar);this._renderPatchGroupsAuxiliary(Y,Z,ba,ia)};ea._updateTileBackground=function(){if(this.tileRenderer){this.tileBackgroundUpdating=
!0;var Y=()=>{this.tileBackgroundInitialized=!0;this.tileBackgroundUpdating=!1;this.rootTiles&&M.traverseTilesPreorder(this.rootTiles,Z=>{this.tileRenderer.updateTileTexture(Z);this.setNeedsRender()});this.setNeedsRender()};if("string"===typeof this.tileBackground){const Z=this.tileBackground;t.requestImage(Z).then(ba=>{Z===this.tileBackground&&this.tileRenderer&&(this.tileRenderer.setBackground(ba),Y())})}else{const Z=this.tileBackground?m.toUnitRGBA(this.tileBackground):[0,0,0,0];this.tileRenderer.setBackground(Z);
Y()}}};ea._updatePatchGroups=function(){const Y=this.patchGroups;if(!this.patchGroupsDirty)return Y;this.highestVisibleLODTile=null;this._renderCollectOrigins(Y);if(0!==this.renderOrder){for(let Z=0;Z<Y.length;Z++)M.sortTiles(this.renderOrder,Y.data[Z].patches);Y.sort((Z,ba)=>{var ia=this.renderOrder;Z=0===Z.patches.length?-ia:0===ba.patches.length?ia:M.compareTiles(Z.patches.data[0],ba.patches.data[0],ia);return Z})}this.patchGroupsDirty=!1;return Y};ea._renderCollectOrigins=function(Y){var Z=this.rootTiles;
const ba="spherical"===this.manifold;Y.clear();for(const ia of Z)Z=Y.pushNew(),Z.root=ia,Z.origin=ba?u.ZEROS:ia.centerAtSeaLevel,Z.patches.clear(),this._renderCollectOriginsForRoot(Y,Z);Y.filterInPlace(ia=>0<ia.patches.length)};ea._renderCollectOriginsForRoot=function(Y,Z){const ba=this.tileIterator;ba.resetOne(Z.root);const ia=this.patchGroupsMap;ia.clear();for(ia.set(Z.origin,Z);!ba.done;){Z=ba.next();var ja=Z.renderData;if(ja&&!Z.visible)this.numTilesCulled++,ba.skipSubtree();else{if(0===Z.lij[0]%
7){const la=Y.pushNew();la.root=Z;la.origin=Z.centerAtSeaLevel;ia.set(Z.centerAtSeaLevel,la);la.patches.clear()}if(!Z.rendered)this.numTilesCulled++;else if(ja){(ja=ia.get(ja.localOrigin))&&ja.patches.push(Z);if(!this.highestVisibleLODTile||Z.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=Z;ba.skipSubtree()}}}};ea._scaleQueriesForTile=function(Y){const Z=Y.extent;Y=Y.lij[0];let ba=0;for(;ba<this.visibleScaleRangeQueriesInvPtr;){const ia=this.visibleScaleRangeQueries.data[ba],
ja=ia.extent;Y>=ia.minLevel&&Y<=ia.maxLevel&&ja[0]<=Z[2]&&ja[2]>=Z[0]&&ja[1]<=Z[3]&&ja[3]>=Z[1]?(this.visibleScaleRangeQueries.swapElements(ba,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):ba++}};ea._useStencilForTile=function(Y){for(const Z of this.stencilEnabledLayerExtents)if(Y.intersectsExtent(Z))return!0;return!1};ea._renderPatchGroupsAuxiliary=function(Y,Z,ba,ia){this.shaderTechnique.bindPipelineState(Y.rctx);const ja=0<this.stencilEnabledLayerExtents.length;
Z.setUniformMatrix4fv("proj",Y.camera.projectionMatrix);Z.setUniform1f("skirtScale",this._skirtScale);0!==ia&&this._bindOverlayData(Z,ia);for(let la=0;la<ba.length;la++){const qa=ba.data[la];this._bindPatchGroupData(Z,qa,Y.camera.eye,Y.camera.viewMatrix);for(let na=0;na<qa.patches.length;na++)this._renderPatch(Y.rctx,Z,qa.patches.data[na],4,ja,ia)}Y.rctx.bindVAO(null)};ea._renderPatchGroups=function(Y,Z,ba,ia){const ja=Y.rctx,la=Y.camera,qa=la.viewMatrix;this.shaderTechnique.bindPipelineState(ja);
if(this.shaderTechniqueConfig.screenSizePerspective&&this.pointsOfInterest){var na=H.getSettings("spherical"===this.manifold?1:2,this.ellipsoidRadius);na.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:la.fovY});I.bindScreenSizePerspective(na,Z,"screenSizePerspective")}na=0<this.stencilEnabledLayerExtents.length;const oa=3===ia;oa&&(ja.bindTexture(this.emptyTex,0),Z.setUniform1f("blend",1),Z.setUniform4fv("texOffsetAndScale",x.ZEROS));Z.setUniform1f("skirtScale",oa?0:
this._skirtScale);const ua=this.wireframe?1:4;for(let La=0;La<ba.length;La++){var za=ba.data[La];const Sa=za.patches;if(0!==Sa.length)for(this._bindPatchGroupData(Z,za,la.eye,qa),J.Slice.bindUniforms(Z,this.shaderTechnique.configuration,Y.sliceHelper&&Y.sliceHelper.plane,za.origin),Y.shadowMap&&Y.shadowMap.bindView(Z,za.origin),this.numOriginsRendered++,za=0;za<Sa.length;za++){const Ia=Sa.data[za];var Fa=Ia.renderData.textureReference;if(!r.isNone(Fa)){F.trace("# RENDER TILE "+M.tile2str(Ia)+", screenDepth:"+
Ia.screenDepth);if(!oa){this._scaleQueriesForTile(Ia);N(Ia.renderData.geometryInfo.uvOffsetAndScale,Fa.offsetAndScale,U);Z.setUniform4fv("texOffsetAndScale",U);ja.bindTexture(Fa.texture.texture,0);Fa=Ia.renderData.textureFadeFactor;const Qa=1>Fa?Ia.renderData.nextTextureReference:null;this.shaderTechniqueConfig.textureFadingEnabled&&r.isSome(Qa)?(N(Ia.renderData.geometryInfo.uvOffsetAndScale,Qa.offsetAndScale,U),Z.setUniform1f("textureFadeFactor",Fa),Z.setUniform4fv("nextTexOffsetAndScale",U),ja.bindTexture(Qa.texture.texture,
1)):(Z.setUniform1f("textureFadeFactor",1),ja.bindTexture(this.emptyTex,1));Ia.renderData.textureIsFading&&this.setNeedsRender();Z.setUniform1f("opacity",Ia.renderData.opacity)}Fa=this._renderPatch(ja,Z,Ia,ua,na,ia);Ia.renderOrder=this.numTilesRendered;this.numTilesRendered++;this.numTrianglesRendered+=Fa/3}}}ja.bindVAO(null)};ea._renderPatch=function(Y,Z,ba,ia,ja,la){0!==la&&this._bindOverlayPatchData(Z,ba.renderData.overlay);ja&&(this._useStencilForTile(ba)?this.stencilShaderTechnique.bindPipelineState(Y):
this.shaderTechnique.bindPipelineState(Y));ja=0===this._skirtScale?ba.renderData.geometryInfo.numWithoutSkirtIndices:ba.renderData.vao.indexBuffer.size;Y.bindVAO(ba.renderData.vao);Z.assertCompatibleVertexAttributeLocations(ba.renderData.vao);Y.drawElements(ia,ja,ba.renderData.vao.indexBuffer.indexType,0);return ja};ea._bindPatchGroupData=function(Y,Z,ba,ia){Y.setUniform3fv("origin",Z.origin);y.translate(W,ia,Z.origin);Y.setUniformMatrix4fv("view",W);Y.setUniform3f("camPos",ba[0]-Z.origin[0],ba[1]-
Z.origin[1],ba[2]-Z.origin[2])};ea._bindOverlayData=function(Y,Z){Y.setUniform1i("ovInnerColorTex",2);Y.setUniform1i("ovOuterColorTex",3);Y.setUniform1i("ovInnerWaterTex",4);Y.setUniform1i("ovOuterWaterTex",5);Y.setUniform1f("overlayOpacity",this.overlayOpacity);const ba=this.overlayRenderer.overlays;Y=ia=>{if(r.isSome(ba)){var ja=ba[ia];const la=(1===Z?ja.renderTargets.color:2===Z?ja.renderTargets.highlight:ja.renderTargets.occluded).fbo.getTexture();this.rctx.bindTexture(la,2+ia);(ja=1===Z?ja.renderTargets.water:
null)?(ja=ja.fbo.getTexture(),this.rctx.bindTexture(ja,4+ia)):this.rctx.bindTexture(this.emptyTex,4+ia)}else this.rctx.bindTexture(this.emptyTex,2+ia),this.rctx.bindTexture(this.emptyTex,4+ia)};Y(0);Y(1)};ea._bindOverlayPatchData=function(Y,Z){Y.setUniform4fv("overlayTexOffset",Z.offsets);Y.setUniform4fv("overlayTexScale",Z.scales)};ea._setTerrainTechnique=function(Y,Z){this.shaderTechniqueConfig.output=Y;0===Y&&(this.shaderTechniqueConfig.atmosphere="spherical"===this.manifold&&this._velvetOverground,
this.shaderTechniqueConfig.ssrEnabled=this._ssrEnabled);this.shaderTechniqueConfig.renderOccluded=Z;this.shaderTechniqueConfig.stencilEnabled=!1;this.shaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(Q.TerrainTechnique,this.shaderTechniqueConfig,this.shaderTechnique);this.shaderTechniqueConfig.stencilEnabled=!0;this.stencilShaderTechnique=this.shaderTechniques.acquireAndReleaseExisting(Q.TerrainTechnique,this.shaderTechniqueConfig,this.stencilShaderTechnique)};ea.releaseTileGeometry=
function(Y){Y.releaseGeometry()&&this.setNeedsRender();this.renderDataPool.release(Y)};ea._prepareScaleRangeQueries=function(){const Y=this.visibleScaleRangeQueries,Z=this.visibleScaleRangeQueryQueue;for(;Y.length<Y.data.length&&0<Z.length;){const ba=Z.pop();Y.push(ba)}this.visibleScaleRangeQueriesInvPtr=Y.length};ea._processScaleRangeQueries=function(){const Y=this.visibleScaleRangeQueries,Z=this.visibleScaleRangeQueryPool;for(let ba=0;ba<Y.length;ba++){const ia=Y.data[ba];Z.release(ia);ia.callback(ba>=
this.visibleScaleRangeQueriesInvPtr);ia.callback=null}Y.clear()};b._createClass(fa,[{key:"updating",get:function(){return!this.tileBackgroundInitialized||this.tileBackgroundUpdating}},{key:"canRender",get:function(){return this.visible&&!!this.rootTiles&&this.tileBackgroundInitialized&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(Y){this._set("renderingDisabled",!!Y);this.setNeedsRender()}},{key:"opaque",set:function(Y){this._opaque!==Y&&(this._opaque=Y,this.setNeedsRender())},
get:function(){return this._opaque&&!this.shaderTechniqueConfig.slicePlaneEnabled}},{key:"needsLinearDepth",get:function(){return this.overlayRenderer.hasWater}},{key:"isTransparent",set:function(Y){this._isTransparent!==Y&&(this._isTransparent=Y,this.setNeedsRender())},get:function(){return this._isTransparent}},{key:"skirtScale",set:function(Y){Y!==this._skirtScale&&(this._skirtScale=Y,this.setNeedsRender())},get:function(){return this._skirtScale}},{key:"renderPatchBorders",get:function(){return!!this.shaderTechniqueConfig.tileBorders},
set:function(Y){this.shaderTechniqueConfig.tileBorders!==Y&&(this.shaderTechniqueConfig.tileBorders=Y,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"cullBackFaces",get:function(){return this.shaderTechniqueConfig.backfaceCullingEnabled},set:function(Y){this.shaderTechniqueConfig.backfaceCullingEnabled!==Y&&(this.shaderTechniqueConfig.backfaceCullingEnabled=Y,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(Y){this._set("renderOrder",
Y);this.setNeedsRender()}},{key:"velvetOverground",set:function(Y){this._velvetOverground!==Y&&(this._velvetOverground=Y,this.setNeedsRender())}},{key:"intersectionHandlerId",get:function(){return G.TERRAIN_ID}},{key:"slicePlane",get:function(){return this.shaderTechniqueConfig.slicePlaneEnabled},set:function(Y){this.shaderTechniqueConfig.slicePlaneEnabled!==Y&&(this.shaderTechniqueConfig.slicePlaneEnabled=Y,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(Y){this.shaderTechniqueConfig.textureFadingEnabled!==
Y&&(this.shaderTechniqueConfig.textureFadingEnabled=Y,this.setNeedsRender())}},{key:"wireframe",set:function(Y){this._get("wireframe")!==Y&&(this._set("wireframe",Y),this.rootTiles&&(M.traverseTilesPreorder(this.rootTiles,Z=>{Z.renderData&&Z.renderData.updateGeometry(this.rctx,Y)}),this.setNeedsRender()))}},{key:"test",get:function(){return{tileRenderer:this.tileRenderer}}}]);return fa}(q);k.__decorate([d.property()],a.prototype,"tileBackgroundInitialized",void 0);k.__decorate([d.property()],a.prototype,
"tileBackgroundUpdating",void 0);k.__decorate([d.property({constructOnly:!0})],a.prototype,"manifold",void 0);k.__decorate([d.property({constructOnly:!0})],a.prototype,"overlayRenderer",void 0);k.__decorate([d.property({constructOnly:!0})],a.prototype,"ellipsoidRadius",void 0);k.__decorate([d.property({readOnly:!0,dependsOn:["tileBackgroundInitialized","tileBackgroundUpdating"]})],a.prototype,"updating",null);k.__decorate([d.property({value:!1})],a.prototype,"renderingDisabled",null);k.__decorate([d.property()],
a.prototype,"renderPatchBorders",null);k.__decorate([d.property()],a.prototype,"cullBackFaces",null);k.__decorate([d.property({value:1})],a.prototype,"renderOrder",null);k.__decorate([d.property()],a.prototype,"wireframe",null);k=a=k.__decorate([e.subclass("esri.views.3d.terrain.TerrainRenderer")],a);const W=B.create(),X=u.create(),ca=u.create(),R=u.create(),aa=u.create(),ka=u.create();return k})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/arrayUtils ../../../core/mathUtils ../../../geometry/support/aaBoundingBox ./TerrainConst ../webgl-engine/lib/DefaultVertexAttributeLocations ../support/buffer/glUtil ../../webgl/BufferObject ../../webgl/VertexArrayObject ./PatchGeometryFactory ./tileUtils ./TextureFader ./TileOverlayData".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){let m=function(){function u(){this.geometryInfo=new p.PatchGeometry;this._textureRef=new w["default"](()=>this.tile.surface.textureFadeDuration);this.overlay=new q}var v=u.prototype;v.init=function(y){this.tile=y;this.clear();y=this.geometryInfo;y.indices=null;y.vertexAttributes=null;h.empty(y.boundingBox);y.numSurfaceIndices=0;y.numSkirtIndices=0;y.numWithoutSkirtIndices=0;y.numVertsPerRow=0;this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,
wireframe:!1};this.opacity=1;this.localOrigin=null;this.overlay.clear()};v.clear=function(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear()};v.updateGeometry=function(y,B){if(!this._updateGeometryState(B))return!1;this._releaseGeometry();this._createGeometry(y);return!0};v.releaseGeometry=function(){return this._releaseGeometry()?(this.geometryState={numVertsPerRow:0,samplerData:null,clippingArea:null,wireframe:!1},!0):!1};v.ensureTexture=function(y,B){a.isSome(this._texture)&&
this._texture.descriptor.width!==y&&this.releaseTexture();this._texture||(this._texture=B(),this.tile.setMemoryDirty());return this._texture};v.releaseTexture=function(){a.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};v._updateGeometryState=function(y){const B=this._getElevationInfo();var x=this.tile.level,C=8>x?this.tile.numSubdivisionsAtLevel[x]+1:2;B.samplerData&&(C=this.tile.maxTesselation,C=l.clamp((C>>Math.max(x-B.maxTileLevel,d.ELEVATION_DESIRED_RESOLUTION_LEVEL-
(this.tile.vlevel-x)))+1,2,C+1));x=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)x=null;const z=this.geometryState;let A=!1;z.numVertsPerRow!==C&&(z.numVertsPerRow=C,A=!0);B.changed&&(z.samplerData=B.samplerData,A=!0);r.equals(z.clippingArea,x)||(z.clippingArea=x,A=!0);z.wireframe!==y&&(z.wireframe=y,A=!0);return A};v._createGeometry=function(y){this.tile.createGeometry(this.geometryState,this.localOrigin);const B=this.geometryInfo.vertexAttributes,x=
this.geometryInfo.indices,C=y.gl;this._vao=new g(y,c.Default3D,{geometry:e.glLayout(B.layout)},{geometry:f.createVertex(y,C.STATIC_DRAW,B.buffer)},f.createIndex(y,C.STATIC_DRAW,x))};v._releaseGeometry=function(){if(!this._vao)return!1;this._vao.dispose();this._vao=null;p.releaseGeometry(this.geometryInfo);return!0};v.setTextureReference=function(y,B,x,C,z=0){y!==this._texture&&this.releaseTexture();this._textureRef.push(y,B,x,C,z)};v._getElevationInfo=function(){const y=this.geometryState.samplerData,
B=this.tile.layerInfo[0],x=B.length;let C=Array(x),z=0;var A=0;let t=!1;for(let G=0;G<x;G++){var D=B[G];if(D.upsampleInfo){D=D.upsampleInfo.tile;var E=D.layerInfo[0][G].data;E=E&&E.samplerData;y&&y[z]===E||(t=!0);C[z++]=E;A=Math.max(A,D.lij[0])}else D.data&&(E=this.tile.surface.layerViewByIndex(G,0),n.fallsWithinLayer(this.tile,E.layer,!1)&&(A=D.data,y&&y[z]===A.samplerData||(t=!0),C[z++]=A.samplerData,A=this.tile.lij[0]))}y&&y.length!==z&&(t=!0);0<z?C.length=z:C=null;return{changed:t,samplerData:C,
maxTileLevel:A}};k._createClass(u,[{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",get:function(){return this._textureRef.fadeFactor}},{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",get:function(){return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength}},
{key:"textureDescriptor",get:function(){return a.isSome(this._texture)?this._texture.descriptor:null}},{key:"test",get:function(){return{hasTexture:null!=this._texture}}}]);return u}();b.PatchRenderData=m;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../chunks/vec4f64"],function(b,k,a,r){let l=function(){function d(e){this._getFadeDuration=e;this._delayedTime=
this._fadeStart=0}var c=d.prototype;c.clear=function(){this._current=a.destroyMaybe(this._current);this._next=a.destroyMaybe(this._next);this._waiting=a.destroyMaybe(this._waiting);this._delayed=a.destroyMaybe(this._delayed)};c.push=function(e,f,g,p,n=0){this._delayed=a.destroyMaybe(this._delayed);e=a.isSome(e)?new h(e,f,g,p):null;this._push(e,n)};c._push=function(e,f){this._isFading||this.clear();if(a.isNone(this._current))this._current=e;else{var g=performance.now();0!==f?(this._delayed=e,this._delayedTime=
g+f):a.isNone(this._next)?(this._next=e,this._fadeStart=g):a.isNone(e)||(a.destroyMaybe(this._waiting),this._waiting=e)}};k._createClass(d,[{key:"current",get:function(){if(a.isNone(this._current))return null;if(!this._isFading){var e=this._delayed||this._waiting||this._next||this._current;e!==this._current&&(this._current=null,this.clear(),this._current=e)}e=performance.now();a.isSome(this._delayed)&&e>=this._delayedTime&&(this._push(this._delayed,0),this._delayed=null);a.isSome(this._next)&&e-this._fadeStart>=
this._fadeDuration&&(a.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=e);return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(a.isNone(this._next))return 1;const e=performance.now()-this._fadeStart,f=this._fadeDuration;return e>f?0:1-e/f}},{key:"isFading",get:function(){return a.isSome(this._next)||a.isSome(this._delayed)}},{key:"_fadeDuration",get:function(){return a.isNone(this._waiting)?
this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFading",get:function(){return 0<this._getFadeDuration()}}]);return d}(),h=function(){function d(c,e,f,g){this.texture=c;c.retain();this.offsetAndScale=r.fromValues(e,f,g,g)}d.prototype.destroy=function(){this.texture.release()};return d}();b.TextureReference=h;b.default=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(b){return function(){function k(){this._scales=
[-1,-1,-1,-1];this._offsets=[-1,-1,-1,-1]}var a=k.prototype;a.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=this._offsets[3]=-1};a.setScale=function(r,l,h){this._scales[2*r]=l;this._scales[2*r+1]=h};a.setOffset=function(r,l,h){this._offsets[2*r]=l;this._offsets[2*r+1]=h};b._createClass(k,[{key:"scales",get:function(){return this._scales}},{key:"offsets",get:function(){return this._offsets}}]);return k}()})},"esri/views/3d/terrain/TileRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/mathUtils ../../../chunks/vec2f64 ../../../chunks/vec2 ../../../layers/support/layerUtils ../../webgl/Program ../../webgl/BufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/Renderbuffer ../../webgl/FramebufferObject ../../webgl/ProgramCache ../../webgl/RenderingContext ../../webgl/ShaderCompiler ../support/StreamDataLoader ../../webgl/rasterUtils ./TileTexture ./terrainUtils ../../2d/engine/vectorTiles/tileRendererHelper3D ./BlendLayersTechnique ./RasterColorizerTechnique ./support/FBOPool".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D){function E(I,J,K){K.layerIndex=J;const L=I.layerInfo[1][J];return L.data?(l.set(K.offset,0,0),K.tile=I,K.scale=1,K.sourceLod=I.lij,K.sourceLayerInfo=L,K):(I=L.upsampleInfo)?(J=I.tile.layerInfo[1][J],K.tile=I.tile,l.copy(K.offset,I.offset),K.scale=I.scale,K.sourceLod=I.tile.lij,K.sourceLayerInfo=J,K):null}const G=[],H={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0};return function(){function I(K,L,S){this._rctx=
K;this.tileSize=L;this._blackTex=this._backgroundTexture=null;this._vectorTileHelper=new z.VectorTileRendererHelper3D;this._rctx.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy);this._vaoQuad=n.createQuadVAO(this._rctx,p.Pos2Tex);K=new A.BlendLayersTechniqueConfiguration;K.mode=2;this._blendLayersTechnique=S.acquireAndReleaseExisting(A.BlendLayersTechnique,K,this._blendLayersTechnique);K.mode=1;this._applyOpacityTechnique=S.acquireAndReleaseExisting(A.BlendLayersTechnique,
K,this._applyOpacityTechnique);this._techniqueRep=S;this._blackTex=new x(n.createColorTexture(this._rctx,[0,0,0,1]));this._fboPool=new D.FBOPool(this._rctx)}var J=I.prototype;J.dispose=function(){this._fboPool&&(this._fboPool.clear(),this._fboPool=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);k.isSome(this._backgroundTexture)&&(this._backgroundTexture.release(),this._backgroundTexture=null);this._blackTex&&(this._blackTex.release(),this._blackTex=null);this._blendLayersTechnique&&
(this._blendLayersTechnique.dispose(),this._blendLayersTechnique=null);this._applyOpacityTechnique&&(this._applyOpacityTechnique.dispose(),this._applyOpacityTechnique=null);this._rasterColorizerTechnique&&(this._rasterColorizerTechnique.dispose(),this._rasterColorizerTechnique=null);this._vectorTileHelper&&(this._vectorTileHelper.dispose(),this._vectorTileHelper=null)};J.updateTileTexture=function(K){var L=K.layerInfo[1];for(var S of L)S.pendingUpdates&=-65;if(K.renderData){var M=K.surface,T=M.baseOpacity,
O=0;S=0;for(var Q=this.tileSize,F=!1,N=M.view.pixelRatio,P=L.length,U=0;U<L.length&&!F;U++){const V=M.layerViewByIndex(U,1),W=V.fullOpacity;G[U]=W;h.isBaseLayer(V.layer)&&P>=L.length&&(P=U);if(0===W)continue;++S;const X=E(K,U,H);X&&(C.isVectorTileLayerView(V)?Q=Math.max(Q,this.tileSize*N):1===T&&1===W&&(V.isOpaque||this._dataToTexture(X)&&k.isSome(X.sourceLayerInfo.data)&&X.sourceLayerInfo.data.descriptor.isOpaque)&&(F=!0),++O)}this._cleanupFBOPool(N,L.length);T=Q;Q=a.nextHighestPowerOfTwo(T);L=Q*
Q;M=T*T;L===M?Q=T:(T=Q/2,Q=L-M<M-T*T?Q:T);L=Q/this.tileSize;--U;if(0===O){O=0;if(K.surface.view.layerViewManager.updating||0<S)O=5E3;this._backgroundTexture&&k.isNone(K.renderData.textureReference)&&(O=0);this._useBackgroundTexture(K,O)}else 1===O&&F?this._useLayerTexture(K,U):this._composeMapLayers(K,U,P,F,G,Q,L)}};J.setBackground=function(K){k.isSome(this._backgroundTexture)&&this._backgroundTexture.release();this._backgroundTexture=K instanceof HTMLImageElement?this._buildTexture(K):new x(n.createColorTexture(this._rctx,
K))};J._buildTexture=function(K){if(k.isNone(K))return null;const L={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},S=this._rctx;let M;if("number"===typeof K)L.width=L.height=K,M=new x(new e(S,L));else if(K instanceof y.ImageWithType)L.isOpaque=K.isOpaque,M=new x(new e(S,L,K.image)),K.release();else try{M=new x(new e(S,L,K))}catch(T){M=new x(n.createEmptyTexture(S)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}S.bindTexture(M.texture,
0);M.generateMipmap();return M};J._drawQuad=function(K){this._rctx.bindVAO(this._vaoQuad);K.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(5,0,f.vertexCount(this._vaoQuad,"geometry"))};J._drawRasterData=function(K,L,S,M,T=1){if(!k.isNone(L)){var O=this._rctx,Q=K.program;O.setPipelineState(K.pipeline);O.bindProgram(Q);O.bindTexture(L,0);Q.setUniform1i("tex",0);Q.setUniform1f("scale",S);Q.setUniform2f("offset",M[0],M[1]);Q.setUniform1f("opacity",T);this._drawQuad(Q)}};
J._drawImageryTileData=function(K,L=1){const S=K.sourceLayerInfo.data;if(!k.isNone(S)&&S.source){K.tile.surface.layerViewByIndex(K.layerIndex,1).ensureSymbolizerParameters(S);var M=this._getRasterColorizerTechnique(S.symbolizerParameters.type,!!S.symbolizerParameters.colormap),T=this._rctx,O=M.program;T.setPipelineState(M.pipeline);T.bindProgram(O);if(S.bind(T)){S.opacity=L;S.scale=K.scale;S.offset=K.offset;var {names:Q,textures:F}=S.getTextures();B.setTextures(T,O,Q,F);K=S.getUniforms();M.bindPass(T,
K);this._drawQuad(O);T.bindVAO()}}};J._getRasterColorizerTechnique=function(K,L){K=["stretch","lut","hillshade"].indexOf(K);this._rasterColorizerConfig||(this._rasterColorizerConfig=new t.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.colorizerType=K;this._rasterColorizerConfig.applyColormap=L;return this._rasterColorizerTechnique=this._techniqueRep.acquireAndReleaseExisting(t.RasterColorizerTechnique,
this._rasterColorizerConfig,this._rasterColorizerTechnique)};J._drawVectorData=function(K,L,S,M,T,O,Q){const F=L.sourceLayerInfo.data;if(k.isNone(F))return Q;const N=this._rctx,P=L.tile.surface.layerViewByIndex(L.layerIndex,1);let U;N.setPipelineState(K.pipeline);const V=1>M;V?(U=this._fboPool.acquire(T),N.bindFramebuffer(U),N.setClearColor(1,1,1,0),N.clearSafe(16640)):Q&&N.clearSafe(256);this._vectorTileHelper.render(N,L.sourceLod,F,P.painter,P.layer.styleRepository,P.schemaHelper,Math.round(1/L.scale),
L.offset,this.tileSize,S);return V?(N.bindFramebuffer(O),this._drawRasterData(K,U.colorTexture,1,[0,0],M),this._fboPool.release(U),Q):!0};J._useBackgroundTexture=function(K,L){K.renderData.opacity=K.surface.baseOpacity;K.renderData.setTextureReference(this._backgroundTexture,0,0,1,L)};J._useLayerTexture=function(K,L){K.renderData.opacity=K.surface.baseOpacity;L=E(K,L,H);if(this._dataToTexture(L)){const S=L.offset;K.renderData.setTextureReference(L.sourceLayerInfo.data,S[0],S[1],L.scale)}};J._composeMapLayers=
function(K,L,S,M,T,O,Q){const F=K.renderData.ensureTexture(O,()=>this._buildTexture(O));if(!k.isNone(F)){var N=this._rctx,P=this._fboPool.acquire(O);N.bindFramebuffer(P);N.setViewport(0,0,O,O);N.setClearColor(0,0,0,0);N.setClearDepth(1);N.clearSafe(16640);var U=!1;!M&&k.isSome(this._backgroundTexture)&&this._drawRasterData(this._blendLayersTechnique,this._backgroundTexture.texture,1,r.ZEROS);M=K.surface.baseOpacity;for(var V=!1;0<=L;L--){const W=E(K,L,H);W&&(L<S&&1>M&&!V&&(this._drawRasterData(this._applyOpacityTechnique,
this._blackTex.texture,1,r.ZEROS,M),V=!0),0!==T[L]&&(C.isVectorTileRenderInfo(W)?U=this._drawVectorData(this._blendLayersTechnique,W,Q,T[L],O,P,U):C.isImageryTileRenderInfo(W)?this._drawImageryTileData(W,T[L]):this._dataToTexture(W)&&k.isSome(W.sourceLayerInfo.data)&&this._drawRasterData(this._blendLayersTechnique,W.sourceLayerInfo.data.texture,W.scale,W.offset,T[L])))}N.bindTexture(F.texture,0);S=F.descriptor;N.gl.copyTexImage2D(N.gl.TEXTURE_2D,0,S.pixelFormat,0,0,S.width,S.height,0);F.generateMipmap();
N.bindFramebuffer(null);this._fboPool.release(P);K.renderData.opacity=V?1:M;K.renderData.setTextureReference(F,0,0,1)}};J._dataToTexture=function(K){C.isRasterTileRenderInfo(K)&&this._rasterDataToTexture(K);return C.isTextureTileRenderInfo(K)};J._rasterDataToTexture=function(K){const L=K.sourceLayerInfo;L.data=this._buildTexture(L.data);K.tile.setMemoryDirty()};J._cleanupFBOPool=function(K,L){if(K!==this._lastPixelRatio||L!==this._lastNumLayers)this._fboPool.clear(),this._lastPixelRatio=K,this._lastNumLayers=
L};b._createClass(I,[{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);return I}()})},"esri/views/2d/engine/vectorTiles/tileRendererHelper3D":function(){define(["exports","../../../../geometry/Point","../../../../geometry","../../../../Viewpoint","../../ViewState"],function(b,k,a,r,l){a=function(){function h(){this.renderParams={context:null,drawPhase:1,state:new l({viewpoint:new r({targetGeometry:new k(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,
displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,driverTestResult:null,profiler:null,renderingOptions:null,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1}}var d=h.prototype;d.dispose=function(){this.renderParams=null};d.render=function(c,e,f,g,p,n,w,q,m,u){const v=n.adjustLevel(e[0]),y=this.renderParams;y.context=c;y.painter=
g;y.glyphMosaic=g.glyphMosaic;y.spriteMosaic=g.spriteMosaic;y.pixelRatio=u;y.displayLevel=v;y.requiredLevel=v;g.setContext(c);u=n.getScale(e[0]);const [B,x]=n.getShift(e,w*u);e=.125*w*u/m;n=f.transforms.dvs;n[0]=e;n[4]=-e;n[6]=-1-B-q[0]*w*2;n[7]=1+x+(1-q[1])*w*2-2;y.state.size[0]=m;y.state.size[1]=m;f.stage||f.attachWithContext(c);f.triangleCount=0;g.drawTile(y,f,p)};return h}();b.VectorTileRendererHelper3D=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport ../../geometry/Point ../../geometry/Extent ../../geometry ../../chunks/common ../../Viewpoint ../../chunks/vec2f64 ../../chunks/mat3 ../../chunks/vec2 ../../chunks/mat2d ../../chunks/mat2df64 ./viewpointUtils ../../chunks/mat2df32 ../../chunks/mat3f32 ../../chunks/vec2f32 ../../core/libs/gl-matrix-2/types/vec2".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E){var G;const H=[0,0];a=G=function(I){function J(...L){L=I.call(this,...L)||this;L._viewpoint2D={center:v.create(),rotation:0,scale:0,spatialReference:null};L.center=[0,0];L.extent=new w;L.id=0;L.inverseTransform=C.create();L.resolution=0;L.rotation=0;L.scale=0;L.transform=C.create();L.transformNoRotation=C.create();L.displayMat3=t.create();L.displayViewMat3=t.create();L.viewMat3=t.create();L.viewMat2d=A.create();L.worldScreenWidth=0;L.size=
[0,0];return L}b._inheritsLoose(J,I);var K=J.prototype;K.copy=function(L){const S=this.size,M=this.viewpoint;M&&S?(this.viewpoint=z.copy(M,L.viewpoint),this._set("size",B.copy(S,L.size))):(this.viewpoint=L.viewpoint.clone(),this._set("size",[L.size[0],L.size[1]]));this._set("pixelRatio",L.pixelRatio);return this};K.clone=function(){return new G({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};K.toMap=function(L,S,M){if(E.isVec2(S))return B.transformMat2d(L,S,this.inverseTransform);
H[0]=S;H[1]=M;return B.transformMat2d(L,H,this.inverseTransform)};K.toScreen=function(L,S,M){if(E.isVec2(S))return B.transformMat2d(L,S,this.transform);H[0]=S;H[1]=M;return B.transformMat2d(L,H,this.transform)};K.toScreenNoRotation=function(L,S,M){if(E.isVec2(S))return B.transformMat2d(L,S,this.transformNoRotation);H[0]=S;H[1]=M;return B.transformMat2d(L,H,this.transformNoRotation)};K.getScreenTransform=function(L,S){const {center:M}=this._viewpoint2D,T=this._get("pixelRatio")||1,O=this._get("size");
z.getMatrix(L,M,O,S,0,T);return L};K._update=function(){const {center:L,spatialReference:S,scale:M,rotation:T}=this._viewpoint2D,O=this._get("pixelRatio")||1,Q=this._get("size"),F=new u({targetGeometry:new n(L[0],L[1],S),scale:M,rotation:T});this._set("viewpoint",F);if(Q&&S&&M){this.resolution=z.getResolution(F);this.rotation=T;this.scale=M;this.spatialReference=S;B.copy(this.center,L);y.set(this.displayMat3,0!==Q[0]?2/Q[0]:0,0,0,0,0!==Q[1]?-2/Q[1]:0,0,-1,1,1);var N=y.identity(this.viewMat3),P=D.fromValues(Q[0]/
2,Q[1]/2),U=D.fromValues(-Q[0]/2,-Q[1]/2),V=m.toRadian(T);y.translate(N,N,P);y.rotate(N,N,V);y.translate(N,N,U);y.multiply(this.displayViewMat3,this.displayMat3,N);N=x.identity(this.viewMat2d);x.translate(N,N,P);x.rotate(N,N,V);x.translate(N,N,U);z.getExtent(this.extent,F,Q);z.getTransform(this.transform,F,Q,O);x.invert(this.inverseTransform,this.transform);z.getTransformNoRotation(this.transformNoRotation,F,Q,O);this.worldScreenWidth=z.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",
this.id+1);return this}};b._createClass(J,[{key:"pixelRatio",set:function(L){this._set("pixelRatio",L);this._update()}},{key:"size",set:function(L){this._set("size",L);this._update()}},{key:"viewpoint",set:function(L){if(L){const S=this._viewpoint2D,M=L.targetGeometry;S.center[0]=M.x;S.center[1]=M.y;S.rotation=L.rotation;S.scale=L.scale;S.spatialReference=M.spatialReference}this._update()}}]);return J}(p.JSONSupport);k.__decorate([h.property({readOnly:!0})],a.prototype,"id",void 0);k.__decorate([h.property({value:1,
json:{write:!0}})],a.prototype,"pixelRatio",null);k.__decorate([h.property({json:{write:!0}})],a.prototype,"size",null);k.__decorate([h.property({type:u,json:{write:!0}})],a.prototype,"viewpoint",null);return a=G=k.__decorate([c.subclass("esri.views.2d.ViewState")],a)})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(b,k){function a(A,t){A[0]=t[0];A[1]=t[1];A[2]=t[2];A[3]=t[3];A[4]=t[4];A[5]=t[5];return A}function r(A){A[0]=1;A[1]=0;A[2]=0;A[3]=1;A[4]=0;A[5]=0;return A}function l(A,
t,D,E,G,H,I){A[0]=t;A[1]=D;A[2]=E;A[3]=G;A[4]=H;A[5]=I;return A}function h(A,t){const D=t[0],E=t[1],G=t[2],H=t[3],I=t[4];t=t[5];let J=D*H-E*G;if(!J)return null;J=1/J;A[0]=H*J;A[1]=-E*J;A[2]=-G*J;A[3]=D*J;A[4]=(G*t-H*I)*J;A[5]=(E*I-D*t)*J;return A}function d(A){return A[0]*A[3]-A[1]*A[2]}function c(A,t,D){const E=t[0],G=t[1],H=t[2],I=t[3],J=t[4];t=t[5];const K=D[0],L=D[1],S=D[2],M=D[3],T=D[4];D=D[5];A[0]=E*K+H*L;A[1]=G*K+I*L;A[2]=E*S+H*M;A[3]=G*S+I*M;A[4]=E*T+H*D+J;A[5]=G*T+I*D+t;return A}function e(A,
t,D){const E=t[0],G=t[1],H=t[2],I=t[3],J=t[4];t=t[5];const K=Math.sin(D);D=Math.cos(D);A[0]=E*D+H*K;A[1]=G*D+I*K;A[2]=E*-K+H*D;A[3]=G*-K+I*D;A[4]=J;A[5]=t;return A}function f(A,t,D){const E=t[1],G=t[2],H=t[3],I=t[4],J=t[5],K=D[0];D=D[1];A[0]=t[0]*K;A[1]=E*K;A[2]=G*D;A[3]=H*D;A[4]=I;A[5]=J;return A}function g(A,t,D){const E=t[0],G=t[1],H=t[2],I=t[3],J=t[4];t=t[5];const K=D[0];D=D[1];A[0]=E;A[1]=G;A[2]=H;A[3]=I;A[4]=E*K+H*D+J;A[5]=G*K+I*D+t;return A}function p(A,t){const D=Math.sin(t);t=Math.cos(t);
A[0]=t;A[1]=D;A[2]=-D;A[3]=t;A[4]=0;A[5]=0;return A}function n(A,t){A[0]=t[0];A[1]=0;A[2]=0;A[3]=t[1];A[4]=0;A[5]=0;return A}function w(A,t){A[0]=1;A[1]=0;A[2]=0;A[3]=1;A[4]=t[0];A[5]=t[1];return A}function q(A){return"mat2d("+A[0]+", "+A[1]+", "+A[2]+", "+A[3]+", "+A[4]+", "+A[5]+")"}function m(A){return Math.sqrt(Math.pow(A[0],2)+Math.pow(A[1],2)+Math.pow(A[2],2)+Math.pow(A[3],2)+Math.pow(A[4],2)+Math.pow(A[5],2)+1)}function u(A,t,D){A[0]=t[0]+D[0];A[1]=t[1]+D[1];A[2]=t[2]+D[2];A[3]=t[3]+D[3];A[4]=
t[4]+D[4];A[5]=t[5]+D[5];return A}function v(A,t,D){A[0]=t[0]-D[0];A[1]=t[1]-D[1];A[2]=t[2]-D[2];A[3]=t[3]-D[3];A[4]=t[4]-D[4];A[5]=t[5]-D[5];return A}function y(A,t,D){A[0]=t[0]*D;A[1]=t[1]*D;A[2]=t[2]*D;A[3]=t[3]*D;A[4]=t[4]*D;A[5]=t[5]*D;return A}function B(A,t,D,E){A[0]=t[0]+D[0]*E;A[1]=t[1]+D[1]*E;A[2]=t[2]+D[2]*E;A[3]=t[3]+D[3]*E;A[4]=t[4]+D[4]*E;A[5]=t[5]+D[5]*E;return A}function x(A,t){return A[0]===t[0]&&A[1]===t[1]&&A[2]===t[2]&&A[3]===t[3]&&A[4]===t[4]&&A[5]===t[5]}function C(A,t){const D=
A[0],E=A[1],G=A[2],H=A[3],I=A[4];A=A[5];const J=t[0],K=t[1],L=t[2],S=t[3],M=t[4];t=t[5];return Math.abs(D-J)<=k.EPSILON*Math.max(1,Math.abs(D),Math.abs(J))&&Math.abs(E-K)<=k.EPSILON*Math.max(1,Math.abs(E),Math.abs(K))&&Math.abs(G-L)<=k.EPSILON*Math.max(1,Math.abs(G),Math.abs(L))&&Math.abs(H-S)<=k.EPSILON*Math.max(1,Math.abs(H),Math.abs(S))&&Math.abs(I-M)<=k.EPSILON*Math.max(1,Math.abs(I),Math.abs(M))&&Math.abs(A-t)<=k.EPSILON*Math.max(1,Math.abs(A),Math.abs(t))}var z=Object.freeze({__proto__:null,
copy:a,identity:r,set:l,invert:h,determinant:d,multiply:c,rotate:e,scale:f,translate:g,fromRotation:p,fromScaling:n,fromTranslation:w,str:q,frob:m,add:u,subtract:v,multiplyScalar:y,multiplyScalarAndAdd:B,exactEquals:x,equals:C,mul:c,sub:v});b.add=u;b.copy=a;b.determinant=d;b.equals=C;b.exactEquals=x;b.frob=m;b.fromRotation=p;b.fromScaling=n;b.fromTranslation=w;b.identity=r;b.invert=h;b.mat2d=z;b.mul=c;b.multiply=c;b.multiplyScalar=y;b.multiplyScalarAndAdd=B;b.rotate=e;b.scale=f;b.set=l;b.str=q;b.sub=
v;b.subtract=v;b.translate=g})},"esri/chunks/mat2df64":function(){define(["exports"],function(b){function k(){return[1,0,0,1,0,0]}function a(d){return[d[0],d[1],d[2],d[3],d[4],d[5]]}function r(d,c,e,f,g,p){return[d,c,e,f,g,p]}function l(d,c){return new Float64Array(d,c,6)}var h=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,createView:l});b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.mat2df64=h})},"esri/views/2d/viewpointUtils":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../geometry/support/spatialReferenceUtils ../../geometry/SpatialReference ../../geometry/Geometry ../../geometry/support/Ellipsoid ../../geometry/support/webMercatorUtils ../../geometry/Point ../../geometry/Extent ../../core/Collection ../../chunks/common ../../core/unitUtils ../../Viewpoint ../../chunks/vec2f64 ../../chunks/vec2 ../../chunks/mat2d ../../chunks/mat2df64".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){function y(da,fa,ea,Y){return Y&&ea&&!Y.equals(ea)&&c.canProject(Y,ea)&&Y.isWebMercator?(Y.isWebMercator?(ea=fa[1],89.99999<ea?ea=89.99999:-89.99999>ea&&(ea=-89.99999),ea=Math.sin(p.toRadian(ea)),da=m.set(da,p.toRadian(fa[0])*d.earth.radius,.5*d.earth.radius*Math.log((1+ea)/(1-ea)))):(ea=p.toDegree(fa[0]/d.earth.radius),da=m.set(da,ea-360*Math.floor((ea+180)/360),p.toDegree(.5*Math.PI-2*Math.atan(Math.exp(-1*fa[1]/d.earth.radius))))),da):m.copy(da,fa)}
function B(da){return da.wkid?da:da.spatialReference||l.WGS84}function x(da,fa){return fa.type?m.set(da,fa.x,fa.y):m.copy(da,fa)}function C(da,fa){return Math.max(da.width/fa[0],da.height/fa[1])*I(da.spatialReference)}async function z(da,fa,ea,Y){if(!da||Array.isArray(da)&&!da.length)return null;g.isCollection(da)&&(da=da.toArray());if(Array.isArray(da)&&da.length&&"object"===typeof da[0]){var Z=da.every(na=>"attributes"in na);var ba=da.some(na=>!na.geometry),ia=da;if(Z&&ba&&fa&&fa.allLayerViews){Z=
new Map;for(var ja of da)da=ja.layer,ba=Z.get(da)||[],ia=ja.attributes[da.objectIdField],null!=ia&&ba.push(ia),Z.set(da,ba);const na=[];Z.forEach((oa,ua)=>{const za=fa.allLayerViews.find(Fa=>Fa.layer.id===ua.id);if("queryFeatures"in za){const Fa=ua.createQuery();Fa.objectIds=oa;Fa.returnGeometry=!0;na.push(za.queryFeatures(Fa))}});ja=await a.all(na);da=[];for(var la of ja)if(la&&la.features&&la.features.length)for(var qa of la.features)k.isSome(qa.geometry)&&da.push(qa.geometry);ia=da}for(const na of ia)Y=
await z(na,fa,ea,Y);return Y}if(Array.isArray(da)&&2===da.length&&"number"===typeof da[0]&&"number"===typeof da[1])Z=new e(da);else if(da instanceof h)Z=da;else if("geometry"in da)if(da.geometry)Z=da.geometry;else if(da.layer){const na=da.layer;la=fa.allLayerViews.find(oa=>oa.layer.id===na.id);"queryFeatures"in la&&(qa=na.createQuery(),qa.objectIds=[da.attributes[na.objectIdField]],qa.returnGeometry=!0,la=await la.queryFeatures(qa),Z=k.get(la,"features",0,"geometry"))}if(k.isNone(Z))return null;la=
"point"===Z.type?new f({xmin:Z.x,ymin:Z.y,xmax:Z.x,ymax:Z.y,spatialReference:Z.spatialReference}):Z.extent;if(!la)return null;qa=c.canProject(la,ea);if(!la.spatialReference.equals(ea)&&qa)la=c.project(la,ea);else if(!qa)return null;return Y=Y?Y.union(la):la.clone()}function A(da){if(da&&(!Array.isArray(da)||"number"!==typeof da[0])&&("object"===typeof da||Array.isArray(da)&&"object"===typeof da[0])){if("layer"in da&&da.layer&&da.layer.minScale&&da.layer.maxScale){var fa=da.layer;return{min:fa.minScale,
max:fa.maxScale}}if(Array.isArray(da)&&da.length&&da.every(ea=>"layer"in ea)){let ea=fa=0;for(const Y of da)(da=Y.layer)&&da.minScale&&da.maxScale&&(fa=da.minScale<fa?da.minScale:fa,ea=da.maxScale>ea?da.maxScale:ea);return fa&&ea?{min:fa,max:ea}:null}}}async function t(da,fa){if(!da||!fa)return new w({targetGeometry:new e,scale:0,rotation:0});let ea=fa.spatialReference;const {constraints:Y,padding:Z,viewpoint:ba,size:ia}=fa,ja=[Z?ia[0]-Z.left-Z.right:ia[0],Z?ia[1]-Z.top-Z.bottom:ia[1]];let la=null;
da instanceof w?la=da:da.viewpoint?la=da.viewpoint:da.target&&"esri.Viewpoint"===da.target.declaredClass&&(la=da.target);let qa=null;if(la&&la.targetGeometry)qa=la.targetGeometry;else if(da instanceof f)qa=da;else if(da||da&&("center"in da||"extent"in da||"target"in da))qa=await z(da.center,fa,ea)||await z(da.extent,fa,ea)||await z(da.target,fa,ea)||await z(da,fa,ea);!qa&&ba&&ba.targetGeometry?qa=ba.targetGeometry:!qa&&fa.extent&&(qa=fa.extent);var na=B(qa);ea||(ea=B(fa.spatialReference||fa.extent||
qa));if(!c.canProject(qa,ea)&&na&&!na.equals(ea))return null;var oa=x(q.create(),qa.center?qa.center:qa);na=new e(y(oa,oa,na,ea),ea);oa=null;oa=la&&k.isSome(la.targetGeometry)&&"point"===la.targetGeometry.type?la.scale:da.hasOwnProperty("scale")&&da.scale?da.scale:da.hasOwnProperty("zoom")&&-1!==da.zoom&&Y&&Y.effectiveLODs?Y.zoomToScale(da.zoom):Array.isArray(qa)||"point"===qa.type||"extent"===qa.type&&0===qa.width&&0===qa.height?fa.extent&&c.canProject(fa.extent,ea)?C(c.project(fa.extent,ea),ja):
fa.extent?C(fa.extent,ja):ba.scale:c.canProject(qa.extent,ea)?C(c.project(qa.extent,ea),ja):C(qa.extent,ja);if(fa=A(da))fa.min&&fa.min>oa?oa=fa.min:fa.max&&fa.max<oa&&(oa=fa.max);fa=0;la?fa=la.rotation:da.hasOwnProperty("rotation")?fa=da.rotation:ba&&(fa=ba.rotation);da=new w({targetGeometry:na,scale:oa,rotation:fa});Y&&(da=Y.fit(da),Y.constrainByGeometry(da),Y.rotationEnabled||(da.rotation=fa));return da}function D(da,fa){const ea=da.targetGeometry,Y=fa.targetGeometry;ea.x=Y.x;ea.y=Y.y;ea.spatialReference=
Y.spatialReference;da.scale=fa.scale;da.rotation=fa.rotation;return da}function E(da,fa,ea){return ea?m.set(da,.5*(fa[0]-ea.right+ea.left),.5*(fa[1]-ea.bottom+ea.top)):m.scale(da,fa,.5)}function G(da,fa,ea,Y){O(da,fa,ea,Y);return u.invert(da,da)}function H(da){var fa=da.scale;da=da.targetGeometry;da=k.isSome(da)&&r.isValid(da.spatialReference)?1/(39.37*n.getMetersPerUnitForSR(da.spatialReference)*96):1;return fa*da}function I(da){return r.isValid(da)?39.37*n.getMetersPerUnitForSR(da)*96:1}function J(da){return da.isWrappable?
(da=r.getInfo(da),da.valid[1]-da.valid[0]):0}const K=180/Math.PI,L=function(){const da=q.create();return function(fa,ea,Y){const Z=ea.targetGeometry;x(da,Z);ea=.5*H(ea);fa.xmin=da[0]-ea*Y[0];fa.ymin=da[1]-ea*Y[1];fa.xmax=da[0]+ea*Y[0];fa.ymax=da[1]+ea*Y[1];fa.spatialReference=Z.spatialReference;return fa}}(),S=function(){const da=q.create();return function(fa,ea,Y){return m.sub(fa,m.scale(fa,ea,.5),E(da,ea,Y))}}(),M=function(){const da=v.create(),fa=q.create();return function(ea,Y,Z,ba){const ia=
H(Y);Y=p.toRadian(Y.rotation)||0;m.set(fa,ia,ia);u.fromScaling(da,fa);u.rotate(da,da,Y);u.translate(da,da,S(fa,Z,ba));u.translate(da,da,[0,ba.top-ba.bottom]);return m.set(ea,da[4],da[5])}}(),T=function(){const da=q.create(),fa=q.create(),ea=q.create();return function(Y,Z,ba,ia,ja,la){m.negate(da,Z);m.scale(fa,ba,.5*la);m.set(ea,1/ia*la,-1/ia*la);u.identity(Y);u.translate(Y,Y,fa);ja&&u.rotate(Y,Y,ja);u.scale(Y,Y,ea);u.translate(Y,Y,da);return Y}}(),O=function(){const da=q.create();return function(fa,
ea,Y,Z){const ba=H(ea),ia=p.toRadian(ea.rotation)||0;x(da,ea.targetGeometry);return T(fa,da,Y,ba,ia,Z)}}(),Q=function(){const da=q.create();return function(fa,ea,Y,Z){const ba=H(ea);x(da,ea.targetGeometry);return T(fa,da,Y,ba,0,Z)}}(),F=function(){const da=q.create(),fa=q.create(),ea=[0,0,0];return function(Y,Z,ba){m.subtract(da,Y,Z);m.normalize(da,da);m.subtract(fa,Y,ba);m.normalize(fa,fa);m.cross(ea,da,fa);Y=Math.acos(m.dot(da,fa)/(m.length(da)*m.length(fa)))*K;0>ea[2]&&(Y=-Y);isNaN(Y)&&(Y=0);return Y}}(),
N=function(){const da=q.create();return function(fa,ea,Y,Z){const ba=fa.targetGeometry;D(fa,ea);M(da,ea,Y,Z);ba.x+=da[0];ba.y+=da[1];return fa}}(),P=function(){const da=q.create();return function(fa,ea,Y,Z){const ba=fa.targetGeometry;D(fa,ea);M(da,ea,Y,Z);ba.x-=da[0];ba.y-=da[1];return fa}}(),U=function(){const da=q.create();return function(fa,ea,Y){D(fa,ea);ea=fa.targetGeometry;const Z=B(Y),ba=B(ea);x(da,Y);y(da,da,Z,ba);ea.x=da[0];ea.y=da[1];return fa}}(),V=function(){const da=q.create();return function(fa,
ea,Y,Z,ba){ba||(ba="center");m.sub(da,Y,Z);m.scale(da,da,.5);Y=da[0];Z=da[1];switch(ba){case "center":m.set(da,0,0);break;case "left":m.set(da,-Y,0);break;case "top":m.set(da,0,Z);break;case "right":m.set(da,Y,0);break;case "bottom":m.set(da,0,-Z);break;case "top-left":m.set(da,-Y,Z);break;case "bottom-left":m.set(da,-Y,-Z);break;case "top-right":m.set(da,Y,Z);break;case "bottom-right":m.set(da,Y,-Z)}ka(fa,ea,da);return fa}}(),W=function(){const da=q.create();return function(fa,ea,Y,Z,ba){D(fa,ea);
isNaN(Y)||0===Y||(R(da,Z,ea,ba),fa.scale=ea.scale*Y,aa(da,da,fa,ba),ka(fa,fa,m.set(da,da[0]-Z[0],Z[1]-da[1])));return fa}}(),X=function(){const da=q.create();return function(fa,ea,Y,Z,ba,ia){D(fa,ea);isNaN(Y)||0===Y||(R(da,ba,ea,ia),fa.scale=ea.scale*Y,fa.rotation+=Z,aa(da,da,fa,ia),ka(fa,fa,m.set(da,da[0]-ba[0],ba[1]-da[1])));return fa}}(),ca=function(){const da=q.create(),fa=q.create();return function(ea,Y,Z,ba,ia,ja,la){S(fa,ja,la);m.add(da,ia,fa);return ba?X(ea,Y,Z,ba,da,ja):W(ea,Y,Z,da,ja)}}(),
R=function(){const da=v.create();return function(fa,ea,Y,Z){return m.transformMat2d(fa,ea,G(da,Y,Z,1))}}(),aa=function(){const da=v.create();return function(fa,ea,Y,Z){return m.transformMat2d(fa,ea,O(da,Y,Z,1))}}(),ka=function(){const da=q.create(),fa=v.create();return function(ea,Y,Z){D(ea,Y);const ba=H(Y),ia=ea.targetGeometry;u.fromRotation(fa,p.toRadian(Y.rotation)||0);u.scale(fa,fa,q.fromValues(ba,ba));m.transformMat2d(da,Z,fa);ia.x+=da[0];ia.y+=da[1];return ea}}();b.addPadding=N;b.angleBetween=
F;b.centerAt=U;b.copy=D;b.create=t;b.createAsync=function(da,fa){return t(da,fa)};b.extentToScale=C;b.getAnchor=E;b.getExtent=L;b.getMatrix=T;b.getOuterSize=function(da,fa,ea){var Y=p.toRadian(fa.rotation)||0;fa=Math.abs(Math.cos(Y));Y=Math.abs(Math.sin(Y));return m.set(da,Math.round(ea[1]*Y+ea[0]*fa),Math.round(ea[1]*fa+ea[0]*Y))};b.getPaddingMapTranslation=M;b.getPaddingScreenTranslation=S;b.getResolution=H;b.getResolutionToScaleFactor=I;b.getTransform=O;b.getTransformNoRotation=Q;b.getWorldScreenWidth=
function(da,fa){return Math.round(J(da)/fa)};b.getWorldWidth=J;b.padAndScaleAndRotateBy=ca;b.pixelSize=function(da){return H(da)};b.removePadding=P;b.resize=V;b.rotateBy=function(da,fa,ea){D(da,fa);da.rotation+=ea;return da};b.rotateTo=function(da,fa,ea){D(da,fa);da.rotation=ea;return da};b.scaleAndRotateBy=X;b.scaleBy=W;b.scaleTo=function(da,fa,ea){D(da,fa);da.scale=ea;return da};b.setExtent=function(da,fa,ea,Y,Z){U(da,fa,ea.center);da.scale=C(ea,Y);Z&&Z.constraints&&Z.constraints.constrain(da);
return da};b.toMap=R;b.toScreen=aa;b.translateBy=ka;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/mat2df32":function(){define(["exports"],function(b){function k(){const e=new Float32Array(6);e[0]=1;e[3]=1;return e}function a(e){const f=new Float32Array(6);f[0]=e[0];f[1]=e[1];f[2]=e[2];f[3]=e[3];f[4]=e[4];f[5]=e[5];return f}function r(e,f,g,p,n,w){const q=new Float32Array(6);q[0]=e;q[1]=f;q[2]=g;q[3]=p;q[4]=n;q[5]=w;return q}function l(e,f){return new Float32Array(e,f,6)}function h(e,
f,g,p){const n=f[p];f=f[p+1];e[p]=g[0]*n+g[2]*f+g[4];e[p+1]=g[1]*n+g[3]*f+g[5]}function d(e,f,g,p=0,n=0,w=2){for(n=n||f.length/w;p<n;p++)h(e,f,g,p*w)}var c=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,createView:l,transform:h,transformMany:d});b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.mat2df32=c;b.transform=h;b.transformMany=d})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(b){function k(r){return r instanceof Float32Array&&2<=r.length}function a(r){return Array.isArray(r)&&
2<=r.length}b.isVec2=function(r){return k(r)||a(r)};b.isVec2f32=k;b.isVec2f64=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState ../../../chunks/BlendLayers.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){h=function(p){function n(){return p.apply(this,arguments)||this}a._inheritsLoose(n,p);var w=n.prototype;w.initializeProgram=function(q){const m=n.shader.get().build();return new e(q.rctx,m.generateSource("vertex"),m.generateSource("fragment"),c.Default3D)};w.initializePipeline=function(){const q=2===this.configuration.mode?f.simpleBlendingParams(1,771):1===this.configuration.mode?f.simpleBlendingParams(0,770):null;return f.makePipelineState({blending:q,colorWrite:f.defaultColorWriteParams})};
return n}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(g.BlendLayersShader,()=>new Promise(function(p,n){b(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],p,n)}));l=function(p){function n(){var w=p.apply(this,arguments)||this;w.mode=0;return w}a._inheritsLoose(n,p);return n}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter({count:3})],l.prototype,"mode",void 0);k.BlendLayersTechnique=h;k.BlendLayersTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",{value:!0})})},
"esri/chunks/BlendLayers.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(b,k,a){function r(){const h=new a.ShaderBuilder;h.attributes.add("position","vec2");h.attributes.add("uv0","vec2");h.vertex.uniforms.add("scale","float");h.vertex.uniforms.add("offset","vec2");h.varyings.add("uv","vec2");h.vertex.code.add(k.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      uv = uv0 * scale + offset;
    }
  `);h.fragment.uniforms.add("tex","sampler2D");h.fragment.uniforms.add("opacity","float");h.fragment.code.add(k.glsl`
    void main() {
      vec4 color = texture2D(tex, uv);

      // Note: output in pre-multiplied alpha for correct alpha compositing
      gl_FragColor = vec4(color.xyz, 1.0) * color.a * opacity;
    }
  `);return h}var l=Object.freeze({__proto__:null,build:r});b.BlendLayersShader=l;b.build=r})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/maybe ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/Program ../../webgl/renderState ../../webgl/rasterUtils ../../../chunks/RasterColorizer.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){d=function(w){function q(){return w.apply(this,arguments)||this}a._inheritsLoose(q,w);var m=q.prototype;m.initializeProgram=function(u){var v=q.shader.get();const y=this.configuration;v=v.build({output:y.colorizerType,applyColormap:y.applyColormap});this._context=u.rctx;return new f(u.rctx,v.generateSource("vertex"),v.generateSource("fragment"),e.Default3D)};m.initializePipeline=function(){const u=2===this.configuration.mode?g.simpleBlendingParams(1,771):1===this.configuration.mode?
g.simpleBlendingParams(0,770):null;return g.makePipelineState({blending:u,colorWrite:g.defaultColorWriteParams})};m.bindPass=function(u,v){p.setUniforms(this.program,this.uniformLocationInfos,v.basic);p.setUniforms(this.program,this.uniformLocationInfos,v.common);l.isSome(v.colormap)&&p.setUniforms(this.program,this.uniformLocationInfos,v.colormap);0===this.configuration.colorizerType&&l.isSome(v.stretch)?p.setUniforms(this.program,this.uniformLocationInfos,v.stretch):2===this.configuration.colorizerType&&
l.isSome(v.hillshade)&&p.setUniforms(this.program,this.uniformLocationInfos,v.hillshade)};a._createClass(q,[{key:"uniformLocationInfos",get:function(){this._uniformLocationInfos||(this._uniformLocationInfos=p.getUniformLocationInfos(this._context,this.program));return this._uniformLocationInfos}}]);return q}(d.ShaderTechnique);d.shader=new h.ReloadableShaderModule(n.RasterColorizerShader,()=>new Promise(function(w,q){b(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],w,q)}));h=function(w){function q(){var m=
w.apply(this,arguments)||this;m.mode=2;m.colorizerType=0;m.applyColormap=!0;return m}a._inheritsLoose(q,w);return q}(c.ShaderTechniqueConfiguration);r.__decorate([c.parameter({count:3})],h.prototype,"mode",void 0);r.__decorate([c.parameter({count:3})],h.prototype,"colorizerType",void 0);r.__decorate([c.parameter()],h.prototype,"applyColormap",void 0);k.RasterColorizerTechnique=d;k.RasterColorizerTechniqueConfiguration=h;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl".split(" "),
function(b,k,a,r,l,h,d){function c(f){const g=new a.ShaderBuilder;g.include(l.BasicGrid);g.include(d.Common);g.include(h.Colormap);0===f.output?(f=f.applyColormap,g.fragment.uniforms.add("u_bandCount","int"),g.fragment.uniforms.add("u_minCutOff","float",3),g.fragment.uniforms.add("u_maxCutOff","float",3),g.fragment.uniforms.add("u_factor","float",3),g.fragment.uniforms.add("u_minOutput","float"),g.fragment.uniforms.add("u_maxOutput","float"),g.fragment.uniforms.add("u_useGamma","bool"),g.fragment.uniforms.add("u_gamma",
"float",3),g.fragment.uniforms.add("u_gammaCorrection","float",3),g.fragment.code.add(k.glsl`
      float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
        // clamp values
        if (val >= maxCutOff) {
          return maxOutput;
        } else if (val <= minCutOff) {
          return minOutput;
        }

        // stretch a single value based on whether to use gamma
        float stretchedVal;
        if (useGamma) {
          float tempf = 1.0;
          float outRange = maxOutput - minOutput;
          float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
          if (gamma > 1.0) {
            tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
          }
          stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
        } else {
          stretchedVal = minOutput + (val - minCutOff) * factor;
        }
        return stretchedVal;
      }
    `),f=f?k.glsl`gl_FragColor = colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma);`:k.glsl`gl_FragColor = vec4(grayVal, grayVal, grayVal, 1.0) * currentPixel.a * u_opacity;`,g.fragment.code.add(k.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        if (currentPixel.a == 0.0) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${f}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = vec4(redVal, greenVal, blueVal, 1.0) * currentPixel.a * u_opacity;
        }
      }
    `)):1===f.output?g.fragment.code.add(k.glsl`
      void main() {
        // get pixel location
        vec2 pixelLocation = getPixelLocation(v_texcoord);
        if (isOutside(pixelLocation)) {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        // apply colormap we use float texture here
        gl_FragColor = colormap(currentPixel, true);
      }
    `):2===f.output&&(f=f.applyColormap,g.fragment.uniforms.add("u_hillshadeType","int"),g.fragment.uniforms.add("u_sinZcosAs","float",6),g.fragment.uniforms.add("u_sinZsinAs","float",6),g.fragment.uniforms.add("u_cosZs","float",6),g.fragment.uniforms.add("u_weights","float",6),g.fragment.uniforms.add("u_factor","vec2"),g.fragment.uniforms.add("u_applyColormap","bool"),g.fragment.uniforms.add("u_minValue","float"),g.fragment.uniforms.add("u_maxValue","float"),g.fragment.uniforms.add("u_srcImageSize",
"vec2"),g.fragment.include(r.ColorConversion),g.fragment.code.add(k.glsl`
  vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
    val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
    vec4 rgb = colormap(vec4(val, val, val, 1.0), false);
    vec3 hsv = rgb2hsv(rgb.xyz);
    hsv.z = hillshade;
    return vec4(hsv2rgb(hsv) * alpha, alpha);
  }
`),g.fragment.code.add(k.glsl`
    float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
      if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
        return 0.0;
      }  else {
        return e;
      }
    }
  `),f=f?k.glsl`gl_FragColor = overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha);`:k.glsl`
       hillshade *= alpha;
       gl_FragColor = vec4(hillshade, hillshade, hillshade, alpha);
       `,g.fragment.code.add(k.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(v_texcoord);
      if (isOutside(pixelLocation)) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${f}
    }
  `));return g}var e=Object.freeze({__proto__:null,build:c});b.RasterColorizerShader=e;b.build=c})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/BasicGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.BasicGrid=function(a){a.attributes.add("position","vec2");a.attributes.add("uv0","vec2");a.vertex.uniforms.add("u_scale","float");a.vertex.uniforms.add("u_offset","vec2");a.varyings.add("v_texcoord","vec2");a.vertex.code.add(k.glsl`
    void main(void) {
      v_texcoord = uv0 * u_scale + u_offset;
      gl_Position = vec4(position, 0.0, 1.0);
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.Colormap=function(a){a.fragment.uniforms.add("u_colormap","sampler2D");a.fragment.uniforms.add("u_colormapOffset","float");a.fragment.uniforms.add("u_colormapMaxIndex","float");a.fragment.code.add(k.glsl`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      // colormap is only applicable to integer data but could be already normalized to 0-1 float
      float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
        vec4 color = texture2D(u_colormap, clrPosition);
        result = vec4(color.rgb, 1.0) * color.a * u_opacity;
      }
      return result;
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define(["exports","../../shaderModules/interfaces","./Projection.glsl"],function(b,k,a){b.Common=function(r){r.include(a.Projection);r.fragment.uniforms.add("u_image","sampler2D");r.fragment.uniforms.add("u_isFloatTexture","bool");r.fragment.uniforms.add("u_flipY","bool");r.fragment.uniforms.add("u_applyTransform","bool");r.fragment.uniforms.add("u_opacity","float");
r.fragment.code.add(k.glsl`
    vec2 getPixelLocation(vec2 coords) {
      vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
      if (!u_applyTransform) {
        return targetLocation;
      }
      return projectPixelLocation(targetLocation);
    }

    bool isOutside(vec2 coords){
      if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
        return true;
      } else {
        return false;
      }
    }

    vec4 getPixel(vec2 pixelLocation) {
      return texture2D(u_image, pixelLocation);
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.Projection=function(a){a.fragment.uniforms.add("u_transformGrid","sampler2D");a.fragment.uniforms.add("u_transformSpacing","vec2");a.fragment.uniforms.add("u_transformGridSize","vec2");a.fragment.uniforms.add("u_targetImageSize","vec2");a.fragment.code.add(k.glsl`
    vec2 projectPixelLocation(vec2 coords) {
      // pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // pixel's corresponding cell index in transform grid
      // each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
      vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;

      // correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
      vec2 srcLocation;
      // pixel's corresponding transform cell location, center cell coordinates
      vec2 transform_location = index_transform + oneTransformPixel * 0.5;

      // use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
        vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
        srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
      } else {
        vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
        vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
        srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
      }
      return srcLocation;;
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/support/FBOPool":function(){define(["exports","../../../../core/ObjectPool","../../../webgl/FramebufferObject"],function(b,k,a){let r=function(){function l(d){this.renderingContext=d;this._pools=new Map}var h=l.prototype;h.acquire=function(d){return this.getPool(d).acquire()};h.release=function(d){this.getPool(d.width).release(d)};h.clear=function(){this._pools.forEach(d=>{d.destroy()});this._pools.clear()};h.getPool=
function(d){var c=this._pools.get(d);c||(c=a.bind(a,this.renderingContext,{colorTarget:0,depthStencilTarget:1,width:d,height:d}),c=new k(c),this._pools.set(d,c));return c};return l}();b.FBOPool=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../lib/StencilUtils ../../../../chunks/Terrain.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p){h=function(n){function w(){return n.apply(this,arguments)||this}a._inheritsLoose(w,n);var q=w.prototype;q.initializeProgram=function(m){var u=w.shader.get();const v=this.configuration;u=u.build({overlayMode:v.overlayMode,output:v.output,viewingMode:m.viewingMode,slicePlaneEnabled:v.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,textureFadingEnabled:v.textureFadingEnabled&&!v.renderOccluded,receiveShadows:v.receiveShadows&&!v.renderOccluded,
receiveAmbientOcclusion:!1,useOldSceneLightInterface:!0,atmosphere:v.atmosphere,tileBorders:v.tileBorders,screenSizePerspective:v.screenSizePerspective,pbrMode:0,ssrEnabled:v.ssrEnabled,highStepCount:!1});return new e(m.rctx,u.generateSource("vertex"),u.generateSource("fragment"),c.Default3D)};q.initializePipeline=function(){const m=this.configuration,u=m.backfaceCullingEnabled&&!m.renderOccluded;return f.makePipelineState({blending:m.renderOccluded?f.simpleBlendingParams(1,771):null,culling:u&&f.backFaceCullingParams,
depthTest:!m.renderOccluded&&{func:513},depthWrite:!m.renderOccluded&&f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams,stencilTest:m.stencilEnabled?g.renderWhenBitIsNotSet(1):null})};return w}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(p.TerrainShader,()=>new Promise(function(n,w){b(["../core/shaderLibrary/terrain/Terrain.glsl"],n,w)}));l=function(n){function w(){var q=n.apply(this,arguments)||this;q.output=0;q.overlayMode=0;q.atmosphere=!1;q.receiveShadows=!1;q.slicePlaneEnabled=
!1;q.backfaceCullingEnabled=!1;q.stencilEnabled=!1;q.textureFadingEnabled=!1;q.renderOccluded=!1;q.ssrEnabled=!1;q.tileBorders=!1;q.screenSizePerspective=!1;return q}a._inheritsLoose(w,n);return w}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter({count:8})],l.prototype,"output",void 0);r.__decorate([d.parameter({count:3})],l.prototype,"overlayMode",void 0);r.__decorate([d.parameter()],l.prototype,"atmosphere",void 0);r.__decorate([d.parameter()],l.prototype,"receiveShadows",void 0);r.__decorate([d.parameter()],
l.prototype,"slicePlaneEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"backfaceCullingEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"stencilEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"textureFadingEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"renderOccluded",void 0);r.__decorate([d.parameter()],l.prototype,"ssrEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"tileBorders",void 0);r.__decorate([d.parameter()],l.prototype,"screenSizePerspective",
void 0);k.TerrainTechnique=h;k.TerrainTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/Terrain.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){function q(u){const v=new r.ShaderBuilder;v.include(f.HeaderComment,{name:"Terrain Shader",output:u.output});v.include(n.Skirts);v.attributes.add("position","vec3");v.attributes.add("uv0","vec2");v.vertex.uniforms.add("proj","mat4").add("view","mat4").add("origin","vec3").add("skirtScale","float");if(0===u.output){v.include(a.Transform,{linearDepth:!1});v.include(c.NormalUtils,u);v.include(w.TerrainTexture,u);const y=0!==u.overlayMode,B=2===u.overlayMode;y&&v.include(p.Overlay,
{pbrMode:3,useCustomDTRExponentForWater:!1,ssrEnabled:u.ssrEnabled,highStepCount:u.highStepCount});B&&v.include(g.VertexTangent,u);v.varyings.add("vnormal","vec3");v.varyings.add("vpos","vec3");v.vertex.uniforms.add("viewNormal","mat4");u.receiveShadows&&v.varyings.add("linearDepth","float");u.tileBorders&&v.varyings.add("vuv","vec2");u.atmosphere&&(v.vertex.uniforms.add("lightingMainDirection","vec3"),v.varyings.add("wnormal","vec3"),v.varyings.add("wlight","vec3"));u.screenSizePerspective&&(v.vertex.uniforms.add("screenSizePerspective",
"vec4"),v.varyings.add("screenSizeDistanceToCamera","float"),v.varyings.add("screenSizeCosAngle","float"));v.vertex.code.add(k.glsl`
      void main(void) {
        vpos = position;
        vnormal = getLocalUp(vpos, origin);

        vec2 uv = uv0;
        vpos = applySkirts(uv, vpos, vnormal, skirtScale);
        ${u.atmosphere?k.glsl`
        wnormal = (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;
        wlight = (view  * vec4(-lightingMainDirection, 1.0)).xyz;`:""}
        ${u.tileBorders?k.glsl`vuv = uv;`:""}
        ${u.screenSizePerspective?k.glsl`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${u.receiveShadows?k.glsl`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${y?k.glsl`setOverlayVTC(uv);`:""}
        ${B?k.glsl`forwardVertexTangent(vnormal);`:k.glsl``}
      }
    `);v.extensions.add("GL_OES_standard_derivatives");v.extensions.add("GL_EXT_shader_texture_lod");v.include(l.Slice,u);v.include(e.EvaluateSceneLighting,u);v.fragment.uniforms.add("camPos","vec3").add("viewDirection","vec3").add("ssaoTex","sampler2D").add("viewportPixelSz","vec4").add("opacity","float");u.screenSizePerspective&&v.fragment.uniforms.add("screenSizePerspective","vec4");B&&(v.fragment.uniforms.add("ovInnerWaterTex","sampler2D"),v.fragment.uniforms.add("ovOuterWaterTex","sampler2D"),
v.fragment.uniforms.add("view","mat4"));v.fragment.code.add(k.glsl`
      const vec3 ambient = vec3(0.2, 0.2, 0.2);
      const vec3 diffuse = vec3(0.8, 0.8, 0.8);
      const float diffuseHardness = 2.5;
      const float sliceOpacity = 0.2;

      float lum(vec3 c) {
        float max = max(max(c.r, c.g), c.b);
        float min = min(min(c.r, c.g), c.b);
        return (min + max) * 0.5;
      }
      `);u.atmosphere&&v.fragment.code.add(k.glsl`
      vec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {
        vec3 surfaceColor   = vec3(0.0);
        vec3 fuzzySpecColor = vec3(1.0);
        vec3 subColor       = vec3(0.0);
        float rollOff       = 1.0;

        vec3 Ln = normalize(lightPos);
        vec3 Nn = normalize(normal);
        vec3 Hn = normalize(view + Ln);

        float ldn = dot(Ln, Nn);
        float diffComp = max(0.0, ldn);
        // clamp necessary here because values might cause flickering: #21549
        float vdn = clamp(1.0 - dot(view, Nn), 0.0, 1.0);
        float ndv = dot(view, Ln);

        vec3 diffContrib = surfaceColor * diffComp;
        float subLamb = max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));

        vec3 subContrib = subLamb * subColor;
        vec3 vecColor = vec3(vdn);

        vec3 diffuseContrib = (subContrib + diffContrib);
        vec3 specularContrib = (vecColor * fuzzySpecColor);

        return (diffContrib + specularContrib) * rollOff;
      }
      `);v.fragment.code.add(k.glsl`
      void main() {
        ${u.receiveShadows?k.glsl`float shadow = readShadowMap(vpos, linearDepth);`:k.glsl`float shadow = 0.0;`}
        float vndl = dot(normalize(vnormal), -lightingMainDirection);
        float k = smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));
        vec3 d = (1.0 - shadow/1.8) * diffuse * k;

        float ssao = viewportPixelSz.w < .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
        vec4 tileColor = getTileColor() * opacity;
        ${y?k.glsl`
            vec4 overlayColorOpaque = getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        vec3 atm = vec3(0.0);
        ${u.atmosphere?k.glsl`
            float ndotl = max(0.0, min(1.0, vndl));
            atm = atmosphere(wlight, wnormal, -viewDirection);
            atm *= max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps
            atm *= max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}
        vec3 albedo = atm + tileColor.rgb;
        vec3 normal = normalize(vnormal);

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        gl_FragColor = vec4(evaluateSceneLightingExt(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${B?k.glsl`
            vec4 overlayWaterMask = getOverlayColor(ovInnerWaterTex, ovOuterWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - camPos), shadow, vnormal, tbnMatrix, viewPosition.xyz);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${u.screenSizePerspective?k.glsl`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${u.tileBorders?k.glsl`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}if(1===u.output||3===u.output)v.include(a.Transform,{linearDepth:!0}),v.include(d.OutputDepth,{output:u.output}),v.include(c.NormalUtils,u),v.varyings.add("linearDepth","float"),v.vertex.uniforms.add("nearFar","vec2"),v.vertex.code.add(k.glsl`
        void main(void) {
          vec3 normal = getLocalUp(position, origin);
          vec2 uv = uv0;
          vec3 vpos = applySkirts(uv, position, normal.xyz, skirtScale);

          gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);
        }
    `),v.fragment.code.add(k.glsl`
        void main() {
          outputDepth(linearDepth);
        }
    `);2===u.output&&(v.include(a.Transform,{linearDepth:!1}),v.include(c.NormalUtils,u),v.varyings.add("vnormal","vec3"),v.varyings.add("vpos","vec3"),v.vertex.uniforms.add("viewNormal","mat4"),v.vertex.code.add(k.glsl`
        void main(void) {
          vec3 normal = getLocalUp(position, origin);
          vec2 uv = uv0;
          vpos = applySkirts(uv, position, normal, skirtScale);

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),v.fragment.code.add(k.glsl`
        void main() {
          vec3 normal = normalize(vnormal);
          if (gl_FrontFacing == false) {
            normal = -normal;
          }
          gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
        }
    `));4===u.output&&(v.include(a.Transform,{linearDepth:!1}),v.include(c.NormalUtils,u),v.include(p.Overlay,{pbrMode:0}),v.vertex.code.add(k.glsl`
          void main() {
            vec3 vnormal = getLocalUp(position, origin);
            vec2 uv = uv0;
            vec3 vpos = applySkirts(uv, position, vnormal, skirtScale);
            setOverlayVTC(uv);

            gl_Position = transformPosition(proj, view, vpos);
          }
      `),v.include(h.OutputHighlight),v.fragment.code.add(k.glsl`
        void main() {
          vec4 overlayColor = getCombinedOverlayColor();

          if (overlayColor.a == 0.0) {
            gl_FragColor = vec4(0.0);
            return;
          }

          outputHighlight();
        }
      `));return v}var m=Object.freeze({__proto__:null,build:q});b.TerrainShader=m;b.build=q})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.VertexTangent=function(a,r){a.varyings.add("tbnTangent","vec3");a.varyings.add("tbnBiTangent","vec3");1===r.viewingMode?a.vertex.code.add(k.glsl`
      void forwardVertexTangent(vec3 n) {
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
        tbnBiTangent = normalize(cross(n, tbnTangent));
      }
    `):a.vertex.code.add(k.glsl`
      void forwardVertexTangent(vec3 n) {
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(n, tbnTangent));
      }
    `);a.fragment.code.add(k.glsl`
      mat3 getTBNMatrix(vec3 n) {
        return mat3(tbnTangent, tbnBiTangent, n);
      }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define(["exports","../../shaderModules/interfaces","../shading/Water.glsl","../shading/EvaluateMainLighting.glsl"],function(b,k,a,r){b.Overlay=function(l,h){3!==h.pbrMode&&4!==h.pbrMode||l.include(a.Water,h);l.vertex.uniforms.add("overlayTexOffset","vec4");l.vertex.uniforms.add("overlayTexScale","vec4");l.varyings.add("vtcOverlay","vec4");l.vertex.code.add(k.glsl`
    void setOverlayVTC(in vec2 uv) {
      vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
    }
  `);l.fragment.uniforms.add("ovInnerColorTex","sampler2D");l.fragment.uniforms.add("ovOuterColorTex","sampler2D");l.fragment.uniforms.add("overlayOpacity","float");l.fragment.code.add(k.glsl`
    vec4 getOverlayColor(sampler2D ov0Tex, sampler2D ov1Tex, vec4 texCoords) {
      // read textures outside of conditions, to avoid artifacts likely related to non-uniform flow control:
      // - https://www.khronos.org/opengl/wiki/Sampler_(GLSL)#Non-uniform_flow_control
      // - https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13657
      vec4 color0 = texture2D(ov0Tex, texCoords.xy);
      vec4 color1 = texture2D(ov1Tex, texCoords.zw);

      float valid0 = float((texCoords.x >= 0.0) && (texCoords.x <= 1.0) && (texCoords.y >= 0.0) && (texCoords.y <= 1.0));
      float valid1 = float((texCoords.z >= 0.0) && (texCoords.z <= 1.0) && (texCoords.w >= 0.0) && (texCoords.w <= 1.0));

      // Pick color0 if valid, otherwise color1 if valid, otherwise vec4(0)
      return mix(color1 * valid1, color0, valid0);
    }
  `);l.fragment.code.add(k.glsl`
    vec4 getCombinedOverlayColor() {
      return overlayOpacity * getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);
    }
  `);if(3===h.pbrMode||4===h.pbrMode)l.include(r.EvaluateMainLighting),l.fragment.code.add(k.glsl`
    vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
       float shadow, vec3 localUp, mat3 tbn, vec3 position) {

      // reproject normal from 0...1 => -1...1
      // and project it to worldspace.
      vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
      vec3 v = vposEyeDir;
      vec3 l = normalize(-lightingMainDirection);
      vec3 final = getSeaColor(n, v, l, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position);

      // the terrain renderer assumes a premultiplied color output without gamma.
      return vec4(final, colorInput.w);
    }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Skirts.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.Skirts=function(a){a.vertex.code.add(k.glsl`
    vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {
      float skirtLength = 0.0;

      if (uv.x >= 2.0) {
        skirtLength = uv.y * skirtScale;
        // decode original uv-coordinates (see "encodeSkirtPos")
        vec2 x = vec2(uv.x) - vec2(3.5, 4.5);
        uv = clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));
      }

      return vpos - vnormal * skirtLength;
    }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.TerrainTexture=function(a,r){a.varyings.add("vtc","vec2");a.vertex.uniforms.add("texOffsetAndScale","vec4");a.fragment.uniforms.add("tex","sampler2D");r.textureFadingEnabled&&(a.vertex.uniforms.add("nextTexOffsetAndScale","vec4"),a.varyings.add("nvtc","vec2"),a.fragment.uniforms.add("texNext",
"sampler2D"),a.fragment.uniforms.add("textureFadeFactor","float"));a.vertex.code.add(k.glsl`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${r.textureFadingEnabled?k.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:k.glsl``}
  }
  `);a.fragment.code.add(k.glsl`
  vec4 getTileColor() {
    ${r.textureFadingEnabled?k.glsl`return textureFadeFactor < 1.0 ? mix(texture2D(texNext, nvtc), texture2D(tex, vtc), textureFadeFactor) : texture2D(tex, vtc);`:k.glsl`return texture2D(tex, vtc);`}
  }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/statistics/tracer":function(){define(["exports","../../../../chunks/_commonjsHelpers","../../../webgl/capabilities/isWebGL2Context"],function(b,k,a){var r=k.createCommonjsModule(function(d){(function(c){c=c();void 0!==c&&(d.exports=c)})(function(){function c(v){if(null==m){m={};u={};for(var y in v)"number"==typeof v[y]&&(m[v[y]]=y,u[y]=v[y])}}function e(){if(null==m)throw"WebGLDebugUtils.init(ctx) not called";}function f(v){e();
var y=m[v];return void 0!==y?"gl."+y:"/*UNKNOWN WebGL ENUM*/ 0x"+v.toString(16)}function g(v,y,B,x){v=q[v];if(void 0!==v&&(v=v[y],void 0!==v&&v[B])){if("object"===typeof v[B]&&void 0!==v[B].enumBitwiseOr){y=v[B].enumBitwiseOr;B=0;v=[];for(var C=0;C<y.length;++C){var z=u[y[C]];0!==(x&z)&&(B|=z,v.push(f(z)))}return B===x?v.join(" | "):f(x)}return f(x)}return null===x?"null":void 0===x?"undefined":x.toString()}function p(v,y,B){v.__defineGetter__(B,function(){return y[B]});v.__defineSetter__(B,function(x){y[B]=
x})}function n(v,y,B,x){function C(E,G){return function(){B&&B(G,arguments);var H=E[G].apply(E,arguments),I=x.getError();0!=I&&(z[I]=!0,y(I,G,arguments));return H}}x=x||v;c(v);y=y||function(E,G,H){for(var I="",J=H.length,K=0;K<J;++K)I+=(0==K?"":", ")+g(G,J,K,H[K]);E="WebGL error "+f(E)+" in "+G+"("+I+")";window.console&&window.console.error?window.console.error(E):window.console&&window.console.log&&window.console.log(E)};var z={},A={},t;for(t in v)if("function"==typeof v[t])if("getExtension"!=t)A[t]=
C(v,t);else{var D=C(v,t);A[t]=function(){var E=D.apply(v,arguments);return n(E,y,B,x)}}else p(A,v,t);A.getError=function(){for(var E in z)if(z.hasOwnProperty(E)&&z[E])return z[E]=!1,E;return v.NO_ERROR};return A}function w(v){var y=v.getParameter(v.MAX_VERTEX_ATTRIBS),B=v.createBuffer();v.bindBuffer(v.ARRAY_BUFFER,B);for(var x=0;x<y;++x)v.disableVertexAttribArray(x),v.vertexAttribPointer(x,4,v.FLOAT,!1,0,0),v.vertexAttrib1f(x,0);v.deleteBuffer(B);y=v.getParameter(v.MAX_TEXTURE_IMAGE_UNITS);for(x=
0;x<y;++x)v.activeTexture(v.TEXTURE0+x),v.bindTexture(v.TEXTURE_CUBE_MAP,null),v.bindTexture(v.TEXTURE_2D,null);v.activeTexture(v.TEXTURE0);v.useProgram(null);v.bindBuffer(v.ARRAY_BUFFER,null);v.bindBuffer(v.ELEMENT_ARRAY_BUFFER,null);v.bindFramebuffer(v.FRAMEBUFFER,null);v.bindRenderbuffer(v.RENDERBUFFER,null);v.disable(v.BLEND);v.disable(v.CULL_FACE);v.disable(v.DEPTH_TEST);v.disable(v.DITHER);v.disable(v.SCISSOR_TEST);v.blendColor(0,0,0,0);v.blendEquation(v.FUNC_ADD);v.blendFunc(v.ONE,v.ZERO);
v.clearColor(0,0,0,0);v.clearDepth(1);v.clearStencil(-1);v.colorMask(!0,!0,!0,!0);v.cullFace(v.BACK);v.depthFunc(v.LESS);v.depthMask(!0);v.depthRange(0,1);v.frontFace(v.CCW);v.hint(v.GENERATE_MIPMAP_HINT,v.DONT_CARE);v.lineWidth(1);v.pixelStorei(v.PACK_ALIGNMENT,4);v.pixelStorei(v.UNPACK_ALIGNMENT,4);v.pixelStorei(v.UNPACK_FLIP_Y_WEBGL,!1);v.pixelStorei(v.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);v.UNPACK_COLORSPACE_CONVERSION_WEBGL&&v.pixelStorei(v.UNPACK_COLORSPACE_CONVERSION_WEBGL,v.BROWSER_DEFAULT_WEBGL);
v.polygonOffset(0,0);v.sampleCoverage(1,!1);v.scissor(0,0,v.canvas.width,v.canvas.height);v.stencilFunc(v.ALWAYS,0,4294967295);v.stencilMask(4294967295);v.stencilOp(v.KEEP,v.KEEP,v.KEEP);v.viewport(0,0,v.canvas.width,v.canvas.height);for(v.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT|v.STENCIL_BUFFER_BIT);v.getError(););}var q={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},
getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,
6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT",
"DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},
m=null,u=null;return{init:c,mightBeEnum:function(v){e();return void 0!==m[v]},glEnumToString:f,glFunctionArgToString:g,glFunctionArgsToString:function(v,y){for(var B="",x=y.length,C=0;C<x;++C)B+=(0==C?"":", ")+g(v,x,C,y[C]);return B},makeDebugContext:n,makeLostContextSimulatingCanvas:function(v){function y(O){return"function"==typeof O?O:function(Q){O.handleEvent(Q)}}function B(){for(var O=Object.keys(T),Q=0;Q<O.length;++Q)delete T[O]}function x(){++L;I||K==L&&v.loseContext()}function C(O,Q){var F=
O[Q];return function(){x();if(!I)return F.apply(O,arguments)}}function z(O){return{statusMessage:O,preventDefault:function(){S=!0}}}function A(O){for(var Q in O)"function"==typeof O[Q]?G[Q]=C(O,Q):p(G,O,Q);G.getError=function(){x();if(!I)for(var P;P=t.getError();)T[P]=!0;for(P in T)if(T[P])return delete T[P],P;return G.NO_ERROR};var F="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(Q=0;Q<F.length;++Q){var N=F[Q];G[N]=function(P){return function(){x();
if(I)return null;var U=P.apply(O,arguments);U.__webglDebugContextLostId__=H;J.push(U);return U}}(O[N])}F="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");for(Q=0;Q<F.length;++Q)N=F[Q],G[N]=function(P){return function(){x();
return I?null:P.apply(O,arguments)}}(G[N]);F="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(Q=0;Q<F.length;++Q)N=F[Q],G[N]=function(P){return function(){x();return I?!1:P.apply(O,arguments)}}(G[N]);G.checkFramebufferStatus=function(P){return function(){x();return I?G.FRAMEBUFFER_UNSUPPORTED:P.apply(O,arguments)}}(G.checkFramebufferStatus);G.getAttribLocation=function(P){return function(){x();return I?-1:P.apply(O,arguments)}}(G.getAttribLocation);G.getVertexAttribOffset=
function(P){return function(){x();return I?0:P.apply(O,arguments)}}(G.getVertexAttribOffset);G.isContextLost=function(){return I};return G}var t,D=[],E=[];var G={};var H=1,I=!1,J=[],K=0,L=0,S=!1,M=0,T={};v.getContext=function(O){return function(){var Q=O.apply(v,arguments);if(Q instanceof WebGLRenderingContext){if(Q!=t){if(t)throw"got different context";t=Q;G=A(t)}return G}return Q}}(v.getContext);(function(O){var Q=O.addEventListener;O.addEventListener=function(F,N,P){switch(F){case "webglcontextlost":D.push(y(N));
break;case "webglcontextrestored":E.push(y(N));break;default:Q.apply(O,arguments)}}})(v);v.loseContext=function(){if(!I){I=!0;K=0;for(++H;t.getError(););B();T[t.CONTEXT_LOST_WEBGL]=!0;var O=z("context lost"),Q=D.slice();setTimeout(function(){for(var F=0;F<Q.length;++F)Q[F](O);0<=M&&setTimeout(function(){v.restoreContext()},M)},0)}};v.restoreContext=function(){I&&E.length&&setTimeout(function(){if(!S)throw"can not restore. webglcontestlost listener did not call event.preventDefault";for(var O=0;O<
J.length;++O){var Q=J[O];Q instanceof WebGLBuffer?t.deleteBuffer(Q):Q instanceof WebGLFramebuffer?t.deleteFramebuffer(Q):Q instanceof WebGLProgram?t.deleteProgram(Q):Q instanceof WebGLRenderbuffer?t.deleteRenderbuffer(Q):Q instanceof WebGLShader?t.deleteShader(Q):Q instanceof WebGLTexture&&t.deleteTexture(Q)}w(t);I=!1;L=0;S=!1;O=E.slice();Q=z("context restored");for(var F=0;F<O.length;++F)O[F](Q)},0)};v.loseContextInNCalls=function(O){if(I)throw"You can not ask a lost contet to be lost";K=L+O};v.getNumCalls=
function(){return L};v.setRestoreTimeout=function(O){M=O};return v},resetToInitialState:w}})});let l=null;const h=[];b.enabled=!1;b.begin=function(){b.enabled&&(l=[])};b.end=function(){if(b.enabled){const d=l;l=null;d&&(h.forEach(c=>c(d)),h.length=0);return d}return null};b.instrumentContext=function(d){return b.enabled?a(d)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),d):r.makeDebugContext(d,void 0,(c,e)=>{b.enabled&&l&&l.push("gl."+c+"("+r.glFunctionArgsToString(c,e)+")")}):
d};b.request=function(d){h.push(d)};b.setEnabled=function(d){b.enabled=d};b.trace=function(d){b.enabled&&null!=l&&l.push(d)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){return function(){this.numMerged=this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../chunks/vec2f64"],
function(b,k){let a=function(){function r(){this.offset=k.create();this.scale=0;this.tile=null}var l=r.prototype;l.init=function(h,d,c,e){this.tile=h;this.offset[0]=d;this.offset[1]=c;this.scale=e};l.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return r}();b.UpsampleInfo=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../chunks/vec3f64 ../../../chunks/vec3 ./lighting/Lightsources ./lib/GeometryRecord ./lib/AutoDisposable ./parts/Model ./parts/RenderView".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x){function C(A){return"function"===typeof A.addParentStage&&"function"===typeof A.removeParentStage}var z;b.Stage=z=function(A){function t(E){E=A.call(this,E)||this;E.model=new B.Model;E._viewContent=[];E._mainLightDirection=q.fromValues(0,1,0);return E}k._inheritsLoose(t,A);var D=t.prototype;D.initialize=function(){this._set("renderView",new x.RenderView(this));this.setLighting({lights:[new u.MainLight(q.fromValues(.7,.7,.7)),new u.AmbientLight(q.fromValues(.3,
.3,.3))],groundLightingFactor:.5,globalFactor:.5})};D.destroy=function(){v.pool.prune(0);this.dispose()};D.setLighting=function(E){m.set(this._mainLightDirection,0,0,0);for(const G of E.lights)if(G instanceof u.MainLight){m.negate(this._mainLightDirection,G.direction);break}this._lighting=E;this.renderView.setNeedsRender()};D.stopAnimationsAtTime=function(E){this.getAll(3).forEach(G=>{l.applySome(G.animation,H=>H.stopAtTime(E))});this.renderView.setNeedsRender()};D.add=function(E,G){this.model.add(E,
G);C(G)&&G.addParentStage(this);this.renderView.setNeedsRender()};D.remove=function(E,G){this.renderView.setNeedsRender();E=this.model.remove(E,G);C(E)&&E.removeParentStage(this);return E};D.notifyDirty=function(E,G,H){this.destroyed||(this.model.notifyDirty(E,G,H),this.renderView.setNeedsRender())};D.processDirty=function(){const E=this.model.getDirtySet();if(E.hasDirtyGeometryRecords()){z.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo());var G=E.commitLayers(this._viewContent);
0<G[0].length+G[1].length+G[2].length&&this.renderView.modify(G[0],G[1],G[2]);z.DebugSettings.logDirtySet&&(console.log("RGs add: "+G[0].map(H=>H.uniqueName)),console.log("RGs remove: "+G[1].map(H=>H.uniqueName)));E.commit();this.renderView.setNeedsRender()}};D.processDirtyLayer=function(E){E=this.model.getDirtySet().commitLayers([E]);0<E[0].length+E[1].length+E[2].length&&this.renderView.modify(E[0],E[1],E[2]);this.renderView.setNeedsRender()};D.getContent=function(E,G){return this.model.get(E,G)};
D.getAll=function(E){return this.model.getAll(E)};D.getCount=function(E){return this.model.getAll(E).size};D.getCamera=function(){return this.renderView.getCamera()};D.setCamera=function(E){this.renderView.setCamera(E)};D.getLayers=function(){return this.model.getAll(0)};D.getViewContent=function(){return this._viewContent.slice(0)};D.addToViewContent=function(E){const G=[];for(let H=0;H<E.length;H++)-1===this._viewContent.indexOf(E[H])&&G.push(E[H]);0<E.length&&(this.processDirty(),E=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(G),
this.renderView.modify(E,[],[]),this._viewContent.push.apply(this._viewContent,G))};D.removeFromViewContent=function(E){this.processDirty();const G=this.model.getDirtySet(),H=this._viewContent,I=[];for(let J=0;J<E.length;J++){const K=H.indexOf(E[J]);-1<K&&(H[K]=H[H.length-1],H.pop(),I.push(E[J]))}E=G.getResidentRenderGeometriesFilteredByLayers(I);this.renderView.modify([],E,[])};D.addRenderPlugin=function(E,G){"intersect"in G&&this.sceneIntersectionHelper.addIntersectionHandler(G);this.renderView.renderPlugins.add(E,
G)};D.removeRenderPlugin=function(E){"intersect"in E&&this.sceneIntersectionHelper.removeIntersectionHandler(E);this.renderView.renderPlugins.remove(E)};k._createClass(t,[{key:"dirty",get:function(){return this.model.getDirtySet().hasDirtyGeometryRecords()}},{key:"mainLightDirection",get:function(){return this._mainLightDirection}},{key:"lighting",get:function(){return this._lighting}},{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this.model.getStats()}}}]);
return t}(y.AutoDisposableMixin(w));b.Stage.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};a.__decorate([c.property({constructOnly:!0})],b.Stage.prototype,"scheduler",void 0);a.__decorate([c.property({constructOnly:!0})],b.Stage.prototype,"options",void 0);a.__decorate([c.property({constructOnly:!0})],b.Stage.prototype,"sceneIntersectionHelper",void 0);a.__decorate([c.property({constructOnly:!0})],b.Stage.prototype,"viewingMode",void 0);a.__decorate([c.property({constructOnly:!0})],b.Stage.prototype,
"container",void 0);a.__decorate([y.autoDispose(),c.property()],b.Stage.prototype,"renderView",void 0);b.Stage=z=a.__decorate([f.subclass("esri.views.3d.webgl-engine.Stage")],b.Stage);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../support/mathUtils ../lib/Util ../lib/localOrigin ../lib/RenderGeometry ../lib/ModelDirtySet".split(" "),function(b,k,a,r,l,h){const d=a.assert,c=a.logWithBase;a=function(){function e(){this.dirtySet=
new h(this);this._id2origin={};this._content=Array(5);for(let g=0;5>g;++g)this._content[g]=new Map}var f=e.prototype;f.getAll=function(g){g=this._content[g];d(void 0!==g);return g};f.get=function(g,p){return this.getAll(g).get(p)};f.add=function(g,p){const n=this._content[g];d(void 0!==n);const w=p.id;d(!n.has(w),"Model/Stage already contains object to be added");n.set(w,p);0===g&&this.notifyDirty(p,"layerAdded")};f.remove=function(g,p){const n=this._content[g];d(void 0!==n);const w=n.get(p);d(void 0!==
w,"Model/Stage doesn't contain object to be removed");n.delete(p);4===g&&w.unload();0===g&&this.notifyDirty(w,"layerRemoved");return w};f.getDirtySet=function(){return this.dirtySet};f.notifyDirty=function(g,p,n){this.dirtySet.handleUpdate(g,p,n)};f.getOrigin=function(g,p,n=10){var w=0;p=p*n/1E4;1<p&&(w=Math.ceil(c(p,2)));p=1E4*Math.pow(2,w);n=Math.round(g[0]/p);const q=Math.round(g[1]/p);g=Math.round(g[2]/p);w=w+"_"+n+"_"+q+"_"+g;let m=this._id2origin[w];null==m&&(m=r.fromValues(n*p,q*p,g*p,w),this._id2origin[w]=
m);return m};f.getGeometryRenderGeometries=function(g,p,n){const w=p.geometry,q=g.getCombinedStaticTransformation(p),m=k.maxScale(q),u=p.origin;g=new l(w.data,w.boundingInfo,p.material,q,p.shaderTransformation,m,g.castShadow);g.uniqueName=p.id;g.origin=u||this.getOrigin(g.center,g.bsRadius);g.instanceParameters=p.instanceParameters;n.push(g)};f.updateRenderGeometryTransformation=function(g,p,n){g=g.getCombinedStaticTransformation(p,n.transformation);n.updateTransformation(g);g=this.getOrigin(n.center,
n.bsRadius);return n.origin!==g};f.getStats=function(){const g={};for(let p=0;5>p;++p)g[p]=this.getAll(p).size;return{contentTypes:g,dirtySet:this.dirtySet.formatDebugInfo()}};f.validateObject=function(g){g=g.geometryRecords;for(let p=0;p<g.length;++p){const n=g[p];d(null!=this.get(2,n.geometry.id));d(null!=this.get(3,n.material.id))}};f.validateLayer=function(g){g=g.getObjects();for(let p=0;p<g.length;++p){const n=this.get(1,g[p].id);d(null!=n)}};return e}();b.Model=a;Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/MapUtils","./Util"],function(b,k,a){return function(){function r(h){this._residentGeomRecords=new Map;this._dirtyGeomRecords=new Map;this._model=h}var l=r.prototype;l.hasDirtyGeometryRecords=function(){return k.someMap(this._dirtyGeomRecords,h=>k.someMap(h,d=>d&&0<d.size))};l.handleUpdate=function(h,d,c){a.assert(this[d],"ModelDirtySet doesn't know how to process "+
d);return this[d](h,c)};l.shaderTransformationChanged=function(h){(h=this._residentGeomRecords.get(h.id))&&h.forEach((d,c)=>{(c=this._model.get(1,c))&&c.hasVolativeTransformation()&&d.forEach(e=>{for(const f of e[1])f.shaderTransformationChanged()})})};l.commit=function(){return this.commitLayers(this._dirtyGeomRecords.keys())};l.commitLayers=function(h){const d=[],c=[],e=[];for(const f of h)if(h=this._dirtyGeomRecords.get(f))h.forEach((g,p)=>{const n=this._ensureGeomRecord(f,p);g.forEach((w,q)=>
{const m=w[0];var u=w[1];const v=w[2];w=!1;if(u&2){var y=n.get(q);if(y){y=y[1];if(v&4){const x=this._model.get(1,p);for(var B of y)if(this._model.updateRenderGeometryTransformation(x,m,B)){w=!0;break}}if(!w)for(const x of y)e.push({renderGeometry:x,updateType:v})}else a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(u&4||w)(B=n.get(q))?c.push.apply(c,B[1]):4===u&&a.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove"),B&&n.delete(q);if(u&1||w)u=
[m,[]],w=this._model.get(1,p),this._model.getGeometryRenderGeometries(w,m,u[1]),d.push.apply(d,u[1]),n.set(q,u)});0===n.size&&this._residentGeomRecords.get(f).delete(p)}),0===this._residentGeomRecords.get(f).size&&this._residentGeomRecords.delete(f),this._dirtyGeomRecords.delete(f);return[d,c,e]};l.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers([...this._residentGeomRecords.keys()])};l.getResidentRenderGeometriesFilteredByLayers=function(h){const d=
[];for(let c=0;c<h.length;c++){const e=this._residentGeomRecords.get(h[c]);e&&e.forEach(f=>{f.forEach(g=>{d.push(...g[1])})})}return d};l._objectStateChanged=function(h,d,c,e){if(null!=c)this._componentPropertyChanged(d,c,e,h);else for(const f of d.geometryRecords)this._componentPropertyChanged(d,f,e,h)};l.visibilityChanged=function(h,d,c){this._objectStateChanged(1,h,d,c)};l.highlightChanged=function(h,d,c){this._objectStateChanged(8,h,d,c)};l.occlusionChanged=function(h,d,c){this._objectStateChanged(16,
h,d,c)};l.vertexAttrsUpdated=function(h,d,c){this._updateOrCreateDirtyRecord(h,d,c,2,0,0,2,5,2)};l.layerAdded=function(h){const d=h.getObjects();for(let c=0;c<d.length;c++)this.layerObjectAdded(h,d[c])};l.layerRemoved=function(h){const d=h.getObjects();for(let c=0;c<d.length;c++)this.layerObjectRemoved(h,d[c])};l.layerObjectAdded=function(h,d){h=h.id;const c=d.geometryRecords;for(let e=0;e<c.length;e++)this.objGeometryAdded(d,c[e],h)};l.layerObjectRemoved=function(h,d){h=h.id;const c=d.geometryRecords;
for(let e=0;e<c.length;e++)this.objGeometryRemoved(d,c[e],h)};l.layObjectReplaced=function(h,d){this.layerObjectRemoved(h,d[0]);this.layerObjectAdded(h,d[1])};l.objTransformation=function(h,d){d=d||this._getParentLayerId(h);this._ensureGeomRecord(d,h.id).forEach(c=>{this._updateOrCreateDirtyRecord(h,c[0],d,2,0,0,2,5,4)})};l.objGeometryAdded=function(h,d,c){this._updateOrCreateDirtyRecord(h,d,c,1,4,0,0,0)};l.objGeometryRemoved=function(h,d,c){this._updateOrCreateDirtyRecord(h,d,c,4,1,2,0,0)};l._componentPropertyChanged=
function(h,d,c,e){this._updateOrCreateDirtyRecord(h,d,c,2,0,0,2,5,e)};l._updateOrCreateDirtyRecord=function(h,d,c,e,f,g,p,n,w){c=c||this._getParentLayerId(h);const q=d.id;h=this._ensureDirtyRecord(c,h.id);(c=h.get(q))?(d=c[1],d&f?h.delete(q):d&g?(c[1]=e,c[2]=w):d&p?c[2]|=w:d&n||a.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):h.set(q,[d,e,w])};l._ensureGeomRecord=function(h,d){let c=this._residentGeomRecords.get(h);c||(c=new Map,this._residentGeomRecords.set(h,c));h=c.get(d);h||
(h=new Map,c.set(d,h));return h};l._ensureDirtyRecord=function(h,d){let c=this._dirtyGeomRecords.get(h);c||(c=new Map,this._dirtyGeomRecords.set(h,c));h=c.get(d);h||(h=new Map,c.set(d,h));return h};l._getParentLayerId=function(h){return h.parentLayer.id};l.formatDebugInfo=function(){const h=["ADD","UPD",void 0,"REM"];let d="";this._dirtyGeomRecords.forEach((c,e)=>{c.forEach((f,g)=>{0<d.length&&(d+="\n");d+=e+"."+g;const p=[];f.forEach(n=>{const w=n[1];p[w]||(p[w]=[]);p[w].push(n[0].geometry.id)});
for(f=0;f<p.length;f++)if(p[f])for(d+=" "+h[f-1]+": ",g=0;g<p[f].length;g++)d+=p[f][g]+", "})});return d};b._createClass(r,[{key:"residentLayerCount",get:function(){return this._residentGeomRecords.size}},{key:"residentObjectCount",get:function(){let h=0;this._residentGeomRecords.forEach(d=>{h+=d.size});return h}}]);return r}()})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/scheduling ../../../../core/Accessor ../../../../core/Evented ../../../../layers/support/timeUtils ../../../../core/watchUtils ../../../webgl/context-util ../lib/AutoDisposable ../../../webgl/RenderingContext ../core/shaderTechnique/CommonUniformStore ../core/shaderTechnique/ShaderTechniqueRepository ../lib/GLMaterialRep ../materials/lineStippleUtils ../lib/WebGLDriverTest ../../support/animationUtils ./requireUtils ../statistics/tracer ../collections/Component/ComponentObjectCollection ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/MagnifierHelper ../lib/Renderer ../lib/TextureRepository ../materials/internal/WaterTextureRepository ./ScreenshotManager".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O){const Q=h.getLogger("esri.views.3d.webgl-engine.parts.View");let F=null;b.RenderView=function(N){function P(V){var W=N.call(this,{})||this;W._stage=V;W.events=new m;W._stippleTextureRepository=new t.StippleTextureRepository;W.waterTextureRepository=new T.WaterTextureRepository;W._magnifierHelper=new L.MagnifierHelper;W._commonUniformStore=new C.CommonUniformStore;W._componentObjectCollection=null;W._needsUpdate=!0;
W._needsRender=!0;W._idleSuspend=!0;W._logicUpdateLast=0;W._container=W._stage.container;W._initializeContext(W._stage.options);v.init(W.waterTextureRepository,"loadingState",()=>W.setNeedsRender());W._magnifierHelper.events.on("request-render",()=>W.setNeedsRender());W._shaderTechniqueRepository=new z.ShaderTechniqueRepository({rctx:W._rctx,viewingMode:W._stage.options.viewingMode,commonUniformStore:W._commonUniformStore,stippleTextureRepository:W._stippleTextureRepository,waterTextureRepository:W.waterTextureRepository});
W._textureRepository=new M.TextureRepository(W._stage.scheduler,W._stage.getAll(4),W._shaderTechniqueRepository,W._rctx);W._textureRepository.events.on("changed",X=>W.setNeedsRender(X));W._materialRepository=new A(W._textureRepository,W._shaderTechniqueRepository,()=>W.setNeedsRender());W._compositingHelper=new J(W._rctx,W._shaderTechniqueRepository);V=W._container.getBoundingClientRect();W._renderer=new S(W._materialRepository,W._textureRepository,W._shaderTechniqueRepository,W._rctx,W._compositingHelper,
W._magnifierHelper,(X=1)=>W.setNeedsRender(X),[V.width,V.height],W._stage);W._screenshotManager=new O.ScreenshotManager(W._rctx,(X,ca,R)=>W._render(X,ca,R),()=>W.setNeedsRender(),W._stage.options.screenshot.renderOverlay,X=>W.events.emit("force-camera-for-screenshot",X));W._registerFrameTask();return W}k._inheritsLoose(P,N);var U=P.prototype;U.normalizeCtorArgs=function(){return{}};U.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask&&
(this._frameTask.remove(),this._frameTask=null);this._shaderTechniqueRepository.dispose();this._shaderTechniqueRepository=null;D.clearTestWebGLDriver(this._rctx);N.prototype.dispose.call(this);this._rctx=null};U.setNeedsRender=function(V=1){1===V?this._needsUpdate||(this._needsUpdate=!0,this.notifyChange("updating")):this._needsRender=!0};U.evaluateUpdating=function(){return this.needsUpdate||this._renderer.updating||0<this._textureRepository.loadingCount||this.waterTextureRepository.updating||this._magnifierHelper.updating||
this._stage.dirty};U.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};U.setRenderParameters=function(V){this.setNeedsRender();void 0!==V.idleSuspend&&(this._idleSuspend=!!V.idleSuspend);this._renderer.setRenderParameters(V)};U.has=function(V){switch(V){case 0:return!!this._rctx.capabilities.compressedTextureS3TC;case 1:return!!this._rctx.capabilities.shaderTextureLOD;case 2:return this._renderer.hasShadowsEnabled;default:return!1}};U.modify=function(V,W,X){this._renderer.modify(V,
V.length,W,W.length,X,X.length)};U.setCamera=function(V){this._renderer.camera=V};U.getCamera=function(){return this._renderer.camera};U.getCanvas=function(){return this._canvas};U.takeScreenshot=function(V){return this._screenshotManager.takeScreenshot(V)};U.getMinimalDepthForArea=function(V,W,X,ca=80,R=1){V=X.constrainWindowSize(V,W,ca*X.pixelRatio,R);F=new Uint8Array(4*V[2]*V[3]);this._renderer.readDepthPixels(V[0],V[1],V[2],V[3],F);W=Number.MAX_VALUE;for(ca=0;ca<V[2]*V[3];ca++)R=K.texure2depth(4*
ca,F,X.nearFar),W>R&&R!==X.nearFar[0]&&R!==X.nearFar[1]&&(W=R);return W===Number.MAX_VALUE?void 0:W};U.getGpuMemoryUsage=function(){return this._renderer.getGpuMemoryUsage()};U.hotReloadShaders=async function(){G.removeLoadedShaderModules();await this._shaderTechniqueRepository.hotReload();this.setNeedsRender()};U._registerFrameTask=function(){const V={viewCamera:this._renderer.camera,frameHasDecorations:!1};let W=!1;this._frameTask=w.addFrameTask({preRender:X=>{W=this.evaluateUpdating();H.begin();
let ca=!1;this._stage.processDirty();const R=u.Milliseconds(X.time-this._logicUpdateLast);R>E.DESIRED_ANIMATION_MS&&(ca=this._renderer.updateLogic({camera:this._renderer.camera,dt:R}),this._logicUpdateLast=X.time);ca&&this.setNeedsRender(0)},render:()=>{!this.needsUpdate&&!this._needsRender&&this._idleSuspend&&this._renderer.isCameraFinal||!this.canRender||(this._needsUpdate=this._needsRender=!1,this._render(null,this._renderer.camera,!1))},postRender:()=>{W!==this.evaluateUpdating()&&this.notifyChange("updating");
H.end()},update:()=>{V.viewCamera=this._renderer.camera;V.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled;this._textureRepository.update();this._screenshotManager.update(V)}})};U._initializeContext=function(V){this._canvas=V.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const W=H.instrumentContext(y.createContextOrErrorHTML(this._canvas,{alpha:V.alpha||!1,premultipliedAlpha:!0,
antialias:!1,depth:!0,stencil:null==V.stencil?!0:V.stencil,powerPreference:"high-performance"},V.renderContext));this._rctx=new x(W,{disabledExtensions:V.deactivatedWebGLExtensions||{},debugWebGLExtensions:V.debugWebGLExtensions||{}});null!=this._rctx.parameters.maxMaxAnisotropy&&(this._rctx.parameters.maxMaxAnisotropy=Math.min(this._rctx.parameters.maxMaxAnisotropy,8));this._loadShaderOnlyExtensions(this._rctx);!V.alpha&&this._rctx.contextAttributes.alpha&&Q.error("WebGL context has alpha channel even though no alpha channel was requested");
!this._rctx.contextAttributes.alpha&&11<=r("safari")&&(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas)};U._render=function(V,W,X){this._renderer.render(V,W,X)};U._loadShaderOnlyExtensions=function(V){V=V.capabilities;V.standardDerivatives;V.shaderTextureLOD;V.textureFloat};k._createClass(P,[{key:"performanceInfo",get:function(){const V=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==V.getUsedTextureMemory?V.getUsedTextureMemory():
void 0,renderbufferMemory:void 0!==V.getUsedRenderbufferMemory?V.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==V.getUsedVBOMemory?V.getUsedVBOMemory():void 0}}},{key:"canRender",get:function(){return this._renderer.canRender}},{key:"needsUpdate",get:function(){return this._needsUpdate}},{key:"updating",get:function(){return this.evaluateUpdating()}},{key:"edgeView",get:function(){return this._renderer.edgeView}},{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",
get:function(){return this._compositingHelper}},{key:"magnifier",set:function(V){this._magnifierHelper.magnifier=V}},{key:"renderingContext",get:function(){return this._rctx}},{key:"renderPlugins",get:function(){return this._renderer.renderPlugins}},{key:"test",get:function(){return{renderer:this._renderer}}},{key:"componentObjectCollection",get:function(){l.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new I.ComponentObjectCollection(this._renderer.renderPassManager));
return this._componentObjectCollection},set:function(V){this._componentObjectCollection=V}}]);return P}(B.AutoDisposableMixin(q));a.__decorate([c.property({type:Boolean,readOnly:!0,dependsOn:["waterTextureRepository.updating","_magnifierHelper.updating"],autoTracked:!1})],b.RenderView.prototype,"updating",null);a.__decorate([B.autoDispose()],b.RenderView.prototype,"_rctx",void 0);a.__decorate([B.autoDispose()],b.RenderView.prototype,"_container",void 0);a.__decorate([B.autoDispose()],b.RenderView.prototype,
"_canvas",void 0);a.__decorate([B.autoDispose()],b.RenderView.prototype,"_stippleTextureRepository",void 0);a.__decorate([B.autoDispose(),c.property()],b.RenderView.prototype,"waterTextureRepository",void 0);a.__decorate([B.autoDispose(),c.property()],b.RenderView.prototype,"_magnifierHelper",void 0);a.__decorate([B.autoDispose()],b.RenderView.prototype,"_textureRepository",void 0);a.__decorate([B.autoDispose()],b.RenderView.prototype,"_commonUniformStore",void 0);a.__decorate([B.autoDispose()],b.RenderView.prototype,
"_compositingHelper",void 0);a.__decorate([B.autoDispose()],b.RenderView.prototype,"_renderer",void 0);a.__decorate([B.autoDispose()],b.RenderView.prototype,"_screenshotManager",void 0);a.__decorate([B.autoDispose()],b.RenderView.prototype,"componentObjectCollection",null);a.__decorate([B.autoDispose()],b.RenderView.prototype,"_componentObjectCollection",void 0);b.RenderView=a.__decorate([f.subclass("esri.views.3d.webgl-engine.parts.RenderView")],b.RenderView);Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/Logger ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat3 ../../../../../chunks/vec4 ../../../../../chunks/mat3f32 ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../../lib/Util ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject ../../../layers/support/symbolColorUtils ../../../../../chunks/vec4f32 ../../../support/orientedBoundingBox ./ComponentData ./interface ../../core/util/BucketedObjectStore ./ComponentObject ../../lib/ComponentUtils ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./Material/ComponentTechnique ./Material/ComponentMaterial ../../core/util/TwoVectorPosition ../../lib/TextureBackedBuffer/BufferManager".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J){const K=r.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");r=function(){function O(F){this._renderManager=F;this._objects=new B.BucketedObjectStore;this._renderSubmit=new D.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);this._componentBufferManager=new J.BufferManager(F.rctx)}var Q=O.prototype;Q.dispose=function(){p.assert(0===this._objects.count,"ObjectCollection should be empty upon disposal");
this._componentBufferManager.destroy()};Q.createObject=function(F){const N=new x;N.toMapSpace=F.toMapSpace.slice();N.transform=F.transform;N.obb=u.clone(F.obb);N.components=new v(this._componentBufferManager,F.geometry.componentOffsets);N.renderable=this._createRenderable(F,N.components);N.intersectionGeometry=new z(F.geometry.positionData,N.components);this._objects.add(F.visible?y.VISIBLE_BIT:0,N);return N};Q.destroyObject=function(F){this._objects.remove(F);F.dispose();this._notifyDirty()};Q.setObjectVisibility=
function(F,N){N!==F.visible&&(this._objects.updateKey(F,N?F.bucketKey|y.VISIBLE_BIT:F.bucketKey&~y.VISIBLE_BIT),this._notifyDirty())};Q.preSubmit=function(F){const N=F.camera.eye;this._objects.forEach((P,U)=>{U&y.VISIBLE_BIT&&P.forEach(V=>{const W=h.squaredDistance(N,V.obb.center);V.renderable.meta.cameraDepthSquared=W})})};Q.getMaterial=function(F){return F.renderable.material};Q.updateMaterial=function(F,N){F=F.renderable.material;N(F);F.dirty&&this._notifyDirty()};Q.setAllComponentVisibilities=
function(F,N){F.components.visibility.reset(N);F.components.visibilityDirty();this._notifyDirty()};Q.forEachVisibleComponent=function(F,N){return F.components.visibility.forEachComponent(N)};Q.getComponentCount=function(F){const N=F.components.visibility.componentCount();return{visible:N,invisible:F.components.count-N}};Q.setComponentData=function(F,N){const P=F.renderable.material;if(y.isVaryingComponentParameters(N)){F=F.components;var U=F.materialDataBuffer;const V=F.materialDataIndices,W={castShadows:!0,
pickable:!0,externalColor:m.create(),externalColorMixMode:1};U=U.textureBuffer;const X=new Uint8Array(4),ca=new Uint32Array(X.buffer);let R=0,aa=0,ka=0,da=!1,fa=0;for(let ea=0;ea<F.count;ea++)N(ea,W),R+=+(1>W.externalColor[3]),aa+=+(3===W.externalColorMixMode&&1===W.externalColor[3]),ka+=+W.castShadows,q.encodeSymbolColor(W.externalColor,W.externalColorMixMode,X),X[2]=X[2]&254|+W.castShadows,U.setData(V[ea],0,X[0],X[1],X[2],X[3]),da=da||0<ea&&fa!==ca[0],fa=ca[0],W.pickable!==C.getVisibility(F.pickability,
ea)&&(F.pickability=C.updateVisibilityWithCount(F.pickability,F.count,ea,W.pickable));da?(P.componentParameters=new H.ComponentParametersVarying,P.componentParameters.castShadows=ka===F.count?0:0===ka?2:1,P.componentParameters.transparent=R===F.count?0:0===R?2:1,P.componentParameters.opaqueOverride=aa===F.count?0:0===aa?2:1,P.componentParameters.texture=U,U.updateTexture()):(P.componentParameters=new H.ComponentParametersUniform,P.componentParameters.castShadows=W.castShadows?0:2,P.componentParameters.externalColor=
W.externalColor,P.componentParameters.externalColorMixMode=W.externalColorMixMode)}else P.componentParameters=new H.ComponentParametersUniform,P.componentParameters.castShadows=N.castShadows?0:2,P.componentParameters.externalColor=N.externalColor,P.componentParameters.externalColorMixMode=N.externalColorMixMode;this._notifyDirty()};Q.getComponentAabb=function(F,N,P){return F.intersectionGeometry.getComponentAabb(N,P)};Q.getComponentObb=function(F){return F.obb};Q.getObjectTransform=function(F){return F.transform};
Q.getComponentPositions=function(F,N,P){return F.intersectionGeometry.getComponentPositions(N,P)};Q.intersect=function(F,N,P,U,V,W){a.isSome(V)&&(V.localOrigin=F.transform.position);const X=d.invert(S,F.transform.rotationScale);h.sub(M,N,F.transform.position);h.sub(T,P,F.transform.position);h.transformMat3(M,M,X);h.transformMat3(T,T,X);N=d.transpose(S,X);return F.intersectionGeometry.intersect(M,T,U,N,V,W)};Q.addEdges=function(F,N,P,U){const {indices:V,positions:W}=F.intersectionGeometry;return N.addComponentObject(F,
F.transform,F.obb.center,W,V,F.components.offsets,P,U)};Q.addComponentHighlight=function(F,N){F=F.components;a.isNone(F.highlightCounts)&&(F.highlightCounts=new Uint32Array(F.count+1));0===F.highlightCounts[N]++&&(F.highlightsDirty(),this._notifyDirty());F.highlightCounts[F.count]++};Q.removeComponentHighlight=function(F,N){F=F.components;if(a.isNone(F.highlightCounts))K.warn("Removing non-existing highlight.");else{var P=F.highlightCounts[N],U=F.highlightCounts[F.count];0===P?K.warn("Removing non-existing highlight."):
1<P?(F.highlightCounts[N]=P-1,F.highlightCounts[F.count]=U-1):(F.highlightCounts[N]=0,F.highlightsDirty(),this._notifyDirty(),1===U?F.highlightCounts=null:F.highlightCounts[F.count]=U-1)}};Q.clearHighlights=function(F){F=F.components;a.isSome(F.highlightCounts)&&(F.highlightCounts=null,F.highlightsDirty(),this._notifyDirty())};Q.getObjectGPUMemoryUsage=function(F){return F.renderable.meta.gpuMemoryEstimate};Q._createRenderable=function(F,N){const P=this._renderManager.rctx,U=F.geometry,V=U.vertices.layoutParameters,
W=n.createVertex(P,35044,U.vertices.data),X=a.applySome(U.indices,fa=>n.createIndex(P,35044,fa));var ca=f.glLayout(E.createVertexBufferLayout(V)),R=new Uint16Array(U.vertices.count);for(var aa=0;aa<N.count;aa++){var ka=N.offsets[aa],da=N.offsets[aa+1];const fa=N.materialDataIndices[aa];if(a.isSome(U.indices))for(;ka<da;ka++)R[U.indices[ka]]=fa;else for(;ka<da;ka++)R[ka]=fa}N=n.createVertex(P,35044,R.buffer);aa=new I.TwoVectorPosition(F.transform.position);da=e.clone(F.transform.rotationScale);d.invert(da,
da);d.transpose(da,da);R=new G.ComponentDrawParameters;h.copy(R.worldFromModel_TL,aa.low);h.copy(R.worldFromModel_TH,aa.high);d.copy(R.worldFromModel_RS,F.transform.rotationScale);d.copy(R.transformNormal_GlobalFromModel,da);c.copy(R.toMapSpace,F.toMapSpace);F=new H.ComponentMaterial;ca=new w(P,F.attributeLocations,{data:ca,componentIndices:L},{data:W,componentIndices:N},a.unwrap(X));aa=new A;aa.material=F;aa.drawParameters=R;aa.geometry=new t(ca,U.primitiveType,V,a.isSome(X));aa.meta.cameraDepthSquared=
.5;aa.meta.gpuMemoryEstimate=W.byteSize+N.byteSize+(a.isSome(X)?X.byteSize:0);return aa};Q._notifyDirty=function(){this._renderManager.notifyDirty()};k._createClass(O,[{key:"visibleObjects",get:function(){return this._objects.getBucket(y.VISIBLE_BIT)}},{key:"performanceInfo",get:function(){const F=this._objects.getPerformanceInfo(y.VISIBLE_BIT);return{shown:F.added,hidden:F.removed}}}]);return O}();const L=f.glLayout(g.newLayout().u16("componentIndex")),S=e.create(),M=l.create(),T=l.create();b.ComponentObjectCollection=
r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../chunks/mat3f64 ../../../chunks/quatf64 ../../../chunks/vec4f64 ../../../chunks/mat3 ../../../chunks/vec4 ../../../chunks/quat ../../../geometry/support/aaBoundingBox ../../../chunks/vec3f32 ./geometryUtils ../../../chunks/quatf32 ./dito".split(" "),function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){function q(t=[0,0,0],D=[-1,-1,-1],E=
[0,0,0,1]){return{center:k.clone(t),halfSize:g.clone(D),quaternion:n.clone(E)}}function m(t,D){const E=p.plane.signedDistance(D,t.center);t=u(t,p.plane.normal(D));return E>t?1:E<-t?-1:0}function u(t,D){e.conjugate(v,t.quaternion);a.transformQuat(y,D,v);t=t.halfSize;return Math.abs(y[0]*t[0])+Math.abs(y[1]*t[1])+Math.abs(y[2]*t[2])}const v=l.create(),y=k.create(),B=k.create(),x=h.create(),C=r.create(),z=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,1.2],A=(()=>{const t=new Int8Array(162);let D=0;const E=G=>{for(let H=
0;H<G.length;H++)t[D+H]=G[H];D+=6};E([6,2,3,1,5,4]);E([0,2,3,1,5,4]);E([0,2,3,7,5,4]);E([0,1,3,2,6,4]);E([0,1,3,2,0,0]);E([0,1,5,7,3,2]);E([0,1,3,7,6,4]);E([0,1,3,7,6,2]);E([0,1,5,7,6,2]);E([0,1,5,4,6,2]);E([0,1,5,4,0,0]);E([0,1,3,7,5,4]);E([0,2,6,4,0,0]);E([0,0,0,0,0,0]);E([1,3,7,5,0,0]);E([2,3,7,6,4,0]);E([2,3,7,6,0,0]);E([2,3,1,5,7,6]);E([0,1,5,7,6,2]);E([0,1,5,7,6,4]);E([0,1,3,7,6,4]);E([4,5,7,6,2,0]);E([4,5,7,6,0,0]);E([4,5,1,3,7,6]);E([0,2,3,7,5,4]);E([6,2,3,7,5,4]);E([6,2,3,1,5,4]);return t})();
b.ObbArray=function(t){this.buffer=new ArrayBuffer(56*t);this.obbs=Array(t);for(let D=0;D<t;D++)this.obbs[D]={center:k.createView(this.buffer,56*D),halfSize:g.createView(this.buffer,56*D+24),quaternion:n.createView(this.buffer,56*D+36)}};b.clone=function(t){return q(t.center,t.halfSize,t.quaternion)};b.compute=function(t,D){D=D||q();w.computeOBB(t,D);return D};b.corners=function(t,D){for(let E=0;8>E;++E){const G=D[E];G[0]=E&1?-t.halfSize[0]:t.halfSize[0];G[1]=E&2?-t.halfSize[1]:t.halfSize[1];G[2]=
E&4?-t.halfSize[2]:t.halfSize[2];a.transformQuat(G,G,t.quaternion);a.add(G,G,t.center)}};b.create=q;b.intersectLine=function(t,D,E,G=0){e.conjugate(v,t.quaternion);a.subtract(y,D,t.center);D=a.transformQuat(y,y,v);E=a.transformQuat(B,E,v);let H=-Infinity,I=Infinity;for(let J=0;3>J;J++)if(1E-6<Math.abs(E[J])){const K=(G+t.halfSize[J]-D[J])/E[J],L=(-G-t.halfSize[J]-D[J])/E[J];H=Math.max(H,Math.min(K,L));I=Math.min(I,Math.max(K,L))}else if(D[J]>t.halfSize[J]+G||D[J]<-t.halfSize[J]-G)return!1;return H<=
I};b.intersectPlane=m;b.isVisible=function(t,D){return 0>=m(t,D.planes[0])&&0>=m(t,D.planes[1])&&0>=m(t,D.planes[2])&&0>=m(t,D.planes[3])&&0>=m(t,D.planes[4])&&0>=m(t,D.planes[5])};b.maximumDistancePlane=function(t,D){const E=p.plane.signedDistance(D,t.center);t=u(t,p.plane.normal(D));return E+t};b.minimumDistancePlane=function(t,D){const E=p.plane.signedDistance(D,t.center);t=u(t,p.plane.normal(D));return E-t};b.projectedArea=function(t,D,E,G,H){e.conjugate(v,t.quaternion);a.sub(y,D,t.center);a.transformQuat(y,
y,v);var I=y[0]<-t.halfSize[0]?-1:y[0]>t.halfSize[0]?1:0,J=y[1]<-t.halfSize[1]?-1:y[1]>t.halfSize[1]?1:0,K=y[2]<-t.halfSize[2]?-1:y[2]>t.halfSize[2]?1:0;D=Math.abs(I)+Math.abs(J)+Math.abs(K);if(0===D)return Infinity;D=1===D?4:6;I=6*(I+3*J+9*K+13);d.fromQuat(C,t.quaternion);d.scale(C,C,t.halfSize);for(J=0;J<D;J++)K=A[I+J],a.set(y,((K&1)<<1)-1,(K&2)-1,((K&4)>>1)-1),a.transformMat3(y,y,C),a.add(x,t.center,y),x[3]=1,c.transformMat4(x,x,E),K=1/Math.max(1E-6,x[3]),z[2*J]=x[0]*K,z[2*J+1]=x[1]*K;t=2*D-2;
E=z[0]*(z[3]-z[t+1])+z[t]*(z[1]-z[t-1]);for(D=2;D<t;D+=2)E+=z[D]*(z[D+3]-z[D-1]);return Math.abs(E)*G*H*.125};b.projectedRadius=u;b.set=function(t,D){a.copy(D.center,t.center);a.copy(D.halfSize,t.halfSize);e.copy(D.quaternion,t.quaternion)};b.toAaBoundingBox=function(t,D){D||(D=f.create());var E=d.fromQuat(C,t.quaternion);const G=t.halfSize[0]*Math.abs(E[0])+t.halfSize[1]*Math.abs(E[3])+t.halfSize[2]*Math.abs(E[6]),H=t.halfSize[0]*Math.abs(E[1])+t.halfSize[1]*Math.abs(E[4])+t.halfSize[2]*Math.abs(E[7]);
E=t.halfSize[0]*Math.abs(E[2])+t.halfSize[1]*Math.abs(E[5])+t.halfSize[2]*Math.abs(E[8]);D[0]=t.center[0]-G;D[1]=t.center[1]-H;D[2]=t.center[2]-E;D[3]=t.center[0]+G;D[4]=t.center[1]+H;D[5]=t.center[2]+E;return D};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/quatf32":function(){define(["exports"],function(b){function k(){const d=new Float32Array(4);d[3]=1;return d}function a(d){const c=new Float32Array(4);c[0]=d[0];c[1]=d[1];c[2]=d[2];c[3]=d[3];return c}function r(d,c,e,f){const g=
new Float32Array(4);g[0]=d;g[1]=c;g[2]=e;g[3]=f;return g}function l(d,c){return new Float32Array(d,c,4)}var h=Object.freeze({__proto__:null,create:k,clone:a,fromValues:r,createView:l});b.clone=a;b.create=k;b.createView=l;b.fromValues=r;b.quatf32=h})},"esri/views/3d/support/dito":function(){define(["exports"],function(b){function k(X,ca,R,aa,ka,da){if(!(1E-6>ca[0]*ca[0]+ca[1]*ca[1]+ca[2]*ca[2]))for(p(E,R,ca),p(G,aa,ca),p(H,ka,ca),a(X,ca,D),J[1]=D[0],I[1]=D[1],K[1]=I[1]-J[1],R=[R,aa,ka],aa=[E,G,H],
ka=0;3>ka;++ka){a(X,R[ka],D);J[0]=D[0];I[0]=D[1];a(X,aa[ka],D);J[2]=D[0];I[2]=D[1];K[0]=I[0]-J[0];K[2]=I[2]-J[2];const fa=d(K);fa<da.quality&&(g(da.b0,R[ka]),g(da.b1,ca),g(da.b2,aa[ka]),da.quality=fa)}}function a(X,ca,R){const {data:aa,offsetIdx:ka,strideIdx:da}=X;R[0]=Number.POSITIVE_INFINITY;R[1]=Number.NEGATIVE_INFINITY;for(X=ka;X<aa.length;X+=da){const fa=aa[X]*ca[0]+aa[X+1]*ca[1]+aa[X+2]*ca[2];R[0]=Math.min(R[0],fa);R[1]=Math.max(R[1],fa)}}function r(X,ca,R){g(R.center,X);f(R.halfSize,ca,.5);
R.quaternion[0]=0;R.quaternion[1]=0;R.quaternion[2]=0;R.quaternion[3]=1}function l(X,ca,R,aa,ka,da){a(X,ca,D);ka[0]=D[0];da[0]=D[1];a(X,R,D);ka[1]=D[0];da[1]=D[1];a(X,aa,D);ka[2]=D[0];da[2]=D[1]}function h(X,ca,R,aa,ka,da,fa){P[0]=X[0];P[1]=X[1];P[2]=X[2];P[3]=ca[0];P[4]=ca[1];P[5]=ca[2];P[6]=R[0];P[7]=R[1];P[8]=R[2];var ea=fa.quaternion,Y=P,Z=Y[0]+Y[4]+Y[8];if(0<Z)Z=Math.sqrt(Z+1),ea[3]=.5*Z,Z=.5/Z,ea[0]=(Y[5]-Y[7])*Z,ea[1]=(Y[6]-Y[2])*Z,ea[2]=(Y[1]-Y[3])*Z;else{Z=0;Y[4]>Y[0]&&(Z=1);Y[8]>Y[3*Z+Z]&&
(Z=2);const ba=(Z+1)%3,ia=(Z+2)%3;let ja=Math.sqrt(Y[3*Z+Z]-Y[3*ba+ba]-Y[3*ia+ia]+1);ea[Z]=.5*ja;ja=.5/ja;ea[3]=(Y[3*ba+ia]-Y[3*ia+ba])*ja;ea[ba]=(Y[3*ba+Z]+Y[3*Z+ba])*ja;ea[ia]=(Y[3*ia+Z]+Y[3*Z+ia])*ja}c(U,aa,ka);f(U,U,.5);f(fa.center,X,U[0]);f(N,ca,U[1]);c(fa.center,fa.center,N);f(N,R,U[2]);c(fa.center,fa.center,N);f(fa.halfSize,da,.5)}function d(X){return X[0]*X[1]+X[0]*X[2]+X[1]*X[2]}function c(X,ca,R){X[0]=ca[0]+R[0];X[1]=ca[1]+R[1];X[2]=ca[2]+R[2]}function e(X,ca,R){X[0]=ca[0]-R[0];X[1]=ca[1]-
R[1];X[2]=ca[2]-R[2]}function f(X,ca,R){X[0]=ca[0]*R;X[1]=ca[1]*R;X[2]=ca[2]*R}function g(X,ca,R=0){X[0]=ca[R+0];X[1]=ca[R+1];X[2]=ca[R+2]}function p(X,ca,R){const aa=ca[0],ka=ca[1];ca=ca[2];const da=R[0],fa=R[1];R=R[2];X[0]=ka*R-ca*fa;X[1]=ca*da-aa*R;X[2]=aa*fa-ka*da}function n(X,ca){var R=ca[0]*ca[0]+ca[1]*ca[1]+ca[2]*ca[2];0<R&&(R=1/Math.sqrt(R),X[0]=ca[0]*R,X[1]=ca[1]*R,X[2]=ca[2]*R)}function w(X,ca){const R=ca[0]-X[0],aa=ca[1]-X[1];X=ca[2]-X[2];return R*R+aa*aa+X*X}const q=[0,0,0],m=[0,0,0],
u=[0,0,0],v=[0,0,0],y=[0,0,0],B=[0,0,0],x=[0,0,0],C=[0,0,0],z=[0,0,0],A=[0,0,0],t=[0,0,0],D=[0,0],E=[0,0,0],G=[0,0,0],H=[0,0,0],I=[0,0,0],J=[0,0,0],K=[0,0,0],L=[0,0,0],S=[0,0,0],M=[0,0,0],T=[0,0,0],O=[0,0,0],Q=[0,0,0],F=[0,0,0],N=[0,0,0],P=[1,0,0,0,1,0,0,0,1],U=[0,0,0];let V=function(X){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var ca=0;this.minProj=new Float64Array(this.buffer,ca,7);ca+=56;this.maxProj=new Float64Array(this.buffer,ca,7);ca+=56;for(var R=0;7>R;++R)this.minVert[R]=
new Float64Array(this.buffer,ca,3),ca+=24;for(R=0;7>R;++R)this.maxVert[R]=new Float64Array(this.buffer,ca,3),ca+=24;for(ca=0;7>ca;++ca)this.minProj[ca]=Number.POSITIVE_INFINITY,this.maxProj[ca]=Number.NEGATIVE_INFINITY;ca=Array(7);R=Array(7);const {data:aa,offsetIdx:ka,strideIdx:da}=X;for(X=ka;X<aa.length;X+=da){var fa=aa[X];fa<this.minProj[0]&&(this.minProj[0]=fa,ca[0]=X);fa>this.maxProj[0]&&(this.maxProj[0]=fa,R[0]=X);fa=aa[X+1];fa<this.minProj[1]&&(this.minProj[1]=fa,ca[1]=X);fa>this.maxProj[1]&&
(this.maxProj[1]=fa,R[1]=X);fa=aa[X+2];fa<this.minProj[2]&&(this.minProj[2]=fa,ca[2]=X);fa>this.maxProj[2]&&(this.maxProj[2]=fa,R[2]=X);fa=aa[X]+aa[X+1]+aa[X+2];fa<this.minProj[3]&&(this.minProj[3]=fa,ca[3]=X);fa>this.maxProj[3]&&(this.maxProj[3]=fa,R[3]=X);fa=aa[X]+aa[X+1]-aa[X+2];fa<this.minProj[4]&&(this.minProj[4]=fa,ca[4]=X);fa>this.maxProj[4]&&(this.maxProj[4]=fa,R[4]=X);fa=aa[X]-aa[X+1]+aa[X+2];fa<this.minProj[5]&&(this.minProj[5]=fa,ca[5]=X);fa>this.maxProj[5]&&(this.maxProj[5]=fa,R[5]=X);
fa=aa[X]-aa[X+1]-aa[X+2];fa<this.minProj[6]&&(this.minProj[6]=fa,ca[6]=X);fa>this.maxProj[6]&&(this.maxProj[6]=fa,R[6]=X)}for(X=0;7>X;++X)fa=ca[X],g(this.minVert[X],aa,fa),fa=R[X],g(this.maxVert[X],aa,fa)},W=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};b.computeOBB=function(X,ca){const {data:R,strideIdx:aa}=X;var ka=R.length/aa;if(!(0>=ka)){var da=new V(X);c(q,da.minProj,da.maxProj);f(q,q,.5);e(m,da.maxProj,da.minProj);var fa=d(m),ea=new W;ea.quality=fa;14>ka&&(X={data:new Float64Array(da.buffer,
112,42),size:3,offsetIdx:0,strideIdx:3});var Y=[0,0,0],Z=[0,0,0],ba=[0,0,0];ka=[0,0,0];var ia=[0,0,0],ja=[0,0,0],la=[0,0,0];var qa=X;var na=w(da.maxVert[0],da.minVert[0]),oa=0;for(var ua=1;7>ua;++ua){const za=w(da.maxVert[ua],da.minVert[ua]);za>na&&(na=za,oa=ua)}g(Y,da.minVert[oa]);g(Z,da.maxVert[oa]);if(1E-6>w(Y,Z))qa=1;else{e(ka,Y,Z);n(ka,ka);{const {data:za,offsetIdx:Fa,strideIdx:La}=qa;da=Number.NEGATIVE_INFINITY;na=0;for(oa=Fa;oa<za.length;oa+=La)t[0]=za[oa]-Y[0],t[1]=za[oa+1]-Y[1],t[2]=za[oa+
2]-Y[2],ua=ka[0]*t[0]+ka[1]*t[1]+ka[2]*t[2],ua=t[0]*t[0]+t[1]*t[1]+t[2]*t[2]-ua*ua/(ka[0]*ka[0]+ka[1]*ka[1]+ka[2]*ka[2]),ua>da&&(da=ua,na=oa);g(ba,za,na)}1E-6>da?qa=2:(e(ia,Z,ba),n(ia,ia),e(ja,ba,Y),n(ja,ja),p(la,ia,ka),n(la,la),k(qa,la,ka,ia,ja,ea),qa=0)}switch(qa){case 1:r(q,m,ca);return;case 2:fa=X;g(S,ka);Math.abs(ka[0])>Math.abs(ka[1])&&Math.abs(ka[0])>Math.abs(ka[2])?S[0]=0:Math.abs(ka[1])>Math.abs(ka[2])?S[1]=0:S[2]=0;1E-6>S[0]*S[0]+S[1]*S[1]+S[2]*S[2]&&(S[0]=S[1]=S[2]=1);p(M,ka,S);n(M,M);
p(T,ka,M);n(T,T);l(fa,ka,M,T,O,Q);e(F,Q,O);h(ka,M,T,O,Q,F,ca);return}qa=X;{da=D;const {data:za,offsetIdx:Fa,strideIdx:La}=qa;g(v,za,Fa);g(u,v);da[0]=L[0]*la[0]+L[1]*la[1]+L[2]*la[2];da[1]=da[0];for(na=Fa+La;na<za.length;na+=La)oa=za[na]*la[0]+za[na+1]*la[1]+za[na+2]*la[2],oa<da[0]&&(da[0]=oa,g(v,za,na)),oa>da[1]&&(da[1]=oa,g(u,za,na))}la=Y[0]*la[0]+Y[1]*la[1]+Y[2]*la[2];D[1]-1E-6<=la&&(u[0]=void 0);D[0]+1E-6>=la&&(v[0]=void 0);void 0!==u[0]&&(e(y,u,Y),n(y,y),e(B,u,Z),n(B,B),e(x,u,ba),n(x,x),p(C,B,
ka),n(C,C),p(z,x,ia),n(z,z),p(A,y,ja),n(A,A),k(qa,C,ka,B,y,ea),k(qa,z,ia,x,B,ea),k(qa,A,ja,y,x,ea));void 0!==v[0]&&(e(y,v,Y),n(y,y),e(B,v,Z),n(B,B),e(x,v,ba),n(x,x),p(C,B,ka),n(C,C),p(z,x,ia),n(z,z),p(A,y,ja),n(A,A),k(qa,C,ka,B,y,ea),k(qa,z,ia,x,B,ea),k(qa,A,ja,y,x,ea));l(X,ea.b0,ea.b1,ea.b2,O,Q);X=[0,0,0];e(X,Q,O);ea.quality=d(X);ea.quality<fa?h(ea.b0,ea.b1,ea.b2,O,Q,X,ca):r(q,m,ca)}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/typedArrayUtil","../../../../../core/maybe","../../lib/AutoDisposable","./IndexRange/ComponentRangeRunLengthEncoded"],function(b,k,a,r,l){function h(d,c,e){const f=[];let g=e.length;c.forEachComponent(p=>{0<d[p]&&(g!==p-1&&(f.length&&f.push(e[g+1]-f[f.length-1]),f.push(e[p])),g=p);return!0});f.length&&f.push(e[g+1]-f[f.length-1]);return f}return function(d){function c(f,g){var p=d.call(this)||this;p.pickability=null;p.highlightCounts=null;p.cachedGeometryRanges=null;p.cachedHighlightRanges=
null;p.offsets=k.slice(g);g=p.count;p.visibility=new l.ComponentRangeRunLengthEncoded(g);p.materialDataBuffer=f.getBuffer(g);p.materialDataIndices=new Uint16Array(g);for(f=0;f<g;f++)p.materialDataIndices[f]=p.materialDataBuffer.acquireIndex();return p}b._inheritsLoose(c,d);var e=c.prototype;e.dispose=function(){d.prototype.dispose.call(this);for(let f=0;f<this.count;f++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[f])};e.highlightsDirty=function(){this.cachedHighlightRanges=null};
e.visibilityDirty=function(){this.cachedHighlightRanges=this.cachedGeometryRanges=null};b._createClass(c,[{key:"count",get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){a.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){if(a.isNone(this.highlightCounts))return null;a.isNone(this.cachedHighlightRanges)&&(this.cachedHighlightRanges=
h(this.highlightCounts,this.visibility,this.offsets));return this.cachedHighlightRanges}}]);return c}(r.AutoDisposable)})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(b){let k=function(){function a(l){this._totalCount=l;this._indexRanges=[0,l]}var r=a.prototype;r.componentCount=function(){const l=this._indexRanges;let h=0;for(let d=0;d<l.length;d+=2)h+=l[d+1];return h};r.reset=function(l){if("all"===l||l.length===
this._totalCount)this._indexRanges=[0,this._totalCount];else{{const c=[];if(0!==l.length){var h=l[0],d=1;for(let e=1;e<l.length;e++){const f=l[e];h+d===f?d+=1:(c.push(h),c.push(d),h=f,d=1)}c.push(h);c.push(d)}l=c}this._indexRanges=l}};r.forEachComponent=function(l){const h=this._indexRanges;for(let c=0;c<h.length;c+=2){var d=h[c];const e=d+h[c+1];for(;d<e;d++)if(!l(d))return!1}return!0};r.forEachComponentRange=function(l){const h=this._indexRanges;for(let d=0;d<h.length;d+=2){const c=h[d];if(!l(c,
c+h[d+1]))return!1}return!0};r.computeOffsetRanges=function(l){const h=Array(this._indexRanges.length),d=this._indexRanges;for(let e=0;e<d.length;e+=2){var c=d[e];const f=l[c];c=l[c+d[e+1]];h[e]=f;h[e+1]=c-f}return h};return a}();b.ComponentRangeRunLengthEncoded=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/interface":function(){define(["exports"],function(b){b.VISIBLE_BIT=1;b.isVaryingComponentParameters=function(k){return"function"===typeof k};
Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/util/BucketedObjectStore":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../lib/AutoDisposable"],function(b,k,a){a=function(h){function d(){var c=h.apply(this,arguments)||this;c._bucket=null;c._bucketIndex=0;return c}k._inheritsLoose(d,h);k._createClass(d,[{key:"bucketKey",get:function(){return this._bucket.key}}]);return d}(a.AutoDisposable);let r=function(){function h(){this._buckets=
new Map}var d=h.prototype;d.add=function(c,e){c=this._getBucket(c);e._bucket=c;e._bucketIndex=c.count;c.data.push(e);++c.statistics.added};d.remove=function(c){++c._bucket.statistics.removed;const e=c._bucket.data,f=e[e.length-1];e[c._bucketIndex]=f;f._bucketIndex=c._bucketIndex;e.pop();c._bucket=null;c._bucketIndex=0};d.updateKey=function(c,e){this.remove(c);this.add(e,c)};d.getBucket=function(c){return this._getBucket(c).data};d.getPerformanceInfo=function(c){return this._getBucket(c).statistics};
d.forEach=function(c){this._buckets.forEach(e=>c(e.data,e.key))};d._getBucket=function(c){var e=this._buckets.get(c);if(e)return e;e=new l(c);this._buckets.set(c,e);return e};k._createClass(h,[{key:"count",get:function(){let c=0;this._buckets.forEach(e=>c+=e.count);return c}}]);return h}(),l=function(){function h(d){this.key=d;this.data=[];this.statistics={added:0,removed:0}}k._createClass(h,[{key:"count",get:function(){return this.data.length}}]);return h}();b.BucketStorable=a;b.BucketedObjectStore=
r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable","./interface","../../core/util/BucketedObjectStore"],function(b,k,a,r,l){l=function(h){function d(){return h.apply(this,arguments)||this}b._inheritsLoose(d,h);b._createClass(d,[{key:"visible",get:function(){return!!(this.bucketKey&r.VISIBLE_BIT)}}]);
return d}(l.BucketStorable);k.__decorate([a.autoDispose()],l.prototype,"renderable",void 0);k.__decorate([a.autoDispose()],l.prototype,"components",void 0);return l})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports"],function(b){function k(a=!0){return{isVisibleBit:!a,data:new Uint32Array(0)}}b.defaultVisibilities=k;b.getVisibility=function(a,r){if(null==a)return!0;const {isVisibleBit:l,data:h}=a,d=8*h.BYTES_PER_ELEMENT;return r<h.length*d?(a=r/d|0,r=0!==(h[a]&1<<r-a*
d)===l):!a.isVisibleBit};b.updateVisibilityWithCount=function(a,r,l,h){if(l>=r)return a;null==a&&(a=k());let d=a.data;const c=8*d.BYTES_PER_ELEMENT,e=l/c|0,f=l-c*e,g=d;h=h===a.isVisibleBit;l<g.length*c||!h||(l=Math.max(e+1,Math.ceil(1.5*g.length)),l=Math.min(l,((r-1)/c|0)+1),d=new Uint32Array(l),d.set(g));e<d.length&&(d[e]=d[e]&~(1<<f)|(h?1:0)<<f);a.data=d;return a};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/buffer/BufferView ../../../../../geometry/support/aaBoundingBox ../../lib/geometryDataUtils ../../materials/internal/MaterialUtil ../../lib/ComponentUtils".split(" "),
function(b,k,a,r,l,h,d,c,e){let f=function(){function n(q,m){this._indices=k.isSome(q.indices)?q.indices:d.generateDefaultIndexArray(q.positions.length/3);this._positions=new l.BufferViewVec3f(q.positions);this._components=m}var w=n.prototype;w.getComponentAabb=function(q,m){if(k.isSome(this._perComponentAabbs)){for(let u=0;6>u;u++)m[u]=this._perComponentAabbs[6*q+u];return m}this._computePerComponentAabbs();return this.getComponentAabb(q,m)};w.getComponentPositions=function(q,m){m.indices=this._indices;
m.data=this._positions.typedBuffer;m.stride=this._positions.typedBufferStride;m.startIndex=this._components.offsets[q];m.endIndex=this._components.offsets[q+1]};w.intersect=function(q,m,u,v,y,B){const x={data:this._positions.typedBuffer,strideIdx:this._positions.typedBufferStride,offsetIdx:0,size:3},C=this._indices,z=this._components.offsets,A=c.computeInvDir(q,m,g);this._components.visibility.forEachComponent(t=>{if(!e.getVisibility(this._components.pickability,t))return!0;const D=this.getComponentAabb(t,
p);k.isSome(y)&&y.applyToAabb(D);if(!c.intersectAabbInvDir(D,q,A,u))return!0;c.intersectTriangles(q,m,z[t]/3,z[t+1]/3,C,x,void 0,y,(E,G,H)=>B(t,E,r.transformMat3(G,G,v),H));return!0})};w._computePerComponentAabbs=function(){const q=this._components.count;this._perComponentAabbs=new Float32Array(6*q);for(let m=0;m<q;m++)this._computeAABB(m)};w._computeAABB=function(q){const m=this._indices,u=this._positions;var v=this._components.offsets,y=v[q];const B=v[q+1],x=[0,0,0];v=[Infinity,Infinity,Infinity];
const C=[-Infinity,-Infinity,-Infinity];for(;y<B;y++)u.getVec(m[y],x),r.min(v,v,x),r.max(C,C,x);q*=6;this._perComponentAabbs[q++]=v[0];this._perComponentAabbs[q++]=v[1];this._perComponentAabbs[q++]=v[2];this._perComponentAabbs[q++]=C[0];this._perComponentAabbs[q++]=C[1];this._perComponentAabbs[q]=C[2]};b._createClass(n,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return n}();const g=a.create(),p=h.create();return f})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(b,k,a){let r=function(l){function h(){var d=l.apply(this,arguments)||this;d.meta={cameraDepthSquared:0,gpuMemoryEstimate:0};return d}b._inheritsLoose(h,l);return h}(a.AutoDisposable);k.__decorate([a.autoDispose()],r.prototype,"geometry",void 0);return r})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],
function(b,k,a){let r=function(l){function h(d,c,e,f){var g=l.call(this)||this;g.vao=d;g.primitiveType=c;g.parameters=e;g.indexed=f;return g}b._inheritsLoose(h,l);return h}(a.AutoDisposable);k.__decorate([a.autoDispose()],r.prototype,"vao",void 0);return r})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(b,k){let a=function(){function r(h){this._objects=h}var l=r.prototype;l.submit=function(h,d){this._objects.preSubmit(d);
d=this._objects.visibleObjects;for(let c=0;c<d.length;c++){const e=d[c];e.renderable.material.submit(h,e)}};l.queryShadowCasterDepthRange=function(h){return this._objects.visibleObjects.length?k.computeDepthRange(h,this._objects.visibleObjects):null};return r}();b.RenderSubmitSystem=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/PooledArray ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat3f64 ../../../../../chunks/quatf64 ../../../../../chunks/mat3 ../../../../../chunks/quat ../../../../../chunks/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){function p(I,J,K){return r.set(I,J.data[K+0],J.data[K+1],J.data[K+2])}function n(I,J){I.push(J[0]);I.push(J[1]);I.push(J[2])}function w(I,J,K,L){c.conjugate(A,I.quaternion);r.sub(t,J,I.center);r.transformQuat(t,t,A);const S=8*((t[0]<-I.halfSize[0]?-1:t[0]>I.halfSize[0]?1:0)+3*(t[1]<-I.halfSize[1]?-1:t[1]>I.halfSize[1]?1:0)+9*(t[2]<-I.halfSize[2]?-1:t[2]>I.halfSize[2]?1:0)+13);J=C[S];if(0===J)return J;d.fromQuat(z,I.quaternion);d.scale(z,z,I.halfSize);const M=(T,O)=>
{O=C[S+O+1];r.set(T,((O&1)<<1)-1,(O&2)-1,((O&4)>>1)-1);r.transformMat3(T,T,z);return r.add(T,I.center,T)};K.length=0;n(K,M(D,0));n(K,M(E,1));n(K,M(t,2));n(K,M(G,3));L(K);if(1===J)return J;K.length=0;n(K,D);n(K,G);n(K,M(t,4));n(K,M(H,5));L(K);if(2===J)return J;K.length=0;n(K,D);n(K,H);n(K,M(t,6));n(K,E);L(K);return J}function q(I,J){let K=0;for(let L=0;4>L;L++){const S=f.intersectPlane(I,J[L]);if(0<S)return-1;0===S&&(K|=1<<L)}return K}const m=new k({allocator:I=>I||{near:Infinity,far:-Infinity,mask:0,
object:null},deallocator:I=>{I.object=null;return I}}),u=g.empty(),v=a.create(),y=a.create(),B=new k({deallocator:null}),x=new k({deallocator:null}),C=(()=>{const I=new Int8Array(216);let J=0;const K=L=>{for(let S=0;S<L.length;S++)I[J+S]=L[S];J+=8};K([3,0,6,2,3,1,5,4]);K([2,0,2,3,1,5,4,0]);K([3,1,0,2,3,7,5,4]);K([2,0,1,3,2,6,4,0]);K([1,0,1,3,2,0,0,0]);K([2,1,5,7,3,2,0,0]);K([3,2,0,1,3,7,6,4]);K([2,2,0,1,3,7,6,0]);K([3,3,0,1,5,7,6,2]);K([2,0,1,5,4,6,2,0]);K([1,0,1,5,4,0,0,0]);K([2,1,3,7,5,4,0,0]);
K([1,0,2,6,4,0,0,0]);K([0,0,0,0,0,0,0,0]);K([1,1,3,7,5,0,0,0]);K([2,2,3,7,6,4,0,0]);K([1,2,3,7,6,0,0,0]);K([2,3,1,5,7,6,2,0]);K([3,4,0,1,5,7,6,2]);K([2,5,7,6,4,0,1,0]);K([3,5,0,1,3,7,6,4]);K([2,4,5,7,6,2,0,0]);K([1,4,5,7,6,0,0,0]);K([2,5,1,3,7,6,4,0]);K([3,6,0,2,3,7,5,4]);K([2,6,2,3,7,5,4,0]);K([3,7,6,2,3,1,5,4]);return I})(),z=l.create(),A=h.create(),t=a.create(),D=a.create(),E=a.create(),G=a.create(),H=a.create();b.computeDepthRange=function(I,J){const K=g.empty(),L=I.eye,S=I.viewForward,M=I.frustum.planes;
for(I=0;I<J.length;I++){var T=J[I].obb;const O=r.dot(r.sub(t,T.center,L),S),Q=f.projectedRadius(T,S);if(g.within(K,O-Q)&&g.within(K,O+Q))continue;T=q(T,M);if(-1===T)continue;if(0===T){u.far=O+Q;u.near=O-Q;g.union(K,u);continue}const F=m.pushNew();F.near=O-Q;F.far=O+Q;F.mask=T;F.object=J[I]}for(J=0;J<m.length;J++){const O=m.data[J];g.within(K,O.near)&&g.within(K,O.far)||(u.far=O.far,u.near=Infinity,0===w(O.object.obb,L,B,Q=>{var F=x;for(var N=0;4>N&&0<Q.length;N++)if(0!==(O.mask&1<<N)){{var P=M[N],
U=Q,V=F;V.length=0;const W=U.length-3;p(v,U,W);const X=e.signedDistance(P,v);0>=X&&(V.push(v[0]),V.push(v[1]),V.push(v[2]));let ca=0,R=X;for(ca;ca<W;ca+=3){p(y,U,ca);const aa=e.signedDistance(P,y);0>R*aa&&(r.lerp(v,y,v,aa/(aa-R)),n(V,v));0>=aa&&n(V,y);R=aa;r.copy(v,y)}0>R*X&&(p(y,U,W),r.lerp(v,y,v,X/(X-R)),n(V,v))}P=Q;Q=F;F=P}for(F=0;F<Q.length;F+=3)r.set(v,Q.data[F+0],Q.data[F+1],Q.data[F+2]),N=r.dot(r.sub(v,v,L),S),u.near=Math.min(u.near,N)})&&(u.near=0),g.union(K,u))}m.length=0;return K};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(b){function k(r,l){return{near:r,far:l}}function a(r,l,h){r.near=l;r.far=h;return r}b.create=k;b.empty=function(r){return r?a(r,Infinity,-Infinity):k(Infinity,-Infinity)};b.set=a;b.union=function(r,l,h=r){h.near=Math.min(r.near,l.near);h.far=Math.max(r.far,l.far);return h};b.within=function(r,l){return r.near<=l&&l<=r.far};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports",
"../../../support/buffer/InterleavedLayout"],function(b,k){b.createVertexBufferLayout=function(a){const r=k.newLayout().vec3f("position");a.normals&&r.vec2i16("normalCompressed",{glNormalized:!0});1===a.textureCoordinates?r.vec2f("uv0"):2===a.textureCoordinates&&(r.vec2f("uv0"),r.vec4u16("uvRegion",{glNormalized:!0}));a.colors&&r.vec4u8("color",{glNormalized:!0});return r.alignTo(4)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../../../webgl/Program ../../../../../webgl/renderState ../../../core/shaderLibrary/Slice.glsl ../../../core/shaderLibrary/output/OutputHighlight.glsl ../../../lib/OrderIndependentTransparency ../../../lib/StencilUtils ../../../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../../../../chunks/ComponentShader.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x){const C={DIFFUSE:0,COMPONENT_COLOR:1,NORMAL:2,EMISSION:3,OCCLUSION:4,METALLIC_ROUGHNESS:5,OVERLAY0_COLOR:2,OVERLAY1_COLOR:3,OVERLAY0_NORMAL:4,OVERLAY1_NORMAL:5,SSAO:6,SHADOW_MAP:7,PREPASS_LINEAR_DEPTH:8,LAST_FRAME_COLOR:9};e=function(A){function t(){return A.apply(this,arguments)||this}a._inheritsLoose(t,A);var D=t.prototype;D.bindPass=function(E,G){const H=this.program;B.VertexPosition.bindViewProjTransform(H,G.viewTransform);n.Slice.bindUniforms(this.program,
this.configuration,G.slicePlane);0===G.identifier&&void 0!==G.ssrParams&&(G.ssrParams.lastFrameColorTextureID=C.LAST_FRAME_COLOR,G.ssrParams.linearDepthTextureID=C.PREPASS_LINEAR_DEPTH,u.ScreenSpaceReflections.bindUniforms(this.program,E,G.ssrParams));0===G.identifier&&(H.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",G.transformNormal_ViewFromGlobal),2===G.subPass&&H.setUniform2fv("uCameraNearFar",G.cameraNearFar),0===G.subPass&&(G.ambientOcclusionEnabled&&G.ambientOcclusion.bind(H,C.SSAO),
G.shadowsEnabled&&G.shadowMap.bind(H,C.SHADOW_MAP),G.lighting.setUniforms(this.program,G.integratedMesh)));1===G.identifier&&this.program.setUniform2fv("uCameraNearFar",G.cameraNearFar);2===G.identifier&&w.OutputHighlight.bindOutputHighlight(E,this.program,G)};D.bindDraw=function(E,G){B.VertexPosition.bindModelTransform(this.program,E);this.program.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",E.transformNormal_GlobalFromModel);if(G.isIntegratedMesh){const H=G.overlayTexScale;G=G.overlayTexOffset;
this.program.setUniform4fv("overlayTexOffset",[E.toMapSpace[0]*H[0]+G[0],E.toMapSpace[1]*H[1]+G[1],E.toMapSpace[0]*H[2]+G[2],E.toMapSpace[1]*H[3]+G[3]]);this.program.setUniform4fv("overlayTexScale",[E.toMapSpace[2]*H[0],E.toMapSpace[3]*H[1],E.toMapSpace[2]*H[2],E.toMapSpace[3]*H[3]])}};D.bindMaterial=function(E,G,H){const I=this.program;I.setUniform4fv("uBaseColor",G.baseColor);I.setUniform1f("uObjectOpacity",G.objectOpacity);I.setUniform1f("textureAlphaCutoff",G.alphaCutoff);1===G.componentParameters.type?
G.componentParameters.texture.bind(I,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:C.COMPONENT_COLOR}):(I.setUniform4fv("uExternalColor",G.componentParameters.externalColor),I.setUniform1i("uExternalColorMixMode",G.componentParameters.externalColorMixMode));l.isSome(G.baseColorTexture)&&G.baseColorTexture.bind(E,I,"uBaseColorTexture",C.DIFFUSE,"uBaseColorTextureSize");if(0===this.configuration.output||7===this.configuration.output)y.PhysicallyBasedRenderingParameters.bindUniforms(this.program,
G),l.isSome(G.metallicRoughnessTexture)&&G.metallicRoughnessTexture.bind(E,I,"texMetallicRoughness",C.METALLIC_ROUGHNESS,"texMetallicRoughnessSize"),l.isSome(G.emissionTexture)&&G.emissionTexture.bind(E,I,"texEmission",C.EMISSION,"texEmissionSize"),l.isSome(G.occlusionTexture)&&G.occlusionTexture.bind(E,I,"texOcclusion",C.OCCLUSION,"texOcclusionSize"),l.isSome(G.normalTexture)&&G.normalTexture.bind(E,I,"normalTexture",C.NORMAL,"normalTextureSize");G.isIntegratedMesh&&(0===H.identifier&&0===H.subPass?
(E.bindTexture(l.unwrap(G.overlayColorInner),C.OVERLAY0_COLOR),E.bindTexture(l.unwrap(G.overlayColorOuter),C.OVERLAY1_COLOR),E.bindTexture(l.unwrap(G.overlayNormalInner),C.OVERLAY0_NORMAL),E.bindTexture(l.unwrap(G.overlayNormalOuter),C.OVERLAY1_NORMAL),I.setUniform1i("ovInnerNormalTex",C.OVERLAY0_NORMAL),I.setUniform1i("ovOuterNormalTex",C.OVERLAY1_NORMAL)):2===H.identifier&&(E.bindTexture(l.unwrap(G.overlayHighlightInner),C.OVERLAY0_COLOR),E.bindTexture(l.unwrap(G.overlayHighlightOuter),C.OVERLAY1_COLOR)),
I.setUniform1i("ovInnerColorTex",C.OVERLAY0_COLOR),I.setUniform1i("ovOuterColorTex",C.OVERLAY1_COLOR),I.setUniform1f("overlayOpacity",1))};D.initializeProgram=function(E){const G=t.shader.get();var H=this.configuration;H=G.build({OITEnabled:0===H.transparencyPassType,output:H.output,normalType:0===H.integratedMeshMode?H.hasNormals?1:3:2,attributeColor:H.hasVertexColors,attributeTextureCoordinates:H.vertexTextureCoordinates,componentData:H.componentData,alphaDiscardMode:H.alphaDiscardMode,baseColorTexture:H.baseColorTexture,
doubleSidedMode:H.doubleSidedMode,receiveAmbientOcclusion:H.receiveAmbientOcclusion,receiveShadows:H.receiveShadows,slicePlaneEnabled:H.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!1,viewingMode:E.viewingMode,vertexDiscardMode:H.vertexDiscardMode,pbrMode:3===H.integratedMeshMode?4:H.usePBR?1:0,hasMetalnessAndRoughnessTexture:H.hasMetalnessAndRoughnessTexture,hasEmissionTexture:H.hasEmissionTexture,hasOcclusionTexture:H.hasOcclusionTexture,hasNormalTexture:H.hasNormalTexture,
vertexTangets:!1,useOldSceneLightInterface:!1,supportsTextureAtlas:!0,doublePrecisionRequiresObfuscation:v.doublePrecisionRequiresObfuscation(E.rctx),overlayEnabled:2===H.integratedMeshMode||3===H.integratedMeshMode,ssrEnabled:H.ssrEnabled,highStepCount:!1,ellipsoidMode:H.ellipsoidMode});return new g(E.rctx,H.generateSource("vertex"),H.generateSource("fragment"),G.attributeLocations)};D.setPipelineState=function(E){const G=this.configuration,H=0!==G.integratedMeshMode,I=3===E,J=2===E;return p.makePipelineState({blending:0!==
G.output&&7!==G.output||!G.blendingEnabled?null:I?q.blendingDefault:q.OITBlending(E),culling:z[G.cullFace],depthTest:{func:q.OITDepthTest(E)},depthWrite:I||J?p.defaultDepthWriteParams:null,colorWrite:p.defaultColorWriteParams,stencilWrite:H||G.sceneHasOcludees?m.stencilWriteMaskOn:null,stencilTest:H?m.replaceBitWhenDepthTestPasses(1):G.sceneHasOcludees?m.stencilBaseAllZerosParams:null,polygonOffset:I||J?G.polygonOffsetEnabled?{factor:2,units:2}:null:q.OITPolygonOffset})};D.initializePipeline=function(){return this.setPipelineState(this.configuration.transparencyPassType)};
return t}(e.ShaderTechnique);e.shader=new c.ReloadableShaderModule(x.ComponentShader,()=>new Promise(function(A,t){b(["./shader/ComponentShader.glsl"],A,t)}));const z=[null,{face:1028,mode:2305},{face:1029,mode:2305}];c=function(A){function t(){var D=A.apply(this,arguments)||this;D.transformNormal_GlobalFromModel=h.create();D.toMapSpace=d.create();return D}a._inheritsLoose(t,A);return t}(B.VertexPosition.ModelTransform);x=function(A){function t(){var D=A.apply(this,arguments)||this;D.output=0;D.hasVertexColors=
!1;D.hasNormals=!1;D.vertexTextureCoordinates=0;D.componentData=0;D.slicePlaneEnabled=!1;D.cullFace=2;D.baseColorTexture=!1;D.receiveAmbientOcclusion=!0;D.receiveShadows=!0;D.vertexDiscardMode=0;D.doubleSidedMode=2;D.blendingEnabled=!0;D.alphaDiscardMode=1;D.integratedMeshMode=0;D.ssrEnabled=!1;D.polygonOffsetEnabled=!1;D.usePBR=!1;D.hasMetalnessAndRoughnessTexture=!1;D.hasEmissionTexture=!1;D.hasOcclusionTexture=!1;D.hasNormalTexture=!1;D.sceneHasOcludees=!1;D.transparencyPassType=3;D.ellipsoidMode=
1;return D}a._inheritsLoose(t,A);return t}(f.ShaderTechniqueConfiguration);r.__decorate([f.parameter({count:8})],x.prototype,"output",void 0);r.__decorate([f.parameter()],x.prototype,"hasVertexColors",void 0);r.__decorate([f.parameter()],x.prototype,"hasNormals",void 0);r.__decorate([f.parameter({count:3})],x.prototype,"vertexTextureCoordinates",void 0);r.__decorate([f.parameter({count:2})],x.prototype,"componentData",void 0);r.__decorate([f.parameter()],x.prototype,"slicePlaneEnabled",void 0);r.__decorate([f.parameter({count:3})],
x.prototype,"cullFace",void 0);r.__decorate([f.parameter()],x.prototype,"baseColorTexture",void 0);r.__decorate([f.parameter()],x.prototype,"receiveAmbientOcclusion",void 0);r.__decorate([f.parameter()],x.prototype,"receiveShadows",void 0);r.__decorate([f.parameter({count:3})],x.prototype,"vertexDiscardMode",void 0);r.__decorate([f.parameter({count:3})],x.prototype,"doubleSidedMode",void 0);r.__decorate([f.parameter()],x.prototype,"blendingEnabled",void 0);r.__decorate([f.parameter({count:4})],x.prototype,
"alphaDiscardMode",void 0);r.__decorate([f.parameter({count:4})],x.prototype,"integratedMeshMode",void 0);r.__decorate([f.parameter()],x.prototype,"ssrEnabled",void 0);r.__decorate([f.parameter()],x.prototype,"polygonOffsetEnabled",void 0);r.__decorate([f.parameter()],x.prototype,"usePBR",void 0);r.__decorate([f.parameter()],x.prototype,"hasMetalnessAndRoughnessTexture",void 0);r.__decorate([f.parameter()],x.prototype,"hasEmissionTexture",void 0);r.__decorate([f.parameter()],x.prototype,"hasOcclusionTexture",
void 0);r.__decorate([f.parameter()],x.prototype,"hasNormalTexture",void 0);r.__decorate([f.parameter()],x.prototype,"sceneHasOcludees",void 0);r.__decorate([f.parameter({count:4})],x.prototype,"transparencyPassType",void 0);r.__decorate([f.parameter({count:4})],x.prototype,"ellipsoidMode",void 0);k.ComponentDrawParameters=c;k.ComponentTechnique=e;k.ComponentTechniqueConfiguration=x;k.TextureUnits=C;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){function A(E){const G=new r.ShaderBuilder;G.include(w.VertexPosition,E);G.include(q.VertexNormal,E);G.include(c.VertexColor,E);G.include(p.TextureCoordinateAttribute,E);G.include(g.ForwardLinearDepth,E);G.include(y.ComponentData,E);G.include(d.DiscardOrAdjustAlpha,E);G.include(l.Slice,E);G.include(z.ReadBaseColorTexture,E);G.include(B.VertexDiscardByOpacity,E);G.fragment.uniforms.add("view","mat4");if(1===E.pbrMode||2===E.pbrMode)G.include(n.PhysicallyBasedRenderingParameters,
E),G.include(m.ComputeNormalTexture,E);3===E.output&&1===E.componentData?G.vertex.code.add(a.glsl`
      #define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }
    `):G.vertex.code.add(a.glsl`
      #define discardShadows(castShadows) {}
    `);const H=E.overlayEnabled&&0===E.output&&4===E.pbrMode;E.overlayEnabled&&(G.include(v.Overlay,E),1===E.viewingMode?G.vertex.code.add(a.glsl`
      const float invEllipsoidRadius = ${a.glsl.float(1/(1===E.ellipsoidMode?k.earth.radius:2===E.ellipsoidMode?k.mars.radius:k.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):G.vertex.code.add(a.glsl`
      vec2 projectOverlay(vec3 pos) { return pos.xy; }
      `));H&&(G.varyings.add("tbnTangent","vec3"),G.varyings.add("tbnBiTangent","vec3"),G.varyings.add("groundNormal","vec3"),G.varyings.add("positionView","vec3"));G.vertex.code.add(a.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${a.glsl.float(d.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
      forwardPosition();
      forwardNormal();
      ${H?a.glsl`
        positionView = position_view();
        ${1===E.viewingMode?a.glsl`
        groundNormal = normalize(positionWorld());
        tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:a.glsl`
        groundNormal = vec3(0.0, 0.0, 1.0);
        tbnTangent = vec3(1.0, 0.0, 0.0);
        tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`}
        `:""}

      ${E.overlayEnabled?a.glsl`setOverlayVTC(projectOverlay(position));`:""}
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth(); // depends on forwardPosition()
    }
  `);7===E.output&&(G.include(x.ComputeMaterialColor,E),G.fragment.code.add(a.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${E.overlayEnabled?a.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `));0===E.output&&(G.include(x.ComputeMaterialColor,E),G.include(C.ComputeShadingNormal,E),G.include(u.EvaluateSceneLighting,E),H&&(G.fragment.uniforms.add("ovInnerNormalTex","sampler2D"),G.fragment.uniforms.add("ovOuterNormalTex","sampler2D")),E.receiveShadows?(G.include(f.ReadShadowMap,E),G.fragment.code.add(a.glsl`
        float evaluateShadow() {
          return readShadowMap(vPositionWorldCameraRelative, linearDepth);
        }
      `)):G.fragment.code.add(a.glsl`
        float evaluateShadow() { return 0.0; }
      `),G.fragment.code.add(a.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${E.overlayEnabled?a.glsl`
        vec4 overlayColorOpaque = getOverlayColor(ovInnerColorTex, ovOuterColorTex, vtcOverlay);
        vec4 overlayColor = overlayOpacity * overlayColorOpaque;
        materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}
    `),1===E.pbrMode||2===E.pbrMode?(G.fragment.code.add(a.glsl`
        ${1===E.pbrMode?a.glsl`
        applyPBRFactors();
        if (int(externalColorMixMode) == 3) {
          mrr = vec3(0.0, 0.6, 0.2);
        }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),E.hasNormalTexture?G.fragment.code.add(a.glsl`
        mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
        vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);
        `):G.fragment.code.add(a.glsl`
        vec3 shadingNormal = normalVertex;
        `),G.fragment.code.add(a.glsl`${1===E.viewingMode?a.glsl`vec3 normalGround = normalize(positionWorld());`:a.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),G.fragment.code.add(a.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());
        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(E.receiveShadows?G.fragment.code.add(a.glsl`
      float shadow = evaluateShadow();
        `):1===E.viewingMode?G.fragment.code.add(a.glsl`
      float additionalAmbientScale = _oldHeuristicLighting(positionWorld());
      float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);
        `):G.fragment.code.add(a.glsl`
      float shadow = 0.0;
      `),G.fragment.code.add(a.glsl`
      float ambientOcclusion = evaluateAmbientOcclusion();
      // At global scale we create some additional ambient light based on the main light to simulate global illumination
      vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());
      vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${H?a.glsl`
          vec4 overlayWaterMask = getOverlayColor(ovInnerNormalTex, ovOuterNormalTex, vtcOverlay);
          float waterNormalLength = length(overlayWaterMask);
          if (waterNormalLength > 0.95) {
            mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
            vec4 waterOverlayColor = vec4(overlayColorOpaque.xyz, overlayColor.w);
            vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, positionView);
            vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
            // un-gamma the ground color to mix in linear space
            shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
          }`:""}
      `)),G.fragment.code.add(a.glsl`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${E.OITEnabled?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(1===E.output||3===E.output)G.include(e.OutputDepth,E),G.fragment.code.add(a.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        outputDepth(linearDepth);
      }
    `);2===E.output&&(G.include(C.ComputeShadingNormal,E),G.fragment.code.add(a.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${2===E.normalType?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));4===E.output&&(G.include(h.OutputHighlight),G.fragment.code.add(a.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${E.overlayEnabled?a.glsl`
        vec4 overlayColor = getCombinedOverlayColor();

        if (overlayColor.a == 0.0) {
          gl_FragColor = vec4(0.0);
          return;
        }`:""}

        outputHighlight();
      }
    `));return G}const t={position:0,normal:1,normalCompressed:1,color:2,uv0:3,uvRegion:4,componentIndex:5};var D=Object.freeze({__proto__:null,attributeLocations:t,build:A});b.ComponentShader=D;b.attributeLocations=t;b.build=A})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces","./DecodeSymbolColor.glsl"],function(b,k,a){b.ComponentData=function(r,l){1===l.componentData&&(r.vertex.uniforms.add("uComponentColorTex",
"sampler2D"),r.vertex.uniforms.add("uComponentColorTexInvDim","vec2"),r.attributes.add("componentIndex","float"),r.varyings.add("vExternalColorMixMode","mediump float"),r.varyings.add("vExternalColor","vec4"),r.include(a.DecodeSymbolColor),r.vertex.code.add(k.glsl`
      vec4 _readComponentColor() {
        float normalizedIndex = (componentIndex + 0.5) * uComponentColorTexInvDim.x;
        vec2 indexCoord = vec2(
          mod(normalizedIndex, 1.0),
          (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y
        );
        return texture2D(uComponentColorTex, indexCoord);
       }

      vec4 forwardExternalColor(out bool castShadows) {
        vec4 componentColor = _readComponentColor() * 255.0;

        float shadowFlag = mod(componentColor.b * 255.0, 2.0);
        componentColor.b -= shadowFlag;
        castShadows = shadowFlag >= 1.0;

        int decodedColorMixMode;
        vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
        vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

        return vExternalColor;
      }
    `),r.fragment.code.add(k.glsl`
      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
        externalColor = vExternalColor;
        externalColorMixMode = int(vExternalColorMixMode);
      }
    `));0===l.componentData&&(r.vertex.uniforms.add("uExternalColor","vec4"),r.fragment.uniforms.add("uExternalColorMixMode","int"),r.varyings.add("vExternalColor","vec4"),r.vertex.code.add(k.glsl`
      vec4 forwardExternalColor(out bool castShadows) {
        vExternalColor = uExternalColor;
        castShadows = true;
        return uExternalColor;
      }
    `),r.fragment.code.add(k.glsl`
      void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
        externalColor = vExternalColor;
        externalColorMixMode = uExternalColorMixMode;
      }
    `))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(b,k){b.VertexDiscardByOpacity=function(a,r){a=a.vertex;a.code.add(k.glsl`
  #define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)
  `);switch(r.vertexDiscardMode){case 0:a.code.add(k.glsl`
        #define vertexDiscardByOpacity(_opacity_) {}
      `);break;case 2:a.code.add(k.glsl`
        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }
      `);break;case 1:a.code.add(k.glsl`
        #define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }
      `)}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../attributes/VertexColor.glsl","../util/MixExternalColor.glsl"],function(b,k,a,r){b.ComputeMaterialColor=function(l,h){l.include(a.VertexColor,h);l.fragment.include(r.MixExternalColor);l=l.fragment;l.uniforms.add("uBaseColor","vec4");l.uniforms.add("uObjectOpacity","float");h.attributeColor?
l.code.add(k.glsl`
      vec3 _baseColor() {
        // combine the old material parameters into a single one
        return uBaseColor.rgb * vColor.rgb;
      }

      float _baseOpacity() {
        return uBaseColor.a * vColor.a;
      }
    `):l.code.add(k.glsl`
      vec3 _baseColor() {
        // combine the old material parameters into a single one
        return uBaseColor.rgb;
      }

      float _baseOpacity() {
        return uBaseColor.a;
      }
    `);l.code.add(k.glsl`
    vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
      vec3 baseColor = _baseColor();
      float baseOpacity = _baseOpacity();

      vec3 color = mixExternalColor(
        baseColor,
        textureColor.rgb,
        externalColor.rgb,
        externalColorMixMode
      );
      float opacity = uObjectOpacity * mixExternalOpacity(
        baseOpacity,
        textureColor.a,
        externalColor.a,
        externalColorMixMode
      );

      return vec4(color, opacity);
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define(["exports","../../shaderModules/interfaces","../attributes/VertexPosition.glsl","../attributes/VertexNormal.glsl"],function(b,k,a,r){b.ComputeShadingNormal=function(l,h){const d=l.fragment;0===h.doubleSidedMode?d.code.add(k.glsl`
      vec3 _adjustDoublesided(vec3 normal) {
        return normal;
      }
    `):1===h.doubleSidedMode?(l.include(a.VertexPosition,h),d.uniforms.add("uTransform_ViewFromCameraLocal_T","vec3"),d.code.add(k.glsl`
      vec3 _adjustDoublesided(vec3 normal) {
        vec3 viewDir = vPositionWorldCameraRelative + uTransform_ViewFromCameraLocal_T;
        return dot(normal, viewDir) > 0.0 ? -normal : normal;
      }
    `)):2===h.doubleSidedMode&&d.code.add(k.glsl`
      vec3 _adjustDoublesided(vec3 normal) {
        return gl_FrontFacing ? normal : -normal;
      }
    `);0===h.normalType||1===h.normalType?(l.include(r.VertexNormal,h),d.code.add(k.glsl`
      vec3 shadingNormalWorld() {
        return _adjustDoublesided(normalize(vNormalWorld));
      }

      vec3 shadingNormal_view() {
        vec3 normal = normalize(vNormalView);
        return gl_FrontFacing ? normal : -normal;
      }
    `)):3===h.normalType?(l.extensions.add("GL_OES_standard_derivatives"),l.include(a.VertexPosition,h),d.code.add(k.glsl`
      vec3 shadingNormalWorld() {
        return normalize(cross(
          dFdx(vPositionWorldCameraRelative),
          dFdy(vPositionWorldCameraRelative)
        ));
      }

      vec3 shadingNormal_view() {
        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
      }
    `)):2===h.normalType&&(1===h.viewingMode?(l.include(a.VertexPosition,h),d.code.add(k.glsl`
        vec3 shadingNormalWorld() {
          return normalize(positionWorld());
        }
      `)):2===h.viewingMode&&d.code.add(k.glsl`
        vec3 shadingNormalWorld() {
          return vec3(0.0, 0.0, 1.0);
        }
      `),l.extensions.add("GL_OES_standard_derivatives"),d.code.add(k.glsl`
      vec3 shadingNormal_view() {
        return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
      }
    `))};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define(["exports","../../shaderModules/interfaces","../util/TextureAtlasLookup.glsl","../attributes/VertexTextureCoordinates.glsl"],function(b,k,a,r){b.ReadBaseColorTexture=function(l,h){const d=l.fragment;h.baseColorTexture?(l.include(r.VertexTextureCoordinates,h),d.uniforms.add("uBaseColorTexture","sampler2D"),d.uniforms.add("uBaseColorTextureSize",
"vec2"),2===h.attributeTextureCoordinates?(l.include(a.TextureAtlasLookup),d.code.add(k.glsl`
        vec4 readBaseColorTexture() {
          return textureAtlasLookup(
            uBaseColorTexture,
            uBaseColorTextureSize,
            vuv0,
            vuvRegion
          );
        }
      `)):d.code.add(k.glsl`
        vec4 readBaseColorTexture() {
          return texture2D(uBaseColorTexture, vuv0);
        }
      `)):d.code.add(k.glsl`
      vec4 readBaseColorTexture() { return vec4(1.0); }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/vec3 ../../../../../../chunks/vec4f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec3f32 ../../../core/shaderLibrary/util/AlphaDiscard.glsl ../../../../../../chunks/vec4f32 ../../../../../../chunks/ComponentShader.glsl ./ComponentTechnique ../../../core/material/MaterialBase".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){function w(v){switch(v){case 0:return 0;case 1:return 7;case 2:return 1;case 3:return 2;case 4:return 8}}let q=function(v){function y(){var x=v.call(this)||this;x.baseColor=f.fromValues(1,1,1,1);x.usePBR=!1;x.mrrFactors=c.fromValues(1,1,.5);x.emissiveFactor=c.fromValues(0,0,0);x.baseColorTexture=null;x.metallicRoughnessTexture=null;x.emissionTexture=null;x.occlusionTexture=null;x.normalTexture=null;x.overlayTexOffset=h.fromValues(-1,-1,-1,-1);x.overlayTexScale=
h.fromValues(0,0,0,0);x.overlayColorInner=null;x.overlayColorOuter=null;x.overlayHighlightInner=null;x.overlayHighlightOuter=null;x.overlayNormalInner=null;x.overlayNormalOuter=null;x.objectOpacity=1;x.commonMaterialParameters=new m;x.componentParameters=new u;x.alphaCutoff=e.defaultMaskAlphaCutoff;x.alphaDiscardMode=1;x.isIntegratedMesh=!1;x.polygonOffsetEnabled=!1;x.ellipsoidMode=1;x.sceneHasOcludees=!1;x._techniqueConfig=new p.ComponentTechniqueConfiguration;return x}k._inheritsLoose(y,v);var B=
y.prototype;B.dispose=function(x){this._technique&&(x.release(this._technique),this._technique=void 0);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};B.getTechnique=function(x,C,z){const A=this._techniqueConfig;A.hasVertexColors=z.colors;A.hasNormals=z.normals;A.vertexTextureCoordinates=z.textureCoordinates;A.usePBR=this.usePBR;A.hasMetalnessAndRoughnessTexture=r.isSome(this.metallicRoughnessTexture);A.hasEmissionTexture=r.isSome(this.emissionTexture);
A.hasOcclusionTexture=r.isSome(this.occlusionTexture);A.hasNormalTexture=r.isSome(this.normalTexture);A.transparencyPassType=0===C.identifier&&null!=C.transparencyPassType?C.transparencyPassType:3;A.ellipsoidMode=this.ellipsoidMode;this.dirty&&(A.componentData=this.componentParameters.type,A.cullFace=this.commonMaterialParameters.cullFace,A.doubleSidedMode=this.commonMaterialParameters.doubleSided?1:0,A.baseColorTexture=r.isSome(this.baseColorTexture),z=this._computeWhichMaterialPass(),A.blendingEnabled=
1===z||2===z,A.alphaDiscardMode=this.alphaDiscardMode,A.integratedMeshMode=this.isIntegratedMesh?this.overlayColorInner||this.overlayColorOuter?this.overlayNormalInner||this.overlayNormalOuter?3:2:1:0,A.polygonOffsetEnabled=this.polygonOffsetEnabled,this._setClean());A.slicePlaneEnabled=C.slicePlaneEnabled&&this.commonMaterialParameters.slicePlaneEnabled;1===C.identifier?(A.output=3,A.vertexDiscardMode=0):2===C.identifier?(A.output=4,A.vertexDiscardMode=0):(2===this._computeWhichMaterialPass()?A.vertexDiscardMode=
C.transparent?2:1:A.vertexDiscardMode=0,A.output=w(C.subPass),1===C.subPass&&(A.sceneHasOcludees=C.sceneHasOcludees),0===C.subPass?(A.receiveAmbientOcclusion=C.ambientOcclusionEnabled,A.sceneHasOcludees=C.sceneHasOcludees,A.receiveShadows=C.shadowsEnabled,A.ssrEnabled=C.ssrParams.ssrEnabled):(A.receiveAmbientOcclusion=!1,A.receiveShadows=!1));return this._technique=x.repository.acquireAndReleaseExisting(p.ComponentTechnique,A,this._technique)};B.submit=function(x,C){const z=C.renderable.geometry;
var A=C.components;const t=C.renderable.drawParameters;C=C.renderable.meta.cameraDepthSquared;const D=A.geometryRanges;A=A.highlightRanges;switch(this._computeWhichMaterialPass()){case 0:x.materialOpaque.submitDraw(this,z,D,t,C);break;case 1:x.materialTransparent.submitDraw(this,z,D,t,C);break;case 2:x.materialOpaque.submitDraw(this,z,D,t,C);x.materialTransparent.submitDraw(this,z,D,t,C);break;case 3:x.materialIntegratedMesh.submitDraw(this,z,D,t,C),(this.overlayHighlightInner||this.overlayHighlightOuter)&&
x.highlightIntegratedMesh.submitDraw(this,z,D,t,C)}r.isSome(x.shadowMap)&&2!==this.componentParameters.castShadows&&x.shadowMap.submitDraw(this,z,D,t,C);r.isSome(x.highlight)&&r.isSome(A)&&x.highlight.submitDraw(this,z,A,t,C)};B._computeWhichMaterialPass=function(){return this.isIntegratedMesh?3:1>this.objectOpacity?1:0===this.componentParameters.opaqueOverride?0:1>this.baseColor[3]||0===this.alphaDiscardMode||3===this.alphaDiscardMode?1:2===this.componentParameters.transparent?0:0===this.componentParameters.transparent?
1:2};k._createClass(y,[{key:"attributeLocations",get:function(){return g.attributeLocations}}]);return y}(n.MaterialBase);a.__decorate([n.parameter({vectorOps:d.vec4})],q.prototype,"baseColor",void 0);a.__decorate([n.parameter()],q.prototype,"usePBR",void 0);a.__decorate([n.parameter({vectorOps:l.vec3})],q.prototype,"mrrFactors",void 0);a.__decorate([n.parameter({vectorOps:l.vec3})],q.prototype,"emissiveFactor",void 0);a.__decorate([n.parameter({dispose:!0})],q.prototype,"baseColorTexture",void 0);
a.__decorate([n.parameter({dispose:!0})],q.prototype,"metallicRoughnessTexture",void 0);a.__decorate([n.parameter({dispose:!0})],q.prototype,"emissionTexture",void 0);a.__decorate([n.parameter({dispose:!0})],q.prototype,"occlusionTexture",void 0);a.__decorate([n.parameter({dispose:!0})],q.prototype,"normalTexture",void 0);a.__decorate([n.parameter({vectorOps:{equals:d.exactEquals,copy:d.copy}})],q.prototype,"overlayTexOffset",void 0);a.__decorate([n.parameter({vectorOps:{equals:d.exactEquals,copy:d.copy}})],
q.prototype,"overlayTexScale",void 0);a.__decorate([n.parameter()],q.prototype,"overlayColorInner",void 0);a.__decorate([n.parameter()],q.prototype,"overlayColorOuter",void 0);a.__decorate([n.parameter()],q.prototype,"overlayHighlightInner",void 0);a.__decorate([n.parameter()],q.prototype,"overlayHighlightOuter",void 0);a.__decorate([n.parameter()],q.prototype,"overlayNormalInner",void 0);a.__decorate([n.parameter()],q.prototype,"overlayNormalOuter",void 0);a.__decorate([n.parameter()],q.prototype,
"objectOpacity",void 0);a.__decorate([n.parameterBlock()],q.prototype,"commonMaterialParameters",void 0);a.__decorate([n.parameterBlock()],q.prototype,"componentParameters",void 0);a.__decorate([n.parameter()],q.prototype,"alphaCutoff",void 0);a.__decorate([n.parameter()],q.prototype,"alphaDiscardMode",void 0);a.__decorate([n.parameter()],q.prototype,"isIntegratedMesh",void 0);a.__decorate([n.parameter()],q.prototype,"polygonOffsetEnabled",void 0);a.__decorate([n.parameter()],q.prototype,"ellipsoidMode",
void 0);a.__decorate([n.parameter()],q.prototype,"sceneHasOcludees",void 0);let m=function(v){function y(){var B=v.apply(this,arguments)||this;B.doubleSided=!1;B.cullFace=2;B.slicePlaneEnabled=!0;return B}k._inheritsLoose(y,v);return y}(n.MaterialParameterBlock);a.__decorate([n.parameter()],m.prototype,"doubleSided",void 0);a.__decorate([n.parameter()],m.prototype,"cullFace",void 0);a.__decorate([n.parameter()],m.prototype,"slicePlaneEnabled",void 0);let u=function(v){function y(){var B=v.apply(this,
arguments)||this;B.externalColor=f.fromValues(1,1,1,1);B.externalColorMixMode=1;B.castShadows=0;return B}k._inheritsLoose(y,v);k._createClass(y,[{key:"transparent",get:function(){return 1>this.externalColor[3]?0:2}},{key:"opaqueOverride",get:function(){return 3===this.externalColorMixMode&&1===this.externalColor[3]?0:2}},{key:"visible",get:function(){return 0<this.externalColor[3]?0:2}},{key:"type",get:function(){return 0}}]);return y}(n.MaterialParameterBlock);a.__decorate([n.parameter({vectorOps:d.vec4})],
u.prototype,"externalColor",void 0);a.__decorate([n.parameter()],u.prototype,"externalColorMixMode",void 0);a.__decorate([n.parameter()],u.prototype,"castShadows",void 0);l=function(v){function y(){var B=v.apply(this,arguments)||this;B.texture=null;B.transparent=2;B.opaqueOverride=2;B.castShadows=2;return B}k._inheritsLoose(y,v);k._createClass(y,[{key:"type",get:function(){return 1}}]);return y}(n.MaterialParameterBlock);a.__decorate([n.parameter()],l.prototype,"texture",void 0);a.__decorate([n.parameter()],
l.prototype,"transparent",void 0);a.__decorate([n.parameter()],l.prototype,"opaqueOverride",void 0);a.__decorate([n.parameter()],l.prototype,"castShadows",void 0);b.CommonMaterialParameters=m;b.ComponentMaterial=q;b.ComponentParametersUniform=u;b.ComponentParametersVarying=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function l(){this._dirty=
!0}var h=l.prototype;h._setDirty=function(){this._dirty=!0};h._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const d of this._parameterBlocks)this[d]._setClean()};h._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const d of this._parameterBlocks)if(this[d].dirty)return!0;return!1};k._createClass(l,[{key:"dirty",get:function(){return this._dirty||this._checkParameterBlocksDirty()}}]);return l}(),r=function(){function l(){this._dirty=!0}var h=
l.prototype;h._setDirty=function(){this._dirty=!0};h._setClean=function(){this._dirty=!1};k._createClass(l,[{key:"dirty",get:function(){return this._dirty}}]);return l}();b.MaterialBase=a;b.MaterialParameterBlock=r;b.parameter=function(l={}){return(h,d)=>{var c;const e=null!=(c=h._parameterCount)?c:0;h._parameterCount=e+1;if(l.vectorOps){const f=l.vectorOps;Object.defineProperty(h,d,{get(){return this[e]},set(g){const p=this[e];if(null==p)this[e]=g;else{if(f.equals(p,g))return;f.copy(p,g)}this._setDirty()}})}else Object.defineProperty(h,
d,{get(){return this[e]},set(f){this[e]!==f&&(l.dispose&&this[e]&&this[e].dispose(),this[e]=f,this._setDirty())}})}};b.parameterBlock=function(){return(l,h)=>{var d;const c=null!=(d=l._parameterCount)?d:0;l._parameterCount=c+1;l._parameterBlocks=l._parameterBlocks||[];l._parameterBlocks.push(c);Object.defineProperty(l,h,{get(){return this[c]},set(e){this[c]!==e&&(this[c]=e,this._setDirty())}})}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3f64","../../../../../chunks/vec3","../../../../../chunks/vec3f32"],function(b,k,a,r,l){let h=function(){function c(f){this._low=l.create();this._high=l.create();f&&this.set(f)}var e=c.prototype;e.set=function(f){const g=this._low,p=this._high;r.copy(g,f);r.sub(p,f,g)};e.setElements=function(f,g,p){r.set(d,f,g,p);this.set(d)};e.get=function(f){return r.add(f,this._low,this._high)};e.getLowScaled=function(f){return r.scale(f,
this._low,1)};k._createClass(c,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);return c}();const d=a.create();b.TwoVectorPosition=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],function(b,k){let a=function(){function r(h,d=1){this.rctx=h;this.fieldCount=d;this.buffers=[]}var l=r.prototype;l.garbageCollect=function(){this.buffers=
this.buffers.filter(h=>0===h.activeCount?(h.dispose(),!1):!0)};l.destroy=function(){this.buffers.forEach(h=>h.dispose());this.buffers=[]};l.getBuffer=function(h){for(const d of this.buffers)if(d.availableCount>=h)return d;if(h>k.MAX_INDEX_COUNT)return null;h=new k.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(h);return h};l.updateTextures=function(){for(const h of this.buffers)h.textureBuffer.updateTexture()};return r}();b.BufferManager=a;Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./SimpleIndexManager","./TextureBackedBuffer"],function(b,k,a,r){let l=function(){function h(c,e=1){this.textureBuffer=new r.TextureBackedBuffer(c,e);this.indexManager=new a.SimpleIndexManager(65536)}var d=h.prototype;d.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};d.acquireIndex=function(){const c=
this.indexManager.acquire();this.textureBuffer.resizeToFit(c);return c};d.releaseIndex=function(c){this.indexManager.release(c)};k._createClass(h,[{key:"availableCount",get:function(){return this.indexManager.availableCount}},{key:"activeCount",get:function(){return this.indexManager.activeCount}}]);return h}();b.MAX_INDEX_COUNT=65536;b.ManagedTextureBackedBuffer=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(b,k){let a=function(){function r(h){this.maxCount=h;this._nextIndex=0;this.recycledIndices=[]}var l=r.prototype;l.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};l.release=function(h){this.recycledIndices.push(h)};k._createClass(r,[{key:"activeCount",get:function(){return this._nextIndex-this.recycledIndices.length}},{key:"availableCount",get:function(){return this.recycledIndices.length+
this.maxCount-this._nextIndex}}]);return r}();b.SimpleIndexManager=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../support/buffer/BufferView","../../../../webgl/Texture"],function(b,k,a){let r=function(){function l(d,c=1){this.rctx=d;this.fieldCount=c;this.textureWidth=4096;this.dirty=!0;this.texture=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,
width:this.textureWidth,height:1,flipped:!1});this.data=new k.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var h=l.prototype;h.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};h.setData=function(d,c,e,f,g,p){d=d*this.fieldCount+c;this.dirty=!0;this.data.set(d,0,e);this.data.set(d,1,f);this.data.set(d,2,g);this.data.set(d,3,p)};h.setDataElement=function(d,c,e,f){d=d*this.fieldCount+c;this.dirty=!0;this.data.set(d,e,f)};h.resizeToFit=function(d){d*=this.fieldCount;
d>=this.data.count&&(d=new k.BufferViewVec4u8(new ArrayBuffer(Math.ceil((d+1)/this.textureWidth)*this.textureWidth*4)),d.typedBuffer.set(this.data.typedBuffer),this.data=d)};h.updateTexture=function(){if(this.dirty){var d=this.texture.descriptor.width;this.data.count>d*this.texture.descriptor.height&&this.texture.resize(d,this.data.count/d);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};h.bind=function(d,c){this.rctx.bindTexture(this.texture,c.unit);d.setUniform1i(c.texName,c.unit);d.setUniform2f(c.invDimName,
1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return l}();b.TextureBackedBuffer=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define(["../../../../core/maybe","../../../webgl/Util","./glUtil3D","../shaders/CompositingTechnique"],function(b,k,a,r){let l=function(){function d(e,f){this._rctx=e;this._techniqueRepository=f;this._techniques=new Set}var c=d.prototype;c.dispose=function(){this._techniques.forEach(e=>
this._techniqueRepository.release(e));this._techniques.clear();b.isSome(this._vao)&&(this._vao.dispose(),this._vao=null)};c.composite=function(e,f=0,g=1){this.compositeInternal(e,f,g,0)};c.compositeTransparent=function(e,f,g,p=1){const n=this._rctx;h.alphaMode=1;h.function=3;h.hasOpacityFactor=1!==p;p=this._techniqueRepository.acquire(r.CompositingTechnique,h);n.bindProgram(p.program);p.bindPipelineState(n);p.program.setUniform1i("colorTexture",1);n.bindTexture(e,1);p.program.setUniform1i("alphaTexture",
2);n.bindTexture(f,2);p.program.setUniform1i("frontFaceTexture",3);n.bindTexture(g,3);e=this.ensureVAO();n.bindVAO(e);n.drawArrays(5,0,k.vertexCount(e,"geometry"));this._techniqueRepository.release(p)};c.compositeSpecial=function(e,f){this.compositeInternal(e,0,1,f)};c.compositeInternal=function(e,f,g,p){const n=this._rctx;h.alphaMode=f;h.function=p;h.hasOpacityFactor=1!==g;f=this._techniqueRepository.acquire(r.CompositingTechnique,h);n.bindProgram(f.program);f.bindPipelineState(n);f.program.setUniform1i("tex",
1);h.hasOpacityFactor&&f.program.setUniform1f("opacity",g);n.bindTexture(e,1);e=this.ensureVAO();n.bindVAO(e);n.drawArrays(5,0,k.vertexCount(e,"geometry"));this._techniqueRepository.release(f)};c.ensureVAO=function(){b.isNone(this._vao)&&(this._vao=a.createQuadVAO(this._rctx));return this._vao};return d}();const h=new r.CompositingTechniqueConfiguration;return l})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../../../../chunks/Compositing.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){h=function(p){function n(){return p.apply(this,arguments)||this}a._inheritsLoose(n,p);var w=n.prototype;w.initializeProgram=function(q){const m=n.shader.get().build(this.configuration);return new e(q.rctx,m.generateSource("vertex"),m.generateSource("fragment"),c.Default3D)};w.initializePipeline=function(){if(2===this.configuration.function)return f.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case 0:return f.makePipelineState({colorWrite:f.defaultColorWriteParams});
case 1:return f.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),colorWrite:f.defaultColorWriteParams});default:return f.makePipelineState({blending:f.simpleBlendingParams(1,771),colorWrite:f.defaultColorWriteParams})}};return n}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(g.CompositingShader,()=>new Promise(function(p,n){b(["./Compositing.glsl"],p,n)}));l=function(p){function n(){var w=p.apply(this,arguments)||this;w.function=0;w.alphaMode=0;w.hasOpacityFactor=!1;
return w}a._inheritsLoose(n,p);return n}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter({count:4})],l.prototype,"function",void 0);r.__decorate([d.parameter({count:3})],l.prototype,"alphaMode",void 0);r.__decorate([d.parameter()],l.prototype,"hasOpacityFactor",void 0);k.CompositingTechnique=h;k.CompositingTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/Compositing.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces",
"../views/3d/webgl-engine/core/shaderModules/ShaderBuilder","../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass"],function(b,k,a,r){function l(d){const c=new a.ShaderBuilder;c.include(r.ScreenSpacePass);c.fragment.uniforms.add("tex","sampler2D");0===d.function&&(d.hasOpacityFactor?(c.fragment.uniforms.add("opacity","float"),c.fragment.code.add(k.glsl`
      void main() {
        gl_FragColor = texture2D(tex, uv) * opacity;
      }`)):c.fragment.code.add(k.glsl`
      void main() {
        gl_FragColor = texture2D(tex, uv);
      }`));2===d.function&&c.fragment.code.add(k.glsl`
    void main() {
      gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
    }`);3===d.function&&(c.fragment.uniforms.add("colorTexture","sampler2D"),c.fragment.uniforms.add("alphaTexture","sampler2D"),c.fragment.uniforms.add("frontFaceTexture","sampler2D"),c.fragment.code.add(k.glsl`
    void main() {
      vec4 srcColor = texture2D(colorTexture, uv);
      float srcAlpha = texture2D(alphaTexture, uv).r;
      vec4 frontFace = texture2D(frontFaceTexture, uv);

      gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
    }`));return c}var h=Object.freeze({__proto__:null,build:l});b.CompositingShader=h;b.build=l})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/PooledArray ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../support/mathUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec4f64 ../../../../chunks/vec4 ../../support/geometryUtils ./Util ./depthRange".split(" "),function(b,k,a,
r,l,h,d,c,e,f,g,p,n){function w(I,J){if(J.isVisible){var K=n.empty(),L=J.getObjects();J.getSpatialQueryAccelerator()?q(K,I,J.getSpatialQueryAccelerator()):m(K,I,L);return K}}function q(I,J,K){var L=J.eye;const S=J.viewForward,M=J.frustum,T=Q=>Q.isVisible;var O=K.objectCount;500>O?(n.set(D,J.near,Math.min(I.near,J.far)),K.forEachInDepthRange(L,S,"front-to-back",D,(Q,F)=>{u(I,J,Q);D.far=I.near;F.setRange(D)},M,T),n.set(D,Math.max(I.far,J.near),J.far),K.forEachInDepthRange(L,S,"back-to-front",D,(Q,F)=>
{u(I,J,Q);D.near=I.far;F.setRange(D)},M,T)):(O=Math.max(Math.min(O,500),Math.ceil(.1*O)),L=K.findClosest(S,"front-to-back",M,T,O),K=K.findClosest(S,"back-to-front",M,T,O),L&&K&&(y(I,J,L.getCenter(),L.getBSRadius()),y(I,J,K.getCenter(),K.getBSRadius())))}function m(I,J,K){E.clear();K.forEach(L=>{L.isVisible&&E.add(L)});E.empty||(E.sort(J),n.set(D,J.near,Math.min(I.near,J.far)),E.forEachInDepthRange(D,"front-to-back",(L,S)=>{S<I.near&&u(I,J,L)}),n.set(D,Math.max(I.far,J.near),J.far),E.forEachInDepthRange(D,
"back-to-front",(L,S,M)=>{I.far=Math.max(I.far,M)}))}function u(I,J,K){if(K.isVisible&&g.frustum.intersectsSphere(J.frustum.planes,g.sphere.wrap(K.getBSRadius(),K.getCenter()))){var L=K.objectTransformation,S=t;K.geometryRecords.forEach(M=>{d.multiply(S,L,M.getShaderTransformation());const T=h.maxScale(S);v(I,J,M.geometry.boundingInfo,S,T)})}}function v(I,J,K,L,S){var M=J.eye,T=J.viewForward;l.transformMat4(A,K.center,L);M=T[0]*(A[0]-M[0])+T[1]*(A[1]-M[1])+T[2]*(A[2]-M[2]);T=K.bsRadius*S;if(!(M-T>
I.near&&M+T<I.far)&&g.frustum.intersectsSphere(J.frustum.planes,g.sphere.wrap(T,A)))if(100<K.bsRadius&&K.getChildren())for(K=K.getChildren(),M=0;8>M;++M)K[M]&&v(I,J,K[M],L,S);else H.unionDepthRangeWithAABB(I,J.viewProjectionMatrix,L,K.bbMin,K.bbMax)}function y(I,J,K,L){const S=J.eye;J=J.viewForward;K=(K[0]-S[0])*J[0]+(K[1]-S[1])*J[1]+(K[2]-S[2])*J[2];I.near=Math.min(I.near,K-L);I.far=Math.max(I.far,K+L)}let B=function(){function I(){this._items=new a({allocator:K=>K||{obj:null,distance:0,near:0,far:0},
deallocator:K=>{K.obj=null;K.distance=0;K.near=0;K.far=0;return K}})}var J=I.prototype;J.clear=function(){this._items.clear()};J.add=function(K){this._items.pushNew().obj=K};J.sort=function(K){const L=K.eye,S=K.viewForward;this._items.forAll(M=>{var T=M.obj,O=T.getCenter();T=T.getBSRadius();O=(O[0]-L[0])*S[0]+(O[1]-L[1])*S[1]+(O[2]-L[2])*S[2];M.distance=O;M.near=O-T;M.far=O+T});this._items.sort((M,T)=>M.distance-T.distance)};J.forEachInDepthRange=function(K,L,S){if("front-to-back"===L)for(L=0;L<this._items.length;++L){var M=
this._items.data[L];M.far<K.near||M.near>K.far||S(M.obj,M.near,M.far)}else for(L=this._items.length-1;0<=L;--L)M=this._items.data[L],M.far<K.near||M.near>K.far||S(M.obj,M.near,M.far)};k._createClass(I,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return I}(),x=function(){function I(){this.view=c.create();this.viewProj=c.create();this.frustum=g.frustum.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=
[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}var J=I.prototype;J.compute=function(K,L){this.reset();d.copy(this.view,K.viewMatrix);d.multiply(this.viewProj,K.projectionMatrix,this.view);g.frustum.copy(K.frustum,this.frustum);K=this.view;const S=K[2],M=K[6],T=K[10],O=K[14];K=this.range;let Q=0;L.forEach(P=>{if(P.instanceParameters.visible&&P.castShadow){if(P.hasShaderTransformation){var U=P.getBoundingSphere(P.getShaderTransformation(),1,A);var V=A}else U=P.bsRadius,
V=P.center;V=S*V[0]+M*V[1]+T*V[2]+O;this.geometries[Q]=P;this.near[Q]=-(V+U);this.far[Q]=-(V-U);++Q}});if(0===this.geometries.length)return K;for(L=0;L<this.geometries.length;++L)this.near[L]>K.far&&(K.far=this.near[L]),2<this.near[L]&&this.far[L]<K.near&&(K.near=this.far[L]);L=this.looseRange;L.near=Math.max(.5*K.near,2);L.far=2*K.far;var F=0;let N=0;for(let P=0;P<this.geometries.length;++P)this.near[P]<K.near&&(this.near[P]>=L.near?K.near=this.near[P]:this.nearCandidates[F++]=P),this.far[P]>K.far&&
(this.far[P]<=L.far?K.far=this.far[P]:this.farCandidates[N++]=P);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return K;this.nearCandidates.sort((P,U)=>this.near[P]<this.near[U]?-1:this.near[P]>this.near[U]?1:0);this.farCandidates.sort((P,U)=>this.far[P]<this.far[U]?1:this.far[P]>this.far[U]?-1:0);for(L=0;L<this.nearCandidates.length;++L)F=this.nearCandidates[L],this.near[F]<K.near&&(F=this.geometries[F],this.includeNearBoundingInfoRec(F.boundingInfo,F.getShaderTransformation()));
for(L=0;L<this.farCandidates.length;++L)F=this.farCandidates[L],this.far[F]>K.far&&(F=this.geometries[F],this.includeFarBoundingInfoRec(F.boundingInfo,F.getShaderTransformation()));return K};J.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};J.includeNearBoundingInfoRec=function(K,L){var S=K.getBSRadius(),M=K.getCenter();l.transformMat4(A,M,L);var T=
h.maxScale(L);M=A[0];var O=A[1];const Q=A[2];S*=T;({planes:T}=this.frustum);if(!(T[0][0]*M+T[0][1]*O+T[0][2]*Q+T[0][3]>S||T[1][0]*M+T[1][1]*O+T[1][2]*Q+T[1][3]>S||T[2][0]*M+T[2][1]*O+T[2][2]*Q+T[2][3]>S||T[3][0]*M+T[3][1]*O+T[3][2]*Q+T[3][3]>S||(M=this.view[2]*M+this.view[6]*O+this.view[10]*Q+this.view[14],O=M+S,2>-(M-S)||-O>=this.range.near)))if(-O>this.looseRange.near)this.range.near=-O;else{if(100<S&&(S=K.getChildren(),void 0!==S)){for(K=0;8>K;++K)void 0!==S[K]&&this.includeNearBoundingInfoRec(S[K],
L);return}H.unionDepthRangeWithAABB(this.range,this.viewProj,L,K.getBBMin(),K.getBBMax())}};J.includeFarBoundingInfoRec=function(K,L){var S=K.getBSRadius(),M=K.getCenter();l.transformMat4(A,M,L);var T=h.maxScale(L);M=A[0];const O=A[1],Q=A[2];S*=T;({planes:T}=this.frustum);if(!(T[0][0]*M+T[0][1]*O+T[0][2]*Q+T[0][3]>S||T[1][0]*M+T[1][1]*O+T[1][2]*Q+T[1][3]>S||T[2][0]*M+T[2][1]*O+T[2][2]*Q+T[2][3]>S||T[3][0]*M+T[3][1]*O+T[3][2]*Q+T[3][3]>S||(M=this.view[2]*M+this.view[6]*O+this.view[10]*Q+this.view[14]-
S,-M<=this.range.far)))if(-M<this.looseRange.far)this.range.far=-M;else{if(100<S&&(S=K.getChildren(),void 0!==S)){for(K=0;8>K;++K)void 0!==S[K]&&this.includeFarBoundingInfoRec(S[K],L);return}H.unionDepthRangeWithAABB(this.range,this.viewProj,L,K.getBBMin(),K.getBBMax())}};return I}(),C=function(){function I(){this.modelViewProj=c.create();this.clipPosition=[e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create()]}var J=I.prototype;J.unionDepthRangeWithAABB=function(K,
L,S,M,T){var O=this.modelViewProj;d.multiply(O,L,S);L=!1;for(S=0;8>S;++S){const Q=this.clipPosition[S],F=0===S||3===S||4===S||7===S?M[0]:T[0],N=0===S||1===S||4===S||5===S?M[1]:T[1],P=4>S?M[2]:T[2];Q[0]=O[0]*F+O[4]*N+O[8]*P+O[12];Q[1]=O[1]*F+O[5]*N+O[9]*P+O[13];Q[2]=O[2]*F+O[6]*N+O[10]*P+O[14];Q[3]=O[3]*F+O[7]*N+O[11]*P+O[15]}for(M=0;12>M;++M){T=this.clipTriangle(this.clipPosition[z[M][0]],this.clipPosition[z[M][1]],this.clipPosition[z[M][2]]);O=!0;for(S=0;S<T.length;++S)if(2<=T[S][3]){O=!1;break}if(!O)for(L=
!0,O=0;O<T.length;++O)S=T[O][3],S<K.near&&(K.near=S),S>K.far&&(K.far=S)}return L};J.inside=function(K,L){if(0===L)return K[0]>=-K[3];if(1===L)return K[1]>=-K[3];if(2===L)return K[0]<=K[3];if(3===L)return K[1]<=K[3];p.assert(!1)};J.intersect=function(K,L,S){let M=0;0===S?M=(-K[3]-K[0])/(L[0]-K[0]+L[3]-K[3]):1===S?M=(-K[3]-K[1])/(L[1]-K[1]+L[3]-K[3]):2===S?M=(K[3]-K[0])/(L[0]-K[0]-L[3]+K[3]):3===S&&(M=(K[3]-K[1])/(L[1]-K[1]-L[3]+K[3]));return f.lerp(e.create(),K,L,M)};J.clipTriangle=function(K,L,S){K=
[K,L,S];for(L=0;4>L;++L){S=K;K=[];for(let M=0;M<S.length;++M){const T=S[M],O=S[(M+1)%S.length];this.inside(O,L)?(this.inside(T,L)||K.push(this.intersect(T,O,L)),K.push(O)):this.inside(T,L)&&K.push(this.intersect(T,O,L))}}return K};return I}();const z=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],A=r.create(),t=c.create(),D=n.empty(),E=new B,G=new x,H=new C;b.DepthRangeFromRenderGeometries=x;b.depthRangeFromLayer=w;b.depthRangeFromScene=function(I,
J,K){if(1E4>J.size)return G.compute(I,J);const L=n.empty();K.forEach(S=>{S.isVisible&&n.union(L,w(I,S))});return L};b.texure2depth=function(I,J,K){return p.unpackFloatRGBA(J,I)*(K[1]-K[0])+K[0]};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../core/Evented ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/Handles ../../../../support/requestImageUtils ../../../webgl/Program ../../../webgl/renderState ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ./DefaultVertexBufferLayouts ./glUtil3D ../../../webgl/Renderbuffer ../../../webgl/FramebufferObject ../../../webgl/ProgramCache ../../../webgl/RenderingContext ../../../webgl/ShaderCompiler ../shaders/Magnifier.glsl ../../../magnifier/resources".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S){b.MagnifierHelper=function(M){function T(){var Q=M.apply(this,arguments)||this;Q._handles=new y;Q._magnifier=null;Q._imageSources=null;Q._imageLoadTask=null;Q._resources=null;Q.events=new m;Q.tmpScreenPoint=v.createScreenPointArray();Q.tmpRenderPoint=v.createRenderScreenPointArray();return Q}k._inheritsLoose(T,M);var O=T.prototype;O.dispose=function(){this._magnifier=null;this._handles.destroy();l.isSome(this._imageLoadTask)&&
(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this.disposeResources()};O.render=function(Q,F){const N=this._validMagnifier;if(!l.isNone(N)){var P=F.camera.pixelRatio,U=Math.ceil(P*N.size);this.updateResources(Q,U);if(!l.isNone(this._resources)){var V=this._resources.textures,W=Math.ceil(1/this.factor*U);V.input.resize(W,W);var X=F.camera.fullWidth,ca=F.camera.fullHeight;v.screenPointObjectToArray(N.position,this.tmpScreenPoint);F=F.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint);
var R=.5*W,aa=.5*W;F[0]=u.clamp(F[0],R,X-R-1);F[1]=u.clamp(F[1],aa,ca-aa-1);R=Math.floor(F[0]-R);aa=Math.floor(F[1]-aa);Q.bindTexture(V.input,0);Q.gl.copyTexImage2D(V.input.descriptor.target,0,V.input.descriptor.pixelFormat,R,aa,W,W,0);W=-1+(F[0]+N.offsetX*P)/X*2;P=-1+(F[1]-N.offsetY*P)/ca*2;X=U/X*2;U=U/ca*2;Q.bindVAO(this._resources.vao);Q.bindTexture(V.overlay,1);Q.bindTexture(V.mask,2);V=this._resources.program;Q.bindProgram(V);V.setUniform1i("textureInput",0);V.setUniform1i("textureOverlay",1);
V.setUniform1i("textureMask",2);V.setUniform4f("drawPosition",W,P,X,U);V.setUniform1i("maskEnabled",N.maskEnabled?1:0);V.setUniform1i("overlayEnabled",N.overlayEnabled?1:0);Q.setPipelineState(this._resources.pipelineState);Q.drawArrays(5,0,4)}}};O.updateResourceLoading=function(){const Q=this._validMagnifier;if(!l.isNone(Q)){var F=Q.mask,N=Q.overlay;!l.isSome(this._imageLoadTask)||this._imageLoadTask.mask===F&&this._imageLoadTask.overlay===N||(this._imageLoadTask.task.abort(),this._imageSources=this._imageLoadTask=
null);l.isSome(this._imageSources)||l.isSome(this._imageLoadTask)||(this._imageLoadTask={mask:F,overlay:N,task:w.createTask(async P=>{const U=l.isNone(F)||l.isNone(N)?S.loadMagnifierResources(P):null,V=l.isSome(F)?B.requestImage(F,{signal:P}):U.then(W=>W.mask);P=l.isSome(N)?B.requestImage(N,{signal:P}):U.then(W=>W.overlay);this._imageSources={mask:await V,overlay:await P};this.disposeResources();this.events.emit("request-render")})},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),
()=>this.notifyChange("updating")))}};O.updateResources=function(Q,F){this.enabled?l.isSome(this._resources)?this._resources.textures.size!==F&&(Q=this.createTextureResources(Q,F),l.isNone(Q)?this.disposeResources():(this.disposeTextureResources(this._resources.textures),this._resources.textures=Q)):(F=this.createTextureResources(Q,F),l.isNone(F)||(this._resources={textures:F,program:this.createProgram(Q),vao:this.createVAO(Q),pipelineState:C.makePipelineState({blending:C.simpleBlendingParams(1,771),
depthTest:null,depthWrite:null,colorWrite:C.defaultColorWriteParams})})):this.disposeResources()};O.disposeResources=function(){l.isNone(this._resources)||(this.disposeTextureResources(this._resources.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};O.disposeTextureResources=function(Q){Q.mask.dispose();Q.overlay.dispose();Q.input.dispose()};O.createTextureResources=function(Q,F){if(l.isNone(this._imageSources))return null;this._imageSources.overlay.width=
F;this._imageSources.overlay.height=F;this._imageSources.mask.width=F;this._imageSources.mask.height=F;const N=new A(Q,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},this._imageSources.overlay),P=new A(Q,{target:3553,pixelFormat:6406,internalFormat:6406,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},this._imageSources.mask);return{input:new A(Q,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,
flipped:!1}),mask:P,overlay:N,size:F}};O.createProgram=function(Q){const F=L.build();return new x(Q,F.generateSource("vertex"),F.generateSource("fragment"),this.attributeLocations)};O.createVAO=function(Q){return E.createQuadVAO(Q,D.Pos2,this.attributeLocations,0,1)};k._createClass(T,[{key:"updating",get:function(){return l.isNone(this._imageSources)&&l.isSome(this._imageLoadTask)&&!this._imageLoadTask.task.finished}},{key:"magnifier",get:function(){return this._magnifier},set:function(Q){Q!==this._magnifier&&
(this._handles.removeAll(),this._magnifier=Q,Q=()=>{this.updateResourceLoading();this.events.emit("request-render")},l.isSome(this._magnifier)&&this._handles.add(this._magnifier.watch("version",Q)),Q())}},{key:"enabled",get:function(){return l.isSome(this._validMagnifier)}},{key:"_validMagnifier",get:function(){return l.isSome(this._magnifier)&&this._magnifier.visible&&l.isSome(this._magnifier.position)&&0<this._magnifier.size?this._magnifier:null}},{key:"factor",get:function(){return l.isSome(this._magnifier)?
this._magnifier.factor||1:1}},{key:"attributeLocations",get:function(){return{position:0}}}]);return T}(q);a.__decorate([c.property()],b.MagnifierHelper.prototype,"_imageSources",void 0);a.__decorate([c.property()],b.MagnifierHelper.prototype,"_imageLoadTask",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["_imageSources","_imageLoadTask"]})],b.MagnifierHelper.prototype,"updating",null);b.MagnifierHelper=a.__decorate([f.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],b.MagnifierHelper);
Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define(["exports","../core/shaderModules/interfaces","../core/shaderModules/ShaderBuilder"],function(b,k,a){b.build=function(){const r=new a.ShaderBuilder;r.attributes.add("position","vec2");r.vertex.uniforms.add("proj","mat4");r.vertex.uniforms.add("drawPosition","vec4");r.varyings.add("vUV","vec2");r.vertex.code.add(k.glsl`
    void main(void) {
      vUV = position;
      gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
    }
  `);r.fragment.uniforms.add("textureInput","sampler2D");r.fragment.uniforms.add("textureMask","sampler2D");r.fragment.uniforms.add("textureOverlay","sampler2D");r.fragment.uniforms.add("maskEnabled","bool");r.fragment.uniforms.add("overlayEnabled","bool");r.fragment.code.add(k.glsl`
    const float barrelFactor = 1.1;

    vec2 barrel(vec2 uv) {
      vec2 uvn = uv * 2.0 - 1.0;

      if (uvn.x == 0.0 && uvn.y == 0.0) {
        return vec2(0.5, 0.5);
      }

      float theta = atan(uvn.y, uvn.x);
      float r = pow(length(uvn), barrelFactor);
      return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
    }

    void main() {
      float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
      vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
      vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);

      // Premultiply
      overlayColor.rgb *= overlayColor.a;

      gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
    }
  `);return r};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../core/promiseUtils","../../support/requestImageUtils"],function(b,k,a,r){k.loadMagnifierResources=async function(l){var h=new Promise(function(c,e){b(["./mask-svg"],function(f){c(Object.freeze({__proto__:null,"default":f}))},e)}),d=new Promise(function(c,e){b(["./overlay-svg"],function(f){c(Object.freeze({__proto__:null,"default":f}))},e)});h=r.requestImage((await h).default,
{signal:l});d=r.requestImage((await d).default,{signal:l});d={mask:await h,overlay:await d};a.throwIfAborted(l);return d};Object.defineProperty(k,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../core/Handles ../../../../core/watchUtils ../../../../chunks/mat4 ../../../../core/MapUtils ../../../../core/TimeProfiler ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ./glUtil3D ./Camera ../../support/debugFlags ./Material ./BoundingInfo ./RenderContext ./rendererUtils ../../../webgl/Measurement ../statistics/RendererPerformanceInfo ../materials/renderers/MergedRenderer ../lighting/SceneLighting ./depthRange ./depthRangeUtils ../core/renderPasses/RenderPassManager ./HighlightHelper ./OffscreenRendering ./RenderPluginManager ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./edgeRendering/EdgeView".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L){k=function(){function P(V,W,X,ca,R,aa,ka,da,fa){this._materialRep=V;this._rctx=ca;this._compositingHelper=R;this._magnifierHelper=aa;this.requestRender=ka;this._stage=fa;this._materialRenderers=new Map;this._hasWater=this._hasOccludees=this._hasHighlights=!1;this._camera=new n(r.fromValues(0,100,-100));this._content=new Map;this._isRendering=!1;this._bindParameters={slot:null,camera:null,inverseViewport:g.create(),shadowMappingEnabled:!1,
ssaoEnabled:!1,origin:null,screenToWorldRatio:null,screenToWorldRatioGlobalWM:null,slicePlane:null,highlightDepthTexture:null,hasOccludees:!1,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,ssrEnabled:!1,lighting:new C.SceneLighting};this._fallbackDepthStencilTexture=null;this.performanceInfo=new B.RendererPerformanceInfo;this._antialiasing=1;this._oitEnabled=!0;this._handles=new l;this.renderHiddenTransparentEdges=()=>{};this._shaderTechniqueRepository=
X;this._smaaPass=new J(this._rctx);this.camera.viewport[2]=da[0];this.camera.viewport[3]=da[1];this.requestRender();this._offscreenRendering=new E.OffscreenRendering(this._rctx,this._compositingHelper);this._sliceHelper=new I;this._shadowMap=new H(this._rctx,X.viewingMode);this._ssaoHelper=new K(X,this._rctx,()=>this.requestRender());this._highlightHelper=new D(X,this._rctx);this._renderPlugins=new G.RenderPluginManager({rctx:this._rctx,shaderTechniqueRep:X,textureRep:W,materialRep:this._materialRep,
requestRender:this.requestRender});this.renderPassManager=new t.RenderPassManager(this._rctx,this._shaderTechniqueRepository);this._renderPlugins.add(this.renderPassManager.slots(),this.renderPassManager);this._renderContext=new u(this._rctx,this._offscreenRendering,this._bindParameters.lighting,this._shadowMap,this._ssaoHelper,this._sliceHelper);this._renderContext.ssrParams={camera:null,linearDepthTexture:null,linearDepthTextureID:0,lastFrameColorTexture:null,lastFrameColorTextureID:0,reprojectionMat:null,
ssrEnabled:!1};this._handles.add(h.init(w,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",ea=>{this.renderHiddenTransparentEdges=ea?()=>this.renderEdges(1):()=>{};this.requestRender()}))}var U=P.prototype;U.dispose=function(){this._handles.destroy();this._smaaPass.disable();this._materialRenderers.forEach(V=>V.dispose());this._materialRenderers=null;this._edgeView=a.destroyMaybe(this._edgeView);this._offscreenRendering=a.disposeMaybe(this._offscreenRendering);this._fallbackDepthStencilTexture=a.disposeMaybe(this._fallbackDepthStencilTexture);
this._shadowMap&&(this._shadowMap.enabled=!1,this._shadowMap.dispose());this._ssaoHelper&&(this._ssaoHelper.enabled=!1,this._ssaoHelper.dispose());this._highlightHelper&&(this._highlightHelper.enabled=!1);m.tmpIndices.prune();this._content.clear();this._content=null};U.ensureEdgeView=function(){a.isNone(this._edgeView)&&(this._edgeView=new L.EdgeView(this._rctx,this._shaderTechniqueRepository,{setNeedsRender:()=>this.requestRender()},this._stage.scheduler));return this._edgeView};U.setLighting=function(V){this._bindParameters.lighting.set(V)};
U.setRenderParameters=function(V){void 0!==V.screenSpaceReflectionsEnabled&&(this.renderPassManager.screenSpaceReflectionsEnabled=V.screenSpaceReflectionsEnabled);void 0!==V.shadowMap&&(this._shadowMap.enabled=V.shadowMap,this.renderPassManager.shadowCastingEnabled=V.shadowMap);void 0!==V.shadowMapMaxCascades&&(this._shadowMap.maxCascades=V.shadowMapMaxCascades);this._highlightHelper.enabled=!0;void 0!==V.ssao&&(this._ssaoHelper.enabled=V.ssao);void 0!==V.ssaoAttenuation&&(this._ssaoHelper.attenuation=
V.ssaoAttenuation);void 0!==V.ssaoRadius&&(this._ssaoHelper.radius=V.ssaoRadius);void 0!==V.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==V.ssaoSamples&&(this._ssaoHelper.samples=V.ssaoSamples);V.background&&(this._offscreenRendering.background=V.background);void 0!==V.antialiasingEnabled&&(this._antialiasing=V.antialiasingEnabled?1:0);void 0!==V.orderIndependentTransparencyEnabled&&(this._oitEnabled=V.orderIndependentTransparencyEnabled);
void 0!==V.defaultHighlightOptions&&this._highlightHelper.setDefaultOptions(V.defaultHighlightOptions);void 0!==V.slicePlane&&(this._sliceHelper.plane=a.unwrap(V.slicePlane));void 0!==V.waterReflectionEnabled&&(this._waterReflectionEnabled=10<=this._rctx.parameters.maxTextureImageUnits&&V.waterReflectionEnabled);this.requestRender()};U.getFramebufferTexture=function(V){switch(V){case "color":return this._offscreenRendering.colorTexture;case "hudVisibility":return this._offscreenRendering.hudVisibilityTexture;
case "shadowMap":return this._shadowMap&&this._shadowMap.getDepthTexture();case "linearDepth":return this._offscreenRendering.linearDepthTexture;case "normals":return this._offscreenRendering.normalTexture;case "highlight":return this._offscreenRendering.highlightTexture;default:return null}};U.modify=function(V,W=V?V.length:0,X,ca=X?X.length:0,R,aa=R?R.length:0){this._isRendering&&console.warn("Renderer.modify called while rendering");for(var ka=0;ka<ca;++ka)this._content.delete(X[ka].uniqueName);
for(ka=0;ka<W;++ka)this._content.set(V[ka].uniqueName,V[ka]);if(W||ca||aa){let da=!1;v.splitRenderGeometryChangeSetByMaterial({toAdd:V,numToAdd:W,toRemove:X,numToRemove:ca,toUpdate:R,numToUpdate:aa}).forEach((fa,ea)=>{let Y=this._materialRenderers.get(ea);!Y&&0<fa.toAdd.length&&(Y=new x(this._rctx,this._materialRep,ea),this._materialRenderers.set(ea,Y));Y&&(Y.modify(fa),Y.isEmpty&&(da=!0))});da&&this._materialRenderers.forEach((fa,ea)=>{fa.isEmpty&&(this._materialRenderers.delete(ea),fa.dispose())});
this._hasHighlights=c.someMap(this._materialRenderers,fa=>fa.hasHighlights);this._hasOccludees=c.someMap(this._materialRenderers,fa=>fa.hasOccludees);this._hasWater=c.someMap(this._materialRenderers,fa=>fa.hasWater);this.requestRender()}};U.updateLogic=function(V){let W=!1;this._materialRenderers.forEach(X=>{X.updateLogic&&(W=X.updateLogic(V)||W)});return W};U.render=function(V,W,X){this.performanceInfo.prerender(this._rctx);this._isRendering=!0;this.setLighting(this._stage.lighting);this._renderContext.hasOccludees=
this._hasOccludees;this._renderContext.transparencyPassType=3;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;var ca=this._offscreenRendering;ca.needLastFrameColorTexture=this._waterReflectionEnabled;ca.advanceCurrentRenderTarget();const R=this._sliceHelper.plane;X&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(V);W.setGLViewport(this._rctx);this._renderPlugins.prepareRender(W);this.performanceInfo.advance(0);this.renderShadowMap(V,W,this._stage.mainLightDirection);
this.performanceInfo.advance(1);this.ensureBindParameters(this._renderContext,W);ca.initializeFrame(W);this.renderLinearDepth();this.performanceInfo.advance(2);this.renderNormal();this.performanceInfo.advance(3);this.ensureBindParametersSSR(this._renderContext);this._ssaoHelper.enabled&&this._ssaoHelper.computeSSAO(W,ca.linearDepthTexture,ca.normalTexture);this._ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository);this.performanceInfo.stats.reset();this.performanceInfo.advance(4);this._renderContext.pass=
0;ca.bindFramebuffer();this._renderPlugins.render(0,this._renderContext);this.renderOpaqueGeometry(this._renderContext);this.performanceInfo.advance(5);this.renderEdges(2);this.performanceInfo.advance(6);this.renderHiddenTransparentEdges();this.renderOrderIndependentTransparency(()=>this.renderTransparentGeometry(this._renderContext),!1);this.performanceInfo.advance(7);this.renderEdges(1);this.performanceInfo.advance(8);var aa=W=!1;W=this.renderHUDVisibility(this._renderContext);this.renderInternalSlot(20,
this._renderContext);this.performanceInfo.advance(9);(aa=this.renderTransparentTerrain(this._renderContext))&&W&&(ca.compositeTransparentTerrainOntoHUDVisibility(),this.renderHUD(0,ca.framebuffer),this.performanceInfo.advance(16));this.performanceInfo.advance(10);aa&&ca.compositeTransparentTerrainOntoMain();ca.renderToTargets(()=>{this.renderInternalSlot(8,this._renderContext);this._renderPlugins.render(15,this._renderContext);this._renderPlugins.render(16,this._renderContext)},ca.currentColorTarget,
ca.mainDepth);this.performanceInfo.advance(11);this._renderPlugins.needsLaserlineWithContrastControl&&ca.renderTmpAndCompositeToMain(()=>{this._renderPlugins.render(17,this._renderContext)},2);this.performanceInfo.advance(12);this.renderOccluded();this.performanceInfo.advance(13);ca=(X=!X&&this._magnifierHelper.enabled)&&a.isNone(V)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):V;this._rctx.bindFramebuffer(ca);this.renderAntiAliasing(this._antialiasing,
this._offscreenRendering.colorTexture)||this._compositingHelper.composite(this._offscreenRendering.colorTexture,0);this.performanceInfo.advance(14);this.renderHUD(1,ca);this.performanceInfo.advance(17);this.renderHighlights(this._renderContext.camera,V);this.performanceInfo.advance(15);X&&this._magnifierHelper.render(this._rctx,this._bindParameters);ca!==V&&(this._rctx.bindFramebuffer(V),this._compositingHelper.composite(this._offscreenRendering.tmpColorTexture,0));this._renderContext.lastFrameCamera.copyFrom(this._renderContext.camera);
this._sliceHelper.plane=R;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.postrender()};U.readDepthPixels=function(V,W,X,ca,R){const aa=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);this.needsLinearDepth()||(this._renderContext.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(17664,255),this.renderGeometryPass(2),this._rctx.gl.flush(),this._rctx.gl.finish());aa.readPixels(V,
W,X,ca,6408,5121,R)};U.renderEdges=function(V){const W=this._edgeView;a.isSome(W)&&W.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>W.render(this._bindParameters,V),1)};U.renderShadowMap=function(V,W,X){const ca=this._shadowMap;if(ca.enabled){w.ENABLE_PROFILE_DEPTH_RANGE&&e.begin("depthRange");var R=this.computeDepthRange(W);w.ENABLE_PROFILE_DEPTH_RANGE&&e.end("depthRange");ca.prepare(W,X,R);X=ca.getCascades();for(R=0;R<X.length;++R){const aa=X[R];aa.camera.setGLViewport(this._rctx);
this.ensureCameraBindParameters(this._renderContext,aa.camera);this.renderGeometryPass(4)}ca.finish(V);W.setGLViewport(this._rctx)}ca.bindToAllPrograms(this._shaderTechniqueRepository)};U.needsLinearDepth=function(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled};U.renderLinearDepth=function(){this.needsLinearDepth()?this._offscreenRendering.renderToTargets(()=>this.renderGeometryPass(2),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,
[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth)};U.renderNormal=function(){this._ssaoHelper.enabled?this._offscreenRendering.renderToTargets(()=>{this.renderGeometryPass(3)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};U.computeDepthRange=function(V){const W=A.depthRangeFromScene(V,this._content,this._stage.getLayers());z.union(W,this.renderPlugins.queryDepthRange(V));
W.near=Math.max(V.near,W.near);W.far=Math.min(V.far,W.far);return W};U.renderGeometryPass=function(V){this._renderContext.pass=V;this.renderOpaqueGeometry(this._renderContext);this.renderTransparentGeometry(this._renderContext);this.renderTransparentTerrain(this._renderContext)};U.renderOpaqueGeometry=function(V){this._renderPlugins.render(1,V);this._renderPlugins.render(2,V);this.renderInternalSlot(3,V);this._renderPlugins.render(4,V);V.ssaoHelper&&V.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository);
this._renderPlugins.render(14,this._renderContext)};U.renderTransparentGeometry=function(V){this.renderInternalSlot(5,V);this._renderPlugins.render(6,V);V.ssaoHelper&&V.ssaoHelper.bindToAllPrograms(this._shaderTechniqueRepository)};U.renderTransparentTerrain=function(V){return this._renderPlugins.render(7,V)};U.renderHUDVisibility=function(V){let W=!1;V.offscreenRenderingHelper&&V.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper?
this._renderContext.offscreenRenderingHelper.hudVisibilityTexture:null;W=this.renderInternalSlot(12,V)});return W};U.renderHUD=function(V,W){this._oitEnabled?(this.renderOrderIndependentTransparency(()=>this.renderHUDElements(V),!0),this._rctx.bindFramebuffer(W),this._compositingHelper.composite(this._offscreenRendering.hudColorTexture,2)):0===V?this._offscreenRendering.renderToTargets(()=>this.renderHUDElements(0),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,
!0,!0):this.renderHUDElements(V)};U.renderHUDElements=function(V){this._bindParameters.renderTransparentlyOccludedHUD=V;this.renderInternalSlot(21,this._renderContext);this.renderInternalSlot(18,this._renderContext);this.renderInternalSlot(19,this._renderContext)};U.renderHighlights=function(V,W){const X=this._highlightHelper;if(X&&X.enabled&&(this._hasHighlights||this._renderPlugins.needsHighlight)){var ca=X.profilingCallback&&y.startMeasurement(this._renderContext.rctx);this._renderContext.highlightDepthTexture=
this._bindParameters.highlightDepthTexture;var R=this._offscreenRendering.renderToTargets(()=>{this.renderGeometryPass(5);this._rctx.clearSafe(256);this.renderHUDElements(2)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);X.render(V,R,W);a.isSome(ca)&&X.profilingCallback&&ca.stop(aa=>{X.profilingCallback&&X.profilingCallback(aa)})}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};U.renderOrderIndependentTransparency=function(V,
W){if(this._oitEnabled&&this._rctx.capabilities.textureFloat&&this._rctx.capabilities.textureFloat.textureFloat&&this._rctx.capabilities.colorBufferFloat&&this._rctx.capabilities.colorBufferFloat.textureFloat){const X=R=>{this._renderContext.transparencyPassType=R;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;this._offscreenRendering.renderOITPass(()=>V(),R,W)},ca=this._renderContext.pass;this._renderContext.pass=1;X(1);this._renderContext.pass=0;X(0);X(2);this._offscreenRendering.compositeTransparentOntoOpaque(W);
this._renderContext.transparencyPassType=3;this._bindParameters.transparencyPassType=this._renderContext.transparencyPassType;this._renderContext.pass=ca}else V()};U.renderOccluded=function(){let V=0;this._materialRenderers.forEach((ka,da)=>{da&&da.isVisible()&&8===da.renderOccluded&&(V|=da.renderOccluded,M.push(da))});const W=this._offscreenRendering,X=this._renderContext,ca=(ka,da,fa=()=>aa(da),ea=!0,Y=!0)=>{0!==(V&da)&&(W.renderToTargets(fa,W.tmpColor,W.mainDepth,[0,0,0,0],ea,Y),W.compositeOccludedOntoMain(ka))};
0!==M.length&&(this.renderInternalSlot(10,X,M),ca(.5,8,()=>this.renderInternalSlot(11,X,M),!1,!1),M.length=0);this._materialRenderers.forEach((ka,da)=>{da&&da.isVisible()&&(4===da.renderOccluded||2===da.renderOccluded||16===da.renderOccluded)&&(V|=da.renderOccluded,S.push(da))});const R=this._renderPlugins.renderOccludedFlags;if(V|=R){var aa=ka=>{X.renderOccludedMask=ka;1<R&&this._renderPlugins.render(9,X);this.renderInternalSlot(3,X,S);this.renderInternalSlot(5,X,S);this.renderInternalSlot(8,X,S);
X.resetRenderOccludedMask()};X.pass=0;ca(.5,4,()=>aa(4),!0,2);ca(.5,2,()=>aa(2),!0,2);ca(1,16,()=>aa(16),!0,2);S.length=0}};U.renderAntiAliasing=function(V,W){if(1===V){if(this._smaaPass.loadResources(()=>this.requestRender()),this._smaaPass.enable())return this._smaaPass.render({colorTexture:W}),!0}else this._smaaPass.disable();return!1};U.ensureCameraBindParameters=function(V,W){this._renderContext.camera=W;this._bindParameters.camera=V.camera;this._bindParameters.inverseViewport[0]=1/V.camera.fullViewport[2];
this._bindParameters.inverseViewport[1]=1/V.camera.fullViewport[3]};U.ensureBindParameters=function(V,W){this.ensureCameraBindParameters(V,W);W=this._renderContext.offscreenRenderingHelper;this._bindParameters.shadowMap=V.shadowMap;this._bindParameters.shadowMappingEnabled=!!V.shadowMap&&V.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!V.ssaoHelper&&V.ssaoHelper.enabled;this._bindParameters.slicePlane=V.sliceHelper&&V.sliceHelper.plane;this._bindParameters.hasOccludees=V.hasOccludees;this._bindParameters.linearDepthTextureID=
3;this._bindParameters.lastFrameColorTextureID=4;this._bindParameters.hudVisibilityTexture=W?W.hudVisibilityTexture:null;this._bindParameters.highlightDepthTexture=W&&W.depthTexture||this.getFallbackDepthTexture()};U.ensureBindParametersSSR=function(V){this._waterReflectionEnabled?(d.translate(T,V.lastFrameCamera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),d.translate(Q,V.camera.viewMatrix,this._bindParameters.origin?this._bindParameters.origin:[0,0,0]),d.invert(Q,
Q),d.invert(O,V.camera.projectionMatrix),d.multiply(F,Q,O),d.multiply(F,T,F),d.multiply(F,V.lastFrameCamera.projectionMatrix,F),this._renderContext.ssrParams.camera=V.camera,this._renderContext.ssrParams.reprojectionMat=this._bindParameters.reprojectionMat=F,this._renderContext.ssrParams.linearDepthTexture=this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture,this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):
this._renderContext.ssrParams.lastFrameColorTexture=this._bindParameters.lastFrameColorTexture=null;this._renderContext.ssrParams.ssrEnabled=this._bindParameters.ssrEnabled=this._waterReflectionEnabled};U.renderInternalSlot=function(V,W,X){const ca=0===W.pass?this.performanceInfo.stats:null;let R=!1;this._bindParameters.slot=V;a.isSome(X)?X.forEach(aa=>{q.materialPredicate(aa,W)&&(aa=this._materialRenderers.get(aa),a.isSome(aa)&&(R=aa.render(V,W,this._bindParameters)||R))}):this._materialRenderers.forEach((aa,
ka)=>{q.materialPredicate(ka,W)&&(R=aa.render(V,W,this._bindParameters,ca)||R)});return R};U.getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=p.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};U.getGpuMemoryUsage=function(){return{offscreen:this._offscreenRendering?this._offscreenRendering.getGpuMemoryUsage():0,highlights:this._highlightHelper?this._highlightHelper.getGpuMemoryUsage():0,shadows:this._shadowMap?this._shadowMap.getGpuMemoryUsage():
0,ssao:this._ssaoHelper?this._ssaoHelper.getGpuMemoryUsage():0}};b._createClass(P,[{key:"updating",get:function(){return 1===this._antialiasing&&this._smaaPass.isLoadingResources}},{key:"camera",set:function(V){this._camera.copyFrom(V);this.requestRender()},get:function(){return this._camera}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return null===this._bindParameters.reprojectionMat?!0:d.equals(this._bindParameters.reprojectionMat,N)}},{key:"hasShadowsEnabled",
get:function(){var V;return!(null==(V=this._shadowMap)||!V.enabled)}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"canRender",get:function(){return 0<this._camera.fullWidth&&0<this._camera.fullHeight}},{key:"test",get:function(){return{antialiasing:this._antialiasing,offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlightHelper,materialRenderers:this._materialRenderers,
oitEnabled:this._oitEnabled}}}]);return P}();const S=[],M=[],T=f.create(),O=f.create(),Q=f.create(),F=f.create(),N=f.create();return k})},"esri/core/TimeProfiler":function(){define(["../chunks/_rollupPluginBabelHelpers"],function(b){let k=function(){function a(l,h=.9){this._alpha=.9;this._max=this._min=this._smooth=this._sum=this._count=this._startTime=0;this._name=l;this._alpha=h;this.reset()}var r=a.prototype;r.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};
r.begin=function(){this._startTime=performance.now()};r.end=function(){const l=performance.now()-this._startTime;this._count+=1;this._sum+=l;this._smooth=this._alpha*l+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,l);this._max=Math.max(this._max,l)};r.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};b._createClass(a,[{key:"name",get:function(){return this._name}},{key:"count",get:function(){return this._count}},
{key:"average",get:function(){return 0<this._count?this._sum/this._count:0}},{key:"smooth",get:function(){return this._smooth}},{key:"min",get:function(){return this._min}},{key:"max",get:function(){return this._max}}]);return a}();(function(a){function r(c){c in h||(h[c]=new a(c));return h[c]}function l(c){console.log(r(c).toJSON())}const h={},d={};a.get=r;a.begin=function(c){r(c).begin()};a.end=function(c,e=!0){r(c).end();const f=performance.now();!e||c in d&&!(f>=d[c]+1E3)||(l(c),d[c]=f)};a.log=
l;a.logAll=function(){for(const c in h)l(c)}})(k||(k={}));return k})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat4 ../../../../../chunks/mat3f64 ../../../../../chunks/mat3 ../../../../../chunks/vec2 ../../../../../chunks/vec4 ../../../support/geometryUtils ../../lib/depthRange ../util/TwoVectorPosition ./AllRenderPasses ./RenderPass".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){let m=function(){function B(C,z){this.rctx=C;this.shaderTechniqueRepository=z;this.canRender=!0;this._materialPassParams=new w.MaterialPassesParameters;this._shadowPassParams=new w.ShadowMapPassParameters;this._highlightPassParams=new w.HighlightPassParameters;this._systems=new Set;this._passes=[];this._shadowMapPass=this._registerPass(new q.RenderPass(C,this.shaderTechniqueRepository));this.passes={materialOpaque:this._registerPass(new q.RenderPass(C,this.shaderTechniqueRepository)),
materialTransparent:this._registerPass(new q.RenderPass(C,this.shaderTechniqueRepository,1)),materialIntegratedMesh:this._registerPass(new q.RenderPass(C,this.shaderTechniqueRepository)),shadowMap:this._shadowMapPass,highlight:this._registerPass(new q.RenderPass(C,this.shaderTechniqueRepository)),highlightIntegratedMesh:this._registerPass(new q.RenderPass(C,this.shaderTechniqueRepository))}}var x=B.prototype;x.register=function(C){this._systems.add(C)};x.prepareRender=function(C){this._passes.forEach(z=>
z.prepareSubmit());this._systems.forEach(z=>{z.submit(this.passes,{camera:C})});this._passes.forEach(z=>z.finishSubmit());this.shaderTechniqueRepository.frameUpdate()};x.render=function(C){if(4===C.slot)switch(this._configure(C),C.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(C);this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=2;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 3:this._materialPassParams.subPass=
3;this.passes.materialOpaque.dispatch(this._materialPassParams);break;case 5:this.passes.highlight.dispatch(this._highlightPassParams);break;case 4:this._shadowMapPass.dispatch(this._shadowPassParams)}if(6===C.slot)switch(this._configure(C),C.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(C);this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 1:this._materialPassParams.subPass=1;this._configureMaterialColorPass(C);this.passes.materialTransparent.dispatch(this._materialPassParams);
break;case 2:this._materialPassParams.subPass=2;this.passes.materialTransparent.dispatch(this._materialPassParams);break;case 3:this._materialPassParams.subPass=3,this.passes.materialTransparent.dispatch(this._materialPassParams)}if(1===C.slot)switch(this._configure(C),C.pass){case 0:this._materialPassParams.subPass=0;this._configureMaterialColorPass(C);this._materialPassParams.ssrParams=C.ssrParams;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 2:this._materialPassParams.subPass=
2;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 3:this._materialPassParams.subPass=3;this.passes.materialIntegratedMesh.dispatch(this._materialPassParams);break;case 5:this.passes.highlightIntegratedMesh.dispatch(this._highlightPassParams)}return!0};x.notifyDirty=function(){this.initContext.requestRender()};x.slots=function(){return[4,6,1]};x.initializeRenderContext=function(C){this.initContext=C};x.uninitializeRenderContext=function(){};x.queryDepthRange=function(C){const z=
{near:Infinity,far:-Infinity};this._systems.forEach(A=>{A=A.queryShadowCasterDepthRange(C);a.isSome(A)&&p.union(z,A,z)});return z};x._configureMaterialColorPass=function(C){this._materialPassParams.shadowMap={bind:(z,A)=>{C.shadowMap.bind(z,A);A=this._materialPassParams.viewTransform;l.add(u,A.worldFromView_TL,A.worldFromView_TH);C.shadowMap.bindView(z,u)}};this._materialPassParams.ambientOcclusion={bind:(z,A)=>{C.ssaoHelper.setUniforms(z,A)}};this._materialPassParams.ambientOcclusionEnabled=C.ssaoHelper.enabled;
this._materialPassParams.sceneHasOcludees=C.hasOccludees};x._configure=function(C){this._updateParameters(C,4===C.pass?this._shadowPassParams:5===C.pass?this._highlightPassParams:this._materialPassParams)};x._updateParameters=function(C,z){const A=C.camera,t=A.viewInverseTransposeMatrix;l.set(u,t[3],t[7],t[11]);y.set(u);l.copy(z.viewTransform.worldFromView_TH,y.high);l.copy(z.viewTransform.worldFromView_TL,y.low);c.fromMat4(z.viewTransform.viewFromCameraRelative_RS,A.viewMatrix);h.copy(z.viewTransform.projFromView,
A.projectionMatrix);0===z.identifier?(this._materialPassParams.transparent=6===C.slot,this._materialPassParams.integratedMesh=1===C.slot,this._materialPassParams.lighting=C.scenelightingData,c.transpose(v,z.viewTransform.viewFromCameraRelative_RS),c.invert(z.transformNormal_ViewFromGlobal,v),e.set(z.cameraNearFar,A.near,A.far)):1===z.identifier?e.set(z.cameraNearFar,A.near,A.far):2===z.identifier&&(z.highlightDepthTexture=C.highlightDepthTexture,f.copy(z.viewport,A.fullViewport),z.inverseViewport[0]=
1/A.fullViewport[2],z.inverseViewport[1]=1/A.fullViewport[3]);g.boundedPlane.copy(C.sliceHelper.plane,z.slicePlane);l.subtract(z.slicePlane.origin,z.slicePlane.origin,u);z.slicePlaneEnabled=C.sliceHelper.isEnabled;this._materialPassParams.transparencyPassType=C.transparencyPassType};x._registerPass=function(C){this._passes.push(C);return C};k._createClass(B,[{key:"shadowCastingEnabled",get:function(){return a.isSome(this.passes.shadowMap)},set:function(C){C?(this._materialPassParams.shadowsEnabled=
!0,this.passes.shadowMap=this._shadowMapPass):(this._materialPassParams.shadowsEnabled=!1,this.passes.shadowMap=null)}},{key:"screenSpaceReflectionsEnabled",get:function(){return a.isSome(this._materialPassParams.ssrParams.ssrEnabled)},set:function(C){this._materialPassParams.ssrParams.ssrEnabled=C?!0:!1}},{key:"needsHighlight",get:function(){return 0<this.passes.highlight.count||0<this.passes.highlightIntegratedMesh.count}}]);return B}();const u=r.create(),v=d.create(),y=new n.TwoVectorPosition;
b.RenderPassManager=m;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define("exports ../../../../../chunks/mat3f64 ../../../../../chunks/vec2f64 ../../../../../chunks/vec4f64 ../../../support/geometryUtils ../shaderLibrary/attributes/VertexPosition.glsl".split(" "),function(b,k,a,r,l,h){b.HighlightPassParameters=function(){this.identifier=2;this.viewTransform=new h.VertexPosition.ViewProjectionTransform;this.slicePlane=
l.boundedPlane.create();this.inverseViewport=a.create();this.viewport=r.create()};b.MaterialPassesParameters=function(){this.identifier=0;this.integratedMesh=this.transparent=!1;this.viewTransform=new h.VertexPosition.ViewProjectionTransform;this.transformNormal_ViewFromGlobal=k.create();this.cameraNearFar=a.create();this.slicePlane=l.boundedPlane.create();this.shadowsEnabled=this.ambientOcclusionEnabled=this.slicePlaneEnabled=!0;this.sceneHasOcludees=!1;this.transparencyPassType=3};b.ShadowMapPassParameters=
function(){this.identifier=1;this.viewTransform=new h.VertexPosition.ViewProjectionTransform;this.cameraNearFar=a.create();this.slicePlane=l.boundedPlane.create()};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/PooledArray"],function(b,k,a){let r=function(){function h(c,e,f=0){this._rctx=c;this._techniqueRepository=e;this._sorting=f;this._draws=
new a({initialSize:32,allocator:g=>g||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._passBoundTechniques=new Set;this._previouslyBoundMaterials=new Map;this._previouslyBoundDraw=new Map}var d=h.prototype;d.submitDraw=function(c,e,f,g,p){const n=this._draws.pushNew();n.geometry=e;n.geometryRanges=f;n.material=c;n.bindDrawParams=g;n.depthSquaredHint=p;n.indexType=e.indexed?e.vao.indexBuffer.indexType:0};d.dispatch=function(c){const e=this._rctx;
this._passBoundTechniques.clear();this._previouslyBoundMaterials.clear();this._previouslyBoundDraw.clear();let f=null;const g={repository:this._techniqueRepository},p=this._draws.length;for(let w=0;w<p;w++){const q=this._draws.data[w],m=q.geometry;var n=q.material.getTechnique(g,c,m.parameters);this._passBoundTechniques.has(n)||(n.bindPass(e,c),this._passBoundTechniques.add(n));e.bindVAO(m.vao);if(n!==f||3!==n.configuration.transparencyPassType)e.bindProgram(n.program),e.setPipelineState(n.pipeline),
f=n;this._previouslyBoundMaterials.get(n)!==q.material&&(n.bindMaterial(e,q.material,c),this._previouslyBoundMaterials.set(n,q.material));this._previouslyBoundDraw.get(n)!==q.bindDrawParams&&(n.bindDraw(q.bindDrawParams,q.material,c),this._previouslyBoundMaterials.set(n,q.material));if(0!==q.indexType){n=l.get(q.indexType);for(let u=0;u<q.geometryRanges.length;u+=2)e.drawElements(m.primitiveType,q.geometryRanges[u+1],q.indexType,q.geometryRanges[u]*n)}else for(n=0;n<q.geometryRanges.length;n+=2)e.drawArrays(m.primitiveType,
q.geometryRanges[n],q.geometryRanges[n+1])}};d.prepareSubmit=function(){this._draws.clear()};d.finishSubmit=function(){const c=0===this._sorting?1:-1;this._draws.sort((e,f)=>{const g=c*(e.depthSquaredHint-f.depthSquaredHint);return 0!==g?g:e.geometry.vao.size-f.geometry.vao.size})};k._createClass(h,[{key:"count",get:function(){return this._draws.length}}]);return h}();const l=new Map;l.set(5121,1);l.set(5123,2);l.set(5125,4);b.RenderPass=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../../../../chunks/vec4 ./DefaultVertexAttributeLocations ./Util ../../../webgl/BufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject ./DefaultVertexBufferLayouts ./glUtil3D ../../support/debugFlags ../../../webgl/FramebufferObject ../../../../chunks/vec4f32 ../shaders/HighlightTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){return function(){function q(u,v){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=v;this.viewportToRestore=k.create();this.defaultOptions={color:n.fromValues(1,0,1,1),haloColor:n.fromValues(1,0,1,1),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};v=new w.HighlightCompositionTechniqueConfiguration;
v.highlightStage=0;v.gridOptimization=!1;this.blurTechnique=u.acquireAndReleaseExisting(w.HighlightCompositionTechnique,v,this.blurTechnique);v.highlightStage=0;v.gridOptimization=!0;this.blurGridTechnique=u.acquireAndReleaseExisting(w.HighlightCompositionTechnique,v,this.blurGridTechnique);v.highlightStage=1;v.gridOptimization=!1;this.applyTechnique=u.acquireAndReleaseExisting(w.HighlightCompositionTechnique,v,this.applyTechnique);v.highlightStage=1;v.gridOptimization=!0;this.applyGridTechnique=
u.acquireAndReleaseExisting(w.HighlightCompositionTechnique,v,this.applyGridTechnique);v.highlightStage=2;v.gridOptimization=!1;this.downsampleTechnique=u.acquireAndReleaseExisting(w.HighlightCompositionTechnique,v,this.downsampleTechnique)}var m=q.prototype;m.setDefaultOptions=function(u){this.defaultOptions=u};m.render=function(u,v,y){var B=u.pixelRatio;const x=!g.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,C=this._rctx;l.assert(this.enabled);a.copy(this.viewportToRestore,u.fullViewport);var z=Math.ceil(u.fullWidth/
B);B=Math.ceil(u.fullHeight/B);this.blur0Fbo.resize(z,B);this.blur1Fbo.resize(z,B);C.bindVAO(this.quadVAO);let A=u=null;x&&(this._gridUpdateResources(v,32),this._gridComputeMipmap());x?(u=this._grid.vao,A=this.blurGridTechnique,C.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,1),A.program.setUniform1i("coverageTex",1)):(u=this.quadVAO,A=this.blurTechnique);A.bindPipelineState(C);C.bindProgram(A.program);C.bindVAO(u);C.bindFramebuffer(this.blur0Fbo);C.setViewport(0,0,z,
B);C.setClearColor(0,0,0,0);C.clear(16384);A.program.setUniform1i("tex",0);C.bindTexture(v.colorTexture,0);A.program.setUniform2f("blurSize",1/z,0);C.drawArrays(A.primitiveType,0,d.vertexCount(u,"geometry"));C.bindFramebuffer(this.blur1Fbo);C.clear(16384);C.bindTexture(this.blur0Fbo.colorTexture,0);A.program.setUniform2f("blurSize",0,1/B);C.drawArrays(A.primitiveType,0,d.vertexCount(u,"geometry"));z=x?this.applyGridTechnique:this.applyTechnique;C.bindFramebuffer(y);z.bindPipelineState(C);C.setViewport(this.viewportToRestore[0],
this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);C.bindProgram(z.program);C.bindTexture(this.blur1Fbo.colorTexture,0);C.bindTexture(v.colorTexture,1);x&&C.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2);z.bindApplyPass(this.defaultOptions);C.drawArrays(z.primitiveType,0,d.vertexCount(u,"geometry"));C.bindVAO(null)};m.enable=function(){if(!this.enabled){this.quadVAO=f.createQuadVAO(this._rctx);var u={colorTarget:0,depthStencilTarget:0,width:0,
height:0},v={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=new p(this._rctx,u,v);this.blur1Fbo=new p(this._rctx,u,v)}};m.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};m._gridUpdateResources=function(u,v){const y=this._rctx,B=this._grid;var x=!1;null===B.coverageMipmap&&(B.coverageMipmap=[u],x=!0);if(B.viewportWidth!==u.width||B.viewportHeight!==
u.height)x=!0,B.viewportWidth=u.width,B.viewportHeight=u.height;B.coverageMipmap[0]=u;B.cellPixelSize!==v&&(B.cellPixelSize=v,x=!0);if(x){for(v=1;v<B.coverageMipmap.length;v++)B.coverageMipmap[v].dispose();B.mipmapLevels=Math.ceil(Math.log(B.cellPixelSize)*Math.LOG2E);B.coverageMipmap.length=B.mipmapLevels+1;for(v=0;v<B.mipmapLevels;v++)x=B.coverageMipmap[v],x=new p(y,{colorTarget:0,depthStencilTarget:0,width:Math.ceil(x.width/2),height:Math.ceil(x.height/2)},{target:3553,pixelFormat:6407,dataType:33635,
samplingMode:9729,wrapMode:33071,width:Math.ceil(x.width/2),height:Math.ceil(x.height/2)}),B.coverageMipmap[v+1]=x}x=Math.ceil(u.height/B.cellPixelSize);var C=Math.ceil(u.width/B.cellPixelSize);if(!B.vao||B.verticalCellCount!==x||B.horizontalCellCount!==C){B.verticalCellCount=x;B.horizontalCellCount=C;u=x+1;v=C+1;x=1/x;C=1/C;const z=new Float32Array(24*u*v);let A=0;for(let t=0;t<u;t++)for(let D=0;D<v;D++)z[A+0]=(D-.5)*C*2-1,z[A+1]=(t-.5)*x*2-1,z[A+2]=D*C,z[A+3]=t*x,z[A+4]=(D+.5)*C*2-1,z[A+5]=(t-.5)*
x*2-1,z[A+6]=D*C,z[A+7]=t*x,z[A+8]=(D-.5)*C*2-1,z[A+9]=(t+.5)*x*2-1,z[A+10]=D*C,z[A+11]=t*x,z[A+12]=(D-.5)*C*2-1,z[A+13]=(t+.5)*x*2-1,z[A+14]=D*C,z[A+15]=t*x,z[A+16]=(D+.5)*C*2-1,z[A+17]=(t-.5)*x*2-1,z[A+18]=D*C,z[A+19]=t*x,z[A+20]=(D+.5)*C*2-1,z[A+21]=(t+.5)*x*2-1,z[A+22]=D*C,z[A+23]=t*x,A+=24;B.vao&&B.vao.dispose(!0);B.vao=new c(y,r.Default3D,{geometry:e.Pos2Tex},{geometry:h.createVertex(y,35044,z)})}};m._gridComputeMipmap=function(){const u=this._rctx,v=this._grid,y=this.downsampleTechnique.program;
this.downsampleTechnique.bindPipelineState(u);u.bindVAO(this.quadVAO);for(let B=0;B<v.mipmapLevels;B++){u.bindFramebuffer(v.coverageMipmap[B+1]);u.bindTexture(v.coverageMipmap[B].colorTexture,0);const x=v.coverageMipmap[B+1].width,C=v.coverageMipmap[B+1].height;u.bindProgram(y);y.setUniform1i("tex",0);y.setUniform2f("invFramebufferDim",1/x,1/C);u.setViewport(0,0,x,C);u.drawArrays(5,0,d.vertexCount(this.quadVAO,"geometry"))}};m.getGpuMemoryUsage=function(){let u=d.getGpuMemoryUsage(this.blur0Fbo)+
d.getGpuMemoryUsage(this.blur1Fbo);if(this._grid&&this._grid.coverageMipmap)for(const v of this._grid.coverageMipmap)u+=d.getGpuMemoryUsage(v);return u};b._createClass(q,[{key:"enabled",set:function(u){u?this.enable():this.disable()},get:function(){return null!==this.blur0Fbo}},{key:"profilingCallback",get:function(){return g.HIGHLIGHTS_PROFILE_TO_CONSOLE?u=>console.log(u):null}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}]);return q}()})},
"esri/views/3d/webgl-engine/shaders/HighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../../../../chunks/HighlightComposition.glsl".split(" "),function(b,k,a,r,l,h,d,c,e,f,g){h=function(p){function n(){return p.apply(this,
arguments)||this}a._inheritsLoose(n,p);var w=n.prototype;w.initializeProgram=function(q){const m=n.shader.get().build(this.configuration);return new e(q.rctx,m.generateSource("vertex"),m.generateSource("fragment"),c.Default3D)};w.bindApplyPass=function(q){this.program.setUniform1i("tex",0);this.program.setUniform1i("origin",1);this.configuration.gridOptimization&&this.program.setUniform1i("coverageTex",2);this.program.setUniform4fv("color",q.color);this.program.setUniform4fv("haloColor",q.haloColor);
this.program.setUniform1f("outlineSize",8.6);this.program.setUniform1f("blurSize",.4);this.program.setUniform4f("opacities",q.haloOpacity,q.haloOpacityOccluded,q.fillOpacity,q.fillOpacityOccluded)};w.initializePipeline=function(){return 1===this.configuration.highlightStage?f.makePipelineState({blending:f.separateBlendingParams(770,1,771,771),colorWrite:f.defaultColorWriteParams}):f.makePipelineState({colorWrite:f.defaultColorWriteParams})};a._createClass(n,[{key:"primitiveType",get:function(){return this.configuration.gridOptimization?
4:5}}]);return n}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(g.HighlightCompositionShader,()=>new Promise(function(p,n){b(["./HighlightComposition.glsl"],p,n)}));l=function(p){function n(){var w=p.apply(this,arguments)||this;w.highlightStage=0;w.gridOptimization=!1;return w}a._inheritsLoose(n,p);return n}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter({count:3})],l.prototype,"highlightStage",void 0);r.__decorate([d.parameter()],l.prototype,"gridOptimization",void 0);k.HighlightCompositionTechnique=
h;k.HighlightCompositionTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/HighlightComposition.glsl":function(){define(["exports","../views/3d/webgl-engine/core/shaderModules/interfaces","../views/3d/webgl-engine/core/shaderModules/ShaderBuilder"],function(b,k,a){function r(h){const d=new a.ShaderBuilder,c=d.vertex.code,e=d.fragment.code;d.attributes.add("position","vec2");2===h.highlightStage&&(c.add(k.glsl`
    void main() {
      gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
    }`),d.fragment.uniforms.add("tex","sampler2D"),d.fragment.uniforms.add("invFramebufferDim","vec2"),e.add(k.glsl`
      void main() {
        vec2 coord = gl_FragCoord.xy * invFramebufferDim;
        vec4 value = texture2D(tex, coord);
        float mx = floor(max(value.g, value.b));
        gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
      }`));0===h.highlightStage&&(d.attributes.add("uv0","vec2"),h.gridOptimization?(d.vertex.uniforms.add("coverageTex","sampler2D"),d.fragment.uniforms.add("blurSize","vec2"),d.varyings.add("blurCoordinate","vec3")):(d.vertex.uniforms.add("blurSize","vec2"),d.varyings.add("blurCoordinates[5]","vec2")),c.add(k.glsl`
    void main() {
      gl_Position = vec4(position, 0.0, 1.0);
      ${h.gridOptimization?k.glsl`
      vec4 cov = texture2D(coverageTex, uv0);
      if (cov.r == 0.0) {
        gl_Position = vec4(0.0);
      }
      blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
      `:k.glsl`
      vec2 uv = position.xy * 0.5 + vec2(0.5);
      blurCoordinates[0] = uv;
      blurCoordinates[1] = uv + blurSize * 1.407333;
      blurCoordinates[2] = uv - blurSize * 1.407333;
      blurCoordinates[3] = uv + blurSize * 3.294215;
      blurCoordinates[4] = uv - blurSize * 3.294215;
          `}
    }`),d.fragment.uniforms.add("tex","sampler2D"),e.add(k.glsl`
    void main() {
      ${h.gridOptimization?k.glsl`
          vec2 uv = blurCoordinate.xy;
          vec4 center = texture2D(tex, uv);

          // do not blur if no pixel or all pixels in neighborhood are set
          if (blurCoordinate.z == 1.0) {
            gl_FragColor = center;
          } else {
            vec4 sum = vec4(0.0);
            sum += center * 0.204164;
            sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
            sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
            sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
            gl_FragColor = sum;
          }`:k.glsl`
          vec4 sum = vec4(0.0);
          sum += texture2D(tex, blurCoordinates[0]) * 0.204164;
          sum += texture2D(tex, blurCoordinates[1]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[2]) * 0.304005;
          sum += texture2D(tex, blurCoordinates[3]) * 0.093913;
          sum += texture2D(tex, blurCoordinates[4]) * 0.093913;
          gl_FragColor = sum;`}
    }`));1===h.highlightStage&&(d.varyings.add("uv","vec2"),h.gridOptimization&&(d.attributes.add("uv0","vec2"),d.vertex.uniforms.add("coverageTex","sampler2D")),c.add(k.glsl`
      void main() {
        ${h.gridOptimization?k.glsl`
            vec4 cov = texture2D(coverageTex, uv0);
            // if no highlight pixel set in this block, hide block
            if (cov.r == 0.0) {
              gl_Position = vec4(0.0);
              return;
            }`:""}
        gl_Position = vec4(position, 0.0, 1.0);
        uv = position.xy * 0.5 + vec2(0.5);
      }`),d.fragment.uniforms.add("tex","sampler2D"),d.fragment.uniforms.add("origin","sampler2D"),d.fragment.uniforms.add("color","vec4"),d.fragment.uniforms.add("haloColor","vec4"),d.fragment.uniforms.add("outlineSize","float"),d.fragment.uniforms.add("blurSize","float"),d.fragment.uniforms.add("opacities","vec4"),e.add(k.glsl`
      void main() {
        // Read the highlight intensity from the blurred highlight image
        vec4 blurredHighlightValue = texture2D(tex, uv);
        float highlightIntensity = blurredHighlightValue.a;

        // Discard all pixels which are not affected by highlight
        if (highlightIntensity == 0.0) {
          discard;
        }

        vec4 origin_color = texture2D(origin, uv);

        float outlineIntensity;
        float fillIntensity;

        // if occluded
        if (blurredHighlightValue.g > blurredHighlightValue.b) {
          outlineIntensity = haloColor.w * opacities[1];
          fillIntensity = color.w * opacities[3];
        }
        // if unoccluded
        else {
          outlineIntensity = haloColor.w * opacities[0];
          fillIntensity = color.w * opacities[2];
        }

        float inner = 1.0 - outlineSize / 9.0;
        float outer = 1.0 - (outlineSize + blurSize) / 9.0;

        float outlineFactor = smoothstep(outer, inner, highlightIntensity);
        //float fillFactor = smoothstep(0.6, 0.72, highlightIntensity);
        float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
        float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;

        // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);
        // I.e., color should not be premultiplied with alpha
        gl_FragColor = vec4(mix(haloColor.rgb, color.rgb, fillFactor), intensity);
      }`));return d}var l=Object.freeze({__proto__:null,build:r});b.HighlightCompositionShader=l;b.build=r})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./RenderTargetHelper"],function(b,k,a){let r=function(){function d(e,f){this._rctx=e;this._compositingHelper=f;this._currentRenderTarget=0;this.dimensions={width:4,height:4};this._needLastFrameColorTexture=!1;this._background={type:"color",color:[0,0,0,1]};e=this.renderTargetHelper=
new a.RenderTargetHelper(this._rctx);this.mainColorTarget0=e.registerColorTarget({name:"mainColorTarget0"});this.mainColorTarget1=e.registerColorTarget({name:"mainColorTarget1"});this.frontFaceTarget=e.registerColorTarget({name:"frontFaceTarget"});this.colorFloatTarget=e.registerColorTarget({name:"colorFloatTarget",dataType:5126,samplingMode:9728});this.alphaFloatTarget=e.registerColorTarget({name:"alphaFloatTarget",dataType:5126,samplingMode:9728});this.mainDepth=e.registerDepthTarget({name:"mainDepth"});
this.linearDepth=e.registerColorTarget({name:"linearDepth",samplingMode:9728});this.normal=e.registerColorTarget({name:"normal"});this.highlight=e.registerColorTarget({name:"highlight",dataType:32819});this.hudVisibility=e.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=e.registerColorTarget({name:"tmpColor"});this.tmpDepth=e.registerDepthTarget({name:"tmpDepth"});this.hudColor=e.registerColorTarget({name:"hudColor"})}var c=d.prototype;c.dispose=function(){this.renderTargetHelper.dispose()};
c.getFramebuffer=function(e,f){return this.renderTargetHelper.getFramebuffer(this.dimensions,e,f)};c.advanceCurrentRenderTarget=function(){this._currentRenderTarget=0===this._currentRenderTarget&&this._needLastFrameColorTexture?1:0};c.initializeFrame=function(e){const f=this._rctx;this.dimensions.width=e.fullWidth;this.dimensions.height=e.fullHeight;this.bindTarget(this.currentColorTarget,this.mainDepth);f.setClearStencil(0);e=this._background.color;f.setClearColor(e[0]*e[3],e[1]*e[3],e[2]*e[3],e[3]);
f.clearSafe(17664)};c.composite=function(){this._compositingHelper.composite(this.colorTexture,0)};c.renderTmpAndCompositeToMain=function(e,f){this.renderToTargets(e,this.tmpColor,this.mainDepth,l);this._compositingHelper.composite(this.getColorTexture(this.tmpColor),f)};c.renderHUDVisibility=function(e){this.renderToTargets(e,this.hudVisibility,this.mainDepth,h)};c.compositeTransparentTerrainOntoHUDVisibility=function(){this.renderToTargets(()=>{this._compositingHelper.compositeSpecial(this.getColorTexture(this.tmpColor),
2)},this.hudVisibility,this.mainDepth)};c.renderOITPass=function(e,f,g){let p,n;switch(f){case 0:p=this.colorFloatTarget;n=[0,0,0,0];break;case 1:p=this.alphaFloatTarget;n=[1,1,1,1];break;case 2:p=this.frontFaceTarget,n=[0,0,0,0]}g?this.renderToTargets(e,p,this.tmpDepth,n,!0,!0):this.renderToTargets(e,p,this.mainDepth,n,!1)};c.compositeTransparentTerrainOntoMain=function(){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2)};c.compositeOccludedOntoMain=
function(e){this.bindFramebuffer();this._compositingHelper.composite(this.getColorTexture(this.tmpColor),2,e)};c.compositeTransparentOntoOpaque=function(e){e?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clearSafe(16384,255)):this.bindFramebuffer();this._compositingHelper.compositeTransparent(this.getColorTexture(this.colorFloatTarget),this.getColorTexture(this.alphaFloatTarget),this.getColorTexture(this.frontFaceTarget))};c.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};
c.renderDepthDetached=function(e){this.bindTarget(this.currentColorTarget);e();this.bindTarget(this.currentColorTarget,this.mainDepth)};c.disposeTarget=function(e){this.renderTargetHelper.disposeTargetResource(e)};c.renderToTargets=function(e,f,g,p,n,w){const q=this._rctx;f=this.bindTarget(f,g);g=0;p&&(q.setClearColor(p[0],p[1],p[2],Math.max(1E-13,p[3])),g|=16384);n&&(g|=256);w&&(g|=1024);g&&q.clearSafe(g,!0===w?255:!1===w?0:w);e();q.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth);
return f};c.bindTarget=function(e,f){e=this.renderTargetHelper.getFramebuffer(this.dimensions,e,f);this._rctx.bindFramebuffer(e);return e};c.getColorTexture=function(e){return this.renderTargetHelper.getColorTexture(e,this.dimensions)};c.getGpuMemoryUsage=function(){let e=0;this.renderTargetHelper&&(e+=this.renderTargetHelper.getGpuMemoryUsage());return e};k._createClass(d,[{key:"width",get:function(){return this.dimensions.width}},{key:"height",get:function(){return this.dimensions.height}},{key:"background",
set:function(e){this._background=e},get:function(){return this._background}},{key:"currentColorTarget",get:function(){return 0===this._currentRenderTarget?this.mainColorTarget0:this.mainColorTarget1}},{key:"previousColorTarget",get:function(){return 0===this._currentRenderTarget?this.mainColorTarget1:this.mainColorTarget0}},{key:"currentRenderTarget",get:function(){return this._currentRenderTarget}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}},
{key:"colorTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},{key:"depthTexture",get:function(){return this.renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},{key:"linearDepthTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"lastFrameColorTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},{key:"normalTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.normal)}},
{key:"highlightTexture",get:function(){return this.renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this.getColorTexture(this.hudVisibility)}},{key:"tmpColorTexture",get:function(){return this.getColorTexture(this.tmpColor)}},{key:"hudColorTexture",get:function(){return this.getColorTexture(this.hudColor)}},{key:"mainColorTexture",get:function(){return this.getColorTexture(this.currentColorTarget)}},{key:"needLastFrameColorTexture",set:function(e){!e&&
this._needLastFrameColorTexture&&(this._currentRenderTarget=0,this.disposeTarget(this.mainColorTarget1));this._needLastFrameColorTexture=e},get:function(){return this._needLastFrameColorTexture}}]);return d}();const l=[0,0,0,0],h=[0,1,0,1];b.OffscreenRendering=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define(["exports","../../../webgl/Texture","../../../webgl/Util","../../../webgl/Renderbuffer","../../../webgl/FramebufferObject"],
function(b,k,a,r,l){const h={dataType:5121},d={};let c=function(){function e(g){this.rctx=g;this._activeTargets=new Set;this._depthTextures=new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this._nextId=1;this.depthTextureSupported=g.capabilities.depthTexture}var f=e.prototype;f.dispose=function(){this._depthBuffers.forEach(g=>g.dispose());this._depthBuffers.clear();this._depthTextures.forEach(g=>g.dispose());this._depthTextures.clear();this._colorTextures.forEach(g=>
g.dispose());this._colorTextures.clear();this._framebuffers.forEach(g=>g.dispose());this._framebuffers.clear()};f.disposeTargetResource=function(g){g=g.id;this._activeTargets.has(g)&&(this._activeTargets.delete(g),this._depthTextures.has(g)&&(this._depthTextures.get(g).dispose(),this._depthTextures.delete(g)),this._depthBuffers.has(g)&&(this._depthBuffers.get(g).dispose(),this._depthBuffers.delete(g)),this._colorTextures.has(g)&&(this._colorTextures.get(g).dispose(),this._colorTextures.delete(g)))};
f.getDepthTexture=function(g,p){if(this.depthTextureSupported){var n=this._depthTextures.get(g.id);!n||n.descriptor.width===p.width&&n.descriptor.height===p.height||(n.dispose(),n=void 0);n||(n=new k(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:p.width,height:p.height}),this._depthTextures.set(g.id,n),this._activeTargets.add(g.id));return n}};f.getAllocatedDepthTexture=function(g){return this._depthTextures.get(g.id)};f.getDepthBuffer=function(g,p){if(!this.depthTextureSupported){var n=
this._depthBuffers.get(g.id);n?n.descriptor.width===p.width&&n.descriptor.height===p.height||n.resize(p.width,p.height):(n=new r(this.rctx,{internalFormat:34041,...p}),this._depthBuffers.set(g.id,n),this._activeTargets.add(g.id));return n}};f.getColorTexture=function(g,p){let n=this._colorTextures.get(g.id);!n||n.descriptor.width===p.width&&n.descriptor.height===p.height||(n.dispose(),n=void 0);n||(n=new k(this.rctx,{target:3553,pixelFormat:6408,dataType:g.dataType,samplingMode:null!=g.samplingMode?
g.samplingMode:9729,wrapMode:33071,width:p.width,height:p.height}),this._colorTextures.set(g.id,n),this._activeTargets.add(g.id));return n};f.getAllocatedColorTexture=function(g){return this._colorTextures.get(g.id)};f.registerDepthTarget=function(g={}){return{id:this._nextId++,...d,...g}};f.registerColorTarget=function(g={}){return{id:this._nextId++,...h,...g}};f.getFramebuffer=function(g,p,n){const w=this.getKey(p,n);let q=this._framebuffers.get(w);p=this.getColorTexture(p,g);if(this.depthTextureSupported){var m=
n?this.getDepthTexture(n,g):void 0;if(!q)return q=n?new l(this.rctx,{colorTarget:0,depthStencilTarget:4},p,m):new l(this.rctx,{colorTarget:0,depthStencilTarget:0},p),this._framebuffers.set(w,q),q;if(q.width!==g.width||q.height!==g.height||q.colorTexture!==p||q.depthStencilTexture!==m)q.detachColorTexture(),q.detachDepthStencilTexture(),q.resize(g.width,g.height),q.attachColorTexture(p),q.attachDepthStencilTexture(m);return q}m=n?this.getDepthBuffer(n,g):void 0;if(!q)return q=new l(this.rctx,{colorTarget:0,
depthStencilTarget:n?3:0},p,m),this._framebuffers.set(w,q),q;if(q.width!==g.width||q.height!==g.height||q.colorTexture!==p)q.detachColorTexture(),q.detachDepthStencilBuffer(),q.resize(g.width,g.height),q.attachColorTexture(p),q.attachDepthStencilBuffer(m);return q};f.getKey=function(g,p){return`${g.id}_${p?p.id:"X"}_${g.name}${p?"_"+p.name:""}`};f.getGpuMemoryUsage=function(){let g=0;const p=new Set,n=w=>{p.has(w)||(p.add(w),g+=a.getGpuMemoryUsage(w))};this._depthTextures.forEach(n);this._colorTextures.forEach(n);
this._depthBuffers.forEach(n);this._framebuffers.forEach(n);return g};return e}();b.RenderTargetHelper=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./Util","./depthRange"],function(b,k,a,r){let l=function(){function d(e){this.pluginContext=e;this.renderPlugins=[];this.slots=[];for(e=0;23>e;++e)this.slots[e]=[]}var c=d.prototype;c.add=function(e,f){this.renderPlugins.push(f);
for(let g=0;g<e.length;++g)this.slots[e[g]].push(f);f.initializeRenderContext(this.pluginContext);this.pluginContext.requestRender()};c.remove=function(e){var f=this.renderPlugins.length;this.renderPlugins=this.renderPlugins.filter(g=>g!==e);a.assert(this.renderPlugins.length<f,"Removing non-added render plugin");for(f=0;f<this.slots.length;++f)this.slots[f]=this.slots[f].filter(g=>g!==e);e.uninitializeRenderContext();this.pluginContext.requestRender()};c.prepareRender=function(e){for(const f of this.renderPlugins)f.prepareRender&&
f.prepareRender(e)};c.render=function(e,f){f.slot=e;e=this.slots[e];let g=!1;for(const p of e)p.canRender&&p.render(f)&&(g=!0);return g};c.queryDepthRange=function(e){const f=h;f.near=Infinity;f.far=-Infinity;for(const g of this.renderPlugins)if(g.queryDepthRange){const p=g.queryDepthRange(e);p&&r.union(f,p,f)}return f};k._createClass(d,[{key:"needsHighlight",get:function(){return this.renderPlugins.some(e=>e.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this.renderPlugins.some(e=>
e.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const e=this.slots[17];return!!e&&0<e.length}},{key:"renderOccludedFlags",get:function(){let e=0;this.renderPlugins.forEach(f=>{f.renderOccludedFlags&&(e|=f.renderOccludedFlags)});return e}}]);return d}();const h={near:0,far:0};b.RenderPluginManager=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../chunks/mat3f64 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec2 ../../../../chunks/vec4 ./Util ../../../webgl/Texture ../../../webgl/Util ./glUtil3D ./Camera ./DefaultTextureUnits ../../../webgl/FramebufferObject".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){function y(ea,Y){f.set(ka,ea[Y],ea[Y+3]);return ka}let B=function(){this.camera=new m;this.lightMat=d.create()},x=function(){function ea(Z,ba){this.rctx=Z;this.viewingMode=ba;this._enabled=!1;this.maxTextureSize=this.textureSize=0;this.numCascades=1;this.maxNumCascades=4;this.splitSchemeLambda=0;this.warp=!0;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.emptyTexture=q.createEmptyTexture(this.rctx);this.maxTextureSize=this.rctx.parameters.maxTextureSize;
for(Z=0;4>Z;++Z)this.cascades.push(new B)}var Y=ea.prototype;Y.dispose=function(){this.emptyTexture.dispose();this.emptyTexture=null;this.discardDepthTexture()};Y.getDepthTexture=function(){return this.depthTexture};Y.getCascades=function(){for(let Z=0;Z<this.numCascades;++Z)T[Z]=this.cascades[Z];T.length=this.numCascades;return T};Y.prepare=function(Z,ba,ia){p.assert(this.enabled);this.textureSize=this.computeTextureSize(Z.fullWidth,Z.fullHeight);this.assertDepthTexture();l.multiply(z,Z.projectionMatrix,
Z.viewMatrix);var ja=ia.near,la=ia.far;2>ja&&(ja=2);2>la&&(la=2);ja>=la&&(ja=2,la=4);this.numCascades=Math.min(1+Math.floor(p.logWithBase(la/ja,4)),this.maxNumCascades);ia=(la-ja)/this.numCascades;var qa=Math.pow(la/ja,1/this.numCascades),na=ja;for(la=0;la<this.numCascades+1;++la)this.cascadeDistances[la]=k.lerp(na,ja,this.splitSchemeLambda),na*=qa,ja+=ia;l.invert(A,z);ia=1===this.viewingMode?Z.eye:r.set(M,0,0,1);l.lookAt(S,[0,0,0],[-ba[0],-ba[1],-ba[2]],ia);ia=Z.viewMatrix;Z=Z.projectionMatrix;for(qa=
0;qa<this.numCascades;++qa){na=this.cascades[qa];ja=-this.cascadeDistances[qa];la=-this.cascadeDistances[qa+1];ja=(Z[10]*ja+Z[14])/Math.abs(Z[11]*ja+Z[15]);la=(Z[10]*la+Z[14])/Math.abs(Z[11]*la+Z[15]);p.assert(ja<la);for(var oa=0;8>oa;++oa){g.set(t,0===oa%4||3===oa%4?-1:1,0===oa%4||1===oa%4?-1:1,4>oa?ja:la,1);g.transformMat4(D[oa],t,A);for(var ua=0;3>ua;++ua)D[oa][ua]/=D[oa][3]}r.negate(M,D[0]);l.translate(C,S,M);na.camera.viewMatrix=C;for(ja=0;8>ja;++ja)r.transformMat4(D[ja],D[ja],na.camera.viewMatrix);
r.copy(E,D[0]);r.copy(G,D[0]);for(ja=1;8>ja;++ja)for(la=0;3>la;++la)E[la]=Math.min(E[la],D[ja][la]),G[la]=Math.max(G[la],D[ja][la]);E[2]-=200;G[2]+=200;na.camera.near=-G[2];na.camera.far=-E[2];if(this.warp){ja=1/D[0][3];la=1/D[4][3];p.assert(ja<la);oa=ja+Math.sqrt(ja*la);la=Math.sin(k.acosClamped(ia[2]*ba[0]+ia[6]*ba[1]+ia[10]*ba[2]));oa/=la;var za=void 0,Fa=void 0;ja=D;var La=oa;za=la;la=H;var Sa=I,Ia=J;ua=K;oa=L;f.set(F,0,0);for(Fa=0;4>Fa;++Fa)f.add(F,F,ja[Fa]);f.scale(F,F,.25);f.set(N,0,0);for(Fa=
4;8>Fa;++Fa)f.add(N,N,ja[Fa]);f.scale(N,N,.25);f.lerp(P[0],ja[4],ja[5],.5);f.lerp(P[1],ja[5],ja[6],.5);f.lerp(P[2],ja[6],ja[7],.5);f.lerp(P[3],ja[7],ja[4],.5);Fa=0;var Qa=f.squaredDistance(P[0],F);for(var Pa=1;4>Pa;++Pa){var sa=f.squaredDistance(P[Pa],F);sa<Qa&&(Qa=sa,Fa=Pa)}f.subtract(U,P[Fa],ja[Fa+4]);Fa=U[0];U[0]=-U[1];U[1]=Fa;f.subtract(V,N,F);0>f.dot(V,U)&&f.negate(U,U);f.lerp(U,U,V,za);f.normalize(U,U);Fa=za=f.dot(f.subtract(W,ja[0],F),U);for(Qa=1;8>Qa;++Qa)Pa=f.dot(f.subtract(W,ja[Qa],F),U),
Pa<Fa?Fa=Pa:Pa>za&&(za=Pa);f.copy(la,F);f.scale(W,U,Fa-La);f.add(la,la,W);Pa=-1;sa=1;La=Qa=0;for(let Ga=0;8>Ga;++Ga){f.subtract(X,ja[Ga],la);f.normalize(X,X);const Ra=U[0]*X[1]-U[1]*X[0];0<Ra?Ra>Pa&&(Pa=Ra,Qa=Ga):Ra<sa&&(sa=Ra,La=Ga)}p.verify(0<Pa,"leftArea");p.verify(0>sa,"rightArea");f.scale(ca,U,Fa);f.add(ca,ca,F);f.scale(R,U,za);f.add(R,R,F);aa[0]=-U[1];aa[1]=U[0];Sa=p.rayRay2D(la,ja[La],R,f.add(W,R,aa),1,Sa);Ia=p.rayRay2D(la,ja[Qa],R,W,1,Ia);ua=p.rayRay2D(la,ja[Qa],ca,f.add(W,ca,aa),1,ua);ja=
p.rayRay2D(la,ja[La],ca,W,1,oa);p.verify(Sa,"rayRay");p.verify(Ia,"rayRay");p.verify(ua,"rayRay");p.verify(ja,"rayRay");Ia=H;ja=I;la=K;ua=L;oa=na.camera.projectionMatrix;f.subtract(da,la,ua);f.scale(da,da,.5);fa[0]=da[0];fa[1]=da[1];fa[2]=0;fa[3]=da[1];fa[4]=-da[0];fa[5]=0;fa[6]=da[0]*da[0]+da[1]*da[1];fa[7]=da[0]*da[1]-da[1]*da[0];fa[8]=1;fa[6]=-f.dot(y(fa,0),Ia);fa[7]=-f.dot(y(fa,1),Ia);Ia=f.dot(y(fa,0),la)+fa[6];Sa=f.dot(y(fa,1),la)+fa[7];La=f.dot(y(fa,0),ua)+fa[6];ua=f.dot(y(fa,1),ua)+fa[7];Ia=
-(Ia+La)/(Sa+ua);fa[0]+=fa[1]*Ia;fa[3]+=fa[4]*Ia;fa[6]+=fa[7]*Ia;Ia=1/(f.dot(y(fa,0),la)+fa[6]);Sa=1/(f.dot(y(fa,1),la)+fa[7]);fa[0]*=Ia;fa[3]*=Ia;fa[6]*=Ia;fa[1]*=Sa;fa[4]*=Sa;fa[7]*=Sa;fa[2]=fa[1];fa[5]=fa[4];fa[8]=fa[7];fa[7]+=1;Ia=f.dot(y(fa,1),ja)+fa[7];Sa=f.dot(y(fa,2),ja)+fa[8];La=f.dot(y(fa,1),la)+fa[7];ua=f.dot(y(fa,2),la)+fa[8];Ia=-.5*(Ia/Sa+La/ua);fa[1]+=fa[2]*Ia;fa[4]+=fa[5]*Ia;fa[7]+=fa[8]*Ia;Ia=f.dot(y(fa,1),ja)+fa[7];Sa=f.dot(y(fa,2),ja)+fa[8];La=-Sa/Ia;fa[1]*=La;fa[4]*=La;fa[7]*=La;
oa[0]=fa[0];oa[1]=fa[1];oa[2]=0;oa[3]=fa[2];oa[4]=fa[3];oa[5]=fa[4];oa[6]=0;oa[7]=fa[5];oa[8]=0;oa[9]=0;oa[10]=1;oa[11]=0;oa[12]=fa[6];oa[13]=fa[7];oa[14]=0;oa[15]=fa[8];na.camera.projectionMatrix[10]=2/(E[2]-G[2]);na.camera.projectionMatrix[14]=-(E[2]+G[2])/(E[2]-G[2])}else l.ortho(na.camera.projectionMatrix,E[0],G[0],E[1],G[1],na.camera.near,na.camera.far);l.multiply(na.lightMat,na.camera.projectionMatrix,na.camera.viewMatrix);ja=this.textureSize/2;na.camera.viewport[0]=0===qa%2?0:ja;na.camera.viewport[1]=
0===Math.floor(qa/2)?0:ja;na.camera.viewport[2]=ja;na.camera.viewport[3]=ja}this.lastOrigin=null;ba=this.rctx;ba.bindFramebuffer(this.fbo);ba.bindTexture(null,7);ba.setClearColor(1,1,1,1);ba.clearSafe(16640)};Y.finish=function(Z){p.assert(this.enabled);this.rctx.bindFramebuffer(Z)};Y.bind=function(Z,ba){const ia=this.rctx;ia.bindTexture(this.enabled?this.depthTexture:this.emptyTexture,ba);ia.bindProgram(Z);Z.setUniform1i("depthTex",ba);Z.setUniform1f("depthHalfPixelSz",this.enabled?.5/this.textureSize:
-1);Z.setUniform1i("shadowMapNum",this.numCascades);Z.setUniform4f("shadowMapDistance",this.cascadeDistances[0],1<this.numCascades?this.cascadeDistances[1]:Infinity,2<this.numCascades?this.cascadeDistances[2]:Infinity,3<this.numCascades?this.cascadeDistances[3]:Infinity)};Y.bindToAllPrograms=function(Z){Z=Z.getProgramsUsingUniform("shadowMapDistance");for(let ba=0;ba<Z.length;ba++)this.bind(Z[ba],u.DefaultTextureUnits.SHADOW_MAP)};Y.bindView=function(Z,ba){if(this.enabled){var ia=this.lastOrigin;
if(!ia||ia[0]!==ba[0]||ia[1]!==ba[1]||ia[2]!==ba[2])for(this.lastOrigin=this.lastOrigin||a.create(),r.copy(this.lastOrigin,ba),ia=0;ia<this.numCascades;++ia){l.translate(O,this.cascades[ia].lightMat,ba);for(let ja=0;16>ja;++ja)Q[16*ia+ja]=O[ja]}Z.setUniformMatrix4fv("shadowMapMatrix",Q)}};Y.computeTextureSize=function(Z,ba){return Math.min(this.maxTextureSize,2*2**Math.round(.5*Math.log(Z*Z+ba*ba)*Math.LOG2E+.35))};Y.assertDepthTexture=function(){if(null==this.depthTexture||this.depthTexture.descriptor.width!==
this.textureSize)this.discardDepthTexture(),this.depthTexture=new n(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0,width:this.textureSize,height:this.textureSize}),this.fbo=new v(this.rctx,{colorTarget:0,depthStencilTarget:1,width:this.textureSize,height:this.textureSize},this.depthTexture)};Y.discardDepthTexture=function(){this.fbo&&(this.fbo.dispose(),this.fbo=null);this.depthTexture&&(this.depthTexture.dispose(),this.depthTexture=null)};Y.getGpuMemoryUsage=
function(){return w.getGpuMemoryUsage(this.fbo)};b._createClass(ea,[{key:"maxCascades",set:function(Z){this.maxNumCascades=k.clamp(Math.floor(Z),1,4)},get:function(){return this.maxNumCascades}},{key:"enabled",set:function(Z){(this._enabled=Z)||this.discardDepthTexture()},get:function(){return this._enabled}},{key:"test",get:function(){const Z=this;return{maxNumCascades:this.maxNumCascades,cascades:this.cascades,textureSize:this.textureSize,set splitSchemeLambda(ba){Z.splitSchemeLambda=ba},get splitSchemeLambda(){return Z.splitSchemeLambda},
set warp(ba){Z.warp=ba},get warp(){return Z.warp}}}}]);return ea}();const C=d.create(),z=d.create(),A=d.create(),t=e.create(),D=[];for(let ea=0;8>ea;++ea)D.push(e.create());const E=a.create(),G=a.create(),H=c.create(),I=c.create(),J=c.create(),K=c.create(),L=c.create(),S=d.create(),M=a.create(),T=[],O=d.create(),Q=new Float32Array(64),F=c.create(),N=c.create(),P=[c.create(),c.create(),c.create(),c.create()],U=c.create(),V=c.create(),W=c.create(),X=c.create(),ca=c.create(),R=c.create(),aa=c.create(),
ka=c.create(),da=c.create(),fa=h.create();return x})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../support/geometryUtils"],function(b,k){const a=k.boundedPlane.create();return function(){function r(){this._worldPlane=a}b._createClass(r,[{key:"isEnabled",get:function(){return this.plane!==a}},{key:"plane",get:function(){return this._worldPlane},set:function(l){this._worldPlane=l?l:a}}]);return r}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/promiseUtils ../../../../support/requestImageUtils ../../../webgl/Program ../../../webgl/renderState ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/FramebufferObject".split(" "),
function(b,k,a,r,l,h,d,c,e,f){return function(){function g(n){this.resourceLoadingPromise=null;this.isEnabled=!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=n}var p=g.prototype;p.loadResources=function(n){if(!this.data||!this.textureArea||!this.textureSearch){const w=this.resourceLoadingPromise||this.loadDataModule().then(()=>this.loadTextures());n&&w.then(n);this.resourceLoadingPromise||(this.resourceLoadingPromise=
w,w.then(()=>this.resourceLoadingPromise=null));return!1}return!0};p.loadDataModule=function(){return this.data?a.resolve():(new Promise(function(n,w){b(["./SmaaRenderPassData"],n,w)})).then(n=>{this.data=n})};p.loadTextures=function(){return a.all([this.loadTextureFromBase64(this.data.areaTexture,9729,6407),this.loadTextureFromBase64(this.data.searchTexure,9728,6409)]).then(([n,w])=>{this.textureArea=n;this.textureSearch=w})};p.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;
const n=this.rctx;this.programEdgeDetect=new l(n,this.data.edgeDetectShader.vertex,this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new l(n,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new l(n,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);this.pipelineState=h.makePipelineState({colorWrite:h.defaultColorWriteParams});const w=new Float32Array([-1,
-1,3,-1,-1,3]);this.vao=new e(n,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new d(n,34962,35044,w)});this.tmpFramebufferEdges=new f(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});this.tmpFramebufferBlend=new f(this.rctx,{colorTarget:0,depthStencilTarget:0},{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4});return this.isEnabled=
!0};p.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=null,this.isEnabled=!1)};
p.render=function(n){this.enable();const w=this.rctx,q=w.getBoundFramebufferObject();var m=n.colorTexture.descriptor.width,u=n.colorTexture.descriptor.height;w.bindVAO(this.vao);w.setPipelineState(this.pipelineState);w.setViewport(0,0,m,u);this.tmpFramebufferEdges.resize(m,u);w.bindFramebuffer(this.tmpFramebufferEdges);w.setClearColor(0,0,0,1);w.clear(16384);w.bindProgram(this.programEdgeDetect);w.bindTexture(n.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",
1/m,1/u,m,u);w.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(m,u);w.bindFramebuffer(this.tmpFramebufferBlend);w.setClearColor(0,0,1,1);w.clear(16384);w.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/m,1/u,m,u);w.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);w.bindTexture(this.textureArea,2);this.programBlendWeights.setUniform1i("tArea",2);w.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",
3);w.drawArrays(4,0,3);w.bindFramebuffer(q);w.setClearColor(0,1,0,1);w.clear(16384);w.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/m,1/u,m,u);w.bindTexture(n.colorTexture,0);this.programBlur.setUniform1i("tColor",0);w.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",1);w.drawArrays(4,0,3)};p.loadTextureFromBase64=function(n,w,q){const m=new c(this.rctx,{pixelFormat:q,dataType:5121,wrapMode:33071,samplingMode:w},null);
return r.requestImage(n).then(u=>{m.resize(u.width,u.height);m.setData(u);return m})};k._createClass(g,[{key:"isLoadingResources",get:function(){return null!=this.resourceLoadingPromise}}]);return g}()})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Logger ../../../../chunks/vec3 ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../../../../chunks/vec4 ../../../../support/requestImageUtils ./Util ../../../webgl/Texture ../../../webgl/Util ./glUtil3D ./DefaultTextureUnits ../../../webgl/FramebufferObject ./SSAOTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){const u=r.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");r=function(){function B(C,z,A){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=d.create();this.quadVAO=null;this._rctx=z;this._techniqueRep=C;this._requestRender=A;this._ssaoTechniqueConfig=new m.SSAOTechniqueConfiguration;this._emptyTexture=n.createColorTexture(z,[1,1,1,1])}var x=B.prototype;x.dispose=function(){this._emptyTexture.dispose();
this._emptyTexture=null;a.isSome(this.quadVAO)&&(this.quadVAO=a.disposeMaybe(this.quadVAO))};x.computeSSAO=function(C,z,A){if(this._noiseTexture){f.assert(this.enabled);var t=this._rctx,D=C.fullViewport,E=D[2],G=D[3];D=E/this._BLUR_F;var H=G/this._BLUR_F;this._ssaoFBO.resize(E,G);this._blur0FBO.resize(D,H);this._blur1FBO.resize(D,H);D=1*E;H=1*G;t.bindFramebuffer(this._ssaoFBO);c.copy(this._viewportToRestore,C.fullViewport);t.setViewport(0,0,E,G);var I=this._ssaoTechnique.program,J=this._blurTechnique.program;
t.bindProgram(I);t.setPipelineState(this._ssaoTechnique.pipeline);I.setUniform2f("rnmScale",E/this._noiseTexture.descriptor.width,G/this._noiseTexture.descriptor.height);I.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:32>=this._samples?this._data.random32:this._data.random64);E=this._data.minDiscrepancy;I.setUniform1f("numSpiralTurns",this._samples<E.length?E[this._samples]:5779);E=y;G=v;f.inverseProjectionInfo(C.projectionMatrix,C.fullWidth,C.fullHeight,
E,G);I.setUniform4fv("projInfo",E);I.setUniform2fv("zScale",G);I.setUniform2f("nearFar",C.near,C.far);E=1/C.computeRenderPixelSizeAtDist(1);I.setUniform1f("projScale",1*E);I.setUniform2f("screenDimensions",D,H);var K=2*this._radius;G=l.distance(C.eye,C.center);K=20*C.computeRenderPixelSizeAtDist(G);K=Math.max(.1,K);I.setUniform1f("radius",K);I.setUniform1f("intensity",4*this._attenuation/Math.pow(K,6));I.setUniform1i("rnm",0);I.setUniform1i("normalMap",1);I.setUniform1i("depthMap",2);t.bindTexture(this._noiseTexture,
0);t.bindTexture(A,1);t.bindTexture(z,2);a.isSome(this.quadVAO)||(this.quadVAO=n.createQuadVAO(this._rctx));z=this.quadVAO;t.bindVAO(z);t.drawArrays(5,0,p.vertexCount(z,"geometry"));t.bindTexture(this._ssaoFBO.colorTexture,0);t.setViewport(0,0,D/this._BLUR_F,H/this._BLUR_F);t.bindFramebuffer(this._blur0FBO);t.bindProgram(J);J.setUniform2f("screenDimensions",D,H);J.setUniform1i("tex",0);J.setUniform1i("normalMap",1);J.setUniform1i("depthMap",2);J.setUniform2f("blurSize",0,1*this._BLUR_F/H);J.setUniform1i("radius",
4);J.setUniform1f("g_BlurFalloff",.08);J.setUniform2f("nearFar",C.near,C.far);5E4<G&&(E=Math.max(0,E-(G-5E4)));J.setUniform1f("projScale",E);J.setUniform2f("zScale",1,0);t.drawArrays(5,0,p.vertexCount(z,"geometry"));J.setUniform2f("blurSize",1*this._BLUR_F/D,0);t.bindFramebuffer(this._blur1FBO);t.bindTexture(this._blur0FBO.colorTexture,0);t.drawArrays(5,0,p.vertexCount(z,"geometry"));t.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};
x.setUniforms=function(C,z){const A=this.enabled&&this._noiseTexture,t=this._rctx;t.bindTexture(A?this._blur1FBO.colorTexture:this._emptyTexture,z);t.setActiveTexture(0);C.setUniform1i("ssaoTex",z);A?C.setUniform4f("viewportPixelSz",this._viewportToRestore[0],this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):C.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};x.bindToAllPrograms=function(C){C=C.getProgramsUsingUniform("viewportPixelSz");for(let z=0;z<C.length;z++)this.setUniforms(C[z],
w.DefaultTextureUnits.SSAO)};x.selectPrograms=function(){this._ssaoTechniqueConfig.samples=8>=this._samples?8:16>=this._samples?16:32>=this._samples?32:64;this._ssaoTechniqueConfig.radius=4;this._ssaoTechniqueConfig.output=0;this._ssaoTechnique=this._techniqueRep.acquireAndReleaseExisting(m.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);this._ssaoTechniqueConfig.output=1;this._blurTechnique=this._techniqueRep.acquireAndReleaseExisting(m.SSAOTechnique,this._ssaoTechniqueConfig,this._blurTechnique)};
x.enable=function(){this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(()=>{this._enabled&&this.initialize()})):u.warn("SSAO is not supported for this browser or hardware"))};x.loadResources=function(C){this._data?C():(new Promise(function(z,A){b(["./SSAOHelperData"],z,A)})).then(z=>{this._data=z;C()})};x.initialize=function(){const C={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0},z={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=
new q(this._rctx,z,C);this._blur0FBO=new q(this._rctx,z,C);this._blur1FBO=new q(this._rctx,z,C);e.requestImage(this._data.noiseTexture).then(A=>{this._enabled&&(this._noiseTexture=new g(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:A.width,height:A.height},A),this._requestRender())});this.selectPrograms()};x.disable=function(){this.enabled&&(this._enabled=!1,this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),
this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};x.getGpuMemoryUsage=function(){return p.getGpuMemoryUsage(this._blur0FBO)+p.getGpuMemoryUsage(this._blur1FBO)+p.getGpuMemoryUsage(this._ssaoFBO)};k._createClass(B,[{key:"isSupported",get:function(){var C=this._rctx;const z=-1!==C.parameters.versionString.indexOf("WebGL 0.93");C=-1!==C.parameters.versionString.indexOf("WebGL 0.94");return!(z||C)}},{key:"enabled",
set:function(C){C?this.enable():this.disable()},get:function(){return this._enabled}},{key:"attenuation",set:function(C){this._attenuation=C},get:function(){return this._attenuation}},{key:"radius",set:function(C){this._radius=C},get:function(){return this._radius}},{key:"filterRadius",get:function(){return 4}},{key:"samples",set:function(C){this._samples=C;this._enabled&&this.selectPrograms()},get:function(){return this._samples}},{key:"test",get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}]);
return B}();const v=h.create(),y=d.create();return r})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../../../../chunks/SSAO.glsl".split(" "),function(b,k,a,r,l,h,d,c,
e,f,g){h=function(p){function n(){return p.apply(this,arguments)||this}a._inheritsLoose(n,p);var w=n.prototype;w.initializeProgram=function(q){var m=n.shader.get();const u=this.configuration;m=m.build({output:u.output,samples:u.samples,radius:u.radius});return new e(q.rctx,m.generateSource("vertex"),m.generateSource("fragment"),c.Default3D)};w.initializePipeline=function(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})};return n}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(g.SSAOShader,
()=>new Promise(function(p,n){b(["../shaders/SSAO.glsl"],p,n)}));l=function(p){function n(){var w=p.apply(this,arguments)||this;w.output=0;w.samples=64;w.radius=4;return w}a._inheritsLoose(n,p);return n}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter({count:2})],l.prototype,"output",void 0);r.__decorate([d.parameter()],l.prototype,"samples",void 0);r.__decorate([d.parameter()],l.prototype,"radius",void 0);k.SSAOTechnique=h;k.SSAOTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",
{value:!0})})},"esri/chunks/SSAO.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl".split(" "),function(b,k,a,r,l,h){function d(e){const f=new a.ShaderBuilder;f.include(l.ScreenSpacePass);1===e.output&&(f.include(r.ReadLinearDepth),
f.fragment.code.add(k.glsl`
      #ifndef RADIUS
        #define RADIUS `+e.radius+"\n      #endif\n    "),f.fragment.uniforms.add("normalMap","sampler2D").add("depthMap","sampler2D").add("tex","sampler2D").add("blurSize","vec2").add("g_BlurFalloff","float").add("projScale","float").add("nearFar","vec2").add("zScale","vec2"),f.fragment.code.add(k.glsl`
      float blurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);

        w_total += w;

        return w*c;
      }

      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/(center_d*zScale.x+zScale.y);
        for (int r = -RADIUS; r <= RADIUS; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf*blurSize;
          b += blurFunction(uvOffset, rf, center_d, w_total, sharpness);
        }

        gl_FragColor = vec4(b/w_total);
      }
    `));0===e.output&&(f.include(r.ReadLinearDepth),f.include(h.CameraSpace),f.fragment.uniforms.add("projMatrixInv","mat4").add("normalMap","sampler2D").add("depthMap","sampler2D").add("intensity","float").add("projScale","float").add("radius","float").add("nearFar","vec2").add("screenDimensions","vec2").add("rnmScale","vec2").add("rnm","sampler2D"),f.fragment.code.add(k.glsl`
      #ifndef SAMPLES
        #define SAMPLES `+e.samples+"\n      #endif\n      uniform vec3 pSphere[SAMPLES]; //tap position\n    "),f.fragment.code.add(k.glsl`
      float fallOffFunction(float vv, float vn, float bias) {
        float radius2 = radius * radius;

        // A: From the HPG12 paper
        // Note large epsilon to avoid overdarkening within cracks
        // return float(vv < radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;

        // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]
        float f = max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);

        // C: Medium contrast (which looks better at high radii), no division.  Note that the
        // contribution still falls off with radius^2, but we've adjusted the rate in a way that is
        // more computationally efficient and happens to be aesthetically pleasing.
        // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);

        // D: Low contrast, no division operation
        // return 2.0 * float(vv < radius * radius) * max(vn - bias, 0.0);
      }
    `),f.fragment.code.add(k.glsl`
      float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
        vec3 v = Q - C;
        float vv = dot(v, v);
        float vn = dot(normalize(v), n_C);
        return fallOffFunction(vv, vn, 0.1);
      }
    `),f.fragment.code.add(k.glsl`
      void main(void) {
        //Hash function used in the HPG12 AlchemyAO paper
        //Not supported in WebGL -> using texture lookup as in old SSAO shader instead
        //ivec2 ssC = ivec2(gl_FragCoord.xy);
        //float randomPatternRotationAngle = float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));

        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;

        vec4 occluderFragment;
        vec3 ray;

        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);

        for(int i = 0; i < SAMPLES; ++i) {
          // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it
          //float ssR;
          //vec2 unitOffset = tapLocation(i, randomPatternRotationAngle, ssR);
          // get the depth of the occluder fragment
          //vec2 offset = vec2(-unitOffset*radius*ssR*ps);

          vec2 unitOffset = reflect(pSphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset*radius*ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenDimensions.x || tc.y > screenDimensions.y) continue;
          vec2 tcTap = tc/screenDimensions;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result

        float A = max(1.0-sum*intensity/float(SAMPLES),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther
        // (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;

        //gl_FragColor = vec4(norm/2.0+0.5, 1.0);
        //gl_FragColor = vec4(-currentPixelDepth/1000.0);
        //gl_FragColor = vec4(tapPixelPos.x/100.0);
        gl_FragColor = vec4(A);
      }
    `));return f}var c=Object.freeze({__proto__:null,build:d});b.SSAOShader=c;b.build=d})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.CameraSpace=function(a){a.fragment.uniforms.add("projInfo","vec4");a.fragment.uniforms.add("zScale","vec2");a.fragment.code.add(k.glsl`
    vec3 reconstructPosition(vec2 fragCoord, float depth) {
      return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/has ../../../../../core/typedArrayUtil ../../../../../core/maybe ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat4 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/mat3 ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject ../Object3D ../GridLocalOriginFactory ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../../../chunks/vec33 ../../core/util/TwoVectorPosition ../TextureBackedBuffer/BufferManager ../localOriginHelper ../LocalOriginManager ./bufferLayouts ./edgeBufferWriters ./EdgeRenderer ./EdgeWorkerHandle ./strokes ./util".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I){function J(L){let S=null,M=null;for(let T=0;T<L.geometries.length;T++){const O=L.geometryRecords[T];if(O.material.supportsEdges){if(!S)S=O.transformation;else if(!h.equals(S,O.transformation))return!1;if(!M&&O.origin)M=O;else if(M&&O.origin&&M.origin.id!==O.origin.id)return!1}}return!0}a=function(){function L(M,T,O,Q){this.rctx=M;this.techniqueRepository=T;this.callbacks=O;this.profilingCallback=null;this.perObjectData=new Map;
this.renderers=new Map;this.localOrigins=new A.LocalOriginManager(new v);this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.workerAbort=d.createAbortController();this.destroyed=!1;this.tmpModelPosition=e.create();this.tmpCameraPosition=e.create();this.componentColorManager=new C.BufferManager(this.rctx,2);this.worker=new G(Q);M=t.VertexLayout.createBuffer(4);for(T=0;4>T;T++)M.sideness.set(T,0,0===T||3===T?0:1),M.sideness.set(T,1,0===T||1===T?0:1);this.verticesBufferObject=q.createVertex(this.rctx,
35044,M.buffer)}var S=L.prototype;S.destroy=function(){this.destroyed||(this.perObjectData.forEach((M,T)=>{this.perObjectData.delete(T);M.renderables.forEach(O=>{this.removeRenderable(O)})}),this.strokesTexture=l.disposeMaybe(this.strokesTexture),this.componentColorManager=l.destroyMaybe(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=l.disposeMaybe(this.verticesBufferObject),this.perObjectData.clear(),this.renderers.clear(),this.destroyed=!0)};
S.getUsedMemory=function(){return this.gpuMemoryUsage};S.shouldRender=function(){return 0<this.renderers.size};S.addComponentObject=async function(M,T,O,Q,F,N,P,U){if(!this.hasObject(M)){var V;O=new K(d.create(W=>V=W),O);this.perObjectData.set(M,O);await this.addComponentGeometry(T,O,Q,F,N,P,U);this.callbacks.setNeedsRender();V()}};S.addOrUpdateObject3D=async function(M,T,O,Q){const F=[];let N;const P=new K(d.create(V=>N=V)),U=this.perObjectData.get(M);this.perObjectData.set(M,P);if(O.mergeGeometries&&
1<M.geometries.length&&J(M))F.push(this.addObjectMergedGeometries(M,P,T,O,Q));else for(let V=0;V<M.geometries.length;V++){const W=M.geometryRecords[V];W.material.supportsEdges&&F.push(this.addGeometryData(M,P,M.geometries[V].data,W,T[0],O,Q))}await d.all(F);U&&U.waitLoaded(()=>{U.renderables.forEach(V=>this.removeRenderable(V));this.callbacks.setNeedsRender()});this.callbacks.setNeedsRender();N()};S.hasObject=function(M){return this.perObjectData.has(M)};S.updateAllComponentOpacities=async function(M,
T){const O=T instanceof Array?Q=>T[Q]:()=>T;(await this.getObjectEntry(M)).renderables.forEach(Q=>{const F=Q.components.meta.length;for(let N=0;N<F;N++){const P=O(N),U=Q.components.meta[N],V=U.index;U.material.opacity=P;Q.components.buffer.textureBuffer.setDataElement(V,1,3,255*P)}this.updateTransparency(Q)});this.callbacks.setNeedsRender()};S.updateAllComponentMaterials=async function(M,T,O,Q){const F=M instanceof u,N=!!O.slicePlaneEnabled,P=I.determineRendererType(T),U=E.EdgeRenderer.getKey(P,N,
F);(await this.getObjectEntry(M)).renderables.forEach(V=>{if(U!==V.rendererKey){var W=this.renderers.get(V.rendererKey);const X=this.acquireRenderer(P,N,F);W.removeRenderable(V);W.refCount.decrement();V.rendererKey=U;X.addRenderable(V)}for(W=0;W<T.length;W++)V.components.meta[W].material=T[W];Q&&this.updateComponentBuffer(V.components);this.updateTransparency(V)});this.callbacks.setNeedsRender()};S.updateObjectVisibility=async function(M,T){(await this.getObjectEntry(M)).renderables.forEach(O=>O.visible=
T);this.callbacks.setNeedsRender()};S.removeObject=function(M){const T=this.perObjectData.get(M);T&&(this.perObjectData.delete(M),T.waitLoaded(()=>{T.renderables.forEach(O=>this.removeRenderable(O));this.callbacks.setNeedsRender()}))};S.getObjectEntry=async function(M){M=this.perObjectData.get(M);if(!M)throw"no object";await M.loaded;return M};S.removeAll=function(){this.perObjectData.forEach((M,T)=>this.removeObject(T))};S.render=function(M,T){if(!l.isNone(this.componentColorManager)){this.localOrigins.updateViewMatrices(M.camera.viewMatrix);
var O=M.camera.viewInverseTransposeMatrix,Q=e.create(),F=new x.TwoVectorPosition,N=new y.VertexPosition.ViewProjectionTransform,P=p.create();f.set(Q,O[3],O[7],O[11]);F.set(Q);f.copy(N.worldFromView_TH,F.high);f.copy(N.worldFromView_TL,F.low);w.fromMat4(N.viewFromCameraRelative_RS,M.camera.viewMatrix);g.copy(N.projFromView,M.camera.projectionMatrix);O=p.create();w.transpose(O,N.viewFromCameraRelative_RS);w.invert(P,O);this.renderers.forEach(X=>{0===X.refCount.value&&(this.renderers.delete(X.key),X.dispose())});
this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();var U=0,V=0;this.renderers.forEach(X=>X.forEachRenderable(ca=>{U+=ca.statistics.averageEdgeLength;V++},T));if(0!==V){O=40*U/V;Q=I.estimateLengthAtDistance(M.camera.fullViewport[3],M.camera.fovY,1,3.5*M.camera.pixelRatio);var W={distanceFalloffFactor:O,minimumEdgeLength:Q,transparency:T,viewProjectionTransform:N,transformNormal_ViewFromGlobal:P};this.updateObjectCameraDistances(M);this.numberOfRenderedEdges=0;this.renderers.forEach(X=>
{this.renderRegularEdges(X,M,W);this.renderSilhouetteEdges(X,M,W)})}}};S.updateTransparency=function(M){const T=I.determineEdgeTransparency(M.components.meta),O=I.determineObjectTransparency(M.components.meta);if(T!==M.edgeTransparency||O!==M.objectTransparency)M.edgeTransparency=T,M.objectTransparency=O,this.renderers.get(M.rendererKey).setRenderablesDirty()};S.computeModelTransformWithLocalOrigin=function(M,T,O){M.getCombinedStaticTransformation(T,O);T.origin?this.localOrigins.register(T.origin):
(M=f.set(this.tmpModelPosition,O[12],O[13],O[14]),T.origin=this.localOrigins.acquire(M));z.applyToModelMatrix(T.origin.vec3,O);return O};S.updateComponentBuffer=function(M){const {meta:T,buffer:O}=M;for(M=0;M<T.length;M++){var Q=T[M].material;const F=T[M].index,N=c.clamp(Math.round(Q.size*E.LINE_WIDTH_FRACTION_FACTOR),0,255),P=c.clamp(Q.extensionLength,-E.EXTENSION_LENGTH_OFFSET,255-E.EXTENSION_LENGTH_OFFSET)+E.EXTENSION_LENGTH_OFFSET,U="solid"===Q.type?0:1,V=255*Q.opacity;Q=Q.color;O.textureBuffer.setData(F,
0,255*Q[0],255*Q[1],255*Q[2],255*Q[3]);O.textureBuffer.setData(F,1,N,P,U,V)}};S.createComponentBuffers=function(M){if(l.isNone(this.componentColorManager))return null;const T=[],O=this.componentColorManager.getBuffer(M.length);for(let Q=0;Q<M.length;Q++){const F=M[Q],N=O.acquireIndex();T.push({index:N,material:F})}M={meta:T,buffer:O};this.updateComponentBuffer(M);return M};S.extractEdges=function(M,T,O,Q,F){return this.worker.process({data:T,originalIndices:F,writerSettings:M,skipDeduplicate:O},this.workerAbort.signal,
Q)};S.createEdgeResources=function(M){const T={};if(l.isNone(this.verticesBufferObject))return T;if(0<M.regular.lodInfo.lengths.length){var O=new m(this.rctx,t.EdgeShaderAttributeLocations,{vertices:t.glVertexLayout,instances:D.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:q.createVertex(this.rctx,35044,M.regular.instancesData.buffer)});T.regular={vao:O,lod:M.regular.lodInfo}}0<M.silhouette.lodInfo.lengths.length&&(O=new m(this.rctx,t.EdgeShaderAttributeLocations,
{vertices:t.glVertexLayout,instances:D.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:q.createVertex(this.rctx,35044,M.silhouette.instancesData.buffer)}),T.silhouette={vao:O,lod:M.silhouette.lodInfo});return T};S.addGeometryData=async function(M,T,O,Q,F,N,P){const U=O.getAttribute("position");M=this.computeModelTransformWithLocalOrigin(M,Q,n.create());Q=Q.origin;O={position:U,indices:O.getIndices("position"),modelTransform:M,origin:Q};return this.addPositionData(T,
O,F,N,P)};S.addPositionData=async function(M,T,O,Q,F=!1){var N=this.createComponentBuffers([O]);if(!l.isNone(N)){O=this.acquireRenderer(O.type,!!Q.slicePlaneEnabled);var {modelTransform:P,origin:U,indices:V}=T;T=T.position;Q=T.data.length/T.strideIdx;var W=t.EdgeInputBufferLayout.createBuffer(Q);for(let R=0;R<Q;R++)W.position.set(R,0,T.data[T.offsetIdx+R*T.strideIdx+0]),W.position.set(R,1,T.data[T.offsetIdx+R*T.strideIdx+1]),W.position.set(R,2,T.data[T.offsetIdx+R*T.strideIdx+2]);I.fillComponenBufferIndices(N.meta,
[0,W.componentIndex.count],W.componentIndex);T=await this.extractEdges(O.writerSettings,W,!1,F,V);var {regular:X,silhouette:ca}=this.createEdgeResources(T);F=(X?X.vao.size:0)+(ca?ca.vao.size:0);N={regular:X,silhouette:ca,transform:{modelMatrix:P,origin:U},statistics:{gpuMemoryUsage:F,averageEdgeLength:T.averageEdgeLength},components:N,visible:!0,edgeTransparency:I.determineEdgeTransparency(N.meta),objectTransparency:I.determineObjectTransparency(N.meta),distanceToCamera:0,rendererKey:O.key};M.renderables.push(N);
O.addRenderable(N);this.gpuMemoryUsage+=F}};S.addComponentGeometry=async function(M,T,O,Q,F,N,P){const U=this.createComponentBuffers(N);if(!l.isNone(U)){N=I.determineRendererType(N);P=this.acquireRenderer(N,P.slicePlaneEnabled||!1,!1);N=t.EdgeInputBufferLayout.createBuffer(O.count);B.copy(N.position,O);I.fillComponenBufferIndices(U.meta,F,N.componentIndex,Q);Q=await this.extractEdges(P.writerSettings,N,!0,!1,Q);var {regular:V,silhouette:W}=this.createEdgeResources(Q);O=(V?V.vao.size:0)+(W?W.vao.size:
0);M={regular:V,silhouette:W,transform:M,statistics:{gpuMemoryUsage:O,averageEdgeLength:Q.averageEdgeLength},components:U,visible:!0,edgeTransparency:I.determineEdgeTransparency(U.meta),objectTransparency:I.determineObjectTransparency(U.meta),distanceToCamera:0,rendererKey:P.key};T.renderables.push(M);P.addRenderable(M);this.gpuMemoryUsage+=O}};S.addObjectMergedGeometries=async function(M,T,O,Q,F){var N=new Map,P=0,U=null,V=null;for(var W=0;W<M.geometries.length;W++){var X=M.geometries[W],ca=M.geometryRecords[W];
ca.material.supportsEdges&&(!V&&ca.origin&&(V=ca),X=X.data.getIndices("position"),P+=X?X.length:0,X&&null==U||U===Uint16Array)&&(U=r.isUint16Array(X)?Uint16Array:Uint32Array)}P=P?new U(P):null;U=[];W=0;for(X=0;X<M.geometries.length;X++){var R=M.geometries[X];if(!M.geometryRecords[X].material.supportsEdges)continue;ca=R.data.getAttribute("position");R=R.data.getIndices("position");let aa=N.get(ca.data);if(null==aa){aa=U.length/3;for(let ka=ca.offsetIdx;ka<ca.data.length;ka+=ca.strideIdx)U.push(ca.data[ka+
0]),U.push(ca.data[ka+1]),U.push(ca.data[ka+2]);N.set(ca.data,aa)}if(R)for(ca=0;ca<R.length;ca++)P[W++]=aa+R[ca]}V=V||M.geometryRecords[0];N=this.computeModelTransformWithLocalOrigin(M,V,n.create());V=V.origin;for(W=0;W<M.geometryRecords.length;W++)M.geometryRecords[W].origin=V;await this.addPositionData(T,{position:{data:U,offsetIdx:0,strideIdx:3},indices:P,modelTransform:N,origin:V},O[0],Q,F)};S.acquireRenderer=function(M,T,O=!0){const Q=E.EdgeRenderer.getKey(M,T,O);let F=this.renderers.get(Q);
l.isNone(this.strokesTexture)&&(this.strokesTexture=H.generateStrokesTexture(this.rctx));F||(F=new E.EdgeRenderer(this.rctx,this.techniqueRepository,{type:M,slicePlaneEnabled:T,strokesTexture:this.strokesTexture,legacy:O}),this.renderers.set(Q,F));F.refCount.increment();return F};S.removeRenderable=function(M){const T=this.renderers.get(M.rendererKey);if(T){T.removeRenderable(M);T.refCount.decrement();M.regular&&(M.regular.vao.vertexBuffers.instances.dispose(),M.regular.vao.dispose(!1),M.regular.vao=
null);M.silhouette&&(M.silhouette.vao.vertexBuffers.instances.dispose(),M.silhouette.vao.dispose(!1),M.silhouette.vao=null);"origin"in M.transform&&this.localOrigins.release(M.transform.origin);this.gpuMemoryUsage-=M.statistics.gpuMemoryUsage;for(const O of M.components.meta)M.components.buffer.releaseIndex(O.index)}};S.updateObjectCameraDistances=function(M){M=M.camera.viewInverseTransposeMatrix;f.set(this.tmpCameraPosition,M[3],M[7],M[11]);this.perObjectData.forEach((T,O)=>{O=l.isSome(T.center)?
T.center:O.getCenter();const Q=f.distance(O,this.tmpCameraPosition);T.renderables.forEach(F=>F.distanceToCamera=Q)})};S.renderRegularEdges=function(M,T,O){M.bindRegularEdges(T,O);M.forEachRenderable(Q=>{if(Q.visible&&Q.regular){var F=I.computeEdgeCount(Q.regular.lod.lengths,Q.distanceToCamera,O);"origin"in Q.transform&&(T.localViewMatrixForEdges=this.localOrigins.getViewMatrix(Q.transform.origin));M.renderRegularEdges(Q,T,F);this.numberOfRenderedEdges+=F}},O.transparency)};S.renderSilhouetteEdges=
function(M,T,O){M.bindSilhouetteEdges(T,O);M.forEachRenderable(Q=>{if(Q.visible&&Q.silhouette){var F=I.computeEdgeCount(Q.silhouette.lod.lengths,Q.distanceToCamera,O);"origin"in Q.transform&&(T.localViewMatrixForEdges=this.localOrigins.getViewMatrix(Q.transform.origin));M.renderSilhouetteEdges(Q,T,F);this.numberOfRenderedEdges+=F}},O.transparency)};k._createClass(L,[{key:"numberOfRenderedPrimitives",get:function(){return this.numberOfRenderedEdges}}]);return L}();let K=function(){function L(S,M=null){this.center=
M;this.renderables=[];this.loaded=S;this.loaded.then(()=>this.loaded=!0)}L.prototype.waitLoaded=function(S){!0===this.loaded?S():this.loaded.then(()=>S())};return L}();b.EdgeView=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(b){b.applyToModelMatrix=function(k,a){const r=-k[0],l=-k[1];k=-k[2];const h=a[3],d=a[7],c=a[11],e=a[15];a[0]+=h*r;a[1]+=h*l;a[2]+=h*k;a[4]+=d*r;a[5]+=d*l;a[6]+=d*k;a[8]+=c*r;a[9]+=
c*l;a[10]+=c*k;a[12]+=e*r;a[13]+=e*l;a[14]+=e*k};b.applyToViewMatrix=function(k,a){const r=k[0],l=k[1];k=k[2];a[12]+=r*a[0]+l*a[4]+k*a[8];a[13]+=r*a[1]+l*a[5]+k*a[9];a[14]+=r*a[2]+l*a[6]+k*a[10];a[14]+=r*a[3]+l*a[7]+k*a[11]};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],function(b,k,a,r){let l=function(){function h(c){this.factory=c;this.originData=
new Map}var d=h.prototype;d.acquire=function(c){return this.register(this.factory.getOrigin(c))};d.register=function(c){const e=this.originData.get(c.id);if(e)return e.refCount++,e.origin;this.originData.set(c.id,{refCount:1,viewMatrix:a.create(),origin:c});return c};d.release=function(c){const e=this.originData.get(c.id);e&&(e.refCount--,0===e.refCount&&this.originData.delete(c.id))};d.updateViewMatrices=function(c){this.originData.forEach(e=>{k.copy(e.viewMatrix,c);r.applyToViewMatrix(e.origin.vec3,
e.viewMatrix)})};d.getViewMatrix=function(c){return this.originData.get(c.id).viewMatrix};return h}();b.LocalOriginManager=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(b,k,a){const r=a.newLayout().vec3f("position").u16("componentIndex").u16("_padding"),l=a.newLayout().vec2u8("sideness");k=k.glLayout(l);a=a.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").u8("variantOffset",
{glNormalized:!0}).u8("variantStroke").u8("variantExtension",{glNormalized:!0}).u8("_padding",{glPadding:!0}).u16("_padding2",{glPadding:!0});const h=a.clone().vec3f("normal"),d=a.clone().vec3f("normalA").vec3f("normalB");b.CommonInstancesLayout=a;b.EdgeInputBufferLayout=r;b.EdgeShaderAttributeLocations={position0:0,position1:1,componentIndex:2,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9};b.RegularEdgeInstancesLayout=h;b.SilhouetteEdgeInstancesLayout=
d;b.VertexLayout=l;b.glVertexLayout=k;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),function(b,k,a,r,l,h){let d=function(){function w(){}var q=w.prototype;q.updateSettings=function(m){this.settings=m};q.write=function(m,u,v){var y=c;y[0]=v.position0[0];y[1]=
v.position0[1];y[2]=v.position0[2];y[3]=v.position1[0];y[4]=v.position1[1];y[5]=v.position1[2];f[0]=5381;for(y=0;y<e.length;y++)f[0]=31*f[0]+e[y];y=f[0];g.seed=y;y=g.getIntRange(0,255);const B=g.getIntRange(0,this.settings.variants-1);var x=g.getFloat();x=-(1-Math.min(x/.7,1))+Math.max(0,x-.7)/(1-.7);x=255*(Math.pow(Math.abs(x),1.2)*(0>x?-1:1)*.5+.5);m.position0.setVec(u,v.position0);m.position1.setVec(u,v.position1);m.componentIndex.set(u,v.componentIndex);m.variantOffset.set(u,y);m.variantStroke.set(u,
B);m.variantExtension.set(u,x)};q.trim=function(m,u){return m.slice(0,u)};return w}();const c=new Float32Array(6),e=new Uint32Array(c.buffer),f=new Uint32Array(1),g=new k;k=function(){function w(){this.commonWriter=new d}var q=w.prototype;q.updateSettings=function(m){this.commonWriter.updateSettings(m)};q.allocate=function(m){return h.RegularEdgeInstancesLayout.createBuffer(m)};q.write=function(m,u,v){this.commonWriter.write(m,u,v);r.add(n,v.faceNormal0,v.faceNormal1);r.normalize(n,n);m.normal.setVec(u,
n)};q.trim=function(m,u){return this.commonWriter.trim(m,u)};return w}();k.Layout=h.RegularEdgeInstancesLayout;k.glLayout=l.glLayout(h.RegularEdgeInstancesLayout,{divisor:1});let p=function(){function w(){this.commonWriter=new d}var q=w.prototype;q.updateSettings=function(m){this.commonWriter.updateSettings(m)};q.allocate=function(m){return h.SilhouetteEdgeInstancesLayout.createBuffer(m)};q.write=function(m,u,v){this.commonWriter.write(m,u,v);m.normalA.setVec(u,v.faceNormal0);m.normalB.setVec(u,v.faceNormal1)};
q.trim=function(m,u){return this.commonWriter.trim(m,u)};return w}();p.Layout=h.SilhouetteEdgeInstancesLayout;p.glLayout=l.glLayout(h.SilhouetteEdgeInstancesLayout,{divisor:1});const n=a.create();b.CommonBufferWriter=d;b.RegularEdgeBufferWriter=k;b.SilhouetteEdgeBufferWriter=p;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../core/shaderLibrary/Slice.glsl ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../collections/Component/Material/ComponentTechnique ../../core/util/TwoVectorPosition ./EdgeShaderTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){const m={type:"uber",slicePlaneEnabled:!1,sliceHighlightDisabled:!1,strokesTexture:null,legacy:!0};let u=function(){function z(){this._value=0}var A=z.prototype;A.increment=function(){this._value++};A.decrement=function(){this._value--};k._createClass(z,[{key:"value",get:function(){return this._value}}]);return z}();const v={solid:0,sketch:1,uber:2};let y=function(){function z(t,D,E){this.rctx=t;this.shaderTechniqueRepository=D;this.config=new q.EdgeShaderTechnique.Configuration;
this.technique=null;this.refCount=new u;this.renderables=new Set;this.sortedRenderables={[1]:{[1]:new r,[2]:new r},[2]:{[1]:new r,[2]:new r}};this.renderablesDirty=!1;this.settings={...m,...E};this.key=z.getKey(this.settings.type,this.settings.slicePlaneEnabled,this.settings.legacy);this.writerSettings={variants:this.settings.strokesTexture.variants};this.config.legacy=this.settings.legacy;this.config.mode=v[this.settings.type];this.config.silhouette=!1;this.config.antialiasing=!!this.rctx.capabilities.blendMinMax;
this.config.slicePlaneEnabled=this.settings.slicePlaneEnabled;this.config.doublePrecisionRequiresObfuscation=g.doublePrecisionRequiresObfuscation(t)}var A=z.prototype;A.dispose=function(){this.technique&&(this.shaderTechniqueRepository.release(this.technique),this.technique=null)};A.addRenderable=function(t){this.renderables.add(t);this.renderablesDirty=!0};A.removeRenderable=function(t){this.renderables.delete(t);this.renderablesDirty=!0};A.setRenderablesDirty=function(){this.renderablesDirty=!0};
A.forEachRenderable=function(t,D){this.renderablesDirty&&this.sortRenderables();this.sortedRenderables[D][1].forAll(t);this.sortedRenderables[D][2].forAll(t)};A.bindRegularEdges=function(t,D){this.config.silhouette=!1;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(q.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass(this.rctx,{bindParameters:t,edgeRenderParameters:D});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};
A.bindSilhouetteEdges=function(t,D){this.config.silhouette=!0;this.technique=this.shaderTechniqueRepository.acquireAndReleaseExisting(q.EdgeShaderTechnique,this.config,this.technique);this.technique.bindPass(this.rctx,{bindParameters:t,edgeRenderParameters:D});this.rctx.setPipelineState(this.technique.pipeline);this.rctx.bindProgram(this.technique.program)};A.renderRegularEdges=function(t,D,E){this.render(this.technique.program,t,t.regular.vao,D,E)};A.renderSilhouetteEdges=function(t,D,E){this.render(this.technique.program,
t,t.silhouette.vao,D,E)};A.render=function(t,D,E,G,H){this.setUniforms(t,D,G);this.rctx.bindVAO(E);this.rctx.capabilities.instancing.drawArraysInstanced(6,0,4,H)};A.setUniforms=function(t,D,E){D.components.buffer.textureBuffer.bind(t,B);if("origin"in D.transform)t.setUniformMatrix4fv("uView",E.localViewMatrixForEdges),t.setUniformMatrix4fv("uModel",D.transform.modelMatrix),f.Slice.bindUniforms(t,this.settings,E.slicePlane,D.transform.origin.vec3);else{const G=new w.TwoVectorPosition(D.transform.position),
H=c.transpose(x,c.invert(x,D.transform.rotationScale)),I=new n.ComponentDrawParameters;d.copy(I.worldFromModel_TL,G.low);d.copy(I.worldFromModel_TH,G.high);c.copy(I.worldFromModel_RS,D.transform.rotationScale);c.copy(I.transformNormal_GlobalFromModel,H);p.VertexPosition.bindModelTransform(t,I);t.setUniformMatrix3fv("uTransformNormal_GlobalFromModel",I.transformNormal_GlobalFromModel);D=E.camera.viewInverseTransposeMatrix;D=d.set(C,D[3],D[7],D[11]);f.Slice.bindUniforms(t,this.settings,E.slicePlane,
D)}"uber"!==this.settings.type&&"sketch"!==this.settings.type||this.setSketchUniforms(t);t.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(E.camera.fovY/2)/(E.camera.fullViewport[3]/2))};A.setSketchUniforms=function(t){const D=this.settings.strokesTexture,E=D.texture;a.isNone(E)||(this.rctx.bindTexture(E,0),t.setUniform1i("uStrokesTexture",0),t.setUniform2f("uStrokesTextureScale",1/E.descriptor.width,1/E.descriptor.height),t.setUniform1f("uStrokesLog2Resolution",l.log2(D.resolution)),t.setUniform1f("uStrokesNormalizationScale",
D.normalizationScale),t.setUniform1f("uStrokesAmplitude",D.amplitude),t.setUniform1f("uStrokeVariants",D.variants))};A.sortRenderables=function(){this.renderablesDirty=!1;this.sortedRenderables[1][1].clear();this.sortedRenderables[1][2].clear();this.sortedRenderables[2][1].clear();this.sortedRenderables[2][2].clear();this.renderables.forEach(D=>{0!==D.objectTransparency&&0!==D.edgeTransparency&&this.sortedRenderables[D.objectTransparency][D.edgeTransparency].push(D)});const t=(D,E)=>"origin"in D.transform&&
"origin"in E.transform?D.transform.origin.id<E.transform.origin.id?-1:D.transform.origin.id>E.transform.origin.id?1:0:0;this.sortedRenderables[1][1].sort(t);this.sortedRenderables[1][2].sort(t);this.sortedRenderables[2][1].sort(t);this.sortedRenderables[2][2].sort(t)};z.getKey=function(t,D,E){return`edges-t:${t}:${D}:${E}`};return z}();const B={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2},x=e.create(),C=h.create();b.EXTENSION_LENGTH_OFFSET=128;b.EdgeRenderer=y;b.LINE_WIDTH_FRACTION_FACTOR=
8;b.componentDataBindParameters=B;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../../webgl/Program ../../../../webgl/renderState ../../../../webgl/BufferObject ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../../../../webgl/Renderbuffer ../../../../webgl/FramebufferObject ../../../../webgl/ProgramCache ../../../../webgl/RenderingContext ../../../../webgl/ShaderCompiler ../../core/shaderLibrary/attributes/VertexPosition.glsl ../../../../../chunks/EdgeShaderProgram.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){k.EdgeShaderTechnique=function(B){function x(){return B.apply(this,arguments)||this}a._inheritsLoose(x,B);var C=x.prototype;C.bindPass=function(z,A){z=this.program;const {edgeRenderParameters:t,bindParameters:D}=A;v.VertexPosition.bindViewProjTransform(z,t.viewProjectionTransform);z.setUniformMatrix3fv("uTransformNormal_ViewFromGlobal",t.transformNormal_ViewFromGlobal);z.setUniformMatrix4fv("uProj",D.camera.projectionMatrix);z.setUniform2f("uDepthBias",
.5,-4E-4);z.setUniform2f("uPixelToNDC",2/D.camera.fullViewport[2],2/D.camera.fullViewport[3]);z.setUniform2f("uNDCToPixel",D.camera.fullViewport[2]/2,D.camera.fullViewport[3]/2);z.setUniform1f("uDistanceFalloffFactor",t.distanceFalloffFactor);z.setUniform2f("uViewportDimInv",1/D.camera.fullViewport[2],1/D.camera.fullViewport[3]);z.setUniform1f("uPixelRatio",D.camera.pixelRatio||1)};C.initializeProgram=function(z){const A=x.shader.get();var t=this.configuration;t=A.build({slicePlaneEnabled:t.slicePlaneEnabled,
sliceHighlightDisabled:t.sliceHighlightDisabled,sliceEnabledForVertexPrograms:!1,silhouette:t.silhouette,legacy:t.legacy,antialiasing:t.antialiasing,mode:t.mode,doublePrecisionRequiresObfuscation:t.doublePrecisionRequiresObfuscation});return new c(z.rctx,t.generateSource("vertex"),t.generateSource("fragment"),A.attributeLocations)};C.initializePipeline=function(z){return(z=z.rctx.capabilities.blendMinMax)?e.makePipelineState({blending:e.separateBlendingParams(1,1,0,1,32774,z.MAX),depthTest:{func:515},
colorWrite:e.defaultColorWriteParams}):e.makePipelineState({depthTest:{func:515},depthWrite:e.defaultDepthWriteParams,colorWrite:e.defaultColorWriteParams})};return x}(h.ShaderTechnique);k.EdgeShaderTechnique.shader=new l.ReloadableShaderModule(y.EdgeShaderProgram,()=>new Promise(function(B,x){b(["../../shaders/sources/edgeRenderer/EdgeShaderProgram.glsl"],B,x)}));(function(B){let x=function(C){function z(){var A=C.apply(this,arguments)||this;A.slicePlaneEnabled=!1;A.sliceHighlightDisabled=!1;A.silhouette=
!1;A.legacy=!1;A.antialiasing=!1;A.mode=0;A.doublePrecisionRequiresObfuscation=!1;return A}a._inheritsLoose(z,C);return z}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter()],x.prototype,"slicePlaneEnabled",void 0);r.__decorate([d.parameter()],x.prototype,"sliceHighlightDisabled",void 0);r.__decorate([d.parameter()],x.prototype,"silhouette",void 0);r.__decorate([d.parameter()],x.prototype,"legacy",void 0);r.__decorate([d.parameter()],x.prototype,"antialiasing",void 0);r.__decorate([d.parameter({count:3})],
x.prototype,"mode",void 0);r.__decorate([d.parameter()],x.prototype,"doublePrecisionRequiresObfuscation",void 0);B.Configuration=x})(k.EdgeShaderTechnique||(k.EdgeShaderTechnique={}));Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/EdgeShaderProgram.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p){function n(m){const u=new a.ShaderBuilder,v=u.vertex,y=u.fragment;m.legacy&&v.uniforms.add("uModel","mat4");m.antialiasing&&(v.code.add(k.glsl`
      #define ANTIALIASING 1
    `),y.code.add(k.glsl`
      #define ANTIALIASING 1
    `));u.include(l.AdjustProjectedPosition,m);u.include(g.LineAmplitude,m);u.include(e.EdgeUtil,m);u.include(f.UnpackAttributes,m);u.include(p.LineOffset,m);u.include(r.Slice,m);u.include(d.DiscardNonSilhouetteEdges,m);u.include(h.DiscardByCoverage,m);u.include(c.DiscardShortEdges,m);u.varyings.add("vColor","vec4");u.varyings.add("vRadius","float");u.varyings.add("vPosition","vec3");u.varyings.add("vWorldPosition","vec3");u.varyings.add("vLineLengthPixels","float");u.varyings.add("vSizeFalloffFactor",
"float");v.uniforms.add("uPixelToNDC","vec2");v.uniforms.add("uNDCToPixel","vec2");v.uniforms.add("uPixelRatio","float");u.attributes.add("position0","vec3");u.attributes.add("position1","vec3");u.attributes.add("variantOffset","float");u.attributes.add("variantStroke","float");u.attributes.add("variantExtension","float");v.code.add(k.glsl`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * uNDCToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * uPixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

    #ifdef ANTIALIASING
      const float aaPaddingPixels = 1.0;

      // Line size with padding
      float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
      float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
    #else /* ANTIALIASING */

      // Even if there is no AA, we still want to do proper <1px rendering,
      // so we effectively clamp the pixel sizes to minimum of 1px and compute
      // coverage in the fragment shader
      float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
      float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
    #endif /* ANTIALIASING */

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * uPixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * uPixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard edges below a certain length threshold
      discardShortEdges(unpackedAttributes, lineLengthPixels);

      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0 = worldFromModelPosition(position0);
      vec3 worldPosV1 = worldFromModelPosition(position1);
      vec3 viewPosV0 = viewFromModelPosition(position0);
      vec3 viewPosV1 = viewFromModelPosition(position1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `);u.fragment.code.add(k.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `);return u}const w={position0:0,position1:1,componentIndex:2,packedAttributes:3,variantOffset:4,variantStroke:5,variantExtension:6,normal:7,normalA:7,normalB:8,sideness:9};var q=Object.freeze({__proto__:null,attributeLocations:w,build:n});b.EdgeShaderProgram=q;b.attributeLocations=w;b.build=n})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","../../../core/shaderLibrary/attributes/VertexPosition.glsl",
"../../../core/shaderLibrary/util/IsNaN.glsl"],function(b,k,a,r){b.AdjustProjectedPosition=function(l,h){l.vertex.include(r.IsNaN);l.include(a.VertexPosition,h);l=l.vertex;l.uniforms.add("uDepthBias","vec2");l.uniforms.add("uViewportDimInv","vec2");h.legacy?(l.uniforms.add("uView","mat4"),l.uniforms.add("uProj","mat4")):l.uniforms.add("uTransformNormal_ViewFromGlobal","mat3");h.legacy?l.code.add(k.glsl`
      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
        float offsetXY = uDepthBias.x;
        float offsetZ  = uDepthBias.y;

        // screen space pixel offset
        // we multiply by two to account for the fact that NDC go from -1 to 1
        // we multiply by projPos.w to compensate for the perspective division that happens later
        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing
        // towards the camera
        vec4 projNormal = uProj * uView * vec4(globalNormal, 0.0);

        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
      }
    `):l.code.add(k.glsl`
      vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
        float offsetXY = uDepthBias.x;
        float offsetZ  = uDepthBias.y;

        // screen space pixel offset
        // we multiply by two to account for the fact that NDC go from -1 to 1
        // we multiply by projPos.w to compensate for the perspective division that happens later
        // normalizing over xyz means that the xy influence is reduced the more the normal is pointing
        // towards the camera
        vec4 projNormal = uTransform_ProjFromView * vec4(uTransformNormal_ViewFromGlobal * globalNormal, 0.0);

        return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;
      }
    `);l.code.add(k.glsl`
    // A z-offset, using a depth based heuristic.
    float _calculateProjectedBiasZ(vec4 projPos) {
      float offsetZ = uDepthBias.y;
      return sqrt(projPos.z) * offsetZ;
    }

    vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
      vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);

      // we currently have to do this check because some geometries come with 0 length edge normals.
      // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890
      if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
        projPos.xy += offsetXY;
      }

      projPos.z += _calculateProjectedBiasZ(projPos);

      return projPos;
    }
  `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(b,k){b.IsNaN=function(a){const r=k.glsl`
    bool isNaN( float val )
    {
      return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
      // important: some nVidias failed to cope with version below.
      // Probably wrong optimization.
      /*return ( val <= 0.0 || 0.0 <= val ) ? false : true;*/
    }
  `;a.code.add(r)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(b,k){b.DiscardByCoverage=function(a,r){a=a.fragment;a.defines.addFloat("COVERAGE_TEST_THRESHOLD",.01);r.antialiasing?a.code.add(k.glsl`
      #define discardByCoverage(radius, coverage) { if (coverage < COVERAGE_TEST_THRESHOLD) discard; }
    `):a.code.add(k.glsl`
      #define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75; if (coverage < coverageLimit) discard; }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(b,k){b.DiscardNonSilhouetteEdges=function(a,r){a=a.vertex;r.silhouette?(a.code.add(k.glsl`
      bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
        float faceAVisible = dot(viewDir, normalA);
        float faceBVisible = dot(viewDir, normalB);
        return faceAVisible * faceBVisible < 0.0;
      }
    `),r.legacy?a.code.add(k.glsl`
        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
          vec3 viewNormalA = _modelToViewNormal(normalA);
          vec3 viewNormalB = _modelToViewNormal(normalB);
          vec3 viewDir = -viewPos;

          if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
            return false;
          }

          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return true;
        }
      `):a.code.add(k.glsl`
        bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
          vec3 worldNormalA = _modelToWorldNormal(normalA);
          vec3 worldNormalB = _modelToWorldNormal(normalB);
          vec3 viewDir = -worldPos;

          if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
            return false;
          }

          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return true;
        }
      `)):a.code.add(k.glsl`
      bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
        return false;
      }
    `)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(b,k){b.DiscardShortEdges=function(a,r){a=a.vertex;switch(r.mode){case 1:a.code.add(k.glsl`
        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}
      `);break;case 2:a.code.add(k.glsl`
        #define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}
      `);break;case 0:a.code.add(k.glsl`
        #define discardShortEdges(unpackedAttributes, lineLengthPixels) {}
      `)}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","../../../core/shaderLibrary/util/DoublePrecision.glsl"],function(b,k,a){function r(l,h){const d=l.vertex;d.uniforms.add("uDistanceFalloffFactor","float");d.code.add(k.glsl`
    float distanceBasedPerspectiveFactor(float distance) {
      return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);
    }
  `);d.uniforms.add("uComponentDataTex","sampler2D");d.uniforms.add("uComponentDataTexInvDim","vec2");l.attributes.add("componentIndex","float");d.defines.addFloat("COMPONENT_COLOR_FIELD_OFFSET",0);d.defines.addFloat("COMPONENT_OTHER_FIELDS_OFFSET",1);d.defines.addFloat("COMPONENT_FIELD_COUNT",2);d.defines.addFloat("LINE_WIDTH_FRACTION_FACTOR",8);d.defines.addFloat("EXTENSION_LENGTH_OFFSET",128);d.defines.addFloat("COMPONENT_TEX_WIDTH",4096);d.code.add(k.glsl`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;

      float rowIndex = floor(fieldIndex / COMPONENT_TEX_WIDTH);
      float colIndex = mod(fieldIndex, COMPONENT_TEX_WIDTH);

      vec2 linearIndex = vec2(
        (colIndex + 0.5) / COMPONENT_TEX_WIDTH,
        (rowIndex + 0.5) * uComponentDataTexInvDim.y
      );

      return linearIndex;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, COMPONENT_COLOR_FIELD_OFFSET);
      vec2 otherIndex = _componentTextureCoords(componentIndex, COMPONENT_OTHER_FIELDS_OFFSET);

      vec4 colorValue = texture2D(uComponentDataTex, colorIndex);
      vec4 otherValue = texture2D(uComponentDataTex, otherIndex);

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),
        otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,
        -(otherValue.z * 255.0) + 0.5 // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
      );
    }
  `);h.legacy?d.code.add(k.glsl`
      vec3 _modelToWorldNormal(vec3 normal) {
        return (uModel * vec4(normal, 0.0)).xyz;
      }

      vec3 _modelToViewNormal(vec3 normal) {
        return (uView * uModel * vec4(normal, 0.0)).xyz;
      }
    `):(d.uniforms.add("uTransformNormal_GlobalFromModel ","mat3"),d.code.add(k.glsl`
      vec3 _modelToWorldNormal(vec3 normal) {
        return uTransformNormal_GlobalFromModel * normal;
      }
    `));h.silhouette?(l.attributes.add("normalA","vec3"),l.attributes.add("normalB","vec3"),d.code.add(k.glsl`
      vec3 worldNormal() {
        return _modelToWorldNormal(normalize(normalA + normalB));
      }
    `)):(l.attributes.add("normal","vec3"),d.code.add(k.glsl`
      vec3 worldNormal() {
        return _modelToWorldNormal(normal);
      }
    `));h.legacy?d.code.add(k.glsl`
      vec3 worldFromModelPosition(vec3 position) {
        return (uModel * vec4(position, 1.0)).xyz;
      }

      vec3 viewFromModelPosition(vec3 position) {
        return (uView * vec4(worldFromModelPosition(position), 1.0)).xyz;
      }

      vec4 projFromViewPosition(vec3 position) {
        return uProj * vec4(position, 1.0);
      }
    `):(l.vertex.include(a.DoublePrecision,h),d.code.add(k.glsl`
      vec3 worldFromModelPosition(vec3 position) {
        vec3 rotatedModelPosition = uTransform_WorldFromModel_RS * position;

        vec3 transform_CameraRelativeFromModel = dpAdd(
          uTransform_WorldFromModel_TL,
          uTransform_WorldFromModel_TH,
          -uTransform_WorldFromView_TL,
          -uTransform_WorldFromView_TH
        );

        return transform_CameraRelativeFromModel + rotatedModelPosition;
      }

      vec3 viewFromModelPosition(vec3 position) {
        return uTransform_ViewFromCameraRelative_RS * worldFromModelPosition(position);
      }

      vec4 projFromViewPosition(vec3 position) {
        return uTransform_ProjFromView * vec4(position, 1.0);
      }
    `));d.code.add(k.glsl`
    float calculateExtensionLength(float extensionLength, float lineLength) {
      return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
    }
  `)}(function(l){l.usesSketchLogic=function(h){return 1===h.mode||2===h.mode};l.usesSolidLogic=function(h){return 0===h.mode||2===h.mode}})(r||(r={}));b.EdgeUtil=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],function(b,k,a){b.UnpackAttributes=function(r,l){const h=r.vertex;r.include(a.EdgeUtil,l);r.attributes.add("sideness",
"vec2");2===l.mode?h.code.add(k.glsl`
      struct UnpackedAttributes {
        vec2 sideness;
        vec2 sidenessNorm;
        float lineWidthPixels;
        float extensionLengthPixels;
        float type;
      };
    `):h.code.add(k.glsl`
      struct UnpackedAttributes {
        vec2 sideness;
        vec2 sidenessNorm;
        float lineWidthPixels;
        float extensionLengthPixels;
      };
  `);switch(l.mode){case 2:h.code.add(k.glsl`
        UnpackedAttributes unpackAttributes(ComponentData component) {
          vec2 sidenessNorm = sideness;
          vec2 sideness = sidenessNorm * 2.0 - 1.0;
          float fType = component.type;
          float extensionLengthPixels = component.extensionLength;
          float lineWidth = component.lineWidth;

          if (fType <= 0.0) {
            extensionLengthPixels *= variantExtension * 2.0 - 1.0;
          }

          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
        }
      `);break;case 1:h.code.add(k.glsl`
        UnpackedAttributes unpackAttributes(ComponentData component) {
          vec2 sidenessNorm = sideness;
          vec2 sideness = sidenessNorm * 2.0 - 1.0;
          float extensionLengthPixels = component.extensionLength;
          extensionLengthPixels *= variantExtension * 2.0 - 1.0;
          float lineWidth = component.lineWidth;

          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
        }
      `);break;case 0:h.code.add(k.glsl`
        UnpackedAttributes unpackAttributes(ComponentData component) {
          vec2 sidenessNorm = sideness;
          vec2 sideness = sidenessNorm * 2.0 - 1.0;
          float extensionLengthPixels = component.extensionLength;
          float lineWidth = component.lineWidth;

          return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
        }
      `)}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(b,k,a,r){b.LineAmplitude=function(l,h){const d=l.vertex;l.include(r.UnpackAttributes,h);a.EdgeUtil.usesSketchLogic(h)&&d.uniforms.add("uStrokesAmplitude","float");switch(h.mode){case 0:d.code.add(k.glsl`
        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
          return 0.0;
        }
      `);break;case 1:d.code.add(k.glsl`
        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
          return uStrokesAmplitude;
        }
      `);break;case 2:d.code.add(k.glsl`
        float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
          float type = unpackedAttributes.type;

          if (type <= 0.0) {
            return uStrokesAmplitude;
          }
          else {
            return 0.0;
          }
        }
      `)}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl","./EdgeUtil.glsl","./UnpackAttributes.glsl"],function(b,k,a,r,l){b.LineOffset=function(h,d){const c=h.vertex;h.include(l.UnpackAttributes,d);const e=h.fragment;r.EdgeUtil.usesSketchLogic(d)&&(c.uniforms.add("uStrokesTextureScale","vec2"),
c.uniforms.add("uStrokesLog2Resolution","float"),c.uniforms.add("uStrokeVariants","float"),h.varyings.add("vStrokeUV","vec2"),e.uniforms.add("uStrokesTexture","sampler2D"),e.uniforms.add("uStrokesNormalizationScale","float"),c.code.add(k.glsl`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);

        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + variantStroke + 0.5) * uStrokesTextureScale;
        vStrokeUV.x += variantOffset;
      }
    `),h.fragment.include(a.RgbaFloatEncoding),e.code.add(k.glsl`
      float calculateLineOffsetSketch() {
        float offsetNorm = rgba2float(texture2D(uStrokesTexture, vStrokeUV));
        return (offsetNorm - 0.5) * uStrokesNormalizationScale;
      }

      float calculateLinePressureSketch() {
        return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0.0, 0.5)));
      }
    `));switch(d.mode){case 0:c.code.add(k.glsl`
        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}
      `);e.code.add(k.glsl`
        float calculateLineOffset() {
          return 0.0;
        }

        float calculateLinePressure() {
          return 1.0;
        }
      `);break;case 1:c.code.add(k.glsl`
        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
        {
          calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
        }
      `);e.code.add(k.glsl`
        float calculateLineOffset() {
          return calculateLineOffsetSketch();
        }

        float calculateLinePressure() {
          return calculateLinePressureSketch();
        }
      `);break;case 2:h.varyings.add("vType","float"),c.code.add(k.glsl`
        void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
        {
          vType = unpackedAttributes.type;

          if (unpackedAttributes.type <= 0.0) {
            calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
          }
        }
      `),e.code.add(k.glsl`
        float calculateLineOffset() {
          if (vType <= 0.0) {
            return calculateLineOffsetSketch();
          }
          else {
            return 0.0;
          }
        }

        float calculateLinePressure() {
          if (vType <= 0.0) {
            return calculateLinePressureSketch();
          }
          else {
            return 1.0;
          }
        }
      `)}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/typedArrayUtil","../../../support/WorkerHandle","../../../support/buffer/workerHelper","./EdgeProcessingWorker"],function(b,k,a,r,l){return function(h){function d(e){return h.call(this,"EdgeProcessingWorker","wrappedWork",e)||this}b._inheritsLoose(d,h);var c=d.prototype;c.process=async function(e,
f,g){if(g)return l.work(e);e=this._packInput(e);f=await this.invoke(e,f);return this._unpackOutput(f)};c.getTransferList=function(e){return[e.dataBuffer]};c._packInput=function(e){const f={dataBuffer:e.data.buffer,writerSettings:e.writerSettings,skipDeduplicate:e.skipDeduplicate};e.originalIndices&&(f.originalIndicesBuffer=e.originalIndices.buffer,f.originalIndicesType=k.isUint32Array(e.originalIndices)?"Uint32Array":"Uint16Array");return f};c._unpackOutput=function(e){return{regular:{instancesData:r.unpackInterleavedBuffer(e.regular.instancesData),
lodInfo:{lengths:new Float32Array(e.regular.lodInfo.lengths)}},silhouette:{instancesData:r.unpackInterleavedBuffer(e.silhouette.instancesData),lodInfo:{lengths:new Float32Array(e.silhouette.lodInfo.lengths)}},averageEdgeLength:e.averageEdgeLength}};return d}(a.WorkerHandle)})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","./BufferView","./InterleavedLayout"],function(b,k,a){function r(d){const c=[];d.fields.forEach((e,f)=>{var g=e.constructor;c.push([f,{...e,constructor:`${g.ElementType}_${g.ElementCount}`}])});
return{stride:d.stride,fields:c,fieldNames:d.fieldNames}}function l(d){const c=a.newLayout();c.stride=d.stride;c.fieldNames=d.fieldNames;d.fields.forEach(e=>c.fields.set(e[0],{...e[1],constructor:h.get(e[1].constructor)}));return c}k=[k.BufferViewFloat,k.BufferViewVec2f,k.BufferViewVec3f,k.BufferViewVec4f,k.BufferViewMat3f,k.BufferViewMat4f,k.BufferViewFloat64,k.BufferViewVec2f64,k.BufferViewVec3f64,k.BufferViewVec4f64,k.BufferViewMat3f64,k.BufferViewMat4f64,k.BufferViewUint8,k.BufferViewVec2u8,k.BufferViewVec3u8,
k.BufferViewVec4u8,k.BufferViewUint16,k.BufferViewVec2u16,k.BufferViewVec3u16,k.BufferViewVec4u16,k.BufferViewUint32,k.BufferViewVec2u32,k.BufferViewVec3u32,k.BufferViewVec4u32,k.BufferViewInt8,k.BufferViewVec2i8,k.BufferViewVec3i8,k.BufferViewVec4i8,k.BufferViewInt16,k.BufferViewVec2i16,k.BufferViewVec3i16,k.BufferViewVec4i16,k.BufferViewInt32,k.BufferViewVec2i32,k.BufferViewVec3i32,k.BufferViewVec4i32];const h=new Map;k.forEach(d=>h.set(`${d.ElementType}_${d.ElementCount}`,d));b.packInterleavedBuffer=
function(d,c){c.push(d.buffer);return{buffer:d.buffer,layout:r(d.layout)}};b.packLayout=r;b.unpackInterleavedBuffer=function(d){return l(d.layout).createView(d.buffer)};b.unpackLayout=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("exports ../../../../../geometry/support/meshUtils/deduplicate ./bufferLayouts ./edgeBufferWriters ../../../support/buffer/workerHelper ../../../support/meshProcessing ./edgePreprocessing".split(" "),
function(b,k,a,r,l,h,d){function c(g){var p=g.data;var n=g.originalIndices;if(g.skipDeduplicate&&n){const w=h.computeNeighbors(n,p.count);p={faces:n,neighbors:w,vertices:p}}else p=k.deduplicate(p.buffer,p.stride/4,{originalIndices:n}),n=h.computeNeighbors(p.indices,p.uniqueCount),p={faces:p.indices,neighbors:n,vertices:a.EdgeInputBufferLayout.createView(p.buffer)};e.updateSettings(g.writerSettings);f.updateSettings(g.writerSettings);return d.extractEdges(p,e,f)}const e=new r.RegularEdgeBufferWriter,
f=new r.SilhouetteEdgeBufferWriter;b.work=c;b.wrappedWork=async function(g){var p={data:a.EdgeInputBufferLayout.createView(g.dataBuffer),originalIndices:"Uint32Array"===g.originalIndicesType?new Uint32Array(g.originalIndicesBuffer):"Uint16Array"===g.originalIndicesType?new Uint16Array(g.originalIndicesBuffer):void 0,writerSettings:g.writerSettings,skipDeduplicate:g.skipDeduplicate};g=c(p);p=[p.data.buffer];p.push(g.regular.lodInfo.lengths.buffer);p.push(g.silhouette.lodInfo.lengths.buffer);return{result:{regular:{instancesData:l.packInterleavedBuffer(g.regular.instancesData,
p),lodInfo:{lengths:g.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:l.packInterleavedBuffer(g.silhouette.instancesData,p),lodInfo:{lengths:g.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:g.averageEdgeLength},transferList:p}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(b){b.computeNeighbors=function(k,a){var r=k.length/3;const l=new Uint32Array(a+1),h=new Uint32Array(a+1);var d=(m,u)=>{m<u?l[m+
1]++:h[u+1]++};for(var c=0;c<r;c++){var e=k[3*c],f=k[3*c+1],g=k[3*c+2];d(e,f);d(f,g);d(g,e)}c=d=0;for(e=0;e<a;e++)f=l[e+1],g=h[e+1],l[e+1]=d,h[e+1]=c,d+=f,c+=g;const p=new Uint32Array(6*r),n=l[a];d=(m,u,v)=>{m<u?(m=l[m+1]++,p[2*m]=u,p[2*m+1]=v):(u=h[u+1]++,p[2*n+2*u]=m,p[2*n+2*u+1]=v)};for(c=0;c<r;c++)e=k[3*c],f=k[3*c+1],g=k[3*c+2],d(e,f,c),d(f,g,c),d(g,e,c);d=(m,u)=>{const v=2*m;m=u-m;for(u=1;u<m;u++){const y=p[v+2*u],B=p[v+2*u+1];let x=u-1;for(x;0<=x&&p[v+2*x]>y;x--)p[v+2*x+2]=p[v+2*x],p[v+2*x+
3]=p[v+2*x+1];p[v+2*x+2]=y;p[v+2*x+3]=B}};for(c=0;c<a;c++)d(l[c],l[c+1]),d(n+h[c],n+h[c+1]);const w=new Int32Array(3*r),q=(m,u)=>m===k[3*u]?0:m===k[3*u+1]?1:m===k[3*u+2]?2:-1;r=(m,u)=>{m=q(m,u);w[3*u+m]=-1};d=(m,u,v,y)=>{m=q(m,u);w[3*u+m]=y;v=q(v,y);w[3*y+v]=u};for(c=0;c<a;c++){e=l[c];f=l[c+1];g=h[c];const m=h[c+1];for(;e<f&&g<m;){const u=p[2*e],v=p[2*n+2*g];u===v?(d(c,p[2*e+1],v,p[2*n+2*g+1]),e++,g++):u<v?(r(c,p[2*e+1]),e++):(r(v,p[2*n+2*g+1]),g++)}for(;e<f;)r(c,p[2*e+1]),e++;for(;g<m;)r(p[2*n+2*
g],p[2*n+2*g+1]),g++}return w};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("exports ../../../../../core/typedArrayUtil ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../chunks/vec3 ../../../support/mathUtils".split(" "),function(b,k,a,r,l,h,d){function c(w,q){const m=r.acosClamped(w.cosAngle),u=g.fwd,v=g.ortho;d.directionFromTo(u,w.position1,w.position0);
w=0<h.dot(h.cross(v,w.faceNormal0,w.faceNormal1),u)?-1:1;return m*w>q}function e(w){const q=w.faces.length/3,m=w.faces;w=w.neighbors;var u=0;for(var v=0;v<q;v++){var y=w[3*v+1],B=w[3*v+2],x=m[3*v],C=m[3*v+1],z=m[3*v+2];u+=-1===w[3*v]||x<C?1:0;u+=-1===y||C<z?1:0;u+=-1===B||z<x?1:0}u=new Int32Array(4*u);v=0;for(y=0;y<q;y++){B=w[3*y];x=w[3*y+1];C=w[3*y+2];z=m[3*y];const A=m[3*y+1],t=m[3*y+2];if(-1===B||z<A)u[v++]=z,u[v++]=A,u[v++]=y,u[v++]=B;if(-1===x||A<t)u[v++]=A,u[v++]=t,u[v++]=y,u[v++]=x;if(-1===
C||t<z)u[v++]=t,u[v++]=z,u[v++]=y,u[v++]=C}return u}function f(w){const q=w.faces.length/3,m=w.vertices.position;w=w.faces;const u=p.v0,v=p.v1,y=p.v2,B=new Float32Array(3*q);for(let x=0;x<q;x++){const C=w[3*x+1],z=w[3*x+2];m.getVec(w[3*x],u);m.getVec(C,v);m.getVec(z,y);h.subtract(v,v,u);h.subtract(y,y,u);h.cross(u,v,y);h.normalize(u,u);B[3*x]=u[0];B[3*x+1]=u[1];B[3*x+2]=u[2]}return B}const g={edge:{position0:l.create(),position1:l.create(),faceNormal0:l.create(),faceNormal1:l.create(),componentIndex:0,
cosAngle:0},ortho:l.create(),fwd:l.create()},p={v0:l.create(),v1:l.create(),v2:l.create()},n={anglePlanar:4,angleSignificantEdge:35};b.extractEdges=function(w,q,m,u=n){const v=w.vertices.position;var y=w.vertices.componentIndex,B=r.deg2rad(u.anglePlanar);u=r.deg2rad(u.angleSignificantEdge);const x=Math.cos(u),C=Math.cos(B),z=g.edge,A=z.position0,t=z.position1,D=z.faceNormal0,E=z.faceNormal1,G=f(w),H=e(w),I=H.length/4;w=q.allocate(I);u=0;const J=m.allocate(I);let K=0,L=0,S=0;const M=a.range(0,I),T=
new Float32Array(I);k.forEach(T,(N,P,U)=>{v.getVec(H[4*P],A);v.getVec(H[4*P+1],t);U[P]=h.distance(A,t)});M.sort((N,P)=>T[P]-T[N]);const O=[],Q=[];for(let N=0;N<I;N++){var F=M[N];const P=T[F],U=H[4*F],V=H[4*F+1],W=H[4*F+2];F=H[4*F+3];const X=-1===F;v.getVec(U,A);v.getVec(V,t);if(X)h.set(D,G[3*W],G[3*W+1],G[3*W+2]),h.copy(E,D),z.componentIndex=y.get(U),z.cosAngle=h.dot(D,E);else{h.set(D,G[3*W],G[3*W+1],G[3*W+2]);h.set(E,G[3*F],G[3*F+1],G[3*F+2]);z.componentIndex=y.get(U);z.cosAngle=h.dot(D,E);if(z.cosAngle>
C)continue;-.9999>z.cosAngle&&h.copy(E,D)}L+=P;S++;X||z.cosAngle<x?(q.write(w,u++,z),O.push(P)):c(z,B)&&(m.write(J,K++,z),Q.push(P))}y=new Float32Array(O.reverse());B=new Float32Array(Q.reverse());return{regular:{instancesData:q.trim(w,u),lodInfo:{lengths:y}},silhouette:{instancesData:m.trim(J,K),lodInfo:{lengths:B}},averageEdgeLength:L/S}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define(["exports","../../../../../core/maybe",
"../../../../../core/mathUtils","../Util","../../../../webgl/Texture"],function(b,k,a,r,l){function h(e,f){if(!e)return null;var g=e.length/2;const p=.1*g;g=Array(g);let n=0;f=1===f;for(let w=0;w<e.length;w+=2){const q=(e[w]+e[w+1])/2;f?g[n++]=Math.min(p,1-.5*(1-q)):g[n++]=Math.min(p,.5*q)}return g}let d=function(){function e(f,g,p,n,w){this.resolution=f;this.normalizationScale=g;this.amplitude=p;this.variants=n;this.texture=w}e.prototype.dispose=function(){this.texture=k.disposeMaybe(this.texture)};
return e}();const c={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,
-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,
.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,
-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],
pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,
.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,
.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,
.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,
-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,
1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,
.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,
-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,
.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,
.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,
.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,
.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,
3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,
4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,
1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,
.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,
.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,
.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,
.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,
2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,
-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,
.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,
2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,
.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,
.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,
.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,
-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,
.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,
.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,
-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,
.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,
.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,
.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,
.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,
6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,
1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,
-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,
2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,
.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,
.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,
.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};b.StrokesTexture=d;b.generateStrokesTexture=function(e){const f=c.resolution;
var g=f/2;const p=new Uint8Array(4*f*f),n=4*f*g;g=c.amplitude;const w=2*g,q=4*f,m=a.log2(f)+1,u=c.strokes.length;let v=(m-1)*u*q;for(const {distance:y,pressure:B}of c.strokes){let x=y,C=B,z=v;for(let A=0;A<m;A++){0!==A&&(x=h(x,0),C=h(C,1));for(let t=0;t<c.resolution;t++){const D=C?C[t%C.length]:1;r.packFloatRGBA((x?x[t%x.length]/w:0)+.5,p,z);r.packFloatRGBA(D,p,z+n);z+=4}z-=q*(u+1)}v+=q}e=new l(e,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:f,height:f,wrapMode:10497},p);return new d(f,
w,g,u,e)};b.rasterizeStrokes=function(){var e=c.resolution;const f=a.log2(e)+1;var g=c.strokes.length;const p=c.amplitude,n=Math.ceil(2*p+.5);var w;for(w=0;1<=e;)w+=e,e/=2;w+=6*(f+1);g*=n;e=new Uint8ClampedArray(4*w*g);const q=4*w;e.fill(255);let m=24;for(const {distance:u,pressure:v}of c.strokes){let y=u,B=v,x=m;for(let C=0;C<f;C++){0!==C&&(y=h(y,0),B=h(B,1));for(let z=0;z<y.length;z++){const A=y?y[z]:0,t=B?a.clamp(B[z],0,1):1;let D=x;for(let E=-p;E<n-p;E++){const G=255-255*a.clamp(1-(Math.abs(E-
A+.5)-.5*t),0,1);e[D+0]=G;e[D+1]=G;e[D+2]=G;e[D+3]=255;D+=q}x+=4}x+=24}m+=n*q}return new ImageData(e,w,g)};b.strokesDefinition=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","../../../../../core/maybe","../../../../../core/arrayUtils"],function(b,k,a){function r(l){return 0<l.size*l.color[3]*l.opacity}b.computeEdgeCount=function(l,h,d){const c=l.length;h*=d.minimumEdgeLength;d=a.binaryIndexOf(l,h,!0);l=-1===d?
h<l[0]?0:l.length:d;return c-l};b.determineEdgeTransparency=function(l){let h=0;for(const {material:d}of l)if(r(d)){if(1>d.color[3]*d.opacity)return 1;h=2}return h};b.determineObjectTransparency=function(l){let h=0;for(const {material:d}of l)if(r(d)){switch(d.objectTransparency){case 1:case 0:return 1;case 2:if(1>d.opacity)return 1}h=2}return h};b.determineRendererType=function(l){let h=null;for(const d of l)if(l=d.type,r(d))if(k.isNone(h))h=l;else if(h!==l)return"uber";return k.isSome(h)?h:"solid"};
b.estimateLengthAtDistance=function(l,h,d,c){return c/l*d*2*Math.tan(.5*h)};b.fillComponenBufferIndices=function(l,h,d,c){for(let f=0;f<l.length;f++){const g=l[f].index;var e=h[f];const p=h[f+1];if(c)for(;e<p;e++)d.set(c[e],g);else for(;e<p;e++)d.set(e,g)}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/Evented ../../../support/Scheduler ./Util ../../../webgl/Texture ./TextureTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f){const g=r.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");r=function(){function n(q,m,u,v){this._textures=m;this.rctx=v;this._idToRefCountedTexture=new Map;this._textureTechniqueConfig=new f.TextureTechniqueConfiguration;this._loadingCount=0;this._frameUpdates=new Map;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);this.events=new h;this._textureTechnique=u.acquireAndReleaseExisting(f.TextureTechnique,
this._textureTechniqueConfig,this._textureTechnique);for(m=0;m<this._fallbackTextureData.length;++m)this._fallbackTextureData[m]=255,this._fallbackTextureTransparentData[m]=0!==(m+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:this.rctx.parameters.maxMaxAnisotropy};this._frameTask=a.isSome(q)?q.registerTask(d.Task.TEXTURE_UNLOAD,()=>{},()=>!1):d.ImmediateTask}var w=n.prototype;w.dispose=function(){this._frameTask.remove();
a.isSome(this._fallbackTexture)&&(this._fallbackTexture.dispose(),this._fallbackTexture=null);a.isSome(this._fallbackTextureTransparent)&&(this._fallbackTextureTransparent.dispose(),this._fallbackTextureTransparent=null);this._textures.forEach(q=>q.unload())};w.acquire=function(q,m=!1,u){q=this._getOrCreateRef(q,m,u);q.ref();return q};w.update=function(){let q=!1;this._frameUpdates.forEach(m=>{const u=m.texture.frameUpdate(this.rctx,this._textureTechnique,m.previousToken);0<=u&&u!==m.previousToken&&
(m.previousToken=u,q=!0)});q&&this.events.emit("changed",0)};w._getOrCreateRef=function(q,m,u){const v=this._idToRefCountedTexture.get(q);return v?v:this._createNewRef(q,m,u)};w._createNewRef=function(q,m,u){const v=this._textures.get(q);c.assert(void 0!==v);const y=v.events.on("unloaded",()=>{y.remove();this._onTextureUnloaded(q)}),B=new p;this._idToRefCountedTexture.set(q,B);const x=v.load(this.rctx,this._textureTechnique);this._loadingCount++;const C=A=>{this._loadingCount--;this._updateGLTexture(B,
A);u&&u(B);v.requiresFrameUpdates&&this._frameUpdates.set(q,{texture:v,previousToken:-1});return B},z=A=>{this._loadingCount--;l.isAbortError(A)||g.error(A)};l.isThenable(x)?(this._updateGLTexture(B,m?this.fallbackTextureTransparent:this.fallbackTexture),x.then(C,z)):C(x);return B};w._updateGLTexture=function(q,m){q.glTexture=m;this.events.emit("changed",1)};w.release=function(q){const m=this._idToRefCountedTexture.get(q);if(m&&(m.unref(),m.isUnreferenced)){const u=this._textures.get(q);this._frameTask.schedule(()=>
{m.isUnreferenced&&u.unload()})}};w.getTexture=function(q){return this._textures.get(q)};w._onTextureUnloaded=function(q){this._idToRefCountedTexture.delete(q);this._frameUpdates.delete(q)};k._createClass(n,[{key:"loadingCount",get:function(){return this._loadingCount}},{key:"fallbackTexture",get:function(){a.isNone(this._fallbackTexture)&&(this._fallbackTexture=new e(this.rctx,this._fallbackTextureDesc,this._fallbackTextureData));return this._fallbackTexture}},{key:"fallbackTextureTransparent",get:function(){a.isNone(this._fallbackTextureTransparent)&&
(this._fallbackTextureTransparent=new e(this.rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData));return this._fallbackTextureTransparent}}]);return n}();let p=function(){function n(){this._refCount=0;this.glTexture=null}var w=n.prototype;w.ref=function(){++this._refCount};w.unref=function(){0===this._refCount?g.error("Cannot dereference texture that has no references!"):--this._refCount};k._createClass(n,[{key:"isUnreferenced",get:function(){return 0===this._refCount}}]);return n}();
b.RefCountedTexture=p;b.TextureRepository=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/has ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/property ../../../../../core/jsonMap ../../../../../core/accessorSupport/decorators/subclass ../../../../../core/urlUtils ../../../../../core/uuid ../../../../../portal/support/resourceExtension ../../../../../core/promiseUtils ../../../../../core/Accessor ../../../../../assets ../../../../../support/requestImageUtils ../../../../webgl/Texture".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){const v=l.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils"),y=[q.getAssetUrl("esri/images/materials/water/normals.jpg"),q.getAssetUrl("esri/images/materials/water/perturbation.jpg")];b.WaterTextureRepository=function(B){function x(){var z=B.apply(this,arguments)||this;z.data=[];z.loadingState=0;return z}k._inheritsLoose(x,B);var C=x.prototype;C.dispose=function(){this.loadingState=0;this.data.forEach(z=>{z.dispose();z=null});
this.data=null};C.getTextureProps=function(z,A,t=!1){return{target:3553,pixelFormat:6408,dataType:5121,wrapMode:10497,samplingMode:9987,hasMipmap:t,maxAnisotropy:8,width:z,height:A}};C.loadTextures=function(z){this.loadingState=1;n.all(y.map(A=>m.requestImage(A))).then(A=>{A.forEach((t,D)=>{this.data[D]=new u(z,this.getTextureProps(t.width,t.height,!0),t)});this.loadingState=2}).catch(A=>{v.error("Failed to load textures for water material.",A);this.loadingState=0})};C.bindRepo=function(z){for(let A=
0;A<this.data.length;A++)z.bindTexture(this.data[A],A)};k._createClass(x,[{key:"updating",get:function(){return 1===this.loadingState}},{key:"ready",get:function(){return 2===this.loadingState}}]);return x}(w);a.__decorate([d.property()],b.WaterTextureRepository.prototype,"loadingState",void 0);a.__decorate([d.property({type:Boolean,readOnly:!0,dependsOn:["loadingState"]})],b.WaterTextureRepository.prototype,"updating",null);b.WaterTextureRepository=a.__decorate([e.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],
b.WaterTextureRepository);b.waveAndPertubationTextureUrls=y;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../../../support/screenshotUtils ../lib/AutoDisposable ../../../webgl/FramebufferObject".split(" "),function(b,k,a,r,l,h,d,c){d=function(e){function f(p,n,w,q=null,m,u=!0){var v=e.call(this)||
this;v._rctx=p;v._renderScene=n;v._requestRenderScene=w;v._renderOverlay=q;v.forceCameraHook=m;v.supersample=u;v._screenshotQueue=[];return v}k._inheritsLoose(f,e);var g=f.prototype;g.dispose=function(){this._rctx=null};g.takeScreenshot=function(p){this._requestRenderScene();const n=r.createResolver();this._screenshotQueue.push({settings:p,resolver:n});return n.promise};g.update=function(p){if(0!==this._screenshotQueue.length){for(const w of this._screenshotQueue){if(this.isDisposed){w.resolver.reject();
continue}var n={...w.settings,pixelRatio:w.settings.pixelRatio*p.viewCamera.pixelRatio};const q=this._ensureScreenshotEncodeCanvas(),m=this._renderScreenshot(p,n);n=h.encodeResult(m,n,q,{flipY:!0,premultipliedAlpha:!0});w.resolver(n)}this._screenshotQueue=[]}};g._renderScreenshotOverlay=function(p,n,w){if(!a.isNone(this._renderOverlay)){p.width=n.width;p.height=n.height;var q=p.getContext("2d"),m=w.pixelRatio;q.save();q.translate(0,n.height);q.scale(1,-1);w.region&&q.translate(-w.region.x,-w.region.y);
q.scale(m,m);this._renderOverlay(p,n);q.restore()}};g._readbackScreenshot=function(p){return p.resample?this._readbackScreenshotResampled(p):this._readbackScreenshotImmediate(p)};g._readbackScreenshotResampled=function(p){const {framebufferWidth:n,framebufferHeight:w,region:q,resample:m}=p,u=this._ensureScreenshotEncodeCanvas(),v=h.createEmptyImageData(n,w,u);this._rctx.gl.readPixels(0,0,n,w,6408,5121,new Uint8Array(v.data.buffer));this._renderScreenshotOverlay(u,v,{...p,region:null});p=h.createEmptyImageData(q.width,
q.height,u);return h.resampleHermite(v,p,!0,m.region.x,w-(m.region.y+m.region.height),m.region.width,m.region.height)};g._readbackScreenshotImmediate=function(p){const {framebufferHeight:n,region:w}=p,q=this._ensureScreenshotEncodeCanvas(),m=h.createEmptyImageData(w.width,w.height,q);this._rctx.gl.readPixels(w.x,n-(w.y+w.height),w.width,w.height,6408,5121,new Uint8Array(m.data.buffer));this._renderScreenshotOverlay(q,m,p);return m};g._renderScreenshot=function(p,n){var w=null;const q=p.viewCamera,
{framebufferWidth:m,framebufferHeight:u}=n;var v=!1;p=n.disableDecorations&&p.frameHasDecorations;var y=n.ignorePadding&&q.pixelRatio!==n.pixelRatio;if(p=m!==q.fullWidth||u!==q.fullHeight||p||y){y=q.clone();if(n.ignorePadding){w=l.clone(y.padding);for(v=0;4>v;v++)w[v]=Math.round(w[v]/y.pixelRatio*n.pixelRatio);y.padding=w}y.fullWidth=m;y.fullHeight=u;y.pixelRatio=n.pixelRatio;w=q.fovX-y.fovX;v=q.fovY-y.fovY;0>w&&w<v?y.fovX=q.fovX:0>v&&v<w&&(y.fovY=q.fovY);this.forceCameraHook(y);v=!0;w=new c(this._rctx,
{width:y.fullWidth,height:y.fullHeight,colorTarget:0,depthStencilTarget:3});this._renderScene(w,y,n.disableDecorations)}n=this._readbackScreenshot(n);if(p&&!this._rctx.contextAttributes.alpha)for(p=3;p<n.data.length;p+=4)n.data[p]=255;w&&w.dispose();this._rctx.bindFramebuffer(null);v&&this.forceCameraHook(q);return n};g._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return f}(d.AutoDisposable);
b.ScreenshotManager=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports"],function(b){b.hitTestSelectSameDistance=async function(k,a){if("2d"===k.type)return k.hitTest(a);k=await k.hitTest(a);const r=k.results[0];a=k.results.findIndex(l=>l.distance!==r.distance);-1!==a&&(k.results=k.results.slice(0,a));return k};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../DefaultUI".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p){a=function(n){function w(q){q=n.call(this,q)||this;q.components=["attribution","zoom","navigation-toggle","compass"];return q}b._inheritsLoose(w,n);return w}(p);k.__decorate([h.property()],a.prototype,"components",void 0);return a=k.__decorate([c.subclass("esri.views.ui.3d.DefaultUI3D")],a)})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/watchUtils ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){r.getLogger("esri.views.ui.DefaultUI");a=function(y){function B(C){C=y.call(this,C)||this;C._defaultPositionLookup={attribution:"manual",compass:"top-leading","navigation-toggle":"top-leading",zoom:"top-leading"};C.components=[];return C}b._inheritsLoose(B,y);var x=B.prototype;x.initialize=function(){this._handles.add([p.init(this,"components",this._componentsWatcher.bind(this)),p.init(this,"view",this._updateViewAwareWidgets.bind(this))])};x._add=function(C,
z,A,t){if("string"===typeof C&&this._defaultPositionLookup[C]){if(this._find(C))return;C=this._createComponent(C)}y.prototype._add.call(this,C,z,A,t)};x._removeComponents=function(C){C.forEach(z=>{if(z=this._find(z))this.remove(z),z.destroy()})};x._updateViewAwareWidgets=function(C){this.components.forEach(z=>{(z=(z=this._find(z))&&z.widget)&&void 0!==z.view&&(z.view=C)})};x._componentsWatcher=function(C,z){this._removeComponents(z);this._addComponents(C);this._adjustPadding(C)};x._adjustPadding=
function(C){-1!==C.indexOf("attribution")||this._isOverridden("padding")||({top:C}=this.padding,this.padding=C)};x._addComponents=function(C){this.initialized&&C.forEach(z=>this.add(this._createComponent(z),this._defaultPositionLookup[z]))};x._createComponent=function(C){const z=this._createWidget(C);if(z)return new n({id:C,node:z})};x._createWidget=function(C){if("attribution"===C)return this._createAttribution();if("compass"===C)return this._createCompass();if("navigation-toggle"===C)return this._createNavigationToggle();
if("zoom"===C)return this._createZoom()};x._createAttribution=function(){return new q({view:this.view})};x._createCompass=function(){return new m({view:this.view})};x._createNavigationToggle=function(){return new u({view:this.view})};x._createZoom=function(){return new v({view:this.view})};return B}(w);k.__decorate([h.property()],a.prototype,"components",void 0);return a=k.__decorate([c.subclass("esri.views.ui.DefaultUI")],a)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ../../core/domUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){a=function(w){function q(){var u=w.apply(this,arguments)||this;u.widget=null;return u}b._inheritsLoose(q,w);var m=q.prototype;m.destroy=function(){this.widget&&this.widget.destroy();this.node=null};m.castNode=function(u){if(!u)return this._set("widget",null),null;if("string"===typeof u||u&&"nodeType"in u)return this._set("widget",null),n.byId(u);u&&"function"===typeof u.render&&!u.domNode&&(u.domNode=document.createElement("div"));this._set("widget",u);return u.domNode};
b._createClass(q,[{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(u){const v=this._get("node");u!==v&&(u&&u.classList.add("esri-component"),v&&v.classList.remove("esri-component"),this._set("node",u))}}]);return q}(p);k.__decorate([l.property({dependsOn:[],autoTracked:!1})],a.prototype,"id",null);k.__decorate([l.property()],a.prototype,"node",null);k.__decorate([h.cast("node")],a.prototype,"castNode",null);k.__decorate([l.property({readOnly:!0})],
a.prototype,"widget",void 0);return a=k.__decorate([c.subclass("esri.views.ui.Component")],a)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/domUtils ../../widgets/support/widgetUtils ./Component".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){function v(C){return"object"!==typeof C||C instanceof u||"declaredClass"in C||!("component"in C||"index"in C||"position"in C)?null:C}function y(C,{top:z,bottom:A,left:t,right:D}){C.style.top=z;C.style.bottom=A;C.style.left=t;C.style.right=D}const B={left:0,top:0,bottom:0,right:0},x={bottom:30,top:15,right:15,left:15};a=function(C){function z(t){t=C.call(this,t)||this;t._cornerNameToContainerLookup={};t._positionNameToContainerLookup={};t._components=[];
t._componentToKey=new Map;t._handles=new n;t.view=null;t._initContainers();return t}b._inheritsLoose(z,C);var A=z.prototype;A.initialize=function(){this._handles.add([w.init(this,"view.padding, container",this._applyViewPadding.bind(this)),w.init(this,"padding",this._applyUIPadding.bind(this))])};A.destroy=function(){this.container=null;for(const t of this._components)t.destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};A.castPadding=function(t){return"number"===
typeof t?{bottom:t,top:t,right:t,left:t}:{...x,...t}};A.add=function(t,D){let E,G;if(Array.isArray(t))t.forEach(I=>this.add(I,D));else{var H=v(t);H&&({index:E,position:D,component:t,key:G}=H);D&&"object"===typeof D&&({index:E,key:G,position:D}=D);!t||D&&!this._isValidPosition(D)||this._add(t,D,E,G)}};A.remove=function(t,D){if(t){if(Array.isArray(t))return t.map(H=>this.remove(H,D));var E=this._find(t);if(E){var G=this._componentToKey;if(!G.has(t)||G.get(t)===D)return G=this._components.indexOf(E),
E.node.parentNode&&E.node.parentNode.removeChild(E.node),this._componentToKey.delete(t),this._components.splice(G,1)[0]}}};A.empty=function(t){if(Array.isArray(t))return t.map(D=>this.empty(D)).reduce((D,E)=>D.concat(E));t=t||"manual";return"manual"===t?Array.prototype.slice.call(this._manualContainer.children).filter(D=>!D.classList.contains("esri-ui-corner")).map(D=>this.remove(D)):this._isValidPosition(t)?Array.prototype.slice.call(this._cornerNameToContainerLookup[t].children).map(this.remove,
this):null};A.move=function(t,D){Array.isArray(t)&&t.forEach(H=>this.move(H,D));if(t){var E=v(t)||v(D);if(E){var G=E.index;D=E.position;t=E.component||t}(!D||this._isValidPosition(D))&&(t=this.remove(t))&&this.add(t,{position:D,index:G})}};A.find=function(t){return t?(t=this._findById(t))&&(t.widget||t.node):null};A._add=function(t,D,E,G){t instanceof u||(t=new u({node:t}));this._place({component:t,position:D,index:E});this._components.push(t);G&&this._componentToKey.set(t,G)};A._find=function(t){return t?
t instanceof u?this._findByComponent(t):"string"===typeof t?this._findById(t):this._findByNode(t.domNode||t):null};A._getViewPadding=function(){return this.get("view.padding")||B};A._attachContainers=function(t){t.appendChild(this._innerContainer);t.appendChild(this._manualContainer)};A._initContainers=function(){var t=document.createElement("div");t.classList.add("esri-ui-inner-container");t.classList.add("esri-ui-corner-container");const D=document.createElement("div");D.classList.add("esri-ui-inner-container");
D.classList.add("esri-ui-manual-container");const E=document.createElement("div");E.classList.add("esri-ui-top-left");E.classList.add("esri-ui-corner");t.appendChild(E);const G=document.createElement("div");G.classList.add("esri-ui-top-right");G.classList.add("esri-ui-corner");t.appendChild(G);const H=document.createElement("div");H.classList.add("esri-ui-bottom-left");H.classList.add("esri-ui-corner");t.appendChild(H);const I=document.createElement("div");I.classList.add("esri-ui-bottom-right");
I.classList.add("esri-ui-corner");t.appendChild(I);this._innerContainer=t;this._manualContainer=D;t=m.isRTL();this._cornerNameToContainerLookup={"top-left":E,"top-right":G,"bottom-left":H,"bottom-right":I,"top-leading":t?G:E,"top-trailing":t?E:G,"bottom-leading":t?I:H,"bottom-trailing":t?H:I};this._positionNameToContainerLookup={manual:D,...this._cornerNameToContainerLookup}};A._isValidPosition=function(t){return!!this._positionNameToContainerLookup[t]};A._place=function(t){const D=t.component,E=
t.index;t=this._positionNameToContainerLookup[t.position||"manual"];var G=-1<E,H=D.widget;H&&!H._started&&"function"===typeof H.postMixInProperties&&"function"===typeof H.buildRendering&&"function"===typeof H.postCreate&&"function"===typeof H.startup&&D.widget.startup();G?(G=Array.prototype.slice.call(t.children),0===E?t.firstChild?q.insertBefore(D.node,t.firstChild):t.appendChild(D.node):E>=G.length?t.appendChild(D.node):q.insertBefore(D.node,G[E])):t.appendChild(D.node)};A._applyViewPadding=function(){const t=
this.container;t&&y(t,this._toPxPosition(this._getViewPadding()))};A._applyUIPadding=function(){const t=this._innerContainer;t&&y(t,this._toPxPosition(this.padding))};A._toPxPosition=function(t){return{top:this._toPxUnit(t.top),left:this._toPxUnit(t.left),right:this._toPxUnit(t.right),bottom:this._toPxUnit(t.bottom)}};A._toPxUnit=function(t){return 0===t?"0":t+"px"};A._findByComponent=function(t){let D=null,E;this._components.some(G=>{(E=G===t)&&(D=G);return E});return D};A._findById=function(t){let D=
null,E;this._components.some(G=>{(E=G.id===t)&&(D=G);return E});return D};A._findByNode=function(t){let D=null,E;this._components.some(G=>{(E=G.node===t)&&(D=G);return E});return D};b._createClass(z,[{key:"container",set:function(t){const D=this._get("container");t!==D&&(t&&(t.classList.add("esri-ui"),this._attachContainers(t)),D&&(D.classList.remove("esri-ui"),y(D,{top:"",bottom:"",left:"",right:""}),q.empty(D)),this._set("container",t))}},{key:"height",get:function(){const t=this.get("view.height")||
0;if(0===t)return t;const D=this._getViewPadding();return Math.max(t-(D.top+D.bottom),0)}},{key:"padding",get:function(){return this._get("padding")},set:function(t){t?this._override("padding",t):this._clearOverride("padding")}},{key:"width",get:function(){const t=this.get("view.width")||0;if(0===t)return t;const D=this._getViewPadding();return Math.max(t-(D.left+D.right),0)}}]);return z}(p.EventedAccessor);k.__decorate([l.property()],a.prototype,"container",null);k.__decorate([l.property({dependsOn:["view.height"]})],
a.prototype,"height",null);k.__decorate([l.property({value:x})],a.prototype,"padding",null);k.__decorate([h.cast("padding")],a.prototype,"castPadding",null);k.__decorate([l.property()],a.prototype,"view",void 0);k.__decorate([l.property({dependsOn:["view.width"]})],a.prototype,"width",null);return a=k.__decorate([c.subclass("esri.views.ui.UI")],a)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/watchUtils ./support/widgetUtils ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/renderable ../chunks/index ./Widget ./Attribution/AttributionViewModel".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){a=function(x){function C(A,t){A=x.call(this,A,t)||this;A._isOpen=!1;A._attributionTextOverflowed=!1;A._prevSourceNodeHeight=0;A.iconClass="esri-icon-description";A.itemDelimiter=" | ";A.label=void 0;A.messages=null;A.view=null;A.viewModel=new B;return A}b._inheritsLoose(C,x);var z=C.prototype;z.initialize=function(){this.own(n.on(this,"viewModel.items","change",()=>this.scheduleRender()))};z.render=function(){return v.jsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",
{["esri-attribution--open"]:this._isOpen}),onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};z.renderPoweredBy=function(){return v.jsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",v.jsx("a",{class:this.classes("esri-attribution__link","esri-widget__anchor"),href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))};z.renderSourcesNode=function(){const A=this._isOpen,t=this._isInteractive(),D=t?0:-1,{attributionText:E}=
this,G=t?"button":void 0;return v.jsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:A,["esri-interactive"]:t}),innerHTML:E,role:G,tabIndex:D})};z._afterSourcesNodeCreate=function(A){this._prevSourceNodeHeight=A.clientWidth};z._afterSourcesNodeUpdate=function(A){let t=!1;const {clientHeight:D,clientWidth:E,scrollWidth:G}=A;A=G>=E;const H=this._attributionTextOverflowed!==
A;this._attributionTextOverflowed=A;H&&(t=!0);this._isOpen&&(A=D<this._prevSourceNodeHeight,this._prevSourceNodeHeight=D,A&&(this._isOpen=!1,t=!0));t&&this.scheduleRender()};z._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};z._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};b._createClass(C,[{key:"attributionText",get:function(){return this.viewModel.items.reduce((A,t)=>{-1===A.indexOf(t.text)&&A.push(t.text);return A},[]).join(this.itemDelimiter)}}]);
return C}(y);k.__decorate([h.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0,autoTracked:!1}),u.renderable()],a.prototype,"attributionText",null);k.__decorate([h.property()],a.prototype,"iconClass",void 0);k.__decorate([h.property(),u.renderable()],a.prototype,"itemDelimiter",void 0);k.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],a.prototype,"label",void 0);k.__decorate([h.property(),u.renderable(),m.messageBundle("esri/widgets/Attribution/t9n/Attribution")],
a.prototype,"messages",void 0);k.__decorate([d.aliasOf("viewModel.view")],a.prototype,"view",void 0);k.__decorate([h.property({type:B}),u.renderable(["state","view.size"])],a.prototype,"viewModel",void 0);k.__decorate([q.accessibleHandler()],a.prototype,"_toggleState",null);return a=k.__decorate([e.subclass("esri.widgets.Attribution")],a)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../geometry/SpatialReference ../../geometry/support/webMercatorUtils ../../geometry/support/contains ../../geometry ../../core/Collection ../../core/asyncUtils ../../core/watchUtils ../../core/HandleOwner".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){function B(z,A){return z.length!==A.length||z.some((t,D)=>t.text!==A[D].text)}function x(z,A,t){t&&A&&(z.find(D=>D.layerView===A&&D.text===t)||z.push({text:t,layerView:A}))}const C=[];a=function(z){function A(D){var E=z.call(this,D)||this;E.clear=()=>{E._fetchedAttributionData.clear();E._pendingAttributions.clear();E.handles.remove("suspension");E.notifyChange("state")};E._pendingAttributions=new Set;E._fetchedAttributionData=new Map;E.items=new m;E.view=
null;E._allLayerViewsChange=G=>{E.handles.remove("suspension");const H=E.get("view.allLayerViews");H&&E.handles.add(H.map(I=>I.watch(["suspended","attributionVisible"],E._updateAttributionItems)),"suspension");G&&G.removed&&G.removed.forEach(I=>{E._pendingAttributions.delete(I);E._fetchedAttributionData.delete(I)});E._updateAttributionItems()};E._updateAttributionItems=()=>{const G=E.get("view.allLayerViews");C.length=0;G?(G.forEach(H=>{if(!H.suspended&&H.get("layer.attributionVisible")){var I=H.layer;
if(I&&"copyright"in I&&"function"===typeof I.originOf&&"user"===I.originOf("copyright"))x(C,H,I.copyright);else if(I.hasAttributionData)if(E._fetchedAttributionData.has(H)){var J=E._fetchedAttributionData.get(H);J&&x(C,H,E._getDynamicAttribution(J,E.view,I))}else E._fetchAttributionData(H);else(J=I.get("portalItem.accessInformation"))?x(C,H,J):x(C,H,I.copyright)}}),B(E.items,C)&&(E.items.removeAll(),E.items.addMany(C)),C.length=0,E.notifyChange("state")):E.clear()};E.handles.add([v.on(b._assertThisInitialized(E),
"view.allLayerViews","change",E._allLayerViewsChange,E._allLayerViewsChange,E.clear),v.whenTrue(b._assertThisInitialized(E),"view.stationary",()=>E._updateAttributionItems())]);return E}b._inheritsLoose(A,z);var t=A.prototype;t.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};t._fetchAttributionData=async function(D){if(!this._pendingAttributions.has(D)){this._pendingAttributions.add(D);var E=await u.result(D.layer.fetchAttributionData());
this._pendingAttributions.has(D)&&(E=E.ok?this._createContributionIndex(E.value,"bing-maps"===D.layer.type):null,this._pendingAttributions.delete(D),this._fetchedAttributionData.set(D,E));this._updateAttributionItems()}};t._createContributionIndex=function(D,E){D=D.contributors;const G={};if(!D)return G;for(let K=0;K<D.length;K++){const L=D[K];var H=L.coverageAreas;if(!H)return;for(const S of H){var I=S.bbox,J=S.zoomMin-(E&&S.zoomMin?1:0);H=S.zoomMax-(E&&S.zoomMax?1:0);for(I={extent:n.geographicToWebMercator({xmin:I[1],
ymin:I[0],xmax:I[3],ymax:I[2],spatialReference:p.WGS84}),attribution:L.attribution||"",score:null!=S.score?S.score:100,id:K};J<=H;J++)G[J]=G[J]||[],G[J].push(I)}}G.maxKey=Math.max.apply(null,Object.keys(G));return G};t._getDynamicAttribution=function(D,E,G){const {extent:H,scale:I}=E;G=G.tileInfo.scaleToZoom(I);G=Math.min(D.maxKey,Math.round(G));if(!H||null==G||-1>=G)return"";D=D[G];const J=n.project(H.center.clone().normalize(),E.spatialReference),K={};return D?D.filter(L=>{const S=!K[L.id]&&J&&
w.extentContainsPoint(L.extent,J);S&&(K[L.id]=!0);return S}).sort((L,S)=>S.score-L.score||L.objectId-S.objectId).map(L=>L.attribution).join(", "):""};b._createClass(A,[{key:"state",get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"}}]);return A}(y.HandleOwner);k.__decorate([h.property({readOnly:!0,type:m})],a.prototype,"items",void 0);k.__decorate([h.property({dependsOn:["view.ready"],readOnly:!0})],a.prototype,"state",null);k.__decorate([h.property()],
a.prototype,"view",void 0);return a=k.__decorate([c.subclass("esri.widgets.Attribution.AttributionViewModel")],a)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./support/widgetUtils ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/renderable ../chunks/index ./Widget ./Compass/CompassViewModel".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){a=function(B){function x(z,A){z=B.call(this,z,A)||this;z.goToOverride=null;z.iconClass="esri-icon-locate-circled";z.label=void 0;z.messages=null;z.view=null;z.viewModel=new y;return z}b._inheritsLoose(x,B);var C=x.prototype;C.reset=function(){return this.viewModel.reset()};C.render=function(){const {orientation:z,state:A}=this.viewModel;var t="disabled"===A,D="compass"===("rotation"===A?"rotation":"compass");const E=t?-1:0;t={["esri-disabled"]:t,["esri-interactive"]:!t};
D={["esri-icon-compass"]:D,["esri-icon-dial"]:!D};const {messages:G}=this;return u.jsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",t),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:E,"aria-label":G.reset,title:G.reset},u.jsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",D),styles:this._toRotationTransform(z)}),u.jsx("span",{class:"esri-icon-font-fallback-text"},G.reset))};C._reset=function(){this.viewModel.reset()};C._toRotationTransform=
function(z){return{transform:`rotateZ(${z.z}deg)`}};return x}(v);k.__decorate([d.aliasOf("viewModel.goToOverride")],a.prototype,"goToOverride",void 0);k.__decorate([h.property()],a.prototype,"iconClass",void 0);k.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],a.prototype,"label",void 0);k.__decorate([h.property(),m.renderable(),q.messageBundle("esri/widgets/Compass/t9n/Compass")],a.prototype,"messages",void 0);k.__decorate([d.aliasOf("viewModel.view")],a.prototype,
"view",void 0);k.__decorate([h.property({type:y}),m.renderable(["viewModel.orientation","viewModel.state"])],a.prototype,"viewModel",void 0);k.__decorate([w.accessibleHandler()],a.prototype,"_reset",null);return a=k.__decorate([e.subclass("esri.widgets.Compass")],a)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ../../core/Handles ../../core/watchUtils ../support/GoTo".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){a=function(m){function u(y){y=m.call(this,y)||this;y._handles=new n;y.orientation={x:0,y:0,z:0};y.view=null;y._updateForCamera=y._updateForCamera.bind(b._assertThisInitialized(y));y._updateForRotation=y._updateForRotation.bind(b._assertThisInitialized(y));y._updateRotationWatcher=y._updateRotationWatcher.bind(b._assertThisInitialized(y));y.view;return y}b._inheritsLoose(u,m);var v=u.prototype;v.initialize=function(){this._handles.add(w.init(this,"view",this._updateRotationWatcher))};
v.destroy=function(){this._handles.destroy();this.view=this._handles=null};v.reset=function(){if(this.get("view.ready")){var y={};"2d"===this.view.type?y.rotation=0:y.heading=0;this.callGoTo({target:y})}};v._updateForRotation=function(y){void 0!==y&&null!==y&&(this.orientation={z:y})};v._updateForCamera=function(y){y&&(this.orientation={x:0,y:0,z:-y.heading})};v._updateRotationWatcher=function(y){this._handles.removeAll();y&&("2d"===y.type?this._handles.add(w.init(this,"view.rotation",this._updateForRotation)):
this._handles.add(w.init(this,"view.camera",this._updateForCamera)))};b._createClass(u,[{key:"canShowNorth",get:function(){const y=this.get("view.spatialReference");return!(!y||!y.isWebMercator&&!y.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return u}(q.GoToMixin(p));k.__decorate([h.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],a.prototype,"canShowNorth",null);
k.__decorate([h.property()],a.prototype,"orientation",void 0);k.__decorate([h.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],a.prototype,"state",null);k.__decorate([h.property()],a.prototype,"view",void 0);return a=k.__decorate([c.subclass("esri.widgets.CompassViewModel")],a)})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./support/widgetUtils ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/renderable ../chunks/index ./Widget ./NavigationToggle/NavigationToggleViewModel".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){a=function(B){function x(z,A){z=B.call(this,z,A)||this;z.iconClass="esri-icon-pan2";z.label=void 0;z.messages=null;z.view=null;z.viewModel=new y;return z}b._inheritsLoose(x,B);var C=x.prototype;C.toggle=function(){return this.viewModel.toggle()};C.render=function(){const z="disabled"===this.get("viewModel.state");var A="pan"===this.get("viewModel.navigationMode");const t={["esri-navigation-toggle__button--active"]:A};A={["esri-navigation-toggle__button--active"]:!A};
const D=z?-1:0,E=this.messages.toggle;return u.jsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{["esri-disabled"]:z,["esri-navigation-toggle--horizontal"]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:D,"aria-label":E,title:E},u.jsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",t)},u.jsx("span",{class:"esri-icon-pan"})),u.jsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",A)},u.jsx("span",{class:"esri-icon-rotate"})))};C._toggle=function(){this.toggle()};b._createClass(x,[{key:"layout",set:function(z){"horizontal"!==z&&(z="vertical");this._set("layout",z)}}]);return x}(v);k.__decorate([h.property()],a.prototype,"iconClass",void 0);k.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],a.prototype,"label",void 0);k.__decorate([h.property({value:"vertical"}),m.renderable()],a.prototype,"layout",null);
k.__decorate([h.property(),m.renderable(),q.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],a.prototype,"messages",void 0);k.__decorate([d.aliasOf("viewModel.view"),m.renderable()],a.prototype,"view",void 0);k.__decorate([h.property({type:y}),m.renderable(["viewModel.state","viewModel.navigationMode"])],a.prototype,"viewModel",void 0);k.__decorate([w.accessibleHandler()],a.prototype,"_toggle",null);return a=k.__decorate([e.subclass("esri.widgets.NavigationToggle")],a)})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ../../core/Handles ../../core/watchUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){a=function(q){function m(v){v=q.call(this,v)||this;v._handles=new n;v.navigationMode="pan";v.view=null;return v}b._inheritsLoose(m,q);var u=m.prototype;u.initialize=function(){this._handles.add(w.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};u.destroy=function(){this._handles.destroy();this.view=this._handles=null};u.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};
u._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};b._createClass(m,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}}]);return m}(p);k.__decorate([h.property({dependsOn:["view.ready"],readOnly:!0})],a.prototype,"state",null);k.__decorate([h.property()],a.prototype,"navigationMode",void 0);k.__decorate([h.property()],a.prototype,"view",void 0);return a=k.__decorate([c.subclass("esri.widgets.NavigationToggleViewModel")],
a)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/aliasOf ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./support/widgetUtils ./support/decorators/messageBundle ./support/decorators/renderable ../chunks/index ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){a=function(B){function x(z,A){z=B.call(this,z,A)||this;z.iconClass="esri-icon-zoom-in-magnifying-glass";z.label=void 0;z.messages=null;z.view=null;z.viewModel=new y;return z}b._inheritsLoose(x,B);var C=x.prototype;C.initialize=function(){this._zoomInButton=new v({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new v({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};C.destroy=function(){this._zoomInButton.destroy();
this._zoomOutButton.destroy();this._zoomOutButton=this._zoomInButton=null};C.render=function(){const z=this.viewModel,A={["esri-zoom--horizontal"]:"horizontal"===this.layout};this._zoomInButton.enabled="ready"===z.state&&z.canZoomIn;this._zoomOutButton.enabled="ready"===z.state&&z.canZoomOut;this._zoomInButton.title=this.messages.zoomIn;this._zoomOutButton.title=this.messages.zoomOut;return m.jsx("div",{class:this.classes("esri-zoom esri-widget",A)},this._zoomInButton.render(),this._zoomOutButton.render())};
C.zoomIn=function(){return this.viewModel.zoomIn()};C.zoomOut=function(){return this.viewModel.zoomOut()};b._createClass(x,[{key:"layout",set:function(z){"horizontal"!==z&&(z="vertical");this._set("layout",z)}}]);return x}(u);k.__decorate([h.property()],a.prototype,"iconClass",void 0);k.__decorate([h.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],a.prototype,"label",void 0);k.__decorate([h.property({value:"vertical"}),q.renderable()],a.prototype,"layout",null);k.__decorate([h.property(),
q.renderable(),w.messageBundle("esri/widgets/Zoom/t9n/Zoom")],a.prototype,"messages",void 0);k.__decorate([d.aliasOf("viewModel.view"),q.renderable()],a.prototype,"view",void 0);k.__decorate([h.property({type:y}),q.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],a.prototype,"viewModel",void 0);return a=k.__decorate([e.subclass("esri.widgets.Zoom")],a)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../support/widgetUtils ../support/decorators/accessibleHandler ../support/decorators/renderable ../../chunks/index ../Widget".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){a=function(u){function v(){var B=u.apply(this,arguments)||this;B.enabled=!0;B.iconClass="";B.title="";return B}b._inheritsLoose(v,u);var y=v.prototype;y.render=function(){const B=this.enabled?0:-1,x={[this.iconClass]:!!this.iconClass};return q.jsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",
tabIndex:B,title:this.title},q.jsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",x)}),q.jsx("span",{class:"esri-icon-font-fallback-text"},this.title))};y._triggerAction=function(){this.action.call(this)};return v}(m);k.__decorate([h.property()],a.prototype,"action",void 0);k.__decorate([h.property(),w.renderable()],a.prototype,"enabled",void 0);k.__decorate([h.property(),w.renderable()],a.prototype,"iconClass",void 0);k.__decorate([h.property(),w.renderable()],a.prototype,
"title",void 0);k.__decorate([n.accessibleHandler()],a.prototype,"_triggerAction",null);return a=k.__decorate([c.subclass("esri.widgets.IconButton")],a)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../core/Accessor ./ZoomConditions2D ./ZoomConditions3D".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){a=function(m){function u(y){y=m.call(this,y)||this;y.canZoomIn=!1;y.canZoomOut=!1;return y}b._inheritsLoose(u,m);var v=u.prototype;v.destroy=function(){this.view=null};v.zoomIn=function(){if(this.canZoomIn){var y=this.view;"2d"===y.type?y.mapViewNavigation.zoomIn():p.ignoreAbortErrors(y.goTo({zoomFactor:2}))}};v.zoomOut=function(){if(this.canZoomOut){var y=this.view;"2d"===y.type?y.mapViewNavigation.zoomOut():p.ignoreAbortErrors(y.goTo({zoomFactor:.5}))}};b._createClass(u,
[{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"view",set:function(y){y?"2d"===y.type?this._zoomConditions=new w({view:y}):"3d"===y.type&&(this._zoomConditions=new q({view:y})):this._zoomConditions=null;this._set("view",y)}}]);return u}(n);k.__decorate([h.property()],a.prototype,"_zoomConditions",void 0);k.__decorate([h.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],a.prototype,"canZoomIn",void 0);k.__decorate([h.property({aliasOf:"_zoomConditions.canZoomOut",
readOnly:!0})],a.prototype,"canZoomOut",void 0);k.__decorate([h.property({dependsOn:["view.ready"],readOnly:!0})],a.prototype,"state",null);k.__decorate([h.property()],a.prototype,"view",null);return a=k.__decorate([c.subclass("esri.widgets.Zoom.ZoomViewModel")],a)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p){a=function(n){function w(){return n.apply(this,arguments)||this}b._inheritsLoose(w,n);b._createClass(w,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const q=this.get("view.animation.target.scale")||this.get("view.scale"),m=this.get("view.constraints.effectiveMaxScale");return 0===m||q>m}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const q=this.get("view.animation.target.scale")||this.get("view.scale"),m=this.get("view.constraints.effectiveMinScale");
return 0===m||q<m}}]);return w}(p);k.__decorate([h.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMaxScale"],readOnly:!0})],a.prototype,"canZoomIn",null);k.__decorate([h.property({dependsOn:["view.ready","view.scale","view.animation.target.scale","view.constraints.effectiveMinScale"],readOnly:!0})],a.prototype,"canZoomOut",null);k.__decorate([h.property()],a.prototype,"view",void 0);return a=k.__decorate([c.subclass("esri.widgets.Zoom.ZoomConditions2D")],
a)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor".split(" "),function(b,k,a,r,l,h,d,c,e,f,g,p){a=function(n){function w(){return n.apply(this,arguments)||
this}b._inheritsLoose(w,n);b._createClass(w,[{key:"canZoomIn",get:function(){return!!this.get("view.ready")}},{key:"canZoomOut",get:function(){return!!this.get("view.ready")}}]);return w}(p);k.__decorate([h.property({dependsOn:["view.ready"],readOnly:!0})],a.prototype,"canZoomIn",null);k.__decorate([h.property({dependsOn:["view.ready"],readOnly:!0})],a.prototype,"canZoomOut",null);k.__decorate([h.property()],a.prototype,"view",void 0);return a=k.__decorate([c.subclass("esri.widgets.Zoom.ZoomConditions3D")],
a)})},"esri/layers/SceneLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/utils ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ./support/fieldUtils ../PopupTemplate ../request ./Layer ../renderers/Renderer ../renderers/ClassBreaksRenderer ../renderers/UniqueValueRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/SimpleRenderer ../renderers/support/types ../renderers/support/jsonUtils ../core/MultiOriginJSONSupport ../core/watchUtils ./support/commonProperties ./mixins/OperationalLayer ./support/FieldsIndex ./mixins/ArcGISService ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/FeatureReduction ./support/LabelClass ./support/FeatureReductionSelection ./support/fieldProperties ./support/labelingInfo ../renderers/support/styleUtils ../support/popupUtils ../tasks/support/Query ./support/capabilities ./support/I3SLayerDefinitions ./mixins/SceneService ./support/FetchAssociatedFeatureLayer ./support/RangeInfo".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q,F,N,P,U,V,W,X,ca,R,aa,ka,da,fa){const ea=["3DObject","Point"],Y=h.getLogger("esri.layers.SceneLayer");r=U.defineFieldProperties();x=function(ia){function ja(...qa){qa=ia.call(this,...qa)||this;qa.featureReduction=null;qa.rangeInfos=null;qa.operationalLayerType="ArcGISSceneServiceLayer";qa.type="scene";qa.fields=null;qa.outFields=null;qa.nodePages=null;qa.materialDefinitions=null;qa.textureSetDefinitions=null;qa.geometryDefinitions=
null;qa.serviceUpdateTimeStamp=null;qa.definitionExpression=null;qa.path=null;qa.labelsVisible=!0;qa.labelingInfo=null;qa.legendEnabled=!0;qa.cachedDrawingInfo={color:!1};qa.editingEnabled=!0;qa.popupEnabled=!0;qa.popupTemplate=null;qa.objectIdField=null;qa.globalIdField=null;qa._fieldUsageInfo={};qa.screenSizePerspectiveEnabled=!0;return qa}k._inheritsLoose(ja,ia);var la=ja.prototype;la.normalizeCtorArgs=function(qa,na){return"string"===typeof qa?{url:qa,...na}:qa};la.getField=function(qa){return this.fieldsIndex.get(qa)};
la.getFieldDomain=function(qa){return(qa=this.getField(qa))&&qa.domain?qa.domain:null};la.readNodePages=function(qa,na,oa){"Point"===na.layerType&&(qa=na.pointNodePages);return null==qa||"object"!==typeof qa?null:aa.I3SNodePageDefinition.fromJSON(qa,oa)};la.readCachedDrawingInfo=function(qa){if(null==qa||"object"!==typeof qa)qa={};null==qa.color&&(qa.color=!1);return qa};la.readObjectIdField=function(qa,na){!qa&&na.fields&&na.fields.some(oa=>{"esriFieldTypeOID"===oa.type&&(qa=oa.name);return!!qa});
return qa||void 0};la.readGlobalIdField=function(qa,na){!qa&&na.fields&&na.fields.some(oa=>{"esriFieldTypeGlobalID"===oa.type&&(qa=oa.name);return!!qa});return qa||void 0};la.readProfile=function(qa,na){qa=na.store.profile;if(null!=qa&&Z[qa])return Z[qa];Y.error("Unknown or missing profile",{profile:qa,layer:this});return"mesh-pyramids"};la.load=function(qa){const na=l.isSome(qa)?qa.signal:null;qa=this.loadFromPortal({supportedTypes:["Scene Service"]},qa).then(()=>this._fetchService(na),()=>this._fetchService(na)).then(()=>
u.all([this._verifyRootNodeAndUpdateExtent(this.nodePages,na),this._setAssociatedFeatureLayer(na)])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>W.loadStyleRenderer(this,{origin:"service"},na)).then(()=>v.fixRendererFields(this.renderer,this.fields));this.addResolvingPromise(qa);return u.resolve(this)};la.createQuery=function(){const qa=new ca;"mesh"!==this.geometryType&&(qa.returnGeometry=!0,qa.returnZ=
!0);qa.where=this.definitionExpression||"1\x3d1";qa.sqlFormat="standard";return qa};la.queryExtent=function(qa,na){return this._getAssociatedLayerForQuery().then(oa=>oa.queryExtent(qa||this.createQuery(),na))};la.queryFeatureCount=function(qa,na){return this._getAssociatedLayerForQuery().then(oa=>oa.queryFeatureCount(qa||this.createQuery(),na))};la.queryFeatures=function(qa,na){return this._getAssociatedLayerForQuery().then(oa=>oa.queryFeatures(qa||this.createQuery(),na)).then(oa=>{if(oa&&oa.features)for(const ua of oa.features)ua.layer=
this,ua.sourceLayer=this;return oa})};la.queryObjectIds=function(qa,na){return this._getAssociatedLayerForQuery().then(oa=>oa.queryObjectIds(qa||this.createQuery(),na))};la.getFieldUsageInfo=function(qa){const na={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[qa]||na:(Y.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),na)};la.createPopupTemplate=function(qa){return X.createPopupTemplate(this,qa)};
la._getAssociatedLayerForQuery=function(){const qa=this.associatedLayer;return l.isSome(qa)&&qa.loaded?u.resolve(qa):this._loadAssociatedLayerForQuery()};la._loadAssociatedLayerForQuery=async function(){await this.load();if(l.isNone(this.associatedLayer))throw new n("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{await this.associatedLayer.load()}catch(qa){throw new n("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",
{layer:this,error:qa});}return this.associatedLayer};la.hasCachedStatistics=function(qa){return null!=this.statisticsInfo&&this.statisticsInfo.some(na=>na.name===qa)};la.queryCachedStatistics=async function(qa,na){await this.load(na);if(!this.statisticsInfo)throw new n("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const oa=this.fieldsIndex.get(qa);if(!oa)throw new n("scenelayer:field-unexisting",`Field '${qa}' does not exist on the layer`);for(const ua of this.statisticsInfo)if(ua.name===
oa.name)return qa=w.join(this.parsedUrl.path,ua.href),B(qa,{query:{f:"json"},responseType:"json",signal:na?na.signal:null}).then(za=>za.data);throw new n("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");};la.saveAs=async function(qa,na){return this._debouncedSaveOperations(1,{...na,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},qa)};la.save=async function(){return this._debouncedSaveOperations(0,{getTypeKeywords:()=>this._getTypeKeywords(),
portalItemLayerType:"scene"})};la.applyEdits=async function(qa,na){const oa=await new Promise(function(ua,za){b(["./graphics/editingSupport"],ua,za)});await this.load();if(l.isNone(this.associatedLayer))throw new n(`${this.type}-layer:not-editable`,"Service is not editable");await this.associatedLayer.load();return oa.applyEdits(this,this.associatedLayer.source,qa,na)};la.on=function(qa,na){return ia.prototype.on.call(this,qa,na)};la.validateLayer=function(qa){if(qa.layerType&&-1===ea.indexOf(qa.layerType))throw new n("scenelayer:layer-type-not-supported",
"SceneLayer does not support this layer type",{layerType:qa.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new n("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new n("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});{qa=this.normalReferenceFrame;var na=this.spatialReference;
let oa=!1,ua=!1;if(null==qa)ua=oa=!0;else switch(na=na&&na.isGeographic,qa){case "east-north-up":case "earth-centered":oa=!0;ua=na;break;case "vertex-reference-frame":oa=!0;ua=!na;break;default:oa=!1}if(!oa)throw new n("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!ua)throw new n("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");}};la._getTypeKeywords=function(){const qa=[];if("points"===
this.profile)qa.push("Point");else if("mesh-pyramids"===this.profile)qa.push("3DObject");else throw new n("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return qa};la._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(const qa of this.fields){const na=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(ua=>ua.name===qa.name)),oa=!!(l.isSome(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(ua=>
ua&&qa.name===ua.name));this._fieldUsageInfo[qa.name]={supportsLabelingInfo:na,supportsRenderer:na,supportsPopupTemplate:na||oa,supportsLayerQuery:oa}}};la._applyAssociatedLayerOverrides=function(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides()};la._applyAssociatedLayerFieldsOverrides=function(){if(!l.isNone(this.associatedLayer)&&this.associatedLayer.fields){var qa=null;for(const na of this.associatedLayer.fields){const oa=this.getField(na.name);oa?(!oa.domain&&
na.domain&&(oa.domain=na.domain.clone()),oa.editable=na.editable,oa.nullable=na.nullable):(qa||(qa=this.fields?this.fields.slice():[]),qa.push(na.clone()))}qa&&this._set("fields",qa)}};la._applyAssociatedLayerPopupOverrides=function(){if(!l.isNone(this.associatedLayer)){var qa=["popupTemplate","popupEnabled"],na=c.getProperties(this);for(let oa=0;oa<qa.length;oa++){const ua=qa[oa];this._buddyIsMoreImportant(ua)&&(na.setDefaultOrigin(this.associatedLayer.originOf(ua)),na.set(ua,this.associatedLayer[ua]),
na.setDefaultOrigin("user"))}}};la._setAssociatedFeatureLayer=async function(qa){if(-1!==["mesh-pyramids","points"].indexOf(this.profile)){qa=new da.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,qa);try{this.associatedLayer=await qa.fetch()}catch(na){u.isAbortError(na)||this._logWarningOnPopupEnabled()}}};la._logWarningOnPopupEnabled=function(){K.whenValidOnce(this,["popupTemplate","popupEnabled"],()=>this.popupEnabled&&null!=this.popupTemplate).then(()=>()=>{const qa=`this SceneLayer: ${this.title}`;
null==this.attributeStorageInfo?Y.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${qa}`):Y.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${qa}`)})};la._buddyIsMoreImportant=function(qa){if(l.isNone(this.associatedLayer))return!1;const na=this.originIdOf(qa);qa=this.associatedLayer.originIdOf(qa);return null!=qa&&2>=qa?null==na||2>na:null!=qa&&3>=qa?null==na||3>na:!1};la._validateElevationInfo=
function(){const qa=this.elevationInfo;qa&&("mesh-pyramids"===this.profile&&"absolute-height"!==qa.mode&&Y.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),qa.featureExpressionInfo&&"0"!==qa.featureExpressionInfo.expression&&Y.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};k._createClass(ja,[{key:"fieldsIndex",get:function(){return new M(this.fields)}},{key:"elevationInfo",set:function(qa){this._set("elevationInfo",qa);this.loaded&&
this._validateElevationInfo()}},{key:"geometryType",get:function(){return ba[this.profile]||"mesh"}},{key:"renderer",set:function(qa){v.fixRendererFields(qa,this.fields);this._set("renderer",qa)}},{key:"capabilities",get:function(){var qa=l.isSome(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:R.zeroCapabilities;const {query:na,editing:{supportsGlobalId:oa,supportsRollbackOnFailure:ua,supportsUploadWithItemId:za},data:{supportsZ:Fa,supportsM:La,isVersioned:Sa},
operations:{supportsEditing:Ia,supportsUpdate:Qa}}=qa;qa=qa.operations.supportsChangeTracking;return{query:na,editing:{supportsGlobalId:oa,supportsRollbackOnFailure:ua,supportsGeometryUpdate:!1,supportsUploadWithItemId:za},data:{supportsZ:Fa,supportsM:La,isVersioned:Sa},operations:{supportsEditing:Ia&&qa,supportsAdd:!1,supportsDelete:!1,supportsUpdate:Qa&&qa}}}},{key:"defaultPopupTemplate",get:function(){return l.isSome(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}},
{key:"displayField",get:function(){return l.isSome(this.associatedLayer)?this.associatedLayer.displayField:null}}]);return ja}(ka.SceneService(T.ArcGISService(S.OperationalLayer(O.PortalLayer(Q.ScaleRangeLayer(J.MultiOriginJSONMixin(x)))))));a.__decorate([e.property({types:{key:"type",base:F["default"],typeMap:{selection:P}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],x.prototype,"featureReduction",
void 0);a.__decorate([e.property({type:[fa["default"]],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],x.prototype,"rangeInfos",void 0);a.__decorate([e.property({json:{read:!1}})],x.prototype,"associatedLayer",void 0);a.__decorate([e.property({type:["show","hide"]})],x.prototype,"listMode",void 0);a.__decorate([e.property({type:["ArcGISSceneServiceLayer"]})],x.prototype,"operationalLayerType",void 0);a.__decorate([e.property({json:{read:!1},
readOnly:!0})],x.prototype,"type",void 0);a.__decorate([e.property({...r.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],x.prototype,"fields",void 0);a.__decorate([e.property({readOnly:!0,dependsOn:["fields"]})],x.prototype,"fieldsIndex",null);a.__decorate([e.property(r.outFields)],x.prototype,"outFields",void 0);a.__decorate([e.property({type:aa.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],x.prototype,"nodePages",void 0);a.__decorate([g.reader("service","nodePages",["nodePages",
"pointNodePages"])],x.prototype,"readNodePages",null);a.__decorate([e.property({type:[aa.I3SMaterialDefinition],readOnly:!0})],x.prototype,"materialDefinitions",void 0);a.__decorate([e.property({type:[aa.I3STextureSetDefinition],readOnly:!0})],x.prototype,"textureSetDefinitions",void 0);a.__decorate([e.property({type:[aa.I3SGeometryDefinition],readOnly:!0})],x.prototype,"geometryDefinitions",void 0);a.__decorate([e.property({readOnly:!0})],x.prototype,"serviceUpdateTimeStamp",void 0);a.__decorate([e.property({readOnly:!0})],
x.prototype,"attributeStorageInfo",void 0);a.__decorate([e.property({readOnly:!0})],x.prototype,"statisticsInfo",void 0);a.__decorate([e.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:!0}})],x.prototype,"definitionExpression",void 0);a.__decorate([e.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],x.prototype,"path",void 0);a.__decorate([e.property(L.elevationInfo)],x.prototype,"elevationInfo",null);
a.__decorate([e.property({type:String,dependsOn:["profile"]})],x.prototype,"geometryType",null);a.__decorate([e.property(L.labelsVisible)],x.prototype,"labelsVisible",void 0);a.__decorate([e.property({type:[N],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:V.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:V.reader},write:!0}})],x.prototype,"labelingInfo",void 0);a.__decorate([e.property(L.legendEnabled)],x.prototype,"legendEnabled",void 0);a.__decorate([e.property(L.opacityDrawingInfo)],
x.prototype,"opacity",void 0);a.__decorate([e.property({types:H.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],x.prototype,"renderer",null);a.__decorate([e.property({json:{read:!1}})],x.prototype,"cachedDrawingInfo",void 0);a.__decorate([g.reader("service","cachedDrawingInfo")],x.prototype,"readCachedDrawingInfo",null);a.__decorate([e.property({readOnly:!0,json:{read:!1},dependsOn:["associatedLayer.capabilities"]})],
x.prototype,"capabilities",null);a.__decorate([e.property({type:Boolean,json:{read:!1}})],x.prototype,"editingEnabled",void 0);a.__decorate([e.property(L.popupEnabled)],x.prototype,"popupEnabled",void 0);a.__decorate([e.property({type:y,json:{name:"popupInfo",write:!0}})],x.prototype,"popupTemplate",void 0);a.__decorate([e.property({readOnly:!0,json:{read:!1},dependsOn:["fields","title","attributeStorageInfo","associatedLayer"]})],x.prototype,"defaultPopupTemplate",null);a.__decorate([e.property({type:String,
json:{read:!1}})],x.prototype,"objectIdField",void 0);a.__decorate([g.reader("service","objectIdField",["objectIdField","fields"])],x.prototype,"readObjectIdField",null);a.__decorate([e.property({type:String,json:{read:!1}})],x.prototype,"globalIdField",void 0);a.__decorate([g.reader("service","globalIdField",["globalIdField","fields"])],x.prototype,"readGlobalIdField",null);a.__decorate([e.property({readOnly:!0,type:String,json:{read:!1},dependsOn:["associatedLayer.displayField"]})],x.prototype,
"displayField",null);a.__decorate([e.property({type:String,json:{read:!1}})],x.prototype,"profile",void 0);a.__decorate([g.reader("service","profile",["store.profile"])],x.prototype,"readProfile",null);a.__decorate([e.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],x.prototype,"normalReferenceFrame",void 0);a.__decorate([e.property(L.screenSizePerspectiveEnabled)],x.prototype,"screenSizePerspectiveEnabled",void 0);x=a.__decorate([p.subclass("esri.layers.SceneLayer")],
x);const Z={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},ba={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return x})},"esri/layers/support/capabilities":function(){define(["exports"],function(b){b.zeroCapabilities={attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,
supportsName:!1,supportsSize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,
supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,
supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){b.I3SNodePageDefinition=function(w){function q(){var m=w.apply(this,arguments)||this;m.nodesPerPage=null;m.rootIndex=0;m.lodSelectionMetricType=null;return m}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([d.property({type:Number})],b.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);a.__decorate([d.property({type:Number})],b.I3SNodePageDefinition.prototype,"rootIndex",void 0);a.__decorate([d.property({type:String})],b.I3SNodePageDefinition.prototype,
"lodSelectionMetricType",void 0);b.I3SNodePageDefinition=a.__decorate([e.subclass("esri.layer.support.I3SNodePageDefinition")],b.I3SNodePageDefinition);b.I3SMaterialTexture=function(w){function q(){var m=w.apply(this,arguments)||this;m.factor=1;return m}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([d.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],b.I3SMaterialTexture.prototype,"id",void 0);a.__decorate([d.property({type:Number})],b.I3SMaterialTexture.prototype,
"factor",void 0);b.I3SMaterialTexture=a.__decorate([e.subclass("esri.layer.support.I3SMaterialTexture")],b.I3SMaterialTexture);b.I3SMaterialPBRMetallicRoughness=function(w){function q(){var m=w.apply(this,arguments)||this;m.baseColorFactor=[1,1,1,1];m.baseColorTexture=null;m.metallicRoughnessTexture=null;m.metallicFactor=1;m.roughnessFactor=1;return m}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([d.property({type:[Number]})],b.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",
void 0);a.__decorate([d.property({type:b.I3SMaterialTexture})],b.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);a.__decorate([d.property({type:b.I3SMaterialTexture})],b.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);a.__decorate([d.property({type:Number})],b.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);a.__decorate([d.property({type:Number})],b.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);b.I3SMaterialPBRMetallicRoughness=
a.__decorate([e.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],b.I3SMaterialPBRMetallicRoughness);b.I3SMaterialDefinition=function(w){function q(){var m=w.apply(this,arguments)||this;m.alphaMode="opaque";m.alphaCutoff=.25;m.doubleSided=!1;m.cullFace="none";m.normalTexture=null;m.occlusionTexture=null;m.emissiveTexture=null;m.emissiveFactor=null;m.pbrMetallicRoughness=null;return m}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([c.enumeration({opaque:"opaque",mask:"mask",
blend:"blend"})],b.I3SMaterialDefinition.prototype,"alphaMode",void 0);a.__decorate([d.property({type:Number})],b.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);a.__decorate([d.property({type:Boolean})],b.I3SMaterialDefinition.prototype,"doubleSided",void 0);a.__decorate([c.enumeration({none:"none",back:"back",front:"front"})],b.I3SMaterialDefinition.prototype,"cullFace",void 0);a.__decorate([d.property({type:b.I3SMaterialTexture})],b.I3SMaterialDefinition.prototype,"normalTexture",void 0);
a.__decorate([d.property({type:b.I3SMaterialTexture})],b.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);a.__decorate([d.property({type:b.I3SMaterialTexture})],b.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);a.__decorate([d.property({type:[Number]})],b.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);a.__decorate([d.property({type:b.I3SMaterialPBRMetallicRoughness})],b.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);b.I3SMaterialDefinition=a.__decorate([e.subclass("esri.layer.support.I3SMaterialDefinition")],
b.I3SMaterialDefinition);b.I3STextureFormat=function(w){function q(){return w.apply(this,arguments)||this}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([d.property({type:String,json:{read:{source:["name","index"],reader:(w,q)=>null!=w?w:`${q.index}`}}})],b.I3STextureFormat.prototype,"name",void 0);a.__decorate([c.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2"})],b.I3STextureFormat.prototype,"format",void 0);b.I3STextureFormat=a.__decorate([e.subclass("esri.layer.support.I3STextureFormat")],
b.I3STextureFormat);b.I3STextureSetDefinition=function(w){function q(){var m=w.apply(this,arguments)||this;m.atlas=!1;return m}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([d.property({type:[b.I3STextureFormat]})],b.I3STextureSetDefinition.prototype,"formats",void 0);a.__decorate([d.property({type:Boolean})],b.I3STextureSetDefinition.prototype,"atlas",void 0);b.I3STextureSetDefinition=a.__decorate([e.subclass("esri.layer.support.I3STextureSetDefinition")],b.I3STextureSetDefinition);
b.I3SGeometryAttribute=function(w){function q(){return w.apply(this,arguments)||this}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([c.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],b.I3SGeometryAttribute.prototype,"type",void 0);a.__decorate([d.property({type:Number})],b.I3SGeometryAttribute.prototype,"component",void 0);b.I3SGeometryAttribute=a.__decorate([e.subclass("esri.layer.support.I3SGeometryAttribute")],b.I3SGeometryAttribute);
b.I3SGeometryCompressedAttributes=function(w){function q(){return w.apply(this,arguments)||this}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([c.enumeration({draco:"draco"})],b.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);a.__decorate([d.property({type:[String]})],b.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);b.I3SGeometryCompressedAttributes=a.__decorate([e.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],b.I3SGeometryCompressedAttributes);
b.I3SGeometryBuffer=function(w){function q(){var m=w.apply(this,arguments)||this;m.offset=0;return m}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([d.property({type:Number})],b.I3SGeometryBuffer.prototype,"offset",void 0);a.__decorate([d.property({type:b.I3SGeometryAttribute})],b.I3SGeometryBuffer.prototype,"position",void 0);a.__decorate([d.property({type:b.I3SGeometryAttribute})],b.I3SGeometryBuffer.prototype,"normal",void 0);a.__decorate([d.property({type:b.I3SGeometryAttribute})],
b.I3SGeometryBuffer.prototype,"uv0",void 0);a.__decorate([d.property({type:b.I3SGeometryAttribute})],b.I3SGeometryBuffer.prototype,"color",void 0);a.__decorate([d.property({type:b.I3SGeometryAttribute})],b.I3SGeometryBuffer.prototype,"uvRegion",void 0);a.__decorate([d.property({type:b.I3SGeometryAttribute})],b.I3SGeometryBuffer.prototype,"featureId",void 0);a.__decorate([d.property({type:b.I3SGeometryAttribute})],b.I3SGeometryBuffer.prototype,"faceRange",void 0);a.__decorate([d.property({type:b.I3SGeometryCompressedAttributes})],
b.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);b.I3SGeometryBuffer=a.__decorate([e.subclass("esri.layer.support.I3SGeometryBuffer")],b.I3SGeometryBuffer);b.I3SGeometryDefinition=function(w){function q(){return w.apply(this,arguments)||this}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([c.enumeration({triangle:"triangle"})],b.I3SGeometryDefinition.prototype,"topology",void 0);a.__decorate([d.property()],b.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);b.I3SGeometryDefinition=
a.__decorate([e.subclass("esri.layer.support.I3SGeometryDefinition")],b.I3SGeometryDefinition);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/mixins/SceneService":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../geometry/SpatialReference ../../geometry/Extent ../../request ../../portal/Portal ../../portal/PortalItem ../../core/accessorSupport/originUtils ../support/arcgisLayerUrl ../../geometry/HeightModelInfo ../../webdoc/support/saveUtils ../support/commonProperties".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G){const H=d.getLogger("esri.layers.mixins.SceneService"),I={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};k.SCENE_SERVICE_ITEM_TYPE="Scene Service";k.SceneService=J=>{J=function(K){function L(){var M=K.apply(this,arguments)||this;M.spatialReference=null;M.fullExtent=null;M.heightModelInfo=null;M.minScale=0;M.maxScale=0;M.version={major:Number.NaN,minor:Number.NaN,
versionString:""};M.copyright=null;M.sublayerTitleMode="item-title";M.title=null;M.layerId=null;M._debouncedSaveOperations=v.debounce(async(T,O,Q)=>{switch(T){case 0:return M._save(O);case 1:return M._saveAs(Q,O)}});return M}a._inheritsLoose(L,K);var S=L.prototype;S.readSpatialReference=function(M,T){return this._readSpatialReference(T)};S._readSpatialReference=function(M){if(null!=M.spatialReference)return y.fromJSON(M.spatialReference);M=M.store;M=(M=M.indexCRS||M.geographicCRS)&&parseInt(M.substring(M.lastIndexOf("/")+
1,M.length),10);return null!=M?new y(M):null};S.readFullExtent=function(M,T){M=T.store;T=this._readSpatialReference(T);return null==T||null==M||null==M.extent||!Array.isArray(M.extent)||M.extent.some(O=>-1E38>O)?null:new B({xmin:M.extent[0],ymin:M.extent[1],xmax:M.extent[2],ymax:M.extent[3],spatialReference:T})};S.readVersion=function(M,T){M=T.store;T=null!=M.version?M.version.toString():"";M={major:Number.NaN,minor:Number.NaN,versionString:T};T=T.split(".");2<=T.length&&(M.major=parseInt(T[0],10),
M.minor=parseInt(T[1],10));return M};S.readTitlePortalItem=function(M){return"item-title"!==this.sublayerTitleMode?void 0:M};S.readTitleService=function(M,T){M=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return t.titleFromUrlAndName(this.url,T.name);T=T.name;if(!T&&this.url){const O=t.parse(this.url);h.isSome(O)&&(T=O.title)}"item-title-and-service-name"===this.sublayerTitleMode&&M&&(T=M+" - "+T);return t.cleanTitle(T)};S.writeUrl=function(M,T,O,Q){t.writeUrlWithLayerId(this,
M,"layers",T,Q)};S._verifyRootNodeAndUpdateExtent=async function(M,T){if(M)try{return this._updateExtentFromRootPage(M,await this._fetchRootPage(M,T))}catch(O){}return this._updateExtentFromRootNode(await this._fetchRootNode(T))};S._fetchRootPage=async function(M,T){return M?(await x(`${this.parsedUrl.path}/nodepages/${Math.floor(M.rootIndex/M.nodesPerPage)}`,{responseType:"json",signal:T})).data:v.reject()};S._updateExtentFromRootPage=function(M,T){if(null==T||null==T.nodes)throw new w("sceneservice:invalid-node-page",
"Inavlid node page.");T=T.nodes[M.rootIndex%M.nodesPerPage];if(null==T||null==T.obb||null==T.obb.center||null==T.obb.halfSize)throw new w("sceneservice:invalid-node-page","Inavlid node page.");-1E38>T.obb.center[0]||(M=T.obb.halfSize,T=T.obb.center[2],M=Math.sqrt(M[0]*M[0]+M[1]*M[1]+M[2]*M[2]),this.fullExtent.zmin=T-M,this.fullExtent.zmax=T+M)};S._updateExtentFromRootNode=function(M){if(null!=M&&null!=this.fullExtent&&!this.fullExtent.hasZ&&Array.isArray(M.mbs)&&4===M.mbs.length&&!(-1E38>M.mbs[0])){var T=
M.mbs[2];M=M.mbs[3];this.fullExtent.zmin=T-M;this.fullExtent.zmax=T+M}};S._fetchRootNode=async function(M){if(this.rootNode){var T=q.join(this.parsedUrl.path,this.rootNode);try{return(await x(T,{query:{f:"json"},responseType:"json",signal:M})).data}catch(O){throw new w("sceneservice:root-node-missing","Root node missing.",{error:O,url:T});}}};S._fetchService=async function(M){if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const T=await this._fetchFirstLayerId(M);null!=T&&(this.layerId=
T)}return this._fetchServiceLayer(M)};S._fetchFirstLayerId=async function(M){M=await x(this.url,{query:{f:"json"},responseType:"json",signal:M});if(M.data&&Array.isArray(M.data.layers)&&0<M.data.layers.length)return M.data.layers[0].id};S._fetchServiceLayer=async function(M){M=await x(this.parsedUrl.path,{query:{f:"json"},responseType:"json",signal:M});M.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));M=M.data;this.read(M,{origin:"service",url:this.parsedUrl});this.validateLayer(M)};S._ensureLoadBeforeSave=
async function(){await this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&await this.beforeSave()};S.validateLayer=function(M){};S._updateTypeKeywords=function(M,T,O){M.typeKeywords||(M.typeKeywords=[]);T=T.getTypeKeywords();for(const Q of T)M.typeKeywords.push(Q);M.typeKeywords&&(M.typeKeywords=M.typeKeywords.filter((Q,F,N)=>N.indexOf(Q)===F),1===O&&(M.typeKeywords=M.typeKeywords.filter(Q=>"Hosted Service"!==Q)))};S._saveAs=async function(M,T){T={...I,...T};M=z.from(M);M||(H.error("_saveAs(): requires a portal item parameter"),
await v.reject(new w("sceneservice:portal-item-required","_saveAs() requires a portal item to save to")));M.id&&(M=M.clone(),M.id=null);const O=M.portal||C.getDefault();await this._ensureLoadBeforeSave();M.type="Scene Service";M.portal=O;const Q={origin:"portal-item",url:null,messages:[],portal:O,portalItem:M,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},F={layers:[this.write(null,Q)]};await v.all(Q.resources.pendingOperations);await this._validateAgainstJSONSchema(F,
Q,T);M.url=this.url;M.title||(M.title=this.title);this._updateTypeKeywords(M,T,1);await O._signIn();await O.user.addItem({item:M,folder:T&&T.folder,data:F});await E.saveResources(this.resourceReferences,Q,null);this.portalItem=M;A.updateOrigins(Q);return Q.portalItem=M};S._save=async function(M){M={...I,...M};this.portalItem||(H.error("_save(): requires the .portalItem property to be set"),await v.reject(new w("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService")));
"Scene Service"!==this.portalItem.type&&(H.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+", expected Scene Service"),await v.reject(new w("sceneservice:portal-item-wrong-type",'Portal item needs to have type "Scene Service"')));await this._ensureLoadBeforeSave();const T={origin:"portal-item",url:this.portalItem.itemUrl&&q.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||C.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],
resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},O={layers:[this.write(null,T)]};await v.all(T.resources.pendingOperations);await this._validateAgainstJSONSchema(O,T,M);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,M,0);await this.portalItem.update({data:O});await E.saveResources(this.resourceReferences,T,null);A.updateOrigins(T);return this.portalItem};S._validateAgainstJSONSchema=async function(M,T,
O){T=T.messages.filter(Q=>"error"===Q.type).map(Q=>new w(Q.name,Q.message,Q.details));O&&O.validationOptions.ignoreUnsupported&&(T=T.filter(Q=>"layer:unsupported"!==Q.name&&"symbol:unsupported"!==Q.name&&"symbol-layer:unsupported"!==Q.name&&"property:unsupported"!==Q.name&&"url:unsupported"!==Q.name&&"scenemodification:unsupported"!==Q.name));if(O.validationOptions.enabled&&(M=(await new Promise(function(Q,F){b(["../support/schemaValidator"],Q,F)})).validate(M,O.portalItemLayerType),0<M.length)){const Q=
`Layer item did not validate:\n${M.join("\n")}`;H.error(`_validateAgainstJSONSchema(): ${Q}`);if("throw"===O.validationOptions.failPolicy)throw O=M.map(F=>new w("sceneservice:schema-validation",F)).concat(T),new w("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:O});}if(0<T.length)throw new w("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:T});};a._createClass(L,[{key:"url",set:function(M){M=t.sanitizeUrlWithLayerId(this,M,H);this._set("url",M.url);null!=M.layerId&&this._set("layerId",M.layerId)}},{key:"parsedUrl",get:function(){var M=this._get("url");if(!M)return null;M=q.urlToObject(M);null!=this.layerId&&t.isArcGISUrl(M.path)&&(M.path=`${M.path}/layers/${this.layerId}`);return M}}]);return L}(J);r.__decorate([e.property({json:{origins:{service:{read:!1},"portal-item":{read:!1}}}})],J.prototype,"id",void 0);r.__decorate([e.property({type:y})],
J.prototype,"spatialReference",void 0);r.__decorate([g.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],J.prototype,"readSpatialReference",null);r.__decorate([e.property({type:B})],J.prototype,"fullExtent",void 0);r.__decorate([g.reader("fullExtent",["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],J.prototype,"readFullExtent",null);r.__decorate([e.property({readOnly:!0,type:D})],J.prototype,"heightModelInfo",void 0);r.__decorate([e.property({type:Number,
json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],J.prototype,"minScale",void 0);r.__decorate([e.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],J.prototype,"maxScale",void 0);r.__decorate([e.property({readOnly:!0})],J.prototype,"version",void 0);r.__decorate([g.reader("version",["store.version"])],J.prototype,"readVersion",null);r.__decorate([e.property({type:String,
json:{read:{source:"copyrightText"}}})],J.prototype,"copyright",void 0);r.__decorate([e.property({type:String,json:{read:!1}})],J.prototype,"sublayerTitleMode",void 0);r.__decorate([e.property({type:String})],J.prototype,"title",void 0);r.__decorate([g.reader("portal-item","title")],J.prototype,"readTitlePortalItem",null);r.__decorate([g.reader("service","title",["name"])],J.prototype,"readTitleService",null);r.__decorate([e.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",
isRequired:!0,ignoreOrigin:!0},read:!1}}}})],J.prototype,"layerId",void 0);r.__decorate([e.property(G.url)],J.prototype,"url",null);r.__decorate([n.writer("url")],J.prototype,"writeUrl",null);r.__decorate([e.property({dependsOn:["layerId"]})],J.prototype,"parsedUrl",null);r.__decorate([e.property({readOnly:!0})],J.prototype,"store",void 0);r.__decorate([e.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],J.prototype,"rootNode",void 0);return J=r.__decorate([p.subclass("esri.layers.mixins.SceneService")],
J)};Object.defineProperty(k,"__esModule",{value:!0})})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(b,k){b.updateOrigins=function(a){a&&a.writtenProperties&&a.writtenProperties.forEach(r=>{const l=r.target;r.newOrigin&&r.oldOrigin!==r.newOrigin&&k.isMultiOriginJSONMixin(l)&&l.updateOrigin(r.propName,r.newOrigin)})};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],
function(b){b.isMultiOriginJSONMixin=function(k){return k&&"getAtOrigin"in k&&"originOf"in k};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../core/Error ../../core/uuid ../../core/promiseUtils ../../core/asyncUtils ../../portal/support/resourceUtils".split(" "),function(b,k,a,r,l,h){async function d(e,f){f=await l.result(e.resource.portalItem.addResource(e.resource,e.content,f));if(!0===f.ok)e.finish&&e.finish(e.resource);else throw e.error&&
e.error(f.error),f.error;}async function c(e,f){f=await l.result(e.resource.update(e.content,f));if(!0===f.ok)e.finish(e.resource);else throw e.error(f.error),f.error;}b.saveResources=async function(e,f,g){if(f&&f.resources){var p=f.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0;e.portalItem=f.portalItem;var n=new Set(f.resources.toKeep.map(m=>m.resource.path)),w=new Set,q=[];n.forEach(m=>{p.delete(m);e.paths.push(m)});for(const m of f.resources.toUpdate)if(p.delete(m.resource.path),
n.has(m.resource.path)||w.has(m.resource.path)){const {resource:u,content:v,finish:y,error:B}=m,x=h.getSiblingOfSameTypeI(u,a.generateUUID());e.paths.push(x.path);q.push(d({resource:x,content:v,finish:y,error:B},g))}else e.paths.push(m.resource.path),q.push(c(m,g)),w.add(m.resource.path);for(const m of f.resources.toAdd)q.push(d(m,g)),e.paths.push(m.resource.path);p.forEach(m=>{m=f.portalItem.resourceFromPath(m);q.push(m.portalItem.removeResource(m).catch(()=>{}))});if(0!==q.length&&(n=await r.eachAlways(q),
r.throwIfAborted(g),g=n.filter(m=>"error"in m).map(m=>m.error),0<g.length))throw new k("save:resources","Failed to save one or more resources",{errors:g});}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/portal/support/resourceUtils":function(){define(["exports","../../core/maybe","../../core/Error","../../core/urlUtils","../../request"],function(b,k,a,r,l){function h(e){const f=e.lastIndexOf("/");return-1===f?[".",e]:[e.slice(0,f),e.slice(f+1)]}function d(e){{const w=r.getPathExtension(e);
e=k.isNone(w)?[e,""]:[e.slice(0,e.length-w.length-1),`.${w}`]}const [f,g]=e,[p,n]=h(f);return[p,n,g]}async function c(e){return e instanceof Blob?e:(await l(e.url,{responseType:"blob"})).data}b.addOrUpdateResource=async function(e,f,g,p){if(!e.hasPath())throw new a(`portal-item-resource-${f}:invalid-path`,"Resource does not have a valid path");await e.portalItem.load(p);f=r.join(e.portalItem.userItemUrl,"add"===f?"addResources":"updateResources");const [n,w]=h(e.path);g=await c(g);const q=new FormData;
n&&"."!==n&&q.append("resourcesPrefix",n);q.append("fileName",w);q.append("file",g,w);q.append("f","json");k.isSome(p)&&p.access&&q.append("access",p.access);await e.portalItem.portal._request(f,{method:"post",body:q,signal:k.get(p,"signal")});return e};b.contentToBlob=c;b.fetchResources=async function(e,f={},g){await e.load(g);var p=r.join(e.itemUrl,"resources");const {start:n=1,num:w=10,sortOrder:q="asc",sortField:m="created"}=f;f={query:{start:n,num:w,sortOrder:q,sortField:m},signal:k.get(g,"signal")};
p=await e.portal._request(p,f);return{total:p.total,nextStart:p.nextStart,resources:p.resources.map(({created:u,size:v,resource:y})=>({created:new Date(u),size:v,resource:e.resourceFromPath(y)}))}};b.getSiblingOfSameType=function(e,f){if(!e.hasPath())return null;const [g,,p]=d(e.path);return e.portalItem.resourceFromPath(r.join(g,f+p))};b.getSiblingOfSameTypeI=function(e,f){if(!e.hasPath())return null;const [g,,p]=d(e.path);return e.portalItem.resourceFromPath(r.join(g,f+p))};b.removeAllResources=
async function(e,f){await e.load(f);const g=r.join(e.userItemUrl,"removeResources");return e.portal._request(g,{method:"post",query:{deleteAll:!0},signal:k.get(f,"signal")})};b.removeResource=async function(e,f,g){if(!f.hasPath())throw new a("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await e.load(g);const p=r.join(e.userItemUrl,"removeResources");await e.portal._request(p,{method:"post",query:{resource:f.path},signal:k.get(g,"signal")});f.portalItem=null};b.splitPrefixFileNameAndExtension=
d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("exports ../../core/maybe ../../core/promiseUtils ../../kernel ../../request ../../portal/Portal ../../portal/PortalItem ../FeatureLayer".split(" "),function(b,k,a,r,l,h,d,c){let e=function(){function f(p,n,w){this.parsedUrl=p;this.portalItem=n;this.signal=w;this.rootDocument=null;if(p=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this.urlParts={root:p[1],
layerId:parseInt(p[2],10)}}var g=f.prototype;g.fetch=async function(){var p;if(!this.urlParts)return null;const n=null!=(p=this.portalItem)?p:await this.portalItemFromServiceItemId();if(k.isNone(n))return this.loadFromUrl();p=await this.findAndLoadRelatedPortalItem(n);return k.isNone(p)?null:this.loadFeatureLayerFromPortalItem(p)};g.fetchPortalItem=async function(){var p;if(!this.urlParts)return null;const n=null!=(p=this.portalItem)?p:await this.portalItemFromServiceItemId();return k.isNone(n)?null:
this.findAndLoadRelatedPortalItem(n)};g.fetchRootDocument=async function(){if(k.isSome(this.rootDocument))return this.rootDocument;if(k.isNone(this.urlParts))return this.rootDocument={},{};const p={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},n=`${this.urlParts.root}/SceneServer`;try{this.rootDocument=(await l(n,p)).data}catch{this.rootDocument={}}return this.rootDocument};g.fetchServiceOwningPortalUrl=async function(){var p;const n=null==(p=r.id)?void 0:p.findServerInfo(this.parsedUrl.path);
if(null!=n&&n.owningSystemUrl)return n.owningSystemUrl;p=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const w=(await l(p,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(w)return w}catch(w){a.throwIfAbortError(w)}return null};g.findAndLoadRelatedPortalItem=async function(p){try{return(await p.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(n=>"Feature Service"===n.type)||null}catch(n){return a.throwIfAbortError(n),
null}};g.loadFeatureLayerFromPortalItem=async function(p){await p.load({signal:this.signal});const n=await this.findMatchingAssociatedSublayerUrl(p.url);return(new c({url:n,portalItem:p})).load({signal:this.signal})};g.loadFromUrl=async function(){const p=await this.findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);return(new c({url:p})).load({signal:this.signal})};g.findMatchingAssociatedSublayerUrl=async function(p){p=p.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");var n=
{query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};const w=this.urlParts.layerId;var q=this.fetchRootDocument();n=l(p,n);const [m,u]=await a.all([n,q]);q=u&&u.layers;n=m.data&&m.data.layers;if(!Array.isArray(n))throw Error("expected layers array");if(!Array.isArray(q)){if(w<n.length)return`${p}/${n[w].id}`}else for(let v=0;v<Math.min(q.length,n.length);v++)if(q[v].id===w)return`${p}/${n[v].id}`;throw Error("could not find matching associated sublayer");};g.portalItemFromServiceItemId=
async function(){var p=(await this.fetchRootDocument()).serviceItemId;if(!p)return null;p=new d({id:p});const n=await this.fetchServiceOwningPortalUrl();k.isSome(n)&&(p.portal=new h({url:n}));try{return p.load({signal:this.signal})}catch(w){return a.throwIfAbortError(w),null}};return f}();b.FetchAssociatedFeatureLayer=e;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/JSONSupport".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){b.RangeInfo=function(w){function q(){var m=w.apply(this,arguments)||this;m.name=null;m.field=null;m.currentRangeExtent=null;m.fullRangeExtent=null;m.type="rangeInfo";return m}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([d.property({type:String,json:{read:!0,write:!0}})],b.RangeInfo.prototype,"name",void 0);a.__decorate([d.property({type:String,json:{read:!0,write:!0}})],b.RangeInfo.prototype,"field",void 0);a.__decorate([d.property({type:[Number],
json:{read:!0,write:!0}})],b.RangeInfo.prototype,"currentRangeExtent",void 0);a.__decorate([d.property({type:[Number],json:{read:!0,write:!0}})],b.RangeInfo.prototype,"fullRangeExtent",void 0);a.__decorate([d.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],b.RangeInfo.prototype,"type",void 0);b.RangeInfo=a.__decorate([e.subclass("esri.layers.support.RangeInfo")],b.RangeInfo);b.default=b.RangeInfo;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./FeatureLayerViewBase3D".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p){a=function(n){function w(){return n.apply(this,arguments)||this}b._inheritsLoose(w,n);return w}(p);k.__decorate([h.property()],a.prototype,"layer",void 0);return a=k.__decorate([c.subclass("esri.views.3d.layers.FeatureLayerView3D")],a)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/compilerUtils ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/watchUtils ../../layers/RefreshableLayerView ../../../layers/graphics/hydratedFeatures ./LayerView3D ./support/layerViewUpdatingProperties ../../layers/LayerView ../../layers/FeatureLayerView ../../../layers/graphics/controllers/FeatureTileController3D ../support/EventedSet ./FeatureLikeLayerView3D ./support/FeatureTileFetcher3DLayerViewContext".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D){a=function(G){function H(J){J=G.call(this,J)||this;J._controllerTotal=0;J._graphicsCoreTotal=0;J.suspendResumeExtentMode="data";return J}b._inheritsLoose(H,G);var I=H.prototype;I.destroy=function(){this.fetcherContext&&(this.fetcherContext.destroy(),this.fetcherContext=null)};I.fetchPopupFeatures=async function(J,K){return(J=this.validateFetchPopupFeatures(K))?q.reject(J):this.fetchClientPopupFeatures(K)};I.setVisibility=function(J,K){this.graphics3d&&
this.graphics3d.graphicsCore.setObjectIdVisibility(J,K)};I.createQuery=function(){return G.prototype.createQuery.call(this)};I.queryFeatures=function(J,K){const L=()=>G.prototype.queryFeatures.call(this,J,K);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(J),L):L()};I.beforeSetController=function(J){J.maximumNumberOfFeatures=this.maximumNumberOfFeatures};I.createController=function(){this.fetcherContext=new D.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,
returnM:this.hasM});const J=new z({layerView:this,context:this.fetcherContext,graphics:new A.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(J,"serviceDataExtent",K=>{this.graphics3d&&(this.graphics3d.dataExtent=K)},2);this.handles.add(m.init(this,"suspended",K=>{K?J.suspend():J.resume()},!0));this.updatingHandles.add(this.graphics3d.graphicsCore,"displayFeatureLimit",()=>this.updateDisplayFeatureLimit(J),2);this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",
()=>this.updateDisplayFeatureLimit()));return J};I.doRefresh=async function(){!this.suspended&&this.controller&&this.controller.refetch()};I.getUsedMemory=function(){const J=this.graphics3d&&this.graphics3d.graphicsCore;return(J?J.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)};I.getUnloadedMemory=function(){const J=this.graphics3d&&this.graphics3d.graphicsCore;return(J?J.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*J.usedMemoryPerGraphic:
0)};I.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride};I.updateDisplayFeatureLimit=function(J=this.controller){if(J&&this.graphics3d&&this.graphics3d.graphicsCore){var K=this.graphics3d.graphicsCore.displayFeatureLimit,L=this.view.resourceController.memoryController.memoryFactor;J.displayFeatureLimit=1===L?K:{...K,maximumNumberOfFeatures:Math.ceil(K.maximumNumberOfFeatures*L),maximumTotalNumberOfFeatures:Math.ceil(K.maximumTotalNumberOfFeatures*
L),minimumTotalNumberOfFeatures:Math.ceil(K.minimumTotalNumberOfFeatures*L)}}};I._queryFeaturesMesh=async function(J,K){await this._validateQueryFeaturesMesh(J);K=await K();if(J&&J.outStatistics)return K;J=this.layer.objectIdField;const L=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID,S=[];for(const M of K.features)if(M.geometry){const T=L.get(M.attributes[J]);T&&(M.geometry=v.hydrateGeometry(T.graphic.geometry),S.push(M))}else S.push(M);K.features=S;return K};I._validateQueryFeaturesMesh=
async function(J){if(J){var K=S=>{throw new g("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${S}'`);},L=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const S of L)null!=J[S]&&K(S);"returnM"in J&&J.returnM&&K("returnM");"returnCentroid"in J&&J.returnCentroid&&K("returnCentroid");l.isSome(J.outSpatialReference)&&!J.outSpatialReference.equals(this.view.spatialReference)&&K("outSpatialReference")}};b._createClass(H,[{key:"updatingProgressValue",
get:function(){let J=1;if(this.controller&&this.controller.updating){var K=this.controller.updatingRemaining,L=this.controller.updatingTotal;0<L&&(this._controllerTotal=Math.max(L,this._controllerTotal),J=(L-K)/L)}K=1;if(this.graphics3d&&this.graphics3d.graphicsCore){L=this.graphics3d.graphicsCore.updatingRemaining;const S=this.graphics3d.graphicsCore.updatingTotal;0<S&&(this._graphicsCoreTotal=Math.max(S,this._graphicsCoreTotal),K=(S-L)/S)}1===J&&1===K&&(this._graphicsCoreTotal=this._controllerTotal=
0);return.5*(J+K)}},{key:"maximumNumberOfFeatures",get:function(){var J,K;return null!=(J=null==(K=this.controller)?void 0:K.maximumNumberOfFeatures)?J:this._get("maximumNumberOfFeatures")},set:function(J){this._set("maximumNumberOfFeatures",J);this.controller&&(this.controller.maximumNumberOfFeatures=J)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1}},{key:"asyncGraphicsUpdates",get:function(){if(this.controller)switch(this.controller.mode){case "snapshot":{const J=
E[this.layer.geometryType];return null==J||this.controller.serviceDataCount>J}case "tiles":break;default:r.neverReached(this.controller.mode)}return!0}},{key:"hasZ",get:function(){const J=this.layer,K=J.capabilities&&J.capabilities.data;return K&&K.supportsZ?"returnZ"in J&&null!=J.returnZ?J.returnZ:K.supportsZ:!1}},{key:"hasM",get:function(){const J=this.layer,K=J.capabilities&&J.capabilities.data;return K&&K.supportsM?"returnM"in J&&null!=J.returnM?J.returnM:!1:!1}},{key:"performanceInfo",get:function(){var J=
this.controller&&this.controller.displayFeatureLimit;J=l.isSome(J)&&J.averageSymbolComplexity;J=l.isSome(J)?`f:${J.primitivesPerFeature},v:${J.primitivesPerCoordinate}`:"n/a";J={...this._getResourceInfo(),storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?this.controller.mode:"n/a",symbolComplexity:J,nodes:this.controller?this.controller.tileDescriptors.length:0};if(this.controller&&J.displayedNumberOfFeatures){const K=this.controller.debug;J.storedFeatures=
K.storedFeatures;J.totalVertices=K.totalVertices}return J}}]);return H}(u.RefreshableLayerView(t.FeatureLikeLayerView3D(C.FeatureLayerView(y.LayerView3D(x)))));k.__decorate([c.property()],a.prototype,"layer",void 0);k.__decorate([c.property()],a.prototype,"controller",void 0);k.__decorate([c.property({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"],autoTracked:!1})],a.prototype,"updatingProgressValue",
null);k.__decorate([c.property({dependsOn:["controller.maximumNumberOfFeatures"]})],a.prototype,"maximumNumberOfFeatures",null);k.__decorate([c.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],a.prototype,"maximumNumberOfFeaturesExceeded",null);k.__decorate([c.property(B.updatingProgress)],a.prototype,"updatingProgress",void 0);k.__decorate([c.property({readOnly:!0,dependsOn:["controller.mode","layer.geometryType","controller.serviceDataCount"]})],a.prototype,"asyncGraphicsUpdates",
null);k.__decorate([c.property({readOnly:!0})],a.prototype,"hasZ",null);k.__decorate([c.property({readOnly:!0})],a.prototype,"hasM",null);k.__decorate([c.property()],a.prototype,"suspendResumeExtentMode",void 0);a=k.__decorate([f.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],a);const E={point:5E3,polygon:500,polyline:1E3};return a})},"esri/views/layers/FeatureLayerView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../support/arcadeOnDemand ../../layers/support/fieldUtils ../../core/watchUtils ../../layers/support/commonProperties ../../tasks/support/Query ./support/FeatureFilter ./support/FeatureEffect ./support/popupUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z){const A=h.getLogger("esri.views.layers.FeatureLayerView");b.FeatureLayerView=t=>{t=function(D){function E(...H){H=D.call(this,...H)||this;H._updatingRequiredFieldsPromise=null;H.effect=null;H.filter=null;H.timeExtent=null;H.layer=null;H.requiredFields=[];H.view=null;return H}k._inheritsLoose(E,D);var G=E.prototype;G.initialize=function(){v.init(this,"layer.renderer layer.labelingInfo layer.elevationInfo.featureExpressionInfo layer.displayField filter effect layer.timeInfo timeExtent".split(" "),
()=>this._handleRequiredFieldsChange(),!0)};G.highlight=function(H){throw Error("missing implementation");};G.createQuery=function(){var H={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};H=l.isSome(this.filter)?this.filter.createQuery(H):new B(H);l.isSome(this.timeExtent)&&(H.timeExtent=l.isSome(H.timeExtent)?H.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return H};G.queryFeatures=function(H,I){throw Error("missing implementation");};G.queryObjectIds=
function(H,I){throw Error("missing implementation");};G.queryFeatureCount=function(H,I){throw Error("missing implementation");};G.queryExtent=function(H,I){throw Error("missing implementation");};G._loadArcadeModules=function(H){if(H.get("expressionInfos.length"))return m.loadArcade()};G._handleRequiredFieldsChange=function(){const H=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",H);H.then(()=>{this._updatingRequiredFieldsPromise===H&&this._set("_updatingRequiredFieldsPromise",
null)})};G._updateRequiredFields=async function(){if(this.layer&&this.view){var H="3d"===this.view.type,{layer:I,layer:{fields:J,objectIdField:K,renderer:L,displayField:S}}=this,M=I.featureReduction,T=new Set;M=await q.eachAlways([L?L.collectRequiredFields(T,J):null,u.collectLabelingFields(T,I),H?u.collectElevationFields(T,I):null,l.isSome(this.filter)?u.collectFilterFields(T,I,this.filter):null,this.effect?u.collectFilterFields(T,I,this.effect.filter):null,M?u.collectFeatureReductionFields(T,I,M):
null]);I.timeInfo&&this.timeExtent&&u.collectFields(T,I.fields,[I.timeInfo.startField,I.timeInfo.endField]);for(const O of M)O.error&&A.error(O.error);u.collectField(T,J,K);H&&S&&u.collectField(T,J,S);H=Array.from(T).sort();this._set("requiredFields",H)}};G.validateFetchPopupFeatures=function(H){const {layer:I,layer:{popupEnabled:J}}=this;if(!J)return new g("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:I});if(!z.getFetchPopupTemplate(this.layer,H))return new g("featurelayerview:fetchPopupFeatures",
"Layer does not define a popup template",{layer:I})};G.fetchClientPopupFeatures=async function(H){const I=l.isSome(H)?H.clientGraphics:null;if(!I||0===I.length)return q.resolve([]);const J=[],K=[],{layer:L}=this;var S=z.getFetchPopupTemplate(L,H);if(!l.isSome(S))return q.resolve([]);var M=await this._loadArcadeModules(S);S=M&&M.arcadeUtils.hasGeometryOperations(S);H=await this.createPopupQuery(H);M=u.unpackFieldNames(L.fields,H.outFields);for(const T of I)S||!u.featureHasFields(M,T)?K.push(T):J.push(T);
if("stream"===L.type||0===K.length)return q.resolve(J);H.objectIds=K.map(T=>T.attributes[L.objectIdField]);return L.queryFeatures(H).then(T=>J.concat(T.features)).catch(()=>K)};G.createPopupQuery=async function(H){var I=this.layer;const J=I.createQuery();H=z.getFetchPopupTemplate(I,H);var K=l.isSome(H)&&await this._loadArcadeModules(H);K=l.isSome(H)&&K&&K.arcadeUtils.hasGeometryOperations(H);I=!("point"!==I.geometryType&&!K);J.returnGeometry=I;J.returnZ=I;J.returnM=I;J.outFields=await z.getRequiredFields(this.layer,
H);J.outSpatialReference=this.view.spatialReference;return J};G.canResume=function(){return!D.prototype.canResume.call(this)||l.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};k._createClass(E,[{key:"availableFields",get:function(){const {layer:H,layer:{fields:I},requiredFields:J}=this;return"outFields"in H&&H.outFields?u.fixFields(I,[...u.unpackFieldNames(I,H.outFields),...J]):u.fixFields(I,J)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(H){A.error("#maximumNumberOfFeatures\x3d",
"Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return E}(t);a.__decorate([c.property()],t.prototype,"_updatingRequiredFieldsPromise",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["layer.outFields?","requiredFields"]})],t.prototype,"availableFields",null);a.__decorate([c.property({type:C})],t.prototype,"effect",void 0);a.__decorate([c.property({type:x})],t.prototype,"filter",void 0);a.__decorate([c.property(y.combinedViewLayerTimeExtentProperty)],
t.prototype,"timeExtent",void 0);a.__decorate([c.property()],t.prototype,"layer",void 0);a.__decorate([c.property({type:Number})],t.prototype,"maximumNumberOfFeatures",null);a.__decorate([c.property({readOnly:!0,type:Boolean})],t.prototype,"maximumNumberOfFeaturesExceeded",null);a.__decorate([c.property({readOnly:!0})],t.prototype,"requiredFields",void 0);a.__decorate([c.property({dependsOn:["timeExtent"]})],t.prototype,"suspended",void 0);a.__decorate([c.property()],t.prototype,"view",void 0);return t=
a.__decorate([f.subclass("esri.views.layers.FeatureLayerView")],t)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/layers/support/FeatureFilter":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/decorators/writer ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ../../../geometry/support/jsonUtils ../../../geometry ../../../TimeExtent ../../../tasks/support/Query".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){var y;a=new c.JSONMap({esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"envelope-intersects",esriSpatialRelIndexIntersects:"index-intersects",esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:"relation"});c=new c.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",
esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"});w=y=function(B){function x(z){z=B.call(this,z)||this;z.where=null;z.geometry=null;z.spatialRelationship="intersects";z.hiddenIds=new Set;z.distance=void 0;z.objectIds=null;z.units=null;z.timeExtent=null;z.enabled=!1;return z}b._inheritsLoose(x,B);var C=x.prototype;C.writeWhere=function(z,A){A.where=z||"1\x3d1"};C.enable=function(){this._set("enabled",!0)};
C.createQuery=function(z={}){const {where:A,geometry:t,spatialRelationship:D,timeExtent:E,objectIds:G,units:H,distance:I}=this;return new v({geometry:r.clone(t),objectIds:r.clone(G),spatialRelationship:D,timeExtent:r.clone(E),where:A,units:H,distance:I,...z})};C.clone=function(){const {where:z,geometry:A,spatialRelationship:t,hiddenIds:D,timeExtent:E,objectIds:G,units:H,distance:I}=this,J=new Set;D.forEach(K=>J.add(K));return new y({geometry:r.clone(A),hiddenIds:J,objectIds:r.clone(G),spatialRelationship:t,
timeExtent:r.clone(E),where:z,units:H,distance:I})};return x}(w.JSONSupport);k.__decorate([d.property({type:String})],w.prototype,"where",void 0);k.__decorate([f.writer("where")],w.prototype,"writeWhere",null);k.__decorate([d.property({types:m.geometryTypes,json:{read:q.fromJSON,write:!0}})],w.prototype,"geometry",void 0);k.__decorate([d.property({type:String,json:{read:{source:"spatialRel",reader:a.read},write:{target:"spatialRel",writer:a.write}}})],w.prototype,"spatialRelationship",void 0);k.__decorate([d.property({json:{write:(B,
x,C)=>x[C]=Array.from(B),read:B=>new Set(B)}})],w.prototype,"hiddenIds",void 0);k.__decorate([d.property({type:Number,json:{write:{overridePolicy(B){return{enabled:0<B}}}}})],w.prototype,"distance",void 0);k.__decorate([d.property({type:[Number],json:{write:!0}})],w.prototype,"objectIds",void 0);k.__decorate([d.property({type:String,json:{read:c.read,write:{writer:c.write,overridePolicy(B){return{enabled:B&&0<this.distance}}}}})],w.prototype,"units",void 0);k.__decorate([d.property({type:u,json:{write:!0}})],
w.prototype,"timeExtent",void 0);k.__decorate([d.property({readOnly:!0})],w.prototype,"enabled",void 0);return w=y=k.__decorate([e.subclass("esri.views.layers.support.FeatureFilter")],w)})},"esri/views/layers/support/FeatureEffect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ./FeatureFilter".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){var w;a=w=function(q){function m(){var u=q.apply(this,arguments)||this;u.filter=null;u.includedEffect=null;u.excludedEffect=null;u.excludedLabelsVisible=!1;return u}b._inheritsLoose(m,q);m.prototype.clone=function(){return new w({filter:this.filter&&this.filter.clone(),includedEffect:this.includedEffect,excludedEffect:this.excludedEffect,excludedLabelsVisible:this.excludedLabelsVisible})};return m}(p.JSONSupport);k.__decorate([h.property({type:n,json:{write:!0}})],
a.prototype,"filter",void 0);k.__decorate([h.property({json:{write:!0}})],a.prototype,"includedEffect",void 0);k.__decorate([h.property({json:{write:!0}})],a.prototype,"excludedEffect",void 0);k.__decorate([h.property({type:Boolean,json:{write:!0}})],a.prototype,"excludedLabelsVisible",void 0);return a=w=k.__decorate([c.subclass("esri.views.layers.support.FeatureEffect")],a)})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../core/maybe","../../../layers/support/fieldUtils"],
function(b,k,a){b.getFetchPopupTemplate=function(r,l){return r.popupTemplate?r.popupTemplate:k.isSome(l)&&l.defaultPopupTemplateEnabled&&k.isSome(r.defaultPopupTemplate)?r.defaultPopupTemplate:null};b.getRequiredFields=async function(r,l=r.popupTemplate){if(!k.isSome(l))return[];const h=await l.getRequiredFields(r.fields);({lastEditInfoEnabled:l}=l);const {objectIdField:d,typeIdField:c,globalIdField:e,relationships:f}=r;if(h.includes("*"))return["*"];l=l?await a.getFeatureEditFields(r):[];const g=
a.fixFields(r.fields,[...h,...l]);c&&g.push(c);g&&d&&a.hasField(r.fields,d)&&-1===g.indexOf(d)&&g.push(d);g&&e&&a.hasField(r.fields,e)&&-1===g.indexOf(e)&&g.push(e);f&&f.forEach(p=>{({keyField:p}=p);g&&p&&a.hasField(r.fields,p)&&-1===g.indexOf(p)&&g.push(p)});return g};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/Accessor ../../../core/Collection ../../../core/Promise ../../../core/asyncUtils ../../../core/Handles ../../../core/watchUtils ../../support/arcgisLayerUrl ../../../tasks/support/StatisticDefinition ../../../views/support/WatchUpdatingTracking ../../../views/3d/support/debugFlags ../../../portal/support/geometryServiceUtils ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G){function H(K,L){if(!L)return!1;for(const S of L)if(!K.has(S))return!0;return!1}var I;const J=h.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");a=I=function(K){function L(M){M=K.call(this,M)||this;M.type="feature-tile-3d";M.watchUpdatingTracking=new A.WatchUpdatingTracking;M.serviceDataExtent=null;M.serviceDataCount=I.constants.NO_SERVICE_DATA_COUNT;M.vertexLimitExceeded=!1;M.displayFeatureLimit=null;M.suspended=
!1;M.tileFetcher=null;M.handles=new B;M.fetchDataInfoPromise=null;M.fetchDataInfoAbortController=null;M.lifeCycleAbortController=q.createAbortController();return M}b._inheritsLoose(L,K);var S=L.prototype;S.approximateExtentSizeAtScale=function(M,T){const O=this.layerView.view,Q=T.levels[0];return(Q.tileSize[0]/(Q.scale/M)+Q.tileSize[1]/(Q.scale/M))/2*Math.ceil((O.width/T.pixelSize+O.height/T.pixelSize)/2)};S.initialize=function(){this.watchUpdatingTracking.add(this,"vertexLimitInfo",()=>this.watchUpdatingTracking.addPromise(this.updateVertexLimitExceeded(null,
this.lifeCycleAbortController.signal)));this.watchUpdatingTracking.add(this,"mode",()=>this.modeChanged(),2);this.addResolvingPromise(q.resolve().then(()=>this.verifyCapabilities()).then(()=>this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo())).then(()=>this.initializeTileFetcher()))};S.verifyCapabilities=function(){const M=this.layerView.layer;if(!M.get("capabilities.operations.supportsQuery"))throw new g("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",
{layer:M});};S.destroy=function(){this.cancelFetchServiceDataInfo();this.tileFetcher=l.destroyMaybe(this.tileFetcher);this.handles=l.destroyMaybe(this.handles);this.tilesHandle=l.removeMaybe(this.tilesHandle);this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null);this.watchUpdatingTracking.destroy();this._set("watchUpdatingTracking",null)};S.suspend=function(){this.suspended||(this.suspended=!0,l.isSome(this.tileFetcher)&&this.tileFetcher.suspend())};
S.resume=function(){this.suspended&&(this.suspended=!1,l.isSome(this.tileFetcher)&&this.tileFetcher.resume())};S.restart=function(){const M=()=>{l.isSome(this.tileFetcher)&&this.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(M,M))};S.refetch=function(){const M=()=>{l.isSome(this.tileFetcher)&&this.tileFetcher.refetch()};this.watchUpdatingTracking.addPromise(this.fetchServiceDataInfo().then(M,M))};S.initializeTileFetcher=function(){const M=this.layerView.view;
if(M){var T=x.whenOnce(M.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(T);T.then(()=>{const {layerView:O,tileDescriptors:Q}=this,F=O.layer,N=new E.FeatureTileFetcher3D({context:this.context,filterExtent:this.filteredDataExtent,tileDescriptors:Q,features:this.graphics});this.tileFetcher=N;this.suspended?this.tileFetcher.suspend():this.tileFetcher.resume();var P=this.layerView.view.resourceController;P&&(this.handles.add(P.memoryController.events.on("quality-changed",
U=>{N.memoryFactor=U})),this.tileFetcher.memoryFactor=P.memoryController.memoryFactor);(P="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null)&&this.handles.add(x.init(this.layerView.view,"qualitySettings.graphics3D."+P,U=>{N.lodFactor=U||1}));this.watchUpdatingTracking.add(F,"createQueryVersion",()=>this.dataFilterChanged());this.watchUpdatingTracking.add(O,"availableFields",(U,V)=>this.availableFieldsChanged(V,U));this.watchUpdatingTracking.add(O,
"requiredFields",(U,V)=>this.requiredFieldsChanged(V,U));this.handles.add([F.on("apply-edits",U=>this.applyEdits(U)),this.watch("filteredDataExtent",U=>N.filterExtent=U,!0),this.watch("tileDescriptors",U=>N.tileDescriptors=U,!0),x.init(this,"maximumNumberOfFeatures",U=>{N.maximumNumberOfFeatures=U;N.useTileCount=this.serviceDataCount>U},!0),x.init(this,"serviceDataCount",U=>N.useTileCount=U>this.maximumNumberOfFeatures,!0),x.init(t,"FEATURE_TILE_FETCH_SHOW_TILES",U=>{U&&N&&!N.debugger?(N.debugger=
new G.FeatureTileFetcher3DDebugger(N,M.featureTiles.tilingScheme.toTileInfo(),M),N.debugger.update()):!U&&this.tileFetcher&&N.debugger&&(N.debugger.destroy(),N.debugger=null)})]);this.supportsExceedsLimitQuery||this.watchUpdatingTracking.add(this,"maxTotalSnapshotVertices",()=>this.watchUpdatingTracking.addPromise(this.updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal)))}).catch(()=>{})}};S.modeChanged=function(){switch(this.mode){case "tiles":this.tilesHandle||(this.tilesHandle=
this.layerView.view.featureTiles.addClient());break;default:J.warn("Unhandled feature layer mode "+this.mode);case "snapshot":l.isSome(this.tilesHandle)&&(this.tilesHandle.remove(),this.tilesHandle=null)}};S.dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};S.applyEdits=function(M){l.isNone(this.tileFetcher)||this.tileFetcher.applyEdits(M).then(T=>{T&&(T.deletedFeatures.length||T.updatedFeatures.length||T.addedFeatures.length)&&
this.watchUpdatingTracking.addPromise(this.updateServiceDataExtent(this.lifeCycleAbortController.signal))}).catch(T=>{if(!q.isAbortError(T))throw T;})};S.availableFieldsChanged=function(M,T){l.isSome(this.tileFetcher)&&H(this.tileFetcher.availableFields,T)&&this.refetch()};S.requiredFieldsChanged=function(M,T){l.isSome(this.tileFetcher)&&H(this.tileFetcher.availableFields,T)&&this.restart()};S.createVertexLimitExceededQuery=function(M){const T=this.layerView.layer,O=T.createQuery();O.outStatistics=
[new z({statisticType:"exceedslimit",maxVertexCount:M,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];T.capabilities.query.supportsCacheHint&&(O.cacheHint=!0);return O};S.createDataInfoQuery=function(){const M=this.layerView.layer,T=M.createQuery();T.outSpatialReference=this.layerView.view.spatialReference;M.capabilities.query.supportsCacheHint&&(T.cacheHint=!0);return T};S.fullExtentIsAccurate=function(){const M=this.layerView.layer;if(M.definitionExpression)return!1;
switch(M.type){case "feature":return C.isHostedAgolService(M.url);case "csv":case "geojson":case "ogc-feature":return!0}};S.updateServiceDataExtent=async function(M){try{await this.tryUpdateServiceDataExtent(M)}catch(T){q.isAbortError(T)||this._set("serviceDataExtent",r.clone(this.layerView.fullExtentInLocalViewSpatialReference))}};S.tryUpdateServiceDataExtent=async function(M){var T=this.layerView;const O=T.layer,Q=O.capabilities.query.supportsExtent,F=r.clone(T.fullExtentInLocalViewSpatialReference),
N=O.fullExtent,P=this.fullExtentIsAccurate(),U=this.serviceDataCount;Q&&U<=I.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!F||!P)&&"queryExtent"in O?(T=this.createDataInfoQuery(),M=await O.queryExtent(T,{timeout:I.constants.QUERY_EXTENT_TIMEOUT,signal:M}),this._set("serviceDataExtent",M.extent)):F?this._set("serviceDataExtent",F):N?(M=await D.projectGeometry(N,T.view.spatialReference,"portalItem"in O?O.portalItem:null,M),this._set("serviceDataExtent",M)):this._set("serviceDataExtent",null)};S.updateServiceDataCount=
async function(M){const T=this.layerView.layer;if("queryFeatureCount"in T)if(M=await y.result(T.queryFeatureCount(this.createDataInfoQuery(),{timeout:I.constants.QUERY_STATISTICS_TIMEOUT,signal:M})),!0===M.ok)this._set("serviceDataCount",M.value);else{if(q.isAbortError(M.error))throw M.error;({NO_SERVICE_DATA_COUNT:M}=I.constants);this._set("serviceDataCount",M)}else({NO_SERVICE_DATA_COUNT:M}=I.constants),this._set("serviceDataCount",M)};S.updateVertexLimitExceeded=async function(M,T){var O=this.vertexLimitInfo;
if(l.isNone(O))this._set("vertexLimitExceeded",!1);else{var Q=1<this.minimumNumberOfVerticesForGeometry;if(0>=O.primitivesPerFeature||Q){var {primitivesPerFeature:F,primitivesPerCoordinate:N,maximumTotalNumberOfPrimitives:P}=O;0!==F&&l.isSome(M)&&await M;O=this.serviceDataCount;var U=O!==I.constants.NO_SERVICE_DATA_COUNT;M=U?Math.ceil((P-O*F)/(N||1)):Math.ceil(P/(N||1));Q&&(M=Math.min(M,5E6));if(U&&this.minimumNumberOfVerticesForGeometry*O>M)this._set("vertexLimitExceeded",!0);else if(this.supportsExceedsLimitQuery)if(T=
await y.result(this.layerView.layer.queryFeatures(this.createVertexLimitExceededQuery(M),{timeout:I.constants.QUERY_STATISTICS_TIMEOUT,signal:T})),!1===T.ok){if(q.isAbortError(T.error))throw T.error;this._set("vertexLimitExceeded",!1)}else(T=T.value.features[0])&&T.attributes?this._set("vertexLimitExceeded",!!T.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);else this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>M)}else this._set("vertexLimitExceeded",!1)}};S.fetchServiceDataInfo=
async function(){this.cancelFetchServiceDataInfo();let M=q.createAbortController();const T=M.signal;var O=this.updateServiceDataCount(T);O=q.eachAlways([O,this.updateVertexLimitExceeded(O,T)]);const Q=O.then(()=>this.updateServiceDataExtent(T)).catch(F=>{q.isAbortError(F)||J.error("#fetchServiceDataInfo()",F)}).then(()=>{Q===this.fetchDataInfoPromise&&(this.fetchDataInfoAbortController=this.fetchDataInfoPromise=null);M=null});M&&(this.fetchDataInfoPromise=Q);this.fetchDataInfoAbortController=M;return O.then(()=>
{},()=>{})};S.cancelFetchServiceDataInfo=function(){const M=this.fetchDataInfoAbortController;M&&(this.fetchDataInfoPromise=this.fetchDataInfoAbortController=null,M.abort())};b._createClass(L,[{key:"extent",set:function(M){if(M&&!M.spatialReference.equals(this.layerView.view.spatialReference))J.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var T=this._get("extent");T===M||T&&M&&T.equals(M)||(M=M?M.clone():null,this._set("extent",M))}}},{key:"updating",get:function(){return!!(l.isSome(this.tileFetcher)&&
this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&l.isSome(this.tileFetcher)?this.tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&l.isSome(this.tileFetcher)?this.tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&
l.isSome(this.tileFetcher)?this.tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return l.isSome(this.tileFetcher)?this.tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!l.isSome(this.tileFetcher)||!this.tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"filteredDataExtent",get:function(){return this.extent}},{key:"maximumNumberOfFeatures",get:function(){return l.isSome(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:
0},set:function(M){M!==this.maximumNumberOfFeatures&&(null==M?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",M))}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){if(this.serviceDataCount===I.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";const {layer:M,view:T}=this.layerView;var O=T&&T.featureTiles;O=O&&O.tilingScheme;return M&&M.minScale&&this.serviceDataExtent&&
O&&(O=this.approximateExtentSizeAtScale(M.minScale,O),(this.serviceDataExtent.width/O+this.serviceDataExtent.height/O)/2>I.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){const M=this._get("maxTotalSnapshotVertices")||0,T="snapshot"===this.mode&&l.isSome(this.tileFetcher)&&this.tileFetcher.totalVertices||0;return Math.max(M,T)}},{key:"tileDescriptors",
get:function(){return"snapshot"===this.mode?new u([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new u}},{key:"test",get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}}},{key:"vertexLimitInfo",get:function(){if(l.isNone(this.displayFeatureLimit)||l.isNone(this.displayFeatureLimit.averageSymbolComplexity))return null;const {averageSymbolComplexity:M,maximumTotalNumberOfPrimitives:T}=
this.displayFeatureLimit,{primitivesPerCoordinate:O,primitivesPerFeature:Q}=M,F=this._get("vertexLimitInfo");return l.isNone(F)||F.maximumTotalNumberOfPrimitives!==T||F.primitivesPerCoordinate!==O||F.primitivesPerFeature!==Q?{primitivesPerCoordinate:O,primitivesPerFeature:Q,maximumTotalNumberOfPrimitives:T}:F}},{key:"supportsExceedsLimitQuery",get:function(){const M=this.layerView.layer;return M.capabilities&&M.capabilities.operations&&M.capabilities.operations.supportsExceedsLimitStatistics}},{key:"minimumNumberOfVerticesForGeometry",
get:function(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;default:return 0}}},{key:"debug",get:function(){return{storedFeatures:l.isSome(this.tileFetcher)?this.tileFetcher.storedFeatures:0,totalFeatures:l.isSome(this.tileFetcher)?this.tileFetcher.totalFeatures:0,totalVertices:l.isSome(this.tileFetcher)?this.tileFetcher.totalVertices:0}}}]);return L}(v.EsriPromiseMixin(m));
k.__decorate([c.property({readOnly:!0})],a.prototype,"type",void 0);k.__decorate([c.property({constructOnly:!0})],a.prototype,"graphics",void 0);k.__decorate([c.property({constructOnly:!0})],a.prototype,"layerView",void 0);k.__decorate([c.property({constructOnly:!0})],a.prototype,"context",void 0);k.__decorate([c.property()],a.prototype,"extent",null);k.__decorate([c.property({dependsOn:["tileFetcher.updating","mode","layerView.view.featureTiles.updating","fetchDataInfoPromise","watchUpdatingTracking.updating"]})],
a.prototype,"updating",null);k.__decorate([c.property({readOnly:!0})],a.prototype,"watchUpdatingTracking",void 0);k.__decorate([c.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],a.prototype,"updatingTotal",null);k.__decorate([c.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],a.prototype,"updatingRemaining",null);k.__decorate([c.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],a.prototype,"expectedFeatureDiff",null);k.__decorate([c.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],
a.prototype,"memoryForUnusedFeatures",null);k.__decorate([c.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],a.prototype,"maximumNumberOfFeaturesExceeded",null);k.__decorate([c.property({readOnly:!0})],a.prototype,"serviceDataExtent",void 0);k.__decorate([c.property({readOnly:!0})],a.prototype,"serviceDataCount",void 0);k.__decorate([c.property({readOnly:!0})],a.prototype,"vertexLimitExceeded",void 0);k.__decorate([c.property({readOnly:!0,dependsOn:["extent"]})],a.prototype,
"filteredDataExtent",null);k.__decorate([c.property()],a.prototype,"displayFeatureLimit",void 0);k.__decorate([c.property({type:Number,dependsOn:["displayFeatureLimit"]})],a.prototype,"maximumNumberOfFeatures",null);k.__decorate([c.property({readOnly:!0,dependsOn:"serviceDataCount displayFeatureLimit maximumNumberOfFeatures vertexLimitExceeded serviceDataExtent layerView.layer.minScale layerView.view.featureTiles.tilingScheme".split(" ")})],a.prototype,"mode",null);k.__decorate([c.property({readOnly:!0,
dependsOn:["mode","tileFetcher.totalVertices"]})],a.prototype,"maxTotalSnapshotVertices",null);k.__decorate([c.property({readOnly:!0,dependsOn:["mode"],autoTracked:!1})],a.prototype,"tileDescriptors",null);k.__decorate([c.property()],a.prototype,"tileFetcher",void 0);k.__decorate([c.property()],a.prototype,"fetchDataInfoPromise",void 0);k.__decorate([c.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],a.prototype,"vertexLimitInfo",null);a=I=k.__decorate([f.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],
a);(function(K){(function(L){L.NO_SERVICE_DATA_COUNT=Infinity;L.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;L.reset=function(){L.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;L.QUERY_STATISTICS_TIMEOUT=12E3;L.QUERY_EXTENT_TIMEOUT=1E4}})(K.constants||(K.constants={}))})(a||(a={}));a.constants.reset();return a})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler ../../../../tasks/support/QuantizationParameters ../../../../tasks/support/Query ../../../../core/MapUtils ../../../../layers/graphics/dehydratedFeatures ../../terrain/tileUtils ./featureReference ./FeatureTile".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E){function G(T){return"dummy-tile-full-extent"===T.id}function H(T){let O=0;for(const Q of T)Q.features&&0<Q.features.length&&Q.alive&&(O=Math.max(O,Q.descriptor.lij[0]));return O}function I(T){T.setFeatures([],0,null);T.featuresMissing=!1;return 4}function J(T){return l.isNone(T)?new Set:new Set(T.map(O=>O.name))}function K(T,O){if(l.isNone(T)||l.isNone(O))return J(O);const Q=new Set;for(const {name:F}of O)T.has(F)&&Q.add(F);return Q}
const L=h.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");b.FeatureTileFetcher3D=function(T){function O(F){F=T.call(this,F)||this;F._useTileCount=!1;F.updating=!1;F.updatingTotal=0;F.updatingRemaining=0;F.expectedFeatureDiff=0;F.maximumNumberOfFeaturesExceeded=!1;F.maximumNumberOfFeaturesExceededThrottle=1E3;F._fullRatio=1;F._farRatio=1;F.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};F.handles=new u;F._frameTask=B.ImmediateTask;F._dirty=!1;F.featureTiles=new Map;F.displayingFeatureReferences=
new Map;F.numDisplayingFeatureReferences=0;F.suspended=!0;F.pendingEdits=null;return F}k._inheritsLoose(O,T);var Q=O.prototype;Q.initialize=function(){this.handles.add(v.on(this,"tileDescriptors","change",()=>this.setDirty(),()=>this.setDirty()));this.objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?D.MultiFeatureReference:D.SingleFeatureReference;const F=this.context.scheduler;l.isSome(F)&&(this._frameTask=F.registerTask(B.Task.FEATURE_TILE_FETCHER,
N=>this._process(N),()=>this.updating));this.setDirty()};Q.destroy=function(){this._frameTask.remove();this.handles&&(this.handles.destroy(),this.handles=null);this.featureTiles.forEach(F=>{this.cancelFetchTile(F);this.removeTile(F)});this.featureTiles.clear();this.displayingFeatureReferences.clear();this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)};Q.restart=function(){this.featureTiles.forEach(F=>{this.cancelFetchTile(F);this.clearTile(F);this.resetFetchTile(F)});
l.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};Q.refetch=function(){this.featureTiles.forEach(F=>{this.cancelFetchTile(F);this.resetFetchTile(F)});l.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this.setDirty()};Q.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())};Q.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())};Q.pause=function(){this.paused&&(this.featureTiles.forEach(F=>this.cancelFetchTile(F)),
this.updated())};Q.unpause=function(){this.paused||(this.setDirty(),this.updated())};Q.applyEdits=function(F){this.pendingEdits||(this.pendingEdits={edits:w.resolve(),count:0,controller:w.createAbortController()},this.pause());const N=this.pendingEdits;N.count++;const P=N.edits.then(()=>F.result.catch(U=>{if(w.isAbortError(U))throw U;return null}).then(U=>U?(this.applyEditsDeleteFeatures(U.deletedFeatures),this.applyEditsAddUpdateFeatures(U.addedFeatures,U.updatedFeatures,N.controller.signal).then(()=>
U)):U).then(U=>{0===--N.count&&(this.pendingEdits===N&&(this.pendingEdits=null),l.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this.unpause(),this.updated());return U}));N.edits=P;this.updated();return P};Q.applyEditsDeleteFeatures=function(F){if(0!==F.length){var N=new Set;F.forEach(P=>N.add(P.objectId));this.featureTiles.forEach(P=>{if(P.features){var U=P.features.filter(V=>!N.has(A.getObjectId(V,this.objectIdField)));U.length!==P.features.length&&(P.setFeatures(U,0,P.availableFields),
this.invalidateCounts())}})}};Q.applyEditsAddUpdateFeatures=async function(F,N,P){const U=[],V=new Set;F.forEach(X=>U.push(X.objectId));N.forEach(X=>{U.push(X.objectId);V.add(X.objectId)});if(0!==U.length){var W=[];this.featureTiles.forEach(X=>{(X=this.applyEditsAddUpdateTile(X,U,V,P))&&W.push(X)});await w.eachAlways(W)}};Q.applyEditsAddUpdateTile=async function(F,N,P,U){if(F.features){var V=this.createQuery(F);V.resultType=void 0;V.cacheHint=!1;V.objectIds=N;N=await this.queryFeatures(V,U);U=null;
0<P.size&&(V=F.features.filter(W=>!P.has(A.getObjectId(W,this.objectIdField))),V.length!==F.features.length&&(U=V));if(0<N.features.length){U||(U=F.features.slice());for(const W of N.features)U.push(W)}U&&(F.setFeatures(U,0,K(F.availableFields,N.fields)),this.invalidateCounts())}};Q.queryFeatures=function(F,N){return this.context.query.queryFeaturesDehydrated(F,{signal:N,timeout:6E5})};Q.setDirty=function(){this._dirty=!0;this.updated()};Q._process=function(F){if(this._dirty&&this.constructed){this._dirty=
!1;var N=this.getListOfTiles();this.markTilesNotAlive(N);if(F.run(()=>this.addTiles(N,F))&&F.run(()=>this.filterExtentTiles(N,F))&&F.run(()=>this.removeTiles(N,F))&&!F.done){var P=this.sortTiles(N);F.run(()=>this.displayTiles(P,F))&&F.run(()=>this.fetchTiles(P,F))&&F.run(()=>this.updateMemoryEstimates(P,F))||this.setDirty();this.updated();this.updating||this.updateMaximumNumberOfFeaturesExceeded()}else this.setDirty()}};Q.markTilesNotAlive=function(F){for(const N of F)N.alive=!1};Q.addTiles=function(F,
N){if(this.suspended)return!1;this.tileDescriptors.forEach(P=>{const U=this.featureTiles.get(P.id);U?U.alive=!0:N.done||(F.push(this.addTile(P)),N.madeProgress())});return N.hasProgressed};Q.filterExtentTiles=function(F,N){for(const P of F){if(N.done)break;P.alive&&(P.filtered=!P.intersects(this.filterExtent),P.filtered&&(this.clearTile(P),N.madeProgress()))}return N.hasProgressed};Q.removeTiles=function(F,N){for(let P=F.length-1;0<=P&&!N.done;P--){const U=F[P];U.alive||(this.removeTile(U),P!==F.length-
1&&(F[P]=F[F.length-1]),F.pop(),N.madeProgress())}return N.hasProgressed};Q.sortTiles=function(F){F.sort((N,P)=>N.descriptor.loadPriority-P.descriptor.loadPriority);return F};Q.displayTiles=function(F,N){const P=this.updateRatio(F),U=V=>{const W=1>this._fullRatio?P(V)*this._farRatio:1;V.reduceFeatures(W,this.memoryFactor,this.objectIdField)&&this.setDirty();return this.showTile(V)};for(const V of F)if(!N.run(()=>U(V))){this.setDirty();break}return N.hasProgressed};Q.fetchTiles=function(F,N){if(this.paused)return!1;
var P=!1;for(const V of F)if(V.needsFetching){var U=l.isSome(this.context.memoryCache)?this.context.memoryCache.pop(V.id):null;if(l.isSome(U))V.cache=U,this.setDirty(),this.scheduleUpdated(),N.madeProgress();else if(this.needsNumFeatures(V)&&(P=w.createAbortController(),U=this.fetchTileCount(V,P.signal),this._handleRequest(V,U,P,()=>V.numFeatures=E.FAILED_FEATURE_COUNT),P=!0,N.madeProgress()),N.done)return!0}if(P)return N.hasProgressed;for(const V of F)if(V.needsFetching&&(F=w.createAbortController(),
P=this.fetchTile(V,F.signal),this._handleRequest(V,P,F,W=>{V.setFeatures([],0,null);this.invalidateCounts();V.featuresMissing=!1;this.context.logFetchError(L,W)}),N.madeProgress(),N.done))return!0;return N.hasProgressed};Q.updateMemoryEstimates=function(F,N){F.some(P=>N.run(()=>P.updateMemoryEstimates())?!1:(this.setDirty(),!0));return N.hasProgressed};Q.reclip=function(F,N){this.constructed&&(this.featureTiles.forEach(P=>{P.displayingFeatures&&0!==P.displayingFeatures.length&&(P.intersection(N,S),
P.intersection(F,M),y.equals(S,M)||this.hideTileFeatures(P))}),this.featureTiles.forEach(P=>this.showTile(P)),this.updated())};Q.updated=function(){let F=0;this.paused||this.featureTiles.forEach(P=>P.isFetching?++F:0);var N=this._dirty||0<F||!!this.pendingEdits;this._set("updating",N);if(N){let P=N=0,U=0,V=0,W=0,X=0;const ca=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach(aa=>{++U;if(aa.isFetching&&aa.hasPreciseFeatureCount){const ka=this.maximumFeaturesForTile(aa)*
(1-aa.emptyFeatureRatio);X+=ka-(aa.displayingFeatures?aa.displayingFeatures.length*ca:0)}aa.needsFetching?++W:0<aa.numFeatures&&(++V,P+=aa.numFeatures)});W+=F;let R=0;P?(N=P,R=Math.min(W*P/V,P)):(N=U,R=W);X=Math.min(this.maximumNumberOfFeatures-this.features.length,X);this._set("updatingTotal",N);this._set("updatingRemaining",R);this._set("expectedFeatureDiff",X)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()};
Q.updateMaximumNumberOfFeaturesExceeded=function(){const F=z.someMap(this.featureTiles,N=>N.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",F)};Q.updateRatio=function(F){const N=H(F),P=W=>1/(1<<Math.max(0,N-W.descriptor.lij[0]));let U=0,V=0;for(const W of F)F=W.numFeatures,U+=F,V+=F*P(W);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/U);this._farRatio=this.maximumNumberOfFeatures/V;this.scheduleUpdated();return P};Q.maximumFeaturesUpdated=function(F,N){F!==
N&&(N>F&&this.featureTiles.forEach(P=>{if(P.featuresMissing){var U=this.maximumFeaturesForTile(P);P.features&&(P.features.length>=U||5===P.fetchStatus)||(this.cancelFetchTile(P),this.resetFetchTile(P))}}),this.setDirty())};Q.addTile=function(F){F=new E.FeatureTile(F);this.featureTiles.set(F.id,F);this.resetFetchTile(F);this.referenceDisplayingFeaturesFromRelatedTiles(F);return F};Q.referenceDisplayingFeaturesFromRelatedTiles=function(F){const N=F.descriptor.resolution;this.featureTiles.forEach(P=>
{if(P.displayingFeatures&&F!==P&&(!F.descriptor.lij||!P.descriptor.lij||t.tilesAreRelated(F.descriptor.lij,P.descriptor.lij))){F.displayingFeatures=F.displayingFeatures||[];for(const U of P.displayingFeatures)F.displayingFeatures.push(U),P=this.displayingFeatureReferences.get(A.getObjectId(U,this.objectIdField)),P.ref(P.feature,N),this.numDisplayingFeatureReferences++}});F.featureLimit=F.displayingFeatures?F.displayingFeatures.length:0};Q.removeTile=function(F){this.clearTile(F);this.featureTiles.delete(F.id)};
Q.resetFetchTile=function(F){F.filtered=!F.intersects(this.filterExtent);F.filtered?F.needsFetching&&(F.fetchStatus=4):F.fetchStatus=0};Q.cancelFetchTile=function(F){const N=F.requestController;l.isSome(N)&&(F.requestController=null,F.resetFetching(),N.abort())};Q.fetchTileCount=async function(F,N){F.numFeatures=await this.fetchCount(F,N);this.updateRatio(this.getListOfTiles());return 3===F.fetchStatus?1:0};Q.fetchTile=async function(F,N){var P=this.maximumFeaturesForTile(F);if(0>=P)return I(F);const U=
this.getMaxRecordCount(F);var V=Math.ceil(P/U);if(G(F)||!this.context.capabilities.supportsMaxRecordCountFactor||F.numFeatures<=P&&V>C.MAX_MAX_RECORD_COUNT_FACTOR)return this.fetchPagedTile(F,N);V=this.createQuery(F);V.maxRecordCountFactor=Math.ceil(P/U);F.isRefetching&&F.features&&0<F.features.length&&(V.maxRecordCountFactor=Math.max(Math.ceil(F.features.length/(1-F.emptyFeatureRatio)/U)+1,V.maxRecordCountFactor));const {features:W,exceededTransferLimit:X,fields:ca}=await this.queryFeatures(V,N);
P=X?V.maxRecordCountFactor>=C.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5;await this._frameTask.schedule(()=>{F.featuresMissing=W.length<F.numFeatures||X;const R=this._removeEmptyFeatures(W);F.setFeatures(W,R,J(ca))},N);this.invalidateCounts();return P};Q.fetchCount=async function(F,N){return this.context.query.queryFeatureCount(this.createFeatureCountQuery(F),{signal:N})};Q.fetchPagedTile=async function(F,N){let P=0,U=0,V,W=0,X=this.maximumFeaturesForTile(F)-W;const ca=this.getMaxRecordCount(F);let R=null;
for(;;){const aa=this.createQuery(F),ka=this.setPagingParameters(aa,P,X,ca),{features:da,exceededTransferLimit:fa,fields:ea}=await this.queryFeatures(aa,N);await this._frameTask.schedule(()=>{ka&&(P+=l.unwrap(aa.num));W+=da.length;U+=this._removeEmptyFeatures(da);F.featuresMissing=P<F.numFeatures||fa;V=V?V.concat(da):da;R=K(R,ea);F.setFeatures(V,U,R)},N);this.invalidateCounts();this.setDirty();X=this.maximumFeaturesForTile(F)-W;if(!ka||!fa||0>=X)return fa?4:5}};Q.createFeatureCountQuery=function(F){F=
this.createQuery(F);this.context.capabilities.supportsCacheHint&&(F.resultType=void 0,F.cacheHint=!0);return F};Q.createQuery=function(F){const N=this.context.createQuery(),P=F.descriptor.extent;P&&(N.geometry=y.toExtent(P,this.context.tilingScheme.spatialReference));this.setResolutionParams(N,F);this.useTileQuery(F)?N.resultType="tile":this.context.capabilities.supportsCacheHint&&(N.cacheHint=!0);return N};Q.setPagingParameters=function(F,N,P,U){if(!this.context.capabilities.supportsPagination)return!1;
F.start=N;0<P&&this.context.capabilities.supportsMaxRecordCountFactor?(F.maxRecordCountFactor=Math.ceil(P/U),F.num=Math.min(F.maxRecordCountFactor*U,P)):F.num=Math.min(U);return!0};Q.getEffectiveTileResolution=function(F){if(null==F.descriptor.resolution)return null;const N=1===this.context.viewingMode?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(F.descriptor.resolution,N)/this.lodFactor};Q.setResolutionParams=function(F,N){this.supportsResolution&&(N=this.getEffectiveTileResolution(N),
null!=N&&(this.context.capabilities.supportsQuantization?F.quantizationParameters=new x({mode:"view",originPosition:"upper-left",tolerance:N,extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(F.maxAllowableOffset=N)))};Q._removeEmptyFeatures=function(F){const N=F.length;for(let P=0;P<F.length;)A.hasVertices(F[P].geometry)?++P:(F[P]=F[F.length-1],--F.length);return N-F.length};Q.needsNumFeatures=function(F){return this.useTileCount&&F.needsFeatureCount&&!G(F)};Q.getMaxRecordCount=
function(F){const {tileMaxRecordCount:N,maxRecordCount:P}=this.context;return this.useTileQuery(F)&&l.isSome(N)&&0<N&&this.context.capabilities.supportsResultType?N:l.isSome(P)&&0<P?P:2E3};Q.useTileQuery=function(F){return G(F)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};Q._handleRequest=function(F,N,P,U){F.fetchStatus=F.needsRefetching?3:2;F.requestController=P;let V=!1;N.then(W=>{F.requestController=null;F.fetchStatus=W}).catch(W=>{F.requestController===
P&&(F.requestController=null,F.fetchStatus=4);w.isAbortError(W)?V=!0:U(W)}).then(()=>{V||this.setDirty();this.scheduleUpdated()})};Q.scheduleUpdated=function(){this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(q.schedule(()=>{this.handles.remove("scheduleUpdated");this.updated()}),"scheduleUpdated")};Q.showTile=function(F){if(F.displayingFeatures&&!F.needsDisplayUpdate)return!1;var N=F.features;if(0===F.featureLimit||!N)return N=F.displayingFeatures&&0<F.displayingFeatures.length,
this.hideTileFeatures(F),F.displayingFeatures=[],N;const P=F.descriptor.resolution,U=this.changes.updates,V=this.changes.adds,W=Math.min(F.featureLimit,N.length);F.featureLimit=W;for(let ca=0;ca<W;++ca){var X=N[ca];const R=A.getObjectId(X,this.objectIdField),aa=this.displayingFeatureReferences.get(R);aa?(X=aa.ref(X,P),X.oldVersion!==X.newVersion&&(U.removes.push(X.oldVersion),U.adds.push(X.newVersion))):(this.displayingFeatureReferences.set(R,new this.FeatureReferenceClass(X,P)),V.push(X));this.numDisplayingFeatureReferences++}this.hideTileFeatures(F);
this.applyChanges();F.displayingFeatures=N.slice(0,W);return!0};Q.hideTile=function(F){this.cancelFetchTile(F);this.hideTileFeatures(F)};Q.hideTileFeatures=function(F){if(F.displayingFeatures){var N=this.changes.updates,P=this.changes.removes;for(const V of F.displayingFeatures){const W=A.getObjectId(V,this.objectIdField);var U=this.displayingFeatureReferences.get(W);U&&((U=U.unref(F.descriptor.resolution),this.numDisplayingFeatureReferences--,U)?U.oldVersion!==U.newVersion&&(null==U.newVersion?(this.displayingFeatureReferences.delete(W),
P.push(U.oldVersion)):(N.adds.push(U.newVersion),N.removes.push(U.oldVersion))):console.error("Hiding unreferenced feature"))}this.applyChanges();F.displayingFeatures=null}};Q.applyChanges=function(){var F=this.changes.updates;0<F.removes.length&&(this.features.removeMany(F.removes),F.removes.length=0);0<F.adds.length&&(this.features.addMany(F.adds),F.adds.length=0);F=this.changes.adds;const N=this.changes.removes,P=Math.min(F.length,N.length);let U=0;for(;U<P;){const V=Math.min(U+200,P);this.features.addMany(F.slice(U,
V));this.features.removeMany(N.slice(U,V));U=V}F.length>P&&this.features.addMany(0===U?F:F.slice(U));N.length>P&&this.features.removeMany(0===U?N:N.slice(U));F.length=0;N.length=0};Q.clearTile=function(F){this.hideTile(F);F.features&&l.isSome(this.context.memoryCache)&&this.context.memoryCache.put(F.id,F.cache,16+F.estimatedSize);F.setFeatures(null,0,null);this.invalidateCounts()};Q.invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};
Q.getListOfTiles=function(){return Array.from(this.featureTiles.values())};Q.maximumFeaturesForTile=function(F){const N=F.hasPreciseFeatureCount?F.numFeatures:Infinity;return Math.min(Math.ceil((F.hasPreciseFeatureCount?N:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-F.emptyFeatureRatio)),N)};k._createClass(O,[{key:"maximumNumberOfFeatures",set:function(F){F=F||Infinity;const N=this._get("maximumNumberOfFeatures");F===N||1>F||(this._set("maximumNumberOfFeatures",F),this.maximumFeaturesUpdated(N,
F))}},{key:"memoryFactor",set:function(F){this.memoryFactor!==F&&(this._set("memoryFactor",F),this.setDirty())}},{key:"lodFactor",set:function(F){this.lodFactor!==F&&(this._set("lodFactor",F),this.supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&l.isSome(this.context.query.queryFeatureCount)},set:function(F){this._useTileCount=F;this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){let F=0;this.featureTiles.forEach(N=>
F+=N.estimatedUnusedSize);return F}},{key:"totalVertices",get:function(){let F=0;this.featureTiles.forEach(N=>F+=N.numVertices);return F}},{key:"totalFeatures",get:function(){let F=0;this.featureTiles.forEach(N=>F+=N.numFeatures);return F}},{key:"filterExtent",set:function(F){if(F&&this.context.tilingScheme&&!F.spatialReference.equals(this.context.tilingScheme.spatialReference))L.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var N=this._get("filterExtent");
N===F||N&&F&&N.equals(F)||(F=F?F.clone():null,this._set("filterExtent",F),this.reclip(F,N))}}},{key:"paused",get:function(){return this.suspended||!!this.pendingEdits}},{key:"availableFields",get:function(){let F=null;this.featureTiles.forEach(N=>{N.displayingFeatures&&0!==N.displayingFeatures.length&&(l.isNone(F)?F=new Set(N.availableFields):F.forEach(P=>{N.availableFields.has(P)||l.unwrap(F).delete(P)}))});return l.isSome(F)?F:new Set}},{key:"supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&
"point"!==this.context.geometryType}},{key:"storedFeatures",get:function(){return this.getListOfTiles().reduce((F,N)=>F+(N.features?N.features.length:0),0)}},{key:"test",get:function(){return{process:F=>this._process(F),getFeatureTileById:F=>this.featureTiles.get(F),forEachFeatureTile:F=>this.featureTiles.forEach(F)}}}]);return O}(m);a.__decorate([c.property({constructOnly:!0})],b.FeatureTileFetcher3D.prototype,"features",void 0);a.__decorate([c.property()],b.FeatureTileFetcher3D.prototype,"tileDescriptors",
void 0);a.__decorate([c.property({value:Infinity})],b.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);a.__decorate([c.property({value:1})],b.FeatureTileFetcher3D.prototype,"memoryFactor",null);a.__decorate([c.property({value:1})],b.FeatureTileFetcher3D.prototype,"lodFactor",null);a.__decorate([c.property({dependsOn:["context"]})],b.FeatureTileFetcher3D.prototype,"useTileCount",null);a.__decorate([c.property({readOnly:!0})],b.FeatureTileFetcher3D.prototype,"updating",void 0);a.__decorate([c.property({readOnly:!0})],
b.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);a.__decorate([c.property({readOnly:!0})],b.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);a.__decorate([c.property({readOnly:!0})],b.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);a.__decorate([c.property({readOnly:!0})],b.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",null);a.__decorate([c.property({readOnly:!0})],b.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);a.__decorate([c.property({constructOnly:!0})],
b.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);a.__decorate([c.property({readOnly:!0})],b.FeatureTileFetcher3D.prototype,"totalVertices",null);a.__decorate([c.property({readOnly:!0})],b.FeatureTileFetcher3D.prototype,"totalFeatures",null);a.__decorate([c.property()],b.FeatureTileFetcher3D.prototype,"filterExtent",null);a.__decorate([c.property({constructOnly:!0})],b.FeatureTileFetcher3D.prototype,"context",void 0);b.FeatureTileFetcher3D=a.__decorate([f.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],
b.FeatureTileFetcher3D);const S=y.create(),M=y.create();a=b.FeatureTileFetcher3D;b.contextCapabilitiesFromLayer=function(T){const O=T.capabilities.query;a:switch(T.geometryType){case "polyline":T=!0;break a;case "polygon":T=T.capabilities&&T.capabilities.query&&T.capabilities.query.supportsQuantization;break a;default:T=!1}return{supportsMultipleResolutions:T,supportsPagination:!(!O||!O.supportsPagination),supportsResultType:!(!O||!O.supportsResultType),supportsCacheHint:!(!O||!O.supportsCacheHint),
supportsQuantization:!(!O||!O.supportsQuantization),supportsQuantizationEditMode:!(!O||!O.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!O||!O.supportsMaxRecordCountFactor),supportsFormatPBF:!(!O||!O.supportsFormatPBF)}};b.default=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/featureReference":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../layers/graphics/dehydratedFeatureComparison","../../../../layers/graphics/dehydratedFeatures"],
function(b,k,a,r){r=function(){function d(e,f){this.highestResolutionVersion=null;this.versions=[];this.ref(e,f)}var c=d.prototype;c.ref=function(e,f){const g=this.feature;h.oldVersion=g;this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});for(var p of this.versions)if(p.resolution===f){p.refCount++;if((f=this.highestResolutionVersion===p&&!a.equals(e,p.feature))||this.highestResolutionVersion!==p)p.feature=e;h.newVersion=f?e:g;return h}p={feature:e,resolution:f,refCount:1};
this.versions.push(p);!this.highestResolutionVersion||f<this.highestResolutionVersion.resolution?(h.newVersion=e,this.highestResolutionVersion=p):h.newVersion=g;return h};c.unref=function(e){for(let f=0;f<this.versions.length;f++){const g=this.versions[f];if(g.resolution===e)return g.refCount--,h.oldVersion=this.feature,0===g.refCount&&(this.versions[f]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===g&&(this.recalculateHighestResolutionVersion(),h.oldVersion=
g.feature)),h.newVersion=this.feature,h}return null};c.recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{var e=this.versions[0];for(let f=1;f<this.versions.length;f++){const g=this.versions[f];g.resolution<e.resolution&&(e=g)}this.highestResolutionVersion=e}};k._createClass(d,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},
{key:"feature",get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null}}]);return d}();let l=function(){function d(e){this._feature=e;this.refCount=1}var c=d.prototype;c.ref=function(e){++this.refCount;h.oldVersion=this._feature;this.feature&&Object.defineProperty(e,"uid",{value:this.feature.uid,configurable:!0});a.equals(this._feature,e)||(this._feature=e);h.newVersion=this._feature;return h};c.unref=function(){h.oldVersion=this._feature;if(0<this.refCount&&
(this.refCount--,!this.isReferenced))return h.newVersion=null,h;h.newVersion=this._feature;return h};k._createClass(d,[{key:"isReferenced",get:function(){return 0!==this.refCount}},{key:"isSingle",get:function(){return 1===this.refCount}},{key:"feature",get:function(){return this._feature}}]);return d}();const h={oldVersion:null,newVersion:null};b.MultiFeatureReference=r;b.SingleFeatureReference=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/arrayUtils ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(b,k,a,r,l,h){const d=new Set;let c=function(){function f(p){this.descriptor=p;this.fetchStatus=0;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=d;this.displayingFeatures=null;this.alive=!0;this.filtered=!1}var g=f.prototype;g.setFeatures=function(p,n,w){this._availableFields=a.unwrapOr(w,
d);this._features=p;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;p&&0<p.length?(this._emptyFeatureRatio=n/(p.length+n),this._numVertices=p.reduce((q,m)=>q+h.numVertices(m.geometry),0)):this._numVertices=this._emptyFeatureRatio=0};g.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var p=0;p<this._features.length;++p){const n=h.estimateSize(this._features[p]);this._estimatedSize+=n;p>=this.featureLimit&&
(this._estimatedUnusedSize+=n)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(p=this.featureLimit;p<this._features.length;++p)this._estimatedUnusedSize+=h.estimateSize(this._features[p]);return!0}return!1};g.resetFetching=function(){this.fetchStatus=3===this.fetchStatus?1:0};g.intersects=function(p){if(!p||!this.descriptor.extent)return!0;l.fromExtent(p,e);return l.intersects(this.descriptor.extent,e)};g.intersection=
function(p,n){if(!p&&!this.descriptor.extent)return l.set(n,l.POSITIVE_INFINITY),n;p?(l.fromExtent(p,n),this.descriptor.extent&&l.intersection(n,this.descriptor.extent,n)):l.set(n,this.descriptor.extent);return n};g._shuffle=function(p){this._features.sort((n,w)=>h.getObjectId(n,p)-h.getObjectId(w,p));r.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0};g.reduceFeatures=function(p,n,w){if(0>=p)return!1;if(!this._features)return this.featureLimit=0,!1;let q=!1;this.featureLimit=
Math.ceil(this.numFeatures*p);this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&0<this._features.length&&(this.fetchStatus=1,q=!0));!this._shuffled&&1>p&&this._shuffle(w);p=Math.max(this.featureLimit,Math.ceil(n*this.numFeatures));this._features.length>p&&(this._features.length=p,this.featuresMissing=!0,5===this.fetchStatus&&(this.fetchStatus=4));return q};k._createClass(f,[{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&
(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},{key:"featureLimit",get:function(){return this._featureLimit},set:function(p){this._featureLimit!==p&&(this._featureLimit=p,this._estimatedUnusedSizeDirty=!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?
this._numFeatures:this._features?this._features.length:0},set:function(p){this._numFeatures=p}},{key:"hasPreciseFeatureCount",get:function(){return-1<this._numFeatures}},{key:"needsFeatureCount",get:function(){return-1===this._numFeatures}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){this.updateMemoryEstimates();return this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},
{key:"isFetching",get:function(){return 2===this.fetchStatus||3===this.fetchStatus}},{key:"isRefetching",get:function(){return 3===this.fetchStatus}},{key:"needsFetching",get:function(){return 0===this.fetchStatus||1===this.fetchStatus}},{key:"needsRefetching",get:function(){return 1===this.fetchStatus}},{key:"isFetched",get:function(){return 4===this.fetchStatus||5===this.fetchStatus}},{key:"needsDisplayUpdate",get:function(){var p;if(p=!!this._features){a:{p=this._features;var n=this.displayingFeatures,
w=this.featureLimit;if(!n||!p||w!==n.length||w>p.length)p=!1;else{for(let q=0;q<w;++q)if(p[q]!==n[q]){p=!1;break a}p=!0}}p=!p}return p}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(p){this.requestController=null;this._availableFields=p.availableFields;this._features=p.features;this._numFeatures=
p.numFeatures;this._emptyFeatureRatio=p.emptyFeatureRatio;this.fetchStatus=p.fetchStatus;this.featuresMissing=p.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}]);return f}();const e=l.create();b.FAILED_FEATURE_COUNT=-2;b.FeatureTile=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/TextSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../Graphic ../../terrain/TilingScheme".split(" "),
function(b,k,a,r,l,h,d,c,e){const f=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let g=function(){function p(w,q,m){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=w;this.view=m;this.tilingScheme=new e(q);this.loadedSymbols=f.map(u=>new d(new r({material:{color:[u[0],
u[1],u[2],.6]},outline:{color:"black",size:1}})));this.loadingSymbols=[new d(new r({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new d(new r({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new d(new r({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}var n=p.prototype;n.destroy=function(){this.enabled=!1};n.update=function(){this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:w=>
w.isFetching,symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:w=>!w.isFetching,symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:w=>!w.isFetching,symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(w=>{this.view.graphics.removeMany(w)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(w=>{this.view.graphics.removeMany(w)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(w=>
{this.view.graphics.removeMany(w)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))};n.showDataExtent=function(w){this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);w&&(w=a.fromExtent(w),this.dataExtentGraphic=new c({geometry:w,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};n.synchronizeMaps=function(w,q){const m=[];w.forEach((u,
v)=>{const y=this.tileFetcher.test.getFeatureTileById(v);y&&q.filter(y)||(this.view.graphics.removeMany(u),m.push(v))});m.forEach(u=>w.delete(u));this.tileFetcher.test.forEachFeatureTile(u=>{if(q.filter(u)&&!w.has(u.id)){const [B,x,C]=u.descriptor.lij;this.tilingScheme.ensureMaxLod(B);var v=this.tilingScheme.getExtentGeometry(B,x,C),y=new c({geometry:v,symbol:q.symbols[B%q.symbols.length]});v=new c({geometry:v.center,symbol:new h({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",
border:{color:"black"}},symbolLayers:[new l({text:`${B}/${x}/${C}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})});y=[y,v];w.set(u.id,y);this.view.graphics.addMany(y)}})};k._createClass(p,[{key:"enabled",get:function(){return this._enabled},set:function(w){this._enabled=w;this.update()}}]);return p}();b.FeatureTileFetcher3DDebugger=g;b.default=g;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/EventedSet":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/Evented","../../../core/SetUtils"],function(b,k,a,r){a=function(l){function h(){var c=l.apply(this,arguments)||this;c._set=new Set;return c}k._inheritsLoose(h,l);var d=h.prototype;d.clear=function(){if(0<this._set.size){const c=this.toArray();this._set.clear();this.emit("after-changes",{type:2});this.emit("change",{added:[],removed:c})}};d.addMany=function(c){if(0!==c.length){for(const e of c)this._set.add(e);this.emit("after-changes",{type:1});this.emit("change",{added:c,removed:[]})}};
d.remove=function(c){this._set.delete(c)&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:[c]}))};d.removeMany=function(c){const e=[];for(const f of c)this._set.delete(f)&&e.push(f);0<e.length&&(this.emit("after-changes",{type:2}),this.emit("change",{added:[],removed:e}))};d.toArray=function(){return[...this._set]};d.find=function(c){let e;r.someSet(this._set,f=>c(f)?(e=f,!0):!1);return e};d.forEach=function(c){this._set.forEach(e=>c(e))};k._createClass(h,[{key:"length",
get:function(){return this._set.size}}]);return h}(a);b.EventedSet=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/SetUtils":function(){define(["exports"],function(b){b.someSet=function(k,a){for(const r of k.entries())if(a(r[0]))return!0;return!1};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/Error ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/watchUtils ../../support/Scheduler ../../../tasks/support/Query ../../../layers/graphics/hydratedFeatures ../../../renderers/support/renderingInfoUtils ../../../layers/graphics/controllers/FeatureTileController3D ./support/projectExtentUtils ./graphics/QueryEngine ./graphics/Graphics3DFeatureLikeLayerView".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A){b.FeatureLikeLayerView3D=t=>{t=function(D){function E(){var H=D.apply(this,arguments)||this;H.controller=null;H.asyncGraphicsUpdates=!1;H.suspendResumeExtentMode="computed";H.slicePlaneEnabled=!1;H.drapeSourceType=1;H.fullExtentInLocalViewSpatialReference=null;H.suspendResumeExtent=null;H._controllerCreated=!1;H.clippingExtent=null;H.supportsHeightUnitConversion=!0;H.pendingController=null;H.queryEngine=null;return H}k._inheritsLoose(E,D);
var G=E.prototype;G.initialize=function(){const H=this.layer;"isTable"in H&&H.isTable?this.addResolvingPromise(q.reject(new g("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:H}))):(this._set("graphics3d",new A({owner:this,layer:H,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.asyncGraphicsUpdates?1:0,suspendResumeExtentMode:this.suspendResumeExtentMode,
updateClippingExtent:I=>this.updateClippingExtent(I)})),this.updatingHandles.add(this,"asyncGraphicsUpdates",I=>{this.graphics3d.graphicsCore.preferredUpdatePolicy=I?1:0}),this.updatingHandles.add(this,"suspendResumeExtentMode",I=>{this.graphics3d.suspendResumeExtentMode=I}),this.addResolvingPromise(this.graphics3d.setup().then(()=>this.validateGeometryType()).then(()=>this.queryEngine=new z["default"]({layerView:this,task:u.Task.FEATURE_QUERY_ENGINE})).then(()=>C.toViewIfLocal(this)).then(I=>this.fullExtentInLocalViewSpatialReference=
I).then(()=>this.initializeController())),this.notifyChange("updating"))};G.destroy=function(){this.destroyPendingController();this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null));this.queryEngine&&(this.queryEngine.destroy(),this.queryEngine=null);this.loadedGraphics=null};G.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)};G.notifyGraphicUpdate=
function(H,I){this.graphics3d.graphicsCore.notifyGraphicUpdate(H,I)};G.getRenderingInfo=function(H,I,J){(H=B.getRenderingInfo(H,{renderer:I,arcade:J}))&&H.color&&(I=H.color,I[0]/=255,I[1]/=255,I[2]/=255);return H};G.getRenderingInfoAsync=async function(H,I,J,K){return B.getRenderingInfoAsync(H,{renderer:I,arcade:J,...K})};G.getGraphicFromGraphicUid=function(H){let I=null;this.loadedGraphics&&this.loadedGraphics.forEach(J=>{J.uid===H&&(I=y.hydrateGraphic(J,this.layer))});return I};G.whenGraphicBounds=
function(H,I){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(H,I):null};G.computeAttachmentOrigin=function(H,I){return this.graphics3d?this.graphics3d.graphicsCore.computeAttachmentOrigin(H,I):null};G.getSymbolLayerSize=function(H,I){return this.graphics3d?this.graphics3d.graphicsCore.getSymbolLayerSize(H,I):null};G.queryFeatures=function(H,I){return this.queryEngine.executeQuery(this._ensureQuery(H),l.get(I,"signal"))};G.queryObjectIds=function(H,I){return this.queryEngine.executeQueryForIds(this._ensureQuery(H),
l.get(I,"signal"))};G.queryFeatureCount=function(H,I){return this.queryEngine.executeQueryForCount(this._ensureQuery(H),l.get(I,"signal"))};G.queryExtent=function(H,I){return this.queryEngine.executeQueryForExtent(this._ensureQuery(H),l.get(I,"signal"))};G._ensureQuery=function(H){return l.isNone(H)?this.createQuery():v.from(H)};G.highlight=function(H){return this.graphics3d.highlight(H,this.layer.objectIdField)};G.maskOccludee=function(H){return this.graphics3d.maskOccludee(H)};G.canResume=function(){return!D.prototype.canResume.call(this)||
this.graphics3d&&this.graphics3d.suspended?!1:!0};G.getSuspendInfo=function(){const H=D.prototype.getSuspendInfo.call(this);return this.graphics3d?{...H,...this.graphics3d.suspendInfo}:H};G.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!(!(!this._controllerCreated||this.controller&&this.controller.updating)&&this.view.basemapTerrain&&this.view.basemapTerrain.ready&&!this.graphics3d.updating)};G.initializeController=async function(){const H=this.createController();this.pendingController=
H;await H.when();this.setControllerWhenInitialized(H)};G.setControllerWhenInitialized=async function(H){try{await this.when()}catch(I){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||this.destroyed?this.destroyPendingController():(await m.whenTrueOnce(this.view,"basemapTerrain.ready"),this.beforeSetController(H),this.pendingController=null,this.controller=H,this.loadedGraphics=H.graphics,this.notifyChange("updating"))};G.updateClippingExtent=function(H){this.clippingExtent=
H;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=H,!0}};G.validateGeometryType=function(){switch(this.layer.geometryType){case "multipatch":case "multipoint":return q.reject(new g("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType}))}};G._getResourceInfo=function(){const H=this.controller&&this.controller instanceof x?this.controller:
null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:H?H.maximumNumberOfFeatures:-1,totalNumberOfFeatures:H?H.serviceDataCount:-1,nodes:0,core:this.graphics3d.graphicsCore.performanceInfo,elevationUpdating:this.graphics3d.elevationAlignment.updating,visibilityFrustum:!this.graphics3d.frustumVisibility.suspended,visibilityScale:!this.graphics3d.scaleVisibility.suspended}};k._createClass(E,[{key:"legendEnabled",get:function(){var H,I;return this.canResume()&&!(null!=
(H=this.graphics3d)&&null!=(I=H.frustumVisibility)&&I.suspended)}},{key:"graphics3DGraphics",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null}},{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null}},{key:"symbolUpdateType",get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);
return E}(t);a.__decorate([c.property()],t.prototype,"loadedGraphics",void 0);a.__decorate([c.property({dependsOn:["graphics3d.suspended"]})],t.prototype,"suspended",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["graphics3d.frustumVisibility.suspended"]})],t.prototype,"legendEnabled",null);a.__decorate([c.property({dependsOn:["graphics3d.updating","controller.updating"]})],t.prototype,"updating",void 0);a.__decorate([c.property()],t.prototype,"controller",void 0);a.__decorate([c.property()],
t.prototype,"graphics3d",void 0);a.__decorate([c.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0);a.__decorate([c.property({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0);a.__decorate([c.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["graphics3d.suspendInfo"]})],t.prototype,"suspendInfo",void 0);return t=a.__decorate([f.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],t)};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(b,k,a,r){b.toViewIfLocal=function(l){const h=l.view.spatialReference,d=l.layer.fullExtent,c=d&&d.spatialReference;return c?c.equals(h)?k.resolve(d.clone()):a.canProject(c,h)?k.resolve(a.project(d,h)):l.view.state.isLocal?r.projectGeometry(d,h,l.layer.portalItem).then(e=>
!l.destroyed&&e?e:void 0).catch(()=>null):k.resolve(null):k.resolve(null)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../geometry/Extent ../../../../geometry/support/typeUtils ../../../../geometry ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query ../../../../layers/graphics/data/QueryEngine".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){const x=B["default"];b.QueryEngine=function(C){function z(t){t=C.call(this,t)||this;t._dataQueryEngineInstance=null;return t}k._inheritsLoose(z,C);var A=z.prototype;A.destroy=function(){this.clear()};A.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};A.executeQueryForIdSet=async function(t,D){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(t),
D)};A.executeQueryForCount=async function(t,D){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(t),D)};A.executeQueryForExtent=async function(t,D){const {count:E,extent:G}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(t),D);t=q.fromJSON(G);return{count:E,extent:t}};A.executeQueryForIds=async function(t,D){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(t),D)};A.executeQueryForLatestObservations=async function(t,D){t=await this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(t),
D);t=v.fromJSON(t);t.features.forEach(E=>{E.layer=this.layer;E.sourceLayer=this.layer});return t};A.executeQuery=async function(t,D){t=await this.dataQueryEngine.executeQuery(this._ensureQueryJSON(t),D);t=v.fromJSON(t);t.features.forEach(E=>{E.layer=this.layer;E.sourceLayer=this.layer});return t};A._ensureQueryJSON=function(t){if(l.isNone(t))return this.defaultQueryJSON;"outSpatialReference"in t&&!t.outSpatialReference&&(t.outSpatialReference=this.spatialReference);return t.toJSON()};A.ensureDataQueryEngine=
function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const t="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,D=this.layer.objectIdField,E=m.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),G=this.layer.fields.map(M=>M.toJSON()),H=this.layerView.view.resourceController.scheduler,I=this.task,J=this.spatialReference.toJSON(),K=this.layerView.graphics3d.graphicsCore.featureStore,{hasZ:L,hasM:S}=this.layerView;return this._dataQueryEngineInstance=
new x({hasZ:L,hasM:S,geometryType:E,fields:G,timeInfo:t,spatialReference:J,objectIdField:D,featureStore:K,scheduler:H,task:I})};k._createClass(z,[{key:"queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new y({outSpatialReference:this.spatialReference})).toJSON()}},{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}}]);
return z}(w);a.__decorate([c.property({constructOnly:!0})],b.QueryEngine.prototype,"layerView",void 0);a.__decorate([c.property({constructOnly:!0})],b.QueryEngine.prototype,"task",void 0);a.__decorate([c.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],b.QueryEngine.prototype,"spatialReference",void 0);a.__decorate([c.property({readOnly:!0,aliasOf:"layerView.layer"})],b.QueryEngine.prototype,"layer",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["layer.geometryType"]})],
b.QueryEngine.prototype,"queryGeometryType",null);a.__decorate([c.property({readOnly:!0,dependsOn:["spatialReference"]})],b.QueryEngine.prototype,"defaultQueryJSON",null);b.QueryEngine=a.__decorate([f.subclass("esri.views.3d.layers.graphics.QueryEngine")],b.QueryEngine);b.default=b.QueryEngine;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/lang ../../../core/maybe ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../core/unitUtils ../../../core/MemCache ../../../geometry/support/aaBoundingRect ../../support/PromiseQueue ../../support/FieldsIndex ./QueryEngineCapabilities ../../../geometry/support/aaBoundingBox ./projectionSupport ./attributeSupport ../../../chunks/spatialQuerySupport ./timeSupport ./QueryEngineResult".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x){function C(H){return H.every(I=>"exceedslimit"!==I.statisticType)}const z=new Set,A=new g.MemCacheStorage(2E6);let t=0,D=function(){function H(J){this.capabilities={query:q.queryCapabilities};this.geometryType=J.geometryType;this.hasM=J.hasM;this.hasZ=J.hasZ;this.objectIdField=J.objectIdField;this.spatialReference=J.spatialReference;this.definitionExpression=J.definitionExpression;this.featureStore=J.featureStore;this.aggregateAdapter=J.aggregateAdapter;
this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=J.timeInfo;J.cacheSpatialQueries&&(this._geometryQueryCache=new g.MemCache(t++ +"$$",A));this.fieldsIndex=new w(J.fields);J.scheduler&&J.task&&(this._frameQueue=new n,this._frameTask=J.scheduler.registerTask(J.task,K=>this._update(K),()=>0<this._frameQueue.length))}var I=H.prototype;I.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._frameQueue.cancelAll(),this._frameQueue=
null);this.clearCache();this._geometryQueryCache&&this._geometryQueryCache.destroy();this._changeHandle&&(this._changeHandle.remove(),this._changeHandle=null);this.fieldsIndex.destroy()};I.clearCache=function(){this._geometryQueryCache&&this._geometryQueryCache.clear();this._timeExtent=this._allItems=null};I.executeQuery=async function(J={},K){let L=a.clone(J),S;try{L=await this._schedule(()=>y.normalizeQuery(L,this.definitionExpression,this.spatialReference),K),L=await this._reschedule(()=>this._checkQuerySupport(L),
K),S=await this._reschedule(()=>this._executeGeometryQuery(L,K),K),S=await this._reschedule(()=>S.executeAggregateIdsQuery(L),K),S=await this._reschedule(()=>S.executeObjectIdsQuery(L),K),S=await this._reschedule(()=>S.executeTimeQuery(L),K),S=await this._reschedule(()=>S.executeAttributesQuery(L),K)}catch(M){if(M!==y.QUERY_ENGINE_EMPTY_RESULT)throw M;S=new x([],null,this)}return S.createQueryResponse(L)};I.executeQueryForCount=async function(J={},K){let L=a.clone(J),S;L.returnGeometry=!1;L.returnCentroid=
!1;L.outSR=null;try{L=await this._schedule(()=>y.normalizeQuery(L,this.definitionExpression,this.spatialReference),K),L=await this._reschedule(()=>this._checkQuerySupport(L),K),S=await this._reschedule(()=>this._executeGeometryQuery(L,K),K),S=await this._reschedule(()=>S.executeAggregateIdsQuery(L),K),S=await this._reschedule(()=>S.executeObjectIdsQuery(L),K),S=await this._reschedule(()=>S.executeTimeQuery(L),K),S=await this._reschedule(()=>S.executeAttributesQuery(L),K)}catch(M){if(M!==y.QUERY_ENGINE_EMPTY_RESULT)throw M;
return 0}return S.createQueryResponseForCount(L)};I.executeQueryForExtent=async function(J={},K){let L=a.clone(J),S;J=L.outSR;try{L=await this._schedule(()=>y.normalizeQuery(L,this.definitionExpression,this.spatialReference),K);L=await this._reschedule(()=>this._checkQuerySupport(L),K);L.returnGeometry=!0;L.returnCentroid=!1;L.outSR=null;S=await this._reschedule(()=>this._executeGeometryQuery(L,K),K);S=await this._reschedule(()=>S.executeAggregateIdsQuery(L),K);S=await this._reschedule(()=>S.executeObjectIdsQuery(L),
K);S=await this._reschedule(()=>S.executeTimeQuery(L),K);S=await this._reschedule(()=>S.executeAttributesQuery(L),K);const M=S.size;if(!M)return{count:M,extent:null};m.set(G,m.NEGATIVE_INFINITY);this.featureStore.forEachBounds(S.items,Q=>m.expandWithAABB(G,Q),E);const T={xmin:G[0],ymin:G[1],xmax:G[3],ymax:G[4],spatialReference:y.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(G[2])&&isFinite(G[5])&&(T.zmin=G[2],T.zmax=G[5]);const O=u.project(T,S.spatialReference,J);O.spatialReference=
y.cleanFromGeometryEngine(J||this.spatialReference);if(0===O.xmax-O.xmin){const Q=f.getMetersPerUnitForSR(O.spatialReference);O.xmin-=Q;O.xmax+=Q}if(0===O.ymax-O.ymin){const Q=f.getMetersPerUnitForSR(O.spatialReference);O.ymin-=Q;O.ymax+=Q}if(this.hasZ&&null!=O.zmin&&null!=O.zmax&&0===O.zmax-O.zmin){const Q=f.getMetersPerUnitForSR(O.spatialReference);O.zmin-=Q;O.zmax+=Q}return{count:M,extent:O}}catch(M){if(M===y.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw M;}};I.executeQueryForIds=
async function(J={},K){return this.executeQueryForIdSet(J,K).then(L=>Array.from(L))};I.executeQueryForIdSet=async function(J={},K){let L=a.clone(J),S;L.returnGeometry=!1;L.returnCentroid=!1;L.outSR=null;try{L=await this._schedule(()=>y.normalizeQuery(L,this.definitionExpression,this.spatialReference),K);L=await this._reschedule(()=>this._checkQuerySupport(L),K);S=await this._reschedule(()=>this._executeGeometryQuery(L,K),K);S=await this._reschedule(()=>S.executeAggregateIdsQuery(L),K);S=await this._reschedule(()=>
S.executeObjectIdsQuery(L),K);S=await this._reschedule(()=>S.executeTimeQuery(L),K);S=await this._reschedule(()=>S.executeAttributesQuery(L),K);const M=S.items,T=new Set;await this._reschedule(()=>{for(const O of M)T.add(S.featureAdapter.getObjectId(O))},K);return T}catch(M){if(M===y.QUERY_ENGINE_EMPTY_RESULT)return new Set;throw M;}};I.executeQueryForLatestObservations=async function(J={},K){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new l("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",
{query:J,timeInfo:this.timeInfo});let L=a.clone(J),S;try{L=await this._schedule(()=>y.normalizeQuery(L,this.definitionExpression,this.spatialReference),K),L=await this._reschedule(()=>this._checkQuerySupport(L),K),S=await this._reschedule(()=>this._executeGeometryQuery(L,K),K),S=await this._reschedule(()=>S.executeAggregateIdsQuery(L),K),S=await this._reschedule(()=>S.executeObjectIdsQuery(L),K),S=await this._reschedule(()=>S.executeTimeQuery(L),K),S=await this._reschedule(()=>S.executeAttributesQuery(L),
K),S=await this._reschedule(()=>S.filterLatest(),K)}catch(M){if(M!==y.QUERY_ENGINE_EMPTY_RESULT)throw M;S=new x([],null,this)}return S.createQueryResponse(L)};I._schedule=async function(J,K){return this._frameQueue?this._frameQueue.push(J,K):J()};I._reschedule=async function(J,K){return this._frameQueue?this._frameQueue.unshift(J,K):J()};I._update=function(J){for(this._budget=J;!J.done&&this._frameQueue&&this._frameQueue.process();)J.madeProgress();this._budget=null};I._getAll=function(){if(!this._allItems){const J=
[];this.featureStore.forEach(K=>J.push(K));this._allItems=new x(J,null,this)}return this._allItems};I._executeGeometryQuery=async function(J,K){const {geometry:L,outSR:S,spatialRel:M}=J,T=d.isValid(S)&&!d.equals(this.spatialReference,S),O=this._geometryQueryCache?T?JSON.stringify({geometry:L,spatialRelationship:M,outSpatialReference:S}):JSON.stringify({geometry:L,spatialRelationship:M}):null;if(O){var Q=this._geometryQueryCache.get(O);if(!r.isUndefined(Q))return Q}Q=async U=>{if(T&&(J.returnGeometry||
J.returnCentroid))return U=await U.project(S),O&&this._geometryQueryCache.put(O,U,U.size||1),U;O&&this._geometryQueryCache.put(O,U,U.size||1);return U};if(!L)return Q(this._getAll());const F=this.featureAdapter;if("esriSpatialRelDisjoint"===M){const U=this._searchFeatures(this._getQueryBBoxes(L));if(!U.length)return Q(this._getAll());let V,W;const X=new Set;for(var N of U)X.add(F.getObjectId(N));await this._reschedule(()=>{let ca=0;V=Array(X.size);this.featureStore.forEach(R=>V[ca++]=R);W=X},K);N=
await this._reschedule(async()=>{const ca=await y.getSpatialQueryOperator(M,L,this.geometryType,this.hasZ,this.hasM);return new x(await this._runSpatialFilter(V,R=>!W.has(F.getObjectId(R))||ca(F.getGeometry(R)),K),L,this)},K);return Q(N)}N=this._searchFeatures(this._getQueryBBoxes(L));if(!N.length)return Q=new x([],L,this),O&&this._geometryQueryCache.put(O,Q,Q.size||1),Q;if(this._canExecuteSoloPass(L,J))return Q(new x(N,L,this));const P=await y.getSpatialQueryOperator(M,L,this.geometryType,this.hasZ,
this.hasM);N=await this._runSpatialFilter(N,U=>P(F.getGeometry(U)),K);return Q(new x(N,L,this))};I._runSpatialFilter=async function(J,K,L){if(!K)return J;if(!this._budget)return J.filter(O=>K(O));let S=0;const M=[],T=async()=>{for(;S<J.length;){const O=J[S];K(O)&&M.push(O);this._budget.done&&await this._reschedule(()=>T(),L);++S}};return this._reschedule(()=>T(),L).then(()=>M)};I._canExecuteSoloPass=function(J,K){const {geometryType:L}=this;({spatialRel:K}=K);return y.canQueryWithRBush(J)&&("esriSpatialRelEnvelopeIntersects"===
K||"esriGeometryPoint"===L&&("esriSpatialRelIntersects"===K||"esriSpatialRelContains"===K||"esriSpatialRelWithin"===K))};I._getQueryBBoxes=function(J){if(y.canQueryWithRBush(J)){if(e.isExtent(J))return[p.fromValues(J.xmin,J.ymin,J.xmax,J.ymax)];if(e.isPolygon(J))return J.rings.map(K=>p.fromValues(Math.min(K[0][0],K[2][0]),Math.min(K[0][1],K[2][1]),Math.max(K[0][0],K[2][0]),Math.max(K[0][1],K[2][1])))}return[c.getBoundsXY(p.create(),J)]};I._searchFeatures=function(J){for(const S of J)this.featureStore.forEachInBounds(S,
M=>{z.add(M)});const K=Array(z.size);let L=0;z.forEach(S=>K[L++]=S);z.clear();return K};I._checkQuerySupport=async function(J){if(0>J.distance||null!=J.geometryPrecision||J.multipatchOption||J.pixelSize||J.relationParam||J.text)throw new l("feature-store:unsupported-query","Unsupported query options",{query:J});return h.all([this._checkAttributesQuerySupport(J),this._checkStatisticsQuerySupport(J),y.checkSpatialQuerySupport(J,this.geometryType,this.spatialReference),u.checkProjectionSupport(this.spatialReference,
J.outSR)]).then(()=>J)};I._checkAttributesQuerySupport=function(J){const {outFields:K,orderByFields:L,returnDistinctValues:S,outStatistics:M}=J,T=M?M.map(O=>O.outStatisticFieldName&&O.outStatisticFieldName.toLowerCase()):[];if(L&&0<L.length){const O=L.map(Q=>{const F=Q.toLowerCase();return-1<F.indexOf(" asc")?F.split(" asc")[0]:-1<F.indexOf(" desc")?F.split(" desc")[0]:Q}).filter(Q=>-1===T.indexOf(Q));v.validateFields(this.fieldsIndex,O,"orderByFields contains missing fields")}if(K&&0<K.length)v.validateFields(this.fieldsIndex,
K,"outFields contains missing fields");else if(S)throw new l("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:J});v.validateWhere(this.fieldsIndex,J.where)};I._checkStatisticsQuerySupport=async function(J){const {outStatistics:K,groupByFieldsForStatistics:L,having:S}=J;var M=L&&L.length,T=K&&K.length;if(S){if(!M||!T)throw new l("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:J});
v.validateHaving(this.fieldsIndex,S,K)}if(T&&C(K)){T=K.map(O=>O.onStatisticField);v.validateFields(this.fieldsIndex,T,"onStatisticFields contains missing fields");M&&v.validateFields(this.fieldsIndex,L,"groupByFieldsForStatistics contains missing fields");for(const O of K){const {onStatisticField:Q,statisticType:F}=O;if(("percentile_disc"===F||"percentile_cont"===F)&&"statisticParameters"in O){if({statisticParameters:M}=O,!M)throw new l("feature-store:unsupported-query","statisticParamters should be set for percentile type",
{definition:O,query:J});}else if("count"!==F&&Q&&v.hasInvalidFieldType(Q,this.fieldsIndex))throw new l("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:O,query:J});}}};k._createClass(H,[{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){const J=this.featureStore.fullBounds;return J?{xmin:J[0],ymin:J[1],xmax:J[2],ymax:J[3],spatialReference:y.cleanFromGeometryEngine(this.spatialReference)}:null}},{key:"timeExtent",
get:function(){return this.timeInfo?this._timeExtent?this._timeExtent:this._timeExtent=B.getTimeExtent(this.timeInfo,this.featureStore):null}}]);return H}();const E=m.create(),G=m.create();b.Feature=function(H,I=null,J,K,L){this.attributes=H;this.geometry=J;this.centroid=K;this.filterFlags=L;this.groupId=-1;this.displayId=I};b.default=D;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["exports"],function(b){b.queryCapabilities=
{supportsStatistics:!0,supportsPercentileStatistics:!0,supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,
supportsDisjointSpatialRelationship:!0,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../core/promiseUtils ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../geometry/projection ../../../geometry/geometryAdapters/json".split(" "),function(b,k,a,r,l,h){function d(w,
q){if(!q)return null;if("x"in q){var m={x:0,y:0};[m.x,m.y]=w(q.x,q.y,f);null!=q.z&&(m.z=q.z);null!=q.m&&(m.m=q.m);return m}if("xmin"in q)return m={xmin:0,ymin:0,xmax:0,ymax:0},[m.xmin,m.ymin]=w(q.xmin,q.ymin,f),[m.xmax,m.ymax]=w(q.xmax,q.ymax,f),q.hasZ&&(m.zmin=q.zmin,m.zmax=q.zmax,m.hasZ=!0),q.hasM&&(m.mmin=q.mmin,m.mmax=q.mmax,m.hasM=!0),m;if("rings"in q)return{rings:c(q.rings,w),hasM:q.hasM,hasZ:q.hasZ};if("paths"in q)return{paths:c(q.paths,w),hasM:q.hasM,hasZ:q.hasZ};if("points"in q)return{points:e(q.points,
w),hasM:q.hasM,hasZ:q.hasZ}}function c(w,q){const m=[];for(const u of w)m.push(e(u,q));return m}function e(w,q){const m=[];for(const u of w)w=q(u[0],u[1],[0,0]),m.push(w),2<u.length&&w.push(u[2]),3<u.length&&w.push(u[3]);return m}const f=[0,0],g=d.bind(null,r.lngLatToXY),p=d.bind(null,r.xyToLngLat),n=new (function(){function w(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}var q=w.prototype;q.push=async function(m,u,v){m&&m.length&&u&&v&&a.equals(u,v);const y={geometries:m,
inSpatialReference:u,outSpatialReference:v,resolve:null};this._jobs.push(y);return k.create(B=>{y.resolve=B;null===this._timer&&(this._timer=setTimeout(this._process,10))})};q._process=function(){this._timer=null;const m=this._jobs.shift();if(m){var {geometries:u,inSpatialReference:v,outSpatialReference:y,resolve:B}=m;r.canProject(v,y)?a.isWebMercator(y)?B(u.map(g)):B(u.map(p)):B(l.projectMany(h.jsonAdapter,u,v,y,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return w}());
b.checkProjectionSupport=async function(w,q){q&&(w=Array.isArray(w)?w.map(m=>{var u;return null==(u=m.geometry)?void 0:u.spatialReference}):[w],await l.initializeProjection(w.map(m=>({source:m,dest:q}))))};b.project=function(w,q,m){if(!w)return w;m||(m=q,q=w.spatialReference);return a.isValid(q)&&a.isValid(m)&&!a.equals(q,m)?r.canProject(q,m)?a.isWebMercator(m)?g(w):p(w):l.projectMany(h.jsonAdapter,[w],q,m,null)[0]:w};b.projectMany=async function(w,q,m){return n.push(w,q,m)};Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(b){let k=function(d,c,e){this.x=d;this.y=c;this.spatialReference=e;this.m=this.z=void 0},a=function(d,c,e,f){this.rings=d;this.spatialReference=c;this.hasM=this.hasZ=void 0;e&&(this.hasZ=e);f&&(this.hasM=f)},r=function(d,c,e,f){this.paths=d;this.spatialReference=c;this.hasM=this.hasZ=void 0;e&&(this.hasZ=e);f&&(this.hasM=f)},l=function(d,c,e,f){this.points=d;this.spatialReference=c;this.hasM=this.hasZ=
void 0;e&&(this.hasZ=e);f&&(this.hasM=f)},h=function(d,c,e,f,g){this.xmin=d;this.ymin=c;this.xmax=e;this.ymax=f;this.spatialReference=g;this.mmax=this.mmin=this.zmax=this.zmin=void 0};b.jsonAdapter={convertToGEGeometry:function(d,c){return null==c?null:d.convertJSONToGeometry(c)},exportPoint:function(d,c,e){e=new k(d.getPointX(c),d.getPointY(c),e);const f=d.hasZ(c),g=d.hasM(c);f&&(e.z=d.getPointZ(c));g&&(e.m=d.getPointM(c));return e},exportPolygon:function(d,c,e){return new a(d.exportPaths(c),e,d.hasZ(c),
d.hasM(c))},exportPolyline:function(d,c,e){return new r(d.exportPaths(c),e,d.hasZ(c),d.hasM(c))},exportMultipoint:function(d,c,e){return new l(d.exportPoints(c),e,d.hasZ(c),d.hasM(c))},exportExtent:function(d,c,e){var f=d.hasZ(c);const g=d.hasM(c);e=new h(d.getXMin(c),d.getYMin(c),d.getXMax(c),d.getYMax(c),e);f&&(f=d.getZExtent(c),e.zmin=f.vmin,e.zmax=f.vmax);g&&(d=d.getMExtent(c),e.mmin=d.vmin,e.mmax=d.vmax);return e}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports",
"../../../core/Error","../../../core/sql/WhereClauseCache"],function(b,k,a){function r(e,f){return e?d.get(e,f):null}function l(e,f,g,p=!0){const n=[];for(const w of f)if("*"!==w&&!e.has(w))if(p){f=h(w);try{const q=r(f,e);if(!q)throw new k("feature-store:unsupported-query","invalid SQL expression",{where:f});if(!q.isStandardized)throw new k("feature-store:unsupported-query","expression is not standard",{clause:q});l(e,q.fieldNames,"expression contains missing fields")}catch(q){if((f=q&&q.details)&&
(f.clause||f.where))throw q;f&&f.missingFields?n.push(...f.missingFields):n.push(w)}}else n.push(w);if(n.length)throw new k("feature-store:unsupported-query",g,{missingFields:n});}function h(e){return e.split(" as ")[0]}const d=new a.WhereClauseCache(50,500),c=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));b.getAliasFromFieldName=function(e){return e.split(" as ")[1]};b.getExpressionFromFieldName=
h;b.getWhereClause=r;b.hasInvalidFieldType=function(e,f){return(e=f.get(e))?!c.has(e.type):!1};b.validateFields=l;b.validateHaving=function(e,f,g){if(!f)return!0;const p=d.get(f,e);if(!p)throw new k("feature-store:unsupported-query","invalid SQL expression",{having:f});if(!p.isAggregate)throw new k("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:f});l(e,p.fieldNames,"having contains missing fields");if(!p.getExpressions().every(n=>{const {aggregateType:w,
field:q}=n,m=e.has(q)&&e.get(q).name;return g.some(u=>{const {onStatisticField:v,statisticType:y}=u;return(e.has(v)&&e.get(v).name)===m&&y.toLowerCase().trim()===w})}))throw new k("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:f});return!0};b.validateWhere=function(e,f){if(!f)return!0;const g=d.get(f,e);if(!g)throw new k("feature-store:unsupported-query","invalid SQL expression",{where:f});if(!g.isStandardized)throw new k("feature-store:unsupported-query",
"where clause is not standard",{where:f});l(e,g.fieldNames,"where clause contains missing fields");return!0};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../ItemCache","./WhereClause"],function(b,k,a){let r=function(){function l(h,d){this._cache=new k(h);this._invalidCache=new k(d)}l.prototype.get=function(h,d){const c=`${d.uid}:${h}`,e=this._cache.get(c);if(e)return e;if(void 0!==this._invalidCache.get(c))return null;try{const f=
a.WhereClause.create(h,d);this._cache.put(c,f);return f}catch{return this._invalidCache.put(c,null),null}};return l}();b.WhereClauseCache=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/sql/WhereClause":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../has ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(b,k,a,r,l,h){function d(I,J){I+="";return I.length>=J?I:Array(J-I.length+1).join("0")+I}function c(I,J,K="0",L="0",S="0",M="0",
T="",O="0",Q="0"){return"+"===T||"-"===T?(I=`${d(parseInt(I,10),4)}-${d(parseInt(J,10),2)}-${d(parseInt(K,10),2)}`,J="",10>parseFloat(M)&&(J="0"),L=`${d(parseInt(L,10),2)}:${d(parseInt(S,10),2)}:${J+parseFloat(M).toString()}`,T=`${T}${d(parseInt(O,10),2)}:${d(parseInt(Q,10),2)}`,new Date(I+"T"+L+T)):new Date(parseInt(I,10),parseInt(J,10)-1,parseInt(K,10),parseInt(L,10),parseInt(S,10),parseFloat(M))}function e(I){let J=z.exec(I);if(null!==J){const [,K,L,S,M,T,O]=J;return c(K,L,S,M,T,O)}J=A.exec(I);
if(null!==J){const [,K,L,S,M,T,O,Q,F,N]=J;return c(K,L,S,M,T,O,Q,F,N)}J=t.exec(I);if(null!==J){const [,K,L,S,M,T,O,Q,F]=J;return c(K,L,S,M,T,"0",O,Q,F)}J=D.exec(I);if(null!==J){const [,K,L,S,M,T]=J;return c(K,L,S,M,T)}J=C.exec(I);if(null!==J){const [,K,L,S]=J;return c(K,L,S)}throw Error("SQL Invalid Timestamp");}function f(I){I=C.exec(I);if(null===I)throw Error("SQL Invalid Date");const [,J,K,L]=I;return new Date(parseInt(J,10),parseInt(K,10)-1,parseInt(L,10))}function g(I){return Array.isArray(I)?
I:[I]}function p(I){return null!==I?!0!==I:null}function n(I,J){return null!=I&&null!=J?!0===I&&!0===J:!1===I||!1===J?!1:null}function w(I,J){return null!=I&&null!=J?!0===I||!0===J:!0===I||!0===J?!0:null}function q(I,J){if(null==I)return null;let K=!1;for(const L of J)if(null==L)K=null;else if(I===L){K=!0;break}return K}function m(I,J,K){if(null==I)return null;let L="",S=0;for(let M=0;M<J.length;M++){const T=J.charAt(M);switch(S){case 0:T===K?S=1:L=0<="-[]/{}()*+?.\\^$|".indexOf(T)?L+("\\"+T):"%"===
T?L+".*":"_"===T?L+".":L+T;break;case 1:L=0<="-[]/{}()*+?.\\^$|".indexOf(T)?L+("\\"+T):L+T,S=0}}return(new RegExp("^"+L+"$")).test(I)}function u(I){return I instanceof Date?I.valueOf():I}function v(I,J,K){if(null==J||null==K)return null;J=u(J);K=u(K);switch(I){case "\x3c\x3e":return J!==K;case "\x3d":return J===K;case "\x3e":return J>K;case "\x3c":return J<K;case "\x3e\x3d":return J>=K;case "\x3c\x3d":return J<=K}}function y(I){const J=[],K={};for(const L of I)I=L.toLowerCase(),void 0===K[I]&&(J.push(L),
K[I]=1);return J}function B(I,J,K){if(J instanceof l.SqlInterval)if(K instanceof Date)switch(I){case "+":return new Date(J.valueInMilliseconds()+K.getTime());case "-":return J.valueInMilliseconds()-K.getTime();case "*":return J.valueInMilliseconds()*K.getTime();case "/":return J.valueInMilliseconds()/K.getTime()}else if(K instanceof l.SqlInterval)switch(I){case "+":return l.SqlInterval.createFromMilliseconds(J.valueInMilliseconds()+K.valueInMilliseconds());case "-":return l.SqlInterval.createFromMilliseconds(J.valueInMilliseconds()-
K.valueInMilliseconds());case "*":return J.valueInMilliseconds()*K.valueInMilliseconds();case "/":return J.valueInMilliseconds()/K.valueInMilliseconds()}else J=J.valueInMilliseconds();else if(K instanceof l.SqlInterval)if(J instanceof Date)switch(I){case "+":return new Date(K.valueInMilliseconds()+J.getTime());case "-":return new Date(J.getTime()-K.valueInMilliseconds());case "*":return J.getTime()*K.valueInMilliseconds();case "/":return J.getTime()/K.valueInMilliseconds()}else K=K.valueInMilliseconds();
else if(J instanceof Date&&"number"===typeof K)switch(K*=864E5,J=J.getTime(),I){case "+":return new Date(J+K);case "-":return new Date(J-K);case "*":return new Date(J*K);case "/":return new Date(J/K)}else if(K instanceof Date&&"number"===typeof J)switch(J*=864E5,K=K.getTime(),I){case "+":return new Date(J+K);case "-":return new Date(J-K);case "*":return new Date(J*K);case "/":return new Date(J/K)}switch(I){case "+":return J+K;case "-":return J-K;case "*":return J*K;case "/":return J/K}}function x(I,
J,K,L){I=L.getAttribute(I,J);return null!=I&&1===K[J]?new Date(I):I}const C=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,z=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,A=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,t=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,D=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/;let E=function(){function I(){}I.makeBool=function(J){return!0===J};I.featureValue=
function(J,K,L,S){return x(J,K,L,S)};I.equalsNull=function(J){return null===J};I.applyLike=function(J,K,L){return m(J,K,L)};I.ensureArray=function(J){return g(J)};I.applyIn=function(J,K){return q(J,K)};I.currentDate=function(){const J=new Date;J.setHours(0,0,0,0);return J};I.makeSqlInterval=function(J,K,L){return l.SqlInterval.createFromValueAndQualifer(J,K,L)};I.convertInterval=function(J){return J instanceof l.SqlInterval?J.valueInMilliseconds():J};I.currentTimestamp=function(){return new Date};
I.compare=function(J,K,L){return v(J,K,L)};I.calculate=function(J,K,L){return B(J,K,L)};I.makeComparable=function(J){return u(J)};I.evaluateFunction=function(J,K){return l.evaluateFunction(J,K)};I.lookup=function(J,K){J=K[J];return void 0===J?null:J};I.between=function(J,K){return null==J||null==K[0]||null==K[1]?null:J>=K[0]&&J<=K[1]};I.notbetween=function(J,K){return null==J||null==K[0]||null==K[1]?null:J<K[0]||J>K[1]};I.ternaryNot=function(J){return p(J)};I.ternaryAnd=function(J,K){return n(J,K)};
I.ternaryOr=function(J,K){return w(J,K)};return I}(),G=function(){function I(K,L){this.fieldsIndex=L;this.datefields={};this.parameters={};this.parseTree=h.WhereGrammar.parse(K);const {isStandardized:S,isAggregate:M,referencedFieldNames:T}=this.extractExpressionInfo(L);this.referencedFieldNames=T;this.isStandardized=S;this.isAggregate=M}I.create=function(K,L){return new I(K,L)};var J=I.prototype;J.testSet=function(K,L=H){const S={};for(const M of this.fieldNames)S[M]=K.map(T=>L.getAttribute(T,M));
return!!this.evaluateNode(this.parseTree,{attributes:S},H)};J.calculateValue=function(K,L=H){K=this.evaluateNode(this.parseTree,K,L);return K instanceof l.SqlInterval?K.valueInMilliseconds()/864E5:K};J.calculateValueCompiled=function(K,L=H){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(K,this.parameters,L,this.datefields);if(a("csp-restrictions"))return this.calculateValue(K,L);this.compileMe();return this.parseTree._compiledVersion(K,this.parameters,L,this.datefields)};
J.testFeature=function(K,L=H){return!!this.evaluateNode(this.parseTree,K,L)};J.testFeatureCompiled=function(K,L=H){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(K,this.parameters,L,this.datefields);if(a("csp-restrictions"))return this.testFeature(K,L);this.compileMe();return!!this.parseTree._compiledVersion(K,this.parameters,L,this.datefields)};J.getFunctions=function(){const K=[];this.visitAll(this.parseTree,L=>{"function"===L.type&&K.push(L.name.toLowerCase())});
return y(K)};J.getExpressions=function(){const K=new Map;this.visitAll(this.parseTree,L=>{if("function"===L.type){const S=L.name.toLowerCase();L=L.args.value[0];if("column_ref"===L.type){L=L.column;const M=`${S}-${L}`;K.has(M)||K.set(M,{aggregateType:S,field:L})}}});return[...K.values()]};J.getVariables=function(){const K=[];this.visitAll(this.parseTree,L=>{"param"===L.type&&K.push(L.value.toLowerCase())});return y(K)};J.compileMe=function(){const K="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+
")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",K)).bind(E)};J.extractExpressionInfo=function(K){const L=[];let S=!0,M=!0;this.visitAll(this.parseTree,T=>{switch(T.type){case "column_ref":{const O=K.get(T.column),Q=O&&O.name;!O||"date"!==O.type&&"esriFieldTypeDate"!==O.type||(this.datefields[O.name]=1);void 0!==Q?(L.push(Q),T.column=Q):L.push(T.column);break}case "function":{const {name:O,args:Q}=T;T=Q.value.length;S&&(S=l.isStandardized(O,T));
M&&(M=r.isAggregate(O,T))}}});return{referencedFieldNames:y(L),isStandardized:S,isAggregate:M}};J.visitAll=function(K,L){if(null!=K)switch(L(K),K.type){case "when_clause":this.visitAll(K.operand,L);this.visitAll(K.value,L);break;case "case_expression":for(const S of K.clauses)this.visitAll(S,L);"simple"===K.format&&this.visitAll(K.operand,L);null!==K.else&&this.visitAll(K.else,L);break;case "expr_list":for(const S of K.value)this.visitAll(S,L);break;case "unary_expr":this.visitAll(K.expr,L);break;
case "binary_expr":this.visitAll(K.left,L);this.visitAll(K.right,L);break;case "function":this.visitAll(K.args,L)}};J.evaluateNodeToJavaScript=function(K){switch(K.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(K.value)+", "+JSON.stringify(K.qualifier)+","+JSON.stringify(K.op)+")";case "case_expression":var L="";if("simple"===K.format){var S="this.makeComparable("+this.evaluateNodeToJavaScript(K.operand)+")";L="( ";for(let M=0;M<K.clauses.length;M++)L+=" ("+S+" \x3d\x3d\x3d this.makeComparable("+
this.evaluateNodeToJavaScript(K.clauses[M].operand)+")) ? ("+this.evaluateNodeToJavaScript(K.clauses[M].value)+") : "}else for(L="( ",S=0;S<K.clauses.length;S++)L+=" this.makeBool("+this.evaluateNodeToJavaScript(K.clauses[S].operand)+")\x3d\x3d\x3dtrue ? ("+this.evaluateNodeToJavaScript(K.clauses[S].value)+") : ";L=null!==K.else?L+this.evaluateNodeToJavaScript(K.else):L+"null";return L+=" )";case "param":return"this.lookup("+JSON.stringify(K.value.toLowerCase())+",lookups)";case "expr_list":L="[";
for(S of K.value)"["!==L&&(L+=","),L+=this.evaluateNodeToJavaScript(S);return L+="]";case "unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(K.expr)+")";case "binary_expr":switch(K.operator){case "AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+" )";case "IS":if("null"!==K.right.type)throw Error("Unsupported RHS for IS");
return"this.equalsNull("+this.evaluateNodeToJavaScript(K.left)+")";case "ISNOT":if("null"!==K.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(K.left)+")))";case "IN":return"this.applyIn("+this.evaluateNodeToJavaScript(K.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(K.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(K.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(K.right)+")))";
case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+","+JSON.stringify(K.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+
","+JSON.stringify(K.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(K.operator)+","+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(K.operator)+","+this.evaluateNodeToJavaScript(K.left)+","+this.evaluateNodeToJavaScript(K.right)+")"}throw Error("Not Supported Operator "+K.operator);case "null":case "bool":case "string":case "number":return JSON.stringify(K.value);
case "date":return"(new Date("+f(K.value).getTime().toString()+"))";case "timestamp":return"(new Date("+e(K.value).getTime().toString()+"))";case "current_time":return"date"===K.mode?"this.currentDate()":"this.currentTimestamp()";case "column_ref":return"this.featureValue(feature,"+JSON.stringify(K.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(K.name)+","+this.evaluateNodeToJavaScript(K.args)+")"}throw Error("Unsupported sql syntax "+K.type);
};J.evaluateNode=function(K,L,S){switch(K.type){case "interval":return L=this.evaluateNode(K.value,L,S),l.SqlInterval.createFromValueAndQualifer(L,K.qualifier,K.op);case "case_expression":if("simple"===K.format){var M=u(this.evaluateNode(K.operand,L,S));for(var T=0;T<K.clauses.length;T++)if(M===u(this.evaluateNode(K.clauses[T].operand,L,S)))return this.evaluateNode(K.clauses[T].value,L,S)}else for(M=0;M<K.clauses.length;M++)if(!0===this.evaluateNode(K.clauses[M].operand,L,S))return this.evaluateNode(K.clauses[M].value,
L,S);return null!==K.else?this.evaluateNode(K.else,L,S):null;case "param":return this.parameters[K.value.toLowerCase()];case "expr_list":M=[];for(T of K.value)M.push(this.evaluateNode(T,L,S));return M;case "unary_expr":return p(this.evaluateNode(K.expr,L,S));case "binary_expr":switch(K.operator){case "AND":return n(this.evaluateNode(K.left,L,S),this.evaluateNode(K.right,L,S));case "OR":return w(this.evaluateNode(K.left,L,S),this.evaluateNode(K.right,L,S));case "IS":if("null"!==K.right.type)throw Error("Unsupported RHS for IS");
return null===this.evaluateNode(K.left,L,S);case "ISNOT":if("null"!==K.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(K.left,L,S);case "IN":return M=g(this.evaluateNode(K.right,L,S)),q(this.evaluateNode(K.left,L,S),M);case "NOT IN":return M=g(this.evaluateNode(K.right,L,S)),p(q(this.evaluateNode(K.left,L,S),M));case "BETWEEN":return M=this.evaluateNode(K.left,L,S),K=this.evaluateNode(K.right,L,S),null==M||null==K[0]||null==K[1]?null:M>=u(K[0])&&M<=u(K[1]);case "NOTBETWEEN":return M=
this.evaluateNode(K.left,L,S),K=this.evaluateNode(K.right,L,S),null==M||null==K[0]||null==K[1]?null:M<u(K[0])||M>u(K[1]);case "LIKE":return m(this.evaluateNode(K.left,L,S),this.evaluateNode(K.right,L,S),K.escape);case "NOT LIKE":return p(m(this.evaluateNode(K.left,L,S),this.evaluateNode(K.right,L,S),K.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return v(K.operator,this.evaluateNode(K.left,L,S),this.evaluateNode(K.right,L,S));case "-":case "+":case "*":case "/":return B(K.operator,
this.evaluateNode(K.left,L,S),this.evaluateNode(K.right,L,S))}case "null":case "bool":case "string":case "number":return K.value;case "date":return f(K.value);case "timestamp":return e(K.value);case "current_time":return L=new Date,"date"===K.mode&&L.setHours(0,0,0,0),L;case "column_ref":return x(L,K.column,this.datefields,S);case "function":return L=this.evaluateNode(K.args,L,S),this.isAggregate?r.aggregateFunction(K.name,L):l.evaluateFunction(K.name,L)}throw Error("Unsupported sql syntax "+K.type);
};k._createClass(I,[{key:"fieldNames",get:function(){return this.referencedFieldNames}}]);return I}();const H={getAttribute(I,J){return(I&&"object"===typeof I.attributes?I.attributes:I)[J]}};b.WhereClause=G;b.defaultAttributeAdapter=H;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/sql/AggregateFunctions":function(){define(["exports"],function(b){function k(l){let h=0;for(let d=0;d<l.length;d++)h+=l[d];return h/l.length}function a(l){const h=k(l),d=l.length;let c=0;for(const e of l)c+=
Math.pow(e-h,2);return 1<d?c/(d-1):0}const r={min:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.min.apply(Math,l[0])},max:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.max.apply(Math,l[0])},avg:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:k(l[0])},sum:{minParams:1,maxParams:1,evaluate:l=>{if(null==l[0])l=null;else{{l=l[0];let h=0;for(let d=0;d<l.length;d++)h+=l[d];l=h}}return l}},stddev:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.sqrt(a(l[0]))},count:{minParams:1,
maxParams:1,evaluate:l=>null==l[0]?null:l[0].length},var:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:a(l[0])}};b.aggregateFunction=function(l,h){const d=r[l.toLowerCase()];if(null==d)throw Error("Function Not Recognised");if(h.length<d.minParams||h.length>d.maxParams)throw Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return d.evaluate(h)};b.isAggregate=function(l,h){l=r[l.toLowerCase()];return null!=l&&h>=l.minParams&&h<=l.maxParams};Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/core/sql/StandardizedFunctions":function(){define(["exports","../string"],function(b,k){let a=function(){function l(){this.op="+";this.minute=this.year=this.month=this.hour=this.second=this.day=0}l.fixDefaults=function(h){if(null!==h.precision||null!==h.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};l.createFromMilliseconds=function(h){const d=new l;d.second=h/1E3;return d};l.createFromValueAndQualifer=function(h,d,c){let e=null;const f=
new l;f.op="-"===c?"-":"+";if("interval-period"===d.type){l.fixDefaults(d);if("year"===d.period||"month"===d.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(h))f[d.period]=parseFloat(h);else throw Error("Illegal Interval");}else{l.fixDefaults(d.start);l.fixDefaults(d.end);if("year"===d.start.period||"month"===d.start.period)throw Error("Year-Month Intervals not supported");if("year"===d.end.period||"month"===d.end.period)throw Error("Year-Month Intervals not supported");
switch(d.start.period){case "day":switch(d.end.period){case "hour":e=/^[0-9]{1,} [0-9]{1,}$/;if(e.test(h))f[d.start.period]=parseFloat(h.split(" ")[0]),f[d.end.period]=parseFloat(h.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":e=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(e.test(h))f[d.start.period]=parseFloat(h.split(" ")[0]),h=h.split(" ")[1].split(":"),f.hour=parseFloat(h[0]),f.minute=parseFloat(h[1]);else throw Error("Illegal Interval");break;case "second":e=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;
if(e.test(h))f[d.start.period]=parseFloat(h.split(" ")[0]),h=h.split(" ")[1].split(":"),f.hour=parseFloat(h[0]),f.minute=parseFloat(h[1]),f.second=parseFloat(h[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "hour":switch(d.end.period){case "minute":e=/^[0-9]{1,}:[0-9]{1,}$/;if(e.test(h))f.hour=parseFloat(h.split(":")[0]),f.minute=parseFloat(h.split(":")[1]);else throw Error("Illegal Interval");break;case "second":e=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;
if(e.test(h))h=h.split(":"),f.hour=parseFloat(h[0]),f.minute=parseFloat(h[1]),f.second=parseFloat(h[2]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;case "minute":switch(d.end.period){case "second":e=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(e.test(h))h=h.split(":"),f.minute=parseFloat(h[0]),f.second=parseFloat(h[1]);else throw Error("Illegal Interval");break;default:throw"Invalid Interval.";}break;default:throw"Invalid Interval.";}}return f};l.prototype.valueInMilliseconds=
function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return l}();const r={extract:{minParams:2,maxParams:2,evaluate:([l,h])=>{if(null==h)return null;if(h instanceof Date)switch(l.toUpperCase()){case "SECOND":return h.getSeconds();case "MINUTE":return h.getMinutes();case "HOUR":return h.getHours();case "DAY":return h.getDate();case "MONTH":return h.getMonth()+1;case "YEAR":return h.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");
}},substring:{minParams:2,maxParams:3,evaluate:l=>{if(2===l.length){const [h,d]=l;return null==h||null==d?null:h.toString().substring(d-1)}if(3===l.length){const [h,d,c]=l;return null==h||null==d||null==c?null:0>=c?"":h.toString().substring(d-1,d+c-1)}}},position:{minParams:2,maxParams:2,evaluate:([l,h])=>null==l||null==h?null:h.indexOf(l)+1},trim:{minParams:2,maxParams:3,evaluate:l=>{var h=3===l.length,d=h?l[1]:" ";h=h?l[2]:l[1];if(null==d||null==h)return null;d=`(${k.escapeRegExpString(d)})`;switch(l[0]){case "BOTH":return h.replace(new RegExp(`^${d}*|${d}*$`,
"g"),"");case "LEADING":return h.replace(new RegExp(`^${d}*`,"g"),"");case "TRAILING":return h.replace(new RegExp(`${d}*$`,"g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.abs(l[0])},ceiling:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.ceil(l[0])},floor:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.floor(l[0])},log:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.log(l[0])},log10:{minParams:1,
maxParams:1,evaluate:l=>null==l[0]?null:Math.log(l[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.sin(l[0])},cos:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.cos(l[0])},tan:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.tan(l[0])},asin:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.asin(l[0])},acos:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.acos(l[0])},atan:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.atan(l[0])},
sign:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:0<l[0]?1:0>l[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:l=>null==l[0]||null==l[1]?null:Math.pow(l[0],l[1])},mod:{minParams:2,maxParams:2,evaluate:l=>null==l[0]||null==l[1]?null:l[0]%l[1]},round:{minParams:1,maxParams:2,evaluate:l=>{const h=l[0];l=2===l.length?Math.pow(10,l[1]):1;return null==h?null:Math.round(h*l)/l}},truncate:{minParams:1,maxParams:2,evaluate:l=>null==l[0]?null:1===l.length?parseInt(l[0].toFixed(0),10):parseFloat(l[0].toFixed(l[1]))},
char_length:{minParams:1,maxParams:1,evaluate:l=>"string"===typeof l[0]||l[0]instanceof String?l[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:l=>{let h="";for(let d=0;d<l.length;d++){if(null==l[d])return null;h+=l[d].toString()}return h}},lower:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:l[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:l[0].toString().toUpperCase()}};b.SqlInterval=a;b.evaluateFunction=function(l,h){const d=r[l.toLowerCase()];
if(null==d)throw Error("Function Not Recognised");if(h.length<d.minParams||h.length>d.maxParams)throw Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return d.evaluate(h)};b.isStandardized=function(l,h){l=r[l.toLowerCase()];return null!=l&&h>=l.minParams&&h<=l.maxParams};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(b,k){var a=k.createCommonjsModule(function(l){(function(h,d){l.exports&&
(l.exports=d())})(k.commonjsGlobal,function(){function h(d,c,e,f){this.message=d;this.expected=c;this.found=e;this.location=f;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,h)}(function(d,c){function e(){this.constructor=d}e.prototype=c.prototype;d.prototype=new e})(h,Error);h.buildMessage=function(d,c){function e(n){return n.charCodeAt(0).toString(16).toUpperCase()}function f(n){return n.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,
"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+e(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+e(w)})}function g(n){return n.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(w){return"\\x0"+e(w)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(w){return"\\x"+e(w)})}var p={literal:function(n){return'"'+
f(n.text)+'"'},"class":function(n){var w="",q;for(q=0;q<n.parts.length;q++)w+=n.parts[q]instanceof Array?g(n.parts[q][0])+"-"+g(n.parts[q][1]):g(n.parts[q]);return"["+(n.inverted?"^":"")+w+"]"},any:function(n){return"any character"},end:function(n){return"end of input"},other:function(n){return n.description}};return"Expected "+function(n){var w=Array(n.length),q;for(q=0;q<n.length;q++){var m=q;var u=n[q];u=p[u.type](u);w[m]=u}w.sort();if(0<w.length){for(n=q=1;q<w.length;q++)w[q-1]!==w[q]&&(w[n]=
w[q],n++);w.length=n}switch(w.length){case 1:return w[0];case 2:return w[0]+" or "+w[1];default:return w.slice(0,-1).join(", ")+", or "+w[w.length-1]}}(d)+" but "+(c?'"'+f(c)+'"':"end of input")+" found."};return{SyntaxError:h,parse:function(d,c){function e(va,Ba){return{type:"literal",text:va,ignoreCase:Ba}}function f(va,Ba,Aa){return{type:"class",parts:va,inverted:Ba,ignoreCase:Aa}}function g(va){var Ba=vc[va],Aa;if(!Ba){for(Aa=va-1;!vc[Aa];)Aa--;Ba=vc[Aa];for(Ba={line:Ba.line,column:Ba.column};Aa<
va;)10===d.charCodeAt(Aa)?(Ba.line++,Ba.column=1):Ba.column++,Aa++;vc[va]=Ba}return Ba}function p(va,Ba){var Aa=g(va),Ka=g(Ba);return{start:{offset:va,line:Aa.line,column:Aa.column},end:{offset:Ba,line:Ka.line,column:Ka.column}}}function n(va){pa<Gb||(pa>Gb&&(Gb=pa,Lc=[]),Lc.push(va))}function w(){var va=pa;var Ba=sa();if(Ba!==ha)if(Ba=m(),Ba!==ha){var Aa=sa();Aa!==ha?va=Ba:(pa=va,va=ha)}else pa=va,va=ha;else pa=va,va=ha;return va}function q(){var va=pa;var Ba=m();if(Ba!==ha){var Aa=[];var Ka=pa;
var Za=sa();if(Za!==ha){var fb=Ia();if(fb!==ha){var ib=sa();if(ib!==ha){var nb=m();nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,Ka=ha)}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha;for(;Ka!==ha;)Aa.push(Ka),Ka=pa,Za=sa(),Za!==ha?(fb=Ia(),fb!==ha?(ib=sa(),ib!==ha?(nb=m(),nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha);if(Aa!==ha){va={type:"expr_list"};Ba=[Ba];for(Ka=0;Ka<Aa.length;Ka++)Ba.push(Aa[Ka][3]);va.value=Ba}else pa=va,va=ha}else pa=va,va=ha;return va}function m(){var va=
pa;var Ba=u();if(Ba!==ha){var Aa=[];var Ka=pa;var Za=sa();if(Za!==ha){var fb=ea();if(fb!==ha){var ib=sa();if(ib!==ha){var nb=u();nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,Ka=ha)}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha;for(;Ka!==ha;)Aa.push(Ka),Ka=pa,Za=sa(),Za!==ha?(fb=ea(),fb!==ha?(ib=sa(),ib!==ha?(nb=u(),nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha);Aa!==ha?va=Ba=Ua(Ba,Aa):(pa=va,va=ha)}else pa=va,va=ha;return va}function u(){var va=pa;var Ba=v();if(Ba!==
ha){var Aa=[];var Ka=pa;var Za=sa();if(Za!==ha){var fb=fa();if(fb!==ha){var ib=sa();if(ib!==ha){var nb=v();nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,Ka=ha)}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha;for(;Ka!==ha;)Aa.push(Ka),Ka=pa,Za=sa(),Za!==ha?(fb=fa(),fb!==ha?(ib=sa(),ib!==ha?(nb=v(),nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha);Aa!==ha?va=Ba=Ua(Ba,Aa):(pa=va,va=ha)}else pa=va,va=ha;return va}function v(){var va=pa;var Ba=da();if(Ba===ha){Ba=pa;if(33===
d.charCodeAt(pa)){var Aa=db;pa++}else Aa=ha,0===Va&&n(mb);if(Aa!==ha){var Ka=pa;Va++;if(61===d.charCodeAt(pa)){var Za=Ea;pa++}else Za=ha,0===Va&&n(ya);Va--;Za===ha?Ka=void 0:(pa=Ka,Ka=ha);Ka!==ha?Ba=Aa=[Aa,Ka]:(pa=Ba,Ba=ha)}else pa=Ba,Ba=ha}Ba!==ha?(Aa=sa(),Aa!==ha?(Ka=v(),Ka!==ha?va=Ba={type:"unary_expr",operator:"NOT",expr:Ka}:(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha);if(va===ha)if(va=pa,Ba=C(),Ba!==ha)if(Aa=sa(),Aa!==ha){Aa=[];Ka=pa;Za=sa();if(Za!==ha){var fb=y();if(fb!==ha){var ib=sa();if(ib!==
ha){var nb=C();nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,Ka=ha)}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha;if(Ka!==ha)for(;Ka!==ha;)Aa.push(Ka),Ka=pa,Za=sa(),Za!==ha?(fb=y(),fb!==ha?(ib=sa(),ib!==ha?(nb=C(),nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha);else Aa=ha;Aa!==ha&&(Aa={type:"arithmetic",tail:Aa});Aa===ha&&(Aa=pa,Ka=x(),Ka!==ha?(Za=sa(),Za!==ha?(Za=Qa(),Za!==ha?(Za=sa(),Za!==ha?(Za=q(),Za!==ha?(fb=sa(),fb!==ha?(fb=Pa(),fb!==ha?Aa=Ka={op:Ka,right:Za}:
(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha),Aa===ha&&(Aa=pa,Ka=x(),Ka!==ha?(Za=sa(),Za!==ha?(Za=Qa(),Za!==ha?(Za=sa(),Za!==ha?(Za=Pa(),Za!==ha?Aa=Ka={op:Ka,right:{type:"expr_list",value:[]}}:(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha),Aa===ha&&(Aa=pa,Ka=x(),Ka!==ha?(Za=sa(),Za!==ha?(Za=J(),Za!==ha?Aa=Ka={op:Ka,right:Za}:(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha))),Aa===ha&&(Aa=pa,Za=da(),Za!==ha?(Ka=sa(),Ka!==
ha?(Ka=Y(),Ka!==ha?(fb=sa(),fb!==ha?(fb=C(),fb!==ha?(ib=sa(),ib!==ha?(ib=fa(),ib!==ha?(Za=sa(),Za!==ha?(Za=C(),Za!==ha?Aa=Za={op:"NOT"+Ka,right:{type:"expr_list",value:[fb,Za]}}:(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha),Aa===ha&&(Aa=pa,Za=Y(),Za!==ha?(Ka=sa(),Ka!==ha?(Ka=C(),Ka!==ha?(fb=sa(),fb!==ha?(fb=fa(),fb!==ha?(ib=sa(),ib!==ha?(ib=C(),ib!==ha?Aa=Za={op:Za,right:{type:"expr_list",value:[Ka,ib]}}:(pa=Aa,
Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)),Aa===ha&&(Aa=pa,Ka=aa(),Ka!==ha?(Za=sa(),Za!==ha?(Za=da(),Za!==ha?(Za=sa(),Za!==ha?(Za=C(),Za!==ha?Aa=Ka={op:Ka+"NOT",right:Za}:(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha),Aa===ha&&(Aa=pa,Ka=aa(),Ka!==ha?(Za=sa(),Za!==ha?(Za=C(),Za!==ha?Aa=Ka={op:Ka,right:Za}:(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)),Aa===ha&&(Aa=pa,Ka=B(),Ka!==ha?(Za=sa(),Za!==ha?(Za=O(),Za!==ha?(fb=
sa(),fb!==ha?(fb=pa,d.substr(pa,6).toLowerCase()===Jd?(ib=d.substr(pa,6),pa+=6):(ib=ha,0===Va&&n(Kd)),ib!==ha?(ib=pa,Va++,nb=H(),Va--,nb===ha?ib=void 0:(pa=ib,ib=ha),ib!==ha?fb="ESCAPE":(pa=fb,fb=ha)):(pa=fb,fb=ha),fb!==ha?(fb=sa(),fb!==ha?(fb=Q(),fb!==ha?Aa=Ka={op:Ka,right:Za,escape:fb.value}:(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha),Aa===ha&&(Aa=pa,Ka=B(),Ka!==ha?(Za=sa(),Za!==ha?(Za=O(),Za!==ha?Aa=Ka={op:Ka,right:Za,escape:""}:(pa=Aa,
Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha))))));Aa===ha&&(Aa=null);Aa!==ha?(va=Ba,Ba=Aa,""==Ba||void 0==Ba||null==Ba?Ba=va:(Aa=null,Ba=Aa="arithmetic"==Ba.type?Ua(va,Ba.tail):Ra(Ba.op,va,Ba.right,Ba.escape)),va=Ba):(pa=va,va=ha)}else pa=va,va=ha;else pa=va,va=ha;return va}function y(){if(d.substr(pa,2)===xa){var va=xa;pa+=2}else va=ha,0===Va&&n(wa);va===ha&&(62===d.charCodeAt(pa)?(va=ma,pa++):(va=ha,0===Va&&n(ta)),va===ha&&(d.substr(pa,2)===Da?(va=Da,pa+=2):(va=ha,0===Va&&n(Oa)),va===ha&&(d.substr(pa,2)===
Ja?(va=Ja,pa+=2):(va=ha,0===Va&&n(ra)),va===ha&&(60===d.charCodeAt(pa)?(va=Ca,pa++):(va=ha,0===Va&&n(Ma)),va===ha&&(61===d.charCodeAt(pa)?(va=Ea,pa++):(va=ha,0===Va&&n(ya)),va===ha&&(d.substr(pa,2)===Ta?(va=Ta,pa+=2):(va=ha,0===Va&&n(Xa))))))));return va}function B(){var va=va=pa;var Ba=da();if(Ba!==ha){var Aa=sa();if(Aa!==ha){var Ka=ka();Ka!==ha?va=Ba=[Ba,Aa,Ka]:(pa=va,va=ha)}else pa=va,va=ha}else pa=va,va=ha;va!==ha&&(va=va[0]+" "+va[2]);va===ha&&(va=ka());return va}function x(){var va=va=pa;var Ba=
da();if(Ba!==ha){var Aa=sa();if(Aa!==ha){var Ka=R();Ka!==ha?va=Ba=[Ba,Aa,Ka]:(pa=va,va=ha)}else pa=va,va=ha}else pa=va,va=ha;va!==ha&&(va=va[0]+" "+va[2]);va===ha&&(va=R());return va}function C(){var va=pa;var Ba=A();if(Ba!==ha){var Aa=[];var Ka=pa;var Za=sa();if(Za!==ha){var fb=z();if(fb!==ha){var ib=sa();if(ib!==ha){var nb=A();nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,Ka=ha)}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha;for(;Ka!==ha;)Aa.push(Ka),Ka=pa,Za=sa(),Za!==ha?(fb=z(),fb!==ha?(ib=sa(),ib!==
ha?(nb=A(),nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha);Aa!==ha?va=Ba=Ua(Ba,Aa):(pa=va,va=ha)}else pa=va,va=ha;return va}function z(){if(43===d.charCodeAt(pa)){var va=ab;pa++}else va=ha,0===Va&&n(gb);va===ha&&(45===d.charCodeAt(pa)?(va=bb,pa++):(va=ha,0===Va&&n(Ha)));return va}function A(){var va=pa;var Ba=D();if(Ba!==ha){var Aa=[];var Ka=pa;var Za=sa();if(Za!==ha){var fb=t();if(fb!==ha){var ib=sa();if(ib!==ha){var nb=D();nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,
Ka=ha)}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha}else pa=Ka,Ka=ha;for(;Ka!==ha;)Aa.push(Ka),Ka=pa,Za=sa(),Za!==ha?(fb=t(),fb!==ha?(ib=sa(),ib!==ha?(nb=D(),nb!==ha?Ka=Za=[Za,fb,ib,nb]:(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha)):(pa=Ka,Ka=ha);Aa!==ha?va=Ba=Ua(Ba,Aa):(pa=va,va=ha)}else pa=va,va=ha;return va}function t(){if(42===d.charCodeAt(pa)){var va=Na;pa++}else va=ha,0===Va&&n($a);va===ha&&(47===d.charCodeAt(pa)?(va=cb,pa++):(va=ha,0===Va&&n(eb)));return va}function D(){var va=Q();if(va===ha){var Ba=pa;
var Aa=pa;var Ka=U();if(Ka!==ha){var Za=V();if(Za!==ha){var fb=W();fb!==ha?Aa=Ka=parseFloat(Ka+Za+fb):(pa=Aa,Aa=ha)}else pa=Aa,Aa=ha}else pa=Aa,Aa=ha;Aa===ha&&(Aa=pa,Ka=U(),Ka!==ha?(Za=V(),Za!==ha?Aa=Ka=parseFloat(Ka+Za):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha),Aa===ha&&(Aa=pa,Ka=U(),Ka!==ha?(Za=W(),Za!==ha?Aa=Ka=parseFloat(Ka+Za):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha),Aa===ha&&(Aa=pa,Ka=U(),Ka!==ha&&(Ka=parseFloat(Ka)),Aa=Ka)));var ib=Aa;if(ib!==ha){var nb=pa;Va++;var Ld=G();Va--;Ld===ha?nb=void 0:(pa=nb,nb=ha);nb!==
ha?Ba=ib={type:"number",value:ib}:(pa=Ba,Ba=ha)}else pa=Ba,Ba=ha;va=Ba;if(va===ha){var fc=pa;var Tb=pa;if(d.substr(pa,4).toLowerCase()===Md){var wc=d.substr(pa,4);pa+=4}else wc=ha,0===Va&&n(Nd);if(wc!==ha){var gc=pa;Va++;var Od=H();Va--;Od===ha?gc=void 0:(pa=gc,gc=ha);gc!==ha?Tb=wc=[wc,gc]:(pa=Tb,Tb=ha)}else pa=Tb,Tb=ha;var Pb=Tb;Pb!==ha&&(Pb={type:"bool",value:!0});fc=Pb;if(fc===ha){fc=pa;var Ub=pa;if(d.substr(pa,5).toLowerCase()===Pd){var xc=d.substr(pa,5);pa+=5}else xc=ha,0===Va&&n(Qd);if(xc!==
ha){var hc=pa;Va++;var Rd=H();Va--;Rd===ha?hc=void 0:(pa=hc,hc=ha);hc!==ha?Ub=xc=[xc,hc]:(pa=Ub,Ub=ha)}else pa=Ub,Ub=ha;Pb=Ub;Pb!==ha&&(Pb={type:"bool",value:!1});fc=Pb}va=fc;if(va===ha){var Vb=pa;if(d.substr(pa,4).toLowerCase()===Sd){var yc=d.substr(pa,4);pa+=4}else yc=ha,0===Va&&n(Td);if(yc!==ha){var ic=pa;Va++;var Ud=H();Va--;Ud===ha?ic=void 0:(pa=ic,ic=ha);ic!==ha?Vb=yc=[yc,ic]:(pa=Vb,Vb=ha)}else pa=Vb,Vb=ha;var Mc=Vb;Mc!==ha&&(Mc={type:"null",value:null});va=Mc;if(va===ha){var Lb=pa;var Wb=pa;
if(d.substr(pa,4).toLowerCase()===Vd){var Nc=d.substr(pa,4);pa+=4}else Nc=ha,0===Va&&n(Wd);if(Nc!==ha){var zc=pa;Va++;var Xd=H();Va--;Xd===ha?zc=void 0:(pa=zc,zc=ha);zc!==ha?Wb=Nc="DATE":(pa=Wb,Wb=ha)}else pa=Wb,Wb=ha;var nd=Wb;if(nd!==ha){var Yd=sa();if(Yd!==ha){var od=O();od!==ha?Lb=nd={type:"date",value:od.value}:(pa=Lb,Lb=ha)}else pa=Lb,Lb=ha}else pa=Lb,Lb=ha;va=Lb;if(va===ha){var Mb=pa;var Xb=pa;if(d.substr(pa,9).toLowerCase()===Zd){var Oc=d.substr(pa,9);pa+=9}else Oc=ha,0===Va&&n($d);if(Oc!==
ha){var Ac=pa;Va++;var ae=H();Va--;ae===ha?Ac=void 0:(pa=Ac,Ac=ha);Ac!==ha?Xb=Oc="TIMESTAMP":(pa=Xb,Xb=ha)}else pa=Xb,Xb=ha;var pd=Xb;if(pd!==ha){var be=sa();if(be!==ha){var qd=O();qd!==ha?Mb=pd={type:"timestamp",value:qd.value}:(pa=Mb,Mb=ha)}else pa=Mb,Mb=ha}else pa=Mb,Mb=ha;va=Mb;if(va===ha){var qb=pa;var jc=ia();if(jc!==ha){var Pc=sa();if(Pc!==ha){if(45===d.charCodeAt(pa)){var Ib=bb;pa++}else Ib=ha,0===Va&&n(Ha);Ib===ha&&(43===d.charCodeAt(pa)?(Ib=ab,pa++):(Ib=ha,0===Va&&n(gb)));if(Ib!==ha){var Qc=
sa();if(Qc!==ha){var kc=O();if(kc!==ha){var ce=sa();if(ce!==ha){var rd=L();rd!==ha?qb=jc={type:"interval",value:kc,qualifier:rd,op:Ib}:(pa=qb,qb=ha)}else pa=qb,qb=ha}else pa=qb,qb=ha}else pa=qb,qb=ha}else pa=qb,qb=ha}else pa=qb,qb=ha}else pa=qb,qb=ha;qb===ha&&(qb=pa,jc=ia(),jc!==ha?(Pc=sa(),Pc!==ha?(Ib=O(),Ib!==ha?(Qc=sa(),Qc!==ha?(kc=L(),kc!==ha?qb=jc={type:"interval",value:Ib,qualifier:kc,op:""}:(pa=qb,qb=ha)):(pa=qb,qb=ha)):(pa=qb,qb=ha)):(pa=qb,qb=ha)):(pa=qb,qb=ha));va=qb}}}}}}var pb=va;if(pb===
ha){var tb=pa;var Yb=pa;if(d.substr(pa,7).toLowerCase()===de){var Rc=d.substr(pa,7);pa+=7}else Rc=ha,0===Va&&n(ee);if(Rc!==ha){var Bc=pa;Va++;var fe=H();Va--;fe===ha?Bc=void 0:(pa=Bc,Bc=ha);Bc!==ha?Yb=Rc="EXTRACT":(pa=Yb,Yb=ha)}else pa=Yb,Yb=ha;var sd=Yb;if(sd!==ha){var ge=sa();if(ge!==ha){var he=Qa();if(he!==ha){var ie=sa();if(ie!==ha){var Cb=ja();Cb===ha&&(Cb=la(),Cb===ha&&(Cb=qa(),Cb===ha&&(Cb=na(),Cb===ha&&(Cb=oa(),Cb===ha&&(Cb=ua())))));var td=Cb;if(td!==ha){var je=sa();if(je!==ha){var ke=Z();
if(ke!==ha){var le=sa();if(le!==ha){var ud=m();if(ud!==ha){var me=sa();if(me!==ha){var ne=Pa();ne!==ha?tb=sd={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:td},ud]}}:(pa=tb,tb=ha)}else pa=tb,tb=ha}else pa=tb,tb=ha}else pa=tb,tb=ha}else pa=tb,tb=ha}else pa=tb,tb=ha}else pa=tb,tb=ha}else pa=tb,tb=ha}else pa=tb,tb=ha}else pa=tb,tb=ha}else pa=tb,tb=ha;pb=tb;if(pb===ha){var sb=pa;var Zb=pa;if(d.substr(pa,9).toLowerCase()===oe){var Sc=d.substr(pa,9);pa+=9}else Sc=ha,
0===Va&&n(pe);if(Sc!==ha){var Cc=pa;Va++;var qe=H();Va--;qe===ha?Cc=void 0:(pa=Cc,Cc=ha);Cc!==ha?Zb=Sc="SUBSTRING":(pa=Zb,Zb=ha)}else pa=Zb,Zb=ha;var vd=Zb;if(vd!==ha){var re=sa();if(re!==ha){var se=Qa();if(se!==ha){var te=sa();if(te!==ha){var Tc=m();if(Tc!==ha){var ue=sa();if(ue!==ha){var ve=Z();if(ve!==ha){var we=sa();if(we!==ha){var Uc=m();if(Uc!==ha){var xe=sa();if(xe!==ha){var yb=pa;var $b=pa;if(d.substr(pa,3).toLowerCase()===ye){var Vc=d.substr(pa,3);pa+=3}else Vc=ha,0===Va&&n(ze);if(Vc!==ha){var Dc=
pa;Va++;var Ae=H();Va--;Ae===ha?Dc=void 0:(pa=Dc,Dc=ha);Dc!==ha?$b=Vc="FOR":(pa=$b,$b=ha)}else pa=$b,$b=ha;var lc=$b;if(lc!==ha){var wd=sa();if(wd!==ha){var xd=m();if(xd!==ha){var yd=sa();yd!==ha?yb=lc=[lc,wd,xd,yd]:(pa=yb,yb=ha)}else pa=yb,yb=ha}else pa=yb,yb=ha}else pa=yb,yb=ha;yb===ha&&(yb=null);yb!==ha?(lc=Pa(),lc!==ha?sb=vd={type:"function",name:"substring",args:{type:"expr_list",value:yb?[Tc,Uc,yb[2]]:[Tc,Uc]}}:(pa=sb,sb=ha)):(pa=sb,sb=ha)}else pa=sb,sb=ha}else pa=sb,sb=ha}else pa=sb,sb=ha}else pa=
sb,sb=ha}else pa=sb,sb=ha}else pa=sb,sb=ha}else pa=sb,sb=ha}else pa=sb,sb=ha}else pa=sb,sb=ha}else pa=sb,sb=ha;pb=sb;if(pb===ha){var jb=pa;var mc=ba();if(mc!==ha){var Wc=sa();if(Wc!==ha){var Xc=Qa();if(Xc!==ha){var Yc=sa();if(Yc!==ha){var Db=K();Db===ha&&(Db=null);if(Db!==ha){var Zc=sa();if(Zc!==ha){var nc=m();if(nc!==ha){var $c=sa();if($c!==ha){var ad=Z();if(ad!==ha){var Be=sa();if(Be!==ha){var zd=m();if(zd!==ha){var Ce=sa();if(Ce!==ha){var De=Pa();De!==ha?jb=mc={type:"function",name:"trim",args:{type:"expr_list",
value:[{type:"string",value:null==Db?"BOTH":Db},nc,zd]}}:(pa=jb,jb=ha)}else pa=jb,jb=ha}else pa=jb,jb=ha}else pa=jb,jb=ha}else pa=jb,jb=ha}else pa=jb,jb=ha}else pa=jb,jb=ha}else pa=jb,jb=ha}else pa=jb,jb=ha}else pa=jb,jb=ha}else pa=jb,jb=ha}else pa=jb,jb=ha}else pa=jb,jb=ha;jb===ha&&(jb=pa,mc=ba(),mc!==ha?(Wc=sa(),Wc!==ha?(Xc=Qa(),Xc!==ha?(Yc=sa(),Yc!==ha?(Db=K(),Db===ha&&(Db=null),Db!==ha?(Zc=sa(),Zc!==ha?(nc=m(),nc!==ha?($c=sa(),$c!==ha?(ad=Pa(),ad!==ha?jb=mc={type:"function",name:"trim",args:{type:"expr_list",
value:[{type:"string",value:null==Db?"BOTH":Db},nc]}}:(pa=jb,jb=ha)):(pa=jb,jb=ha)):(pa=jb,jb=ha)):(pa=jb,jb=ha)):(pa=jb,jb=ha)):(pa=jb,jb=ha)):(pa=jb,jb=ha)):(pa=jb,jb=ha)):(pa=jb,jb=ha));pb=jb;if(pb===ha){var ub=pa;var ac=pa;if(d.substr(pa,8).toLowerCase()===Ee){var bd=d.substr(pa,8);pa+=8}else bd=ha,0===Va&&n(Fe);if(bd!==ha){var Ec=pa;Va++;var Ge=H();Va--;Ge===ha?Ec=void 0:(pa=Ec,Ec=ha);Ec!==ha?ac=bd="POSITION":(pa=ac,ac=ha)}else pa=ac,ac=ha;var Ad=ac;if(Ad!==ha){var He=sa();if(He!==ha){var Ie=
Qa();if(Ie!==ha){var Je=sa();if(Je!==ha){var Bd=m();if(Bd!==ha){var Ke=sa();if(Ke!==ha){var Le=R();if(Le!==ha){var Me=sa();if(Me!==ha){var Cd=m();if(Cd!==ha){var Ne=sa();if(Ne!==ha){var Oe=Pa();Oe!==ha?ub=Ad={type:"function",name:"position",args:{type:"expr_list",value:[Bd,Cd]}}:(pa=ub,ub=ha)}else pa=ub,ub=ha}else pa=ub,ub=ha}else pa=ub,ub=ha}else pa=ub,ub=ha}else pa=ub,ub=ha}else pa=ub,ub=ha}else pa=ub,ub=ha}else pa=ub,ub=ha}else pa=ub,ub=ha}else pa=ub,ub=ha;pb=ub;if(pb===ha){var xb=pa;var oc;var Eb=
pa;Eb=oc=E();if(Eb===ha)if(Eb=pa,96===d.charCodeAt(pa)?(oc=Dd,pa++):(oc=ha,0===Va&&n(Ed)),oc!==ha){var Fc=[];if(Fd.test(d.charAt(pa))){var Jb=d.charAt(pa);pa++}else Jb=ha,0===Va&&n(Gd);if(Jb!==ha)for(;Jb!==ha;)Fc.push(Jb),Fd.test(d.charAt(pa))?(Jb=d.charAt(pa),pa++):(Jb=ha,0===Va&&n(Gd));else Fc=ha;Fc!==ha?(96===d.charCodeAt(pa)?(Jb=Dd,pa++):(Jb=ha,0===Va&&n(Ed)),Jb!==ha?Eb=oc=Fc.join(""):(pa=Eb,Eb=ha)):(pa=Eb,Eb=ha)}else pa=Eb,Eb=ha;var cd=Eb;if(cd!==ha){var Pe=sa();if(Pe!==ha){var Qe=Qa();if(Qe!==
ha){var Re=sa();if(Re!==ha){var pc=q();pc===ha&&(pc=null);if(pc!==ha){var Se=sa();if(Se!==ha){var Te=Pa();Te!==ha?xb=cd={type:"function",name:cd,args:pc?pc:{type:"expr_list",value:[]}}:(pa=xb,xb=ha)}else pa=xb,xb=ha}else pa=xb,xb=ha}else pa=xb,xb=ha}else pa=xb,xb=ha}else pa=xb,xb=ha}else pa=xb,xb=ha;pb=xb;if(pb===ha){var Ab;var ob=pa;var qc=za();if(qc!==ha){var dd=sa();if(dd!==ha){var rc=m();if(rc!==ha){var ed=sa();if(ed!==ha){var Qb=[];for(Ab=N();Ab!==ha;)Qb.push(Ab),Ab=N();if(Qb!==ha)if(Ab=sa(),
Ab!==ha){var Gc=Fa();Gc!==ha?ob=qc={type:"case_expression",format:"simple",operand:rc,clauses:Qb,else:null}:(pa=ob,ob=ha)}else pa=ob,ob=ha;else pa=ob,ob=ha}else pa=ob,ob=ha}else pa=ob,ob=ha}else pa=ob,ob=ha}else pa=ob,ob=ha;if(ob===ha)if(ob=pa,qc=za(),qc!==ha)if(dd=sa(),dd!==ha)if(rc=m(),rc!==ha)if(ed=sa(),ed!==ha){Qb=[];for(Ab=N();Ab!==ha;)Qb.push(Ab),Ab=N();if(Qb!==ha)if(Ab=sa(),Ab!==ha)if(Gc=P(),Gc!==ha){var Ue=sa();if(Ue!==ha){var Ve=Fa();Ve!==ha?ob=qc={type:"case_expression",format:"simple",
operand:rc,clauses:Qb,else:Gc.value}:(pa=ob,ob=ha)}else pa=ob,ob=ha}else pa=ob,ob=ha;else pa=ob,ob=ha;else pa=ob,ob=ha}else pa=ob,ob=ha;else pa=ob,ob=ha;else pa=ob,ob=ha;else pa=ob,ob=ha;var fd=ob;if(fd===ha){var Bb;var rb=pa;var sc=za();if(sc!==ha){var gd=sa();if(gd!==ha){var Rb=[];for(Bb=F();Bb!==ha;)Rb.push(Bb),Bb=F();if(Rb!==ha)if(Bb=sa(),Bb!==ha){var Hc=Fa();Hc!==ha?rb=sc={type:"case_expression",format:"searched",clauses:Rb,else:null}:(pa=rb,rb=ha)}else pa=rb,rb=ha;else pa=rb,rb=ha}else pa=rb,
rb=ha}else pa=rb,rb=ha;if(rb===ha)if(rb=pa,sc=za(),sc!==ha)if(gd=sa(),gd!==ha){Rb=[];for(Bb=F();Bb!==ha;)Rb.push(Bb),Bb=F();if(Rb!==ha)if(Bb=sa(),Bb!==ha)if(Hc=P(),Hc!==ha){var We=sa();if(We!==ha){var Xe=Fa();Xe!==ha?rb=sc={type:"case_expression",format:"searched",clauses:Rb,else:Hc.value}:(pa=rb,rb=ha)}else pa=rb,rb=ha}else pa=rb,rb=ha;else pa=rb,rb=ha;else pa=rb,rb=ha}else pa=rb,rb=ha;else pa=rb,rb=ha;fd=rb}pb=fd;if(pb===ha){var Ic;var bc=pa;var Hd=G();if(Hd!==ha){var hd=[];for(Ic=I();Ic!==ha;)hd.push(Ic),
Ic=I();hd!==ha?bc=Hd+=hd.join(""):(pa=bc,bc=ha)}else pa=bc,bc=ha;var Jc=bc;if(Jc!==ha){var id=Jc;Jc=/^CURRENT_DATE$/i.test(id)?{type:"current_time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(id)?{type:"current_time",mode:"timestamp"}:{type:"column_ref",table:"",column:id}}pb=Jc;if(pb===ha&&(pb=J(),pb===ha)){pb=pa;var Id=Qa();if(Id!==ha){var Ye=sa();if(Ye!==ha){var jd=m();if(jd!==ha){var Ze=sa();if(Ze!==ha){var $e=Pa();$e!==ha?(jd.paren=!0,pb=Id=jd):(pa=pb,pb=ha)}else pa=pb,pb=ha}else pa=pb,pb=ha}else pa=
pb,pb=ha}else pa=pb,pb=ha}}}}}}}}return pb}function E(){var va;var Ba=pa;var Aa=G();if(Aa!==ha){var Ka=[];for(va=H();va!==ha;)Ka.push(va),va=H();Ka!==ha?Ba=Aa+=Ka.join(""):(pa=Ba,Ba=ha)}else pa=Ba,Ba=ha;return Ba}function G(){if(hb.test(d.charAt(pa))){var va=d.charAt(pa);pa++}else va=ha,0===Va&&n(kb);return va}function H(){if(lb.test(d.charAt(pa))){var va=d.charAt(pa);pa++}else va=ha,0===Va&&n(zb);return va}function I(){if(Hb.test(d.charAt(pa))){var va=d.charAt(pa);pa++}else va=ha,0===Va&&n(Fb);return va}
function J(){var va=pa;if(64===d.charCodeAt(pa)){var Ba=Sb;pa++}else Ba=ha,0===Va&&n(Nb);if(Ba!==ha){var Aa=E();Aa!==ha?va=Ba=[Ba,Aa]:(pa=va,va=ha)}else pa=va,va=ha;va!==ha&&(va={type:"param",value:va[1]});return va}function K(){var va=pa;if(d.substr(pa,7).toLowerCase()===af){var Ba=d.substr(pa,7);pa+=7}else Ba=ha,0===Va&&n(bf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="LEADING":(pa=va,va=ha)}else pa=va,va=ha;va===ha&&(va=pa,d.substr(pa,8).toLowerCase()===cf?
(Ba=d.substr(pa,8),pa+=8):(Ba=ha,0===Va&&n(df)),Ba!==ha?(Ba=pa,Va++,Aa=H(),Va--,Aa===ha?Ba=void 0:(pa=Ba,Ba=ha),Ba!==ha?va="TRAILING":(pa=va,va=ha)):(pa=va,va=ha),va===ha&&(va=pa,d.substr(pa,4).toLowerCase()===ef?(Ba=d.substr(pa,4),pa+=4):(Ba=ha,0===Va&&n(ff)),Ba!==ha?(Ba=pa,Va++,Aa=H(),Va--,Aa===ha?Ba=void 0:(pa=Ba,Ba=ha),Ba!==ha?va="BOTH":(pa=va,va=ha)):(pa=va,va=ha)));return va}function L(){var va=pa;var Ba=pa;var Aa=S();if(Aa!==ha){var Ka=sa();if(Ka!==ha)if(Ka=Qa(),Ka!==ha)if(Ka=sa(),Ka!==ha)if(Ka=
T(),Ka!==ha){var Za=sa();Za!==ha?(Za=Pa(),Za!==ha?Ba=Aa={type:"interval-period",period:Aa.value,precision:Ka,secondary:null}:(pa=Ba,Ba=ha)):(pa=Ba,Ba=ha)}else pa=Ba,Ba=ha;else pa=Ba,Ba=ha;else pa=Ba,Ba=ha;else pa=Ba,Ba=ha}else pa=Ba,Ba=ha;Ba===ha&&(Ba=pa,Aa=S(),Aa!==ha&&(Aa=Kb(Aa)),Ba=Aa);if(Ba!==ha)if(Aa=sa(),Aa!==ha)if(Aa=pa,d.substr(pa,2).toLowerCase()===gf?(Ka=d.substr(pa,2),pa+=2):(Ka=ha,0===Va&&n(hf)),Ka!==ha?(Ka=pa,Va++,Za=H(),Va--,Za===ha?Ka=void 0:(pa=Ka,Ka=ha),Ka!==ha?Aa="TO":(pa=Aa,Aa=
ha)):(pa=Aa,Aa=ha),Aa!==ha)if(Aa=sa(),Aa!==ha){Aa=pa;Ka=S();Ka!==ha&&(Ka={type:"interval-period",period:Ka.value,precision:null,secondary:null});Aa=Ka;if(Aa===ha){Aa=pa;Ka=ua();if(Ka!==ha)if(Ka=sa(),Ka!==ha)if(Ka=Qa(),Ka!==ha)if(Ka=sa(),Ka!==ha)if(Ka=T(),Ka!==ha)if(Za=sa(),Za!==ha)if(Za=Ia(),Za!==ha)if(Za=sa(),Za!==ha)if(Za=M(),Za!==ha){var fb=sa();fb!==ha?(fb=Pa(),fb!==ha?Aa=Ka=tc(Ka,Za):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)}else pa=Aa,Aa=ha;else pa=Aa,Aa=ha;else pa=Aa,Aa=ha;else pa=Aa,Aa=ha;else pa=Aa,Aa=
ha;else pa=Aa,Aa=ha;else pa=Aa,Aa=ha;else pa=Aa,Aa=ha;else pa=Aa,Aa=ha;Aa===ha&&(Aa=pa,Ka=ua(),Ka!==ha?(Ka=sa(),Ka!==ha?(Ka=Qa(),Ka!==ha?(Ka=sa(),Ka!==ha?(Ka=T(),Ka!==ha?(Za=sa(),Za!==ha?(Za=Pa(),Za!==ha?Aa=Ka={type:"interval-period",period:"second",precision:Ka,secondary:null}:(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha)):(pa=Aa,Aa=ha),Aa===ha&&(Aa=pa,Ka=ua(),Ka!==ha&&(Ka={type:"interval-period",period:"second",precision:null,secondary:null}),Aa=Ka))}Aa!==
ha?va=Ba={type:"interval-qualifier",start:Ba,end:Aa}:(pa=va,va=ha)}else pa=va,va=ha;else pa=va,va=ha;else pa=va,va=ha;else pa=va,va=ha;va===ha&&(va=pa,Aa=S(),Aa!==ha?(Ba=sa(),Ba!==ha?(Ba=Qa(),Ba!==ha?(Ba=sa(),Ba!==ha?(Ba=M(),Ba!==ha?(Ka=sa(),Ka!==ha?(Ka=Pa(),Ka!==ha?va=Aa={type:"interval-period",period:Aa.value,precision:Ba,secondary:null}:(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha),va===ha&&(va=pa,Aa=S(),Aa!==ha&&(Aa=Kb(Aa)),va=Aa,va===
ha&&(va=pa,Aa=ua(),Aa!==ha?(Ba=sa(),Ba!==ha?(Ba=Qa(),Ba!==ha?(Ba=sa(),Ba!==ha?(Ba=T(),Ba!==ha?(Ka=sa(),Ka!==ha?(Ka=Ia(),Ka!==ha?(Aa=sa(),Aa!==ha?(Aa=M(),Aa!==ha?(Ka=sa(),Ka!==ha?(Ka=Pa(),Ka!==ha?va=Aa=tc(Ba,Aa):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha),va===ha&&(va=pa,Aa=ua(),Aa!==ha?(Ba=sa(),Ba!==ha?(Ba=Qa(),Ba!==ha?(Ba=sa(),Ba!==ha?(Ba=M(),Ba!==ha?(Ka=sa(),Ka!==ha?(Ka=Pa(),Ka!==
ha?va=Aa={type:"interval-period",period:"second",precision:Ba,secondary:null}:(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha),va===ha&&(va=pa,Aa=ua(),Aa!==ha&&(Aa={type:"interval-period",period:"second",precision:null,secondary:null}),va=Aa)))));return va}function S(){var va=pa;va=qa();va!==ha&&(va={type:"string",value:"day"});va===ha&&(va=pa,va=na(),va!==ha&&(va={type:"string",value:"hour"}),va===ha&&(va=pa,va=oa(),va!==ha&&(va={type:"string",
value:"minute"}),va===ha&&(va=pa,va=la(),va!==ha&&(va={type:"string",value:"month"}),va===ha&&(va=pa,va=ja(),va!==ha&&(va={type:"string",value:"year"})))));return va}function M(){var va=X();va!==ha&&(va=parseFloat(va));return va}function T(){var va=X();va!==ha&&(va=parseFloat(va));return va}function O(){var va=Q();va===ha&&(va=J());return va}function Q(){var va=pa;if(39===d.charCodeAt(pa)){var Ba=uc;pa++}else Ba=ha,0===Va&&n(cc);Ba===ha&&(d.substr(pa,2)===dc?(Ba=dc,pa+=2):(Ba=ha,0===Va&&n(ec)));if(Ba!==
ha){Ba=[];var Aa=pa;d.substr(pa,2)===vb?(Aa=vb,pa+=2):(Aa=ha,0===Va&&n(Kc));Aa!==ha&&(Aa="'");Aa===ha&&(wb.test(d.charAt(pa))?(Aa=d.charAt(pa),pa++):(Aa=ha,0===Va&&n(Ob)));for(;Aa!==ha;)Ba.push(Aa),Aa=pa,d.substr(pa,2)===vb?(Aa=vb,pa+=2):(Aa=ha,0===Va&&n(Kc)),Aa!==ha&&(Aa="'"),Aa===ha&&(wb.test(d.charAt(pa))?(Aa=d.charAt(pa),pa++):(Aa=ha,0===Va&&n(Ob)));Ba!==ha?(39===d.charCodeAt(pa)?(Aa=uc,pa++):(Aa=ha,0===Va&&n(cc)),Aa!==ha?va=Ba={type:"string",value:Ba.join("")}:(pa=va,va=ha)):(pa=va,va=ha)}else pa=
va,va=ha;return va}function F(){var va=pa;var Ba=La();if(Ba!==ha)if(Ba=sa(),Ba!==ha)if(Ba=m(),Ba!==ha){var Aa=sa();Aa!==ha?(Aa=Sa(),Aa!==ha?(Aa=sa(),Aa!==ha?(Aa=m(),Aa!==ha?va=Ba={type:"when_clause",operand:Ba,value:Aa}:(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)}else pa=va,va=ha;else pa=va,va=ha;else pa=va,va=ha;return va}function N(){var va=pa;var Ba=La();if(Ba!==ha)if(Ba=sa(),Ba!==ha)if(Ba=m(),Ba!==ha){var Aa=sa();Aa!==ha?(Aa=Sa(),Aa!==ha?(Aa=sa(),Aa!==ha?(Aa=m(),Aa!==ha?va=Ba={type:"when_clause",
operand:Ba,value:Aa}:(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha)}else pa=va,va=ha;else pa=va,va=ha;else pa=va,va=ha;return va}function P(){var va=pa;var Ba=pa;if(d.substr(pa,4).toLowerCase()===jf){var Aa=d.substr(pa,4);pa+=4}else Aa=ha,0===Va&&n(kf);if(Aa!==ha){Aa=pa;Va++;var Ka=H();Va--;Ka===ha?Aa=void 0:(pa=Aa,Aa=ha);Aa!==ha?Ba="ELSE":(pa=Ba,Ba=ha)}else pa=Ba,Ba=ha;Ba!==ha?(Ba=sa(),Ba!==ha?(Ba=m(),Ba!==ha?va={type:"else_clause",value:Ba}:(pa=va,va=ha)):(pa=va,va=ha)):(pa=va,va=ha);
return va}function U(){var va=X();if(va===ha){va=pa;if(45===d.charCodeAt(pa)){var Ba=bb;pa++}else Ba=ha,0===Va&&n(Ha);Ba===ha&&(43===d.charCodeAt(pa)?(Ba=ab,pa++):(Ba=ha,0===Va&&n(gb)));if(Ba!==ha){var Aa=X();Aa!==ha?va=Ba=Ba[0]+Aa:(pa=va,va=ha)}else pa=va,va=ha}return va}function V(){var va=pa;if(46===d.charCodeAt(pa)){var Ba=kd;pa++}else Ba=ha,0===Va&&n(ld);Ba!==ha?(Ba=X(),Ba===ha&&(Ba=null),Ba!==ha?va="."+(null!=Ba?Ba:""):(pa=va,va=ha)):(pa=va,va=ha);return va}function W(){var va;var Ba=va=pa;
if(lf.test(d.charAt(pa))){var Aa=d.charAt(pa);pa++}else Aa=ha,0===Va&&n(mf);Aa!==ha?(nf.test(d.charAt(pa))?(Aa=d.charAt(pa),pa++):(Aa=ha,0===Va&&n(of)),Aa===ha&&(Aa=null),Aa!==ha?Ba="e"+(null===Aa?"":Aa):(pa=Ba,Ba=ha)):(pa=Ba,Ba=ha);Ba!==ha?(Aa=X(),Aa!==ha?va=Ba+Aa:(pa=va,va=ha)):(pa=va,va=ha);return va}function X(){var va=[];var Ba=ca();if(Ba!==ha)for(;Ba!==ha;)va.push(Ba),Ba=ca();else va=ha;va!==ha&&(va=va.join(""));return va}function ca(){if(pf.test(d.charAt(pa))){var va=d.charAt(pa);pa++}else va=
ha,0===Va&&n(qf);return va}function R(){var va=pa;if(d.substr(pa,2).toLowerCase()===rf){var Ba=d.substr(pa,2);pa+=2}else Ba=ha,0===Va&&n(sf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="IN":(pa=va,va=ha)}else pa=va,va=ha;return va}function aa(){var va=pa;if(d.substr(pa,2).toLowerCase()===tf){var Ba=d.substr(pa,2);pa+=2}else Ba=ha,0===Va&&n(uf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="IS":(pa=va,va=ha)}else pa=va,va=ha;
return va}function ka(){var va=pa;if(d.substr(pa,4).toLowerCase()===vf){var Ba=d.substr(pa,4);pa+=4}else Ba=ha,0===Va&&n(wf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="LIKE":(pa=va,va=ha)}else pa=va,va=ha;return va}function da(){var va=pa;if(d.substr(pa,3).toLowerCase()===xf){var Ba=d.substr(pa,3);pa+=3}else Ba=ha,0===Va&&n(yf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="NOT":(pa=va,va=ha)}else pa=va,va=ha;return va}function fa(){var va=
pa;if(d.substr(pa,3).toLowerCase()===zf){var Ba=d.substr(pa,3);pa+=3}else Ba=ha,0===Va&&n(Af);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="AND":(pa=va,va=ha)}else pa=va,va=ha;return va}function ea(){var va=pa;if(d.substr(pa,2).toLowerCase()===Bf){var Ba=d.substr(pa,2);pa+=2}else Ba=ha,0===Va&&n(Cf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="OR":(pa=va,va=ha)}else pa=va,va=ha;return va}function Y(){var va=pa;if(d.substr(pa,
7).toLowerCase()===Df){var Ba=d.substr(pa,7);pa+=7}else Ba=ha,0===Va&&n(Ef);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="BETWEEN":(pa=va,va=ha)}else pa=va,va=ha;return va}function Z(){var va=pa;if(d.substr(pa,4).toLowerCase()===Ff){var Ba=d.substr(pa,4);pa+=4}else Ba=ha,0===Va&&n(Gf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="FROM":(pa=va,va=ha)}else pa=va,va=ha;return va}function ba(){var va=pa;if(d.substr(pa,4).toLowerCase()===
Hf){var Ba=d.substr(pa,4);pa+=4}else Ba=ha,0===Va&&n(If);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="TRIM":(pa=va,va=ha)}else pa=va,va=ha;return va}function ia(){var va=pa;if(d.substr(pa,8).toLowerCase()===Jf){var Ba=d.substr(pa,8);pa+=8}else Ba=ha,0===Va&&n(Kf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="INTERVAL":(pa=va,va=ha)}else pa=va,va=ha;return va}function ja(){var va=pa;if(d.substr(pa,4).toLowerCase()===Lf){var Ba=
d.substr(pa,4);pa+=4}else Ba=ha,0===Va&&n(Mf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="YEAR":(pa=va,va=ha)}else pa=va,va=ha;return va}function la(){var va=pa;if(d.substr(pa,5).toLowerCase()===Nf){var Ba=d.substr(pa,5);pa+=5}else Ba=ha,0===Va&&n(Of);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="MONTH":(pa=va,va=ha)}else pa=va,va=ha;return va}function qa(){var va=pa;if(d.substr(pa,3).toLowerCase()===Pf){var Ba=d.substr(pa,
3);pa+=3}else Ba=ha,0===Va&&n(Qf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="DAY":(pa=va,va=ha)}else pa=va,va=ha;return va}function na(){var va=pa;if(d.substr(pa,4).toLowerCase()===Rf){var Ba=d.substr(pa,4);pa+=4}else Ba=ha,0===Va&&n(Sf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="HOUR":(pa=va,va=ha)}else pa=va,va=ha;return va}function oa(){var va=pa;if(d.substr(pa,6).toLowerCase()===Tf){var Ba=d.substr(pa,6);pa+=6}else Ba=
ha,0===Va&&n(Uf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="MINUTE":(pa=va,va=ha)}else pa=va,va=ha;return va}function ua(){var va=pa;if(d.substr(pa,6).toLowerCase()===Vf){var Ba=d.substr(pa,6);pa+=6}else Ba=ha,0===Va&&n(Wf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="SECOND":(pa=va,va=ha)}else pa=va,va=ha;return va}function za(){var va=pa;if(d.substr(pa,4).toLowerCase()===Xf){var Ba=d.substr(pa,4);pa+=4}else Ba=ha,0===
Va&&n(Yf);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="CASE":(pa=va,va=ha)}else pa=va,va=ha;return va}function Fa(){var va=pa;if(d.substr(pa,3).toLowerCase()===Zf){var Ba=d.substr(pa,3);pa+=3}else Ba=ha,0===Va&&n($f);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="END":(pa=va,va=ha)}else pa=va,va=ha;return va}function La(){var va=pa;if(d.substr(pa,4).toLowerCase()===ag){var Ba=d.substr(pa,4);pa+=4}else Ba=ha,0===Va&&n(bg);if(Ba!==
ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="WHEN":(pa=va,va=ha)}else pa=va,va=ha;return va}function Sa(){var va=pa;if(d.substr(pa,4).toLowerCase()===cg){var Ba=d.substr(pa,4);pa+=4}else Ba=ha,0===Va&&n(dg);if(Ba!==ha){Ba=pa;Va++;var Aa=H();Va--;Aa===ha?Ba=void 0:(pa=Ba,Ba=ha);Ba!==ha?va="THEN":(pa=va,va=ha)}else pa=va,va=ha;return va}function Ia(){if(44===d.charCodeAt(pa)){var va=eg;pa++}else va=ha,0===Va&&n(fg);return va}function Qa(){if(40===d.charCodeAt(pa)){var va=
gg;pa++}else va=ha,0===Va&&n(hg);return va}function Pa(){if(41===d.charCodeAt(pa)){var va=ig;pa++}else va=ha,0===Va&&n(jg);return va}function sa(){var va;var Ba=[];for(va=Ga();va!==ha;)Ba.push(va),va=Ga();return Ba}function Ga(){if(kg.test(d.charAt(pa))){var va=d.charAt(pa);pa++}else va=ha,0===Va&&n(lg);return va}function Ra(va,Ba,Aa,Ka){va={type:"binary_expr",operator:va,left:Ba,right:Aa};void 0!==Ka&&(va.escape=Ka);return va}function Ua(va,Ba){for(var Aa=0;Aa<Ba.length;Aa++)va=Ra(Ba[Aa][1],va,Ba[Aa][3]);
return va}c=void 0!==c?c:{};var ha={},Ya={start:w},Wa=w,db="!",mb=e("!",!1),Ea="\x3d",ya=e("\x3d",!1),xa="\x3e\x3d",wa=e("\x3e\x3d",!1),ma="\x3e",ta=e("\x3e",!1),Da="\x3c\x3d",Oa=e("\x3c\x3d",!1),Ja="\x3c\x3e",ra=e("\x3c\x3e",!1),Ca="\x3c",Ma=e("\x3c",!1),Ta="!\x3d",Xa=e("!\x3d",!1),ab="+",gb=e("+",!1),bb="-",Ha=e("-",!1),Na="*",$a=e("*",!1),cb="/",eb=e("/",!1),hb=/^[A-Za-z_\x80-\uFFFF]/,kb=f([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),lb=/^[A-Za-z0-9_]/,zb=f([["A","Z"],["a","z"],["0","9"],
"_"],!1,!1),Hb=/^[A-Za-z0-9_.\x80-\uFFFF]/,Fb=f([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),Sb="@",Nb=e("@",!1),Kb=function(va){return{type:"interval-period",period:va.value,precision:null,secondary:null}},tc=function(va,Ba){return{type:"interval-period",period:"second",precision:va,secondary:Ba}},uc="'",cc=e("'",!1),dc="N'",ec=e("N'",!1),vb="''",Kc=e("''",!1),wb=/^[^']/,Ob=f(["'"],!0,!1),kd=".",ld=e(".",!1),pf=/^[0-9]/,qf=f([["0","9"]],!1,!1),lf=/^[eE]/,mf=f(["e","E"],!1,!1),
nf=/^[+\-]/,of=f(["+","-"],!1,!1),Sd="null",Td=e("NULL",!0),Md="true",Nd=e("TRUE",!0),Pd="false",Qd=e("FALSE",!0),rf="in",sf=e("IN",!0),tf="is",uf=e("IS",!0),vf="like",wf=e("LIKE",!0),Jd="escape",Kd=e("ESCAPE",!0),xf="not",yf=e("NOT",!0),zf="and",Af=e("AND",!0),Bf="or",Cf=e("OR",!0),Df="between",Ef=e("BETWEEN",!0),Ff="from",Gf=e("FROM",!0),ye="for",ze=e("FOR",!0),oe="substring",pe=e("SUBSTRING",!0),de="extract",ee=e("EXTRACT",!0),Hf="trim",If=e("TRIM",!0),Ee="position",Fe=e("POSITION",!0),Zd="timestamp",
$d=e("TIMESTAMP",!0),Vd="date",Wd=e("DATE",!0),af="leading",bf=e("LEADING",!0),cf="trailing",df=e("TRAILING",!0),ef="both",ff=e("BOTH",!0),gf="to",hf=e("TO",!0),Jf="interval",Kf=e("INTERVAL",!0),Lf="year",Mf=e("YEAR",!0),Nf="month",Of=e("MONTH",!0),Pf="day",Qf=e("DAY",!0),Rf="hour",Sf=e("HOUR",!0),Tf="minute",Uf=e("MINUTE",!0),Vf="second",Wf=e("SECOND",!0),Xf="case",Yf=e("CASE",!0),Zf="end",$f=e("END",!0),ag="when",bg=e("WHEN",!0),cg="then",dg=e("THEN",!0),jf="else",kf=e("ELSE",!0),eg=",",fg=e(",",
!1),gg="(",hg=e("(",!1),ig=")",jg=e(")",!1),kg=/^[ \t\n\r]/,lg=f([" ","\t","\n","\r"],!1,!1),Dd="`",Ed=e("`",!1),Fd=/^[^`]/,Gd=f(["`"],!0,!1),pa=0,vc=[{line:1,column:1}],Gb=0,Lc=[],Va=0;if("startRule"in c){if(!(c.startRule in Ya))throw Error("Can't start parsing from rule \""+c.startRule+'".');Wa=Ya[c.startRule]}var md=Wa();if(md!==ha&&pa===d.length)return md;md!==ha&&pa<d.length&&n({type:"end"});throw function(va,Ba,Aa){return new h(h.buildMessage(va,Ba),va,Ba,Aa)}(Lc,Gb<d.length?d.charAt(Gb):null,
Gb<d.length?p(Gb,Gb+1):p(Gb,Gb));}}})});let r=function(){function l(){}l.parse=function(h){return a.parse(h)};return l}();b.WhereGrammar=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/spatialQuerySupport":function(){define("require exports ../core/maybe ../core/jsonMap ../core/Error ../core/promiseUtils ../geometry/support/spatialReferenceUtils ../geometry/support/contains ../geometry/support/intersects ../geometry/support/extentUtils ../geometry/support/jsonUtils ../core/unitUtils ../geometry/support/normalizeUtils ../layers/graphics/OptimizedGeometry ../layers/graphics/featureConversionUtils ../layers/graphics/centroid ../layers/graphics/data/projectionSupport ../layers/graphics/contains".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){function y(T,O,Q,F=T.hasZ,N=T.hasM){const P=T.hasZ&&F,U=T.hasM&&N;return Q?(T=q.quantizeOptimizedGeometry(H,O,T.hasZ,T.hasM,"esriGeometryPoint",Q,F,N),q.convertToPoint(T,P,U)):q.convertToPoint(O,P,U)}function B(T,O,Q,F,N,P,U=O,V=Q){const W=O&&U,X=Q&&V;F=F?"coords"in F?F:F.geometry:null;if(!F)return null;if(N)return O=q.generalizeOptimizedGeometry(G,F,O,Q,T,N,U,V),P&&(O=q.quantizeOptimizedGeometry(H,O,W,X,T,P)),I[T](O,W,X);if(P)return P=q.quantizeOptimizedGeometry(H,
F,O,Q,T,P,U,V),I[T](P,W,X);q.removeZMValues(E,F,O,Q,U,V);return I[T](E,W,X)}async function x(T,O,Q){if(!T)return null;var {where:F}=T;T.where=F=F&&F.trim();if(!F||/^1 *= *1$/.test(F)||O&&O===F)T.where=null;if(!T.geometry)return T;O=await C(T);T.distance=0;T.units=null;"esriSpatialRelEnvelopeIntersects"===T.spatialRel&&({spatialReference:F}=T.geometry,O=f.getGeometryExtent(O),O.spatialReference=F);T.geometry=O;await u.checkProjectionSupport(O.spatialReference,Q);O=(await n.normalizeCentralMeridian(g.fromJSON(O)))[0];
if(a.isNone(O))throw D;O=O.toJSON();O=await u.project(O,O.spatialReference,Q);if(!O)throw D;O.spatialReference=Q;T.geometry=O;return T}async function C(T){const {geometry:O,distance:Q,units:F}=T;if(null==Q||"vertexAttributes"in O)return O;var N=O.spatialReference;T=F?t.fromJSON(F):p.getUnitString(N);N=N&&(d.isGeographic(N)||d.isWebMercator(N))?O:await u.checkProjectionSupport(N,d.WGS84).then(()=>u.project(O,d.WGS84));return(await A())(N.spatialReference,N,Q,T)}function z(){return new Promise(function(T,
O){b(["../geometry/geometryEngineJSON"],T,O)})}function A(){return z().then(T=>T.geodesicBuffer)}const t=new r.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),D=Object.freeze({}),E=new w,G=new w,H=new w,I={esriGeometryPoint:q.convertToPoint,esriGeometryPolyline:q.convertToPolyline,esriGeometryPolygon:q.convertToPolygon,esriGeometryMultipoint:q.convertToMultipoint},
J=(T,O)=>"_geVersion"!==T?O:void 0,K={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null};var L={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,
esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},S={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},M={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};k.QUERY_ENGINE_EMPTY_RESULT=D;k.canQueryWithRBush=function(T){if(g.isExtent(T))return!0;if(g.isPolygon(T)){for(const O of T.rings)if(5!==
O.length||O[0][0]!==O[1][0]||O[0][0]!==O[4][0]||O[2][0]!==O[3][0]||O[0][1]!==O[3][1]||O[0][1]!==O[4][1]||O[1][1]!==O[2][1])return!1;return!0}return!1};k.checkSpatialQuerySupport=async function(T,O,Q){const {spatialRel:F,geometry:N}=T;if(N){if(!0!==L[F])throw new l("feature-store:unsupported-query","Unsupported query spatial relationship",{query:T});if(d.isValid(N.spatialReference)&&d.isValid(Q)){if(!0!==S[g.getJsonType(N)])throw new l("feature-store:unsupported-query","Unsupported query geometry type",
{query:T});if(!0!==M[O])throw new l("feature-store:unsupported-query","Unsupported layer geometry type",{query:T});if(T.outSR)return u.checkProjectionSupport(T.geometry&&T.geometry.spatialReference,T.outSR)}}};k.cleanFromGeometryEngine=function(T){return T&&"_geVersion"in T?JSON.parse(JSON.stringify(T,J)):T};k.getCentroid=function(T,O,Q){if("esriGeometryPolygon"!==T.geometryType||!O||!O.centroid&&!O.geometry)return null;O.centroid||(O.centroid=m.getCentroidOptimizedGeometry(new w,O.geometry,T.hasZ,
T.hasM));return y(T,O.centroid,Q)};k.getGeodesicBufferOperator=A;k.getGeometry=B;k.getSpatialQueryOperator=function(T,O,Q,F,N){if(g.isPolygon(O)&&"esriGeometryPoint"===Q&&("esriSpatialRelIntersects"===T||"esriSpatialRelContains"===T)){const P=q.convertFromPolygon(new w,O,!1,!1);return h.resolve(U=>v.polygonContainsPoint(P,!1,!1,U))}if(g.isPolygon(O)&&"esriGeometryMultipoint"===Q){const P=q.convertFromPolygon(new w,O,!1,!1);if("esriSpatialRelContains"===T)return h.resolve(U=>v.polygonContainsMultipoint(P,
!1,!1,U,F,N))}if(g.isExtent(O)&&"esriGeometryPoint"===Q&&("esriSpatialRelIntersects"===T||"esriSpatialRelContains"===T))return h.resolve(P=>c.extentContainsPoint(O,B(Q,F,N,P)));if(g.isExtent(O)&&"esriGeometryMultipoint"===Q&&"esriSpatialRelContains"===T)return h.resolve(P=>c.extentContainsMultipoint(O,B(Q,F,N,P)));if(g.isExtent(O)&&"esriSpatialRelIntersects"===T){const P=e.getExtentIntersector(Q);return h.resolve(U=>P(O,B(Q,F,N,U)))}return z().then(P=>{const U=P[K[T]].bind(null,O.spatialReference,
O);return V=>U(B(Q,F,N,V))})};k.importGeometryEngine=z;k.normalizeFilter=async function(T,O,Q){return x(T,O,Q)};k.normalizeQuery=async function(T,O,Q){const {outFields:F,orderByFields:N,groupByFieldsForStatistics:P,outStatistics:U}=T;if(F)for(var V=0;V<F.length;V++)F[V]=F[V].trim();if(N)for(V=0;V<N.length;V++)N[V]=N[V].trim();if(P)for(V=0;V<P.length;V++)P[V]=P[V].trim();if(U)for(V=0;V<U.length;V++)U[V].onStatisticField&&(U[V].onStatisticField=U[V].onStatisticField.trim());T.geometry&&!T.outSR&&(T.outSR=
T.geometry.spatialReference);return x(T,O,Q)};k.normalizeQueryLike=x;k.transformCentroid=y})},"esri/layers/graphics/centroid":function(){define(["exports"],function(b){function k(r,l,h,d,c,e,f=1){e=c?e?4:3:e?3:2;let g=h,p=h+e,n=0,w=0,q=h=0,m=0;for(let u=0,v=d-1;u<v;u++,g+=e,p+=e){d=l[g];const y=l[g+1],B=l[g+2],x=l[p],C=l[p+1],z=l[p+2];let A=d*C-x*y;q+=A;n+=(d+x)*A;w+=(y+C)*A;c&&(A=d*z-x*B,h+=(B+z)*A,m+=A);d<r[0]&&(r[0]=d);d>r[1]&&(r[1]=d);y<r[2]&&(r[2]=y);y>r[3]&&(r[3]=y);c&&(B<r[4]&&(r[4]=B),B>r[5]&&
(r[5]=B))}0<q*f&&(q*=-1);0<m*f&&(m*=-1);if(!q)return null;r=[n,w,.5*q];c&&(r[3]=h,r[4]=.5*m);return r}function a(r,l,h,d,c){c=d?c?4:3:c?3:2;let e=l,f=l+c,g=0,p=0,n=0,w=0;for(let v=0,y=h-1;v<y;v++,e+=c,f+=c){var q=r[e];const B=r[e+1],x=r[e+2],C=r[f],z=r[f+1],A=r[f+2];if(d){{var m=C-q;var u=z-B;const t=A-x;m=Math.sqrt(m*m+u*u+t*t)}}else m=C-q,u=z-B,m=Math.sqrt(m*m+u*u);m&&(g+=m,d?(q=[q+.5*(C-q),B+.5*(z-B),x+.5*(A-x)],p+=m*q[0],n+=m*q[1],w+=m*q[2]):(q=[q+.5*(C-q),B+.5*(z-B)],p+=m*q[0],n+=m*q[1]))}return 0<
g?d?[p/g,n/g,w/g]:[p/g,n/g]:0<h?d?[r[l],r[l+1],r[l+2]]:[r[l],r[l+1]]:null}b.getCentroidOptimizedGeometry=function(r,l,h,d,c){if(!l||!l.lengths.length)return null;const e="upperLeft"===(null==c?void 0:c.originPosition)?-1:1;r.lengths.length&&(r.lengths.length=0);r.coords.length&&(r.coords.length=0);c=r.coords;const f=[],g=h?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,
Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:p,coords:n}=l,w=h?d?4:3:d?3:2;let q=0;for(var m of p){const u=k(g,n,q,m,h,d,e);u&&f.push(u);q+=m*w}f.sort((u,v)=>{let y=e*u[2]-e*v[2];0===y&&h&&(y=u[4]-v[4]);return y});f.length&&(m=6*f[0][2],c[0]=f[0][0]/m,c[1]=f[0][1]/m,h&&(m=6*f[0][4],c[2]=0!==m?f[0][3]/m:0),c[0]<g[0]||c[0]>g[1]||c[1]<g[2]||c[1]>g[3]||h&&(c[2]<g[4]||c[2]>g[5]))&&(c.length=0);if(!c.length)if(l=l.lengths[0]?a(n,0,p[0],h,d):null)c[0]=l[0],c[1]=l[1],
h&&2<l.length&&(c[2]=l[2]);else return null;return r};b.lineCentroid=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/contains":function(){define(["exports"],function(b){function k(a,r,l,h,d){if(!a)return!1;r=r?l?4:3:l?3:2;const {coords:c,lengths:e}=a;l=!1;a=0;for(const g of e){var f=a;for(let p=a,n=a+g*r;p<n;p+=r){f=p+r;f===n&&(f=a);const w=c[p],q=c[p+1],m=c[f];f=c[f+1];(q<d&&f>=d||f<d&&q>=d)&&w+(d-q)/(f-q)*(m-w)<h&&(l=!l)}a+=g*r}return l}b.polygonContainsCoords=k;b.polygonContainsMultipoint=
function(a,r,l,h,d,c){d=d?c?4:3:c?3:2;const {coords:e,lengths:f}=h;if(!f)return!1;for(let g=0,p=0;g<f.length;g++,p+=d)if(!k(a,r,l,e[p],e[p+1]))return!1;return!0};b.polygonContainsPoint=function(a,r,l,h){return k(a,r,l,h.coords[0],h.coords[1])};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(b){function k(l,h,d,c,e){if(null!=c&&null!=e)return f=>{const g=l.getAttribute(f,h);f=l.getAttribute(f,d);return(null==g||g<=e)&&
(null==f||f>=c)};if(null!=c)return f=>{f=l.getAttribute(f,d);return null==f||f>=c};if(null!=e)return f=>{f=l.getAttribute(f,h);return null==f||f<=e}}function a(l,h,d,c){if(null!=d&&null!=c&&d===c)return e=>l.getAttribute(e,h)===d;if(null!=d&&null!=c)return e=>{e=l.getAttribute(e,h);return e>=d&&e<=c};if(null!=d)return e=>l.getAttribute(e,h)>=d;if(null!=c)return e=>l.getAttribute(e,h)<=c}function r(){return()=>!1}b.getTimeExtent=function(l,h){if(!l)return null;const d=h.featureAdapter,{startTimeField:c,
endTimeField:e}=l;let f=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY;if(c&&e)h.forEach(p=>{const n=d.getAttribute(p,c);p=d.getAttribute(p,e);null==n||isNaN(n)||(f=Math.min(f,n));null==p||isNaN(p)||(g=Math.max(g,p))});else{const p=c||e;h.forEach(n=>{n=d.getAttribute(n,p);null==n||isNaN(n)||(f=Math.min(f,n),g=Math.max(g,n))})}return{start:f,end:g}};b.getTimeOperator=function(l,h,d){if(!h||!l)return null;const {startTimeField:c,endTimeField:e}=l;if(!c&&!e)return null;const {start:f,end:g}=h;return null===
f&&null===g?null:void 0===f&&void 0===g?r():c&&e?k(d,c,e,f,g):a(d,c||e,f,g)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./projectionSupport ../../../geometry/support/quantizationUtils ./attributeSupport ./AttributesBuilder ../../../chunks/spatialQuerySupport ./timeSupport".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){function p(w){return w.substr(24,12)+w.substr(19,4)+w.substr(16,2)+w.substr(14,2)+w.substr(11,2)+w.substr(9,2)+w.substr(6,2)+w.substr(4,2)+w.substr(2,2)+w.substr(0,2)}function n(w,q,m,u){if(m&&"esriFieldTypeDate"===m.type){const v=(new Date(w)).getTime(),y=(new Date(q)).getTime();if(!isNaN(v)&&!isNaN(y))return u?y-v:v-y}return"number"===typeof w&&"number"===typeof q?u?q-w:w-q:"string"===typeof w&&"string"===typeof q?(w=w.toUpperCase(),q=q.toUpperCase(),!m||"esriFieldTypeGUID"!==
m.type&&"esriFieldTypeGlobalID"!==m.type?u=(u?w>q:w<q)?-1:(u?w<q:w>q)?1:0:(m=p(w),q=p(q),u=(u?m>q:m<q)?-1:(u?m<q:m>q)?1:0),u):u?1:-1}return function(){function w(m,u,v){this.items=m;this.queryGeometry=u;this.definitionExpression=v.definitionExpression;this.geometryType=v.geometryType;this.hasM=v.hasM;this.hasZ=v.hasZ;this.objectIdField=v.objectIdField;this.spatialReference=v.spatialReference;this.fieldsIndex=v.fieldsIndex;this.timeInfo=v.timeInfo;this.featureAdapter=v.featureAdapter;this.aggregateAdapter=
v.aggregateAdapter}var q=w.prototype;q.createQueryResponseForCount=function(m){const u=new e(m,this.featureAdapter,this.fieldsIndex);if(!m.outStatistics)return u.countDistinctValues(this.items);const {groupByFieldsForStatistics:v,having:y}=m;if(null==v||!v.length)return 1;const B=new Map,x=new Map,C=new Set;m=m.outStatistics;for(const A of m){({statisticType:m}=A);m="exceedslimit"!==m?A.onStatisticField:void 0;if(!x.has(m)){var z=[];for(const t of v){const D=this._getAttributeValues(u,t,B);z.push(D)}x.set(m,
this._calculateUniqueValues(z))}m=x.get(m);for(const t in m){const {data:D,items:E}=m[t];z=D.join(",");y&&!u.validateItems(E,y)||C.add(z)}}return C.size};q.createQueryResponse=function(m){let u;u=m.outStatistics?m.outStatistics.some(v=>"exceedslimit"===v.statisticType)?this._createExceedsLimitQueryResponse(m):this._createStatisticsQueryResponse(m):this._createFeatureQueryResponse(m);m.returnQueryGeometry&&(r.isValid(m.outSR)&&!r.equals(this.queryGeometry.spatialReference,m.outSR)?u.queryGeometry=
f.cleanFromGeometryEngine({spatialReference:m.outSR,...h.project(this.queryGeometry,this.queryGeometry.spatialReference,m.outSR)}):u.queryGeometry=f.cleanFromGeometryEngine({spatialReference:m.outSR,...this.queryGeometry}));return u};q.executeAttributesQuery=function(m){var u=c.getWhereClause(m.where,this.fieldsIndex);if(!u)return a.resolve(this);if(u.isStandardized){let v=0;const y=[];for(const B of this.items)u.testFeature(B,this.featureAdapter)&&(y[v++]=B);u=new w(y,this.queryGeometry,this);u.definitionExpression=
m.where;return a.resolve(u)}return a.reject(new TypeError("Where clause is not standardized"))};q.executeAggregateIdsQuery=function(m){if(!m.aggregateIds||!m.aggregateIds.length||k.isNone(this.aggregateAdapter))return a.resolve(this);const u=new Set;for(const y of m.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(y).forEach(B=>u.add(B));const v=this.featureAdapter.getObjectId;return a.resolve(new w(this.items.filter(y=>u.has(v(y))),this.queryGeometry,this))};q.executeObjectIdsQuery=function(m){if(!m.objectIds||
!m.objectIds.length)return a.resolve(this);const u=new Set(m.objectIds),v=this.featureAdapter.getObjectId;return a.resolve(new w(this.items.filter(y=>u.has(v(y))),this.queryGeometry,this))};q.executeTimeQuery=function(m){m=g.getTimeOperator(this.timeInfo,m.timeExtent,this.featureAdapter);if(!k.isSome(m))return a.resolve(this);m=this.items.filter(m);return a.resolve(new w(m,this.queryGeometry,this))};q.filterLatest=function(){const {trackIdField:m,startTimeField:u,endTimeField:v}=this.timeInfo;var y=
v||u;const B=new Map,x=this.featureAdapter.getAttribute;for(const C of this.items){const z=x(C,m),A=x(C,y),t=B.get(z);(!t||A>x(t,y))&&B.set(z,C)}y=Array.from(B.values());return a.resolve(new w(y,this.queryGeometry,this))};q.project=async function(m){if(!m||r.equals(this.spatialReference,m))return this;const u=this.featureAdapter,v=(await h.projectMany(this.items.map(y=>f.getGeometry(this.geometryType,this.hasZ,this.hasM,u.getGeometry(y))),this.spatialReference,m)).map((y,B)=>u.cloneWithGeometry(this.items[B],
l.convertFromGeometry(y,this.hasZ,this.hasM)));return new w(v,this.queryGeometry,{definitionExpression:this.definitionExpression,geometryType:this.geometryType,hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:m,fieldsIndex:this.fieldsIndex,timeInfo:this.timeInfo,featureAdapter:this.featureAdapter})};q._sortFeatures=function(m,u,v){if(1<m.length&&u&&u.length)for(const y of u.reverse()){u=y.split(" ");const B=u[0],x=this.fieldsIndex.get(B),C=u[1]&&"desc"===u[1].toLowerCase();
m.sort((z,A)=>{z=v(z,B,x);A=v(A,B,x);return n(z,A,x,C)})}};q._createFeatureQueryResponse=function(m){const u=this.items,{geometryType:v,hasM:y,hasZ:B,objectIdField:x,spatialReference:C}=this,{outFields:z,outSR:A,quantizationParameters:t,resultRecordCount:D,resultOffset:E,returnZ:G,returnM:H}=m,I=null!=D?u.length>(E||0)+D:!1,J=z&&(-1<z.indexOf("*")?[...this.fieldsIndex.fields]:z.map(K=>this.fieldsIndex.get(K)));return{exceededTransferLimit:I,features:this._createFeatures(m,u),fields:J,geometryType:v,
hasM:y&&H,hasZ:B&&G,objectIdFieldName:x,spatialReference:f.cleanFromGeometryEngine(A?A:C),transform:t&&d.toQuantizationTransform(t)||null}};q._createFeatures=function(m,u){const v=new e(m,this.featureAdapter,this.fieldsIndex),{hasM:y,hasZ:B}=this,{orderByFields:x,quantizationParameters:C,returnGeometry:z,returnCentroid:A,maxAllowableOffset:t,resultOffset:D,resultRecordCount:E,returnZ:G=!1,returnM:H=!1}=m,I=B&&G,J=y&&H;m=[];var K=0;u=[...u];this._sortFeatures(u,x,(M,T,O)=>v.getFieldValue(M,T,O));if(z||
A){var L=d.toQuantizationTransform(C);if(z&&!A)for(var S of u)m[K++]={attributes:v.getAttributes(S),geometry:f.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(S),t,L,I,J)};else if(!z&&A)for(const M of u)m[K++]={attributes:v.getAttributes(M),centroid:f.transformCentroid(this,this.featureAdapter.getCentroid(M,this),L)};else for(const M of u)m[K++]={attributes:v.getAttributes(M),centroid:f.transformCentroid(this,this.featureAdapter.getCentroid(M,this),L),geometry:f.getGeometry(this.geometryType,
this.hasZ,this.hasM,this.featureAdapter.getGeometry(M),t,L,I,J)}}else for(L of u)(S=v.getAttributes(L))&&(m[K++]={attributes:S});K=D||0;null!=E&&(m=m.slice(K,Math.min(m.length,K+E)));return m};q._createExceedsLimitQueryResponse=function(m){var u=!1;let v=Number.POSITIVE_INFINITY,y=Number.POSITIVE_INFINITY;u=Number.POSITIVE_INFINITY;for(const B of m.outStatistics)if("exceedslimit"===B.statisticType){v=null!=B.maxPointCount?B.maxPointCount:Number.POSITIVE_INFINITY;y=null!=B.maxRecordCount?B.maxRecordCount:
Number.POSITIVE_INFINITY;u=null!=B.maxVertexCount?B.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===this.geometryType)u=this.items.length>v;else if(this.items.length>y)u=!0;else{m=this.hasZ?this.hasM?4:3:this.hasM?3:2;const B=this.featureAdapter;u=this.items.reduce((x,C)=>{C=B.getGeometry(C);return x+(C&&C.coords.length||0)},0)/m>u}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(u)}}]}};
q._createStatisticsQueryResponse=function(m){var u={attributes:{}};const v=[],y=new Map,B=new Map,x=new Map,C=new Map,z=new e(m,this.featureAdapter,this.fieldsIndex);var A=m.outStatistics;const {groupByFieldsForStatistics:t,having:D,orderByFields:E}=m;m=t&&t.length;const G=!!m,H=G&&t[0],I=G&&!this.fieldsIndex.get(H);for(const M of A){const {outStatisticFieldName:T,statisticType:O}=M;A=M;var J="exceedslimit"!==O?M.onStatisticField:void 0;const Q="percentile_disc"===O||"percentile_cont"===O,F=G&&1===
m&&(J===H||I)&&"count"===O;if(G){if(!x.has(J)){var K=[];for(const N of t){var L=this._getAttributeValues(z,N,y);K.push(L)}x.set(J,this._calculateUniqueValues(K))}K=x.get(J);for(const N in K){const {count:P,data:U,items:V,itemPositions:W}=K[N];L=U.join(",");if(!D||z.validateItems(V,D)){const X=C.get(L)||{attributes:{}};var S=null;if(F)S=P;else{const ca=this._getAttributeValues(z,J,y);S=W.map(R=>ca[R]);S=Q&&"statisticParameters"in A?this._getPercentileValue(A,S):this._getStatisticValue(A,S)}X.attributes[T]=
S;t.forEach((ca,R)=>X.attributes[this.fieldsIndex.get(ca)?ca:`EXPR_${R+1}`]=U[R]);C.set(L,X)}}}else J=this._getAttributeValues(z,J,y),u.attributes[T]=Q&&"statisticParameters"in A?this._getPercentileValue(A,J):this._getStatisticValue(A,J,B);v.push({name:T,alias:T,type:"esriFieldTypeDouble"})}u=G?Array.from(C.values()):[u];this._sortFeatures(u,E,(M,T)=>M.attributes[T]);return{fields:v,features:u}};q._getStatisticValue=function(m,u,v){const {onStatisticField:y,statisticType:B}=m;m=v&&v.has(y)?v.get(y):
this._calculateStatistics(u);v&&v.set(y,m);return m["var"===B?"variance":B]};q._getPercentileValue=function(m,u){const {onStatisticField:v,statisticParameters:y,statisticType:B}=m,{value:x,orderBy:C}=y,z="desc"===C,A=this.fieldsIndex.get(v);m=[...u].filter(t=>null!=t).sort((t,D)=>n(t,D,A,z));return this._calculatePercentile(m,x,"percentile_disc"===B)};q._getAttributeValues=function(m,u,v){if(v.has(u))return v.get(u);const y=this.fieldsIndex.get(u),B=this.items.map(x=>m.getFieldValue(x,u,y));v.set(u,
B);return B};q._calculateStatistics=function(m){let u=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,y=null,B=null,x=null,C=null;const z=[];let A=0;for(const t of m)"string"===typeof t?A++:null==t||isNaN(t)||(y+=t,u=Math.min(u,t),v=Math.max(v,t),z.push(t),A++);if(A){B=y/A;m=0;for(const t of z)m+=Math.pow(t-B,2);C=1<A?m/(A-1):0;x=Math.sqrt(C)}else v=u=null;return{avg:B,count:A,max:v,min:u,stddev:x,sum:y,variance:C}};q._calculateUniqueValues=function(m){const u={},v=this.items,y=v.length;for(let B=
0;B<y;B++){const x=v[B],C=[];for(const A of m)C.push(A[B]);const z=C.join(",");null==u[z]?u[z]={count:1,data:C,items:[x],itemPositions:[B]}:(u[z].count++,u[z].items.push(x),u[z].itemPositions.push(B))}return u};q._calculatePercentile=function(m,u,v){if(0===m.length)return null;if(0>=u)return m[0];if(1<=u)return m[m.length-1];var y=(m.length-1)*u,B=Math.floor(y);u=B+1;y%=1;B=m[B];const x=m[u];return u>=m.length||v||"string"===typeof B||"string"===typeof x?B:B*(1-y)+x*y};b._createClass(w,[{key:"size",
get:function(){return this.items.length}}]);return w}()})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["../../../core/maybe","./attributeSupport"],function(b,k){return function(){function a(l,h,d){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=l.returnDistinctValues;this.fieldsIndex=d;this.featureAdapter=h;if((h=l.outFields)&&-1===h.indexOf("*")){this.outFields=h;l=0;for(const e of h){var c=k.getExpressionFromFieldName(e);c=(h=this.fieldsIndex.get(c))?
null:k.getWhereClause(c,d);h=h?h.name:k.getAliasFromFieldName(e)||`FIELD_EXP_${l++}`;this._fieldDataCache.set(e,{alias:h,clause:c})}}}var r=a.prototype;r.countDistinctValues=function(l){if(!this.returnDistinctValues)return l.length;l.forEach(h=>this.getAttributes(h));return this._returnDistinctMap.size};r.getAttributes=function(l){l=this._processAttributesForOutFields(l);return this._processAttributesForDistinctValues(l)};r.getFieldValue=function(l,h,d){const c=d?d.name:h;let e=null;this._fieldDataCache.has(c)?
e=this._fieldDataCache.get(c).clause:d||(e=k.getWhereClause(h,this.fieldsIndex),this._fieldDataCache.set(c,{alias:c,clause:e}));return d?this.featureAdapter.getAttribute(l,c):e.calculateValue(l,this.featureAdapter)};r.validateItem=function(l,h){this._fieldDataCache.has(h)||this._fieldDataCache.set(h,{alias:h,clause:k.getWhereClause(h,this.fieldsIndex)});return this._fieldDataCache.get(h).clause.testFeature(l,this.featureAdapter)};r.validateItems=function(l,h){this._fieldDataCache.has(h)||this._fieldDataCache.set(h,
{alias:h,clause:k.getWhereClause(h,this.fieldsIndex)});return this._fieldDataCache.get(h).clause.testSet(l,this.featureAdapter)};r._processAttributesForOutFields=function(l){const h=this.outFields;if(!h||!h.length)return this.featureAdapter.getAttributes(l);const d={};for(const c of h){const {alias:e,clause:f}=this._fieldDataCache.get(c);d[e]=f?f.calculateValue(l,this.featureAdapter):this.featureAdapter.getAttribute(l,e)}return d};r._processAttributesForDistinctValues=function(l){if(b.isNone(l)||
!this.returnDistinctValues)return l;var h=this.outFields,d=[];if(h)for(const e of h){var {alias:c}=this._fieldDataCache.get(e);d.push(l[c])}else for(c in l)d.push(l[c]);h=`${(h||["*"]).join(",")}=${d.join(",")}`;d=this._returnDistinctMap.get(h)||0;this._returnDistinctMap.set(h,++d);return 1<d?null:l};return a}()})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/compilerUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../geometry/support/webMercatorUtils ../../../../Graphic ../../../../core/Handles ../../../../core/accessorSupport/diffUtils ../../../../core/watchUtils ../../../../tasks/support/Query ../../../support/WatchUpdatingTracking ./graphicUtils ./constants ./Graphics3DCore ./Graphics3DScaleVisibility ../support/attributeUtils ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DObjectStates".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I){a=function(K){function L(M){M=K.call(this,M)||this;M._handles=new u;M.watchUpdatingTracking=new x.WatchUpdatingTracking;M.suspendResumeExtentMode="computed";M.dataExtent=null;M.suspendResumeExtent=null;return M}b._inheritsLoose(L,K);var S=L.prototype;S.normalizeCtorArgs=function(M){const T=M.frustumVisibilityEnabled?new H:null,O=M.scaleVisibilityEnabled?new t:null,Q=(M.filterVisibilityEnabled||M.timeExtentVisibilityEnabled)&&"multipatch"!==
M.layer.geometryType?new G.Graphics3DFilterVisibility:null,F=M.elevationAlignmentEnabled?new E:null,N=new A.Graphics3DCore({owner:M.owner,layer:M.layer,preferredUpdatePolicy:M.preferredUpdatePolicy,elevationFeatureExpressionEnabled:M.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:M.owner.hasZ,hasM:M.owner.hasM}),{updateClippingExtent:P,suspendResumeExtentMode:U,dataExtent:V}=M;return{graphicsCore:N,frustumVisibility:T,scaleVisibility:O,filterVisibility:Q,elevationAlignment:F,updateClippingExtent:P,
suspendResumeExtentMode:U,dataExtent:V}};S.initialize=function(){this.scaleVisibility&&this.watchUpdatingTracking.add(this.layer,"scaleRangeId",()=>this.scaleVisibility.layerMinMaxScaleChangeHandler());this.filterVisibility&&(this.watchUpdatingTracking.add(this.owner,"filter",()=>this.filterVisibility.filterChanged()),this.watchUpdatingTracking.add(this.owner,"timeExtent",()=>this.filterVisibility.filterChanged()));this.elevationAlignment&&this.watchUpdatingTracking.add(this.layer,"elevationInfo",
(M,T)=>{v.diff(M,T)&&this.watchUpdatingTracking.addPromise(this.graphicsCore.elevationInfoChange())});this.watchUpdatingTracking.add(this.layer,"labelsVisible",()=>this.graphicsCore.updateVisibilityInfo());this.watchUpdatingTracking.add(this.layer,"labelingInfo",(M,T)=>{v.diff(M,T)&&this.graphicsCore.updateLabelingInfo()})};S.setup=async function(){this.frustumVisibility&&this.frustumVisibility.setup(this.owner);const M=this.owner,T=this.owner.view.basemapTerrain,O=(Q,F,N)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(Q,
F,N);this.scaleVisibility&&this.scaleVisibility.setup(M,this.layer,O,this.graphicsCore,T);this.filterVisibility&&("filter"in M||"timeExtent"in M)&&this.filterVisibility.setup(M,this.graphicsCore);this.elevationAlignment&&this.elevationAlignment.setup(M,O,this.graphicsCore,M.view.elevationProvider);this._set("objectStates",new I.Graphics3DObjectStates(this.graphicsCore));this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility));this._set("deconfliction",
M.view.deconflictor.addGraphicsOwner(this.graphicsCore));await n.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}));this.watchUpdatingTracking.add(this.layer,"renderer",Q=>this.watchUpdatingTracking.addPromise(this.graphicsCore.rendererChange(Q)));this.watchUpdatingTracking.add(M,"fullOpacity",()=>this.graphicsCore.opacityChange());
this.setupSuspendResumeExtent();this.updateClippingExtent&&(this.watchUpdatingTracking.add(M.view,"clippingArea",()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&await n.logOnError(this.graphicsCore.updateLabelingInfo())};S.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);var M="watchUpdatingTracking frustumVisibility scaleVisibility filterVisibility elevationAlignment objectStates graphicsCore".split(" ");
for(const T of M)if(M=this[T])M.destroy(),this._set(T,null);this._set("layer",null);this._set("owner",null)};S.maskOccludee=function(M){const {set:T,handle:O}=this.objectStates.acquireSet(1,null);this.objectStates.setUid(T,M.uid);return O};S.highlight=function(M,T){if(M instanceof B){const {set:O,handle:Q}=this.objectStates.acquireSet(0,T);this.owner.queryObjectIds(M).then(F=>this.objectStates.setObjectIds(O,F));return Q}if("number"===typeof M||"string"===typeof M||M instanceof m)return this.highlight([M],
T);"toArray"in M&&(M=M.toArray());if(Array.isArray(M)&&0<M.length){if(M[0]instanceof m)if(null!=D.attributeLookup(this.layer.fieldsIndex,M[0].attributes,T))M=M.map(O=>D.attributeLookup(this.layer.fieldsIndex,O.attributes,T));else{M=M.map(F=>F.uid);const {set:O,handle:Q}=this.objectStates.acquireSet(0,null);this.objectStates.setUids(O,M);return Q}if("number"===typeof M[0]||"string"===typeof M[0]){const {set:O,handle:Q}=this.objectStates.acquireSet(0,T);this.objectStates.setObjectIds(O,M);return Q}}return J};
S._updateClippingExtent=function(){const M=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(M,this.owner.view.spatialReference)&&(this.updateClippingExtent(M)||this.graphicsCore.recreateAllGraphics())};S.setupSuspendResumeExtent=function(){(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(y.init(this,"suspendResumeExtentMode",()=>{this._handles.remove("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this._handles.add([y.init(this.graphicsCore,
"computedExtent",M=>this.updateSuspendResumeExtent(M)),this.graphicsCore.watch("extentPadding",()=>this.updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this._handles.add([y.init(this,"dataExtent",M=>this.updateSuspendResumeExtent(M)),this.graphicsCore.watch("extentPadding",()=>this.updateSuspendResumeExtent(this.dataExtent))],"suspendResumeExtentMode");break;default:r.neverReached(this.suspendResumeExtentMode)}}))};S.updateSuspendResumeExtent=
function(M){M?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(M,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};S.extentToSuspendResumeRect=function(M,T){const O=this.owner.view.spatialReference;if(!M.spatialReference.equals(O)){if(!q.canProject(M,O))return;M=q.project(M,O)}return C.enlargeExtent(M,T,z.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};S.suspendResumeExtentChanged=function(M){this.frustumVisibility&&this.frustumVisibility.setExtent(M);
this.scaleVisibility&&this.scaleVisibility.setExtent(M)};b._createClass(L,[{key:"suspended",get:function(){var M;return null==(M=this.scaleVisibility)?void 0:M.suspended}},{key:"suspendInfo",get:function(){var M,T;const O={};null!=(M=this.scaleVisibility)&&M.suspended&&(O.outsideScaleRange=!0);null!=(T=this.frustumVisibility)&&T.suspended&&(O.outsideOfView=!0);return O}},{key:"updating",get:function(){var M,T,O;return!!(null!=(M=this.graphicsCore)&&M.updating||null!=(T=this.frustumVisibility)&&T.updating||
null!=(O=this.watchUpdatingTracking)&&O.updating)}}]);return L}(w);k.__decorate([d.property({aliasOf:"graphicsCore.layer"})],a.prototype,"layer",void 0);k.__decorate([d.property({aliasOf:"graphicsCore.owner"})],a.prototype,"owner",void 0);k.__decorate([d.property({constructOnly:!0})],a.prototype,"updateClippingExtent",void 0);k.__decorate([d.property({constructOnly:!0})],a.prototype,"graphicsCore",void 0);k.__decorate([d.property({constructOnly:!0})],a.prototype,"scaleVisibility",void 0);k.__decorate([d.property({constructOnly:!0})],
a.prototype,"filterVisibility",void 0);k.__decorate([d.property({constructOnly:!0})],a.prototype,"elevationAlignment",void 0);k.__decorate([d.property({constructOnly:!0})],a.prototype,"frustumVisibility",void 0);k.__decorate([d.property({readOnly:!0})],a.prototype,"deconfliction",void 0);k.__decorate([d.property({readOnly:!0})],a.prototype,"labeling",void 0);k.__decorate([d.property({readOnly:!0})],a.prototype,"objectStates",void 0);k.__decorate([d.property({readOnly:!0})],a.prototype,"watchUpdatingTracking",
void 0);k.__decorate([d.property()],a.prototype,"suspendResumeExtentMode",void 0);k.__decorate([d.property()],a.prototype,"dataExtent",void 0);k.__decorate([d.property({readOnly:!0,dependsOn:["scaleVisibility.suspended"]})],a.prototype,"suspended",null);k.__decorate([d.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],a.prototype,"suspendInfo",null);k.__decorate([d.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","watchUpdatingTracking.updating"],
autoTracked:!1})],a.prototype,"updating",null);a=k.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],a);const J={remove(){},pause(){},resume(){}};return a})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/Error ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/scheduling ../../../../core/Accessor ../../../../geometry/Point ../../../../geometry/Extent ../../../../geometry ../../../../support/arcadeOnDemand ../../../../core/mathUtils ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol ../../../../chunks/symbols ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/Handles ../../../../layers/Layer ../../../../renderers/Renderer ../../../../renderers/ClassBreaksRenderer ../../../../core/accessorSupport/diffUtils ../../../../renderers/UniqueValueRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/SimpleRenderer ../../../../renderers/support/jsonUtils ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../support/Scheduler ../../../../core/MapUtils ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ./graphicUtils ./featureExpressionInfoUtils ./symbolComplexity ./Graphics3DGraphicCreationContext ./Graphics3DGraphic ../../webgl-engine/lib/Layer ../../webgl-engine/lib/GridLocalOriginFactory ./Graphics3DWebStyleSymbol ../../support/extentUtils ../../support/PropertiesPool ./ElevationQuery ../../../../renderers/support/rendererConversion ../../../../symbols/support/defaults3D ./Graphics3DFeatureStore ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./GraphicStateTracking ./SpatialIndex2D ../support/StageLayerElevationProvider".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q,F,N,P,U,V,W,X,ca,R,aa,ka,da,fa,ea,Y,Z,ba,ia,ja,la,qa,na,oa,ua,za,Fa,La,Sa,Ia,Qa){var Pa;const sa=H.create(),Ga=R.create(),Ra=h.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");b.Graphics3DCore=Pa=function(ya){function xa(ma){ma=ya.call(this,ma)||this;ma.propertiesPool=new qa.PropertiesPool({computedExtent:x},k._assertThisInitialized(ma));ma.computedExtent=null;ma.currentRenderer=null;ma.rendererHasGeometryOperations=
!1;ma.graphicStateTracking=null;ma.symbolCreationContext=new Fa.Graphics3DSymbolCreationContext;ma.graphics3DGraphics=new Map;ma.stageLayer=null;ma.stage=null;ma.graphicsDrapedUids=new Set;ma.graphicsBySymbol=new Map;ma.symbolConversionCache=new Map;ma.symbols=new Map;ma.graphicsWithoutSymbol=new Map;ma.graphicsWaitingForSymbol=new Set;ma._handles=new J;ma._frameTask=X.ImmediateTask;ma.suspendSymbolCleanup=!1;ma._spatialReference=null;ma.arcadeOnDemand=null;ma.rendererChangeAbortController=null;ma.elevationInfoChangeAbortController=
null;ma.setupAbortController=null;ma.elevationAlignment=null;ma.scaleVisibility=null;ma.filterVisibility=null;ma._spatialIndex=null;ma.extentPadding=0;ma._updatingPendingLoadedGraphicsChange=null;ma.featureStore=null;ma.deconflictor=null;ma.labeler=null;ma.objectStates=null;ma.viewElevationProvider=null;ma.stageLayerElevationProvider=null;ma.sharedSymbolResourcesOwnerHandle=null;ma.whenGraphics3DGraphicRequests={};ma.pendingUpdates=new Map;ma.numberOfGraphics=0;ma.numberOfGraphicsProvidingElevation=
0;ma.pendingAdds=0;ma.pendingRemoves=0;ma.pendingUpdatesPool=new m({allocator:ta=>ta||new Wa,deallocator:ta=>{ta.clear();return ta}});ma.symbolWarningLogged=!1;ma.geometryWarningLogged=!1;ma.objectIdInvisibleSet=new Set;ma._whenSymbolRemoved=new m;ma.preferredUpdatePolicy=0;ma.forcedUpdatePolicy=null;ma._asyncUpdates=!1;ma.elevationFeatureExpressionEnabled=!0;ma.owner=null;ma.layer=null;ma.graphicSymbolSupported=!0;ma.getRenderingInfoWithoutRenderer=!1;ma.hasZ=null;ma.hasM=null;ma._usedMemory=0;ma._visible=
void 0;ma._startCreateGraphics=!1;ma.maxPendingUpdates=0;return ma}k._inheritsLoose(xa,ya);var wa=xa.prototype;wa.getConvertedSymbol=function(ma){if("web-style"===ma.type)return ma.clone();var ta=this.symbolConversionCache.get(ma.id);if(void 0!==ta)return ta;ta=G.to3D(ma,!0,!1,this.hasLabelingContext(ma));const Da=ta.symbol||null;Da||ta.error&&Ra.error(ta.error.message);this.symbolConversionCache.set(ma.id,Da);return Da};wa.getSymbolComplexitiesUsedOrRenderer=function(ma){if(l.isNone(ma))return[];
var ta=ma.getSymbols(),Da="backgroundFillSymbol"in ma&&ma.backgroundFillSymbol;if(!(Da||ta&&ta.length))return[];ma=[];Da=this.getSymbolComplexityUsedOrRenderer(Da);l.isSome(Da)&&ma.push(Da);for(const Oa of ta)ta=this.getSymbolComplexityUsedOrRenderer(Oa),l.isSome(ta)&&ma.push(ta);return ma};wa.getSymbolComplexityUsedOrRenderer=function(ma){if(l.isNone(ma))return null;const ta=this.symbols.get(ma.id);return l.isSome(ta)?ta.complexity:(ma=this.getConvertedSymbol(ma))?ea.defaultSymbolComplexity(ma):
null};wa.getSymbolComplexitiesUsed=function(){const ma=[];this.symbols.forEach(ta=>{l.isSome(ta)&&ma.push(ta.complexity)});return ma};wa.initialize=function(){this._spatialReference=this.owner.view.spatialReference;this._set("featureStore",new za["default"]({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,spatialReference:this._spatialReference,getSpatialIndex:()=>this.spatialIndex,forAllGraphics:ma=>this.graphics3DGraphics.forEach(ma)}))};wa.setup=async function(ma){this.setupAbortController=
u.createAbortController();const ta=this.setupAbortController.signal;this._set("elevationAlignment",ma.elevationAlignment);this._set("scaleVisibility",ma.scaleVisibility);this._set("filterVisibility",ma.filterVisibility);this._set("deconflictor",ma.deconflictor);this._set("labeler",ma.labeler);this._set("objectStates",ma.objectStates);const Da=this.owner.view;this.viewElevationProvider=new na.ViewElevationProvider(this._spatialReference,Da);this.initializeStage(Da,this.layer.uid);this.symbolCreationContext.sharedResources=
Da.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=Da.sharedSymbolResources.addGraphicsOwner(this.owner);l.isSome(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=Da.sharedSymbolResources.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=Da.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=this.owner;
this.symbolCreationContext.localOriginFactory=new ia;this.symbolCreationContext.elevationProvider=Da.elevationProvider;this.symbolCreationContext.notifyGraphicUpdate=(Oa,Ja)=>this.notifyGraphicUpdate(Oa,Ja);ma=fa.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=await fa.createContext(ma,this._spatialReference,Ra);u.throwIfAborted(ta);this.symbolCreationContext.screenSizePerspectiveEnabled=Da.screenSizePerspectiveEnabled&&
this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled;ma="layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled";this._handles.add([this.watch("suspendedOrOutsideOfView",()=>this.updateLayerVisibility()),this.owner.watch(ma,()=>{const Oa=Da.screenSizePerspectiveEnabled&&
this.layer.screenSizePerspectiveEnabled;Oa!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=Oa,this.recreateAllGraphics())}),U.init(this,"preferredUpdatePolicy",()=>this.updateUpdatePolicy(),!0),this.owner.watch("slicePlaneEnabled",Oa=>this.slicePlaneEnabledChange(!!Oa)),this.owner.view.watch("pixelRatio",()=>this.pixelRatioChange()),this.owner.view.watch("qualitySettings.physicallyBasedRenderingEnabled",Oa=>this.physicalBasedRenderingChange(Oa)),
U.when(Da.basemapTerrain,"tilingScheme",Oa=>{Oa.spatialReference.equals(this.symbolCreationContext.overlaySR)||(this.symbolCreationContext.overlaySR=Da.basemapTerrain.spatialReference);this._handles.has("loaded-graphics")?this.recreateAllGraphics():this._handles.add([U.on(this.owner,"loadedGraphics","change",Ja=>this.graphicsCollectionChanged(Ja),()=>this.recreateAllGraphics()),U.on(this.owner,"loadedGraphics","after-changes",()=>this._signalUpdatingDuringAsyncLoadedGraphicsChange(),()=>this._signalUpdatingDuringAsyncLoadedGraphicsChange())],
"loaded-graphics")})]);this._frameTask=Da.resourceController.scheduler.registerTask(X.Task.GRAPHICS_CORE,Oa=>this.update(Oa),()=>this.needsUpdate());this.owner.layer&&"featureReduction"in this.owner.layer&&this._handles.add(this.owner.watch("layer.featureReduction",()=>this.deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");try{await this.rendererChange(this.layer.renderer)}catch{}u.throwIfAborted(ta);this.setupAbortController=null};wa.abortSetup=function(){this.setupAbortController&&
(this.setupAbortController.abort(),this.setupAbortController=null)};wa.destroy=function(){this.abortSetup();this.abortRendererChange();this.abortElevationInfoChange();this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this._updatingPendingLoadedGraphicsChange&&(this._updatingPendingLoadedGraphicsChange.remove(),this._updatingPendingLoadedGraphicsChange=null);this.clear();l.isSome(this.graphicStateTracking)&&(this.graphicStateTracking.destroy(),
this.graphicStateTracking=null);this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),this.stage.remove(0,this.stageLayer.id),this.stage=this.stageLayer=null);this._handles=l.destroyMaybe(this._handles);this._frameTask.remove();this._frameTask=X.ImmediateTask;this._spatialReference=null;this._set("owner",null);for(const ma in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[ma].reject(new g("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=
null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null);this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear();this._spatialIndex&&(this._spatialIndex.destroy(),this._spatialIndex=null);this.featureStore&&(this.featureStore.destroy(),this._set("featureStore",null))};wa.clear=function(){this.objectStates&&
this.objectStates.allGraphicsDeleted();l.isSome(this.graphicStateTracking)&&this.graphicStateTracking.allGraphicsDeleted();this.graphics3DGraphics.forEach(ma=>ma.destroy());this._spatialIndex&&this._spatialIndex.clear();this.graphics3DGraphics.clear();this._usedMemory=this.numberOfGraphics=0;this.updateLayerVisibility();this.symbols.forEach(ma=>{l.isSome(ma)&&ma.destroy()});this.symbols.clear();this.graphicsBySymbol.clear();this.graphicsWithoutSymbol.clear();this.graphicsWaitingForSymbol.clear();
this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=this.pendingAdds=this.maxPendingUpdates=0;this.notifyChange("updating");this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining");this.featureStore.events.emit("changed")};wa.initializeStage=function(ma,ta){this.stage=ma._stage;this.stageLayer=new ba(ta,{isPickable:!this.suspendedOrOutsideOfView},ta);this.stage.add(0,this.stageLayer);this.stage.addToViewContent([this.stageLayer.id]);this.stageLayer.on("dirty",
Da=>{if(this.graphicStateTracking)switch(Da.dirtyType){case "objTransformation":case "objGeometryAdded":case "objGeometryRemoved":case "shaderTransformationChanged":case "vertexAttrsUpdated":this.notifyGraphicUpdate(Da.origin.metadata.graphicUid,2);break;case "visibilityChanged":this.notifyGraphicUpdate(Da.origin.metadata.graphicUid,1)}})};wa.notifyGraphicUpdate=function(ma,ta){switch(ta){case 1:this.notifyGraphicVisibilityChanged(ma);break;case 2:this.notifyGraphicGeometryChanged(ma)}};wa.notifyGraphicGeometryChanged=
function(ma){l.isNone(this.graphicStateTracking)||(ma=this.graphics3DGraphics.get(ma))&&this.graphicStateTracking.updateGraphicGeometry(ma)};wa.notifyGraphicVisibilityChanged=function(ma){l.isNone(this.graphicStateTracking)||(ma=this.graphics3DGraphics.get(ma))&&this.graphicStateTracking.updateGraphicVisibility(ma)};wa.updateLayerVisibility=function(){var ma=this.numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;ma=!this.suspendedOrOutsideOfView&&!ma;ma!==this._visible&&((this._visible=
ma)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()),this.updateStageLayerVisibility())};wa.updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};wa.getGraphics3DGraphicById=function(ma){return this.graphics3DGraphics.get(ma)};wa.getGraphics3DGraphicByObjectId=function(ma){var ta;return null!=(ta=this.owner.layer)&&ta.objectIdField?this._findGraphics3DGraphicByObjectId(ma):
null};wa._getGraphicObjectID=function(ma,ta=this.owner.layer&&this.owner.layer.objectIdField){return aa.getObjectId(ma,ta)};wa.updateLabelingInfo=async function(ma){const ta=this.deconflictor&&this.deconflictor.labelingInfoChange(ma);ma=this.labeler&&this.labeler.labelingInfoChange(ma);await u.eachAlways([ta,ma])};wa.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange();this.labeler&&this.labeler.visibilityInfoChange()};wa.needsUpdate=function(){return 0<this.pendingUpdates.size};
wa.update=function(ma){this._applyPendingUpdates(ma);this.needsUpdate()||this.notifyChange("updating")};wa.setObjectIdVisibility=function(ma,ta){ta?this.objectIdInvisibleSet.delete(ma):this.objectIdInvisibleSet.add(ma);ma=this._findGraphics3DGraphicByObjectId(ma);l.isSome(ma)&&this._updateUserVisibility(ma)};wa._findGraphics3DGraphicByObjectId=function(ma){return ca.findInMap(this.graphics3DGraphics,ta=>this._getGraphicObjectID(ta.graphic)===ma)};wa._updateUserVisibility=function(ma){if(l.isNone(ma))return!1;
var ta=ma.graphic;const Da=this._getGraphicObjectID(ta);ta=ta.visible&&!this.owner.suspended&&(l.isNone(Da)||!this.objectIdInvisibleSet.has(Da));return ma.setVisibilityFlag(0,ta,0)};wa.whenGraphics3DGraphic=function(ma){var ta=this.graphics3DGraphics.get(ma.uid);if(ta)return u.resolve(ta);if(ta=this.whenGraphics3DGraphicRequests[ma.uid])return ta.promise;ta=u.createDeferred();this.whenGraphics3DGraphicRequests[ma.uid]=ta;return ta.promise};wa.boundsForGraphics3DGraphic=async function(ma,ta){const Da=
this._spatialReference,Oa=this.owner.view.renderSpatialReference,Ja=this.owner.view.basemapTerrain.spatialReference;var ra=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:l.isSome(ta)&&ta.useViewElevation,minDemResolution:l.isSome(ta)&&ta.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null;ma=await ma.getProjectedBoundingBox((Ca,Ma,Ta)=>W.projectBuffer(Ca,Oa,Ma,Ca,Da,Ma,Ta),(Ca,Ma,Ta)=>W.projectBuffer(Ca,Ja,Ma,Ca,Da,Ma,Ta),ra,l.get(ta,"signal"));
if(!ma)return null;ta=ma.boundingBox;ma.requiresDrapedElevation&&(ra=this.symbolCreationContext.elevationProvider)&&(R.center(ta,sa),ra=ra.getElevation(sa[0],sa[1],0,Da,"ground")||0,ta[2]=Math.min(ta[2],ra),ta[5]=Math.max(ta[5],ra));return{boundingBox:ta,screenSpaceObjects:ma.screenSpaceObjects}};wa.whenGraphicBounds=function(ma,ta){return U.whenOnce(this.owner,"loadedGraphics").then(()=>{const Da=this.owner.layer&&this.owner.layer.objectIdField,Oa=this.owner.loadedGraphics.find(Ja=>Ja===ma?!0:Da&&
Ja.attributes&&ma.attributes&&Ja.attributes[Da]===ma.attributes[Da]);if(Oa)return this.whenGraphics3DGraphic(Oa);throw new g("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(Da=>this.boundsForGraphics3DGraphic(Da,ta))};wa.computeAttachmentOrigin=function(ma,ta){ma=this.graphics3DGraphics.get(ma.uid);if(!ma)return null;var Da=ma.computeAttachmentOrigin();if(0===Da.render.num&&0===Da.draped.num)return null;I.set(db,0,0,0);ma=0;if(0<Da.render.num){if(!W.projectVectorToVector(Da.render.origin,
this.symbolCreationContext.renderCoordsHelper.spatialReference,mb,ta))return null;I.add(db,db,mb);ma++}if(0<Da.draped.num){const [Oa,Ja]=Da.draped.origin;Da=this.viewElevationProvider.getElevation(Oa,Ja,"ground")||0;I.set(mb,Oa,Ja,Da);if(!W.projectVectorToVector(mb,this.viewElevationProvider.spatialReference,mb,ta))return null;I.add(db,db,mb);ma++}1<ma&&I.scale(db,db,1/ma);return new B({x:db[0],y:db[1],z:db[2],spatialReference:ta})};wa.getSymbolLayerSize=function(ma,ta){var Da=this.symbols.get(ma.id);
if(l.isNone(Da))throw new g("internal:symbol-not-part-of-view","Symbol is not part of this view");ma=ma.symbolLayers.indexOf(ta);if(-1===ma)throw new g("internal:missing-symbol-layer","Symbol layer is not in symbol");Da=Da.getSymbolLayerSize(ma);if(null==Da)throw new g("internal:missing-size","Symbol layer has no valid size");return Da};wa.graphicsCollectionChanged=function(ma){this._startCreateGraphics&&(this.add(ma.added),this.remove(ma.removed))};wa.graphicUpdateHandler=function(ma){var ta=ma.graphic.uid;
const Da=this.graphics3DGraphics.get(ta);ta=this.graphicsWithoutSymbol.get(ta);if(Da||ta)switch(ma.property){case "visible":this.graphicUpdateVisibleHandler(Da);break;case "geometry":this.graphicUpdateGeometryHandler(Da,ma);break;case "symbol":this.graphicUpdateSymbolHandler(Da,ma)}};wa.graphicUpdateGeometryHandler=function(ma,ta){const Da=ta.graphic.geometry;if(l.isNone(Da))this.recreateGraphic(ta.graphic);else if(l.isNone(ma)){if(ma=ta.graphic.symbol&&ta.graphic.symbol.id)if(ma=this.symbols.get(ma),
l.isSome(ma)&&0===ma.loadStatus)return;this.recreateGraphic(ta.graphic)}else ma.graphics3DSymbol.updateGeometry(ma,ta.newValue)||this.recreateGraphic(ma.graphic),this.expandComputedExtent(Da)};wa.graphicUpdateSymbolHandler=function(ma,ta){var Da=ta.graphic;const Oa=l.isSome(ma)?ma.graphics3DSymbol:ta.oldValue&&this.symbols.get(ta.oldValue.id);if(l.isNone(Oa))this.recreateGraphic(Da);else{var Ja=Oa.symbol;ta=this.getConvertedSymbol(ta.newValue);if(ta.type!==Ja.type||"web-style"===ta.type||"web-style"===
Ja.type)this.recreateGraphic(Da);else{var ra=this.graphicsBySymbol.get(Ja.id);if(ra&&1!==ra.size)this.recreateGraphic(Da);else if(ra=M.diff(Ja,ta),l.isNone(ra))this.updateSymbolMapping(Ja.id,ta);else if(ra={diff:ra,graphics3DGraphicPatches:[],symbolStatePatches:[]},Oa.prepareSymbolPatch(ra),M.isEmpty(ra.diff)){var Ca=Oa.extentPadding;for(const Ma of ra.symbolStatePatches)Ma();Ca!==Oa.extentPadding&&this.recomputeExtentPadding();Da=this._getRenderingInfo(Da);if(l.isSome(ma))for(const Ma of ra.graphics3DGraphicPatches)Ma(ma,
Da);this.updateSymbolMapping(Ja.id,ta)}else this.recreateGraphic(Da)}}};wa.graphicUpdateVisibleHandler=function(ma){this._updateUserVisibility(ma)&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};wa.recreateGraphics=function(ma){this.suspendSymbolCleanup=!0;this.remove(ma);this.add(ma);this.suspendSymbolCleanup=!1;this.asyncUpdates||this._cleanupSymbols()};wa.recreateGraphic=function(ma){this.recreateGraphics([ma])};wa._beginGraphicUpdate=function(ma){this.graphicsWaitingForSymbol.add(ma.uid);
1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)};wa._endGraphicUpdate=function(ma){ma&&(this.graphicsWaitingForSymbol.delete(ma.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"),this._get("symbolsUpdating")&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))))};wa.recomputeExtentPadding=function(){let ma=0;this.symbols.forEach(ta=>{l.isSome(ta)&&
(ma=Math.max(ma,ta.extentPadding))});this._set("extentPadding",ma)};wa.expandComputedExtent=function(ma){var ta=ma.spatialReference;aa.computeAABB(ma,Ga);ma=this._spatialReference;var Da=Pa.tmpVec;!ta.equals(ma)&&W.projectXYZToVector(Ga[0],Ga[1],0,ta,Da,ma)&&(Ga[0]=Da[0],Ga[1]=Da[1],W.projectXYZToVector(Ga[3],Ga[4],0,ta,Da,ma),Ga[3]=Da[0],Ga[4]=Da[1]);if(A.isFinite(Ga[0])&&A.isFinite(Ga[3])&&A.isFinite(Ga[1])&&A.isFinite(Ga[4])){ta=this.computedExtent;Da=null;var Oa=A.isFinite(Ga[2])&&A.isFinite(Ga[5]),
Ja=Oa&&(!ta||null==ta.zmin||Ga[2]<ta.zmin);Oa=Oa&&(!ta||null==ta.zmax||Ga[5]>ta.zmax);if(ta){if(Ga[0]<ta.xmin||Ga[1]<ta.ymin||Ga[3]>ta.xmax||Ga[4]>ta.ymax||Ja||Oa)Da=this.propertiesPool.get("computedExtent"),Da.xmin=Math.min(Ga[0],ta.xmin),Da.ymin=Math.min(Ga[1],ta.ymin),Da.xmax=Math.max(Ga[3],ta.xmax),Da.ymax=Math.max(Ga[4],ta.ymax),Da.spatialReference=ma}else Da=this.propertiesPool.get("computedExtent"),Da.xmin=Ga[0],Da.ymin=Ga[1],Da.xmax=Ga[3],Da.ymax=Ga[4],Da.spatialReference=ma;Da&&(Ja&&(Da.zmin=
Ga[2]),Oa&&(Da.zmax=Ga[5]),this._set("computedExtent",Da))}};wa.abortElevationInfoChange=function(){this.elevationInfoChangeAbortController&&(this.elevationInfoChangeAbortController.abort(),this.elevationInfoChangeAbortController=null)};wa.elevationInfoChange=async function(){this.abortElevationInfoChange();const ma=u.createAbortController();this.elevationInfoChangeAbortController=ma;const ta=fa.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=
await fa.createContext(ta,this._spatialReference,Ra);u.throwIfAborted(ma);this.elevationInfoChangeAbortController=null;this.labeler&&this.labeler.elevationInfoChange();this.forEachGraphics3DSymbol((Da,Oa,Ja)=>{Da.globalPropertyChanged("elevationInfo",Oa)?Oa.forEach(ra=>{const Ca=ra.graphic;ra=ra.labelGraphics;for(const Ma of ra)Ma.graphics3DSymbolLayer.updateGraphicElevationContext(Ca,Ma)}):this._recreateSymbol(Ja)});this.updateStageLayerElevationProvider();this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()};
wa.updateStageLayerElevationProvider=function(){if(this.stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this.numberOfGraphicsProvidingElevation&&
(this.stageLayerElevationProvider=new Qa.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))};wa.clearSymbolsAndGraphics=function(){this.clear();this.filterVisibility&&this.filterVisibility.clear();this.labeler&&this.labeler.reset();this.deconflictor&&this.deconflictor.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator();
this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)};wa.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};wa.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&
this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.loadedGraphics.length&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};wa._recreateSymbol=function(ma){var ta=this.graphicsBySymbol.get(ma);const Da=[];ta&&(ta.forEach((Oa,Ja)=>{const ra=Oa.usedMemory;this._conditionalRemove(Oa,Ja);this._spatialIndex&&this._spatialIndex.remove(Oa);Da.push(Oa.graphic);
Oa.destroy();this.removeGraphics3DGraphic(Ja,ra);this.updateLayerVisibility();this.featureStore.events.emit("changed")}),this.graphicsBySymbol.set(ma,new Map));ta=this.symbols.get(ma);l.isSome(ta)&&ta.destroy();this.symbols.delete(ma);this.add(Da)};wa._conditionalRemove=function(ma,ta){ma.isDraped&&this.graphicsDrapedUids.delete(ta);this.objectStates&&this.objectStates.removeGraphic(ma);this.labeler&&this.labeler.removeGraphic(ma);this.deconflictor&&this.deconflictor.removeGraphic(ma);l.isSome(this.graphicStateTracking)&&
this.graphicStateTracking.removeGraphic(ma)};wa.add=function(ma){ma&&0!==ma.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this.asyncUpdates?this._addDelayed(ma):this._addImmediate(ma),this.notifyChange("updating")):Ra.error("#add()","Cannot add graphics before terrain surface has been initialized"))};wa._addImmediate=function(ma){this.symbolWarningLogged=this.geometryWarningLogged=!1;Ua.clear();for(const ta of ma)this._startAddGraphic(ta,this._getRenderingInfo(ta,
Ra),Ua);Ua.forEach(ta=>this._finishAddGraphics(ta));Ua.clear();this._cleanupSymbols();this.labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()};wa._addDelayed=function(ma){for(const ta of ma){ma=ta.uid;let Da=this.pendingUpdates.get(ma);Da?Da.add?0!==Da.state&&Da.abortController.abort():this.pendingAdds++:(Da=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(ma,Da));Da.add=ta}this.maxPendingUpdates=Math.max(this.maxPendingUpdates,
this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};wa.remove=function(ma){this.asyncUpdates?this._removeDelayed(ma):this._removeImmediate(ma);this.notifyChange("updating")};wa._removeImmediate=function(ma){for(const ta of ma)this._removeGraphic(ta);this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};wa._removeDelayed=function(ma){for(const Da of ma){ma=Da.uid;var ta=this.pendingUpdates.get(ma);
ta?ta.add&&(ta.remove?ta.add=null:this.pendingUpdates.delete(ma),1===ta.state&&ta.abortController.abort(),this.pendingAdds--):(ta=this.pendingUpdatesPool.pushNew(),ta.remove=Da,this.pendingUpdates.set(ma,ta),this.pendingRemoves++)}0===this.pendingUpdates.size&&this._finishPendingUpdates();this.maxPendingUpdates=Math.max(this.maxPendingUpdates,this.pendingUpdates.size);this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};wa._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();
this.maxPendingUpdates=0;this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&Ra.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};wa._applyPendingUpdates=function(ma){this.symbolWarningLogged=this.geometryWarningLogged=!1;const ta=2===ma.state?1E3:100;let Da=0;Ua.clear();for(const [Oa,Ja]of this.pendingUpdates){Ja.add&&0===Ja.state&&this._startAddRenderingInfo(Ja);!Ja.remove||Ja.add&&2!==Ja.state||(this.pendingRemoves--,ma.madeProgress(),this._removeGraphic(Ja.remove),
Ja.remove=null);if(Ja.add)switch(Ja.state){case 2:this._startAddGraphic(Ja.add,Ja.renderingInfo,Ua)&&Da++;Ja.add=null;this.pendingAdds--;ma.madeProgress();break;case 3:Ja.add=null,this.pendingAdds--}Da>ta&&(Ua.forEach(ra=>this._finishAddGraphics(ra)),Ua.clear(),Da=0);null==Ja.remove&&null==Ja.add&&this.pendingUpdates.delete(Oa);if(ma.done)break}Ua.forEach(Oa=>this._finishAddGraphics(Oa));Ua.clear();0===this.pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("updatingTotal");this.notifyChange("updatingRemaining")};
wa._startAddRenderingInfo=function(ma){l.isSome(this.layer.renderer)&&"dictionary"===this.layer.renderer.type?(ma.state=1,ma.abortController=u.createAbortController(),this._getRenderingInfoAsync(ma.add,{signal:ma.abortController.signal}).then(ta=>{l.isNone(ta)||l.isNone(ta.symbol)?(Ra&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Ra.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),ma.renderingInfo=null):ma.renderingInfo=ta;ma.state=2},ta=>{ma.abortController=
null;u.isAbortError(ta)?ma.state=0:ma.state=3})):(ma.renderingInfo=this._getRenderingInfo(ma.add,Ra),ma.state=2)};wa._startAddGraphic=function(ma,ta,Da){this.graphicsWithoutSymbol.set(ma.uid,ma);if(!ta||l.isNone(ta.symbol)||!aa.hasGeometry(ma))return!1;const Oa=this.getOrCreateGraphics3DSymbol(ta.symbol,ta.renderer);if(l.isNone(Oa))return!1;this.expandComputedExtent(ma.geometry);this._beginGraphicUpdate(ma);ma=new Y(ma,ta,this.layer);ta=Oa.symbol.id;var Ja=Da.get(ta);Ja?Ja.graphics.push(ma):(Ja=Ya.acquire(),
Ja.clear(),Ja.push(ma),Da.set(ta,{asyncSymbol:Oa,graphics:Ja}));return!0};wa._finishAddGraphics=function(ma){let ta=!1;const Da=Oa=>{Oa===ma.asyncSymbol.symbol.id&&(ta=!0)};this._whenSymbolRemoved.push(Da);ma.asyncSymbol.load(()=>{this.destroyed||(this._whenSymbolRemoved.removeUnordered(Da),ha.clear(),ma.graphics.forAll(Oa=>{const Ja=Oa.graphic;ta||ma.asyncSymbol.destroyed||this.graphicSymbolSupported&&Ja.symbol&&Ja.symbol.id!==ma.asyncSymbol.symbol.id||(this.graphicsWaitingForSymbol.has(Ja.uid)&&
(Oa=this.createGraphics3DGraphic(ma.asyncSymbol,Oa),this._spatialIndex&&l.isSome(Oa)&&ha.push(Oa)),this._endGraphicUpdate(Ja));--ma.asyncSymbol.referenced}),0<ha.length&&(this._spatialIndex.addMany(ha.data,ha.length),ha.clear()),this.featureStore.events.emit("changed"),ma.graphics.clear(),Ya.release(ma.graphics),this.labeler&&this.owner.view.labeler.setDirty())},Oa=>{this.destroyed||(this._whenSymbolRemoved.removeUnordered(Da),ta||(u.isAbortError(Oa)?this.add(ma.graphics.map(Ja=>Ja.graphic)):ma.asyncSymbol.destroyed||
ma.graphics.forAll(({graphic:Ja})=>this._endGraphicUpdate(Ja))),ma.graphics.clear(),Ya.release(ma.graphics))})};wa._removeGraphic=function(ma){ma=ma.uid;const ta=this.graphics3DGraphics.get(ma);if(ta){ta.graphics3DSymbol.onRemoveGraphic(ta);const Da=ta.usedMemory,Oa=ta.isElevationSource;this._conditionalRemove(ta,ma);this._spatialIndex&&this._spatialIndex.remove(ta);this.graphicsBySymbol.get(ta.graphics3DSymbol.symbol.id).delete(ma);this.graphicsWithoutSymbol.delete(ma);this.removeGraphics3DGraphic(ma,
Da,Oa);ta.destroy();this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(ma),this.graphicsWaitingForSymbol.delete(ma)};wa.hasLabelingContext=function(ma){if(ma instanceof t||ma instanceof D){const ta=this.symbolCreationContext.layer;return ta.labelingInfo?ta.labelingInfo.some(Da=>Da.symbol===ma):!1}return!1};wa.hasValidSymbolCreationContext=function(ma){return ma instanceof t&&!this.hasLabelingContext(ma)?(Ra.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),
!1):!0};wa._getRenderingInfo=function(ma,ta){const Da=ma.geometry;if(l.isNone(Da))return ta&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,ta.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!W.canProjectWithoutEngine(Da.spatialReference,this._spatialReference))return ta&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,ta.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&
l.isSome(ma.symbol))return ta&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,ta.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;ma=this.rendererHasGeometryOperations?ka.hydrateGraphic(ma,this.layer):ma;ma=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||l.isSome(this.currentRenderer))?this.owner.getRenderingInfo(ma,this.currentRenderer,l.unwrap(this.arcadeOnDemand)):{symbol:ma.symbol||ua.getDefaultSymbol3D(ma.geometry)};
return!ma||l.isNone(ma.symbol)?(ta&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,ta.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):ma};wa._getRenderingInfoAsync=function(ma,ta){if(l.isNone(ma.geometry))return Ra&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,Ra.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&l.isSome(ma.symbol))return Ra&&!this.symbolWarningLogged&&(this.symbolWarningLogged=
!0,Ra.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;ma=this.rendererHasGeometryOperations?ka.hydrateGraphic(ma,this.layer):ma;return this.owner.getRenderingInfoAsync(ma,l.unwrap(this.currentRenderer),l.unwrap(this.arcadeOnDemand),ta)};wa.createGraphics3DSymbol=function(ma,ta){if(!this.hasValidSymbolCreationContext(ma))return null;ma=this.getConvertedSymbol(ma);if(!ma)return null;let Da;l.isSome(ta)&&"backgroundFillSymbol"in ta&&ta.backgroundFillSymbol&&
(ta=G.to3D(ta.backgroundFillSymbol,!1,!0),ta.symbol&&"web-style"!==ta.symbol.type&&(Da=ta.symbol.symbolLayers));const Oa=La.make(ma,this.symbolCreationContext,Da);Oa.load(()=>{const Ja=Oa.extentPadding;Ja>this.extentPadding&&this._set("extentPadding",Ja);this.notifyChange("averageSymbolComplexity")},()=>{});return Oa};wa.getOrCreateGraphics3DSymbol=function(ma,ta){let Da=this.symbols.get(ma.id);void 0===Da&&(Da=ma instanceof E?new ja(ma,Oa=>this.createGraphics3DSymbol(Oa,ta)):this.createGraphics3DSymbol(ma,
ta),this.symbols.set(ma.id,Da));l.isSome(Da)&&++Da.referenced;return Da};wa.trackGraphicState=function(ma){l.isNone(this.graphicStateTracking)&&(this.graphicStateTracking=new Sa.GraphicStateTracking(this));return this.graphicStateTracking.add(ma)};wa.addGraphics3DGraphic=function(ma){this._usedMemory+=ma.usedMemory;this.graphics3DGraphics.set(ma.graphic.uid,ma);this.numberOfGraphics++;ma.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};
wa.removeGraphics3DGraphic=function(ma,ta,Da=!1){this._usedMemory-=ta;this.graphics3DGraphics.delete(ma);this.numberOfGraphics--;Da&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this.updateLayerVisibility()};wa.createGraphics3DGraphic=function(ma,ta){const Da=ta.graphic;this.graphicsWithoutSymbol.delete(Da.uid);if(!this.symbols.has(ma.symbol.id))return this.add([Da]),null;if(this.graphics3DGraphics.has(Da.uid))return null;ta=ma.createGraphics3DGraphic(ta);if(l.isNone(ta))return null;
this.addGraphics3DGraphic(ta);ma=ma.symbol.id;this.graphicsBySymbol.has(ma)||this.graphicsBySymbol.set(ma,new Map);this.graphicsBySymbol.get(ma).set(Da.uid,ta);ta.isDraped&&this.graphicsDrapedUids.add(Da.uid);ta.centroid=null;l.isSome(Da.geometry)&&"point"!==Da.geometry.type&&ta instanceof Z&&(ta.centroid=da.computeCentroid(Da.geometry,this._spatialReference));this._updateUserVisibility(ta);this.scaleVisibility&&this.scaleVisibility.updateVisibility(ta);this.filterVisibility&&this.filterVisibility.updateVisibility(ta);
this.deconflictor&&this.deconflictor.addGraphic(ta);this.labeler&&this.labeler.addGraphic(ta);this.objectStates&&this.objectStates.addGraphic(ta);this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,ta);ta.initialize(this.stage,this.stageLayer,this.owner);l.isSome(this.graphicStateTracking)&&this.graphicStateTracking.addGraphic(ta);if(ma=this.whenGraphics3DGraphicRequests[Da.uid])delete this.whenGraphics3DGraphicRequests[Da.uid],ma.resolve(ta);return ta};wa.abortRendererChange=
function(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),this.rendererChangeAbortController=null)};wa.rendererChange=async function(ma){this.abortRendererChange();if(ma!==this.currentRenderer)if(this.validateRenderer(ma),oa.isSupportedRenderer3D(ma))if(l.isSome(ma)&&ma.arcadeRequired){var ta=u.createAbortController();this.rendererChangeAbortController=ta;const {arcadeUtils:Da}=await this.ensureArcade();u.throwIfAborted(ta);Da.hasGeometryOperations(ma)&&(await Da.enableGeometryOperations(),
u.throwIfAborted(ta));this.asyncUpdates?await this._frameTask.schedule(()=>this.currentRendererChange(ma,!0),ta.signal):this.currentRendererChange(ma,!0);this.rendererChangeAbortController=null}else this.asyncUpdates?(this.rendererChangeAbortController=ta=u.createAbortController(),await this._frameTask.schedule(()=>this.currentRendererChange(ma,!1),ta.signal),this.rendererChangeAbortController=null):this.currentRendererChange(ma,!1);else this.currentRendererChange(null,!1)};wa.ensureArcade=async function(){l.isNone(this.arcadeOnDemand)&&
(this.arcadeOnDemand=await z.loadArcade());return this.arcadeOnDemand};wa.currentRendererChange=function(ma,ta){this.currentRenderer=ma;this.rendererHasGeometryOperations=ta;this.symbolCreationContext.arcade=l.unwrap(this.arcadeOnDemand);ta=this.symbolCreationContext.renderer;if(ma!==ta)if(this.updateUpdatePolicy(),this.symbolConversionCache.clear(),l.isNone(ma))this.symbolCreationContext.renderer=null,this.recreateAllGraphics();else{var Da=M.diff(ta,ma);this.updateUnchangedSymbolMappings(Da,ma,ta);
this.symbolCreationContext.renderer=ma;l.isNone(Da)||("complete"===Da.type?this.recreateAllGraphics():"partial"===Da.type&&(this.applyRendererDiff(Da,ma,ta)?this.volatileGraphicsUpdated():this.recreateAllGraphics()),this.notifyChange("averageSymbolComplexity"))}};wa.diffHasSymbolChange=function(ma){for(const ta in ma.diff)switch(ta){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete ma.diff[ta];break;default:return!0}return!1};
wa.applySymbolSetDiff=function(ma,ta,Da){ma=ma||[];ta=ta||[];const Oa=[];for(const Ja of ta){const ra=this.graphicsBySymbol.get(Ja.id);ra&&ra.forEach((Ca,Ma)=>{var Ta=Ca.graphic,Xa=this.layer instanceof K?this.layer:null;const ab=l.unwrap(this.arcadeOnDemand);if(Ja!==Da.defaultSymbol||Da.getSymbol(ka.hydrateGraphic(Ta,Xa),{arcade:ab})!==Da.defaultSymbol)Xa=Ca.usedMemory,ma.length||Da.defaultSymbol?Oa.push(Ta):this.graphicsWithoutSymbol.set(Ma,Ta),Ta=this.graphics3DGraphics.get(Ma),this._conditionalRemove(Ta,
Ma),Ca.destroy(),ra.delete(Ma),this.removeGraphics3DGraphic(Ma,Xa),this.updateLayerVisibility()});this._whenSymbolRemoved.forAll(Ca=>Ca(Ja.id))}if(ma.length||Oa.length)this.graphicsWithoutSymbol.forEach(Ja=>Oa.push(Ja)),this.graphicsWithoutSymbol.clear(),this.add(Oa);this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};wa.applyUniqueValueRendererDiff=function(ma,ta,Da){const Oa=ma.diff.defaultSymbol,Ja=ma.diff.uniqueValueInfos;if(Oa||Ja){const ra=
Ja?Ja.added.map(Ma=>Ma.symbol):[],Ca=Ja?Ja.removed.map(Ma=>Ma.symbol):[];if(Ja)for(let Ma=0;Ma<Ja.changed.length;Ma++)ra.push(Ja.changed[Ma].newValue.symbol),Ca.push(Ja.changed[Ma].oldValue.symbol);Oa?(Da.defaultSymbol&&Ca.push(Da.defaultSymbol),ta.defaultSymbol&&ra.push(ta.defaultSymbol)):Da.defaultSymbol&&ra.length&&Ca.push(ta.defaultSymbol);this.applySymbolSetDiff(ra,Ca,ta);delete ma.diff.defaultSymbol;delete ma.diff.uniqueValueInfos;return!0}return!1};wa.calculateUnchangedSymbolMapping=function(ma,
ta,Da){const Oa=ra=>l.isSome(ra)?ra.id:null;if(ta instanceof T&&Da instanceof T&&(l.isNone(ma)||"partial"===ma.type)){var Ja=ma&&ma.diff;ma=Ja&&Ja.defaultSymbol;Ja=(Ja=Ja&&Ja.uniqueValueInfos)?Ja.unchanged.map(ra=>({oldId:Oa(ra.oldValue.symbol),newId:Oa(ra.newValue.symbol)})):Da.uniqueValueInfos.map((ra,Ca)=>({oldId:Oa(ra.symbol),newId:Oa(ta.uniqueValueInfos[Ca].symbol)}));!ma&&Da.defaultSymbol&&Ja.push({oldId:Oa(Da.defaultSymbol),newId:Oa(ta.defaultSymbol)});return Ja}return[]};wa.updateSymbolMapping=
function(ma,ta){const Da=ta?"string"===typeof ta?ta:ta.id:null;ta="string"===typeof ta?null:ta;if(ma&&ma!==Da){var Oa=this.graphicsBySymbol.get(ma);this.graphicsBySymbol.delete(ma);void 0!==Oa&&this.graphicsBySymbol.set(Da,Oa);Oa=this.symbols.get(ma);void 0!==Oa&&(this.symbols.delete(ma),this.symbols.set(Da,Oa),l.isSome(Oa)&&(l.isSome(ta)?Oa.symbol=ta:Oa.symbol.id=Da))}};wa.updateUnchangedSymbolMappings=function(ma,ta,Da){ma=this.calculateUnchangedSymbolMapping(ma,ta,Da);for(const {oldId:Oa,newId:Ja}of ma)this.updateSymbolMapping(Oa,
Ja)};wa.applyRendererDiff=function(ma,ta,Da){if(this.diffHasSymbolChange(ma))return!1;if(ta instanceof T&&Da instanceof T&&this.applyUniqueValueRendererDiff(ma,ta,Da)&&0===Object.keys(ma.diff).length)return!0;for(const [Oa]of this.graphicsBySymbol)if(Da=this.symbols.get(Oa),l.isSome(Da)&&!Da.applyRendererDiff(ma,ta))return!1;return!0};wa.opacityChange=function(){this.forEachGraphics3DSymbol((ma,ta)=>ma.globalPropertyChanged("opacity",ta));this.updateStageLayerVisibility()};wa.updateUpdatePolicy=function(){const ma=
l.isSome(this.currentRenderer)&&"dictionary"===this.currentRenderer.type;l.isSome(this.forcedUpdatePolicy)?this._asyncUpdates=1===this.forcedUpdatePolicy:this._asyncUpdates=1===this.preferredUpdatePolicy||ma;(this.symbolCreationContext.isAsync=this._asyncUpdates)||this.update(X.noBudget)};wa.slicePlaneEnabledChange=function(ma){ma!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=ma,this.stageLayer.isSliceable=ma,this.forEachGraphics3DSymbol((ta,Da)=>ta.globalPropertyChanged("slicePlaneEnabled",
Da)),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())};wa.physicalBasedRenderingChange=function(ma){ma!==this.symbolCreationContext.physicalBasedRenderingEnabled&&(this.symbolCreationContext.physicalBasedRenderingEnabled=ma,this.forEachGraphics3DSymbol((ta,Da)=>ta.globalPropertyChanged("physicalBasedRenderingEnabled",Da)))};wa.pixelRatioChange=function(){this.forEachGraphics3DSymbol((ma,ta,Da)=>{ma.globalPropertyChanged("pixelRatio",
ta)||this._recreateSymbol(Da)})};wa._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=v.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})};wa.setClippingExtent=function(ma,ta){const Da=this.symbolCreationContext.clippingExtent,Oa=V.create();la.toBoundingRect(ma,Oa,ta)?this.symbolCreationContext.clippingExtent=R.fromRect(R.create(),Oa):this.symbolCreationContext.clippingExtent=
null;return!R.equals(this.symbolCreationContext.clippingExtent,Da)};wa.modifyGraphics3DGraphicVisibilities=function(ma){let ta=!1;this.graphics3DGraphics.forEach(Da=>{ma(Da)&&(ta=!0)});ta&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};wa.forEachGraphics3DSymbol=function(ma){for(const [ta,Da]of this.symbols){if(l.isNone(Da))break;const Oa=this.graphicsBySymbol.get(ta);ma(Da,Oa||Ea,ta)}};wa.updateAllGraphicsVisibility=function(){this.filterVisibility&&(this.filterVisibility.dirty=
!0);this.modifyGraphics3DGraphicVisibilities(ma=>{const ta=this._updateUserVisibility(ma);ma=this.scaleVisibility&&this.scaleVisibility.updateVisibility(ma);return ta||ma})};wa.hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(ma=>ma.setVisibilityFlag(0,!1,0))};wa.validateRenderer=function(ma){(ma=oa.validateTo3D(ma))&&Ra.warn(`Renderer for layer '${this.layer.title?`${this.layer.title}, `:""}, id:${this.layer.id}' is not supported in a SceneView`,ma.message)};wa.volatileGraphicsUpdated=
function(){this.labeler&&this.labeler.reset();this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};wa._cleanupSymbols=function(){if(!(0<this.graphicsWaitingForSymbol.size||this.suspendSymbolCleanup)){var ma=!1;this.symbols.forEach((ta,Da)=>{if(!(l.isNone(ta)||0<ta.referenced)){var Oa=this.graphicsBySymbol.get(Da);Oa&&0!==Oa.size||(this.graphicsBySymbol.delete(Da),this.symbols.delete(Da),ta&&ta.destroy(),ma=!0)}});ma&&(this.recomputeExtentPadding(),
this.notifyChange("averageSymbolComplexity"))}};wa.snapshotInternals=function(){return{graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this.symbols.keys()].sort(),graphicsBySymbol:[...this.graphicsBySymbol.keys()].sort().map(ma=>({symbolId:ma,graphics:[...this.graphicsBySymbol.get(ma).keys()].sort()})),graphicsWithoutSymbol:[...this.graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this.graphicsDrapedUids].sort(),pendingUpdates:this.pendingUpdates}};k._createClass(xa,[{key:"spatialIndex",
get:function(){if(!this._spatialIndex){this._spatialIndex=new Ia["default"]({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,spatialReference:this._spatialReference,hasZ:this.hasZ,hasM:this.hasM});let ma=0;const ta=Array(this.graphics3DGraphics.size);this.graphics3DGraphics.forEach(Da=>ta[ma++]=Da);this._spatialIndex.addMany(ta)}return this._spatialIndex}},{key:"asyncUpdates",get:function(){return this._asyncUpdates}},{key:"updating",get:function(){return!!(0<this.graphicsWaitingForSymbol.size||
this.needsUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&this.scaleVisibility.updating||this.filterVisibility&&this.filterVisibility.updating||this.rendererChangeAbortController||this.elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating)}},{key:"suspendedOrOutsideOfView",get:function(){var ma;return this.owner.suspended||(null==(ma=this.owner.suspendInfo)?void 0:ma.outsideOfView)}},{key:"updatingRemaining",
get:function(){return this.updating?this.pendingUpdates.size:0}},{key:"updatingTotal",get:function(){return this.updating?this.maxPendingUpdates:0}},{key:"displayFeatureLimit",get:function(){var ma=this.owner&&this.owner.view&&this.owner.view.qualitySettings;const ta=ma?ma.graphics3D.minTotalNumberOfFeatures:0,Da=ma?ma.graphics3D.maxTotalNumberOfFeatures:0;ma=ma?ma.graphics3D.maxTotalNumberOfPrimitives:0;const Oa=this.averageSymbolComplexity;var Ja=Math.max(1,l.isSome(Oa)?Oa.primitivesPerFeature:
1),ra=l.isSome(Oa)&&0<Oa.drawCallsPerFeature?Da/Oa.drawCallsPerFeature*.3:Da;Ja=Math.max(ta,Math.min(Da,Math.ceil(ma/Ja),ra));return(ra=this._get("displayFeatureLimit"))&&ra.minimumTotalNumberOfFeatures===ta&&ra.maximumTotalNumberOfFeatures===Da&&ra.maximumTotalNumberOfPrimitives===ma&&ra.averageSymbolComplexity===Oa&&ra.maximumNumberOfFeatures===Ja?ra:{minimumTotalNumberOfFeatures:ta,maximumTotalNumberOfFeatures:Da,maximumTotalNumberOfPrimitives:ma,averageSymbolComplexity:Oa,maximumNumberOfFeatures:Ja}}},
{key:"averageSymbolComplexity",get:function(){const ma=ea.averageSymbolComplexities(this.symbolComplexities),ta=this._get("averageSymbolComplexity");return 0===ma.numComplexities||l.isSome(ta)&&(ma.estimated&&(ta.primitivesPerFeature>=ma.primitivesPerFeature||ta.primitivesPerCoordinate>=ma.primitivesPerCoordinate||ta.drawCallsPerFeature>=ma.drawCallsPerFeature)||ta.primitivesPerFeature===ma.primitivesPerFeature&&ta.primitivesPerCoordinate===ma.primitivesPerCoordinate&&ta.drawCallsPerFeature===ma.drawCallsPerFeature)?
ta:ma}},{key:"spatialReference",get:function(){return this._spatialReference}},{key:"usedMemory",get:function(){const ma=l.isSome(this.averageSymbolComplexity)&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0;return this._usedMemory+ma}},{key:"usedMemoryPerGraphic",get:function(){return this._usedMemory&&this.numberOfGraphics?this._usedMemory/this.numberOfGraphics:l.isSome(this.averageSymbolComplexity)?this.averageSymbolComplexity.memory.bytesPerFeature+
(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}},{key:"unprocessedMemoryEstimate",get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)}},{key:"symbolComplexities",get:function(){return this.currentRenderer?this.getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this.getSymbolComplexitiesUsed()}},{key:"graphics3DGraphicsByObjectID",get:function(){const ma=this.owner.layer&&this.owner.layer.objectIdField;if(!ma)return null;
const ta=new Map;this.graphics3DGraphics.forEach(Da=>{if(Da){var Oa=this._getGraphicObjectID(Da.graphic,ma);l.isSome(Oa)&&ta.set(Oa,Da)}});return ta}},{key:"labelsEnabled",get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())}},{key:"symbolUpdateType",get:function(){if(0<this.pendingUpdates.size)return"unknown";let ma=0,ta=0;return ca.someMap(this.symbols,(Da,Oa)=>{if(l.isSome(Da)){Da=Da.getFastUpdateStatus();if(0<Da.loading)return!0;this.graphicsBySymbol.has(Oa)&&(ta+=Da.fast,
ma+=Da.slow)}return!1})?"unknown":0<=ta&&0===ma?"fast":0<=ma&&0===ta?"slow":"mixed"}},{key:"test",get:function(){return{symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size,forceUpdatePolicy:ma=>{this.forcedUpdatePolicy=ma;this.updateUpdatePolicy()}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this.graphicsWithoutSymbol.size,pending:this.pendingUpdates.size}}}]);return xa}(y);b.Graphics3DCore.tmpVec=H.create();
a.__decorate([c.property({readOnly:!0})],b.Graphics3DCore.prototype,"computedExtent",void 0);a.__decorate([c.property()],b.Graphics3DCore.prototype,"currentRenderer",void 0);a.__decorate([c.property()],b.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);a.__decorate([c.property()],b.Graphics3DCore.prototype,"_frameTask",void 0);a.__decorate([c.property()],b.Graphics3DCore.prototype,"rendererChangeAbortController",void 0);a.__decorate([c.property()],b.Graphics3DCore.prototype,"elevationInfoChangeAbortController",
void 0);a.__decorate([c.property()],b.Graphics3DCore.prototype,"setupAbortController",void 0);a.__decorate([c.property({readOnly:!0})],b.Graphics3DCore.prototype,"elevationAlignment",void 0);a.__decorate([c.property({readOnly:!0})],b.Graphics3DCore.prototype,"scaleVisibility",void 0);a.__decorate([c.property({readOnly:!0})],b.Graphics3DCore.prototype,"filterVisibility",void 0);a.__decorate([c.property({readOnly:!0})],b.Graphics3DCore.prototype,"extentPadding",void 0);a.__decorate([c.property()],b.Graphics3DCore.prototype,
"_updatingPendingLoadedGraphicsChange",void 0);a.__decorate([c.property({readOnly:!0})],b.Graphics3DCore.prototype,"featureStore",void 0);a.__decorate([c.property({readOnly:!0})],b.Graphics3DCore.prototype,"deconflictor",void 0);a.__decorate([c.property({readOnly:!0})],b.Graphics3DCore.prototype,"labeler",void 0);a.__decorate([c.property({readOnly:!0})],b.Graphics3DCore.prototype,"objectStates",void 0);a.__decorate([c.property()],b.Graphics3DCore.prototype,"preferredUpdatePolicy",void 0);a.__decorate([c.property({constructOnly:!0})],
b.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DCore.prototype,"owner",void 0);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DCore.prototype,"layer",void 0);a.__decorate([c.property({readOnly:!0})],b.Graphics3DCore.prototype,"symbolsUpdating",void 0);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DCore.prototype,
"getRenderingInfoWithoutRenderer",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:"elevationAlignment.updating scaleVisibility.updating filterVisibility.updating rendererChangeAbortController elevationInfoChangeAbortController _updatingPendingLoadedGraphicsChange _frameTask.updating".split(" ")})],b.Graphics3DCore.prototype,"updating",null);a.__decorate([c.property({readOnly:!0,dependsOn:["owner.suspended","owner.suspendInfo"]})],b.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);
a.__decorate([c.property({readOnly:!0,dependsOn:[],autoTracked:!1})],b.Graphics3DCore.prototype,"updatingRemaining",null);a.__decorate([c.property({readOnly:!0,dependsOn:[],autoTracked:!1})],b.Graphics3DCore.prototype,"updatingTotal",null);a.__decorate([c.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"],autoTracked:!1})],b.Graphics3DCore.prototype,"displayFeatureLimit",
null);a.__decorate([c.property({readOnly:!0,dependsOn:[],autoTracked:!1})],b.Graphics3DCore.prototype,"averageSymbolComplexity",null);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DCore.prototype,"hasZ",void 0);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DCore.prototype,"hasM",void 0);b.Graphics3DCore=Pa=a.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],b.Graphics3DCore);const Ua=new Map,ha=new m,Ya=new q(m);let Wa=function(){function ya(){this.renderingInfo=
this.add=null;this.state=0;this.remove=null}ya.prototype.clear=function(){this.renderingInfo=this.add=null;this.state=0;this.remove=this.abortController=null};return ya}();const db=H.create(),mb=H.create(),Ea=new Map;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/has","../../core/maybe","../../core/Error","../../chunks/symbols"],function(b,k,a,r,l){function h(f){return a.isNone(f)||"simple"===f.type||"unique-value"===
f.type||"class-breaks"===f.type||"dictionary"===f.type}function d(f,g){if(!g)return null;g=Array.isArray(g)?g:[g];if(0<g.length){const p=g.map(w=>w.details.symbol.type||w.details.symbol.declaredClass).filter(w=>!!w);p.sort();const n=[];p.forEach((w,q)=>{0!==q&&w===p[q-1]||n.push(w)});return new r("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${n.join(", ")}) which are not supported in 3D`,{renderer:f,symbolErrors:g})}return null}function c(f){const g=f.uniqueValueInfos.map(n=>
l.to3D(n.symbol).error).filter(n=>!!n),p=l.to3D(f.defaultSymbol);p.error&&g.unshift(p.error);return d(f,g)}function e(f){const g=f.classBreakInfos.map(n=>l.to3D(n.symbol).error).filter(n=>!!n),p=l.to3D(f.defaultSymbol);p.error&&g.unshift(p.error);return d(f,g)}b.isSupportedRenderer3D=h;b.validateTo3D=function(f){if(a.isNone(f))return null;if(!h(f))return new r("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${f.type||f.declaredClass}'`,{renderer:f});switch(f.type){case "simple":return d(f,
l.to3D(f.symbol).error);case "unique-value":return c(f);case "class-breaks":return e(f)}return null};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/has ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ./defaultsJSON ./defaults".split(" "),function(b,k,a,r,l,h,d,c,e,f){const g=d.fromSimpleMarkerSymbol(f.defaultPointSymbol2D),p=l.fromSimpleLineSymbol(f.defaultPolylineSymbol2D),
n=c.fromSimpleFillSymbol(f.defaultPolygonSymbol2D),w=new h({symbolLayers:[new r({material:{color:e.defaultColor},edges:{type:"solid",size:"1px",color:e.defaultOutlineColor}})]});b.getDefaultSymbol3D=function(q){if(a.isNone(q))return null;switch(q.type){case "mesh":return w;case "point":case "multipoint":return g;case "polyline":return p;case "polygon":case "extent":return n}return null};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../geometry/projection ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){b.Graphics3DFeatureStore=function(C){function z(t){var D=C.call(this,t)||this;D.events=new q;D.hasZ=null;D.hasM=null;D.objectIdField=null;D.spatialReference=null;D.featureAdapter={getAttribute(E,G){return"graphic"in E?E.graphic.attributes[G]:B.optimizedFeatureQueryEngineAdapter.getAttribute(E,G)},getAttributes(E){return"graphic"in E?E.graphic.attributes:B.optimizedFeatureQueryEngineAdapter.getAttributes(E)},getObjectId:E=>"graphic"in E?y.getObjectId(E.graphic,
D.objectIdField):B.optimizedFeatureQueryEngineAdapter.getObjectId(E),getGeometry:E=>"graphic"in E?E.getAsOptimizedGeometry(D.hasZ,D.hasM):B.optimizedFeatureQueryEngineAdapter.getGeometry(E),getCentroid:(E,G)=>{if("graphic"in E){let H=null;l.isSome(E.centroid)?H=E.centroid:"point"===E.graphic.geometry.type&&m.projectPoint(E.graphic.geometry,x,D.spatialReference)&&(H=x);E=Array(2+(G.hasZ?1:0)+(G.hasM?1:0));l.isNone(H)?(E[0]=0,E[1]=0,E[2]=0,E[3]=0):(E[0]=H.x,E[1]=H.y,G.hasZ&&(E[2]=H.hasZ?H.z:0),G.hasM&&
(E[G.hasZ?3:2]=H.hasM?H.m:0));return new v([],E)}return B.optimizedFeatureQueryEngineAdapter.getCentroid(E,G)},cloneWithGeometry:(E,G)=>"graphic"in E?new u(G,D.featureAdapter.getAttributes(E),null,D.featureAdapter.getObjectId(E)):B.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(E,G)};return D}k._inheritsLoose(z,C);var A=z.prototype;A.forEach=function(t){this.forAllGraphics(D=>{t(D)})};A.forEachInBounds=function(t,D){this.getSpatialIndex().forEachInBounds(t,D)};A.forEachBounds=function(t,D,E){const G=
this.getSpatialIndex();for(const H of t)t=this.featureAdapter.getObjectId(H),l.isSome(G.getBounds(t,E))&&D(E)};return z}(w);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DFeatureStore.prototype,"forAllGraphics",void 0);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DFeatureStore.prototype,"hasZ",void 0);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DFeatureStore.prototype,
"hasM",void 0);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DFeatureStore.prototype,"objectIdField",void 0);a.__decorate([c.property({constructOnly:!0})],b.Graphics3DFeatureStore.prototype,"spatialReference",void 0);b.Graphics3DFeatureStore=a.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],b.Graphics3DFeatureStore);const x={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};b.default=b.Graphics3DFeatureStore;Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../OptimizedFeature","../OptimizedGeometry","../centroid"],function(b,k,a,r){const l={getObjectId(h){return h.objectId},getAttributes(h){return h.attributes},getAttribute(h,d){return h.attributes[d]},cloneWithGeometry(h,d){return new k(d,h.attributes,null,h.objectId)},getGeometry(h){return h.geometry},getCentroid(h,d){h.centroid||(h.centroid=r.getCentroidOptimizedGeometry(new a,h.geometry,d.hasZ,
d.hasM));return h.centroid}};b.default=l;b.optimizedFeatureQueryEngineAdapter=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],function(b){b.Graphics3DSymbolCreationContext=function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=
null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1};b.Graphics3DSymbolLayerCreationContext=function(){};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DSymbol","./Graphics3DPointSymbol"],function(b,k,a){b.make=function(r,l,h){let d;switch(r.type){case "point-3d":d=a;break;default:d=k}return new d(r,l,h)};Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils","../../../../core/asyncUtils","./Graphics3DCalloutSymbolLayerFactory","./Graphics3DSymbol"],function(b,k,a,r,l){return function(h){function d(e,f,g){e=h.call(this,e,f,g)||this;e.calloutSymbolLayer=null;e.symbol.hasVisibleCallout()&&(e.calloutSymbolLayer=r.make(e.symbol,f));return e}b._inheritsLoose(d,h);var c=d.prototype;c.doLoad=async function(e){const f=
this.calloutSymbolLayer?a.result(this.calloutSymbolLayer.load()):null;try{await h.prototype.doLoad.call(this,e)}catch(n){var g;null==(g=this.calloutSymbolLayer)?void 0:g.abortLoad();throw n;}if(k.isAborted(e)){var p;null==(p=this.calloutSymbolLayer)?void 0:p.abortLoad();throw k.createAbortError();}f&&await f};c.destroy=function(){h.prototype.destroy.call(this);this.calloutSymbolLayer&&this.calloutSymbolLayer.destroy()};c.createGraphics3DGraphic=function(e,f){f=h.prototype.createGraphics3DGraphic.call(this,
e,f);this.calloutSymbolLayer&&(e=this.createCalloutGraphic(e))&&f.addAuxiliaryGraphic(e);return f};c.globalPropertyChanged=function(e,f){return h.prototype.globalPropertyChanged.call(this,e,f)?this.calloutSymbolLayer?this.calloutSymbolLayer.globalPropertyChanged(e,f,g=>this._getCalloutGraphicLayer(g)):!0:!1};c.updateGeometry=function(e,f){const g=h.prototype.updateGeometry.call(this,e,f);return g&&this.calloutSymbolLayer&&(e=this._getCalloutGraphicLayer(e))?this.calloutSymbolLayer.updateGeometry(e,
f):g};c.createCalloutGraphic=function(e){const f=e.renderingInfo;e.renderingInfo={renderer:f.renderer,symbol:f.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(e)};c._getCalloutGraphicLayer=function(e){for(const f of e._auxiliaryGraphics)if(f.graphics3DSymbolLayer===this.calloutSymbolLayer)return f};return d}(l)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports",
"../../../../core/maybe","../../../../core/arrayUtils","../../../../layers/graphics/dehydratedFeatures"],function(b,k,a,r){let l=function(){function h(c){this.graphicsCore=c;this.idToState=new Map;this.states=new Set;const e=c.owner.layer&&c.owner.layer.objectIdField;e?(this.getGraphicId=f=>r.getObjectId(f,e),this.getGraphics3DGraphicById=f=>this.graphicsCore.getGraphics3DGraphicByObjectId(f)):(this.getGraphicId=f=>f.uid,this.getGraphics3DGraphicById=f=>this.graphicsCore.getGraphics3DGraphicById(f))}
var d=h.prototype;d.destroy=function(){this.idToState.clear();this.states.forEach((c,e)=>this.remove(e))};d.add=function(c){const e={remove:()=>this.remove(c)};if(this.states.has(c))return e;const f=this.getGraphicId(c.graphic),g=this.getGraphics3DGraphicById(f);this.states.has(c)||this.states.add(c);this.ensureStateList(f).push(c);c.displaying=k.isSome(g)?g.isVisible():!1;c.isDraped=k.isSome(g)?g.isDraped:!1;c.tracking=!0;return e};d.remove=function(c){if(this.states.has(c)){if(this.idToState.size){const e=
this.getGraphicId(c.graphic),f=this.idToState.get(e);f&&(a.remove(f,c),0===f.length&&this.idToState.delete(e))}this.states.delete(c);c.tracking=!1;c.displaying=!1}};d.addGraphic=function(c){this.forEachState(c,e=>{e.displaying=c.isVisible();e.isDraped=c.isDraped;e.emit("changed",{})})};d.removeGraphic=function(c){this.forEachState(c,e=>{e.displaying=!1;e.isDraped=!1})};d.updateGraphicGeometry=function(c){this.forEachState(c,e=>{e.emit("changed",{})})};d.updateGraphicVisibility=function(c){this.forEachState(c,
e=>{e.displaying=c.isVisible()})};d.allGraphicsDeleted=function(){this.states.forEach(c=>{c.displaying=!1})};d.ensureStateList=function(c){var e=this.idToState.get(c);if(e)return e;e=[];this.idToState.set(c,e);return e};d.forEachState=function(c,e){0!==this.states.size&&0!==this.idToState.size&&(c=this.getGraphicId(c.graphic),c=this.idToState.get(c),null!=c&&c.forEach(e))};return h}();b.GraphicStateTracking=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../core/libs/rbush/PooledRBush".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){b.SpatialIndex2D=function(v){function y(x){x=v.call(this,x)||this;x.index=new m.PooledRBush(9,r("csp-restrictions")?C=>({minX:C.extent[0],minY:C.extent[1],maxX:C.extent[2],maxY:C.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);x.boundsByFeature=new Map;x.spatialReference=null;x.hasZ=null;x.hasM=null;x.objectIdField=null;return x}k._inheritsLoose(y,v);var B=y.prototype;B.destroy=function(){this.index.destroy();this.index=null;this.boundsByFeature.clear();
this.boundsByFeature=null};B.queryGraphicUIDsInExtent=function(x,C,z){C.equals(this.spatialReference)&&(u.minX=x[0],u.minY=x[1],u.maxX=x[2],u.maxY=x[3],this.index.search(u,A=>z(A.graphic.uid)))};B.add=function(x){x.computeExtent(this.spatialReference);this.index.insert(x);const C=q.getObjectId(x.graphic,this._get("objectIdField"));null!=C&&this.boundsByFeature.set(C,x.extent)};B.addMany=function(x,C=x.length){const z=this._get("objectIdField");for(let A=0;A<C;A++){const t=x[A];t.computeExtent(this.spatialReference);
const D=q.getObjectId(t.graphic,z);null!=D&&this.boundsByFeature.set(D,t.extent)}this.index.load(x,C)};B.remove=function(x){this.index.remove(x);x=q.getObjectId(x.graphic,this._get("objectIdField"));null!=x&&this.boundsByFeature.delete(x)};B.clear=function(){this.index.clear();this.boundsByFeature.clear()};B.forEachInBounds=function(x,C){u.minX=x[0];u.minY=x[1];u.maxX=x[2];u.maxY=x[3];this.index.search(u,z=>{C(z)})};B.getBounds=function(x,C){return(x=this.boundsByFeature.get(x))?w.fromRect(C,x):null};
return y}(n);a.__decorate([d.property({constructOnly:!0})],b.SpatialIndex2D.prototype,"spatialReference",void 0);a.__decorate([d.property({constructOnly:!0})],b.SpatialIndex2D.prototype,"hasZ",void 0);a.__decorate([d.property({constructOnly:!0})],b.SpatialIndex2D.prototype,"hasM",void 0);a.__decorate([d.property({constructOnly:!0})],b.SpatialIndex2D.prototype,"objectIdField",void 0);b.SpatialIndex2D=a.__decorate([e.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],b.SpatialIndex2D);const u=
{minX:0,minY:0,maxX:0,maxY:0};b.default=b.SpatialIndex2D;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/core/libs/rbush/PooledRBush":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../maybe ../../arrayUtils ../../PooledArray ../../../chunks/quickselect".split(" "),function(b,k,a,r,l,h){function d(t,D){c(t,0,t.children.length,D,t)}function c(t,D,E,G,H){H||(H=new z([]));H.minX=Infinity;H.minY=Infinity;H.maxX=-Infinity;H.maxY=-Infinity;for(let I=D,J;I<E;I++)J=t.children[I],
e(H,t.leaf?G(J):J);return H}function e(t,D){t.minX=Math.min(t.minX,D.minX);t.minY=Math.min(t.minY,D.minY);t.maxX=Math.max(t.maxX,D.maxX);t.maxY=Math.max(t.maxY,D.maxY)}function f(t,D){return t.minX-D.minX}function g(t,D){return t.minY-D.minY}function p(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function n(t){return t.maxX-t.minX+(t.maxY-t.minY)}function w(t,D){return t.minX<=D.minX&&t.minY<=D.minY&&D.maxX<=t.maxX&&D.maxY<=t.maxY}function q(t,D){return D.minX<=t.maxX&&D.minY<=t.maxY&&D.maxX>=t.minX&&
D.maxY>=t.minY}function m(t,D,E,G,H){for(D=[D,E];D.length;){E=a.assumeNonNull(D.pop());const I=a.assumeNonNull(D.pop());if(E-I<=G)continue;const J=I+Math.ceil((E-I)/G/2)*G;h.quickselect(t,J,I,E,H);D.push(I,J,J,E)}}let u=function(){function t(E=9,G){this.compareMinX=f;this.compareMinY=g;this.toBBox=function(H){return H};this._maxEntries=Math.max(4,E||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));G&&("function"===typeof G?this.toBBox=G:this._initFormat(G));this.clear()}var D=t.prototype;
D.destroy=function(){this.clear();v.prune();y.prune();B.prune();x.prune()};D.all=function(E){this._all(this.data,E)};D.search=function(E,G){let H=this.data;const I=this.toBBox;if(q(E,H))for(v.clear();H;){for(let J=0,K=H.children.length;J<K;J++){const L=H.children[J],S=H.leaf?I(L):L;q(E,S)&&(H.leaf?G(L):w(E,S)?this._all(L,G):v.push(L))}H=v.pop()}};D.collides=function(E){let G=this.data;const H=this.toBBox;if(!q(E,G))return!1;for(v.clear();G;){for(let I=0,J=G.children.length;I<J;I++){const K=G.children[I],
L=G.leaf?H(K):K;if(q(E,L)){if(G.leaf||w(E,L))return!0;v.push(K)}}G=v.pop()}return!1};D.load=function(E,G=E.length){if(!G)return this;if(G<this._minEntries){for(let H=0,I=G;H<I;H++)this.insert(E[H]);return this}E=this._build(E.slice(0,G),0,G-1,0);this.data.children.length?this.data.height===E.height?this._splitRoot(this.data,E):(this.data.height<E.height&&(G=this.data,this.data=E,E=G),this._insert(E,this.data.height-E.height-1,!0)):this.data=E;return this};D.insert=function(E){E&&this._insert(E,this.data.height-
1);return this};D.clear=function(){this.data=new z([]);return this};D.remove=function(E){if(!E)return this;let G=this.data,H=null,I=0,J=!1,K;const L=this.toBBox(E);B.clear();for(x.clear();G||0<B.length;){if(!G){var S;G=a.assumeNonNull(B.pop());H=B.data[B.length-1];I=null!=(S=x.pop())?S:0;J=!0}if(G.leaf&&(K=r.indexOf(G.children,E,G.children.length,G.indexHint),-1!==K)){G.children.splice(K,1);B.push(G);this._condense(B);break}J||G.leaf||!w(G,L)?H?(I++,G=H.children[I],J=!1):G=null:(B.push(G),x.push(I),
I=0,H=G,G=G.children[0])}return this};D.toJSON=function(){return this.data};D.fromJSON=function(E){this.data=E;return this};D._all=function(E,G){for(y.clear();E;){var H;if(!0===E.leaf)for(const I of E.children)G(I);else y.pushArray(E.children);E=null!=(H=y.pop())?H:null}};D._build=function(E,G,H,I){var J=H-G+1,K=this._maxEntries;if(J<=K)return E=new z(E.slice(G,H+1)),d(E,this.toBBox),E;I||(I=Math.ceil(Math.log(J)/Math.log(K)),K=Math.ceil(J/Math.pow(K,I-1)));const L=new A([]);L.height=I;J=Math.ceil(J/
K);K=J*Math.ceil(Math.sqrt(K));for(m(E,G,H,K,this.compareMinX);G<=H;G+=K){const S=Math.min(G+K-1,H);m(E,G,S,J,this.compareMinY);for(let M=G;M<=S;M+=J)L.children.push(this._build(E,M,Math.min(M+J-1,S),I-1))}d(L,this.toBBox);return L};D._chooseSubtree=function(E,G,H,I){for(;;){I.push(G);if(!0===G.leaf||I.length-1===H)break;let J=Infinity,K=Infinity,L=void 0;for(let S=0,M=G.children.length;S<M;S++){const T=G.children[S],O=p(T),Q=(Math.max(T.maxX,E.maxX)-Math.min(T.minX,E.minX))*(Math.max(T.maxY,E.maxY)-
Math.min(T.minY,E.minY))-O;Q<K?(K=Q,J=O<J?O:J,L=T):Q===K&&O<J&&(J=O,L=T)}G=L||G.children[0]}return G};D._insert=function(E,G,H){var I=this.toBBox;H=H?E:I(E);B.clear();I=this._chooseSubtree(H,this.data,G,B);I.children.push(E);for(e(I,H);0<=G;)if(B.data[G].children.length>this._maxEntries)this._split(B,G),G--;else break;this._adjustParentBBoxes(H,B,G)};D._split=function(E,G){const H=E.data[G];var I=H.children.length;const J=this._minEntries;this._chooseSplitAxis(H,J,I);(I=this._chooseSplitIndex(H,J,
I))?(I=H.children.splice(I,H.children.length-I),I=H.leaf?new z(I):new A(I),I.height=H.height,d(H,this.toBBox),d(I,this.toBBox),G?E.data[G-1].children.push(I):this._splitRoot(H,I)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};D._splitRoot=function(E,G){this.data=new A([E,G]);this.data.height=E.height+1;d(this.data,this.toBBox)};D._chooseSplitIndex=function(E,G,H){let I,J,K=void 0;I=J=Infinity;for(let S=G;S<=H-G;S++){var L=c(E,0,S,this.toBBox);const M=c(E,S,
H,this.toBBox),T=Math.max(0,Math.min(L.maxX,M.maxX)-Math.max(L.minX,M.minX))*Math.max(0,Math.min(L.maxY,M.maxY)-Math.max(L.minY,M.minY));L=p(L)+p(M);T<I?(I=T,K=S,J=L<J?L:J):T===I&&L<J&&(J=L,K=S)}return K};D._chooseSplitAxis=function(E,G,H){const I=E.leaf?this.compareMinX:f,J=E.leaf?this.compareMinY:g,K=this._allDistMargin(E,G,H,I);G=this._allDistMargin(E,G,H,J);K<G&&E.children.sort(I)};D._allDistMargin=function(E,G,H,I){E.children.sort(I);I=this.toBBox;var J=c(E,0,G,I);const K=c(E,H-G,H,I);let L=
n(J)+n(K);for(let S=G;S<H-G;S++){const M=E.children[S];e(J,E.leaf?I(M):M);L+=n(J)}for(H=H-G-1;H>=G;H--)J=E.children[H],e(K,E.leaf?I(J):J),L+=n(K);return L};D._adjustParentBBoxes=function(E,G,H){for(;0<=H;H--)e(G.data[H],E)};D._condense=function(E){for(let G=E.length-1;0<=G;G--){const H=E.data[G];if(0===H.children.length)if(0<G){const I=E.data[G-1],J=I.children;J.splice(r.indexOf(J,H,J.length,I.indexHint),1)}else this.clear();else d(H,this.toBBox)}};D._initFormat=function(E){const G=["return a"," - b",
";"];this.compareMinX=new Function("a","b",G.join(E[0]));this.compareMinY=new Function("a","b",G.join(E[1]));this.toBBox=new Function("a","return {minX: a"+E[0]+", minY: a"+E[1]+", maxX: a"+E[2]+", maxY: a"+E[3]+"};")};return t}();const v=new l,y=new l,B=new l,x=new l({deallocator:void 0});l=function(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity};let C=function(t){function D(){var E=t.apply(this,arguments)||this;E.height=1;E.indexHint=new r.PositionHint;return E}k._inheritsLoose(D,
t);return D}(l),z=function(t){function D(E){var G=t.call(this)||this;G.children=E;G.leaf=!0;return G}k._inheritsLoose(D,t);return D}(C),A=function(t){function D(E){var G=t.call(this)||this;G.children=E;G.leaf=!1;return G}k._inheritsLoose(D,t);return D}(C);b.BBox=l;b.PooledRBush=u;b.default=u;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/chunks/quickselect":function(){define(["exports","./_commonjsHelpers"],function(b,k){k=k.createCommonjsModule(function(a){(function(r){r=r();void 0!==
r&&(a.exports=r)})(function(){function r(d,c,e,f,g){for(;f>e;){if(600<f-e){var p=f-e+1,n=c-e+1,w=Math.log(p),q=.5*Math.exp(2*w/3);w=.5*Math.sqrt(w*q*(p-q)/p)*(0>n-p/2?-1:1);r(d,c,Math.max(e,Math.floor(c-n*q/p+w)),Math.min(f,Math.floor(c+(p-n)*q/p+w)),g)}p=d[c];n=e;q=f;l(d,e,c);for(0<g(d[f],p)&&l(d,e,f);n<q;){l(d,n,q);n++;for(q--;0>g(d[n],p);)n++;for(;0<g(d[q],p);)q--}0===g(d[e],p)?l(d,e,q):(q++,l(d,q,f));q<=c&&(e=q+1);c<=q&&(f=q-1)}}function l(d,c,e){var f=d[c];d[c]=d[e];d[e]=f}function h(d,c){return d<
c?-1:d>c?1:0}return function(d,c,e,f,g){r(d,c,e||0,f||d.length-1,g||h)}})});b.quickselect=k})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../core/unitUtils ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/Intersector".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C){const z=h.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider");b.StageLayerElevationProvider=function(I){function J(L){L=I.call(this,L)||this;L.elevationOffset=0;L.layerDirtyNotificationHandle=null;return L}k._inheritsLoose(J,I);var K=J.prototype;K.initialize=function(){this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=new C.Intersector(this.view.state.mode);this.intersector.options.store=
0;const L=this.computeLayerExtent(this.stageLayer);this.zmin=L[2];this.zmax=L[5];this.layerDirtyNotificationHandle=this.stageLayer.on("dirty",S=>this.stageLayerChanged(S.origin,S.dirtyType,S.subObject))};K.dispose=function(){this.layerDirtyNotificationHandle.remove()};K.elevationInfoChanged=function(){const L=null!=this.layer?this.layer.elevationInfo:null;if(null!=L&&"on-the-ground"!==L.mode){const S=v.getMetersPerVerticalUnitForSR(this.layer.spatialReference),M=B.getMetersPerUnit(L.unit);this.elevationOffset=
l.unwrapOr(L.offset,0)*M/S}else this.elevationOffset=0};K.getElevation=function(L,S,M,T){E[0]=L;E[1]=S;E[2]=M;if(!this.renderCoordsHelper.toRenderCoords(E,T,E))return z.error("could not project point for elevation alignment"),null;S=this.elevationOffset;L=this.zmin+S;S=this.zmax+S;u.copy(G,E);u.copy(H,E);this.renderCoordsHelper.setAltitude(S,G);this.renderCoordsHelper.setAltitude(L,H);this.intersector.reset(G,H);this.intersector.intersect(this.intersectLayers,null,null,1,null,O=>O.metadata&&O.metadata.isElevationSource);
return this.intersector.results.min.getIntersectionPoint(E)?this.renderCoordsHelper.getAltitude(E):null};K.stageLayerChanged=function(L,S,M){switch(S){case "layerObjectAdded":case "layerObjectRemoved":case "objGeometryAdded":M.metadata&&M.metadata.isElevationSource&&this.objectChanged(M);break;case "objGeometryRemoved":case "vertexAttrsUpdated":case "objTransformation":L.metadata&&L.metadata.isElevationSource&&this.objectChanged(L)}};K.objectChanged=function(L){if(this.spatialReference){x.empty(A);
L.metadata.lastValidElevationBB.isEmpty()||this.expandExtent(L.metadata.lastValidElevationBB.bbMin,L.metadata.lastValidElevationBB.bbMax,A);const S=L.getBBMin(!1),M=L.getBBMax(!1);this.expandExtent(S,M,A);x.toRect(A,t);this.zmin=Math.min(this.zmin,A[2]);this.zmax=Math.max(this.zmax,A[5]);D.extent=t;D.spatialReference=this.spatialReference;this.emit("elevation-change",D);u.copy(L.metadata.lastValidElevationBB.bbMin,S);u.copy(L.metadata.lastValidElevationBB.bbMax,M)}};K.computeLayerExtent=function(L){x.empty(A);
for(const S of L.getObjects())this.expandExtent(S.getBBMin(!1),S.getBBMax(!1),A);return A};K.expandExtent=function(L,S,M){for(let T=0;8>T;++T)E[0]=T&1?L[0]:S[0],E[1]=T&2?L[1]:S[1],E[2]=T&4?L[2]:S[2],this.renderCoordsHelper.fromRenderCoords(E,E,this.spatialReference),x.expandWithVec3(M,E);return M};return J}(q.EventedMixin(w));a.__decorate([c.property({constructOnly:!0})],b.StageLayerElevationProvider.prototype,"layer",void 0);a.__decorate([c.property({constructOnly:!0})],b.StageLayerElevationProvider.prototype,
"stageLayer",void 0);a.__decorate([c.property({constructOnly:!0})],b.StageLayerElevationProvider.prototype,"view",void 0);a.__decorate([c.property({readOnly:!0,aliasOf:"view.spatialReference"})],b.StageLayerElevationProvider.prototype,"spatialReference",void 0);b.StageLayerElevationProvider=a.__decorate([f.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],b.StageLayerElevationProvider);const A=x.empty(),t=y.empty(),D={spatialReference:null,extent:t,context:"scene"},E=m.create(),
G=m.create(),H=m.create();Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Handles ../../../support/Scheduler ../../../support/layerViewUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){a=function(u){function v(){var B=u.apply(this,arguments)||this;B._scaleRangeActive=!1;B.layerScaleRangeVisibilityQuery=!1;B.handles=new w;B.layerView=null;B.layer=null;B.queryGraphicUIDsInExtent=null;B.extent=null;B.graphicsCore=null;B.basemapTerrain=null;B.layerScaleEnabled=!0;B.suspended=!1;B.updating=!0;return B}b._inheritsLoose(v,u);var y=v.prototype;y.setup=function(B,x,C,z,A){this.layerView=B;this.layer=x;this.queryGraphicUIDsInExtent=C;this.graphicsCore=
z;this.basemapTerrain=A;this.updateScaleRangeActive();this.handles.add(this.layerView.view.resourceController.scheduler.registerTask(q.Task.SCALE_VISIBILITY,()=>this.update(),()=>this.needsUpdate()))};y.destroy=function(){this.handles.destroy();this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=this.handles=null};y.needsUpdate=function(){return!(!this.layerView.view.basemapTerrain||!this.updating)};y._setDirty=function(){this.updating||this._set("updating",!0)};y.setExtent=
function(B){this.extent=B;this._setDirty()};y.scaleRangeActive=function(){return this._scaleRangeActive};y.updateScaleRangeActive=function(){var B=this.layer;let x=this.layerScaleEnabled&&(0<B.minScale||0<B.maxScale);B.labelingInfo&&!x&&(x=B.labelingInfo.some(C=>C&&(0<C.minScale||0<C.maxScale)));B=this._scaleRangeActive!==x;(this._scaleRangeActive=x)&&!this.handles.has("terrain-events")&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",C=>this.scaleUpdateHandler(C)),"terrain-events"),
this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!x&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return B};y.update=function(){const B=this.layerView.view.basemapTerrain;this.extent&&B&&B.ready&&this._scaleRangeActive&&this.layerScaleEnabled?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=!0,B.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,
x=>this.finishUpdate(x))):this.finishUpdate(!0)};y.finishUpdate=function(B){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!B);this._set("updating",!1)};y.visibleAtLayerScale=function(B){return!this.layerScaleEnabled||m.scaleBoundsPredicate(B,this.layer.minScale||0,this.layer.maxScale||0)};y.visibleAtLabelScale=function(B,x){return m.scaleBoundsPredicate(B,x.minScale||0,x.maxScale||0)};y.graphicScale=function(B){let x;r.isSome(B.centroid)?x=B.centroid:r.isSome(B.graphic.geometry)&&"point"===
B.graphic.geometry.type&&(x=B.graphic.geometry);return x?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(x):1:null};y.graphicVisible=function(B){if(!this.layerScaleEnabled)return!0;B=this.graphicScale(B);return this.visibleAtLayerScale(B)};y.updateVisibility=function(B){if(this._scaleRangeActive){const x=this.graphicVisible(B);return B.setVisibilityFlag(1,x,0)}return!1};y.updateGraphicLabelScaleVisibility=function(B){if(!this._scaleRangeActive||!B.labelGraphics||0===
B.labelGraphics.length)return!1;const x=this.graphicScale(B);if(B=this.updateLabelScaleVisibility(B,x))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return B};y.updateLabelScaleVisibility=function(B,x){if(!B.labelGraphics||0===B.labelGraphics.length)return!1;const C=B.labelGraphics[0]._labelClass;return C&&null!=C.minScale&&null!=C.maxScale&&(x=this.visibleAtLabelScale(x,C),B.setVisibilityFlag(1,x,1))?!0:!1};y.scaleUpdateHandler=function(B){this._setDirty();if(!this.layerView.suspended){var x=
B.extent,C=B.scale,z=this.visibleAtLayerScale(C),A=!1;this.queryGraphicUIDsInExtent(x,B.spatialReference,t=>{if(t=this.graphicsCore.getGraphics3DGraphicById(t)){var D=t.centroid;r.isSome(D)&&(x[0]>D.x||x[1]>D.y||x[2]<D.x||x[3]<D.y)||(t.setVisibilityFlag(1,z,0)&&(A=!0),this.updateLabelScaleVisibility(t,C)&&(A=!0))}});A&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}};y.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?
this.graphicsCore.modifyGraphics3DGraphicVisibilities(B=>B.clearVisibilityFlag(1)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};return v}(n);k.__decorate([d.property({constructOnly:!0})],a.prototype,"layerScaleEnabled",void 0);k.__decorate([d.property({readOnly:!0})],a.prototype,"suspended",void 0);k.__decorate([d.property({readOnly:!0})],a.prototype,"updating",void 0);return a=k.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],
a)})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],function(b){b.attributeLookup=function(k,a,r){if(!r||null==a)return null;if(!k){a:{k=r.toLowerCase();for(var l in a)if(l.toLowerCase()===k){a=a[l];break a}a=null}return a}return(l=k.get(r))?a[l.name]:null};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../support/Scheduler ../../../../core/SetUtils ./ExtentSet".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){a=function(v){function y(){var x=v.apply(this,arguments)||this;x.dirtyExtents=new u.ExtentSet;x.globalDirty=!1;x.dirtyGraphicsSet=new Set;x.handles=new w;x.updateElevation=!1;x.layerView=null;x.graphicsCore=null;x.events=new n;return x}b._inheritsLoose(y,v);var B=y.prototype;B.setup=function(x,C,z,A){this.layerView=x;this.queryGraphicUIDsInExtent=C;this.graphicsCore=z;this.elevationProvider=A;x=this.layerView.view.resourceController.scheduler;this.handles.add([A.on("elevation-change",
t=>this._elevationChanged(t)),this.layerView.watch("suspended",()=>this.suspendedChange()),x.registerTask(q.Task.ELEVATION_ALIGNMENT,t=>this.update(t),()=>this.needsUpdate())])};B.destroy=function(){this.dirtyGraphicsSet=null;this.handles.destroy();this.queryGraphicUIDsInExtent=this.graphicsCore=this.layerView=this.handles=null};B.clear=function(){this.dirtyGraphicsSet.clear();this.notifyChange("updating")};B.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&
this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))};B.elevationInfoChange=function(){this.globalDirty=!0;this.notifyChange("updating")};B.needsUpdate=function(){return this.dirtyGraphicsSet&&0<this.dirtyGraphicsSet.size||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty};B.update=function(x){this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1,x.madeProgress());for(x.run(()=>this.dirtyExtents.merge(x));this.needsUpdate()&&!x.done;)this._updateDirtyGraphics(x),
this._updateDirtyExtents(x);this.layerView.view.deconflictor.setDirty();this.notifyChange("updating")};B._updateDirtyGraphics=function(x){const C=this.layerView.view,z=this.graphicsCore.stageLayer.id,A=this.layerView.labeling;for(;0<this.dirtyGraphicsSet.size&&!x.done;){let t=Math.min(this.dirtyGraphicsSet.size,100);m.someSet(this.dirtyGraphicsSet,D=>{const E=this.graphicsCore.getGraphics3DGraphicById(D);this.dirtyGraphicsSet.delete(D);E&&E.alignWithElevation(this.elevationProvider,C.renderCoordsHelper,
this.graphicsCore.asyncUpdates);x.madeProgress();return 0>=--t||x.done});C._stage.processDirtyLayer(z);A&&A.processStageDirty()}};B._updateDirtyExtents=function(x){for(;!this.dirtyExtents.empty&&100>this.dirtyGraphicsSet.size&&!x.done;){const C=this.dirtyExtents.pop(),z=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:C,spatialReference:z});this.queryGraphicUIDsInExtent(C,z,A=>{const t=this.graphicsCore.getGraphics3DGraphicById(A);t&&t.needsElevationUpdates()&&
this.dirtyGraphicsSet.add(A)});x.madeProgress()}};B.markAllGraphicsElevationDirty=function(){this.dirtyExtents.clear();this.dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach((x,C)=>this.dirtyGraphicsSet.add(C))};B._elevationChanged=function(x){if("scene"!==x.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var {extent:C,spatialReference:z}=x;this.layerView.suspended?(this.updateElevation||(x=this.graphicsCore.computedExtent)&&
C[2]>x.xmin&&C[0]<x.xmax&&C[3]>x.ymin&&C[1]<x.ymax&&(this.updateElevation=!0),this.events.emit("invalidate-elevation",{extent:C,spatialReference:z})):(-Infinity===C[0]?this.globalDirty=!0:this.dirtyExtents.add(C),this.notifyChange("updating"))}};b._createClass(y,[{key:"updating",get:function(){return this.needsUpdate()}}]);return y}(p);k.__decorate([h.property({readOnly:!0})],a.prototype,"updating",null);return a=k.__decorate([c.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],
a)})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(b,k,a,r,l){let h=function(){function d(){this.extents=new a({allocator:e=>e||r.create()});this.tempExtent=r.create();this.dirty=!1}var c=d.prototype;c.clear=function(){this.extents.clear()};c.add=function(e){this.contains(e)||(this.removeContained(e),r.set(this.extents.pushNew(),
e),this.dirty=!0)};c.pop=function(){this.dirty&&this.mergeTight();return this.extents.pop()};c.merge=function(e){this.mergeTight(e);return e.hasProgressed};c.mergeTight=function(e=l.noBudget){const f=this.extents,g=new Set;let p=0;for(;p!==f.length;){f.sort((n,w)=>n[0]-w[0]);p=f.length;g.clear();for(let n=0;n<f.length;++n){if(e.done)return;const w=f.getItemAt(n);for(let q=n+1;q<f.length;++q){const m=f.getItemAt(q);if(m[0]>=w[2])break;g.add(m)}g.forEach(q=>{if(w!==q)if(q[2]<=w[0])g.delete(q);else{var m=
r.area(w),u=r.area(q),v=this.tempExtent;r.expand(w,q,v);m+=u;.05>(r.area(v)-m)/m&&(r.set(w,v),g.delete(q),f.remove(q),e.madeProgress())}});g.add(w)}}this.dirty=!1};c.contains=function(e){return this.extents.some(f=>r.contains(f,e))};c.removeContained=function(e){this.extents.filterInPlace(f=>!r.contains(e,f))};k._createClass(d,[{key:"empty",get:function(){return 0===this.extents.length}},{key:"test",get:function(){const e=this;return{containsPoint:f=>e.extents.some(g=>r.containsPoint(g,f))}}}]);return d}();
b.ExtentSet=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../support/Scheduler ../../../layers/support/FeatureFilter ./QueryEngine".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){const x=h.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");b.Graphics3DFilterVisibility=function(C){function z(...t){t=C.call(this,...t)||this;t.filter=null;t._dirty=!1;t._querying=!1;t._handles=new m;return t}k._inheritsLoose(z,C);var A=z.prototype;A.setup=function(t,D){this._layerView=t;this._core=D;this._objectIdField=t.layer.objectIdField;this._queryEngine=new B["default"]({layerView:this._layerView,task:v.Task.FILTER_VISIBILITY});
this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(v.Task.FILTER_VISIBILITY,E=>this._update(E),()=>this._needsUpdate()));this._handles.add(u.on(D.owner,"loadedGraphics","after-changes",E=>this._graphicsChanged(E),()=>this.dirty=!0));this.filterChanged()};A.destroy=function(){this._handles.destroy();this._handles=null;this.clear();this._core=this._layerView=null};A.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(t=>t.clearVisibilityFlag(2)),
this._queryResult=null,this._querying=!1);this.dirty=!1;this.notifyChange("updating")};A._graphicsChanged=function(t){this._queryEngine&&0===(t.type&1)||(this.dirty=!0)};A.updateVisibility=function(t){this.active&&(t.hasVisibilityFlag(2,0)||t.setVisibilityFlag(2,!1,0),this.dirty=!0)};A.filterChanged=function(){const t=this.recomputeFilter();t!==this.filter&&(this.filter=t,this.dirty=!0)};A.recomputeFilter=function(){var t="filter"in this._layerView?this._layerView.filter:null;const D="timeExtent"in
this._layerView?this._layerView.timeExtent:null;if(l.isNone(D))return t;t=l.isSome(t)?t.clone():new y;t.timeExtent=l.isSome(t.timeExtent)?t.timeExtent.intersection(D):D;return t};A._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult};A._update=function(t){this.active?(!this._dirty||this._querying||t.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(D=>{this._queryResult=D;this._querying=!1}).catch(D=>{w.isAbortError(D)||
(x.warn("FeatureFilter query failed: "+D,{error:D}),this._queryResult=new Set,this._core.graphics3DGraphics.forEach(E=>this._queryResult.add(this._getFeatureId(E.graphic))),this._querying=!1)}),t.madeProgress()),this._queryResult&&!t.done&&(this._core.modifyGraphics3DGraphicVisibilities(D=>{if(t.done)return!1;const E=this._queryResult.has(this._getFeatureId(D.graphic));return D.setVisibilityFlag(2,E,0)?(t.madeProgress(),!0):!1}),t.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()};
A._getFeatureId=function(t){return null==t.objectId?t.attributes[this._objectIdField]:t.objectId};k._createClass(z,[{key:"updating",get:function(){return this._dirty||this._querying||null!=this._queryResult}},{key:"active",get:function(){return this.filter&&0<this._core.graphics3DGraphics.size}},{key:"dirty",set:function(t){this._dirty!==t&&(this._dirty=t,this.notifyChange("updating"))}}]);return z}(q);a.__decorate([c.property({readOnly:!0})],b.Graphics3DFilterVisibility.prototype,"updating",null);
b.Graphics3DFilterVisibility=a.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],b.Graphics3DFilterVisibility);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Handles ../../../../geometry/projectionEllipsoid ../../../../core/watchUtils ../../../support/Scheduler ../../support/FrustumExtentIntersection".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){a=function(v){function y(){var x=v.apply(this,arguments)||this;x.suspended=!1;x.extent=null;x.extentIntersectionDirty=!0;x._isVisibleBelowSurface=!1;x.handles=new n;x.layerView=null;x.updating=!0;return x}b._inheritsLoose(y,v);var B=y.prototype;B.setup=function(x){this.layerView=x;this.extentIntersection=new u.FrustumExtentIntersection({renderCoordsHelper:x.view.renderCoordsHelper});x=x.view;const C=x.basemapTerrain,z=x.resourceController.scheduler;this.handles.add([x.on("resize",
()=>this.viewChange()),x.state.watch("camera",()=>this.viewChange(),!0),z.registerTask(m.Task.FRUSTUM_VISIBILITY,()=>this.update(),()=>this.updating),C.on("elevation-bounds-change",()=>this.elevationBoundsChange())]);"local"===x.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([q.init(C,["opacity","wireframe"],()=>this.updateIsVisibleBelowSurface()),q.init(x,"map.ground.navigationConstraint.type",()=>this.updateIsVisibleBelowSurface())])};B.destroy=function(){this.extentIntersection=this.extent=
this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};B._setDirty=function(){this.updating||this._set("updating",!0)};B.setExtent=function(x){this.extent=x;this.extentIntersectionDirty=!0;this._setDirty()};B.viewChange=function(){this._setDirty()};B.elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=!0};B.updateIsVisibleBelowSurface=function(){const x=this.layerView.view,C=x.basemapTerrain,z=x.map.ground&&x.map.ground.navigationConstraint&&"none"===
x.map.ground.navigationConstraint.type;this.isVisibleBelowSurface="local"===x.viewingMode||!C.isOpaque()||z};B.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var x=this.layerView.view;if(this._isVisibleBelowSurface)var C=-.3*w.getReferenceEllipsoid(x.spatialReference).radius;else{const {min:z,max:A}=x.basemapTerrain.elevationBounds;C=z-Math.max(1,(A-z)*(1.2-1))}this.extentIntersection.update(this.extent,x.spatialReference,C)}};B.update=function(){this._set("updating",
!1);if(this.extent){this.updateExtentIntersection();var x=this.layerView.view.frustum,C=w.getReferenceEllipsoid(this.layerView.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(x,C))}else this._set("suspended",!1)};b._createClass(y,[{key:"isVisibleBelowSurface",set:function(x){this._isVisibleBelowSurface=x;this._setDirty();this.extentIntersectionDirty=!0}}]);return y}(p);k.__decorate([h.property({readOnly:!0})],a.prototype,"suspended",void 0);k.__decorate([h.property({readOnly:!0})],
a.prototype,"updating",void 0);return a=k.__decorate([c.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],a)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils","./Graphics3DObjectStateSet"],function(b,k,a,r){let l=function(){function h(c){this._graphicsCore=c;this._stateSets=[]}var d=h.prototype;d.destroy=function(){this._stateSets&&this._stateSets.forEach(c=>c.objectStateSet.removeAll());
this._stateSets=null};d.acquireSet=function(c,e){const f=new r.Graphics3DObjectStateSet(c,e);this._stateSets.push(f);c=a.makeHandle(()=>this.releaseSet(f));return{set:f,handle:c}};d.releaseSet=function(c){c.objectStateSet.removeAll();c=this._stateSets?this._stateSets.indexOf(c):-1;-1!==c&&this._stateSets.splice(c,1)};d._addObjectStateSet=function(c,e){c.addObjectStateSet(e.stateType,e.objectStateSet)};d._removeObjectStateSet=function(c,e){c.removeObjectState(e.objectStateSet)};d.setUid=function(c,
e){c.ids.add(e);(e=this._graphicsCore.graphics3DGraphics.get(e))&&this._addObjectStateSet(e,c)};d.setUids=function(c,e){e.forEach(f=>this.setUid(c,f))};d.setObjectIds=function(c,e){e.forEach(f=>c.ids.add(f));this.initializeSet(c)};d.addGraphic=function(c){this._stateSets.forEach(e=>{!e.paused&&e.hasGraphic(c)&&this._addObjectStateSet(c,e)})};d.removeGraphic=function(c){this._stateSets.forEach(e=>{e.hasGraphic(c)&&this._removeObjectStateSet(c,e)})};d.allGraphicsDeleted=function(){this._stateSets&&
this._stateSets.forEach(c=>c.objectStateSet.removeAll())};d.initializeSet=function(c){const e=this._graphicsCore.graphics3DGraphics;c.objectIdField?e.forEach(f=>{f&&c.hasGraphic(f)&&this._addObjectStateSet(f,c)}):c.ids.forEach(f=>{(f=e.get(f))&&this._addObjectStateSet(f,c)})};k._createClass(h,[{key:"test",get:function(){return{states:this._stateSets}}}]);return h}();b.Graphics3DObjectStates=l;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports",
"../../webgl-engine/lib/Object3DStateSet"],function(b,k){let a=function(){function r(l,h){this.stateType=l;this.objectIdField=h;this.objectStateSet=new k.Object3DStateSet;this.ids=new Set;this.paused=!1}r.prototype.hasGraphic=function(l){return this.objectIdField?this.ids.has(l.graphic.attributes[this.objectIdField]):this.ids.has(l.graphic.uid)};return r}();b.Graphics3DObjectStateSet=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(b,k,a,r,l){let h=function(){function d(e){this._capabilities=this.memoryCache=null;const f=e.layerView.layer;this.layerView=e.layerView;this.objectIdField=f.objectIdField;this.returnZ=e.returnZ;this.returnM=e.returnM;e=this.layerView.view.resourceController;this.query=l.createFeatureTileQuery3D(f,e.scheduler);e&&this.memoryCacheEnabled&&(this.memoryCache=e.memoryController.getMemCache(f.uid))}
var c=d.prototype;c.destroy=function(){a.destroyMaybe(this.memoryCache);this.query.destroy()};c.createQuery=function(){const e=this.layerView.layer.createQuery();e.outFields=this.layerView.availableFields;e.returnZ=this.returnZ;e.returnM=this.returnM;e.outSpatialReference=this.tilingScheme.spatialReference;return e};c.logFetchError=function(e,f){e.error("#fetchTile()",this.layerView.layer,f&&f.message?f.message:f)};k._createClass(d,[{key:"memoryCacheEnabled",get:function(){switch(this.layerView.layer.source.type){case "feature-layer":case "ogc-feature":return!0;
case "csv":case "geojson":case "memory":case "stream-layer":return!1}}},{key:"viewingMode",get:function(){return this.layerView.view.state.mode}},{key:"tilingScheme",get:function(){return this.layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const e=this.layerView.view.resourceController;return e?e.scheduler:null}},{key:"geometryType",get:function(){return this.layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this.layerView.layer.fullExtent}},{key:"tileMaxRecordCount",
get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this.layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return a.isSome(this._capabilities)?this._capabilities:this._capabilities=r.contextCapabilitiesFromLayer(this.layerView.layer)}}]);return d}();b.FeatureTileFetcher3DLayerViewContext=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/decorators/aliasOf ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../core/Accessor ../../../../tasks/operations/query ../../../../layers/graphics/dehydratedFeatures ../../support/PBFDecoder".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y){let B=function(z){function A(){return z.apply(this,arguments)||this}k._inheritsLoose(A,z);var t=A.prototype;t.queryFeatureCount=function(D,E){return this.layer.queryFeatureCount(D,E)};t.destroy=function(){this._decoder=l.destroyMaybe(this._decoder)};k._createClass(A,[{key:"queryFeaturesDehydrated",get:function(){var D=this.layer.capabilities;if((D=D&&D.query)&&D.supportsFormatPBF){var E,G;l.isNone(this._decoder)&&(this._decoder=new y.PBFDecoder(this.scheduler));
const H={sourceSpatialReference:null!=(E=null==(G=this.layer.spatialReference)?void 0:G.toJSON())?E:null,applyTransform:!0,maxStringAttributeLength:1024};return(I,J)=>u.runQuery(this.layer.parsedUrl,I,"pbf",J).then(K=>{q.throwIfAborted(J);return l.isSome(this._decoder)?this._decoder.invoke({buffer:K.data,options:H},J.signal):q.reject(q.createAbortError())})}return(H,I)=>u.executeQuery(this.layer.parsedUrl,H,this.layer.spatialReference,I).then(J=>v.fromFeatureSetJSON(J.data))}}]);return A}(m);a.__decorate([c.property({constructOnly:!0})],
B.prototype,"layer",void 0);a.__decorate([c.property({constructOnly:!0})],B.prototype,"scheduler",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],B.prototype,"queryFeaturesDehydrated",null);B=a.__decorate([g.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],B);let x=function(z){function A(){return z.apply(this,arguments)||this}k._inheritsLoose(A,z);A.prototype.queryFeaturesDehydrated=function(t,D){return this.layer.queryFeatures(t,
D)};return A}(m);a.__decorate([c.property({constructOnly:!0})],x.prototype,"layer",void 0);x=a.__decorate([g.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],x);let C=function(z){function A(){return z.apply(this,arguments)||this}k._inheritsLoose(A,z);var t=A.prototype;t.destroy=function(){};t.queryFeaturesDehydrated=function(D,E){return this.source.queryFeaturesJSON(D,E).then(v.fromFeatureSetJSON,G=>{if(G&&"query-features-json:unsupported"===G.name)return this.layer.queryFeatures(D,
E);throw G;})};t.queryFeatureCount=function(D,E){return this.layer.queryFeatureCount(D,E)};return A}(m);a.__decorate([c.property({constructOnly:!0})],C.prototype,"layer",void 0);a.__decorate([e.aliasOf("layer.source")],C.prototype,"source",void 0);C=a.__decorate([g.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],C);b.createFeatureTileQuery3D=function(z,A){switch(z.source.type){case "feature-layer":return new B({layer:z,scheduler:A});case "memory":case "csv":case "geojson":return new C({layer:z});
case "ogc-feature":return new x({layer:z});case "stream-layer":throw Error("Tile based queries unsupported for stream sources");}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/promiseUtils ../../../geometry/SpatialReference ../../../Graphic ../../../layers/support/Field ../../support/Scheduler ./WorkerHandle".split(" "),function(b,k,a,r,l,h,d,c){let e=function(){function g(n){this._handle=
new f(n);this._frameTask=n.registerTask(d.Task.REMOTE_CLIENT,()=>{},()=>!1)}var p=g.prototype;p.destroy=function(){this._frameTask.remove();this._handle.destroy()};p.invoke=function(n,w){if(!n.buffer||0===n.buffer.byteLength)return a.resolve(null);n.options.sourceSpatialReference&&n.options.sourceSpatialReference instanceof r&&(n.options={...n.options,sourceSpatialReference:n.options.sourceSpatialReference.toJSON()});return this._handle.invoke(n,w).then(q=>this._frameTask.schedule(()=>{q.spatialReference=
r.fromJSON(q.spatialReference);if(q.fields)for(var m=0;m<q.fields.length;m++)q.fields[m]=h.fromJSON(q.fields[m]);m=q.spatialReference;for(const u of q.features)u.uid=l.generateUID(),u.geometry&&(u.geometry.spatialReference=m);return q}))};return g}(),f=function(g){function p(n){return g.call(this,"PBFDecoderWorker","_parseFeatureQuery",n)||this}k._inheritsLoose(p,g);p.prototype.getTransferList=function(n){return[n.buffer]};return p}(c.WorkerHandle);b.PBFDecoder=e;Object.defineProperty(b,"__esModule",
{value:!0})})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/typedArrayUtil ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../core/Collection ../../../layers/support/CodedValue ../../../layers/support/CodedValueDomain ../../../layers/support/domains ../../../layers/support/fieldUtils ../../../core/screenUtils ../../../core/asyncUtils ../../../chunks/vec3 ../../../core/unitUtils ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../../symbols/support/unitConversionUtils ../../../layers/support/PromiseQueue ../../support/Scheduler ../../../geometry/support/aaBoundingBox ../../support/layerViewUtils ../../../layers/graphics/dehydratedFeatures ../../../chunks/vec3f32 ../support/geometryUtils ../support/extentUtils ./LayerView3D ./support/layerViewUpdatingProperties ../../layers/LayerView ../support/orientedBoundingBox ./i3s/I3SUtil ./PointCloudWorkerHandle ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q,F,N,P,U,V,W,X,ca,R){const aa=h.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),ka=L.plane.create();a=function(fa){function ea(){var Z=fa.apply(this,arguments)||this;Z.maximumPointCount=4E6;Z.slicePlaneEnabled=!1;Z._renderer=null;Z._rendererAdded=!1;Z._renderedNodes=new Set;Z._nodeScales=new Map;Z._updateViewNeeded=!0;Z._lodFactor=1;Z._maxLoggedBoxWarnings=5;Z._pageMultiplier=1;Z._nodeLoadEpoch=0;Z._indexQueue=
[];Z._workQueue=[];Z._idleQueue=new E;Z._indexPagesLoading=new Map;Z._loadingNodes=new Map;Z._recalcWork=!0;Z._layerIsVisible=!1;Z._codedDomainPopulationPromise=null;Z._codedDomainPopulationAbortController=null;Z._totalWork=0;Z._index=null;Z._loadingInitNodePage=!1;Z._nodeIdArray=[];return Z}b._inheritsLoose(ea,fa);var Y=ea.prototype;Y.initialize=function(){var Z=this.view.resourceController;const ba=Z.scheduler;this._worker=new N.PointCloudWorkerHandle(ba);this.addResolvingPromise(this._worker.promise);
this._tmpPoint=J.makeDehydratedPoint(0,0,0,this.layer.spatialReference);F.checkPointCloudLayerValid(this.layer);F.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=Z.createStreamDataRequester(2);this._dataRequester=Z.createStreamDataRequester(3);this._initRenderer();Z=this._initNodePages();const ia=this.view.resourceController.memoryController;this._memCache=ia.getMemCache(this.layer.uid);this.updatingHandles.add(this,"_clippingBox",()=>this._setUpdateViewNeeded(),
2);this.updatingHandles.add(this,"_elevationOffset",()=>this._elevationOffsetChanged(),2);this.updatingHandles.add(this.layer,"renderer",()=>this._rendererChanged(),2);this.updatingHandles.add(this.layer,"filters",()=>this._reload(),2);this.updatingHandles.add(this.layer,"outFields",()=>this._reload(),2);this.updatingHandles.add(this.layer,"scaleRangeId",()=>this._setUpdateViewNeeded());this.updatingHandles.add(this,"clippingArea",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this.view.state,
"camera",()=>this._setUpdateViewNeeded());this.handles.add([this.view.basemapTerrain.on("scale-change",ja=>this._scaleUpdateHandler(ja)),ia.events.on("quality-changed",()=>this._setUpdateViewNeeded())]);this.addResolvingPromise(Z);this.when(()=>{this.handles.add([ba.registerTask(G.Task.POINT_CLOUD_LAYER,ja=>this._process(ja),()=>this._needsUpdate()),ba.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this.updatingHandles.add(this,"suspended",ja=>{ja?this._clearNodeState():this._setUpdateViewNeeded()},
2)])},()=>{this.updatingHandles.removeAll();this.handles.removeAll()})};Y._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};Y.destroy=function(){this.cancelLoading();this._worker&&(this._worker.destroy(),this._worker=null);this._destroyRenderer();this._memCache.destroy();this._memCache=null;this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=null);this._codedDomainPopulationPromise=
null};Y._initRenderer=function(){this._renderer=new ca.PointRenderer({createGraphic:(Z,ba,ia)=>this._createGraphic(Z,ba,ia)});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(this,"_clippingBox",Z=>this._renderer.clippingBox=Z,2);this.updatingHandles.add(this,"suspended",Z=>this._setPointsVisible(!Z),2);this.updatingHandles.add(this,"pointScale",Z=>this._renderer.scaleFactor=Z,2);this._renderer.minSizePx=Math.sqrt(2);this.updatingHandles.add(this,"useRealWorldSymbolSizes",Z=>this._renderer.useRealWorldSymbolSizes=
Z,2);this.updatingHandles.add(this,"pointSize",Z=>{const ba=B.pt2px(Z);this._renderer.size=Z;this._renderer.sizePx=ba},2);this.updatingHandles.add(this,"slicePlaneEnabled",Z=>this._renderer.slicePlane=Z,2);this.updatingHandles.add(this,"inverseDensity",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this,"maximumPointCount",()=>this._setUpdateViewNeeded(),2);this.updatingHandles.add(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",Z=>{this._lodFactor=Z;this._setUpdateViewNeeded()},
2)};Y._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};Y._createGraphic=function(Z,ba,ia){const ja=l.isSome(Z.pointIdFilterMap)?Z.pointIdFilterMap[ba]:ba;ia=this.view.computeMapPointFromVec3d(ia);const la=this._createGraphicAttributes(Z,ja);return new X.PointGraphic({pointCloudMetadata:{nodeId:Z.id,pointIndexInNode:ba,attributePointIndexInNode:ja,epoch:this._nodeLoadEpoch},geometry:ia,attributes:la,layer:this.layer,sourceLayer:this.layer})};Y._createGraphicAttributes=
function(Z,ba){const ia={};for(const ja of Z.attributes)this._encodeGraphicAttribute(ja.attributeInfo,ja.values,ba,ia);return ia};Y._encodeGraphicAttribute=function(Z,ba,ia,ja){var la=Z.storageInfo&&Z.storageInfo.attributeValues;const qa=la?la.valuesPerElement:1;if(1===qa)ja[Z.name]=ba[ia];else if("UInt8"===la.valueType&&4>=qa){la=0;ia*=qa;for(let na=ia;na<ia+qa;na++)la=(la<<8)+ba[na];ja[Z.name]=la}else ja[Z.name]=void 0};Y._setPointsVisible=function(Z){Z&&!this._rendererAdded?(this.view._stage.addRenderPlugin([4],
this._renderer),this._rendererAdded=!0):!Z&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};Y._rendererChanged=function(){this._renderer.useFixedSizes=V.rendererUsesFixedSizes(this.layer.renderer);this._reload()};Y._reload=function(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()};Y._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};Y._scaleUpdateHandler=function(Z){this.layer.minScale||
this.layer.maxScale?t.projectBoundingRect(Z.extent,Z.spatialReference,da,this.layer.spatialReference)&&(this._nodeScales.forEach((ba,ia)=>{this._renderedNodes.has(ia)?(ba=this._index.getNode(ia),A.containsPoint(da,ba.obb.center)&&this._nodeScales.set(ia,Z.scale)):this._nodeScales.delete(ia)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};Y.displayNodes=function(Z){this._workQueue=P.nodeDiff([...this._renderedNodes],Z,this._index);P.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,
this._index);P.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<Z.length||this._loadingInitNodePage;this.notifyChange("suspended")};Y.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};Y._cancelNodeLoading=function(){const Z=[];this._loadingNodes.forEach(({abortController:ba})=>Z.push(ba));this._loadingNodes.clear();for(const ba of Z)ba.abort();this._workQueue=[];this._idleQueue.cancelAll();
this._totalWork=this._computeWork();this._updateLoading()};Y._updateQueues=function(){const Z=new Set;this._workQueue.forEach(ja=>ja.load.forEach(la=>Z.add(la)));const ba=[],ia=new Map;this._loadingNodes.forEach((ja,la)=>{Z.has(la)?ia.set(la,ja):ba.push(ja)});this._loadingNodes=ia;for(const {abortController:ja}of ba)ja.abort();this._workQueue=this._workQueue.filter(ja=>{for(const la of ja.load)if(this._loadingNodes.has(la))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();
this._updateLoading()};Y._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:Z})=>Z.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};Y._clearNodeState=function(){this._nodeLoadEpoch++;this._renderedNodes.forEach(Z=>this._removeFromRenderer(Z));this._cancelNodeLoading()};Y._idleBegin=function(){this._setUpdateViewNeeded()};Y._idleEnd=function(){this._setUpdateViewNeeded()};Y._needsUpdate=function(){return this.suspended?
this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||0<this._workQueue.length||0<this._idleQueue.length};Y._process=function(Z){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,Z=this._isRootNodeVisible(),Z!==this._layerIsVisible&&(this._layerIsVisible=Z,this.notifyChange("suspended")),this._updateLoading());else{for(Z.run(()=>this._updateWorkQueues());0<this._indexQueue.length&&Z.run(()=>this._processIndexQueue()););for(this._processWorkQueue(Z);0<this._idleQueue.length&&
Z.run(()=>this._idleQueue.process()););}};Y._processIndexQueue=function(){const Z=this._indexQueue.shift(),ba=this._loadNodePage(Z);this._indexPagesLoading.set(Z,ba);ba.promise.then(ia=>{this._index.addPage(Z,ia,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(Z)},()=>{this._indexPagesLoading.delete(Z)});return!0};Y._processWorkQueue=function(Z){for(;!Z.done;){const ba=this._scheduleWorkEntry();if(l.isNone(ba))break;this._processWorkEntry(ba);Z.madeProgress()}};
Y._scheduleWorkEntry=function(){let Z=this._workQueue.length;for(;Z--;){const ba=this._workQueue.shift();if(ba.remove.find(ia=>!this._renderedNodes.has(ia)))this._workQueue.push(ba);else return ba}return null};Y._processWorkEntry=function(Z){if(0===Z.load.length)for(const ba of Z.remove)this._removeFromRenderer(ba);else w.all(Z.load.map(ba=>{const ia=w.createAbortController(),ja=this._memCache.pop(ba.toString());l.isSome(ja)?this._loadingNodes.set(ba,{abortController:ia,promise:w.resolve(ja)}):this._loadingNodes.has(ba)||
this._loadingNodes.set(ba,{abortController:ia,promise:this.loadNode(ba,ia.signal)});return this._loadingNodes.get(ba).promise})).then(ba=>{for(let ia=0;ia<Z.load.length;ia++)if(ba[ia]){const ja=this._setupRendererData(Z.load[ia],ba[ia]);this._addToRenderer(ja)}for(const ia of Z.remove)this._removeFromRenderer(ia)}).catch(()=>{}).then(()=>{for(const ba of Z.load)this._loadingNodes.delete(ba);this._updateLoading();this._recalcWork&&0===this._idleQueue.length&&0===this._indexQueue.length&&0===this._loadingNodes.size&&
(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()};Y.populateClassCodeCodedDomain=async function(Z,ba){const ia=this.layer.fieldsIndex.get("CLASS_CODE");ia&&!ia.domain&&-1!==Z.indexOf(ia.name)&&(Z=await x.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:ba})),!1!==Z.ok&&(Z=(Z=Z.value)&&Z.labels&&Z.labels.labels)&&Array.isArray(Z)&&(ia.domain=new u({name:"CLASS_CODE",codedValues:Z.map(ja=>new m["default"]({code:ja.value,name:ja.label}))})))};Y.prepareFetchPopupFeatures=
async function(Z){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=w.createAbortController(),this._codedDomainPopulationPromise=this.populateClassCodeCodedDomain(Z,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise};Y.whenGraphicAttributes=async function(Z,ba){const ia=this._splitGraphicsPerNode(Z),ja=this.layer.attributeStorageInfo,la=ba.map(oa=>V.getAttributeInfo(ja,
oa)),qa=async(oa,ua)=>{const za=this._index.getNode(ua);await x.forEach(la,async Fa=>{const La=Fa.useElevation?await this._loadElevationAttributeFromGeometry(za.resourceId):await this._loadAndParseAttribute(za,Fa);if(La)for(const Sa of oa)this._isValidPointGraphic(Sa)&&this._encodeGraphicAttribute(Fa,La,Sa.pointCloudMetadata.attributePointIndexInNode,Sa.attributes)})},na=[];ia.forEach((oa,ua)=>{na.push(qa(oa,ua))});await w.eachAlways(na);return Z};Y._isValidPointGraphic=function(Z){return Z instanceof
X.PointGraphic&&Z.pointCloudMetadata&&Z.pointCloudMetadata.epoch===this._nodeLoadEpoch};Y._splitGraphicsPerNode=function(Z){const ba=new Map;for(const ia of Z){if(!this._isValidPointGraphic(ia))continue;Z=ia.pointCloudMetadata;const ja=ba.get(Z.nodeId);ja?ja.push(ia):ba.set(Z.nodeId,[ia])}return ba};Y._loadAndParseAttribute=async function(Z,ba){const ia=await this._loadAttribute(Z.resourceId,ba,null);return l.isSome(ia)?W.getAttributeValues({attributeInfo:ba,buffer:ia},null,Z.vertexCount):null};Y._loadElevationAttributeFromGeometry=
async function(Z){Z=W.readGeometry(this.layer.store.defaultGeometrySchema,await this._loadGeometry(Z,null));return W.elevationFromPositions(Z,Z.length/3)};Y.highlight=function(Z){if(!Z)return{remove(){}};Z=q.isCollection(Z)?Z.toArray():Array.isArray(Z)?Z:[Z];return this._renderer.highlight(Z.map(ba=>this._graphicToPointDefinition(ba)))};Y._graphicToPointDefinition=function(Z){if(!this._isValidPointGraphic(Z))return null;const {nodeId:ba,pointIndexInNode:ia}=Z.pointCloudMetadata;return null!=ba&&null!=
ia?{nodeId:ba,pointId:ia}:null};Y._computeWork=function(){let Z=0;for(const ba of this._workQueue)Z+=ba.load.length+ba.remove.length;Z+=this._loadingNodes.size;Z+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;Z+=this._loadingInitNodePage?100:0;return Z+=this._updateViewNeeded?100:0};Y._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};Y.canResume=function(){return fa.prototype.canResume.call(this)&&this._layerIsVisible};
Y.isUpdating=function(){return this.suspended?this._updateViewNeeded:0<this._computeWork()};Y._initNodePages=function(){const Z=this.layer.store.index;this._index=new U(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,Z.nodesPerPage||Z.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=Z.nodesPerPage?
1:Z.nodePerIndexBlock;return this._loadNodePage(0).promise.then(ba=>{this._index.addPage(0,ba,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})};Y._loadNodePage=function(Z){const ba=w.createAbortController();return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${Z*this._pageMultiplier}`,ba.signal).then(ia=>ia.nodes.map((ja,la)=>({resourceId:null!=ja.resourceId?ja.resourceId:Z*this._index.pageSize+la,obb:ja.obb,firstChild:ja.firstChild,childCount:ja.childCount,
vertexCount:null!=ja.vertexCount?ja.vertexCount:ja.pointCount,lodThreshold:null!=ja.lodThreshold?ja.lodThreshold:ja.effectiveArea}))),abortController:ba}};Y._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;let Z=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const ba=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();let ia=this._computeNodesForMinimumDensity(Z),ja=this._computePointCount(ia),la=Math.sqrt(ja/(.75*ba));for(;ja>ba;)Z*=la,ia=this._computeNodesForMinimumDensity(Z),
ja=this._computePointCount(ia),la=Math.sqrt(2);this.displayNodes(ia);this._updateViewNeeded=!1;this._updateLoading();return!0};Y._computePointCount=function(Z){let ba=0;for(let ia=0;ia<Z.length;ia++){const ja=this._index.getNode(Z[ia]);ja&&(ba+=ja.vertexCount)}return ba};Y._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};Y._isRootNodeVisible=function(){let Z=!1;this._traverseVisible({frustumPlanes:this.view.state.camera.frustum.planes,clippingBox:this._clippingBox},
{predicate:(ba,ia,ja)=>{Z=ja;return!1},pageMiss:()=>{}});return Z};Y._computeNodesForMinimumDensity=function(Z){const ba=this.view.state.camera,ia=ba.frustum,ja=this._clippingBox,la=ba.viewForward,qa=C.dot(la,ba.eye),na=L.plane.fromNormalAndOffset(la,-qa,ka),oa=ba.perScreenPixelRatio/2,ua=Z*Z,za=this._nodeIdArray;za.length=0;const {minScale:Fa,maxScale:La}=I.extractSafeScaleBounds(this.layer),Sa=0===Fa&&0===La?Ia=>za.push(Ia):Ia=>{const Qa=this._getScale(Ia);I.scaleBoundsPredicate(Qa,Fa,La)&&za.push(Ia)};
this._traverseVisible({frustumPlanes:ia.planes,clippingBox:ja},{predicate:(Ia,Qa,Pa)=>{if(!Pa)return!1;if(0===Qa.childCount)return Sa(Ia),!1;Pa=this._index.getRenderObb(Ia);return this._computeAveragePixelArea(Pa,Qa.lodThreshold,Qa.vertexCount,na,oa)<=ua?(Sa(Ia),!1):!0},pageMiss:(Ia,Qa)=>{Sa(Ia);0>this._indexQueue.indexOf(Qa)&&this._indexQueue.push(Qa)}});return za};Y._getScale=function(Z){var ba=this._nodeScales.get(Z);null==ba&&(ba=this._index.getNode(Z).obb.center,this._tmpPoint.x=ba[0],this._tmpPoint.y=
ba[1],this._tmpPoint.z=ba[2],ba=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(Z,ba));return ba};Y._computeAveragePixelArea=function(Z,ba,ia,ja,la){Z=Math.max(1E-7,Q.minimumDistancePlane(Z,ja));return ba/(Z*Z)/(4*la*la)/ia};Y.loadNode=function(Z,ba){try{return this.loadNodeAsync(Z,ba)}catch(ia){throw w.isAbortError(ia)||aa.error(ia),ia;}};Y.loadAdditionalUserAttributes=async function(Z,ba,ia){var ja=this.layer.outFields;if(!ja)return[];ja=y.unpackFieldNames(this.layer.fields,
ja);Z=new Set(Z.map(na=>l.isSome(na)?na.name:null));const la=this.layer.attributeStorageInfo,qa=[];for(const na of ja)Z.has(na)||(ja=V.getAttributeInfo(la,na))&&qa.push(ba(ja));ba=await w.eachAlwaysValues(qa);w.throwIfAborted(ia);return l.mapSome(ba,na=>na)};Y.loadNodeAsync=async function(Z,ba){const ia=this._index.getNode(Z),ja=V.getRendererInfo(this.layer),la=V.getFilterInfo(this.layer),qa=ia.resourceId,na=async oa=>{if(l.isNone(oa))return null;if(oa.useElevation)return{attributeInfo:oa,buffer:null};
const ua=await this._loadAttribute(qa,oa,ba);return l.isSome(ua)?{attributeInfo:oa,buffer:ua}:null};return this._idleQueue.push(async()=>{var oa=this._loadGeometry(qa,ba);const {primaryAttribute:ua,modulationAttribute:za}=ja,Fa=na(ua),La=na(za);var Sa=la.map(Ua=>Ua.attributeInfo);const Ia=Sa.map(Ua=>na(Ua));Sa=this.loadAdditionalUserAttributes([ua,za,...Sa],na,ba);const [Qa,Pa,sa,Ga,Ra]=await w.all([oa,Fa,La,w.all(Ia),Sa]);w.throwIfAborted(ba);oa={geometryBuffer:Qa,primaryAttributeData:Pa,modulationAttributeData:sa,
filterAttributesData:Ga,userAttributesData:Ra,schema:this.layer.store.defaultGeometrySchema,rendererInfo:ja,filterInfo:la,obb:this._index.getRenderObb(Z),elevationOffset:this._elevationOffset,inSR:this.layer.spatialReference.toJSON(),outSR:this.view.renderCoordsHelper.spatialReference.toJSON()};return this._worker.invoke(oa,ba)},ba)};Y._loadGeometry=async function(Z,ba){return this._requestData(`${this.baseUrl}/nodes/${Z}/geometries/0`,ba)};Y._loadAttribute=async function(Z,ba,ia){return l.isNone(ba)||
!ba.storageInfo?null:this._requestData(`${this.baseUrl}/nodes/${Z}/attributes/${ba.storageInfo.key}`,ia)};Y._requestNodePage=function(Z,ba){return this._indexRequester.request(Z,"json",{query:{f:"json"},signal:ba})};Y._requestData=function(Z,ba){return this._dataRequester.request(Z,"binary",{signal:ba})};Y._removeFromRenderer=function(Z){if(this._renderedNodes.has(Z)){const ba=this._renderer.removeNode(Z);this._renderedNodes.delete(Z);this._nodeScales.delete(Z);this._memCache.put(ba.id.toString(),
ba,5*ba.coordinates.length+128)}};Y._addToRenderer=function(Z){this._renderedNodes.has(Z.id)||(this._renderedNodes.add(Z.id),this._renderer.addNode(Z))};Y._setupRendererData=function(Z,ba){const ia=this._index.getNode(Z),ja=Math.sqrt(ia.lodThreshold/ia.vertexCount),la=this._index.getRenderObb(Z);if(ca.PointRenderer.isInstanceOfNode(ba))return ba.splatSize=ja,ba.obb=la,ba.origin=K.clone(ba.obb.center),ba;if(ba.obb.halfSize[0]>1.001*la.halfSize[0]||ba.obb.halfSize[1]>1.001*la.halfSize[1]||ba.obb.halfSize[2]>
1.001*la.halfSize[2]){if(0<this._maxLoggedBoxWarnings){const qa=na=>`[${na.halfSize[0]}, ${na.halfSize[1]}, ${na.halfSize[2]}]`;aa.warn(`Node ${Z} reported bounding box too small. got ${qa(la)} but points cover ${qa(ba.obb)}`);0===--this._maxLoggedBoxWarnings&&aa.warn("  Too many bounding box errors, stopping reporting for this layer.")}this._index.setRenderObb(Z,ba.obb)}return{id:Z,coordinates:ba.points,origin:K.clone(la.center),rgb:ba.rgb,attributes:ba.attributes,pointIdFilterMap:ba.pointIdFilterMap,
highlights:null,splatSize:ja,obb:la,isLeaf:0===ia.childCount}};Y.getUsedMemory=function(){let Z=0;this._renderer.forEachNode(ba=>{Z+=160;Z+=r.estimateSize(ba.coordinates);for(const ia of ba.attributes)ba=ia.values,r.isArrayBuffer(ba.buffer)&&(Z+=r.estimateSize(ba))});return Z};Y.getUnloadedMemory=function(){var Z=this._renderedNodes.size;if(4>Z)return 0;const ba=[...this._renderedNodes].reduce((la,qa)=>la+this._index.getNode(qa).vertexCount);let ia=this._loadingNodes.size;for(var ja=0;ja<this._workQueue.length;ja++)ia+=
this._workQueue[ja].load.length,ia-=this._workQueue[ja].remove.length;if(0>ia)return 0;ja=ia*ba/Z;Z=(this.getUsedMemory()-160*Z)/ba;return ja*Z+160*ia};Y.ignoresMemoryFactor=function(){return!1};b._createClass(ea,[{key:"pointScale",get:function(){const Z=V.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return Z&&null!=Z.scaleFactor?Z.scaleFactor:1}},{key:"useRealWorldSymbolSizes",get:function(){const Z=V.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return Z&&null!=Z.useRealWorldSymbolSizes?
Z.useRealWorldSymbolSizes:!1}},{key:"pointSize",get:function(){const Z=V.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return Z&&null!=Z.size?Z.size:0}},{key:"inverseDensity",get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5}},{key:"availableFields",get:function(){var Z=V.getRendererInfo(this.layer);const ba=new Set;Z.primaryAttribute&&ba.add(Z.primaryAttribute.name);Z.modulationAttribute&&ba.add(Z.primaryAttribute.name);if(Z=V.getFilterInfo(this.layer))for(const ia of Z)ba.add(ia.attributeInfo.name);
if(this.layer.outFields)for(const ia of y.unpackFieldNames(this.layer.fields,this.layer.outFields))ba.add(ia);return Array.from(ba)}},{key:"_clippingBox",get:function(){if(!this.view||!this.view.clippingArea)return null;const Z=H.create();return S.projectToBoundingBox(this.view.clippingArea,Z,this.view.renderSpatialReference)?Z:null}},{key:"_elevationOffset",get:function(){const Z=this.layer&&this.layer.elevationInfo;if(Z&&"absolute-height"===Z.mode){const ba=z.getMetersPerVerticalUnitForSR(this.layer.spatialReference),
ia=D.getMetersPerUnit(Z.unit);return l.unwrapOr(Z.offset,0)*ia/ba}return 0}},{key:"updatingProgressValue",get:function(){if(this.suspended)return this._updateViewNeeded?0:1;const Z=this._computeWork();return 1-Math.min(this._totalWork,Z)/this._totalWork}},{key:"performanceInfo",get:function(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((Z,ba)=>Z+this._index.getNode(ba).vertexCount,0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,
core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}},{key:"test",get:function(){return{index:this._index,visibleNodes:this._renderedNodes}}}]);return ea}(R.PopupSceneLayerView(M.LayerView3D(O)));k.__decorate([c.property()],a.prototype,"layer",void 0);k.__decorate([c.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],a.prototype,"baseUrl",void 0);k.__decorate([c.property({readOnly:!0,
dependsOn:["layer.renderer"]})],a.prototype,"pointScale",null);k.__decorate([c.property({readOnly:!0,dependsOn:["layer.renderer"]})],a.prototype,"useRealWorldSymbolSizes",null);k.__decorate([c.property({readOnly:!0,dependsOn:["layer.renderer"]})],a.prototype,"pointSize",null);k.__decorate([c.property({readOnly:!0,dependsOn:["layer.renderer"]})],a.prototype,"inverseDensity",null);k.__decorate([c.property()],a.prototype,"maximumPointCount",void 0);k.__decorate([c.property({readOnly:!0,dependsOn:["layer.renderer",
"layer.filters","layer.outFields"]})],a.prototype,"availableFields",null);k.__decorate([c.property({readOnly:!0,dependsOn:["view.clippingArea"]})],a.prototype,"_clippingBox",null);k.__decorate([c.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],a.prototype,"_elevationOffset",null);k.__decorate([c.property({type:Boolean})],a.prototype,"slicePlaneEnabled",void 0);k.__decorate([c.property()],a.prototype,"updating",void 0);k.__decorate([c.property(T.updatingProgress)],a.prototype,"updatingProgress",
void 0);k.__decorate([c.property({readOnly:!0,dependsOn:["suspended"]})],a.prototype,"updatingProgressValue",null);a=k.__decorate([f.subclass("esri.views.3d.layers.PointCloudLayerView3D")],a);const da=A.create();return a})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../core/has ../../../../core/typedArrayUtil ../../../../core/maybe ../../../../core/Error ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils ../../../../request ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../../tasks/support/Query ../../../../chunks/mat4f64 ../../../../chunks/vec4f64 ../../../../chunks/quat ../../../../geometry/support/aaBoundingBox ../support/edgeUtils ../support/symbolColorUtils ../../../../chunks/quatf32 ../../support/orientedBoundingBox ./I3SBinaryReader ./I3SProjectionUtil".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D){function E(ba){return ba&&parseInt(ba.substring(ba.lastIndexOf("/")+1,ba.length),10)}function G(ba,ia){var ja=ia[0],la=ia[1];ia=ia[3];const qa=ba[0]-ja;ja-=ba[2];const na=ba[1]-la;ba=la-ba[3];la=Math.max(qa,ja,0);const oa=Math.max(na,ba,0);la=la*la+oa*oa;return la>ia*ia?0:0<la?1:-Math.max(qa,ja,na,ba)>ia?3:2}function H(ba,ia,ja){const la=[],qa=ja&&ja.missingFields;ja=ja&&ja.originalFields;for(const na of ba){ba=na.toLowerCase();let oa=
!1;for(const ua of ia)if(ba===ua.name.toLowerCase()){la.push(ua.name);oa=!0;ja&&ja.push(na);break}!oa&&qa&&qa.push(na)}return la}function I(ba,ia,ja){const la=new Map,qa=[];ja=ja();for(const ua of ba){var na=ua.attributes[ia];for(var oa=0;oa<ja.length;oa++){ba=ja[oa];const za=ba.featureIds.indexOf(na);if(0<=za){na=la.get(ba.node);na||(na={node:ba.node,indices:[],graphics:[]},qa.push(na),la.set(ba.node,na));na.indices.push(za);for(na.graphics.push(ua);0<oa;oa--)ja[oa]=ja[oa-1];ja[0]=ba;break}}}return qa}
function J(ba,ia){return ba.filter(ja=>ja!==ia).concat([ia])}async function K(ba,ia,ja,la){ia.sort((oa,ua)=>oa.attributes[ja]-ua.attributes[ja]);var qa=ia.map(oa=>oa.attributes[ja]);const na=[];la=H(la,ba.fields,{originalFields:na});ba=await L(ba,qa,la);for(qa=0;qa<ia.length;qa++){const oa=ia[qa],ua=ba[qa],za={};if(oa.attributes)for(const Fa in oa.attributes)za[Fa]=oa.attributes[Fa];for(let Fa=0;Fa<na.length;Fa++)za[na[Fa]]=ua[la[Fa]];oa.attributes=za}return ia}function L(ba,ia,ja){var la=ba.capabilities.query.maxRecordCount;
if(null!=la&&ia.length>la)return la=h.splitIntoChunks(ia,la),d.all(la.map(qa=>L(ba,qa,ja))).then(h.flatten);la=new m({objectIds:ia,outFields:ja,orderByFields:[ba.objectIdField]});return ba.queryFeatures(la).then(qa=>{if(qa&&qa.features&&qa.features.length===ia.length)return qa.features.map(na=>na.attributes);throw new l("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}function S(ba,ia,ja,la,qa){const na=[];for(const oa of ia)oa&&-1!==qa.indexOf(oa.name)&&
na.push({url:`${ba}/nodes/${ja.resources.attributes}/attributes/${oa.key}/0`,storageInfo:oa});return d.eachAlways(na.map(oa=>f(oa.url,{responseType:"array-buffer"}).then(ua=>t.readBinaryAttribute(oa.storageInfo,ua.data)))).then(oa=>{const ua=[];for(const za of la){const Fa={};for(let La=0;La<oa.length;La++)null!=oa[La].value&&(Fa[na[La].storageInfo.name]=M(oa[La].value,za));ua.push(Fa)}return ua})}function M(ba,ia){if(!ba)return null;ia=ba[ia];return a.isInt16Array(ba)?-32768===ia?null:ia:a.isInt32Array(ba)?
ia===W?null:ia:ia!==ia?null:ia}function T(ba){var ia=ba.store.indexCRS||ba.store.geographicCRS;const ja=void 0===ia?ba.store.indexWKT:void 0;if(ja)if(ba.spatialReference){if(ja!==ba.spatialReference.wkt)throw new l("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new l("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",
{});ia=ia?new c(E(ia)):ba.spatialReference;return ia.equals(ba.spatialReference)?ba.spatialReference:ia}function O(ba){var ia=ba.store.vertexCRS||ba.store.projectedCRS;const ja=void 0===ia?ba.store.vertexWKT:void 0;if(ja)if(ba.spatialReference){if(ja!==ba.spatialReference.wkt)throw new l("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new l("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference",
"Found vertexWKT in the scene layer store but no layer spatial reference",{});ia=ia?new c(E(ia)):ba.spatialReference;return ia.equals(ba.spatialReference)?ba.spatialReference:ia}function Q(ba,ia,ja){if(!e.canProject(ba,ia))throw new l("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===ja&&ba.isGeographic)throw new l("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",
{});}function F(ba,ia,ja){const la=T(ba);ba=O(ba);Q(la,ia,ja);Q(ba,ia,ja)}function N(ba,ia,ja,la,qa=0){if(la===p.getSphericalPCPF(la))if(ia.isGeographic){var na=p.getReferenceEllipsoid(ia);la=1+Math.max(0,qa)/(na.radius+ba.center[2]);g.set(ja.center,ba.center[0],ba.center[1],ba.center[2]+qa);q.projectBuffer(ja.center,ia,0,ja.center,p.getSphericalPCPF(ia),0,1);y.copy(ja.quaternion,ba.quaternion);y.conjugate(R,ba.quaternion);g.set(ea,0,0,1);g.transformQuat(ea,ea,R);g.set(ea,ba.halfSize[0]*Math.abs(ea[0]),
ba.halfSize[1]*Math.abs(ea[1]),ba.halfSize[2]*Math.abs(ea[2]));g.scale(ea,ea,na.inverseFlattening);g.add(ja.halfSize,ba.halfSize,ea);g.scale(ja.halfSize,ja.halfSize,la)}else{{A.corners(ba,aa);g.set(ja.center,ba.center[0],ba.center[1],ba.center[2]+qa);q.computeLinearTransformation(ia,ja.center,ca,p.getSphericalPCPF(ia));g.set(ja.center,ca[12],ca[13],ca[14]);la=2*Math.sqrt(1+ca[0]+ca[5]+ca[10]);R[0]=(ca[6]-ca[9])/la;R[1]=(ca[8]-ca[2])/la;R[2]=(ca[1]-ca[4])/la;R[3]=.25*la;y.multiply(ja.quaternion,R,
ba.quaternion);y.conjugate(R,ja.quaternion);let oa=la=ba=0;for(na of aa)na[2]+=qa,q.projectBuffer(na,ia,0,na,p.getSphericalPCPF(ia),0,1),g.sub(ea,na,ja.center),g.transformQuat(ea,ea,R),ba=Math.max(ba,Math.abs(ea[0])),la=Math.max(la,Math.abs(ea[1])),oa=Math.max(oa,Math.abs(ea[2]));g.set(ja.halfSize,ba,la,oa)}}else ba===ja?(ja.center[2]+=qa,q.projectBuffer(ja.center,ia,0,ja.center,la,0,1)):(g.set(ja.center,ba.center[0],ba.center[1],ba.center[2]+qa),q.projectBuffer(ja.center,ia,0,ja.center,la,0,1),y.copy(ja.quaternion,
ba.quaternion),g.copy(ja.halfSize,ba.halfSize))}const P=["image/jpeg","image/png"],U=B.create(),V=v.create(),W=-(2**31);v=x.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});let X=function(){this.material=this.edgeMaterial=null;this.castShadows=!0};const ca=u.create(),R=z.create(),aa=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],ka=w.create(),da=w.create(),fa=A.create(),ea=[0,0,0],Y={data:Array(72),size:3,offsetIdx:0,strideIdx:3},Z=u.create();b.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=
P;b.DDS_ENCODING_STRING="image/vnd-ms.dds";b.SymbolInfo=X;b.addWraparound=function(ba,ia){return(ba|0)+(ia|0)|0};b.checkPointCloudLayerCompatibleWithView=function(ba,ia){Q(ba.spatialReference,ia.spatialReference,ia.viewingMode)};b.checkPointCloudLayerValid=function(ba){var ia;(ia=null==ba.store||null==ba.store.defaultGeometrySchema)||(ba=ba.store.defaultGeometrySchema,ia=!!(null==ba.geometryType||"points"!==ba.geometryType||null!=ba.topology&&"PerAttributeArray"!==ba.topology||null!=ba.encoding&&
""!==ba.encoding&&"lepcc-xyz"!==ba.encoding||null==ba.vertexAttributes||null==ba.vertexAttributes.position));if(ia)throw new l("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};b.checkSceneLayerCompatibleWithView=function(ba,ia){F(ba,ia.spatialReference,ia.viewingMode)};b.checkSceneLayerValid=function(ba){var ia;(ia=null==ba.store||null==ba.store.defaultGeometrySchema)||(ia=ba.store.defaultGeometrySchema,ia=!!(null!=ia.geometryType&&
"triangles"!==ia.geometryType||null!=ia.topology&&"PerAttributeArray"!==ia.topology||null==ia.vertexAttributes||null==ia.vertexAttributes.position));if(ia)throw new l("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:ba.parsedUrl.path});};b.checkSpatialReference=Q;b.checkSpatialReferences=F;b.computeVisibilityObb=function(ba,ia,ja,la,qa,na){if(!na||0===na.length||r.isNone(ia))return null;const oa=D.computeGlobalTransformation(ba.mbs,qa,ja,ia);
n.invert(Z,oa);let ua;const za=()=>{if(!ua)if(ua=aa,w.empty(da),r.isSome(ba.serviceObb)){N(ba.serviceObb,ja,fa,ia,qa);A.corners(fa,ua);for(var Ia of ua)g.transformMat4(Ia,Ia,Z),w.expandPointInPlace(da,Ia)}else{var Qa=ba.mbs;Ia=Qa[3];q.projectVectorToVector(Qa,ja,ea,ia);g.transformMat4(ea,ea,Z);ea[2]+=qa;for(Qa=0;8>Qa;++Qa){const Pa=ua[Qa];g.copy(Pa,[ea[0]+(Qa&1?Ia:-Ia),ea[1]+(Qa&2?Ia:-Ia),ea[2]+(Qa&4?Ia:-Ia)]);w.expandPointInPlace(da,Pa)}}};let Fa=Infinity,La=-Infinity;const Sa=Ia=>{if("replace"===
Ia.type&&(Ia=Ia.geometry,Ia.hasZ)){w.empty(ka);var Qa=Ia.spatialReference||la;Ia=Ia.rings.reduce((Pa,sa)=>sa.reduce((Ga,Ra)=>{q.projectVectorToVector(Ra,Qa,ea,ia);g.transformMat4(ea,ea,Z);w.expandPointInPlace(ka,ea);return Math.min(ea[2],Ga)},Pa),Infinity);za();w.intersects(da,ka)&&(Fa=Math.min(Fa,Ia),La=Math.max(La,Ia))}};na.forEach(Ia=>Sa(Ia));if(Infinity===Fa)return null;na=(Ia,Qa,Pa)=>{g.transformMat4(ea,Pa,oa);Ia[Qa+0]=ea[0];Ia[Qa+1]=ea[1];Ia[Qa+2]=ea[2];Qa+=24;Pa[2]=Fa;g.transformMat4(ea,Pa,
oa);Ia[Qa+0]=ea[0];Ia[Qa+1]=ea[1];Ia[Qa+2]=ea[2];Qa+=24;Pa[2]=La;g.transformMat4(ea,Pa,oa);Ia[Qa+0]=ea[0];Ia[Qa+1]=ea[1];Ia[Qa+2]=ea[2]};for(let Ia=0;8>Ia;++Ia)na(Y.data,3*Ia,ua[Ia]);return A.compute(Y)};b.containsDraco=function(ba){if(k("disable-feature:i3s-draco")||!ba)return!1;for(const ia of ba)for(const ja of ia.geometryBuffers)if("draco"===ja.compressedAttributes.encoding)return!0;return!1};b.extractWkid=E;b.filterInPlace=function(ba,ia,ja){let la=0,qa=0;for(let na=0;na<ia.length&&la<ba.length;na++)ba[la]===
ia[na]&&(ja(na)&&(ba[qa]=ba[la],qa++),la++);ba.length=qa};b.findFieldsCaseInsensitive=H;b.findIntersectingNodes=function(ba,ia,ja,la,qa,na){qa.traverse(ja,oa=>{var ua=oa.mbs;ia!==la&&(ua=V,q.projectBoundingSphere(oa.mbs,la,ua,ia));ua=G(ba,ua);if(0===ua)return!1;na(oa,ua);return!0})};b.getCacheKeySuffix=function(ba,ia){return r.isNone(ia)?"@null":ia===p.getSphericalPCPF(ia)?"@ECEF":ba.equals(ia)?"":null!=ia.wkid?"@"+ia.wkid:null};b.getCachedAttributeValue=M;b.getClipAABB=function(ba,ia){if(0===ia.rotationScale[1]&&
0===ia.rotationScale[2]&&0===ia.rotationScale[3]&&0===ia.rotationScale[5]&&0===ia.rotationScale[6]&&0===ia.rotationScale[7])return U[0]=(ba[0]-ia.position[0])/ia.rotationScale[0],U[1]=(ba[1]-ia.position[1])/ia.rotationScale[4],U[2]=(ba[2]-ia.position[2])/ia.rotationScale[8],U[3]=(ba[3]-ia.position[0])/ia.rotationScale[0],U[4]=(ba[4]-ia.position[1])/ia.rotationScale[4],U[5]=(ba[5]-ia.position[2])/ia.rotationScale[8],U};b.getIndexCrs=T;b.getSymbolInfo=function(ba){const ia=new X;var ja=!1;let la=!1;
for(const na of ba.symbolLayers.items)if("fill"===na.type&&na.enabled){var qa=na.material;ba=na.edges;r.isSome(qa)&&!ja&&(ja=qa.color,qa=C.parseColorMixMode(qa.colorMixMode),r.isSome(ja)?ia.material={color:[ja.r/255,ja.g/255,ja.b/255],alpha:ja.a,colorMixMode:qa}:ia.material={color:[1,1,1],alpha:1,colorMixMode:1},ia.castShadows=na.castShadows,ja=!0);r.isSome(ba)&&!la&&(ia.edgeMaterial=x.createMaterialFromEdges(ba,{}),la=!0)}ia.material||(ia.material={color:[1,1,1],alpha:1,colorMixMode:1});return ia};
b.getVertexCrs=O;b.intersectBoundingBoxWithMbs=function(ba,ia){var ja=ia[0],la=ia[1],qa=ia[2];ia=ia[3];const na=ba[0]-ja;ja-=ba[3];const oa=ba[1]-la;la-=ba[4];const ua=ba[2]-qa;ba=qa-ba[5];qa=Math.max(na,ja,0);const za=Math.max(oa,la,0),Fa=Math.max(ua,ba,0);qa=qa*qa+za*za+Fa*Fa;return qa>ia*ia?0:0<qa?1:-Math.max(na,ja,oa,la,ua,ba)>ia?3:2};b.intersectBoundingRectWithMbs=G;b.objectIdFilter=function(ba,ia,ja){let la=0,qa=0;for(;la<ja.length;)0<=h.binaryIndexOf(ba,ja[la])===ia&&(ja[qa]=ja[la],qa++),la++;
ja.length=qa};b.rendererNeedsTextures=function(ba){if(null==ba||"simple"!==ba.type&&"class-breaks"!==ba.type&&"unique-value"!==ba.type||("unique-value"===ba.type||"class-breaks"===ba.type)&&null==ba.defaultSymbol)return!0;ba=ba.getSymbols();if(0===ba.length)return!0;for(const ia of ba){if("mesh-3d"!==ia.type||0===ia.symbolLayers.length)return!0;for(const ja of ia.symbolLayers.items)if("fill"!==ja.type||r.isNone(ja.material)||r.isNone(ja.material.color)||"replace"!==ja.material.colorMixMode)return!0}return!1};
b.selectEncoding=function(ba,ia){if(ia)for(ia=0;ia<ba.length;ia++)if("image/vnd-ms.dds"===ba[ia].encoding)return ba[ia];for(ia=0;ia<ba.length;ia++)if(-1<P.indexOf(ba[ia].encoding))return ba[ia];return null};b.transformObb=N;b.transparentEdgeMaterial=v;b.whenGraphicAttributes=async function(ba,ia,ja,la,qa,na){!0===(na&&na.populateObjectId)&&(la=J(la,ja));if(0===ia.length)return[];const oa=ba.attributeStorageInfo;if(r.isSome(ba.associatedLayer))try{return await K(ba.associatedLayer,ia,ja,la)}catch(ua){if(ba.associatedLayer.loaded)throw ua;
}if(oa){ia=I(ia,ja,qa);if(r.isNone(ia))throw new l("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const ua=ba.parsedUrl.path;ba=await d.all(ia.map(za=>S(ua,oa,za.node,za.indices,la).then(Fa=>{for(let La=0;La<za.graphics.length;La++){const Sa=za.graphics[La],Ia=Fa[La];if(Sa.attributes)for(const Qa in Sa.attributes)Qa in Ia||(Ia[Qa]=Sa.attributes[Qa]);Sa.attributes=Ia}return za.graphics})));return h.flatten(ba)}throw new l("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available");
};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define(["exports","../../../../core/lang","../../../../core/Logger","../../../../core/Error","./LEPCC"],function(b,k,a,r,l){function h(C,z,A){let t="",D=0;for(;D<A;){var E=C[z+D];if(128>E)t+=String.fromCharCode(E),D++;else if(192<=E&&224>E){if(D+1>=A)throw new r("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");t+=String.fromCharCode((E&31)<<6|C[z+D+1]&63);D+=2}else if(224<=
E&&240>E){if(D+2>=A)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");t+=String.fromCharCode((E&15)<<12|(C[z+D+1]&63)<<6|C[z+D+2]&63);D+=3}else if(240<=E&&248>E){if(D+3>=A)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");E=(E&7)<<18|(C[z+D+1]&63)<<12|(C[z+D+2]&63)<<6|C[z+D+3]&63;t=65536<=E?t+String.fromCharCode((E-65536>>10)+55296,(E&1023)+56320):t+String.fromCharCode(E);D+=4}else throw new r("utf8-decode-error",
"UTF-8 Decode failed. Invalid multi byte sequence.");}return t}function d(C,z){const A={byteOffset:0,byteCount:0,fields:Object.create(null)};let t=0;for(let D=0;D<z.length;D++){const E=z[D],G=E.valueType||E.type;A.fields[E.property]=(0,x[G])(C,t);t+=B[G].BYTES_PER_ELEMENT}A.byteCount=t;return A}function c(C,z,A){const t=[];let D,E=0,G;for(G=0;G<C;G+=1){D=z[G];if(0<D){if(t.push(h(A,E,D-1)),0!==A[E+D-1])throw new r("string-array-error","Invalid string array: missing null termination.");}else t.push(null);
E+=D}return t}function e(C,z){return new B[z.valueType](C,z.byteOffset,z.count*z.valuesPerElement)}function f(C,z){return new Uint8Array(C,z.byteOffset,z.byteCount)}function g(C,z,A){C=null!=z.header?d(C,z.header):{byteOffset:0,byteCount:0,fields:{count:A}};A={header:C,byteOffset:C.byteCount,byteCount:0,entries:Object.create(null)};let t=C.byteCount;for(let D=0;D<z.ordering.length;D++){const E=z.ordering[D],G=k.clone(z[E]);G.count=C.fields.count;if("String"===G.valueType){if(G.byteOffset=t,G.byteCount=
C.fields[E+"ByteCount"],"UTF-8"!==G.encoding)throw new r("unsupported-encoding","Unsupported String encoding.",{encoding:G.encoding});}else if(m(G.valueType)){const H=u(G.valueType);t+=0!==t%H?H-t%H:0;G.byteOffset=t;G.byteCount=H*G.valuesPerElement*G.count}else throw new r("unsupported-value-type","Unsupported binary valueType",{valueType:G.valueType});t+=G.byteCount;A.entries[E]=G}A.byteCount=t-A.byteOffset;return A}function p(C,z,A){z!==C&&v.error(`Invalid ${A} buffer size\n expected: ${C}, actual: ${z})`);
if(z<C)throw new r("buffer-too-small","Binary buffer is too small",{expectedSize:C,actualSize:z});}function n(C){return{isDraco:!1,isLegacy:!1,color:null!=C.color,normal:null!=C.normal,uv0:null!=C.uv0,uvRegion:null!=C.uvRegion,featureIndex:null!=C.faceRange&&null!=C.featureId}}function w(C){const z={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const A of C.ordering)if(C.vertexAttributes[A])switch(A){case "normal":z.normal=!0;break;case "color":z.color=!0;break;
case "uv0":z.uv0=!0;break;case "region":z.uvRegion=!0}C.featureAttributes&&C.featureAttributeOrder&&(z.featureIndex=!0);return z}function q(C){const z={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const A of C)switch(A){case "normal":z.normal=!0;break;case "uv0":z.uv0=!0;break;case "color":z.color=!0;break;case "uv-region":z.uvRegion=!0;break;case "feature-index":z.featureIndex=!0}return z}function m(C){return B.hasOwnProperty(C)}function u(C){return m(C)?B[C].BYTES_PER_ELEMENT:
0}const v=a.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),y={position:"position",normal:"normal",color:"color",uv0:"uv0",region:"uvRegion"},B={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},x={Float32:(C,z)=>(new DataView(C,0)).getFloat32(z,!0),Float64:(C,z)=>(new DataView(C,0)).getFloat64(z,!0),UInt8:(C,z)=>(new DataView(C,0)).getUint8(z),Int8:(C,z)=>(new DataView(C,0)).getInt8(z),UInt16:(C,
z)=>(new DataView(C,0)).getUint16(z,!0),Int16:(C,z)=>(new DataView(C,0)).getInt16(z,!0),UInt32:(C,z)=>(new DataView(C,0)).getUint32(z,!0),Int32:(C,z)=>(new DataView(C,0)).getInt32(z,!0)};b.createAttributeDataIndex=g;b.createGeometryDescriptor=function(C,z){return C&&C.compressedAttributes&&"draco"===C.compressedAttributes.encoding?q(C.compressedAttributes.attributes):C?n(C):w(z)};b.createGeometryDescriptorForDraco=q;b.createGeometryDescriptorFromDefinition=n;b.createGeometryDescriptorFromSchema=w;
b.createGeometryIndexFromSchema=function(C,z){var A=d(C,z&&z.header);let t=A.byteCount;const D={isDraco:!1,header:A,byteOffset:A.byteCount,byteCount:0,vertexAttributes:{}};A=A.fields;var E=null!=A.vertexCount?A.vertexCount:A.count;for(var G of z.ordering){if(!z.vertexAttributes[G])continue;const I={...z.vertexAttributes[G],byteOffset:t,count:E};D.vertexAttributes[y[G]?y[G]:"_"+G]=I;t+=u(I.valueType)*I.valuesPerElement*E}G=A.faceCount;if(z.faces&&G){D.faces={};for(var H of z.ordering)z.faces[H]&&(E=
{...z.faces[H],byteOffset:t,count:G},D.faces[H]=E,t+=u(E.valueType)*E.valuesPerElement*G)}H=A.featureCount;if(z.featureAttributes&&z.featureAttributeOrder&&H){D.featureAttributes={};for(const I of z.featureAttributeOrder)z.featureAttributes[I]&&(A={...z.featureAttributes[I],byteOffset:t,count:H},D.featureAttributes[I]=A,G="UInt64"===A.valueType?8:u(A.valueType),t+=G*A.valuesPerElement*H)}p(t,C.byteLength,"geometry");D.byteCount=t-D.byteOffset;return D};b.createRawView=f;b.createTypedView=e;b.getBytesPerValue=
u;b.isValueType=m;b.readBinaryAttribute=function(C,z,A){if("lepcc-rgb"===C.encoding)return l.decodeRGB(z);if("lepcc-intensity"===C.encoding)return l.decodeIntensity(z);if(null!=C.encoding&&""!==C.encoding)throw new r("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");C["attributeByteCounts "]&&!C.attributeByteCounts&&(v.warn("Warning: Trailing space in 'attributeByteCounts '."),C.attributeByteCounts=C["attributeByteCounts "]);"ObjectIds"===C.ordering[0]&&C.hasOwnProperty("objectIds")&&
(v.warn("Warning: Case error in objectIds"),C.ordering[0]="objectIds");A=g(z,C,A);p(A.byteOffset+A.byteCount,z.byteLength,"attribute");if(C=A.entries.attributeValues||A.entries.objectIds){if("String"===C.valueType){A=A.entries.attributeByteCounts;const t=e(z,A);z=f(z,C);return c(A.count,t,z)}return e(z,C)}throw new r("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};b.readHeader=d;b.readStringArray=c;b.valueType2ArrayBufferReader=x;b.valueType2TypedArrayClassMap=B;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(b,k){function a(d,c,e){return{identifier:String.fromCharCode.apply(null,new Uint8Array(d,e+h.identifierOffset,h.identifierLength)),version:c.getUint16(e+h.versionOffset,!0),checksum:c.getUint32(e+h.checksumOffset,!0)}}function r(d,c,e){const f=[];c=l(d,c,f);const g=[];for(let p=0;p<f.length;p++){g.length=0;c=l(d,c,g);for(let n=0;n<g.length;n++)e.push(g[n]+f[p])}return c}function l(d,
c,e){var f=new DataView(d,c),g=f.getUint8(0);const p=g&31;var n=!!(g&32),w=(g&192)>>6;g=0;if(0===w)g=f.getUint32(1,!0),c+=5;else if(1===w)g=f.getUint16(1,!0),c+=3;else if(2===w)g=f.getUint8(1),c+=2;else throw new k("lepcc-decode-error","Bad count type");if(n)throw new k("lepcc-decode-error","LUT not implemented");d=new Uint8Array(d,c,Math.ceil(g*p/8));w=n=f=0;const q=-1>>>32-p;for(let m=0;m<g;m++){for(;n<p;)f|=d[w]<<n,n+=8,w+=1;e[m]=f&q;f>>>=p;n-=p;32<n+p&&(f|=d[w-1]>>8-n)}return c+w}const h={identifierOffset:0,
identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};b.decodeIntensity=function(d){const c=new DataView(d,0);var e=0;const {identifier:f,version:g}=a(d,c,e);e+=h.byteCount;if("Intensity "!==f)throw new k("lepcc-decode-error","Bad identifier");if(1<g)throw new k("lepcc-decode-error","Unknown version");var p=e;var n=c.getUint32(p+0,!0);var w=c.getUint32(p+4,!0);var q=c.getUint32(p+8,!0);var m=c.getUint16(p+12,!0);var u=c.getUint8(p+14);c.getUint8(p+15);e+=16;if(w*Math.pow(2,32)+n!==
d.byteLength)throw new k("lepcc-decode-error","Bad size");n=new Uint16Array(q);if(8===u){if(q+e!==d.byteLength)throw new k("lepcc-decode-error","Bad size");d=new Uint8Array(d,e,q);for(e=0;e<q;e++)n[e]=d[e]*m}else if(16===u){if(2*q+e!==d.byteLength)throw new k("lepcc-decode-error","Bad size");d=new Uint16Array(d,e,q);for(e=0;e<q;e++)n[e]=d[e]*m}else{u=[];if(l(d,e,u)!==d.byteLength)throw new k("lepcc-decode-error","Bad size");for(d=0;d<q;d++)n[d]=u[d]*m}return n};b.decodeRGB=function(d){var c=new DataView(d,
0),e=0;const {identifier:f,version:g}=a(d,c,e);e+=h.byteCount;if("ClusterRGB"!==f)throw new k("lepcc-decode-error","Bad identifier");if(1<g)throw new k("lepcc-decode-error","Unknown version");var p=e;var n=c.getUint32(p+0,!0);var w=c.getUint32(p+4,!0);var q=c.getUint32(p+8,!0);var m=c.getUint16(p+12,!0);var u=c.getUint8(p+14);p=c.getUint8(p+15);e+=16;if(w*Math.pow(2,32)+n!==d.byteLength)throw new k("lepcc-decode-error","Bad size");if((2===u||1===u)&&0===p){if(3*m+q+e!==d.byteLength||256<m)throw new k("lepcc-decode-error",
"Bad count");c=new Uint8Array(d,e,3*m);e=new Uint8Array(d,e+3*m,q);d=new Uint8Array(3*q);for(m=0;m<q;m++)n=e[m],d[3*m]=c[3*n],d[3*m+1]=c[3*n+1],d[3*m+2]=c[3*n+2];return d}if(0===u&&0===p){if(3*q+e!==d.byteLength||0!==m)throw new k("lepcc-decode-error","Bad count");return(new Uint8Array(d,e)).slice()}if(2>=u&&1===p){if(e+3!==d.byteLength||1!==m)throw new k("lepcc-decode-error","Bad count");d=c.getUint8(e);m=c.getUint8(e+1);e=c.getUint8(e+2);c=new Uint8Array(3*q);for(n=0;n<q;n++)c[3*n]=d,c[3*n+1]=m,
c[3*n+2]=e;return c}throw new k("lepcc-decode-error","Bad method "+u+","+p);};b.decodeXYZ=function(d){var c=new DataView(d,0),e=0;const {identifier:f,version:g}=a(d,c,e);e+=h.byteCount;if("LEPCC     "!==f)throw new k("lepcc-decode-error","Bad identifier");if(1<g)throw new k("lepcc-decode-error","Unknown version");var p=e;var n=c.getUint32(p+0,!0);var w=c.getUint32(p+4,!0);var q=c.getFloat64(p+8,!0);var m=c.getFloat64(p+16,!0);var u=c.getFloat64(p+24,!0);var v=c.getFloat64(p+32,!0);var y=c.getFloat64(p+
40,!0);var B=c.getFloat64(p+48,!0);var x=c.getFloat64(p+56,!0);var C=c.getFloat64(p+64,!0);var z=c.getFloat64(p+72,!0);var A=c.getUint32(p+80,!0);c.getUint32(p+84,!0);e+=88;if(w*Math.pow(2,32)+n!==d.byteLength)throw new k("lepcc-decode-error","Bad size");n=new Float64Array(3*A);w=[];A=[];c=[];p=[];e=r(d,e,w);e=r(d,e,A);e=r(d,e,c);e=r(d,e,p);if(e!==d.byteLength)throw new k("lepcc-decode-error","Bad length");e=d=0;for(let t=0;t<w.length;t++){e+=w[t];let D=0;for(let E=0;E<A[t];E++){D+=c[d];const G=p[d];
n[3*d]=Math.min(v,q+2*x*D);n[3*d+1]=Math.min(y,m+2*C*e);n[3*d+2]=Math.min(B,u+2*z*G);d++}}return{errorX:x,errorY:C,errorZ:z,result:n}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/vec3f64","../../../../geometry/projectionEllipsoid","../../../../geometry/projection","../../../../chunks/mat4f64"],function(b,k,a,r,l){function h(d,c,e){const f=k.create(),g=2**(4*Math.ceil(Math.log(d[3])*Math.LOG2E/4)+
1);if(e.isGeographic){var p=g/a.getReferenceEllipsoid(e).radius*180/Math.PI;e=Math.max(-90,Math.min(90,Math.round(d[1]/p)*p));p/=Math.cos((Math.abs(e)-p/2)/180*Math.PI);f[0]=Math.round(d[0]/p)*p;f[1]=e}else e=Math.round(d[1]/g),f[0]=Math.round(d[0]/g)*g,f[1]=e*g;f[2]=Math.round((d[2]+c)/g)*g;return f}b.computeGlobalTransformation=function(d,c,e,f){d=h(d,c,e);c=l.create();r.computeLinearTransformation(e,d,c,f);return c};b.getLocalOrigin=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../support/WorkerHandle"],function(b,k,a,r){r=function(l){function h(d){return l.call(this,"PointCloudWorker","transform",d)||this}k._inheritsLoose(h,l);h.prototype.getTransferList=function(d){const c=[d.geometryBuffer];a.isSome(d.primaryAttributeData)&&d.primaryAttributeData.buffer&&c.push(d.primaryAttributeData.buffer);a.isSome(d.modulationAttributeData)&&d.modulationAttributeData.buffer&&c.push(d.modulationAttributeData.buffer);
if(a.isSome(d.filterAttributesData))for(const e of d.filterAttributesData)a.isSome(e)&&e.buffer&&c.push(e.buffer);for(const e of d.userAttributesData)e.buffer&&c.push(e.buffer);return c};return h}(r.WorkerHandle);b.PointCloudWorkerHandle=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec3"],function(b,k){function a(e,f,g){for(;0<e;){const p=f.indexOf(e);if(0<=p)return p;e=g.getParentId(e)}return f.indexOf(e)}
function r(e,f,g){const p=[f.remove[0]],n=[];for(;1===p.length;){const q=p.pop();n.length=0;for(let m=0;m<f.load.length;m++){let u=f.load[m];for(var w=g.getParentId(u);w!==q;)u=w,w=g.getParentId(u);w=p.indexOf(u);0>w&&(w=p.length,p.push(u),n.push([]));n[w].push(f.load[m])}}f.load=p;for(f=0;f<p.length;f++)1<n[f].length?e.push({remove:[p[f]],load:n[f]}):p[f]=n[f][0]}const l=[!1],h=[null],d=[!1],c=[null];b.nodeDiff=function(e,f,g){for(var p=0;p<f.length;p++)d[p]=!1,c[p]=null;for(p=0;p<e.length;p++)l[p]=
!1,h[p]=null;for(p=0;p<f.length;p++){var n=a(f[p],e,g);0<=n&&(d[p]=!0,null!=h[n]?h[n].push(f[p]):h[n]=[f[p]])}for(p=0;p<e.length;p++)n=a(e[p],f,g),0<=n&&(l[p]=!0,null!=c[n]?c[n].push(e[p]):c[n]=[e[p]]);g=[];for(p=0;p<e.length;p++)null!=h[p]||l[p]||g.push({load:[],remove:[e[p]]});for(p=0;p<f.length;p++)null!=c[p]||d[p]||g.push({load:[f[p]],remove:[]});for(p=0;p<f.length;p++)null!=c[p]&&(1<c[p].length||c[p][0]!==f[p])&&g.push({load:[f[p]],remove:c[p]});for(f=0;f<e.length;f++)null!=h[f]&&(1<h[f].length||
h[f][0]!==e[f])&&g.push({load:h[f],remove:[e[f]]});return g};b.sortFrontToBack=function(e,f,g){return e.sort((p,n)=>{if(0===p.load.length&&0===n.load.length)return 0;if(0===p.load.length)return-1;if(0===n.load.length)return 1;if(0===p.remove.length&&0===n.remove.length)return p=g.getRenderCenter(p.load[0]),n=g.getRenderCenter(n.load[0]),k.dot(p,f)-k.dot(n,f);if(0===p.remove.length)return-1;if(0===n.remove.length)return 1;if(1===p.load.length&&1===n.load.length)return p=g.getRenderCenter(p.load[0]),
n=g.getRenderCenter(n.load[0]),k.dot(p,f)-k.dot(n,f);if(1===p.load.length)return-1;if(1===n.load.length)return 1;p=g.getRenderCenter(p.remove[0]);n=g.getRenderCenter(n.remove[0]);return k.dot(p,f)-k.dot(n,f)})};b.splitWorkEntries=function(e,f,g){for(let p=0;p<e.length;++p){const n=e[p];n.load.length>f&&1===n.remove.length&&r(e,n,g)}};b.splitWorkEntry=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["../../../../geometry/support/aaBoundingBox",
"../../support/orientedBoundingBox","./I3SUtil"],function(b,k,a){return function(){function r(h,d,c){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=h;this._renderSR=d;this.pageSize=c}var l=r.prototype;l.addPage=function(h,d,c=0){for(;this._pages.length<h;)this._pages.push(null);var e=this._nodeSR,f=this._renderSR,g=new k.ObbArray(d.length);for(var p=0;p<d.length;p++)a.transformObb(d[p].obb,e,g.obbs[p],f,c);c=g.obbs;this._pages[h]={nodes:d,renderObbs:c,parents:new Uint32Array(this.pageSize)};
h=this._pages;d=this.pageSize;for(c=[0];c.length;)for(e=c.pop(),f=h[e/d|0].nodes[e%d],g=0;g<f.childCount;g++)p=f.firstChild+g,null!=h[p/d|0]&&(h[p/d|0].parents[p%d]=e,c.push(p))};l.hasPage=function(h){return!!this._pages[h]};l.getNode=function(h){const d=this.pageSize;return this._pages[h/d|0].nodes[h%d]};l.getRenderObb=function(h){const d=this.pageSize;return this._pages[h/d|0].renderObbs[h%d]};l.getRenderCenter=function(h){return this.getRenderObb(h).center};l.setRenderObb=function(h,d){const c=
this.pageSize;k.set(d,this._pages[h/c|0].renderObbs[h%c])};l.getParentId=function(h){const d=this.pageSize;return this._pages[h/d|0].parents[h%d]};l.hasNodes=function(h,d){var c=h/this.pageSize|0;for(h=(h+d-1)/this.pageSize|0;c<=h;c++)if(null==this._pages[c])return!1;return!0};l.forEachNodeId=function(h){for(let d=0;d<this._pages.length;d++){const c=this._pages[d];if(c)for(let e=0;e<c.nodes.length;e++)h(d*this.pageSize+e)}};l.createVisibilityTraverse=function(){var h=this,d=[],c=[],e=b.create();return(f,
g)=>{if(h.hasNodes(0,1))for(d.length=0,d.push(0),c.length=0,c.push(0);0<d.length;){var p=d.pop();let v=c.pop();var n=h.getNode(p),w=h.getRenderObb(p),q=!0;if(null!=f.clippingBox){var m=1<<f.frustumPlanes.length;if(0===(v&m)){var u=k.toAaBoundingBox(w,e);b.contains(f.clippingBox,u)?v|=m:b.intersects(f.clippingBox,u)||(q=!1)}}for(m=0;m<f.frustumPlanes.length&&q;m++)if(u=1<<m,0===(v&u)){const y=k.intersectPlane(w,f.frustumPlanes[m]);0<y?q=!1:0>y&&(v|=u)}if(g.predicate(p,n,q)){w=n.firstChild;n=n.childCount;
q=!1;u=w/h.pageSize|0;for(m=(w+n-1)/h.pageSize|0;u<=m;u++)if(!h.hasPage(u)){g.pageMiss(p,u);q=!0;break}if(!q)for(p=0;p<n;p++)d.push(w+p),c.push(v)}}}};return r}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(b){function k(r,l){for(const h of r)if(h.name===l&&null!=h.attributeValues&&"UInt8"===h.attributeValues.valueType&&3===h.attributeValues.valuesPerElement)return{name:l,storageInfo:h,useElevation:!1};return null}function a(r,l){for(const h of r)if(h.name===
l)return r="embedded-elevation"===h.encoding,{name:l,storageInfo:r?null:h,useElevation:r};return"elevation"===l.toLowerCase()?{name:l,storageInfo:null,useElevation:!0}:null}b.getAttributeInfo=a;b.getFilterInfo=function(r){const l=r.filters;return l?l.map(h=>({filterJSON:h.toJSON(),attributeInfo:a(r.attributeStorageInfo,h.field)})):[]};b.getFixedSizeAlgorithm=function(r){return(r=r&&r.pointSizeAlgorithm)&&"fixed-size"===r.type?r:null};b.getRendererInfo=function(r){const l=r.renderer;var h=l&&l.type;
const d=l&&r.renderer.toJSON()||null;let c=null,e=!1;"point-cloud-unique-value"===h?c=a(r.attributeStorageInfo,l.field):"point-cloud-stretch"===h?c=a(r.attributeStorageInfo,l.field):"point-cloud-class-breaks"===h?c=a(r.attributeStorageInfo,l.field):(c="point-cloud-rgb"===h?k(r.attributeStorageInfo,l.field):k(r.attributeStorageInfo,"RGB"),e=null!=c);h=null;l&&l.colorModulation&&(h=a(r.attributeStorageInfo,l.colorModulation.field));return{rendererJSON:d,isRGBRenderer:e,primaryAttribute:c,modulationAttribute:h}};
b.getSplatSizeAlgorithm=function(r){return(r=r&&r.pointSizeAlgorithm)&&"splat"===r.type?r:null};b.rendererUsesFixedSizes=function(r){return(r=r&&r.pointSizeAlgorithm)&&r.type?"fixed-size"===r.type:!1};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./LEPCC ./I3SBinaryReader".split(" "),
function(b,k,a,r,l,h,d){function c(g,p){const n=new Float64Array(p);for(let w=0;w<p;w++)n[w]=g[3*w+2];return n}function e(g){return null==g||"none"===g?null:"low-four-bit"===g?p=>p&15:"high-four-bit"===g?p=>(p&240)>>4:"absolute-value"===g?p=>Math.abs(p):"modulo-ten"===g?p=>p%10:null}function f(g){let p=0;for(const n of g?g:[])p|=1<<n;return p}b.elevationFromPositions=c;b.evaluateRenderer=function(g,p,n,w){const {rendererJSON:q,isRGBRenderer:m}=g;var u=g=null;if(p&&m)g=p;else if(p&&"pointCloudUniqueValueRenderer"===
q.type){u=l.fromJSON(q);var v=u.colorUniqueValueInfos;g=new Uint8Array(3*w);var y=e(u.fieldTransformType);for(var B=0;B<w;B++){var x=(y?y(p[B]):p[B])+"";for(var C=0;C<v.length;C++)if(0<=v[C].values.indexOf(x)){g[3*B]=v[C].color.r;g[3*B+1]=v[C].color.g;g[3*B+2]=v[C].color.b;break}}}else if(p&&"pointCloudStretchRenderer"===q.type)for(u=r.fromJSON(q),v=u.stops,g=new Uint8Array(3*w),y=e(u.fieldTransformType),B=0;B<w;B++)if(x=y?y(p[B]):p[B],C=v.length-1,x<v[0].value)g[3*B]=v[0].color.r,g[3*B+1]=v[0].color.g,
g[3*B+2]=v[0].color.b;else if(x>=v[C].value)g[3*B]=v[C].color.r,g[3*B+1]=v[C].color.g,g[3*B+2]=v[C].color.b;else for(C=1;C<v.length;C++){if(x<v[C].value){x=(x-v[C-1].value)/(v[C].value-v[C-1].value);g[3*B]=v[C].color.r*x+v[C-1].color.r*(1-x);g[3*B+1]=v[C].color.g*x+v[C-1].color.g*(1-x);g[3*B+2]=v[C].color.b*x+v[C-1].color.b*(1-x);break}}else if(p&&"pointCloudClassBreaksRenderer"===q.type)for(u=a.fromJSON(q),v=u.colorClassBreakInfos,g=new Uint8Array(3*w),y=e(u.fieldTransformType),B=0;B<w;B++)for(x=
y?y(p[B]):p[B],C=0;C<v.length;C++){if(x>=v[C].minValue&&x<=v[C].maxValue){g[3*B]=v[C].color.r;g[3*B+1]=v[C].color.g;g[3*B+2]=v[C].color.b;break}}else for(g=new Uint8Array(3*w),p=0;p<g.length;p++)g[p]=255;if(n&&u&&u.colorModulation)for(p=u.colorModulation.minValue,u=u.colorModulation.maxValue,v=0;v<w;v++)y=n[v],y=y>=u?1:y<=p?.3:.3+.7*(y-p)/(u-p),g[3*v]*=y,g[3*v+1]*=y,g[3*v+2]*=y;return g};b.filterInPlace=function(g,p,n,w,q){const m=g.length/3;let u=0;for(let z=0;z<m;z++){let A=!0;for(let t=0;t<w.length&&
A;t++){var {filterJSON:v}=w[t],y=q[t].values[z];switch(v.type){case "pointCloudValueFilter":var B="exclude"===v.mode;-1!==v.values.indexOf(y)===B&&(A=!1);break;case "pointCloudBitfieldFilter":B=f(v.requiredSetBits);v=f(v.requiredClearBits);if((y&B)!==B||0!==(y&v))A=!1;break;case "pointCloudReturnFilter":var x=y&15,C=y>>>4&15;y=1<C;B=1===x;x=x===C;C=!1;for(const D of v.includedReturns)if("last"===D&&x||"firstOfMany"===D&&B&&y||"lastOfMany"===D&&x&&y||"single"===D&&!y){C=!0;break}C||(A=!1)}}A&&(n[u]=
z,g[3*u]=g[3*z],g[3*u+1]=g[3*z+1],g[3*u+2]=g[3*z+2],p[3*u]=p[3*z],p[3*u+1]=p[3*z+1],p[3*u+2]=p[3*z+2],u++)}return u};b.getAttributeValues=function(g,p,n){return k.isSome(g)&&g.attributeInfo.useElevation?c(p,n):k.isSome(g)?d.readBinaryAttribute(g.attributeInfo.storageInfo,g.buffer,n):null};b.readGeometry=function(g,p){if(null==g.encoding||""===g.encoding){g=d.createGeometryIndexFromSchema(p,g);if(k.isNone(g.vertexAttributes.position))return;p=d.createTypedView(p,g.vertexAttributes.position);var n=
g.header.fields;g=[n.offsetX,n.offsetY,n.offsetZ];n=[n.scaleX,n.scaleY,n.scaleZ];const w=p.length/3,q=new Float64Array(3*w);for(let m=0;m<w;m++)q[3*m]=p[3*m]*n[0]+g[0],q[3*m+1]=p[3*m+1]*n[1]+g[1],q[3*m+2]=p[3*m+2]*n[2]+g[2];return q}if("lepcc-xyz"===g.encoding)return h.decodeXYZ(p).result};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){var m;a=m=function(u){function v(y){y=u.call(this,y)||this;y.type="point-cloud-class-breaks";y.field=null;y.legendOptions=null;y.fieldTransformType=null;y.colorClassBreakInfos=null;return y}b._inheritsLoose(v,u);v.prototype.clone=function(){return new m({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:r.clone(this.colorClassBreakInfos),legendOptions:r.clone(this.legendOptions)})};return v}(n);k.__decorate([c.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
a.prototype,"type",void 0);k.__decorate([d.property({json:{write:!0},type:String})],a.prototype,"field",void 0);k.__decorate([d.property({type:w["default"],json:{write:!0}})],a.prototype,"legendOptions",void 0);k.__decorate([d.property({type:n.fieldTransformTypeKebabDict.apiValues,json:{type:n.fieldTransformTypeKebabDict.jsonValues,read:n.fieldTransformTypeKebabDict.read,write:n.fieldTransformTypeKebabDict.write}})],a.prototype,"fieldTransformType",void 0);k.__decorate([d.property({type:[q["default"]],
json:{write:!0}})],a.prototype,"colorClassBreakInfos",void 0);return a=m=k.__decorate([e.subclass("esri.renderers.PointCloudClassBreaksRenderer")],a)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/JSONSupport ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){a=c.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});n=function(m){function u(y){y=m.call(this,y)||this;y.type=void 0;y.pointSizeAlgorithm=null;y.colorModulation=null;y.pointsPerInch=10;return y}b._inheritsLoose(u,m);var v=u.prototype;v.clone=function(){console.warn(".clone() is not implemented for "+
this.declaredClass);return null};v.cloneProperties=function(){return{pointSizeAlgorithm:r.clone(this.pointSizeAlgorithm),colorModulation:r.clone(this.colorModulation),pointsPerInch:r.clone(this.pointsPerInch)}};return u}(n.JSONSupport);k.__decorate([d.property({type:a.apiValues,readOnly:!0,nonNullable:!0,json:{type:a.jsonValues,read:!1,write:a.write}})],n.prototype,"type",void 0);k.__decorate([d.property({types:q.pointSizeAlgorithmTypes,json:{write:!0}})],n.prototype,"pointSizeAlgorithm",void 0);
k.__decorate([d.property({type:w["default"],json:{write:!0}})],n.prototype,"colorModulation",void 0);k.__decorate([d.property({json:{write:!0},nonNullable:!0,type:Number})],n.prototype,"pointsPerInch",void 0);n=k.__decorate([e.subclass("esri.renderers.PointCloudRenderer")],n);(n||(n={})).fieldTransformTypeKebabDict=new c.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return n})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){var w;b.ColorModulation=w=function(q){function m(){var u=q.apply(this,arguments)||this;u.field=null;u.minValue=0;u.maxValue=255;return u}k._inheritsLoose(m,q);m.prototype.clone=function(){return new w({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};return m}(n.JSONSupport);a.__decorate([d.property({type:String,json:{write:!0}})],b.ColorModulation.prototype,"field",void 0);a.__decorate([d.property({type:Number,nonNullable:!0,json:{write:!0}})],
b.ColorModulation.prototype,"minValue",void 0);a.__decorate([d.property({type:Number,nonNullable:!0,json:{write:!0}})],b.ColorModulation.prototype,"maxValue",void 0);b.ColorModulation=w=a.__decorate([e.subclass("esri.renderers.support.pointCloud.ColorModulation")],b.ColorModulation);b.default=b.ColorModulation;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm",
"./PointSizeSplatAlgorithm"],function(b,k,a,r){b.pointSizeAlgorithmTypes={key:"type",base:k["default"],typeMap:{"fixed-size":a["default"],splat:r["default"]}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){r=new c.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});b.PointSizeAlgorithm=function(w){function q(){return w.apply(this,arguments)||this}k._inheritsLoose(q,w);return q}(n.JSONSupport);a.__decorate([d.property({type:r.apiValues,readOnly:!0,nonNullable:!0,json:{type:r.jsonValues,read:!1,write:r.write}})],b.PointSizeAlgorithm.prototype,"type",void 0);b.PointSizeAlgorithm=a.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
b.PointSizeAlgorithm);b.default=b.PointSizeAlgorithm;b.typeKebabDictionary=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./PointSizeAlgorithm".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){var w;b.PointSizeFixedSizeAlgorithm=w=function(q){function m(){var u=q.apply(this,arguments)||this;u.type="fixed-size";u.size=0;u.useRealWorldSymbolSizes=null;return u}k._inheritsLoose(m,q);m.prototype.clone=function(){return new w({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};return m}(n["default"]);a.__decorate([c.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],b.PointSizeFixedSizeAlgorithm.prototype,"type",void 0);a.__decorate([d.property({type:Number,
nonNullable:!0,json:{write:!0}})],b.PointSizeFixedSizeAlgorithm.prototype,"size",void 0);a.__decorate([d.property({type:Boolean,json:{write:!0}})],b.PointSizeFixedSizeAlgorithm.prototype,"useRealWorldSymbolSizes",void 0);b.PointSizeFixedSizeAlgorithm=w=a.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],b.PointSizeFixedSizeAlgorithm);b.default=b.PointSizeFixedSizeAlgorithm;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ./PointSizeAlgorithm".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){var w;b.PointSizeSplatAlgorithm=w=function(q){function m(){var u=q.apply(this,arguments)||this;u.type="splat";u.scaleFactor=1;return u}k._inheritsLoose(m,q);m.prototype.clone=function(){return new w({scaleFactor:this.scaleFactor})};return m}(n["default"]);a.__decorate([c.enumeration({pointCloudSplatAlgorithm:"splat"})],b.PointSizeSplatAlgorithm.prototype,"type",void 0);a.__decorate([d.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],b.PointSizeSplatAlgorithm.prototype,
"scaleFactor",void 0);b.PointSizeSplatAlgorithm=w=a.__decorate([e.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],b.PointSizeSplatAlgorithm);b.default=b.PointSizeSplatAlgorithm;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ../../../Color".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){var m;b.ColorClassBreakInfo=m=function(u){function v(){var y=u.apply(this,arguments)||this;y.description=null;y.label=null;y.minValue=0;y.maxValue=0;y.color=null;return y}k._inheritsLoose(v,u);v.prototype.clone=function(){return new m({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:l.clone(this.color)})};return v}(w.JSONSupport);a.__decorate([c.property({type:String,json:{write:!0}})],b.ColorClassBreakInfo.prototype,
"description",void 0);a.__decorate([c.property({type:String,json:{write:!0}})],b.ColorClassBreakInfo.prototype,"label",void 0);a.__decorate([c.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],b.ColorClassBreakInfo.prototype,"minValue",void 0);a.__decorate([c.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],b.ColorClassBreakInfo.prototype,"maxValue",void 0);a.__decorate([c.property({type:q,json:{type:[d.Integer],
write:!0}})],b.ColorClassBreakInfo.prototype,"color",void 0);b.ColorClassBreakInfo=m=a.__decorate([f.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],b.ColorClassBreakInfo);b.default=b.ColorClassBreakInfo;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/StopInfo".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){var m;a=m=function(u){function v(y){y=u.call(this,y)||this;y.type="point-cloud-stretch";y.field=null;y.legendOptions=null;y.fieldTransformType=null;y.stops=null;return y}b._inheritsLoose(v,u);v.prototype.clone=function(){return new m({...this.cloneProperties(),field:r.clone(this.field),fieldTransformType:r.clone(this.fieldTransformType),stops:r.clone(this.stops),legendOptions:r.clone(this.legendOptions)})};return v}(n);k.__decorate([c.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],
a.prototype,"type",void 0);k.__decorate([d.property({json:{write:!0},type:String})],a.prototype,"field",void 0);k.__decorate([d.property({type:w["default"],json:{write:!0}})],a.prototype,"legendOptions",void 0);k.__decorate([d.property({type:n.fieldTransformTypeKebabDict.apiValues,json:{type:n.fieldTransformTypeKebabDict.jsonValues,read:n.fieldTransformTypeKebabDict.read,write:n.fieldTransformTypeKebabDict.write}})],a.prototype,"fieldTransformType",void 0);k.__decorate([d.property({type:[q["default"]],
json:{write:!0}})],a.prototype,"stops",void 0);return a=m=k.__decorate([e.subclass("esri.renderers.PointCloudStretchRenderer")],a)})},"esri/renderers/support/pointCloud/StopInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ../../../Color".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){var m;b.StopInfo=m=function(u){function v(){var y=u.apply(this,arguments)||this;y.label=null;y.value=0;y.color=null;return y}k._inheritsLoose(v,u);v.prototype.clone=function(){return new m({label:this.label,value:this.value,color:l.clone(this.color)})};return v}(w.JSONSupport);a.__decorate([c.property({type:String,json:{write:!0}})],b.StopInfo.prototype,"label",void 0);a.__decorate([c.property({type:Number,nonNullable:!0,json:{write:!0}})],b.StopInfo.prototype,
"value",void 0);a.__decorate([c.property({type:q,json:{type:[d.Integer],write:!0}})],b.StopInfo.prototype,"color",void 0);b.StopInfo=m=a.__decorate([f.subclass("esri.renderers.support.pointCloud.StopInfo")],b.StopInfo);b.default=b.StopInfo;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){var m;a=m=function(u){function v(y){y=u.call(this,y)||this;y.type="point-cloud-unique-value";y.field=null;y.fieldTransformType=null;y.colorUniqueValueInfos=null;y.legendOptions=null;return y}b._inheritsLoose(v,u);v.prototype.clone=function(){return new m({...this.cloneProperties(),field:r.clone(this.field),fieldTransformType:r.clone(this.fieldTransformType),colorUniqueValueInfos:r.clone(this.colorUniqueValueInfos),legendOptions:r.clone(this.legendOptions)})};
return v}(n);k.__decorate([c.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],a.prototype,"type",void 0);k.__decorate([d.property({json:{write:!0},type:String})],a.prototype,"field",void 0);k.__decorate([d.property({type:n.fieldTransformTypeKebabDict.apiValues,json:{type:n.fieldTransformTypeKebabDict.jsonValues,read:n.fieldTransformTypeKebabDict.read,write:n.fieldTransformTypeKebabDict.write}})],a.prototype,"fieldTransformType",void 0);k.__decorate([d.property({type:[q["default"]],
json:{write:!0}})],a.prototype,"colorUniqueValueInfos",void 0);k.__decorate([d.property({type:w["default"],json:{write:!0}})],a.prototype,"legendOptions",void 0);return a=m=k.__decorate([e.subclass("esri.renderers.PointCloudUniqueValueRenderer")],a)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/lang ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/JSONSupport ../../../Color".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q){var m;b.ColorUniqueValueInfo=m=function(u){function v(){var y=u.apply(this,arguments)||this;y.description=null;y.label=null;y.values=null;y.color=null;return y}k._inheritsLoose(v,u);v.prototype.clone=function(){return new m({description:this.description,label:this.label,values:l.clone(this.values),color:l.clone(this.color)})};return v}(w.JSONSupport);a.__decorate([c.property({type:String,json:{write:!0}})],b.ColorUniqueValueInfo.prototype,"description",void 0);
a.__decorate([c.property({type:String,json:{write:!0}})],b.ColorUniqueValueInfo.prototype,"label",void 0);a.__decorate([c.property({type:[String],json:{write:!0}})],b.ColorUniqueValueInfo.prototype,"values",void 0);a.__decorate([c.property({type:q,json:{type:[d.Integer],write:!0}})],b.ColorUniqueValueInfo.prototype,"color",void 0);b.ColorUniqueValueInfo=m=a.__decorate([f.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],b.ColorUniqueValueInfo);b.default=b.ColorUniqueValueInfo;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../Graphic".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){var w;b.PointGraphic=w=function(q){function m(v){return q.call(this,v)||this}k._inheritsLoose(m,q);var u=m.prototype;u.clone=function(){return new w(this.cloneProperties())};u.cloneProperties=function(){const {pointCloudMetadata:v}=this;return{...q.prototype.cloneProperties.call(this),pointCloudMetadata:v}};return m}(n);a.__decorate([d.property({constructOnly:!0})],b.PointGraphic.prototype,"pointCloudMetadata",void 0);b.PointGraphic=w=a.__decorate([e.subclass("esri.views.3d.layers.i3s.PointGraphic")],
b.PointGraphic);Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../../../chunks/mat4f32 ../../../../chunks/vec3f32 ../../support/geometryUtils ../../../webgl/BufferObject ../../../webgl/VertexArrayObject ../../webgl-engine/lib/intersectorUtils ../../webgl-engine/core/shaderLibrary/Slice.glsl ../../webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../../support/orientedBoundingBox ./PointHighlights ../../webgl-engine/shaders/PointRendererTechnique".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x){function C(D,E,G,H,I){if(G.drawScreenSpace)return G.fixedSize*E*H;I=(I?256:64)*E*H;return G.drawFixedSize?Math.min(G.fixedSize/2,I):0<G.screenMinSize?Math.min(Math.max(G.screenMinSize*E*H,D/2),I):Math.min(D/2,I)}function z(D){return a.isSome(D.component)?D.component:-1}function A(D,E){if(a.isNone(D))return D;D=D.filter(G=>G.id!==E);return 0===D.length?null:D}const t={positions:[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}],
colors:[{name:"color",count:3,type:5121,offset:0,stride:3,normalized:!0}]};b.PointRenderer=function(){function D(G){this._params=G;this.type="Point";this.isGround=!1;this._bindParameters={inverseViewport:[0,0],highlightDepthTexture:null};this._highlights=new B.PointHighlights({forEachNode:H=>this.forEachNode(H),addHighlight:(H,I,J)=>this.addHighlight(H,I,J),removeHighlight:(H,I)=>this.removeHighlight(H,I)});this.canRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=
0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=e.create(e.POSITIVE_INFINITY);this._techniqueConfig=new x.PointRendererTechniqueConfiguration;this.tempMatrix4=g.create();this.tempVec3=p.create();this.nodes=[]}var E=D.prototype;E.initializeRenderContext=function(G){this._initContext=G;this._techniqueRep=this._initContext.shaderTechniqueRep;G.requestRender()};E.uninitializeRenderContext=function(){};E.intersect=function(G,H,I,J){var K=r.create();
const L=r.create(),S=r.create(),M=r.create(),T=n.plane.create(),O=G.camera.perScreenPixelRatio/2,Q=G.camera.near,F=this._getSizeParams();l.subtract(L,J,I);const N=1/l.length(L);l.scale(L,L,N);l.negate(S,L);c.set(T,L[0],L[1],L[2],-l.dot(L,I));let P=function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""};var U=new P;const V=new P;var W=[];const X=e.create(),ca=e.create(this._clipBox);e.offset(ca,-I[0],-I[1],-I[2],ca);for(const Y of this.nodes){const Z=Y.splatSize*this._scaleFactor;
var R=y.minimumDistancePlane(Y.obb,T),aa=y.maximumDistancePlane(Y.obb,T);R-=F.drawScreenSpace?0:C(Z,R+Q,F,O,Y.isLeaf);aa-=F.drawScreenSpace?0:C(Z,aa+Q,F,O,Y.isLeaf);R=null!=U.dist&&null!=V.dist&&U.dist<R*N&&V.dist>aa*N;if(0>aa||R)continue;aa=C(Z,aa+Q,F,O,Y.isLeaf);if(!y.intersectLine(Y.obb,I,L,aa))continue;aa*=aa;y.toAaBoundingBox(Y.obb,X);e.offset(X,-I[0],-I[1],-I[2],X);R=!e.contains(ca,X);l.subtract(M,Y.origin,I);const ba=Y.coordinates.length/3;for(let ia=0;ia<ba;ia++){K[0]=M[0]+Y.coordinates[3*
ia];K[1]=M[1]+Y.coordinates[3*ia+1];K[2]=M[2]+Y.coordinates[3*ia+2];if(R&&!e.containsPoint(ca,K))continue;var ka=l.dot(K,L),da=l.squaredLength(K)-ka*ka;if(da>aa)continue;var fa=ka+Q;const ja=F.drawScreenSpace?0:C(Z,fa,F,O,Y.isLeaf);if(0>ka-ja)continue;fa-=ja;fa=C(Z,fa,F,O,Y.isLeaf);if(da>fa*fa)continue;const la=(ka-ja)*N;ka=qa=>{var na=Y,oa=ia,ua=qa.point;null==ua&&(ua=r.create());ua[0]=na.origin[0]+na.coordinates[3*oa];ua[1]=na.origin[1]+na.coordinates[3*oa+1];ua[2]=na.origin[2]+na.coordinates[3*
oa+2];qa.point=ua;qa.dist=la;qa.normal=S;qa.node=Y;qa.pointId=ia;qa.layerUid=this.layerUid};(null==U.dist||la<U.dist)&&(null==H||H(I,J,la))&&ka(U);0!==G.options.store&&(null==V.dist||la>V.dist)&&(null==H||H(I,J,la))&&ka(V);2!==G.options.store||null!=H&&!H(I,J,la)||(da=new P,ka(da),W.push(da))}}const ea=Y=>{const {layerUid:Z,node:ba,pointId:ia}=Y;return{type:"external",point:Y.point,metadata:{layerUid:Z,createGraphic:()=>this._params.createGraphic(ba,ia,Y.point)}}};H=(Y,Z)=>{const ba=ea(Z);Y.set(ba,
`${Z.layerUid}/${Z.node.id}/${Z.pointId}`,Z.dist,Z.normal,d.IDENTITY,void 0);Y.intersector="PointRenderer"};null!=U.dist&&(K=G.results.min,(null==K.dist||U.dist<K.dist)&&H(K,U));null!=V.dist&&0!==G.options.store&&(U=G.results.max,(null==U.dist||V.dist>U.dist)&&H(U,V));if(2===G.options.store){I=n.ray.fromPoints(I,J);for(const Y of W)W=new m.IntersectorResult(I),H(W,Y),G.results.all.push(W)}};E.render=function(G){if(0!==G.pass&&2!==G.pass&&5!==G.pass)return!1;var H=2===G.pass;const I=G.rctx;for(var J of this.nodes)null==
J.vao&&this._initNode(G,J);J=this._getSizeParams();const K=this.selectTechnique(G,J),L=K.program;if(null==L||0===this.nodes.length)return!0;const S=this._clipBox,M=!e.equals(S,e.POSITIVE_INFINITY,(O,Q)=>O===Q);M||(l.set(this.tempVec3,-Infinity,-Infinity,-Infinity),L.setUniform3fv("uClipMin",this.tempVec3),l.set(this.tempVec3,Infinity,Infinity,Infinity),L.setUniform3fv("uClipMax",this.tempVec3));I.bindProgram(L);K.bindPipelineState(I);L.setUniformMatrix4fv("uProjectionMatrix",G.camera.projectionMatrix);
H&&L.setUniform2f("nearFar",G.camera.near,G.camera.far);G.isHighlightPass&&(this._bindParameters.inverseViewport[0]=1/G.camera.fullViewport[2],this._bindParameters.inverseViewport[1]=1/G.camera.fullViewport[3],this._bindParameters.highlightDepthTexture=G.highlightDepthTexture,v.OutputHighlight.bindOutputHighlight(I,L,this._bindParameters));H=G.camera.pixelRatio;J.drawFixedSize&&L.setUniform2f("uPointScale",J.fixedSize*H,G.camera.fullHeight);const T=this._slicePlaneEnabled?G.sliceHelper&&G.sliceHelper.plane:
null;for(const O of this.nodes){if(0===O.coordinates.length)continue;if(G.isHighlightPass&&!O.highlights)continue;L.setUniform2f("uScreenMinMaxSize",J.screenMinSize*H,(O.isLeaf?256:64)*H);J.drawFixedSize||L.setUniform2f("uPointScale",O.splatSize*this._scaleFactor*H,G.camera.fullHeight/H);const Q=O.origin;M&&(l.set(this.tempVec3,S[0]-Q[0],S[1]-Q[1],S[2]-Q[2]),L.setUniform3fv("uClipMin",this.tempVec3),l.set(this.tempVec3,S[3]-Q[0],S[4]-Q[1],S[5]-Q[2]),L.setUniform3fv("uClipMax",this.tempVec3));h.identity(this.tempMatrix4);
h.translate(this.tempMatrix4,this.tempMatrix4,Q);h.multiply(this.tempMatrix4,G.camera.viewMatrix,this.tempMatrix4);L.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4);u.Slice.bindUniforms(L,K.configuration,T,Q);I.bindVAO(O.vao);G.isHighlightPass?this._renderHighlightFragments(I,O):I.drawArrays(0,0,O.coordinates.length/3)}return!0};E._renderHighlightFragments=function(G,H){var I=H.highlights;if(!a.isNone(I)){H=a.unwrap(I[0].component);var J=H+1;for(let K=1;K<I.length;K++){const L=a.unwrap(I[K].component);
L!==J&&(J-=H,0<J&&G.drawArrays(0,H,J),H=L);J=L+1}I=J-H;0<I&&G.drawArrays(0,H,I)}};E.addNode=function(G){this.nodes.push(G);this._highlights.nodeAdded(G);this._requestRender()};E.removeNode=function(G){let H=null;this.nodes=this.nodes.filter(I=>I.id===G?(H=I,I.vao&&(I.vao.dispose(!0),I.vao=null),this._highlights.nodeRemoved(I),!1):!0);this._requestRender();return H};E.forEachNode=function(G){this.nodes.forEach(G)};E.removeAll=function(){this.nodes.forEach(G=>{G.vao&&(G.vao.dispose(!0),G.vao=null)});
this._highlights.removeAll();this.nodes=[];this._requestRender()};E.highlight=function(G){return this._highlights.add(G)};E.addHighlight=function(G,H,I){var J=G.highlights;a.isNone(J)&&(J=[]);H={component:H,id:I};J.push(H);H=z(H);for(I=J.length-1;0<I&&H<z(J[I-1]);)[J[I-1],J[I]]=[J[I],J[I-1]],--I;G.highlights=J;this._requestRender()};E.removeHighlight=function(G,H){G.highlights=A(G.highlights,H);this._requestRender()};E._initNode=function(G,H){G=G.rctx;H.vao=new q(G,f.Default3D,t,{positions:w.createVertex(G,
35044,H.coordinates),colors:w.createVertex(G,35044,H.rgb)})};E._requestRender=function(){this._initContext&&this._initContext.requestRender()};E._getSizeParams=function(){const G=this._useFixedSizes,H=G&&!this._useRealWorldSymbolSizes,I=H?this._sizePx:this._size;let J=this._minSizePx;G&&(J=0);return{drawScreenSpace:H,drawFixedSize:G,fixedSize:I,screenMinSize:J}};E.selectTechnique=function(G,H){this._techniqueConfig.drawScreenSize=H.drawScreenSpace;this._techniqueConfig.slicePlaneEnabled=this._slicePlaneEnabled;
this._techniqueConfig.sceneHasOcludees=G.hasOccludees;this._techniqueConfig.output=2===G.pass?1:5===G.pass?4:0;return this._techniqueRep.acquireAndReleaseExisting(x.PointRendererTechnique,this._techniqueConfig,this._technique)};k._createClass(D,[{key:"needsHighlight",get:function(){return this._highlights.hasHighlights}},{key:"useFixedSizes",set:function(G){this._useFixedSizes!==G&&(this._useFixedSizes=G,this._requestRender())},get:function(){return this._useFixedSizes}},{key:"scaleFactor",set:function(G){this._scaleFactor!==
G&&(this._scaleFactor=G,this._requestRender())},get:function(){return this._scaleFactor}},{key:"minSizePx",set:function(G){this._minSizePx!==G&&(this._minSizePx=G,this._requestRender())},get:function(){return this._minSizePx}},{key:"useRealWorldSymbolSizes",set:function(G){this._useRealWorldSymbolSizes!==G&&(this._useRealWorldSymbolSizes=G,this._requestRender())},get:function(){return this._useRealWorldSymbolSizes}},{key:"size",set:function(G){this._size!==G&&(this._size=G,this._requestRender())},
get:function(){return this._size}},{key:"sizePx",set:function(G){this._sizePx!==G&&(this._sizePx=G,this._requestRender())},get:function(){return this._sizePx}},{key:"clippingBox",set:function(G){e.set(this._clipBox,G||e.POSITIVE_INFINITY)}},{key:"slicePlane",get:function(){return this._slicePlaneEnabled},set:function(G){this._slicePlaneEnabled!==G&&(this._slicePlaneEnabled=G,this._requestRender())}},{key:"intersectionHandlerId",get:function(){return this.layerUid}}]);return D}();(function(D){D.isInstanceOfNode=
function(E){return E.hasOwnProperty("splatSize")}})(b.PointRenderer||(b.PointRenderer={}));Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/handleUtils","../../webgl-engine/lib/Object3DStateSet"],function(b,k,a,r,l){let h=function(){function c(f){this.context=f;this.highlights=new Set}var e=c.prototype;e.destroy=function(){this.highlights=
null};e.add=function(f){const g=new d(f);this.highlights.add(g);this.enableSet(g);return r.makeHandle(()=>this.removeSet(g))};e.removeSet=function(f){this.disableSet(f);this.highlights.delete(f)};e.enableSet=function(f){f.enabled||(f.enabled=!0,this.context.forEachNode(g=>this.enableSetForNode(f,g)))};e.enableSetForNode=function(f,g){if(f.enabled){var p=f.ids.get(g.id);p&&p.forEach(n=>this.context.addHighlight(g,n,f.id))}};e.disableSet=function(f){f.enabled&&(f.enabled=!1,this.context.forEachNode(g=>
this.disableSetForNode(f,g)))};e.disableSetForNode=function(f,g){f.enabled||this.context.removeHighlight(g,f.id)};e.nodeAdded=function(f){this.highlights.forEach(g=>this.enableSetForNode(g,f))};e.nodeRemoved=function(f){this.highlights.forEach(g=>this.disableSetForNode(g,f))};e.removeAll=function(){this.highlights.forEach(f=>this.disableSet(f))};k._createClass(c,[{key:"hasHighlights",get:function(){return 0<this.highlights.size}}]);return c}(),d=function(){function c(e){this.id=l.generateObject3DStateId(0);
this.ids=new Map;this.enabled=!1;for(const f of e)a.isSome(f)&&this.add(f.nodeId,f.pointId)}c.prototype.add=function(e,f){const g=this.ids.get(e);g?g.add(f):this.ids.set(e,new Set([f]))};return c}();b.PointHighlights=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../../../webgl/Program ../../../webgl/renderState ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p){h=function(n){function w(m,u){return n.call(this,m,u)||this}a._inheritsLoose(w,n);var q=w.prototype;q.initializeProgram=function(m){var u=w.shader.get();const v=this.configuration;u=u.build({output:v.output,slicePlaneEnabled:v.slicePlaneEnabled,sliceHighlightDisabled:!1,sliceEnabledForVertexPrograms:!0,drawScreenSize:v.drawScreenSize});return new e(m.rctx,u.generateSource("vertex"),u.generateSource("fragment"),c.Default3D)};q.initializePipeline=function(){return f.makePipelineState({depthTest:{func:513},
depthWrite:f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams,stencilWrite:this.configuration.sceneHasOcludees?g.stencilWriteMaskOn:null,stencilTest:this.configuration.sceneHasOcludees?g.stencilBaseAllZerosParams:null})};return w}(h.ShaderTechnique);h.shader=new l.ReloadableShaderModule(p.PointRendererShader,()=>new Promise(function(n,w){b(["./PointRenderer.glsl"],n,w)}));l=function(n){function w(){var q=n.apply(this,arguments)||this;q.output=0;q.slicePlaneEnabled=!1;q.drawScreenSize=
!1;q.sceneHasOcludees=!1;return q}a._inheritsLoose(w,n);return w}(d.ShaderTechniqueConfiguration);r.__decorate([d.parameter({count:8})],l.prototype,"output",void 0);r.__decorate([d.parameter()],l.prototype,"slicePlaneEnabled",void 0);r.__decorate([d.parameter()],l.prototype,"drawScreenSize",void 0);r.__decorate([d.parameter()],l.prototype,"sceneHasOcludees",void 0);k.PointRendererTechnique=h;k.PointRendererTechniqueConfiguration=l;Object.defineProperty(k,"__esModule",{value:!0})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl".split(" "),
function(b,k,a,r,l,h){function d(e){const f=new a.ShaderBuilder,g=0===e.output,p=1===e.output,n=4===e.output;f.extensions.add("GL_OES_standard_derivatives");f.include(r.Slice,e);f.attributes.add("position","vec3");f.attributes.add("color","vec3");f.vertex.uniforms.add("uModelViewMatrix","mat4").add("uProjectionMatrix","mat4").add("uScreenMinMaxSize","vec2").add("uPointScale","vec2").add("uClipMin","vec3").add("uClipMax","vec3");p?(f.vertex.uniforms.add("nearFar","vec2"),f.varyings.add("depth","float")):
4!==e.output&&f.varyings.add("vColor","vec3");f.vertex.code.add(k.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < uClipMin.x || position.y < uClipMin.y || position.z < uClipMin.z ||
        position.x > uClipMax.x || position.y > uClipMax.y || position.z > uClipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = uModelViewMatrix * vec4(position, 1.0);

      float pointSize = uPointScale.x;
      vec4 position = uProjectionMatrix * camera;
     ${e.drawScreenSize?k.glsl`
      float clampedScreenSize = pointSize;`:k.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = uProjectionMatrix * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = uPointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = uProjectionMatrix * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${p?k.glsl`depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);`:""}
     ${g?k.glsl`vColor = color;`:""}
    }
  `);f.fragment.include(h.RgbaFloatEncoding,e);n&&f.include(l.OutputHighlight);f.fragment.code.add(k.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${p?k.glsl`gl_FragColor = float2rgba(depth);`:""}
      ${n?k.glsl`outputHighlight();`:""}
      ${g?k.glsl`gl_FragColor = vec4(vColor, 1.0);`:""}
    }
  `);return f}var c=Object.freeze({__proto__:null,build:d});b.PointRendererShader=c;b.build=d})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/Error ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/promiseUtils ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u){b.PopupSceneLayerView=v=>{v=function(y){function B(){return y.apply(this,arguments)||this}k._inheritsLoose(B,y);var x=B.prototype;x._validateFetchPopupFeatures=function(C){const {layer:z}=this,{popupEnabled:A}=z;if(!A)return new g("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:z});if(!u.getFetchPopupTemplate(z,C))return new g("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:z})};x.prepareFetchPopupFeatures=
async function(C){};x.fetchPopupFeatures=async function(C,z){if(C=this._validateFetchPopupFeatures(z))return q.reject(C);C=l.isSome(z)?z.clientGraphics:null;if(!C||0===C.length)return q.resolve([]);const A=[],t=[];var D="scene"===this.layer.type&&l.isSome(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer;z=m.unpackFieldNames(this.layer.fields,await u.getRequiredFields(D,u.getFetchPopupTemplate(this.layer,z)));await this.prepareFetchPopupFeatures(z);D=new Set;for(const E of C)m.populateMissingFields(z,
E,D)?t.push(E):A.push(E);return 0===t.length?q.resolve(A):this.whenGraphicAttributes(t,[...D]).catch(()=>t).then(E=>A.concat(E))};return B}(v);return v=a.__decorate([f.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],v)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../layers/support/fieldUtils ../../../Graphic ../../support/Scheduler ../../../tasks/support/Query ./LayerView3D ./support/layerViewUpdatingProperties ../../layers/support/FeatureFilter ../../layers/SceneLayerView ./i3s/I3SUtil ./i3s/I3SGeometryUtil ./I3SMeshView3D ./i3s/I3SMeshViewFilter ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./support/DefinitionExpressionSceneLayerView ./support/PopupSceneLayerView ./i3s/attributeEditing ./support/fieldProperties".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K){const L=l.getLogger("esri.views.3d.layers.SceneLayerView3D");a=K.defineFieldProperties();v=function(S){function M(){var O=S.apply(this,arguments)||this;O.requiredFields=[];O.lodFactor=1;O.progressiveLoadFactor=1;O._elevationContext="scene";O._isIntegratedMesh=!1;O._supportsLabeling=!0;O._queryEngine=null;return O}b._inheritsLoose(M,S);var T=M.prototype;T.initialize=function(){for(const O of["layer.renderer","layer.labelingInfo",
"layer.labelsVisible","definitionExpressionFields","filter"])this.updatingHandles.add(this,O,()=>this.updatingHandles.addPromise(this._updateRequiredFields()));this._updateRequiredFields();this.updatingHandles.add(this.layer,"rangeInfos",O=>this._rangeInfosChanged(O),2);this.updatingHandles.add(this.layer,"renderer",O=>this.updatingHandles.addPromise(this._rendererChange(O)),2);for(const O of["parsedDefinitionExpression","filter","viewFilter.parsedWhereClause","viewFilter.parsedGeometry","viewFilter.sortedObjectIds"])this.updatingHandles.add(this,
O,()=>this._filterChange());this.handles.add(this.layer.on("apply-edits",O=>this.updatingHandles.addPromise(O.result)));this.handles.add(this.layer.on("edits",O=>this._handleEdits(O)))};T.destroy=function(){};T._updateRequiredFields=async function(){const {layer:O,layer:{fields:Q,renderer:F,labelsVisible:N},definitionExpressionFields:P}=this,U=new Set,V=await n.eachAlways([F?F.collectRequiredFields(U,Q):null,N?w.collectLabelingFields(U,O):null,r.isSome(this.filter)?w.collectFilterFields(U,O,this.filter):
null]);for(const W of V)W.error&&L.error(W.error);w.collectFields(U,Q,P);this._set("requiredFields",Array.from(U).sort())};T._rangeInfosChanged=function(O){null!=O&&0<O.length&&L.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};T.createQuery=function(){const O={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return r.isSome(this.filter)?this.filter.createQuery(O):new u(O)};T.queryExtent=function(O,
Q){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(O),null==Q?void 0:Q.signal)};T.queryFeatureCount=function(O,Q){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(O),null==Q?void 0:Q.signal)};T.queryFeatures=function(O,Q){return this._ensureQueryEngine().executeQuery(this._ensureQuery(O),null==Q?void 0:Q.signal).then(F=>{if(null==F||!F.features)return F;const N=this.layer;for(const P of F.features)P.layer=N,P.sourceLayer=N;return F})};T.queryObjectIds=
function(O,Q){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(O),null==Q?void 0:Q.signal)};T._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};T._createQueryEngine=function(){const O=z.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);return new D["default"]({layerView:this,task:m.Task.FEATURE_QUERY_ENGINE,spatialIndex:new G["default"]({featureAdapter:new E.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,
attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:O}),forAllFeatures:(Q,F)=>this._forAllFeatures((N,P,U)=>Q({id:N,index:P,meta:U}),F,2),getFeatureExtent:O,sourceSpatialReference:C.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};T.highlight=function(O){const Q=this._highlights;if(O instanceof u){const {set:F,handle:N}=Q.acquireSet();this.queryObjectIds(O).then(P=>Q.setFeatureIds(F,P));return N}return S.prototype.highlight.call(this,O)};T.createInteractiveEditSession=
function(O){return J.createInteractiveEditSession(this.attributeEditingContext,O)};T._createLayerGraphic=function(O){O=new q(null,null,O);O.layer=this.layer;O.sourceLayer=this.layer;return O};T.canResume=function(){return S.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};T.getFilters=function(){const O=S.prototype.getFilters.call(this);this.addSqlFilter(O,this.parsedDefinitionExpression,this.logError);r.isSome(this.viewFilter)&&this.viewFilter.addFilters(O,this.view,
this._controller.crsIndex,this._collection);return O};T._ensureQuery=function(O){return this._addDefinitionExpressionToQuery(r.isNone(O)?this.createQuery():u.from(O))};T._handleEdits=function(O){J.processAttributeEdits(this.attributeEditingContext,O)};b._createClass(M,[{key:"filter",get:function(){return r.isSome(this.viewFilter)?this.viewFilter.filter:null},set:function(O){r.isNone(O)||!t.I3SMeshViewFilter.checkSupport(O)?this.viewFilter=null:r.isSome(this.viewFilter)?this.viewFilter.filter=O:this.viewFilter=
new t.I3SMeshViewFilter({filter:O,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:Q=>this._loadAsyncModule(Q),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(Q,F)=>this.addSqlFilter(Q,F,this.logError)})}},{key:"lodCrossfadeinDuration",get:function(){var O,Q;return null!=(O=null==(Q=this.view)?void 0:Q.qualitySettings.sceneService["3dObject"].lodCrossfadeinDuration)?O:0}},{key:"lodCrossfadeoutDuration",get:function(){var O,Q;return null!=(O=null==(Q=this.view)?void 0:Q.qualitySettings.sceneService["3dObject"].lodCrossfadeoutDuration)?
O:0}},{key:"lodCrossfadeUncoveredDuration",get:function(){var O,Q;return null!=(O=null==(Q=this.view)?void 0:Q.qualitySettings.sceneService["3dObject"].lodCrossfadeUncoveredDuration)?O:0}},{key:"attributeEditingContext",get:function(){return{fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:O=>this._forAllNodes(Q=>r.isSome(Q)?O(Q.node,Q.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this.attributeOverrides,getAttributeData:O=>
this.getAttributeData(O),setAttributeData:(O,Q)=>this.setAttributeData(O,Q),clearMemCache:()=>this.clearMemCache()}}}]);return M}(A.I3SMeshView3D(H.DefinitionExpressionSceneLayerView(I.PopupSceneLayerView(v.LayerView3D(x)))));k.__decorate([d.property()],v.prototype,"layer",void 0);k.__decorate([d.property({aliasOf:"layer"})],v.prototype,"i3slayer",void 0);k.__decorate([d.property({dependsOn:["_controller.rootNodeVisible"]})],v.prototype,"suspended",void 0);k.__decorate([d.property(y.updatingProgress)],
v.prototype,"updatingProgress",void 0);k.__decorate([d.property({type:B})],v.prototype,"filter",null);k.__decorate([d.property()],v.prototype,"viewFilter",void 0);k.__decorate([d.property(a.requiredFields)],v.prototype,"requiredFields",void 0);k.__decorate([d.property(a.availableFields)],v.prototype,"availableFields",void 0);k.__decorate([d.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],v.prototype,"lodFactor",void 0);k.__decorate([d.property({readOnly:!0,
aliasOf:"_controller.updatingProgress"})],v.prototype,"updatingProgressValue",void 0);return v=k.__decorate([e.subclass("esri.views.3d.layers.SceneLayerView3D")],v)})},"esri/views/layers/SceneLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/extensions/serializableProperty/reader ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ./LayerView".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p){a=function(n){function w(){var m=n.apply(this,arguments)||this;m.filter=null;return m}b._inheritsLoose(w,n);var q=w.prototype;q.highlight=function(m){throw Error("Not implemented");};q.queryFeatures=function(m,u){throw Error("Not implemented");};q.queryObjectIds=function(m,u){throw Error("Not implemented");};q.queryFeatureCount=function(m,u){throw Error("Not implemented");};q.createQuery=function(){throw Error("Not implemented");};q.queryExtent=function(m,u){throw Error("Not implemented");
};b._createClass(w,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(m){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return w}(p);k.__decorate([h.property()],a.prototype,"availableFields",null);k.__decorate([h.property()],a.prototype,"maximumNumberOfFeatures",null);k.__decorate([h.property({readOnly:!0})],a.prototype,"maximumNumberOfFeaturesExceeded",null);k.__decorate([h.property()],
a.prototype,"filter",void 0);return a})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox".split(" "),function(b,k,a,r,l,h){function d(f,g,p,n){f=g.getComponentAabb(p,f,c);g=g.getObjectTransform(p);for(p=0;8>p;++p)e[0]=p&1?f[0]:f[3],e[1]=p&2?f[1]:f[4],e[2]=p&4?f[2]:f[5],r.transformMat3(e,e,g.rotationScale),r.add(e,e,g.position),n[3*
p]=e[0],n[3*p+1]=e[1],n[3*p+2]=e[2];return n}const c=h.create(),e=a.create();b.boundingBoxCornerPoints=d;b.boundingBoxTop=function(f,g,p,n){f=g.getComponentAabb(p,f,c);g=g.getObjectTransform(p);n[0]=0;n[1]=0;n[2]=0;for(p=0;8>p;++p)e[0]=p&1?f[0]:f[3],e[1]=p&2?f[1]:f[4],e[2]=f[5],r.transformMat3(e,e,g.rotationScale),r.add(e,e,g.position),n[0]+=e[0],n[1]+=e[1],n[2]+=e[2];n[0]/=8;n[1]/=8;n[2]/=8;return n};b.createGetFeatureExtent=function(f,g,p){const n=new Float64Array(24);return w=>{var q=w.meta.featureExtents;
if(k.isNone(q)){q=new Float64Array(6*w.meta.featureIds.length);w.meta.featureExtents=q;for(let m=0;m<q.length;m+=6)q[m]=Number.POSITIVE_INFINITY}q=new Float64Array(q.buffer,6*w.index*Float64Array.BYTES_PER_ELEMENT,6);q[0]===Number.POSITIVE_INFINITY&&(d(w.index,p,w.meta.objectHandle,n),l.projectBuffer(n,g,0,n,f,0,8)?(h.set(q,h.NEGATIVE_INFINITY),h.expandWithBuffer(q,n,0,8)):h.set(q,h.ZERO));return q}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/typedArrayUtil ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/PooledArray ../../../core/promiseUtils ../../../core/scheduling ../../../core/Collection ../../../support/arcadeOnDemand ../../../layers/support/fieldUtils ../../../core/mathUtils ../../../Color ../../../symbols/Symbol3D ../../../Graphic ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/unitUtils ../../../renderers/visualVariables/support/visualVariableUtils ../../../core/watchUtils ../../../chunks/mat4 ../../../geometry/projection ../../../symbols/support/unitConversionUtils ../../../core/MapUtils ../../../chunks/mat4f64 ../../../chunks/mat3 ../../../chunks/vec4 ../../../layers/support/SceneModification ../../../geometry/support/aaBoundingBox ../../../layers/support/layerUtils ../../../chunks/mat3f32 ../support/buffer/glUtil ../support/debugFlags ../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ./graphics/graphicUtils ../webgl-engine/lib/Texture ../support/extentUtils ./support/layerViewUpdatingProperties ../support/orientedBoundingBox ../webgl-engine/collections/Component/SourceGeometry ./i3s/I3SProjectionUtil ./i3s/I3SUtil ../../../layers/graphics/controllers/I3SOnDemandController ./i3s/I3SGeometryUtil ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./SceneLayerWorker ./i3s/Highlights ./i3s/I3SAttributeOverrides ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SIntersectionHandler ./i3s/IDBCache ./support/attributeUtils ../webgl-engine/core/material/RenderTexture ../webgl-engine/core/shaderLibrary/util/EllipsoidMode".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q,F,N,P,U,V,W,X,ca,R,aa,ka,da,fa,ea,Y,Z,ba,ia,ja,la,qa,na,oa,ua,za,Fa,La,Sa){function Ia(ta){const Da=ta.metallicRoughness;return Da&&0<=Da.baseColorTextureId||Da&&0<=Da.metallicRoughnessTextureId||0<=ta.normalTextureId||0<=ta.emissiveTextureId||0<=ta.occlusionTextureId}function Qa(ta,Da,Oa){if(d.isNone(ta)||0===Oa)return null;for(let Ja=0;Ja<ta.length;Ja++){const ra=ta[Ja];if(d.isSome(ra)&&0!==(ra.usage&Oa))return Da[Ja].id}return null}
function Pa(ta){return d.isSome(ta)&&h.isArrayBuffer(ta.data)}function sa(ta,Da){ta=1024+ta.interleavedVertexData.byteLength+(ta.indices?ta.indices.byteLength:0)+ta.positionData.data.byteLength+ta.positionData.indices.byteLength;if(d.isSome(Da))for(const Oa of Da)d.isSome(Oa)&&h.isArrayBuffer(Oa.data)&&(ta+=Oa.data.byteLength);return ta}function Ga(ta,Da){return 104857600<Da.byteSize?(ha.warn(`Node is too big to store in IndexedDB cache: ${ta.id} (${Da.byteSize} bytes)`),!1):0<Da.byteSize}function Ra(ta){if(0===
ta.length)return null;const Da=new Float64Array(10*ta.length);ta.forAll((Oa,Ja)=>{let ra=Oa.serviceObb;d.isNone(ra)&&(ra=Ea,E.copy(ra.center,Oa.mbs),ra.halfSize[0]=ra.halfSize[1]=ra.halfSize[2]=Oa.mbs[3]);Oa=10*Ja;Da[Oa+0]=ra.center[0];Da[Oa+1]=ra.center[1];Da[Oa+2]=ra.center[2];Da[Oa+3]=ra.halfSize[0];Da[Oa+4]=ra.halfSize[1];Da[Oa+5]=ra.halfSize[2];Da[Oa+6]=ra.quaternion[0];Da[Oa+7]=ra.quaternion[1];Da[Oa+8]=ra.quaternion[2];Da[Oa+9]=ra.quaternion[3]});return Da}function Ua(ta,Da){ta.forEach(Oa=>
Oa.opacity=Da)}const ha=c.getLogger("esri.views.3d.layers.SceneLayerView3D"),Ya=[1,1,1,1];let Wa=function(ta){function Da(Oa,Ja,ra,Ca,Ma,Ta,Xa){var ab=ta.call(this)||this;ab.node=Oa;ab.featureIds=Ja;ab.objectHandle=ra;ab.cachedRendererVersion=Ca;ab.attributeInfo=Ma;ab.material=Ta;ab.textures=Xa;ab.cachedEdgeMaterials=[];ab.cachedSymbology=null;return ab}a._inheritsLoose(Da,ta);return Da}(na.NodeCrossfadeMetaData);const db=F.create(),mb=F.create(),Ea=ka.create(),ya=[0,0,0,0],xa=new z([0,0,0,0]),wa=
[0,0,0,0],ma={remove(){},pause(){},resume(){}};k.I3SMeshView3D=ta=>{ta=function(Da){function Oa(){var ra=Da.apply(this,arguments)||this;ra._elevationProvider=null;ra._intersectionHandler=null;ra._nodeId2Meta=new Map;ra._nodeId2MetaReloading=new Map;ra._i3sWasmLoaded=!1;ra._asyncModuleLoading=0;ra._addTasks=new Map;ra._rendererVersion=0;ra._colorVariable=null;ra._opacityVariable=null;ra._rendererFields=null;ra._symbologyFields=null;ra._symbologyOverride=null;ra._symbologyOverrideFields=null;ra._symbolInfos=
new Map;ra._idbCache=new za.IDBCache("esri-scenelayer-cache","geometries");ra.holeFilling="auto";ra._hasColors=!1;ra._hasTextures=!1;ra._hasData=!1;ra.slicePlaneEnabled=!1;ra._modifications=[];ra._layerUrl="";ra._cacheKeySuffix=null;ra._arcade=null;ra._tmpAttributeOnlyGraphic=new t(null,null,{});ra._crossfadeHelper=new na.I3SCrossfadeHelper(a._assertThisInitialized(ra));return ra}a._inheritsLoose(Oa,Da);var Ja=Oa.prototype;Ja.initialize=function(){var ra;this.attributeOverrides=new qa.I3SAttributeOverrides(this.i3slayer,
null==(ra=this.view.resourceController)?void 0:ra.memoryController);this._worker=new ia.I3SMeshWorkerHandle(this.view.resourceController.scheduler);this.addResolvingPromise(this._worker.promise);this._worker.setLegacySchema(this.layerUid,this.i3slayer.store.defaultGeometrySchema);ea.checkSceneLayerValid(this.i3slayer);ea.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new Y({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=
this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this._highlights=new la({collection:this._collection,forAllFeatures:Ca=>this._forAllFeatures(Ca,null,1),forAllFeaturesOfNode:(Ca,Ma)=>this._forAllFeaturesOfNode(Ca,Ma)});this._isIntegratedMesh||!this.i3slayer.store.defaultGeometrySchema?this._hasSymbolColors=!1:(ra=this.i3slayer.store.defaultGeometrySchema.featureAttributes,this._hasSymbolColors=!!(ra&&ra.faceRange&&ra.id));this._hasVertexColors=
null!=this.i3slayer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.getMemCache(this.i3slayer.uid,Ca=>this._deleteComponentObject(Ca));this._intersectionHandler=new ua.I3SIntersectionHandler({layerUid:this.layerUid,sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,
isGround:this._isIntegratedMesh,forEach:Ca=>{this._nodeId2Meta.forEach(Ma=>d.isSome(Ma)&&Ca(Ma.node,Ma.objectHandle));this._nodeId2MetaReloading.forEach(Ma=>d.isSome(Ma)&&Ca(Ma.node,Ma.objectHandle))}});this._elevationProvider=new oa({layerView:this,intersectionHandler:this._intersectionHandler});this.updatingHandles.add(this,"view.clippingArea",()=>this._clippingAreaChanged(),2);this.updatingHandles.add(this,"fullOpacity",Ca=>this._opacityChange(Ca));this.updatingHandles.add(this,"slicePlaneEnabled",
Ca=>this._slicePlaneEnabledChange(Ca));this.updatingHandles.add(this,"elevationOffset",(Ca,Ma)=>{this._reloadAll(Ma);this._controller.invalidateVisibilityObbs()});this.updatingHandles.add(this,"filter",()=>this._filterChange(),2);this.updatingHandles.add(this,"view.qualitySettings.physicallyBasedRenderingEnabled",()=>this._updatePBR());ra=()=>{this._reloadAll();this.clearMemCache()};this.updatingHandles.add(this,"rendererTextureUsage",ra);this.updatingHandles.add(this,"uncompressedTextureDownsamplingEnabled",
ra);this.updatingHandles.add(this,"suspended",Ca=>this._suspendedChange(Ca),2);this.updatingHandles.add(this.i3slayer,"labelsVisible",()=>this._labelingChanged(),2);this.updatingHandles.add(this.i3slayer,"labelingInfo",()=>this._labelingChanged(),2);this.updatingHandles.add(this,"_modifications",()=>this._modificationsChanged(),2);this.handles.add([I.init(V,"I3S_TREE_SHOW_TILES",Ca=>{if(Ca&&!this._treeDebugger){const Ma=this._controller.crsIndex;(new Promise(function(Ta,Xa){b(["./support/I3STreeDebugger"],
Ta,Xa)})).then(({I3STreeDebugger:Ta})=>{!this._treeDebugger&&V.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new Ta({lv:this,view:this.view,nodeSR:Ma}))})}else Ca||V.I3S_TREE_SHOW_TILES||(this._treeDebugger=d.destroyMaybe(this._treeDebugger))}),I.init(V,"I3S_SHOW_MODIFICATIONS",()=>this._showModifications())]);this._cacheKeySuffix=ea.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(Ca=>ha.warn(`Failed to initialize IndexedDB cache: ${Ca}`))};
Ja.destroy=function(){this._clearAddTasks();this.attributeOverrides=d.destroyMaybe(this.attributeOverrides);this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const ra=this._worker;ra&&(ra.destroyContext(this.i3slayer.uid).then(()=>ra.destroy()),
this._worker=null);this._removeAllNodeDataFromStage();this._memCache=d.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=d.destroyMaybe(this._labeler);this._treeDebugger=d.destroyMaybe(this._treeDebugger);this._controller=d.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),
this._visibleGeometryChangedSchedulerHandle=null)};Ja.memEstimateTextureAdded=function(ra){ra=ra.estimatedTexMemRequired;this.gpuMemoryEstimate+=ra;this.texMemoryEstimate+=ra;return ra};Ja.memEstimateTextureRemoved=function(ra){ra=ra.estimatedTexMemRequired;this.gpuMemoryEstimate-=ra;this.texMemoryEstimate-=ra};Ja.memEstimateGeometryAdded=function(ra){ra=this._collection.getObjectGPUMemoryUsage(ra);this.gpuMemoryEstimate+=ra;this.geoMemoryEstimate+=ra;return ra};Ja.memEstimateGeometryRemoved=function(ra){ra=
this._collection.getObjectGPUMemoryUsage(ra);this.gpuMemoryEstimate-=ra;this.geoMemoryEstimate-=ra};Ja.isNodeLoaded=function(ra){return this._nodeId2Meta.has(ra)};Ja.isNodeReloading=function(ra){return this._nodeId2MetaReloading.has(ra)};Ja.getUsedMemory=function(){let ra=d.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Ca=>ra+=d.isSome(Ca)?Ca.node.memory:0);this._nodeId2MetaReloading.forEach(Ca=>ra+=d.isSome(Ca)?Ca.node.memory:0);return ra};Ja.getUnloadedMemory=function(){return(d.isSome(this._controller)?
this._controller.unloadedMemoryEstimate:0)+(d.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:0)};Ja.ignoresMemoryFactor=function(){return!1};Ja._labelingChanged=function(){if(!N.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)d.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!d.isSome(this._labeler)){var ra=new ba({view:this.view,layer:this.i3slayer,collection:this._collection});this._nodeId2Meta.forEach(Ca=>d.isSome(Ca)&&this._addMetaToLabeler(ra,
Ca));this._labeler=ra}};Ja._loadAsyncModule=function(ra){++this._asyncModuleLoading;return ra.then(Ca=>{--this._asyncModuleLoading;return Ca},Ca=>{--this._asyncModuleLoading;throw Ca;})};Ja._modificationsChanged=function(){if(!this._i3sWasmLoaded&&this._hasModifications)this._i3sWasmLoaded=ja.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var ra=this.i3slayer.uid,Ca=this.i3slayer.spatialReference;
this._worker.setModifications(ra,this._modifications,Ca);var Ma=ia.toWasmModification(this._modifications,Ca);ja.setModificationsSync({context:ra,modifications:Ma,isGeodetic:Ca.isGeographic});this._controller.modificationsChanged();var Ta=this._hasModifications?new m:null;this._nodeId2Meta.forEach((Xa,ab)=>{d.isNone(Xa)?this._nodeId2Meta.delete(ab):Xa.node.hasModifications?(this._nodeId2Meta.delete(ab),this._nodeId2MetaReloading.set(ab,Xa)):d.isSome(Ta)&&Ta.push(Xa.node)});d.isSome(Ta)&&this._nodeId2MetaReloading.forEach(Xa=>
Ta.push(Xa.node));d.isSome(Ta)&&0<Ta.length&&(this.updateNodeModificationStatus(Ta),Ta.forAll(Xa=>{if(2!==Xa.imModificationImpact){const ab=this._nodeId2Meta.get(Xa.index);this._controller.invalidateGeometryVisibility(Xa.index);this._nodeId2Meta.delete(Xa.index);d.isSome(ab)&&this._nodeId2MetaReloading.set(Xa.index,ab)}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}};Ja._showModifications=function(){d.isSome(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),
this._modificationGraphics=null);if(V.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var ra={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Ca={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Ma of this._modifications)Ma.geometry.spatialReference=this.i3slayer.spatialReference,this._modificationGraphics.push(new t({geometry:Ma.geometry,symbol:{...Ca,color:ra[Ma.type]}}));this.view.graphics.addMany(this._modificationGraphics)}};
Ja._addMetaToLabeler=function(ra,Ca){ra.addNodeMeta(Ca,(Ma,Ta)=>this._createAttributes(Ma,Ta))};Ja._suspendedChange=function(ra){ra?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};
Ja.getLoadedAttributes=function(ra){ra=this._nodeId2Meta.get(ra);if(d.isSome(ra)&&d.isSome(ra.attributeInfo))return ra.attributeInfo.loadedAttributes};Ja.getAttributeData=function(ra){ra=this._nodeId2Meta.get(ra);if(d.isSome(ra)&&d.isSome(ra.attributeInfo))return ra.attributeInfo.attributeData};Ja.setAttributeData=function(ra,Ca){ra=this._nodeId2Meta.get(ra);d.isSome(ra)&&d.isSome(ra.attributeInfo)&&(ra.attributeInfo.attributeData=Ca,this._attributeValuesChanged(ra))};Ja.updateAttributes=async function(ra,
Ca,Ma){ra=this._nodeId2Meta.get(ra);d.isSome(ra)&&(await this.attributeOverrides.apply(ra.featureIds,Ca,Ma),ra.attributeInfo=Ca,this._attributeValuesChanged(ra))};Ja._attributeValuesChanged=function(ra){ra.cachedRendererVersion=this._getInvalidRendererVersion();ra.filteredIds=null;d.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(ra,(Ca,Ma)=>this._createAttributes(Ca,Ma));this._updateEngineObject(ra)};Ja.clearMemCache=function(){d.isSome(this._memCache)&&this._memCache.clear()};Ja.getVisibleNodes=
function(){const ra=[];this._nodeId2Meta.forEach(Ca=>d.isSome(Ca)&&ra.push(Ca.node));return ra};Ja.getLoadedNodeIndices=function(ra){this._nodeId2Meta.forEach((Ca,Ma)=>ra.push(Ma));this._nodeId2MetaReloading.forEach((Ca,Ma)=>ra.push(Ma))};Ja._createTexture=function(ra,Ca,Ma,Ta){if(d.isNone(Ma)||null==Ma.data)return null;const {data:Xa,encoding:ab}=Ma,gb=Ca.wrapTextures;Ca=Ma.usage&1?"opaque"===Ca.alphaMode?3:4:3;var bb=!0;let Ha;ab===ea.DDS_ENCODING_STRING?Ha=ca.DDS_ENCODING:bb=C.isPowerOfTwo(Xa.width)&&
C.isPowerOfTwo(Xa.height);bb=(Ta?this._enableAtlasMipMaps:this._enableMipMaps)&&bb;Ma=new ca(Xa,`${ra.id}/${Ma.id}`,{mipmap:bb,wrap:Ta||!gb?{s:33071,t:33071}:{s:10497,t:10497},disableAnisotropy:Ta&&bb&&this._disableAtlasAnisotropy,encoding:Ha,noUnpackFlip:!0,components:Ca});this._stage.add(4,Ma);ra.memory+=this.memEstimateTextureAdded(Ma);return Ma};Ja._getVertexBufferLayout=function(ra,Ca){ra={hasTexture:Ia(ra.params.material),hasNormals:Ca.normal,hasRegions:Ca.uvRegion};return U.glLayout(da.createVertexBufferLayout(this._getGeometryParameters(ra)))};
Ja._getObjectIdField=function(){return this.i3slayer.objectIdField||"OBJECTID"};Ja._findGraphicNodeAndIndex=function(ra){const Ca=Fa.attributeLookup(this.i3slayer.fieldsIndex,ra.attributes,this._getObjectIdField());let Ma=null;S.someMap(this._nodeId2Meta,Ta=>{if(d.isNone(Ta))return!1;const Xa=Ta.featureIds.indexOf(Ca);if(-1===Xa)return!1;Ma={node:Ta.node,index:Xa};return!0});return Ma};Ja._getGraphicIndices=function(ra,Ca){ra=this._nodeId2Meta.get(ra.index);if(d.isNone(ra))return[];const Ma=[],Ta=
this._getObjectIdField(),Xa=this.i3slayer.fieldsIndex;for(const ab of Ca)Ca=Fa.attributeLookup(Xa,ab.attributes,Ta),Ca=ra.featureIds.indexOf(Ca),-1!==Ca&&Ma.push(Ca);return Ma};Ja.whenGraphicBounds=function(ra){ra=this._findGraphicNodeAndIndex(ra);if(!ra)return u.reject();var Ca=this._nodeId2Meta.get(ra.node.index);if(d.isNone(Ca))return u.reject();ra=Z.boundingBoxCornerPoints(ra.index,this._collection,Ca.objectHandle,new Float64Array(24));if(K.projectBuffer(ra,this.view.renderSpatialReference,0,
ra,this.view.spatialReference,0,8))return Ca=F.empty(),F.expandWithBuffer(Ca,ra,0,8),u.resolve({boundingBox:Ca,screenSpaceObjects:[]})};Ja.whenGraphicAttributes=function(ra,Ca){return ea.whenGraphicAttributes(this.i3slayer,ra,this._getObjectIdField(),Ca,()=>[...this._nodeId2Meta.values()].filter(d.isSome),{populateObjectId:!0})};Ja.getGraphicFromIntersectorMetadata=function(ra){if(null==ra.nodeIndex||null==ra.componentIndex)return null;const Ca=this._nodeId2Meta.get(ra.nodeIndex);return d.isNone(Ca)||
null==Ca.featureIds||ra.componentIndex>=Ca.featureIds.length?null:this._createGraphic(ra.componentIndex,Ca)};Ja._getCacheKey=function(ra){return`${this._layerUrl}/v${16}/${ra.id}${this._cacheKeySuffix}`};Ja._getMemCacheKey=function(ra,Ca=this.elevationOffset){return ra+"#"+Ca};Ja.loadCachedGPUData=function(ra){return d.isSome(this._memCache)?this._memCache.pop(this._getMemCacheKey(ra.index)):null};Ja.deleteCachedGPUData=function(ra){d.isSome(ra)&&this._deleteComponentObject(ra)};Ja._cacheGPUData=
function(ra,Ca=this.elevationOffset){if(d.isNone(this._memCache))this._deleteComponentObject(ra);else{var Ma=this._controller.indexDepth-ra.node.level;this._memCache.put(this._getMemCacheKey(ra.node.index,Ca),ra,ra.node.memory,Ma)}};Ja.loadMissingTextures=function(ra,Ca,Ma,Ta){const Xa=ra.filter((ab,gb)=>{if(0===(ab.usage&this.rendererTextureUsage))return!1;if(d.isNone(Ca))return!0;ab=ea.selectEncoding(ab.encodings,this.useCompressedTextures);gb=Ca[gb];return d.isNone(gb)||null==gb.data||ab&&gb.encoding!==
ab.encoding?!0:!1});return 0===Xa.length?u.resolve(!1):Ma(Xa,Ta).then(ab=>{let gb=0;for(let bb=0;bb<ra.length;bb++)gb<ab.length&&ab[gb].id===ra[bb].id&&(Ca[bb]=ab[gb],gb++);return!0})};Ja.loadCachedNodeData=function(ra,Ca,Ma){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(ra),Ca).then(Ta=>{if(null==Ta)return null;if(Ta.nodeVersion!==ra.version)return this._idbCache.remove(this._getCacheKey(ra)),null;ra.geometryObb=Ta.geometryObb;return this.loadMissingTextures(Ta.requiredTextures,
Ta.textureData,Ma,Ca).then(Xa=>{Xa&&this._idbCache.initialized&&d.isSome(Ta.textureData)&&(Ta.byteSize=sa(Ta.transformedGeometry,Ta.textureData),Ta.textureData.every(Pa)&&Ga(ra,Ta)&&this._idbCache.put(this._getCacheKey(ra),Ta).catch(ab=>ha.warn(`Failed to update node with textures in IndexedDB cache: ${ra.id}: ${ab}`)));u.throwIfAborted(Ca);return Ta})}):u.resolve(null)};Ja.addNode=function(ra,Ca,Ma){return"geometryData"in Ca?this._addData(ra,Ca.attributeDataInfo,()=>this._transformNode(ra,Ca,Ma).then(Ta=>
this._safeReschedule(()=>{if(d.isNone(Ta))return ra.hasModifications=!1,this._addCachedNodeData(ra,null,Ma);ra.hasModifications=Ta.transformedGeometry.hasModifications;const {obb:Xa,componentOffsets:ab,featureIds:gb,transformedGeometry:bb}=Ta;var Ha=fa.computeGlobalTransformation(ra.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference);ra.geometryObb=ka.create([Xa.center.x,Xa.center.y,Xa.center.z],[Xa.extents.x,Xa.extents.y,Xa.extents.z],[Xa.orientation.x,Xa.orientation.y,
Xa.orientation.z,Xa.orientation.w]);E.transformMat4(ra.geometryObb.center,ra.geometryObb.center,Ha);Ca.geometryData.componentOffsets=ab;gb&&(Ca.geometryData.featureIds=Array.prototype.slice.call(gb));Ha={nodeVersion:ra.version,geometryData:Ca.geometryData,requiredTextures:Ca.requiredTextures,textureData:Ca.textureData,transformedGeometry:bb,globalTrafo:Ha,geometryObb:ra.geometryObb,byteSize:sa(bb,Ca.textureData)};if(this._idbCacheEnabled&&this._idbCache.initialized&&Ga(ra,Ha)){const Na=d.isSome(Ha.textureData)?
Ha.textureData.map($a=>Pa($a)?$a:null):null;this._idbCache.put(this._getCacheKey(ra),{...Ha,textureData:Na}).catch($a=>ha.warn(`Failed to store node in IndexedDB cache: ${ra.id}: ${$a}`))}return this._addCachedNodeData(ra,Ha,Ma)},Ma))):u.reject()};Ja.computeVisibilityObb=function(ra){return ea.computeVisibilityObb(ra,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications)};Ja._transformNode=function(ra,Ca,Ma){var Ta=Ca.geometryData.geometries;
const Xa=Array(Ta.length);for(var ab=0;ab<Ta.length;++ab)Xa[ab]=this._getVertexBufferLayout(Ta[ab],Ca.geometryDescriptor);Ta=ra.mbs;ab=this.elevationOffset;var gb=this._controller.crsIndex,bb=this._controller.crsVertex;const Ha=this.view.renderSpatialReference,Na=fa.getLocalOrigin(Ta,ab,gb),$a=fa.computeGlobalTransformation(Ta,ab,gb,Ha);gb=K.getProjectorName(gb,bb);bb=K.getProjectorName(bb,Ha);return d.isNone(gb)||d.isNone(bb)?u.resolve(null):this._worker.invoke({context:this.i3slayer.uid,geometryBuffer:Ca.geometryBuffer,
geometryData:Ca.geometryData,geometryDescriptor:Ca.geometryDescriptor,layouts:Xa,localOrigin:Na,globalTrafo:$a,mbs:Ta,obb:ra.serviceObb,elevationOffset:ab,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:gb,vertexToRenderProjector:bb},Ma)};Ja._setNewNodeOpacity=function(ra){this._setNodeOpacity(ra,this.nodeCrossfadingEnabled?0:this.fullOpacity)};Ja.addCachedGPUData=function(ra,Ca,Ma){ra.geometryObb=
ka.clone(this._collection.getComponentObb(Ca.objectHandle));this._controller.isGeometryVisible(ra)?(d.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,Ca),ra=ra.index,this._addNodeMeta(ra,Ca),this.updateNodeState(ra,Ma),this._collection.setObjectVisibility(Ca.objectHandle,!0),this._updateMaterial(Ca),this._setNewNodeOpacity(Ca),this._updateEngineObject(Ca),this._highlights.objectCreated(Ca),d.isSome(this._treeDebugger)&&this._treeDebugger.update()):this._cacheGPUData(Ca)};Ja.addCachedNodeData=
function(ra,Ca,Ma,Ta){return this._addData(ra,Ma,()=>this._addCachedNodeData(ra,Ca,Ta))};Ja._addCachedNodeData=async function(ra,Ca,Ma){if(this.suspended||!this._controller.isGeometryVisible(ra))this._removeNodeStageData(ra.index,this.elevationOffset,this._nodeId2MetaReloading);else if(d.isNone(Ca))this._addNodeMeta(ra.index,null);else{var Ta=this._addTasks.get(ra.index),{geometryData:Xa,transformedGeometry:ab,globalTrafo:gb}=Ca;await this.attributeOverrides.apply(Xa.featureIds,Ta.attributeInfo,Ma);
var bb=d.isSome(Ca.textureData)?Ca.textureData.filter(wb=>d.isSome(wb)&&0!==(wb.usage&this.rendererTextureUsage)):null;ra.memory=0;var {componentOffsets:Ha,geometries:Na,featureIds:$a}=Xa,cb=this._collection,eb=Na[0],{layout:hb,indices:kb,interleavedVertexData:lb,positionData:zb,hasColors:Hb}=ab,Fb=this._materialParameters(eb,hb),Sb=Ha||new Uint32Array([0,kb?kb.length:lb.byteLength/hb[0].stride]);Sb={vertices:{data:lb,count:lb.byteLength/hb[0].stride,layoutParameters:Fb.geometryParams},positionData:{positions:zb.data,
indices:zb.indices},indices:kb,primitiveType:4,componentOffsets:Sb};var Nb=eb.transformation?M.clone(eb.transformation):M.create();J.multiply(Nb,gb,Nb);var Kb=J.getTranslation(D.create(),Nb);Nb=T.fromMat4(P.create(),Nb);var tc=this.view.renderSpatialReference,uc=this.view.basemapTerrain.spatialReference,cc=D.create(),dc=[1,1,1];K.localLinearScaleFactors(Kb,tc,dc,uc);K.projectVectorToVector(Kb,tc,cc,uc);var ec=cb.createObject({toMapSpace:[cc[0],cc[1],dc[0],dc[1]],geometry:Sb,obb:d.unwrap(ra.geometryObb),
transform:{position:Kb,rotationScale:Nb},visible:!1});Sb={isSchematic:eb.params.material.isSchematic,isOpaque:"blend"!==eb.params.material.alphaMode&&1<=eb.params.material.metallicRoughness.baseColorFactor[3]};Kb=d.isSome(bb)?bb.map(wb=>this._createTexture(ra,Fb.material,wb,2===Fb.geometryParams.textureCoordinates)):[];this._configureMaterial(ec,eb.params.material,Kb,bb);ra.memory+=this.memEstimateGeometryAdded(ec);var vb=new Wa(ra,$a,ec,this._getInvalidRendererVersion(),Ta.attributeInfo,Sb,Kb);Ta.meta=
vb;!this._hasTextures&&Ca.requiredTextures.some(({usage:wb})=>0!==(wb&19))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||Hb;this._hasTextures=this._hasTextures||!!ra.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var Kc=this.slicePlaneEnabled;return this._addOrUpdateEdgeRendering(vb).then(wb=>{d.isSome(wb)&&wb.updateObjectVisibility(vb.objectHandle,!1);return this._safeReschedule(()=>{var Ob=this._addTasks.get(ra.index);if(Ob)if(d.isSome(this._labeler)&&
this._addMetaToLabeler(this._labeler,vb),this._addNodeMeta(ra.index,vb),Ob.meta=null,this.suspended)this._removeNodeStageData(ra.index,this.elevationOffset);else{cb.setObjectVisibility(ec,!0);d.isSome(wb)&&wb.updateObjectVisibility(vb.objectHandle,!0);vb.attributeInfo=Ob.attributeInfo;Ob=vb.cachedRendererVersion!==this._rendererVersion;var kd=Kc!==this.slicePlaneEnabled;this._setObjectSymbolColors(vb);var ld=this._applyFiltersToNode(vb);(Ob||d.isSome(wb)&&(kd||ld))&&this._addOrUpdateEdgeRendering(vb);
this._visibleGeometryChanged(vb);this._highlights.objectCreated(vb);this._updateMaterial(vb);this._setNewNodeOpacity(vb);d.isSome(this._treeDebugger)&&this._treeDebugger.update()}},Ma)}).catch(wb=>{d.isSome(Ta.meta)&&(this._deleteComponentObject(Ta.meta),Ta.meta=null);throw wb;})}};Ja._addNodeMeta=function(ra,Ca){this._removeNodeStageData(ra,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(ra)){ha.error("Removing duplicated node");const Ma=this._nodeId2Meta.get(ra);d.isSome(Ma)&&
this._deleteComponentObject(Ma)}d.isSome(Ca)&&(Ca.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&Ua(Ca.cachedEdgeMaterials,0));this._nodeId2Meta.set(ra,Ca)};Ja._safeReschedule=function(ra,Ca){u.throwIfAborted(Ca);return this._controller.reschedule(ra,Ca)};Ja._materialParameters=function(ra,Ca){ra=ra.params.material;const Ma=Ca.some(Xa=>"uvRegion"===Xa.name);Ca=Ca.some(Xa=>"normalCompressed"===Xa.name);const Ta=Ia(ra);return{geometryParams:this._getGeometryParameters({hasTexture:Ta,hasNormals:Ca,
hasRegions:Ma}),material:ra}};Ja._configureMaterial=function(ra,Ca,Ma,Ta){const Xa=this.rendererTextureUsage;this._collection.updateMaterial(ra,ab=>{var gb=Ca.metallicRoughness.baseColorFactor,bb=C.clamp(Ca.metallicRoughness.baseColorFactor[3],0,1);ab.baseColor=[gb[0],gb[1],gb[2],bb];ab.mrrFactors=[Ca.metallicRoughness.metallicFactor,Ca.metallicRoughness.roughnessFactor,Ca.isSchematic?.2:.5];ab.emissiveFactor=Ca.emissiveFactor;ab.usePBR=this._usePBR(Ca.isSchematic);ab.isIntegratedMesh=this._isIntegratedMesh;
ab.alphaCutoff="mask"===Ca.alphaMode?Ca.alphaCutoff:W.defaultMaskAlphaCutoff;ab.alphaDiscardMode="opaque"===Ca.alphaMode?1:"mask"===Ca.alphaMode?2:3;gb=this._stage.renderView.textureRepository;if(bb=Qa(Ta,Ma,33&Xa))ab.baseColorTexture=new La.RenderTexture(gb,bb);if(bb=Qa(Ta,Ma,2&Xa))ab.metallicRoughnessTexture=new La.RenderTexture(gb,bb);if(bb=Qa(Ta,Ma,16&Xa))ab.emissionTexture=new La.RenderTexture(gb,bb);if(bb=Qa(Ta,Ma,8&Xa))ab.occlusionTexture=new La.RenderTexture(gb,bb);if(bb=Qa(Ta,Ma,4&Xa))ab.normalTexture=
new La.RenderTexture(gb,bb);ab.commonMaterialParameters.slicePlaneEnabled=this.slicePlaneEnabled;ab.commonMaterialParameters.doubleSided=Ca.doubleSided;ab.commonMaterialParameters.cullFace=Ca.cullFace;ab.ellipsoidMode=Sa.getEllipsoidMode(this.view.spatialReference);this._updateMaterialOverlay(ab)})};Ja._getGeometryParameters=function(ra){return{textureCoordinates:ra.hasTexture?ra.hasRegions?2:1:0,colors:this._hasVertexColors,normals:ra.hasNormals&&!this._isIntegratedMesh}};Ja._addData=function(ra,
Ca,Ma){let Ta=this._addTasks.get(ra.index);Ta?Ta.attributeInfo=Ca:(Ta={...u.createResolver(),attributeInfo:Ca,meta:null},this._addTasks.set(ra.index,Ta),Ma().then(Ta.resolve,Ta.reject).then(()=>this._addTasks.delete(ra.index)).catch(Xa=>{this._addTasks.delete(ra.index);throw Xa;}));return Ta.promise};Ja._clearAddTasks=function(){this._addTasks.forEach(ra=>{d.isSome(ra.meta)&&(this._deleteComponentObject(ra.meta),ra.meta=null)});this._addTasks.clear()};Ja._clippingAreaChanged=function(){const ra=F.create();
R.projectToBoundingBox(this.view.clippingArea,ra,this.view.renderSpatialReference)?this._clippingArea=ra:this._clippingArea=null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};Ja._filterChange=function(){this._applyFilters(!1)};Ja._applyFilters=function(ra){this._filters=this.getFilters();ra?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Ca=>{d.isSome(Ca)&&this._applyFiltersToNode(Ca)&&(this._addOrUpdateEdgeRendering(Ca),
this._visibleGeometryChanged(Ca))})};Ja.getFilters=function(){const ra=[];this._clippingArea&&ra.push((Ca,Ma)=>this._boundingboxFilter(Ca,Ma,this._clippingArea));return ra};Ja.addSqlFilter=function(ra,Ca,Ma){if(d.isSome(Ca)){const Ta=Ca.fieldNames;ra.push((Xa,ab)=>this._sqlFilter(Xa,ab,Ca,Ta,Ma))}};Ja._sqlFilter=function(ra,Ca,Ma,Ta,Xa){const ab={},gb=this._createLayerGraphic(ab),bb=this.i3slayer.objectIdField,Ha=Ca.featureIds,Na=d.isSome(Ca.attributeInfo)&&Ca.attributeInfo.attributeData;Ta.every($a=>
null!=Na[$a]||$a===bb)&&ea.filterInPlace(ra,Ha,$a=>{ab[bb]=Ha[$a];for(const cb of Ta)cb!==bb&&(ab[cb]=ea.getCachedAttributeValue(Na[cb],$a));try{return Ma.testFeature(gb)}catch(cb){return Xa(cb),!1}})};Ja._boundingboxNodeTest=function(ra,Ca){K.projectBoundingSphere(ra.node.mbs,this._controller.crsIndex,wa,this.view.renderSpatialReference);return ea.intersectBoundingBoxWithMbs(Ca,wa)};Ja._boundingboxFeatureTest=function(ra,Ca,Ma){return F.intersects(Ma,this._collection.getComponentAabb(ra.objectHandle,
Ca,db))};Ja._boundingboxFilter=function(ra,Ca,Ma){var Ta=this._collection;const Xa=this._boundingboxNodeTest(Ca,Ma);if(3!==Xa)if(0===Xa)ra.length=0;else if(Ta=Ta.getComponentCount(Ca.objectHandle),Ta.invisible+Ta.visible===Ca.featureIds.length){var ab=this._transformAABB(mb,Ma,Ca.objectHandle);ea.filterInPlace(ra,Ca.featureIds,gb=>this._boundingboxFeatureTest(Ca,gb,ab))}};Ja._transformAABB=function(ra,Ca,Ma){var Ta=this._collection.getObjectTransform(Ma);Ma=Ta.position;Ta=Ta.rotationScale;ra[0]=(Ca[0]-
Ma[0])/Ta[0];ra[1]=(Ca[1]-Ma[1])/Ta[4];ra[2]=(Ca[2]-Ma[2])/Ta[8];ra[3]=(Ca[3]-Ma[0])/Ta[0];ra[4]=(Ca[4]-Ma[1])/Ta[4];ra[5]=(Ca[5]-Ma[2])/Ta[8];return ra};Ja._addOrUpdateEdgeRendering=function(ra,Ca=!0){if(d.isNone(this._edgeView))return u.resolve(null);const Ma=ra.objectHandle,Ta=this._edgeView.hasObject(Ma),{hasEdges:Xa,perFeatureEdgeMaterials:ab}=this._getFilteredEdgeMaterials(ra),gb={slicePlaneEnabled:this.slicePlaneEnabled};if(Xa)return Ta?(this.nodeCrossfadingEnabled&&(ra=this.getNodeOpacity(ra),
Ua(ab,ra)),this._edgeView.updateAllComponentMaterials(Ma,ab,gb,Ca),this._edgeView.updateObjectVisibility(Ma,!0),u.resolve(this._edgeView)):this._collection.addEdges(Ma,this._edgeView,ab,gb).then(()=>this._edgeView);Ta&&this._edgeView.removeObject(Ma);return u.resolve(null)};Ja._removeEdgeRendering=function(ra){d.isSome(this._edgeView)&&this._edgeView.hasObject(ra.objectHandle)&&this._edgeView.removeObject(ra.objectHandle)};Ja._applyFiltersToNode=function(ra){return this._applyFiltersToNodeComponents(ra)?
(d.isSome(this._labeler)&&this._labeler.applyFilterChange(ra),!0):!1};Ja._applyFiltersToNodeComponents=function(ra){const Ca=this._collection;var Ma=0===Ca.getComponentCount(ra.objectHandle).invisible;Ca.setAllComponentVisibilities(ra.objectHandle,"all");if(0===this._filters.length)return ra.filteredIds=null,!Ma;this._updateCachedFilteredIds(ra);if(ra.filteredIds===ra.featureIds)return!Ma;Ma=this._computeFilteredComponentIndices(ra);Ca.setAllComponentVisibilities(ra.objectHandle,Ma);return!0};Ja._updateCachedFilteredIds=
function(ra){if(null==ra.filteredIds||ra.appliedFilters!==this._filters)ra.filteredIds=this._computeFilteredIds(ra),ra.appliedFilters=this._filters};Ja._computeFilteredIds=function(ra){const Ca=ra.featureIds.slice();for(const Ma of this._filters)if(Ma(Ca,ra),0===Ca.length)break;return Ca.length===ra.featureIds.length?ra.featureIds:Ca};Ja._computeFilteredComponentIndices=function(ra){const Ca=[];ra.featureIds.forEach((Ma,Ta)=>{ra.filteredIds[Ca.length]===Ma&&Ca.push(Ta)});return Ca};Ja._removeAllNodeDataFromStage=
function(ra=this.elevationOffset){this._nodeId2Meta.forEach((Ca,Ma)=>this._removeNodeStageData(Ma,ra));this._nodeId2MetaReloading.forEach((Ca,Ma)=>this._removeNodeStageData(Ma,ra,this._nodeId2MetaReloading))};Ja.removeNode=function(ra){const Ca=this.elevationOffset;this._removeNodeStageData(ra,Ca);this._removeNodeStageData(ra,Ca,this._nodeId2MetaReloading)};Ja._removeNodeStageData=function(ra,Ca,Ma=this._nodeId2Meta){const Ta=Ma.get(ra);d.isNone(Ta)?Ma.delete(ra):(this._collection.setObjectVisibility(Ta.objectHandle,
!1),this._visibleGeometryChanged(Ta),this._removeEdgeRendering(Ta),d.isSome(this._labeler)&&this._labeler.removeNodeMeta(Ta),Ma.delete(ra),this._highlights.objectDeleted(Ta),Ma===this._nodeId2Meta?(this._cacheGPUData(Ta,Ca),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(Ta)):this._deleteComponentObject(Ta),d.isSome(this._treeDebugger)&&this._treeDebugger.update())};Ja._deleteComponentObject=function(ra){d.isSome(this._edgeView)&&this._edgeView.removeObject(ra.objectHandle);this.memEstimateGeometryRemoved(ra.objectHandle);
this._collection.destroyObject(ra.objectHandle);if(ra.textures)for(const Ca of ra.textures)this.memEstimateTextureRemoved(Ca),this._stage.remove(4,Ca.id)};Ja.updateNodeState=function(ra,Ca){ra=this._nodeId2Meta.get(ra);d.isSome(ra)&&this._collection.updateMaterial(ra.objectHandle,Ma=>Ma.polygonOffsetEnabled=0===Ca)};Ja._invalidateAllSymbols=function(){this._rendererVersion=ea.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};Ja._getInvalidRendererVersion=function(){return ea.addWraparound(this._rendererVersion,
-1)};Ja._rendererChange=async function(ra){this._currentRenderer=ra;this.notifyChange("rendererTextureUsage");this._rendererVersion=ea.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();ra&&(this._rendererFields=x.fixFields(this.i3slayer.fields,await ra.getRequiredFields(this.i3slayer.fields)));this._updateSymbologyFields();!this._arcade&&ra&&"arcadeRequired"in ra&&ra.arcadeRequired&&(this._arcade=await B.loadArcade());
if(ra&&"visualVariables"in ra&&ra.visualVariables)for(const Ca of ra.visualVariables)"color"===Ca.type?this._colorVariable=Ca:"opacity"===Ca.type?this._opacityVariable=Ca:ha.warn(`Unsupported visual variable type for 3D Object Scene Services: ${Ca.type}`);if(ra)for(const Ca of ra.getSymbols())"mesh-3d"!==Ca.type&&ha.error(`Symbols of type '${Ca.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()};Ja._getCachedEdgeMaterials=function(ra){this._hasSymbolColors&&
ra.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(ra);return ra.cachedEdgeMaterials};Ja._getSymbolColors=function(ra){this._hasSymbolColors&&ra.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(ra);const Ca=ra.cachedSymbology;return(Ma,Ta)=>{Ma*=5;O.set(Ta.externalColor,Ca[Ma+0]/255,Ca[Ma+1]/255,Ca[Ma+2]/255,Ca[Ma+3]/255);Ta.externalColorMixMode=Ca[Ma+4]&15;Ta.castShadows=0!==(Ca[Ma+4]&16);Ta.pickable=0!==(Ca[Ma+4]&32)}};Ja._getSymbolInfo=
function(ra,Ca){Ca=ra&&ra.getSymbol(Ca,{arcade:this._arcade});if(!(Ca instanceof A))return null;ra=Ca.id;if(this._symbolInfos.has(ra))return this._symbolInfos.get(ra);Ca=ea.getSymbolInfo(Ca);this._symbolInfos.set(ra,Ca);return Ca};Ja._setSymbologyOverride=function(ra,Ca){this._symbologyOverride!==ra&&(this._symbologyOverride=ra,this._symbologyOverrideFields=Ca,this._invalidateAllSymbols(),this._updateSymbologyFields())};Ja._updateSymbologyFields=function(){this._symbologyFields=d.isSome(this._symbologyOverrideFields)&&
0<this._symbologyOverrideFields.length?d.isSome(this._rendererFields)&&0<this._rendererFields.length?x.fixFields(this.i3slayer.fields,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};Ja._updateCachedRendererData=function(ra){ra.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var Ca=this._tmpAttributeOnlyGraphic,Ma={};Ca.attributes=Ma;var Ta=this._currentRenderer,Xa=d.isSome(ra.attributeInfo)&&ra.attributeInfo.attributeData,
ab=null!=ra.featureIds?this.i3slayer.objectIdField:null,gb=null!=Xa&&d.isSome(this._symbologyFields)&&0<this._symbologyFields.length,bb=gb?[]:null,Ha=gb?[]:null;if(gb&&d.isSome(this._symbologyFields))for(var Na of this._symbologyFields){var $a=Xa[Na];$a&&(bb.push(Na),Ha.push($a))}ra.cachedSymbology||(ra.cachedSymbology=new Uint8Array(5*ra.featureIds.length));Xa={color:ya,castShadows:!0,pickable:!0,colorMixMode:1,edgeMaterial:null};Na=this.fullOpacity;Na=this.nodeCrossfadingEnabled?this.getNodeOpacity(ra):
Na;$a=null;var cb=2,eb=ea.transparentEdgeMaterial,hb=0;for(let Hb=0;Hb<ra.featureIds.length;Hb++){null!=ab&&(Ma[ab]=ra.featureIds[Hb]);if(gb)for(var kb=0;kb<bb.length;kb++)Ma[bb[kb]]=ea.getCachedAttributeValue(Ha[kb],Hb);var lb=this._getSymbolInfo(Ta,Ca);let Fb=kb=null;if(Ta&&"visualVariables"in Ta){if(this._colorVariable){var zb=H.getColor(this._colorVariable,Ca,{color:xa,arcade:this._arcade});zb&&(kb=ya,kb[0]=zb.r/255,kb[1]=zb.g/255,kb[2]=zb.b/255,this._opacityVariable||null===zb.a||(Fb=zb.a))}this._opacityVariable&&
(Fb=H.getOpacity(this._opacityVariable,Ca,{arcade:this._arcade}))}lb&&lb.material&&(zb=lb.material,kb=d.isNone(kb)||d.isNone(Fb)?X.overrideColor(kb,Fb,zb.color,zb.alpha,Ya,ya):X.overrideColor(kb,Fb,null,null,Ya,ya));d.isNone(kb)&&(kb=ya,kb[0]=1,kb[1]=1,kb[2]=1,kb[3]=1);Xa.pickable=!0;Xa.castShadows=lb?lb.castShadows:!0;Xa.colorMixMode=lb&&lb.material?lb.material.colorMixMode:1;Xa.edgeMaterial=lb?lb.edgeMaterial:null;d.isSome(this._symbologyOverride)&&(Xa.color=kb,this._symbologyOverride(Ca,Xa),kb=
Xa.color);if(d.isSome(Xa.edgeMaterial)){lb=0>=kb[3]?0:1<=kb[3]&&(ra.material.isOpaque||3===Xa.colorMixMode)?2:1;if(Xa.edgeMaterial!==$a||lb!==cb)eb={...Xa.edgeMaterial,opacity:Na,objectTransparency:lb},$a=Xa.edgeMaterial,cb=lb;ra.cachedEdgeMaterials[Hb]=eb}else ra.cachedEdgeMaterials[Hb]=ea.transparentEdgeMaterial;ra.cachedSymbology[hb+0]=Math.round(255*kb[0]);ra.cachedSymbology[hb+1]=Math.round(255*kb[1]);ra.cachedSymbology[hb+2]=Math.round(255*kb[2]);ra.cachedSymbology[hb+3]=Math.round(255*kb[3]);
ra.cachedSymbology[hb+4]=Xa.colorMixMode|+Xa.castShadows<<4|+Xa.pickable<<5;hb+=5}}};Ja._getFilteredEdgeMaterials=function(ra){var Ca=this._getCachedEdgeMaterials(ra);this.nodeCrossfadingEnabled||Ua(Ca,this.fullOpacity);if(d.isNone(ra.filteredIds))return{hasEdges:Ca.some(Xa=>Xa!==ea.transparentEdgeMaterial),perFeatureEdgeMaterials:Ca};let Ma=0,Ta=!1;Ca=Ca.map((Xa,ab)=>{if(ra.featureIds[ab]!==ra.filteredIds[Ma])return ea.transparentEdgeMaterial;Ta=Ta||Xa!==ea.transparentEdgeMaterial;Ma++;return Xa});
return{hasEdges:Ta,perFeatureEdgeMaterials:Ca}};Ja._setObjectSymbolColors=function(ra){if(this._hasSymbolColors){var Ca=ra.objectHandle;ra=this._getSymbolColors(ra);this._collection.setComponentData(Ca,ra);this._stage.renderView.setNeedsRender()}};Ja._reloadAll=function(ra=this.elevationOffset){this._removeAllNodeDataFromStage(ra);null!=this._controller&&this._controller.restartNodeLoading()};Ja._opacityChange=function(ra){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(Ca=>
{d.isNone(Ca)||(this._collection.updateMaterial(Ca.objectHandle,Ma=>Ma.objectOpacity=ra),Ua(Ca.cachedEdgeMaterials,ra),this._updateEdgeRendering(Ca))})};Ja._updateMaterial=function(ra){this._collection.updateMaterial(ra.objectHandle,Ca=>{Ca.commonMaterialParameters.slicePlaneEnabled=this.slicePlaneEnabled;Ca.usePBR=this._usePBR(ra.material.isSchematic);this._updateMaterialOverlay(Ca)})};Ja._updateMaterialOverlay=function(ra){};Ja._updateEngineObject=function(ra){this._setObjectSymbolColors(ra);this._applyFiltersToNode(ra);
this._addOrUpdateEdgeRendering(ra);this._visibleGeometryChanged(ra)};Ja._slicePlaneEnabledChange=function(ra){this._intersectionHandler&&(this._intersectionHandler.slicePlane=ra);d.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=ra);this._nodeId2Meta.forEach(Ca=>{d.isNone(Ca)||(this._collection.updateMaterial(Ca.objectHandle,Ma=>{Ma.commonMaterialParameters.slicePlaneEnabled=ra}),this._updateEdgeRendering(Ca,!1))})};Ja._updatePBR=function(){this._nodeId2Meta.forEach(ra=>{d.isNone(ra)||this._collection.updateMaterial(ra.objectHandle,
Ca=>{Ca.usePBR=this._usePBR(ra.material.isSchematic)})})};Ja._usePBR=function(ra){return!this._isIntegratedMesh&&(ra?this.view.qualitySettings.physicallyBasedRenderingEnabled:!0)};Ja._updateEdgeRendering=function(ra,Ca=!0){d.isSome(this._edgeView)&&this._edgeView.hasObject(ra.objectHandle)&&this._addOrUpdateEdgeRendering(ra,Ca)};Ja._forAllNodes=function(ra){this._nodeId2Meta.forEach(ra)};Ja._forAllFeatures=function(ra,Ca,Ma=0){S.someMap(this._nodeId2Meta,Ta=>{if(d.isNone(Ta))return!1;if(d.isSome(Ca))switch(Ca(Ta)){case 0:return!0;
case 2:return!1}let Xa=1;switch(Ma){case 1:Xa=this._forAllFeaturesOfNode(Ta,ra);break;case 0:Xa=this._forVisibleFeaturesOfNode(Ta,ra);break;case 2:Xa=this._forAllFeaturesOfNodeInClippingArea(Ta,ra)}return 0===Xa})};Ja._forAllFeaturesOfNode=function(ra,Ca){let Ma=1;const Ta=ra.featureIds;for(let Xa=0;Xa<Ta.length&&(Ma=Ca(Ta[Xa],Xa,ra),0!==Ma);Xa++);return Ma};Ja._forVisibleFeaturesOfNode=function(ra,Ca){let Ma=1;const Ta=ra.featureIds;this._collection.forEachVisibleComponent(ra.objectHandle,Xa=>{Ma=
Ca(Ta[Xa],Xa,ra);return 1===Ma});return Ma};Ja._forAllFeaturesOfNodeInClippingArea=function(ra,Ca){if(null==this._clippingArea)return this._forAllFeaturesOfNode(ra,Ca);var Ma=this._boundingboxNodeTest(ra,this._clippingArea);if(0===Ma)return 1;if(3===Ma)return this._forAllFeaturesOfNode(ra,Ca);Ma=ra.featureIds;const Ta=ea.getClipAABB(this._clippingArea,this._collection.getObjectTransform(ra.objectHandle));for(let Xa=0;Xa<Ma.length;Xa++){if(!this._boundingboxFeatureTest(ra,Xa,Ta))continue;const ab=
Ca(Ma[Xa],Xa,ra);if(0===ab)return ab}return 1};Ja._createAttributes=function(ra,Ca){const Ma={};null!=Ca.featureIds&&(Ma[this._getObjectIdField()]=Ca.featureIds[ra]);Ca=d.isSome(Ca.attributeInfo)&&Ca.attributeInfo.attributeData;if(d.isSome(Ca))for(const Ta of Object.keys(Ca))Ma[Ta]=ea.getCachedAttributeValue(Ca[Ta],ra);return Ma};Ja._createGraphic=function(ra,Ca){return this._createLayerGraphic(this._createAttributes(ra,Ca))};Ja.highlight=function(ra){const Ca=this._highlights;"number"===typeof ra?
ra=[ra]:ra instanceof t?ra=[ra]:ra instanceof y&&(ra=ra.toArray());if(Array.isArray(ra)&&0<ra.length){if(ra[0]instanceof t){const Ma=this.i3slayer.fieldsIndex,Ta=this._getObjectIdField();ra=ra.map(gb=>Fa.attributeLookup(Ma,gb.attributes,Ta));const {set:Xa,handle:ab}=Ca.acquireSet();Ca.setFeatureIds(Xa,ra);return ab}if("number"===typeof ra[0]){const {set:Ma,handle:Ta}=Ca.acquireSet();Ca.setFeatureIds(Ma,ra);return Ta}}return ma};Ja._visibleGeometryChanged=function(ra){this._elevationProvider&&(this._elevationProvider.objectChanged(ra.node),
null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=v.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})))};Ja.getNodeOpacityByIndex=function(ra){ra=this._nodeId2Meta.get(ra);return this.getNodeOpacity(ra)};Ja.getNodeOpacity=function(ra){return d.isSome(ra)?this._collection.getMaterial(ra.objectHandle).objectOpacity:0};Ja.isNodeFullyFadedIn=function(ra){return this._crossfadeHelper.isNodeFullyFadedIn(ra)};
Ja.getNodeCrossfadeMetaData=function(ra){return this._nodeId2Meta.get(ra)};Ja.markNodeToRemove=function(ra){this._controller&&this._controller.markNodeToRemove(ra)};Ja.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};Ja.foreachCrossfadeNode=function(ra){this._nodeId2Meta.forEach((Ca,Ma)=>ra(Ma,Ca))};Ja.fadeNode=function(ra,Ca,Ma){if(this.nodeCrossfadingEnabled){var Ta=this._nodeId2Meta.get(ra);d.isSome(Ta)&&this._crossfadeHelper.fadeNode(ra,Ta,Ca,Ma)}};Ja.setNodeOpacityByIndex=
function(ra,Ca){ra=this._nodeId2Meta.get(ra);d.isSome(ra)&&this._setNodeOpacity(ra,Ca)};Ja._setNodeOpacity=function(ra,Ca){this._collection.updateMaterial(ra.objectHandle,Ma=>Ma.objectOpacity=Ca);this._setNodeEdgeOpacity(ra,Ca)};Ja._setNodeEdgeOpacity=function(ra,Ca){d.isSome(this._edgeView)&&ra.cachedEdgeMaterials&&(Ua(ra.cachedEdgeMaterials,Ca),ra=ra.objectHandle,this._edgeView.hasObject(ra)&&this._edgeView.updateAllComponentOpacities(ra,Ca))};Ja.updateNodeModificationStatus=function(ra){var Ca=
ra.length;if(this._hasModifications&&!(0>=Ca)&&!0===this._i3sWasmLoaded){Ca=this.i3slayer.uid;var Ma=Ra(ra);if(d.isSome(Ma)){ja.filterObbsForModificationsSync({context:Ca,buffer:Ma.buffer});const Ta=new Float64Array(Ma.buffer);ra.forAll((Xa,ab)=>{ab=ja.interpretObbModificationResults(Ta[ab]);Xa.imModificationImpact=ab;0!==ab&&this._controller.invalidateGeometryVisibility(Xa.index)})}}};Ja.notifyUpdate=function(){this.notifyChange("updating")};Ja.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};
Ja.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||d.isSome(this._labeler)&&this._labeler.updating||this._crossfadeHelper.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading};a._createClass(Oa,[{key:"lodCrossfadeoutDuration",get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},{key:"layerUid",get:function(){return this.i3slayer&&
this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return ea.rendererNeedsTextures(this._currentRenderer)?63:44}},{key:"elevationOffset",get:function(){const ra=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=ra&&"absolute-height"===ra.mode){const Ca=G.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),
Ma=L.getMetersPerUnit(ra.unit);return d.unwrapOr(ra.offset,0)*Ma/Ca}return 0}},{key:"uncompressedTextureDownsamplingEnabled",get:function(){return this.view&&this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures}},{key:"useCompressedTextures",get:function(){var ra=this.i3slayer.version;ra=!l("trident")||1<ra.major||1===ra.major&&3<ra.minor;return this.view._stage.renderView.has(0)&&ra}},{key:"_enableMipMaps",get:function(){return!this.uncompressedTextureDownsamplingEnabled}},
{key:"_enableAtlasMipMaps",get:function(){return this._enableMipMaps}},{key:"_atlasBiasCompensationEnabled",get:function(){return this.view&&this.view._stage&&!this.view._stage.renderView.has(1)&&this._enableAtlasMipMaps}},{key:"_disableAtlasAnisotropy",get:function(){return this._atlasBiasCompensationEnabled}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&0===this._modifications.length&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"supportsNodeCrossFading",
get:function(){var ra,Ca;return!(null!=(ra=this.view)&&null!=(Ca=ra._stage)&&Ca.renderView.has(2))}},{key:"nodeCrossfadingEnabled",get:function(){return this.supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},{key:"nodeFadeoutEnabled",get:function(){return this.supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}},{key:"performanceInfo",get:function(){const ra={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,
core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.getUnloadedMemory()/1048576).toFixed(1)+"MB",...this._collection?this._collection.performanceInfo:{shown:0,hidden:0}};d.isSome(this._memCache)&&(ra.MemCache=Math.round(100*this._memCache.hitRate)+
"% hit");this._controller&&(this._idbCacheEnabled&&(ra.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(ra));return ra}},{key:"test",get:function(){const ra=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const Ca=[];ra._forAllFeatures(Ma=>{Ca.push(Ma);return 1},null,0);Ca.sort((Ma,Ta)=>Ma-Ta);return Ca},get numNodes(){return ra._nodeId2Meta.size}}}},{key:"_hasModifications",get:function(){return this._modifications&&0<
this._modifications.length}}]);return Oa}(ta);r.__decorate([f.property({})],ta.prototype,"_asyncModuleLoading",void 0);r.__decorate([f.property()],ta.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);r.__decorate([f.property()],ta.prototype,"view",void 0);r.__decorate([f.property()],ta.prototype,"i3slayer",void 0);r.__decorate([f.property()],ta.prototype,"_controller",void 0);r.__decorate([f.property()],ta.prototype,"_labeler",void 0);r.__decorate([f.property({dependsOn:["_controller.updating",
"_visibleGeometryChangedSchedulerHandle","_labeler.updating","_asyncModuleLoading"]})],ta.prototype,"updating",void 0);r.__decorate([f.property({dependsOn:["_controller.rootNodeVisible"]})],ta.prototype,"suspended",void 0);r.__decorate([f.property()],ta.prototype,"holeFilling",void 0);r.__decorate([f.property(aa.updatingProgress)],ta.prototype,"updatingProgress",void 0);r.__decorate([f.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],ta.prototype,"updatingProgressValue",void 0);r.__decorate([f.property({readOnly:!0})],
ta.prototype,"hasTexturesOrVertexColors",null);r.__decorate([f.property({readOnly:!0})],ta.prototype,"rendererTextureUsage",null);r.__decorate([f.property({readOnly:!0,dependsOn:["i3slayer.elevationInfo"]})],ta.prototype,"elevationOffset",null);r.__decorate([f.property({type:Boolean})],ta.prototype,"slicePlaneEnabled",void 0);r.__decorate([f.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","useCompressedTextures"]})],ta.prototype,"uncompressedTextureDownsamplingEnabled",
null);r.__decorate([f.property({dependsOn:["i3slayer.version"]})],ta.prototype,"useCompressedTextures",null);r.__decorate([f.property({type:[Q]})],ta.prototype,"_modifications",void 0);return ta=r.__decorate([p.subclass("esri.views.3d.layers.I3SMeshView3D")],ta)};Object.defineProperty(k,"__esModule",{value:!0})})},"esri/layers/support/SceneModification":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/lang ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/Warning ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../core/JSONSupport ../../geometry/Polygon ../../geometry ../../geometry/projection".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m){var u;a=u=function(v){function y(x){x=v.call(this,x)||this;x.geometry=null;x.type="clip";return x}b._inheritsLoose(y,v);var B=y.prototype;B.writeGeometry=function(x,C,z,A){if(A.layer&&A.layer.spatialReference&&!A.layer.spatialReference.equals(this.geometry.spatialReference)){if(!m.canProjectWithoutEngine(x.spatialReference,A.layer.spatialReference)){A&&A.messages&&A.messages.push(new e("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:A.layer.spatialReference,context:A}));return}const t=new w;m.projectPolygon(x,t,A.layer.spatialReference);C[z]=t.toJSON(A)}else C[z]=x.toJSON(A);delete C[z].spatialReference};B.clone=function(){return new u({geometry:r.clone(this.geometry),type:this.type})};return y}(n.JSONSupport);k.__decorate([d.property({type:w}),p.persistable()],a.prototype,"geometry",void 0);k.__decorate([g.writer(["web-scene","portal-item"],"geometry")],a.prototype,"writeGeometry",null);k.__decorate([d.property({type:["clip",
"mask","replace"],nonNullable:!0}),p.persistable()],a.prototype,"type",void 0);return a=u=k.__decorate([f.subclass("esri.layers.support.SceneModification")],a)})},"esri/core/accessorSupport/decorators/persistable":function(){define("require exports ../../maybe ../metadata ./property ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../PropertyOrigin ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),function(b,k,a,r,l,h,d,c,e,f,g){function p(u,v,y){const B=
r.getOwnPropertyMetadata(v,y);return{type:String,read:(x,C,z)=>{x=g.read(x,C,z);if(B.type===String)return x;if("function"===typeof B.type)return new B.type({url:x})},write:{writer(x,C,z,A){if(A&&A.resources){var t=a.isNone(x)?null:"string"===typeof x?x:x.url;t=t?g.toJSON(t,{...A,verifyItemRelativeUrls:A&&A.verifyItemRelativeUrls?{writtenUrls:A.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null}):null;var D=B.type!==String&&(!h.isMultiOriginJSONMixin(this)||A&&A.origin&&this.originIdOf(y)>e.nameToId(A.origin));
if(A&&A.portalItem&&a.isSome(t)&&!d.isAbsolute(t))if(D){{D=A.portalItem.resourceFromPath(t);const E=q(x,t,A),G=f.getResourceContentExtension(E),H=d.getPathExtension(D.path);G!==H?n(this,y,x,t,C,z,A,u):(w(this,y,D,E,A.resources.toUpdate),C[z]=t)}}else A.resources.toKeep.push({resource:A.portalItem.resourceFromPath(t)}),C[z]=t;else A&&A.portalItem&&(a.isNone(t)||a.isSome(g.itemIdFromResourceUrl(t))||d.isBlobProtocol(t)||D)?n(this,y,x,t,C,z,A,u):C[z]=t}else C[z]="string"===typeof x?g.toJSON(x,A):x.write({},
A)}}}}function n(u,v,y,B,x,C,z,A){const t=c.generateUUID();y=q(y,B,z);const D=d.join(a.get(A,"prefix"),t);A=`${D}.${f.getResourceContentExtension(y)}`;const E=z.portalItem.resourceFromPath(A);d.isBlobProtocol(B)&&z.resources.pendingOperations.push(m(B).then(G=>{E.path=`${D}.${f.getResourceContentExtension(G)}`;x[C]=E.itemRelativeUrl}).catch(()=>{}));w(u,v,E,y,z.resources.toAdd);x[C]=E.itemRelativeUrl}function w(u,v,y,B,x){x.push({resource:y,content:B,finish:C=>{"string"===typeof u[v]?u[v]=C.url:u[v].url=
C.url}})}function q(u,v,y){return"string"===typeof u?{url:v}:new Blob([JSON.stringify(u.toJSON(y))],{type:"application/json"})}async function m(u){const v=(await new Promise(function(y,B){b(["../../../request"],function(x){y(Object.freeze({__proto__:null,"default":x}))},B)})).default;({data:u}=await v(u,{responseType:"blob"}));return u}k.persistable=function(u){const v=a.isSome(u)&&u.origins?u.origins:[void 0];return(y,B)=>{a:if(a.isSome(u)&&"resource"===u.type)var x=p(u,y,B);else{switch(a.isSome(u)&&
u.type?u.type:"other"){case "other":x={read:!0,write:!0};break a;case "url":{const {read:C,write:z}=g.persistableUrlUtils;x={read:C,write:z};break a}}x=void 0}for(const C of v){const z=l.propertyJSONMeta(y,C,B);for(const A in x)z[A]=x[A]}}};Object.defineProperty(k,"__esModule",{value:!0})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/PooledArray ../../../core/promiseUtils ../../../core/Accessor ../../../core/Promise ../../../core/Handles ../../../core/watchUtils ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../support/PromiseQueue ../../../views/support/Scheduler ../../../geometry/support/aaBoundingBox ../../../views/support/layerViewUtils ../dehydratedFeatures ../../../views/3d/support/extentUtils ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SViewportQueries".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L){function S(P,U){return r.isSome(P)&&P.length===U.length&&P.every(V=>0<=M(U,V.name))}function M(P,U){U=U.toLowerCase();for(let V=0;V<P.length;V++)if(P[V].name.toLowerCase()===U)return V;return-1}const T=l.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");l=function(P){function U(W){W=P.call(this,W)||this;W.screenSizeFactor=0;W.featureTarget=5E4;W.fixedFeatureTarget=!1;W.updating=!0;W.updatingProgress=1;W.leavesReached=
!1;W.scaleVisibilityEnabled=!0;W.uncompressedTextureDownsamplingEnabled=!1;W._featureLOD=1;W._stableFeatureLOD=!1;W._isIdle=!1;W._cameraDirty=!0;W._invisibleDirty=!1;W._newLoadingNodes=new n({deallocator:null});W._loadedNodeScales=new Map;W._modificationsNodeFilteringArray=new n;W._downloadingCount=0;W._loadingNodes=new Map;W._updatingNodes=new Map;W._progressMaxNumNodes=1;W._requiredAttributes=[];W._requiredAttributesDirty=!0;W._updatesDisabled=!1;W.disableIDBCache=!1;W._disableMemCache=!1;W._restartNodeLoading=
!1;W._fields=null;W._attributeStorageInfo=null;W._handles=new u;W._idleQueue=new x;W._elevationUpdateNodes=new n({deallocator:null});W._errorCount=0;return W}b._inheritsLoose(U,P);var V=U.prototype;V.initialize=function(){this._disableMemCache=!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData;this._lodHandling=new I(this.layerView);const W=this.layerView.i3slayer;this.layer=W;this._defaultGeometrySchema=W.store.defaultGeometrySchema;this.disableIDBCache=a("disable-feature:idb-cache");
"fields"in W&&(this._fields=W.fields,this._attributeStorageInfo=W.attributeStorageInfo);this.addResolvingPromise(w.all([this.layer.when(),this.layerView.when()]).then(()=>{if(!this.destroyed&&this.layerView&&!this.layerView.destroyed){var X=this.layerView.view;this._setClippingArea(X.clippingArea);var ca=this.layerView.view.resourceController;this._handles.add([v.init(X,"pointsOfInterest.focus.renderLocation",R=>this._pointOfInterestChanged(R)),ca.memoryController.events.on("quality-changed",()=>
this._setCameraDirty()),v.init(this.layerView,"suspended",R=>{const aa=R?()=>this._updateViewData():()=>this._updateIdleState(!0),ka=R?()=>{}:()=>this._updateIdleState(!1);this._idleStateCallbacks?(R&&this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=aa,this._idleStateCallbacks.idleEnd=ka):this._idleStateCallbacks=ca.scheduler.registerIdleStateCallbacks(aa,ka)}),E.addTask(this.layerView.view.resourceController.scheduler,{update:(R,aa)=>this._frame(R,aa),needsUpdate:()=>
this.updating}),this.watch("uncompressedTextureDownsamplingEnabled",()=>this.restartNodeLoading()),this.watch(["featureTarget","fixedFeatureTarget"],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),X.state.watch("camera",()=>this._setCameraDirty()),this.layer.watch("elevationInfo",()=>this._elevationInfoChanged()),this.layer.watch(["minScale","maxScale"],()=>this._scaleBoundsChanged()),this.layerView.watch("lodFactor",()=>this._setCameraDirty()),this.layerView.watch("availableFields?",()=>
this._requiredFieldsChange()),this.layerView.watch("holeFilling",R=>r.isSome(this._index)&&(this._index.holeFilling=R))]);this._updateScaleHandles();this._viewportQueries=new L(this.crsIndex,X.renderCoordsHelper,X.state.camera,this._clippingArea,X.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this.lod,angleDependentLoD:.5>this.lod});this._index=new H.I3SIndex(W,this.indexStreamController,this._viewportQueries,T,this.layerView.holeFilling,
R=>this.layerView.isNodeLoaded(R),R=>this.layerView.isNodeReloading(R),R=>this._shouldLoadNode(R),R=>this._enableFromGPUCache(R,1),R=>this._needsUpdate(R),()=>!this.indexStreamController.busy,R=>this.layerView.computeVisibilityObb?this.layerView.computeVisibilityObb(R):null);X=r.isSome(this.layer.modifications)&&this.layer.modifications&&0<this.layer.modifications.length;this._index.imModificationsChanged(X);this._startNodeLoading()}}));this._tmpPoint=t.makeDehydratedPoint(0,0,0,this.crsIndex)};V.updateNodeModificationStatus=
function(W){const X=this._index,ca=this.layerView;r.isSome(X)&&ca&&ca.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),W.forAll(R=>{R=X.getNode(R);r.isSome(R)&&this._modificationsNodeFilteringArray.push(R)}),ca.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)};V.destroy=function(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();
this._nodeLoader=null;O.prune();r.isSome(Q)&&(Q.remove(),Q=null)};V._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const W=this._attributeStorageInfo,X=this._fields,ca=this.layer.objectIdField;return this.layerView.availableFields.map(R=>{const aa=M(W,R);R=M(X,R);return 0<=aa&&0<=R?{index:aa,name:X[R].name,field:X[R],attributeStorageInfo:W[aa]}:null}).filter(R=>null!=R&&R.name!==ca)};V._requiredFieldsChange=function(){const W=
this._getRequiredAttributes();S(this._requiredAttributes,W)||(this._requiredAttributes=W,this._requiredAttributesDirty=!1,this.restartNodeLoading())};V.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};V._setClippingArea=function(W){const X=z.create();D.projectToBoundingBox(W,X,this.layerView.view.renderSpatialReference)?this._clippingArea=X:this._clippingArea=null};V._pointOfInterestChanged=function(W){r.isSome(this._viewportQueries)&&(this._viewportQueries.setPointOfInterest(W),
r.isSome(this._index)&&(this._index.progressiveLoadPenalty=F.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))};V.updateClippingArea=function(W){this._setClippingArea(W);r.isSome(this._viewportQueries)&&r.isSome(this._index)&&(this._viewportQueries.updateExtent(this._clippingArea),this._index.invalidateVisibilityCache());this._setCameraDirty()};V._setCameraDirty=function(){this._cameraDirty=!0;this.notifyChange("rootNodeVisible");this._lodHandling.setLodGlobalDirty();
this._evaluateUpdating()};V.updateElevationChanged=function(W,X){const ca=this._index;if(!r.isNone(ca)){var R=ca.rootNode;if(!r.isNone(R)){var aa=this._elevationUpdateNodes;aa.clear();G.findIntersectingNodes(W,X,R,this.crsIndex,ca,ka=>aa.push(ka.index));aa.forAll(ka=>{ca.invalidateBoundingVolumeCache(ka);ka===R.index&&this.notifyChange("rootNodeVisible")});aa.length&&this.restartNodeLoading()}}};V.getParentIndex=function(W){return r.isSome(this._index)&&this._index.getParentIndex(W)};V._elevationInfoChanged=
function(){r.isSome(this._index)&&this._index.updateElevationInfo(this.layer.elevationInfo);this._setCameraDirty()};V._updateScaleHandles=function(){this._handles.remove("scale-bounds");this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",W=>this._scaleUpdateHandler(W)),"scale-bounds")};V._scaleBoundsChanged=function(){this.areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};V._scaleUpdateHandler=function(W){this._updateScaleInBoundingRect(W.scale,
W.extent,W.spatialReference);this._setCameraDirty()};V._updateScaleInBoundingRect=function(W,X,ca){const R=this._index;r.isNone(R)||!r.isNone(R.rootNode)&&B.projectBoundingRect(X,ca,N,this.crsIndex)&&this._loadedNodeScales.forEach((aa,ka)=>{aa=R.getNode(ka);r.isSome(aa)&&y.containsPoint(N,aa.mbs)&&this._loadedNodeScales.set(ka,W)})};V.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};V.schedule=function(W,X){return this._idleQueue.push(W,
X)};V.reschedule=function(W,X){return this._idleQueue.unshift(W,X)};V._frame=function(W,X){if(this.layerView.suspended)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||r.isNone(this._index))return-Infinity;this._processLogError(W,X);return this._index.getPriority()};V._processLogError=function(W,X){try{this._process(W,X)}catch(ca){50>this._errorCount?T.error("Error during processing: "+ca):50===this._errorCount&&T.error("Too many errors for this layer. Further errors will not be displayed."),
this._errorCount++}};V._process=function(W,X){this._restartNodeLoading&&this._startNodeLoading();if(null!=this._nodeLoader&&!r.isNone(this._index)){this._updateViewData();this._invisibleDirty&&this._removeInvisibleNodes(W)&&(this._invisibleDirty=!1);this.isIntegratedMesh&&(W.enabled=!1);W.run(()=>this._processIndex(W));this._updateFeatureLOD();W.run(()=>this._processCache(W));this.isIntegratedMesh&&(W.enabled=!0);for(W.run(()=>this._processNodes(W,X));!W.done&&this._idleQueue.process();)W.madeProgress();
W.run(()=>this._prefetchIndex());X.numIndexLoading+=this._index.getIndexLoading();X.numNodesLoading+=this._downloadingCount;W.run(()=>this._lodHandling.lodGlobalHandling(W));this._evaluateUpdating()}};V._processIndex=function(W){if(r.isNone(this._index))return!1;this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update([...this._loadingNodes.keys()],W,X=>this.updateNodeModificationStatus(X)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),
this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),W=this._index.featureEstimate.leavesReached,this._index.isLoading()||W===this._get("leavesReached")||this._set("leavesReached",W));return this._index.load()};V._prefetchIndex=function(){return r.isNone(this._index)||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};V._updateFeatureLOD=function(){if(this.isGraphics3D&&!r.isNone(this._index)&&!r.isNone(this._viewportQueries)){var W=
!this._index.isLoading(),X=this.featureTarget*this.baseLOD,ca=this._index.featureEstimate;ca.estimate=ca.estimate||X/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(W&&ca.estimate<X){if(ca.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(X/ca.estimate,1.001));W=this.lod;X=this._index.checkFeatureTarget(X,W);X!==W&&(this._featureLOD=X/this.baseLOD,this._stableFeatureLOD=
!0)}else if(ca.estimate>1.2*X||W&&ca.estimate>X){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(ca.estimate/X-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.requestUpdate()}};V._processCache=function(W){const X=this._index;if(r.isNone(X))return!1;for(;0<this._newLoadingNodes.length&&!W.done;){var ca=this._newLoadingNodes.pop();for(ca=X.getParent(ca);r.isSome(ca)&&
!this.layerView.isNodeLoaded(ca.index)&&this._isNodeInScaleBounds(ca);ca=X.getParent(ca.index))if(this._enableFromGPUCache(ca,0)){W.madeProgress();break}}return W.hasProgressed};V._processNodes=function(W,X){if(r.isNone(this._index))return!1;let ca=(this._isIdle?100:2)-this._loadingNodes.size;const R=this._index.updates;R.cancel.forEach(this._cancelNode,this);for(R.cancel=[];0<R.remove.length&&!W.done;)this.layerView.removeNode(R.remove.pop()),W.madeProgress();for(;0<R.update.length&&!W.done;){var aa=
this._index.getNode(R.update.pop());r.isSome(aa)&&(this._updateLoadedNode(aa),W.madeProgress())}for(;0<R.add.length&&!W.done&&0<ca;){--ca;aa=this._index.getNode(R.add.back());if(r.isNone(aa)||2!==aa.cacheState&&!this._hasNodeLoadToken(X))break;R.add.pop();this._loadNode(aa);W.madeProgress()}return W.hasProgressed};V._cancelAllNodes=function(){this._loadingNodes.forEach(W=>W.abort());this._loadingNodes.clear();this._updatingNodes.forEach(W=>W.abort());this._updatingNodes.clear()};V._cancelNode=function(W){const X=
this._loadingNodes.get(W);X&&(X.abort(),this._loadingNodes.delete(W))};V._hasNodeLoadToken=function(W){return!this._isIdle&&2<=W.numNodesLoading+this._loadingNodes.size?!1:!this.dataStreamController.busy};V._evaluateUpdating=function(){var W=!1,X=0;this.layerView.suspended?X=(W=this._cameraDirty)?.5:1:(W=r.isSome(this._index)?this._index.getIndexMissing():0,X=r.isSome(this._index)?this._index.updates.add.length:0,X=W+3*X+2*this._loadingNodes.size,W=!!(0<X||0<this._updatingNodes.size||this._restartNodeLoading||
this._cameraDirty||0<this._idleQueue.length||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===X&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(X,this._progressMaxNumNodes),X=1-X/this._progressMaxNumNodes);W!==this.updating&&this._set("updating",W);X!==this.updatingProgress&&this._set("updatingProgress",X)};V._updateViewData=function(){if(this._cameraDirty&&!r.isNone(this._index)&&!r.isNone(this._viewportQueries)){var W=this.layerView.view,X=W.state.camera;this.screenSizeFactor=
1/(X.perScreenPixelRatio/2);this._viewportQueries.updateCamera(X);this._viewportQueries.setPointOfInterest(W.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=F.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};V._getProgressiveLoadFactor=
function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};V.isGeometryVisible=function(W){return r.isSome(this._index)&&this._index.isGeometryVisible(W.index)};V.updateVisibility=function(W){r.isSome(this._index)&&this._index.invalidateNodeVisibilityCache(W)};V.updateBoundingVolume=function(W){r.isSome(this._index)&&this._index.invalidateBoundingVolumeCache(W)};V.invalidateGeometryVisibility=function(W){r.isSome(this._index)&&
this._index.invalidateGeometryVisibility(W)};V.invalidateVisibilityObbs=function(){r.isSome(this._index)&&this._index.invalidateVisibilityObbs()};V.modificationsChanged=function(){if(r.isSome(this._index)){const W=r.isSome(this.layer.modifications)&&this.layer.modifications&&0<this.layer.modifications.length;this._index.imModificationsChanged(W)}this._invisibleDirty=!0};V._shouldLoadNode=function(W){return this._lodHandling.shouldLoadNode(W)&&!this._shouldDropNode(W)&&this._isNodeInScaleBounds(W)?
r.isSome(this._index)?this._index.isGeometryVisible(W.index):!1:!1};V._shouldDropNode=function(W){if(r.isNone(this._viewportQueries))return!1;const X=this.lodDropFactor;return 1<=X||!this._lodHandling.hasNoVisibleChildren(W)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(W))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*X};V._startNodeLoading=function(){this._restartNodeLoading=!1;const W=this._index;if(!(this._updatesDisabled||
r.isNone(W)||r.isNone(this._viewportQueries))){this._updateViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1);var X=J.TextureFormat.Normal;this.layerView.useCompressedTextures?X=J.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(X=J.TextureFormat.Downsampled);this._nodeLoader=new J(this.layer,this.dataStreamController,T,this._defaultGeometrySchema,this._requiredAttributes,{textureFormat:X,textureUsageMask:this.layerView.rendererTextureUsage,
loadFeatureData:!this.isMeshPyramid});W.requestUpdate();this._lodHandling.startNodeLoading(ca=>this._isNodeInScaleBounds(ca),(ca,R)=>this._removeNodes(ca,R,1),W,{maxLodLevel:this._viewportQueries.maxLodLevel});this._evaluateUpdating()}};V.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};V.cancelNodeLoading=function(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=
null,this._evaluateUpdating())};V._removeInvisibleNodes=function(W){const X=this._index;if(r.isNone(X)||r.isNone(this._viewportQueries))return!1;O.clear();this.layerView.getLoadedNodeIndices(O);const ca=0===this._viewportQueries.maxDistance,R=ca?()=>!1:aa=>this._shouldDropNode(aa);O.filterInPlace(aa=>{const ka=X.getNode(aa);return r.isNone(ka)||!X.isGeometryVisible(aa)||R(ka)||!this._isNodeInScaleBounds(ka)});0<O.length&&this._lodHandling.setLodGlobalDirty();this._removeNodes(O,W,0);if(ca&&1>this.lodDropFactor)return!1;
if(0===O.length)return!0;O.clear();return!1};V.markNodeToRemove=function(W){O.push(W)};V.removeMarkedNodes=function(){this._removeNodes(O,C.noBudget,0)};V._removeNodes=function(W,X,ca){const R=W.length;if(0!==R&&!X.done){for(r.isSome(this._index)&&this._index.requestUpdate();0<W.length&&!X.done;){const aa=W.pop(),ka=this._index;1===ca&&this.layerView.nodeFadeoutEnabled&&r.isSome(ka)&&ka.isGeometryVisible(aa)?this.layerView.fadeNode(aa,1,!0):this.layerView.removeNode(aa);X.madeProgress()}if(0<this._loadedNodeScales.size)for(X=
W.length;X<R;X++)this._loadedNodeScales.delete(W.data[X])}};V._needsUpdate=function(W){if(!W.resources.hasFeatureData||this._updatingNodes.has(W.index))return!1;W=this.layerView.getLoadedAttributes(W.index);return null!=W&&W!==this._requiredAttributes};V._updateLoadedNode=function(W){const X=w.createAbortController();this._updatingNodes.set(W.index,X);const ca=this.layerView.getLoadedAttributes(W.index);(S(ca,this._requiredAttributes)?w.resolve(this.layerView.getAttributeData(W.index)):this._nodeLoader.loadAttributes(W,
this._requiredAttributes,X.signal)).then(R=>this.schedule(()=>this.layerView.updateAttributes(W.index,{loadedAttributes:this._requiredAttributes,attributeData:R},X.signal),X.signal)).catch(R=>{if(!w.isAbortError(R))return this.layerView.updateAttributes(W.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},X.signal)}).catch(()=>{}).then(()=>{this._updatingNodes.delete(W.index);this._evaluateUpdating()});this._evaluateUpdating()};V._loadNode=function(W){if(this._loadingNodes.has(W.index))T.error("already loading node "+
W.index);else{var X=w.createAbortController();this._loadingNodes.set(W.index,X);var ca=()=>{this._loadingNodes.get(W.index)===X&&this._loadingNodes.delete(W.index);this._evaluateUpdating()};this._evaluateUpdating();this._loadAndAddNode(W,X.signal).then(ca).catch(R=>{ca();if(!w.isAbortError(R))throw R;})}};V._loadAndAddNode=function(W,X){return 1===W.cacheState?this._loadUncached(W,X):this._loadCached(W,X).then(ca=>{ca||(W.cacheState=1,r.isSome(this._index)&&this._index.updates.add.push(W.index))}).catch(ca=>
{if(!w.isAbortError(ca))throw W.cacheState=1,ca;})};V._enableFromGPUCache=function(W,X){if(this._disableMemCache||r.isNone(this._index))return!1;if(0===X&&!this._index.useNodeAsHole(W.index))return!0;const ca=this._loadCachedGPUData(W);if(!ca)return!1;this.layerView.addCachedGPUData(W,ca,X);this._nodeAdded();return!0};V._loadCachedGPUData=function(W){W=this.layerView.loadCachedGPUData(W);if(r.isSome(W)&&r.isSome(W.attributeInfo)&&S(W.attributeInfo.loadedAttributes,this._requiredAttributes))return W;
this.layerView.deleteCachedGPUData(W);return null};V._nodeAdded=function(){r.isSome(this._index)&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};V._loadCached=function(W,X){if(this._enableFromGPUCache(W,1))return w.resolve(!0);const ca=this.layerView;return!this.disableIDBCache&&ca.loadCachedNodeData&&ca.addCachedNodeData?this.schedule(()=>ca.loadCachedNodeData(W,X,(R,aa)=>this._nodeLoader.loadTextures(W,R,aa)),X).then(R=>{if(r.isNone(R))return!1;const aa=
this._requiredAttributes;return this.reschedule(()=>this._nodeLoader.loadAttributes(W,aa,X),X).then(ka=>this.reschedule(()=>ca.addCachedNodeData(W,R,{loadedAttributes:aa,attributeData:ka},X),X)).then(()=>{this._nodeAdded();return!0})}):w.resolve(!1)};V._loadUncached=function(W,X){this._downloadingCount++;return this._nodeLoader.loadNodeData(W,X).catch(ca=>{this._downloadingCount--;throw ca;}).then(ca=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(W,ca,X),X)}).then(()=>
{this._nodeAdded();W.cacheState=2}).catch(ca=>{if(!w.isAbortError(ca))throw T.error("#loadNodeData()",this.layer,`Failed to load node '${W.id}'`,ca),W.failed=!0,r.isSome(this._index)&&this._index.requestUpdate(),ca;})};V._updateIdleState=function(W){W!==this._isIdle&&(this._isIdle=W,this._evaluateUpdating(),W&&this._index&&r.isSome(this._index)&&this._index.resetFailedNodes())};V._getScale=function(W){if(this._loadedNodeScales.has(W.index))return this._loadedNodeScales.get(W.index);this._tmpPoint.x=
W.mbs[0];this._tmpPoint.y=W.mbs[1];this._tmpPoint.z=W.mbs[2];const X=this.layerView.view.basemapTerrain.getScale(this._tmpPoint);this.layerView.isNodeLoaded(W.index)&&this._loadedNodeScales.set(W.index,X);return X};V._isNodeInScaleBounds=function(W){if(!this.areScaleBoundsActive)return!0;W=this._getScale(W);const {minScale:X,maxScale:ca}=A.extractSafeScaleBounds(this.layer);return A.scaleBoundsPredicate(W,X,ca)};V.updateStats=function(W){W.index=r.isSome(this._index)?this._index.size:0;this.isGraphics3D&&
(W.detail=this._featureLOD,W.target=this.featureTarget*this.baseLOD);r.isSome(this._index)&&this._index.updateStats(W)};V.notifyLODUpdate=function(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();r.isSome(this._index)&&this._index.requestUpdate()};b._createClass(U,[{key:"isMeshPyramid",get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType}},{key:"isGraphics3D",get:function(){return"points"===this.layer.profile}},{key:"indexStreamController",
get:function(){const W=this.layerView.view.resourceController.createStreamDataRequester(2);return new K.I3SStreamDataController(W)}},{key:"dataStreamController",get:function(){const W=this.layerView.view.resourceController.createStreamDataRequester(3);return new K.I3SStreamDataController(W)}},{key:"crsVertex",get:function(){return G.getVertexCrs(this.layer)}},{key:"crsIndex",get:function(){return G.getIndexCrs(this.layer)}},{key:"rootNodeVisible",get:function(){if(r.isSome(this._index)){const W=this._index.rootNode;
if(r.isSome(W))return this._updateViewData(),this._index.isNodeVisible(W.index)}return!0}},{key:"isIntegratedMesh",get:function(){return"integrated-mesh"===this.layer.type}},{key:"areScaleBoundsActive",get:function(){const {minScale:W,maxScale:X}=A.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<W||0<X)}},{key:"unloadedMemoryEstimate",get:function(){return r.isNone(this._index)||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor}},{key:"indexDepth",
get:function(){return r.isSome(this._index)?this._index.maxLevel:0}},{key:"disableMemCache",set:function(W){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||(this._disableMemCache=!0);this._disableMemCache=W}},{key:"lod",get:function(){return this._featureLOD*this.baseLOD}},{key:"baseLOD",get:function(){const W=this.layerView.lodFactor,X=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<W?W:1)*X}},{key:"lodDropFactor",get:function(){if(this.fixedFeatureTarget)return 1;
const W=this.layerView.view.resourceController.memoryController;return(Math.min(W.memoryFactor,.5)-W.minQuality)/(.5-W.minQuality)}},{key:"test",get:function(){const W=this;return{index:this._index,set disableUpdates(X){(W._updatesDisabled=X)?W.cancelNodeLoading():W.requestUpdate()},set disableIDBCache(X){W.disableIDBCache=X},set ignoreServiceObb(X){r.isSome(W._index)&&(W._index.ignoreServiceObb=X)},shouldLoadNode:X=>W._shouldLoadNode(X)}}}]);return U}(m.EsriPromiseMixin(q));k.__decorate([d.property({readOnly:!0})],
l.prototype,"isMeshPyramid",null);k.__decorate([d.property({readOnly:!0})],l.prototype,"isGraphics3D",null);k.__decorate([d.property({readOnly:!0})],l.prototype,"indexStreamController",null);k.__decorate([d.property({readOnly:!0})],l.prototype,"dataStreamController",null);k.__decorate([d.property({readOnly:!0})],l.prototype,"crsVertex",null);k.__decorate([d.property({readOnly:!0})],l.prototype,"crsIndex",null);k.__decorate([d.property()],l.prototype,"screenSizeFactor",void 0);k.__decorate([d.property()],
l.prototype,"featureTarget",void 0);k.__decorate([d.property()],l.prototype,"fixedFeatureTarget",void 0);k.__decorate([d.property()],l.prototype,"layerView",void 0);k.__decorate([d.property()],l.prototype,"layer",void 0);k.__decorate([d.property({readOnly:!0})],l.prototype,"updating",void 0);k.__decorate([d.property({readOnly:!0})],l.prototype,"updatingProgress",void 0);k.__decorate([d.property({readOnly:!0})],l.prototype,"leavesReached",void 0);k.__decorate([d.property({constructOnly:!0})],l.prototype,
"scaleVisibilityEnabled",void 0);k.__decorate([d.property({readOnly:!0,dependsOn:[]})],l.prototype,"rootNodeVisible",null);k.__decorate([d.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled?"})],l.prototype,"uncompressedTextureDownsamplingEnabled",void 0);l=k.__decorate([e.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],l);const O=new n({deallocator:null});let Q;const F={factorIM:.2,factor3dObject:.05,distancePenalty:10},N=y.create();return l})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["exports",
"../../../../core/arrayUtils","../../../support/Scheduler"],function(b,k,a){let r=function(){function h(c){this.referenceCount=0;this.callbacks=[];this.runIndex=0;this.handle=c.registerTask(a.Task.I3S_CONTROLLER,e=>this.update(e),()=>this.needsUpdate())}var d=h.prototype;d.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)};d.needsUpdate=function(){for(const c of this.callbacks)if(c.needsUpdate())return!0;return!1};d.update=function(c){this.sort();const e=this.callbacks,f={numIndexLoading:0,
numNodesLoading:0};for(let g=0;g<e.length&&!c.done;++g)e[g].priority=e[g].update(c,f),this.runIndex=g};d.sort=function(){const c=this.callbacks;let e=c.length;for(let f=this.runIndex;0<f;f--){const g=c[f-1];let p=f;for(;p<c.length&&g.priority<=c[p].priority&&(p!==e||g.priority<c[p].priority);)c[p-1]=c[p],p++;c[p-1]=g;e=p-1}this.runIndex=0};d.add=function(c){this.sort();c.priority=Infinity;this.callbacks.unshift(c)};d.remove=function(c){k.removeUnordered(this.callbacks,c);this.runIndex=this.callbacks.length;
this.sort()};return h}();const l=new Map;b.addTask=function(h,d){let c=l.get(h);null==c&&(c=new r(h),l.set(h,c));c.add(d);return{remove:()=>{null!=c&&(c.remove(d),0<c.callbacks.length||(l.delete(h),c.destroy()),c=null)}}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../support/orientedBoundingBox ./I3SNode ./I3SUtil".split(" "),
function(b,k,a,r,l,h,d,c,e,f){function g(C){a.isSome(C.node)&&(C.node.renderMbs[3]=-1,a.isSome(C.node.serviceObbInRenderSR)&&(C.node.serviceObbInRenderSR.halfSize[0]=-1));a.isSome(C.ref)&&(C.ref.renderMbs[3]=-1,a.isSome(C.ref.serviceObbInRenderSR)&&(C.ref.serviceObbInRenderSR.halfSize[0]=-1))}function p(C,z){return 0===z?0:C/z|0}function n(C,z){return 0===z?C:C%z}function w(C){if(C)for(let z=0;z<C.length;z++)for(const A of B)if(A[0]===C[z].metricType)return{lodMetric:A[1],maxError:C[z].maxError};
return{lodMetric:0,maxError:0}}function q(C){return Math.sqrt(4/Math.PI*C)}let m=function(C,z,A,t,D){this.childOffset=C;this.childCount=z;this.visibilityCache=A;this.ref=t;this.node=D;this.useAsHole=0},u=function(){function C(A,t,D,E,G,H,I,J,K,L,S,M){this.streamDataController=t;this.viewportQueries=D;this.logger=E;this.holeFilling=G;this._isLoaded=H;this._isReloading=I;this._isSelected=J;this._enable=K;this._needsUpdate=L;this._canRequest=S;this._computeVisibilityObb=M;this._dirty=!0;this._nodePages=
[];this.lodMetric=this.rootIndex=this.nodesPerPage=this.nodeCount=0;this.lodConversion=T=>T;this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState=new Map;this._version=f.addWraparound(0,2);this._visibilityCacheVersion=f.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,leavesReached:!1};this._unloadedMemoryEstimate=0;
this._missing=new r({deallocator:null});this._prefetch=new r({deallocator:null});this._updates=new y;this._imModificationUncategorized=new r({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this.layerHasModifications=!1;this.logLayer=A;this.layerUrl=A.parsedUrl.path;this.rootId=A.rootNode&&A.rootNode.split("/").pop();A.serviceUpdateTimeStamp&&A.serviceUpdateTimeStamp.lastUpdate&&(this.lastUpdate=`${A.serviceUpdateTimeStamp.lastUpdate}`);this._maxLodLevel=this.viewportQueries?
this.viewportQueries.maxLodLevel:1;(A=A.nodePages)?this.initNodePages(A):this.initNodeDocuments(this.rootId)}var z=C.prototype;z.initNodePages=function(A){this.nodesPerPage=A.nodesPerPage;this.rootIndex=A.rootIndex;switch(A.lodSelectionMetricType){case "maxScreenThreshold":this.lodMetric=1;break;case "maxScreenThresholdSQ":this.lodMetric=1,this.lodConversion=q}};z.initNodeDocuments=function(A){this.rootIndex=this.nodesPerPage=0;this._nodePages.push({nodes:[],children:[],parents:[]});this.makeRefNode(new e.NodeBase(A,
null),-1)};z.loadPage=function(A){this._loading.add(A);this.streamDataController.request(`${this.layerUrl}/nodepages/${A}`,"json").then(t=>{this._loading.delete(A);this.addPage(A,t)}).catch(t=>{this._loading.delete(A);if(!l.isAbortError(t)){if(0===this._nodePages.length)return this.initNodeDocuments(this.rootId);this._failedPages.add(A);this.logger.error("#loadPage()",this.logLayer,`Error when loading page ${A}`,t)}})};z.addPage=function(A,t){for(let G=this._nodePages.length;G<A;G++)this._nodePages[G]=
null;const D=[],E=[];t=t.nodes.map((G,H)=>{const I=D.length,J=G.children?G.children.length:0;E.push(-1);for(var K=0;K<J;K++)D.push(G.children[K]);const L=`${G.index}`;K=c.clone(G.obb);const S=d.fromArray([K.center[0],K.center[1],K.center[2],h.length(K.halfSize)]),M=G.mesh&&G.mesh.attribute,T=G.mesh&&G.mesh.geometry,O=G.mesh&&G.mesh.material;G=new e.Node(L,A*this.nodesPerPage+H,S,J,0,{hasSharedResource:!1,hasFeatureData:!!T,attributes:M&&null!=M.resource?`${M.resource}`:null,geometry:T&&null!=T.resource?
`${T.resource}`:null,texture:O&&null!=O.resource?`${O.resource}`:null,geometryDefinition:T?T.definition:-1,materialDefinition:O?O.definition:-1},this.lastUpdate,this.lodMetric,this.lodConversion(G.lodThreshold),T?T.featureCount:null);G.serviceObb=K;G.visibilityObb=this._computeVisibilityObb(G);G.vertexCount=T?T.vertexCount:0;return new m(I,J,f.addWraparound(this._visibilityCacheVersion,-2),null,G)});this._nodePages[A]={nodes:t,children:D,parents:E};this.nodeCount+=t.length;this.updateParentsAndLevel()};
z.updateParentsAndLevel=function(){const A=[],t=(D,E,G)=>{const H=this.getPage(D);if(a.isSome(H)){const I=n(D,this.nodesPerPage);H.parents[I]=E;E=H.nodes[I].node;a.isSome(E)&&(E.level=G,A.push(D))}};for(t(this.rootIndex,-1,0);A.length;){const D=A.pop(),E=this.getNode(D);if(a.isSome(E))for(let G=0;G<E.childCount;G++){const H=this.getChildIndex(E,G);t(H,D,E.level+1);this._maxLevel=Math.max(this._maxLevel,E.level+1)}}};z.getPage=function(A){return this._nodePages[p(A,this.nodesPerPage)]};z.getNodeInternal=
function(A){const t=this.getPage(A);return a.isNone(t)?null:t.nodes[n(A,this.nodesPerPage)]};z.addNode=function(A,t){null!=A.children&&this.populateChildren(t,A.children);var D=this.getParent(t);D=a.isSome(D)?D.level+1:0;this._maxLevel=Math.max(this._maxLevel,A.children?D+1:D);const {lodMetric:E,maxError:G}=w(A.lodSelection),H=a.unwrap(this.getNodeInternal(t));H.node=new e.Node(A.id,t,d.fromArray(A.mbs),H.childCount,D,A.resources,A.version,E,G,A.numFeatures);A.obb&&(H.node.serviceObb=c.clone(A.obb));
H.node.visibilityObb=this._computeVisibilityObb(H.node);a.isSome(H.ref)&&(null==H.ref.mbs&&(H.ref.mbs=A.mbs),H.node.renderMbs=H.ref.renderMbs,H.node.serviceObbInRenderSR=H.ref.serviceObbInRenderSR,H.ref.visibilityObb=H.node.visibilityObb);return H.node};z.makeRefNode=function(A,t){const D=this._nodePages[0],E=D.nodes.length;D.nodes.push(new m(0,0,f.addWraparound(this._visibilityCacheVersion,-2),A,null));this.nodeCount++;D.parents.push(t);A.renderMbs[3]=-1;a.isSome(A.serviceObbInRenderSR)&&(A.serviceObbInRenderSR.halfSize[0]=
-1);return E};z.populateChildren=function(A,t){var D=a.unwrap(this.getNodeInternal(A));const E=a.unwrap(this.getPage(A));D.childOffset=E.children.length;D.childCount=t.length;for(D=0;D<t.length;D++){const G=this.makeRefNode(t[D],A);E.children.push(G)}};z.getNode=function(A){A=this.getNodeInternal(A);return a.isSome(A)?A.node:null};z.getIndexById=function(A){let t;this.forAllNodes((D,E)=>{a.isSome(D.node)&&D.node.id===A?t=E:a.isSome(D.ref)&&D.ref.id===A&&(t=E)});return t};z.getNodeById=function(A){A=
this.getIndexById(A);return 0<=A?this.getNode(A):null};z.getChildIndex=function(A,t){const D=this.getPage(A.index);if(a.isNone(D))return-1;A=D.nodes[n(A.index,this.nodesPerPage)];return D.children[A.childOffset+t]};z.getParentIndex=function(A){const t=this.getPage(A);return a.isSome(t)?t.parents[n(A,this.nodesPerPage)]:-1};z.getParent=function(A){A=this.getParentIndex(A);return 0<=A?this.getNode(A):null};z.isLeaf=function(A){A=this.getNodeInternal(A);return a.isSome(A)&&0===A.childCount};z.invalidateVisibilityCache=
function(){this._visibilityCacheVersion=f.addWraparound(this._visibilityCacheVersion,2)};z.invalidateNodeVisibilityCache=function(A){A=this.getNodeInternal(A);a.isSome(A)&&this.invalidateNodeVisibilityCacheInternal(A)};z.invalidateNodeVisibilityCacheInternal=function(A){A.visibilityCache=f.addWraparound(this._visibilityCacheVersion,-2)};z.invalidateBoundingVolumeCache=function(A){A=this.getNodeInternal(A);a.isSome(A)&&(g(A),this.invalidateNodeVisibilityCacheInternal(A))};z.invalidateGeometryVisibility=
function(A){A=this.getNodeInternal(A);a.isSome(A)&&a.isSome(A.node)&&(A.node.geometryObb=null,A.node.renderMbs[3]=-1,a.isSome(A.node.serviceObbInRenderSR)&&(A.node.serviceObbInRenderSR.halfSize[0]=-1))};z.invalidateVisibilityObbs=function(){a.isNone(this.rootNode)||this.traverse(this.rootNode,A=>{A.visibilityObb=this._computeVisibilityObb(A);A.geometryObb=null;return!0})};z.isNodeVisible=function(A){A=this.getNodeInternal(A);if(a.isNone(A)||a.isSome(A.ref)&&!A.ref.mbs)return!0;if((A.visibilityCache&
-2)!==this._visibilityCacheVersion){var t=A.node;const D=a.isSome(t)&&(a.isNone(A.ref)||a.isSome(t.visibilityObb))?t:a.isSome(A.ref)?A.ref:null;t=!(a.isSome(t)&&2===t.imModificationImpact)&&(!D||this.viewportQueries.isNodeVisible(D));A.visibilityCache=this._visibilityCacheVersion+(t?1:0);return t}return 1===(A.visibilityCache&1)};z.isGeometryVisible=function(A){if(!this.isNodeVisible(A))return!1;A=this.getNodeInternal(A);return a.isSome(A)&&a.isSome(A.node)&&a.isSome(A.node.geometryObb)&&(!this.layerHasModifications||
4!==A.node.imModificationImpact)?this.viewportQueries.isGeometryVisible(A.node):!0};z._traverseCoverage=function(A,t,D,E,G){A=this.getPage(A);if(!a.isNone(A)&&0!==t.childCount){var H=t.childOffset+t.childCount,I=[];for(t=t.childOffset;t<H;++t){const J=A.children[t],K=this.getNodeInternal(J);a.isSome(K)&&a.isSome(K.node)&&this.isGeometryVisible(J)&&I.push(K)}E/=I.length;for(const J of I)A=a.unwrap(J.node).index,this._isLoaded(A)||this._isReloading(A)?(G.delta=Math.max(G.delta,D),G.coverage+=E):this._traverseCoverage(A,
J,D+1,E,G)}};z.useNodeAsHole=function(A){if("off"===this.holeFilling)return!1;const t=this.getNodeInternal(A);if(a.isNone(t))return!1;if("always"===this.holeFilling)return!0;if((t.useAsHole&-2)===this._version)return 1===(t.useAsHole&1);const D={delta:0,coverage:0};this._traverseCoverage(A,t,0,1,D);A=.5>=D.delta*D.coverage;t.useAsHole=this._version+(A?1:0);return A};z.destroy=function(){this._updates.add.prune();this._updates.update.prune()};z.requestUpdate=function(){this._dirty=!0;this._indexMissing=
1;this._version=f.addWraparound(this._version,2)};z.imModificationsChanged=function(A){this.layerHasModifications=A;this.forAllNodes(({node:t})=>{a.isSome(t)&&(t.imModificationImpact=4,t.visibilityObb=this._computeVisibilityObb(t),t.hasModifications&&this.invalidateGeometryVisibility(t.index))});this.invalidateVisibilityCache()};z.update=function(A,t,D){if(this._dirty){this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(A,
this._missing);v.clear();var E=!0,G=new x,H=new x,I=this._imModificationUncategorized;I.clear();this.traverseVisible((K,L,S)=>{if(a.isNone(L))L=this.entryPriority(K),Infinity===L&&(L=this.entryPriority(S)),K=p(K,this.nodesPerPage),v.set(K,Math.max(L,v.get(K)||0)),this._loading.has(K)||this._failedPages.has(K)||this._missing.push(K),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,L);else{var M=L.node;this._updateNodeFeatureEstimate(M,H);if(a.isNone(M))L=this.entryPriority(K),this._loading.has(K)||
this._failedNodes.has(K)||(this._missing.push(K),v.set(K,L)),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,L);else{S=a.unwrap(this.getPage(K));if(0===this._missing.length&&0===this.nodesPerPage)for(let T=0;T<L.childCount;T++){const O=S.children[L.childOffset+T],Q=this.getNodeInternal(O);!a.isSome(Q)||Q.node||this._loading.has(O)||this._failedNodes.has(O)||(v.set(O,this.entryPriority(O)),this._prefetch.push(O))}!M.failed&&M.resources.hasFeatureData&&(this._isLoaded(K)?(G.known+=M.memory,
++G.knownNodes,this._isSelected(M)?0<L.childCount&&(E=!1):(G.unremoved+=M.memory,E=!1),this._needsUpdate(M)&&(L=this.entryPriority(K),v.set(K,L),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,L),this._updates.update.push(K))):(M.memory&&(G.known+=M.memory,++G.knownNodes),this._isSelected(M)?(0<L.childCount&&(E=!1),M.memory?(G.missing+=M.memory,G.known+=M.memory,++G.knownNodes):++G.missingNodes,0<=A.indexOf(M.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this.entryPriority(K)),
this._updates.cancel=this._updates.cancel.filter(T=>T!==M.index)):!t.done&&this._enable(M)?t.madeProgress():(S=this.entryPriority(K),v.set(K,S),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,S),this._updates.add.push(K),this.layerHasModifications&&D&&a.isSome(L)&&a.isSome(L.node)&&4===L.node.imModificationImpact&&I.push(K))):this._isReloading(K)&&this._updates.remove.push(K)))}}});var J=this._updates.add;0<J.length&&this.layerHasModifications&&(0<I.length&&D(I),J.filterInPlace(K=>{var L=
this.getNodeInternal(K);(L=a.isNone(L)||a.isNone(L.node)||2!==L.node.imModificationImpact)||this.invalidateNodeVisibilityCache(K);return L}));this._unloadedMemoryEstimate=G.missing-G.unremoved;3<G.knownNodes&&0<G.missingNodes&&(this._unloadedMemoryEstimate+=G.known/G.knownNodes*G.missingNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(H);this._featureEstimate.leavesReached=E;this._missing.sort((K,L)=>K-L);this._missing.filterInPlace((K,
L)=>1>L||this._missing.data[L-1]!==K);this._missing.sort((K,L)=>v.get(K)-v.get(L));0<this._missing.length?(this._maxUnloadedPrio=v.get(this._missing.back()),this._prefetch.clear()):this._prefetch.sort((K,L)=>v.get(K)-v.get(L));this._updates.add.filterInPlace(K=>v.get(K)>=this._maxUnloadedPrio).sort((K,L)=>v.get(K)-v.get(L));this._updates.update.sort((K,L)=>v.get(K)-v.get(L));this._indexMissing=this._loading.size+this._missing.length;this._dirty=0<this._indexMissing;v.clear()}};z.checkFeatureTarget=
function(A,t){const D=this.viewportQueries.updateScreenSpaceErrorBias(t);let E=t,G=t,H=D,I=10;for(;I--;){const J=new x;this._updateFeatureEstimate(E,J);if(this._computeFeatureEstimate(J)<=A){if(E>=t||0<J.missingNodes||0===I)break;H=E;E=.5*(E+G)}else G=E,E=.5*(E+H)}this._version=f.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(D);return Math.min(t,E)};z._updateFeatureEstimate=function(A,t){this._version=f.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(A);
this.traverseVisible((D,E)=>this._updateNodeFeatureEstimate(a.isSome(E)&&E.node,t))};z._updateNodeFeatureEstimate=function(A,t){a.isNone(A)||A.failed||a.isNone(A.numFeatures)||(this._isLoaded(A.index)?(t.known+=A.numFeatures,++t.knownNodes,this._isSelected(A)||(t.unremoved+=A.numFeatures)):this._isSelected(A)&&(a.isSome(A.numFeatures)?(t.missing+=A.numFeatures,t.known+=A.numFeatures,++t.knownNodes):++t.missingNodes))};z._computeFeatureEstimate=function(A){let t=A.known-A.unremoved;3<A.knownNodes&&
0<A.missingNodes&&(t+=A.known/A.knownNodes*A.missingNodes);return Math.max(0,t)};z.load=function(){return this._load(this._missing)};z.prefetch=function(){return this._load(this._prefetch)};z._load=function(A){if(0===A.length||!this._canRequest())return!1;for(;0<A.length&&this._canRequest();)0===this.nodesPerPage?this._loadNode(A.pop()):this.loadPage(A.pop());return!0};z.isLoading=function(){return 0<this._indexMissing};z.getIndexLoading=function(){return this._loading.size};z.getIndexMissing=function(){return this._indexMissing};
z.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};z.nodeTraversalState=function(A){if(a.isNone(A))return null;let t=this._nodeTraversalState.get(A.index);if(t&&(t.version&-2)===this._version)return t;const D=this.viewportQueries.getLodLevel(A),E=this.viewportQueries.hasLOD(A);var G=!0;E?(G=this.getParentIndex(A.index),G=0<=G?(G=this._nodeTraversalState.get(G))&&D>G.lodLevel:0<D):G=0===A.childCount;if(t)return t.lodLevel=D,t.isChosen=G,t.version=this._version+1,t;t=new e.NodeTraversalState(E,
G,D,this._version+1);this._nodeTraversalState.set(A.index,t);return t};z._loadNode=function(A){this._loading.add(A);const t=a.unwrap(this.getNodeInternal(A)).ref;if(a.isNone(t))this._failedNodes.add(A);else{var D=t.id,E=`${this.layerUrl}/nodes/${D}`,G=()=>{this._loading.delete(A);0===this._missing.length&&0===this._loading.size&&this.requestUpdate()};this.streamDataController.request(E,"json").then(H=>{H=this._validateNode(D,H);null!=H&&(H.obb&&this.invalidateNodeVisibilityCache(A),H=this.addNode(H,
A),this.nodeTraversalState(H));G()},H=>{l.isAbortError(H)||(this.logger.error("#loadNode()",this.logLayer,"Error loading node: "+E),this._failedNodes.add(A));G()})}};z._validateNode=function(A,t){if(null==t||"object"!==typeof t||t.id!==A)return this.logger.error("#validateNode()",this.logLayer,`Invalid node. Wrong type or wrong id "${A}"`),null;t.sharedResource&&"./shared"!==t.sharedResource.href&&"./shared/"!==t.sharedResource.href&&this.logger.warn("#validateNode()",this.logLayer,`Invalid shared resource href on node "${A}"`);
null==t.geometryData||Array.isArray(t.geometryData)&&1===t.geometryData.length&&"./geometries/0"===t.geometryData[0].href||this.logger.warn("#validateNode()",this.logLayer,`Invalid geometry data on node "${A}"`);null==t.attributeData||Array.isArray(t.attributeData)&&!t.attributeData.some((H,I)=>H.href!==`./attributes/f_${I}/0`)||this.logger.warn("#validateNode()",this.logLayer,`Invalid attribute data on node "${A}"`);t.featureData&&1<t.featureData.length&&this.logger.warn("#validateNode()",this.logLayer,
`Node ${A} has ${t.featureData.length} bundles. Only the first bundle will be loaded.`);const D=t.hasOwnProperty("obb")&&!this.ignoreServiceObb?t.obb:null,E=t.featureData&&1===t.featureData.length&&t.featureData[0].featureRange?t.featureData[0].featureRange[1]-t.featureData[0].featureRange[0]+1:null;var G=H=>{if(null==H)return null;var I=J=>this.logger.error("#validateNode()",this.logLayer,`Invalid node reference on node ${A}: ${J}`);if("number"===typeof H.id)I(`id ${H.id} is a number instead of a string.`);
else if("string"!==typeof H.id||!Array.isArray(H.mbs))return I("Missing or invalid id."),null;if(!Array.isArray(H.mbs))return I(`Invalid bounding volume on reference ${H.id}.`),null;H.href&&H.href!=="../"+H.id&&this.logger.error("#validateNode()",this.logLayer,`Invalid node href on node "${A}"`);I=H.hasOwnProperty("obb")&&!this.ignoreServiceObb?H.obb:null;H=new e.NodeBase(`${H.id}`,H.mbs);H.serviceObb=I;H.visibilityObb=this._computeVisibilityObb(H);return H};G=Array.isArray(t.children)?t.children.map(G).filter(H=>
null!=H):null;return{id:A,mbs:t.mbs,obb:D,children:G,resources:{hasFeatureData:t.featureData&&0<t.featureData.length,hasSharedResource:null!=t.sharedResource,attributes:t.attributeData?A:null,texture:t.textureData&&0<t.textureData.length?A:null,geometry:null!=t.geometryData?A:null},version:"string"===typeof t.version?t.version:null,lodSelection:Array.isArray(t.lodSelection)?t.lodSelection:null,numFeatures:E}};z.resetFailedNodes=function(){this._failedNodes.clear();this._failedPages.clear();this.forAllNodes(A=>
{a.isSome(A.node)&&(A.node.failed=!1)})};z.entryPriority=function(A){var t=this.getNodeInternal(A),D=this.getParentIndex(A);if(a.isNone(t)||0>D&&null==t.node)return 0>D?Infinity:this.entryPriority(D);let E=0;t.node&&0<=D&&(D=this._nodeTraversalState.get(D),null!=D&&(E=D.lodLevel));for(D=this.progressiveLoadPenalty;0<=A;A=this.getParentIndex(A))if(this._isLoaded(A)){D=0;break}t=a.isSome(t.ref)?this.viewportQueries.distToPOI(t.ref):a.isSome(t.node)?this.viewportQueries.distToPOI(t.node):0;return-t-
E*(t+this.progressiveLoadPenalty)+D};z.traverseVisible=function(A){const t=this.getNodeInternal(this.rootIndex);a.isNone(t)?A(this.rootIndex,null,null):this._traverseVisible(this.rootIndex,-1,t,A)};z._traverseVisible=function(A,t,D,E){if(D.node&&0===D.childCount)this.isGeometryVisible(A)&&E(A,D,t);else if(this.isNodeVisible(A)&&(E(A,D,t),null!=D.node&&(t=this.nodeTraversalState(D.node),!t.nodeHasLOD||t.lodLevel!==this._maxLodLevel))){t=a.unwrap(this.getPage(A));for(let G=0;G<D.childCount;G++){const H=
t.children[D.childOffset+G],I=this.getNodeInternal(H);a.isSome(I)?this._traverseVisible(H,A,I,E):E(H,null,A)}}};z.traverse=function(A,t){t(A)&&this.traverseChildren(A,t)};z.traverseChildren=function(A,t){A=A.index;const D=this.getNodeInternal(A);a.isSome(D)&&this._traverseChildren(A,D,t)};z._traverseChildren=function(A,t,D){A=this.getPage(A);if(!a.isNone(A)){var E=t.childOffset+t.childCount;for(t=t.childOffset;t<E;++t){const G=A.children[t],H=this.getNodeInternal(G);a.isSome(H)&&a.isSome(H.node)&&
D(H.node)&&this._traverseChildren(G,H,D)}}};z.updateStats=function(A){0<this._updates.add.length&&(A.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)A.index+=" + "+this._indexMissing||this._prefetch.length;A.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){const t=this._featureEstimate.estimate-A.features;0<t?A.features+=" + "+t:0>t&&(A.features+=" - "+-t)}};z.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};
z.updateElevationInfo=function(A){this.forAllNodes(g);this.viewportQueries.updateElevationInfo(A)};z.forAllNodes=function(A){for(let t=0;t<this._nodePages.length;t++){const D=this._nodePages[t];if(D){const E=t*this.nodesPerPage;for(let G=0;G<D.nodes.length;G++)A(D.nodes[G],E+G)}}};k._createClass(C,[{key:"rootNode",get:function(){return this.getNode(this.rootIndex)}},{key:"size",get:function(){return this.nodeCount}},{key:"maxLevel",get:function(){return this._maxLevel}},{key:"dirty",get:function(){return this._dirty}},
{key:"updates",get:function(){return this._updates}},{key:"featureEstimate",get:function(){return this._featureEstimate}},{key:"test",get:function(){return{addNode:(A,t)=>this.addNode(A,t)}}}]);return C}();const v=new Map;let y=function(){function C(){this.update=new r({deallocator:null});this.add=new r({deallocator:null});this.remove=new r({deallocator:null});this.cancel=[]}C.prototype.reset=function(z,A){this.add.clear();this.update.clear();this.cancel=z;this.missing=A};return C}();const B=[["maxScreenThreshold",
1],["screenSpaceRelative",2],["removedFeatureDiameter",3],["distanceRangeFromDefaultCamera",4]];let x=function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0};b.I3SIndex=u;b.selectErrorMetric=w;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f64"],function(b,k,a){let r=function(h,d){this.id=h;this.mbs=d;this.renderMbs=a.fromArray([0,
0,0,-1]);this.imModificationImpact=4},l=function(h){function d(c,e,f,g,p,n,w,q,m,u){c=h.call(this,c,f)||this;c.index=e;c.childCount=g;c.level=p;c.resources=n;c.version=w;c.lodMetric=q;c.maxError=m;c.numFeatures=u;c.failed=!1;c.hasModifications=!1;c.cacheState=0;c.vertexCount=0;c.memory=0;return c}k._inheritsLoose(d,h);return d}(r);b.Node=l;b.NodeBase=r;b.NodeTraversalState=function(h,d,c,e){this.nodeHasLOD=h;this.isChosen=d;this.lodLevel=c;this.version=e};Object.defineProperty(b,"__esModule",{value:!0})})},
"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PooledArray"],function(b,k,a){let r=function(){function h(c){this.layerView=c;this._lodGlobalDirty=!1}var d=h.prototype;d.startNodeLoading=function(c,e,f,g){this._maxLodLevel=g.maxLodLevel;this._index=f;this._isNodeInScaleBounds=c;this._removeNodes=e};d.shouldLoadNode=function(c){if(k.isNone(c))return!1;const e=this._index.nodeTraversalState(c);return this.isChosenMaxLOD(e)?
!0:e.isChosen?this._childrenRequireLoading(c):!1};d.setLodGlobalDirty=function(){this._lodGlobalDirty=!0};d.lodGlobalHandling=function(c){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var e=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.memoryController.usedMemory-1)));l.clear();this._lodGlobalHandling(this._index.rootNode,e,!1);e=l.length;this._removeNodes(l,c);c=l.length<e;0!==l.length&&(this._lodGlobalDirty=!0);l.clear();return c};d._lodGlobalHandling=function(c,
e,f){if(k.isNone(c))return!1;const g=c.index,p=this._index,n=this.layerView;var w=p.nodeTraversalState(c);const q=this.isChosenMaxLOD(w);w=n.isNodeLoaded(g);const m=n.nodeCrossfadingEnabled;if(m&&w&&q){var u=!f&&this.hasNoVisibleChildren(c);n.fadeNode(g,0,!u)}u=w&&(!n.isNodeFullyFadedIn||n.isNodeFullyFadedIn(g));if(w&&(n.updateNodeState(g,q?1:0),q))return u&&this._removeChildrenRecursive(c),u;var v=0<c.childCount;let y=v;if(v)for(v=0;v<c.childCount;v++){const B=p.getChildIndex(c,v),x=p.getNode(B);
k.isSome(x)?p.isGeometryVisible(B)&&!this._lodGlobalHandling(x,e,f||u)&&this._isNodeInScaleBounds(x)&&(y=!1):p.isNodeVisible(B)&&(y=!1)}(e=w&&!q&&(y||l.length<e))&&l.push(g);!m||e||!w||f||y||n.fadeNode(g,0,!1);c=!c.resources.hasFeatureData;return y||u&&!e||c};d._removeChildrenRecursive=function(c){this._index.traverseChildren(c,e=>{(this.layerView.isNodeLoaded(e.index)||this.layerView.isNodeReloading(e.index))&&l.push(e.index);return!0})};d.hasNoVisibleChildren=function(c){let e=!0;this._index.traverseChildren(c,
f=>e&&this._index.isNodeVisible(f.index)?this.layerView.isNodeLoaded(f.index)?e=!1:!0:!1);return e};d._childrenRequireLoading=function(c){let e=!1,f=!0;this._index.traverseChildren(c,g=>{if(!f||!this._index.isNodeVisible(g.index))return!1;const p=this._index.nodeTraversalState(g);this.isChosenMaxLOD(p)&&this._index.isGeometryVisible(g.index)&&(e=!0);return this.layerView.isNodeLoaded(g.index)?f=!1:!0});return f&&e};d.isChosenMaxLOD=function(c){return c.isChosen&&(!c.nodeHasLOD||c.lodLevel===this._maxLodLevel)};
b._createClass(h,[{key:"requiresLODGlobalHandling",get:function(){return null!=this._index&&!0===this._lodGlobalDirty}}]);return h}();const l=new a({deallocator:null});return r})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/urlUtils ../../../../core/promiseUtils ../../../../core/asyncUtils ./I3SBinaryReader ./I3SUtil ./I3SMaterialUtil".split(" "),function(b,k,a,r,l,h,d,c,e){let f=function(){function g(n,
w,q,m,u,v){this.streamDataController=w;this.logger=q;this.defaultGeometrySchema=m;this.requiredAttributes=u;this.options=v;this.logLayer=n;this.layerUrl=n.parsedUrl.path;this.geometryDefinitions=n.geometryDefinitions;if(n.materialDefinitions){const y=n.textureSetDefinitions;this.materialAndTextures=n.materialDefinitions.map(B=>e.getMaterialAndTextures(y,B))}}var p=g.prototype;p.load=function(n,w,q){return this.streamDataController.request(n,w,{signal:q})};p.loadAttribute=function(n,w,q){return this.load(`${this.layerUrl}/nodes/${n.resources.attributes}/attributes/${w.key}/0`,
"binary",q).then(m=>d.readBinaryAttribute(w,m))};p.loadAttributes=function(n,w,q){return l.eachAlways(w.map(m=>this.loadAttribute(n,m.attributeStorageInfo,q))).then(m=>{const u={};for(let v=0;v<w.length;++v)if(m[v].value)u[w[v].name]=m[v].value;else{if(l.isAbortError(m[v].error))throw m[v].error;this.logger.error("#loadAttributes",this.logLayer,`Failed to load attributeData for '${w[v].name}' on node '${n.id}'`,m[v].error)}return u})};p.loadNodeData=async function(n,w){var q=null!=this.requiredAttributes&&
n.resources.attributes?h.result(this.loadAttributes(n,this.requiredAttributes,w)):null;var m=this.geometryDefinitions;var u={bufferDefinition:null,bufferIndex:0};if(!(null==m||0>n.resources.geometryDefinition)&&(m=0<=n.resources.geometryDefinition?m[n.resources.geometryDefinition].geometryBuffers:null,null!=m))for(var v=0;v<m.length;v++){var y=m[v];if(null!=y.compressedAttributes){if("draco"===y.compressedAttributes.encoding&&!b("disable-feature:i3s-draco")){u.bufferIndex=v;u.bufferDefinition=y;break}}else u.bufferIndex=
v,u.bufferDefinition=m[v]}const {bufferDefinition:B,bufferIndex:x}=u;v=(y=!!n.resources.geometry)?h.result(this.loadGeometry(n.resources.geometry,x,w)):null;m=n.resources.hasSharedResource?await this.loadShared(n,w):null;var C=(u=this.materialAndTextures&&0<=n.resources.materialDefinition?this.materialAndTextures[n.resources.materialDefinition]:null!=m?e.getMaterialAndTexturesFromShared(m):null)&&u.material;u=u&&u.textures;const z=`${n.id}`,A=!y&&this.options.loadFeatureData;y=A?await this.loadFeatureData(z,
w):null;if(A)a:{for(D of y.featureData)if(C=D.geometries,null!=C)for(var t of C){var D={featureIds:[D.id],featureDataPosition:D.position,geometries:[t]};break a}D=null}else D={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:C}}],featureDataPosition:[0,0,0]};if(t=a.isNone(D)){t=[];for(var E of y.featureData)null!=E.position&&t.push({featureIds:[E.id],featureDataPosition:E.position,geometries:null})}E=t;t=null!=u&&0<u.length?h.result(this.loadTextures(n,u,w)):null;w=n=null;v&&(n=
h.assertResult(await v),(w=this.defaultGeometrySchema)&&m&&m.materialDefinitions&&(v=Object.keys(m.materialDefinitions)[0],!m.materialDefinitions[v].params.vertexRegions&&w.vertexAttributes.region&&(w=k.clone(w),delete w.vertexAttributes.region)),w=d.createGeometryDescriptor(B,w));m=t?h.assertResult(await t):null;q=(q=q?h.assertResult(await q):{})?{attributeData:q,loadedAttributes:this.requiredAttributes}:null;return a.isSome(D)?{geometryData:D,attributeDataInfo:q,geometryBuffer:n,geometryDescriptor:w,
requiredTextures:u,textureData:m}:a.isSome(E)?{pointData:E,attributeDataInfo:q,geometryBuffer:n,geometryDescriptor:w,requiredTextures:u,textureData:m}:l.reject()};g.addAbsoluteHrefTexture=function(n,w){n=n.textureDefinitions;if(null!=n)for(const q of Object.keys(n))for(const m of n[q].images)Array.isArray(m.href)?m.hrefConcat=m.href.map(u=>r.makeAbsolute(u,w)):m.hrefConcat=r.makeAbsolute(m.href,w)};g.fixTextureEncodings=function(n){n=n.textureDefinitions;if(null!=n)for(const q in n){const m=n[q];
if(Array.isArray(m.encoding))for(var w=0;w<m.encoding.length;w++){const u=m.encoding[w];"data:"===u.substring(0,5)&&(m.encoding[w]=u.substring(5))}else w=m.encoding,"data:"===w.substring(0,5)&&(m.encoding=w.substring(5))}};p.loadShared=function(n,w){const q=`${this.layerUrl}/nodes/${n.resources.geometry}/shared`;return this.load(q,"json",w).then(m=>{g.fixTextureEncodings(m);g.addAbsoluteHrefTexture(m,q);return m})};p.loadTexture=function(n,w,q,m,u,v){return u===c.DDS_ENCODING_STRING?this.load(n,"binary",
v).then(y=>({id:w,usage:q,data:y,encoding:u})):this.load(n,"image",v).then(y=>{var B=y;if(m&&4096<=y.width*y.height){B=Math.ceil(y.width/2);const x=Math.ceil(y.height/2),C=document.createElement("canvas");C.width=B;C.height=x;C.getContext("2d").drawImage(y,0,0,B,x);B=C}return{id:w,usage:q,data:B,encoding:u}})};p.loadTextures=function(n,w,q){const m=this.options.textureFormat===g.TextureFormat.Compressed,u=this.options.textureFormat===g.TextureFormat.Downsampled,v=this.options.textureUsageMask;return l.all(w.map(y=>
{if(0===(y.usage&v))return null;const B=c.selectEncoding(y.encodings,m);return null==B?(this.logger.error("#loadTextures",this.logLayer,`No known encoding for texture found on node ${n.id}`),l.reject()):this.loadTexture(`${this.layerUrl}/nodes/${n.resources.texture||n.id}/textures/${B.name}`,y.id,y.usage,u,B.encoding,q)}))};p.loadFeatureData=function(n,w){return this.load(`${this.layerUrl}/nodes/${n}/features/0`,"json",w)};p.loadGeometry=function(n,w,q){return this.load(`${this.layerUrl}/nodes/${n}/geometries/${w}`,
"binary",q)};return g}();(function(g){g=g.TextureFormat||(g.TextureFormat={});g[g.Compressed=0]="Compressed";g[g.Normal=1]="Normal";g[g.Downsampled=2]="Downsampled"})(f||(f={}));return f})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define(["exports","../../../../core/maybe","../../../../core/mathUtils","../../webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl","../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl"],function(b,k,a,r,l){const h={jpg:"image/jpeg",
png:"image/png",dds:"image/vnd-ms.dds","ktx-etc2":"image/ktx"};b.getMaterialAndTextures=function(d,c){const e=new Map,f=(v,y)=>{if(k.isNone(v))return-1;if(e.has(v.id))return v=e.get(v.id),v.usage|=y,v.id;const B=e.size;e.set(v.id,{id:B,usage:y});return B};var g=c.pbrMetallicRoughness;const p=g&&g.baseColorFactor,n=c.emissiveFactor,w=null==c.normalTexture&&null==c.emissiveTexture&&null==c.occlusionTexture&&(g?null==g.metallicRoughnessTexture&&1===g.roughnessFactor&&(1===g.metallicFactor||0===g.metallicFactor):
!0),q=w?l.PBRSchematicMRRValues[0]:g?g.metallicFactor:1,m=w?l.PBRSchematicMRRValues[1]:g?g.roughnessFactor:1;g={baseColorFactor:p?[p[0],p[1],p[2],p[3]]:[1,1,1,1],baseColorTextureId:f(g&&g.baseColorTexture,"mask"===c.alphaMode?33:1),metallicRoughnessTextureId:f(g&&g.metallicRoughnessTexture,2),metallicFactor:q,roughnessFactor:m};c={alphaMode:c.alphaMode,alphaCutoff:c.alphaCutoff,doubleSided:c.doubleSided,cullFace:"none"===c.cullFace?0:"back"===c.cullFace?2:"front"===c.cullFace?1:void 0,normalTextureId:f(c.normalTexture,
4),emissiveTextureId:f(c.emissiveTexture,16),occlusionTextureId:f(c.occlusionTexture,8),emissiveFactor:n?[n[0],n[1],n[2]]:[0,0,0],metallicRoughness:g,wrapTextures:!1,isSchematic:w};const u=[];e.forEach(({usage:v},y)=>{var B=k.isSome(d)&&d[y]&&d[y].formats;B=B?B.map(({name:x,format:C})=>({name:x,encoding:h[C]})):[];u.push({id:y,usage:v,encodings:B})});return{material:c,textures:u}};b.getMaterialAndTexturesFromShared=function(d){var c=d&&d.materialDefinitions?Object.keys(d.materialDefinitions)[0]:null,
e=d&&d.textureDefinitions?Object.keys(d.textureDefinitions)[0]:null;c=c&&d.materialDefinitions[c];e=e&&d.textureDefinitions[e];d={alphaMode:"opaque",alphaCutoff:r.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:0,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,isSchematic:!0};if(null!=c){c=c.params;c.diffuse&&(d.metallicRoughness.baseColorFactor=
[c.diffuse[0],c.diffuse[1],c.diffuse[2],1]);null!=c.doubleSided&&(d.doubleSided=c.doubleSided,d.cullFace=c.doubleSided?0:2);if("none"===c.cullFace||"front"===c.cullFace||"back"===c.cullFace)d.cullFace="none"===c.cullFace?0:"back"===c.cullFace?2:1;c.transparency&&(d.metallicRoughness.baseColorFactor[3]=a.clamp(1-c.transparency,0,1));if(c.useVertexColorAlpha||1>d.metallicRoughness.baseColorFactor[3])d.alphaMode="blend"}c=[];if(null!=e){!e.wrap||"repeat"!==e.wrap[0]&&"repeat"!==e.wrap[1]||(d.wrapTextures=
!0);let f=1;"rgba"===e.channels&&(d.alphaMode="blend",f|=32);const g=e.images[e.images.length-1],p=n=>n&&n.split("/").pop();e=Array.isArray(e.encoding)?e.encoding.map((n,w)=>({name:p(g.href[w]),encoding:n})):[{name:p(g.href),encoding:e.encoding}];c.push({id:0,usage:f,encodings:e});d.metallicRoughness.baseColorTextureId=0}return{material:d,textures:c}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/promiseUtils"],function(b,k,a){let r=function(){function l(d){this.requester=d;this.activeRequests=new Set}var h=l.prototype;h.request=function(d,c,e){const f=a.createAbortController(),g=a.onAbortOrThrow(e,()=>f.abort());e={...e,signal:f.signal};d=this.requester.request(d,c,e);const p={response:d,abortController:f,abortHandle:g};this.activeRequests.add(p);a.always(d,()=>{var n;p.abortController=null;null==(n=p.abortHandle)?void 0:n.remove();p.abortHandle=null;this.activeRequests.delete(p)});
return d};h.cancelAll=function(){this.activeRequests.forEach(d=>{var c,e;null==(c=d.abortController)?void 0:c.abort();d.abortController=null;null==(e=d.abortHandle)?void 0:e.remove()});this.activeRequests.clear()};k._createClass(l,[{key:"busy",get:function(){return this.requester.busy}}]);return l}();b.I3SStreamDataController=r;b.default=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../geometry/projectionEllipsoid ../../../../geometry/projection ../../../../chunks/vec4 ../../../../layers/graphics/dehydratedFeatures ../../support/geometryUtils ../graphics/elevationAlignmentUtils ../graphics/featureExpressionInfoUtils ../graphics/ElevationContext ../../support/orientedBoundingBox ./I3SUtil".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n){return function(){function w(m,u,v,y,B,x,C={}){this.indexSR=m;this._renderCoordsHelper=u;this.extent=y;this.elevationProvider=B;this.options=C;this._fp=c.frustum.create();this._poi=k.create();this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=k.create();this._tmp2=k.create();this._tmp3=k.create();this._tmp0=k.create();this.screenspaceErrorBias=C.screenspaceErrorBias||1;this.progressiveLoadFactor=C.progressiveLoadFactor||1;this.updateCamera(v);
this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(x);this.tmpPoint=d.makeDehydratedPoint(0,0,0,m)}var q=w.prototype;q.updateElevationInfo=function(m){null==m?this._elevationContext=null:(this._elevationContext=g.ElevationContext.fromElevationInfo(m),this._elevationContext.updateFeatureExpressionInfoContext(f.createContextWithoutExpressionSupport(f.extractExpressionInfo(m,!1))))};q.updateCamera=function(m){c.frustum.fromMatrix(m.viewMatrix,m.projectionMatrix,this._fp);
this._screenSizeFactor=1/(m.perScreenPixelRatio/2);this._camPos=m.eye;this.minDistance=Infinity;this.maxDistance=0};q.setPointOfInterest=function(m){this._poi=m};q.updateScreenSpaceErrorBias=function(m){const u=this.screenspaceErrorBias;this.screenspaceErrorBias=m;return u};q.updateExtent=function(m){this.extent=m};q.getRenderMbs=function(m){const u=m.renderMbs;0>u[3]&&(h.copy(u,m.mbs),this._elevationContext&&1E5>u[3]&&(this.tmpPoint.x=u[0],this.tmpPoint.y=u[1],this.tmpPoint.z=u[2],u[2]=e.evaluateElevationAlignmentAtPoint(this.tmpPoint,
this.elevationProvider,this._elevationContext,this._renderCoordsHelper)),l.projectBoundingSphere(u,this.indexSR,u,this.engineSR));return u};q.getVisibilityObb=function(m){if(b.isSome(m.visibilityObb))return m.visibilityObb;const u=m.serviceObb;if(!(b.isNone(u)||0>u.halfSize[0]))return m.serviceObbInRenderSR=this._computeRenderObb(u,m.serviceObbInRenderSR,m.mbs[3]),m.serviceObbInRenderSR};q._computeRenderObb=function(m,u,v){b.isNone(u)&&(u=p.create());if(0>u.halfSize[0]){let y=0;this._elevationContext&&
1E5>v&&(this.tmpPoint.x=m.center[0],this.tmpPoint.y=m.center[1],this.tmpPoint.z=m.center[2],y=e.evaluateElevationAlignmentAtPoint(this.tmpPoint,this.elevationProvider,this._elevationContext,this._renderCoordsHelper)-m.center[2]);n.transformObb(m,this.indexSR,u,this.engineSR,y)}return u};q.isNodeVisible=function(m){const u=this.getRenderMbs(m);if(!this.isMBSinExtent(u))return!1;m=this.getVisibilityObb(m);return b.isSome(m)?p.isVisible(m,this._fp):c.frustum.intersectsSphere(this._fp.planes,c.sphere.wrap(u[3],
u))};q.isGeometryVisible=function(m){const u=m.geometryObb;return b.isSome(u)?p.isVisible(u,this._fp):this.isNodeVisible(m)};q.isMBSinExtent=function(m){return this.extent?0!==n.intersectBoundingBoxWithMbs(this.extent,m):!0};q.screenSpaceDiameterMbs=function(m,u){var v=this.getRenderMbs(m);m=Math.sqrt(a.squaredDistance(v,this._camPos));v=m-v[3];this._updateMinMaxDistance(m);return 0>v?.5*Number.MAX_VALUE:u/v*this._screenSizeFactor};q.calcCameraDistance=function(m){return this.calcCameraDistanceToCenter(m)-
this.getRenderMbs(m)[3]};q.calcCameraDistanceToCenter=function(m){m=this.getRenderMbs(m);m=a.distance(m,this._camPos);this._updateMinMaxDistance(m);return m};q.calcAngleDependentLoD=function(m){m=this.getRenderMbs(m);const u=m[3];m=(Math.abs(m[0]*(m[0]-this._camPos[0])+m[1]*(m[1]-this._camPos[1])+m[2]*(m[2]-this._camPos[2]))/a.length(m)+u)/a.distance(m,this._camPos);return Math.min(1,m)};q.hasLOD=function(m){return 0!==m.lodMetric};q.getDistancePlanarMode=function(m,u){var v=m[0]-u[0];const y=m[1]-
u[1];m=m[2]-u[2];v=v*v+y*y;u=u[3];if(v<=u*u)return Math.abs(m);u=Math.sqrt(v)-u;return Math.sqrt(m*m+u*u)};q.getDistanceGlobeMode=function(m,u){var v=a.length(u);const y=a.length(m)-v;a.scale(this._tmp0,m,a.dot(m,u)/a.squaredLength(m));var B=a.squaredDistance(u,this._tmp0),x=u[3];if(B<=x*x)return Math.abs(y);u=a.scale(this._tmp0,u,1/v);v=a.scale(this._tmp1,u,v-x*x/2/v);B=a.subtract(this._tmp2,m,v);B=a.subtract(this._tmp2,B,a.scale(this._tmp3,u,a.dot(u,B)));v=a.add(this._tmp2,v,a.scale(this._tmp2,
B,x/a.length(B)));x=a.distance(m,v);2E5<=y&&(m=a.subtract(this._tmp1,m,v),m=a.dot(m,u)/a.length(m),.08>m&&(m=1E-4),x/=m);return x};q.getDistance=function(m,u){return this.engineSR===r.getSphericalPCPF(this.engineSR)?this.getDistanceGlobeMode(m,u):this.getDistancePlanarMode(m,u)};q._updateMinMaxDistance=function(m){0<m?(this.minDistance=Math.min(this.minDistance,m),this.maxDistance=Math.max(this.maxDistance,m)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-m))};q.getLodLevel=function(m){if(0===
m.lodMetric||!m.resources.hasFeatureData)return 0;if(0===m.childCount)return this.maxLodLevel;if(1>this.progressiveLoadFactor){const u=this.screenspaceErrorBias;return this.evaluateLODmetric(m,this.progressiveLoadFactor*this.screenspaceErrorBias)?this.evaluateLODmetric(m,u)?2:1:0}return this.evaluateLODmetric(m,this.screenspaceErrorBias)?this.maxLodLevel:0};q.evaluateLODmetric=function(m,u){switch(m.lodMetric){case 2:{const v=this.getRenderMbs(m),y=this.getDistance(this._camPos,v),B=2*y/this._screenSizeFactor;
this._updateMinMaxDistance(y+v[3]);return m.maxError*u<=B}case 1:return u=this.screenSpaceDiameterMbs(m,m.mbs[3]*u),this.options.angleDependentLoD&&(u*=this.calcAngleDependentLoD(m)),u<m.maxError;case 3:return 10>this.screenSpaceDiameterMbs(m,m.maxError)*u;case 4:return this.calcCameraDistance(m)>m.maxError*u}return!1};q.distToPOI=function(m){m=this.getRenderMbs(m);return a.distance(m,this._poi)-m[3]};q.distCameraToPOI=function(){return a.distance(this._camPos,this._poi)};return w}()})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/Accessor ../../../symbols/PointSymbol3D ../../../chunks/symbols ../../../Graphic ../../../chunks/vec3f64 ../../../core/Handles ../../../core/accessorSupport/diffUtils ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A){a=function(E){function G(I){I=E.call(this,I)||this;I.loadedGraphics=new A.LimitGraphicsMap(5E4);I.slicePlaneEnabled=!1;I._renderingInfo={symbol:new w};I._handles=new v;I._graphicsByNode=new Map;I._scaleVisibility=null;return I}b._inheritsLoose(G,E);var H=G.prototype;H.initialize=function(){this._graphicsCore=new x.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:1,elevationFeatureExpressionEnabled:!1,graphicSymbolSupported:!1,
getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1});var I=this.view.basemapTerrain;this._scaleVisibility=new C({layerScaleEnabled:!1});this._scaleVisibility.setup(this,this.layer,(K,L,S)=>this._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(K,L,S),this._graphicsCore,I);I=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}});
const J=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);this._graphicsCore.setup({labeler:I,deconflictor:J,scaleVisibility:this._scaleVisibility}).then(()=>{this._graphicsCore.startCreateGraphics()}).catch(()=>{});this._handles.add([this.layer.watch("labelingInfo",(K,L)=>{y.diff(K,L)&&this._graphicsCore.updateLabelingInfo()})])};H.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);null!=this._scaleVisibility&&(this._scaleVisibility.destroy(),this._scaleVisibility=
null);null!=this._graphicsCore&&(this._graphicsCore.destroy(),this._graphicsCore=null);this.loadedGraphics.destroy();this.view=null};H.addNodeMeta=function(I,J){let K=0;const L=I.filteredIds,S=I.featureIds.map((M,T)=>{z.boundingBoxTop(T,this.collection,I.objectHandle,D);const O=B.makeDehydratedPoint(0,0,0,this.view.spatialReference);this.view.renderCoordsHelper.fromRenderCoords(D,O);T=J(T,I);let Q=!1;r.isNone(L)?Q=!0:K<L.length&&M===L[K]&&(Q=!0,K++);return{objectId:M,uid:m.generateUID(),attributes:T,
visible:Q,geometry:O}});this.loadedGraphics.addMany(S);this._graphicsByNode.set(I.node.index,S)};H.setNodeMetaAttributes=function(I,J){const K=this._graphicsByNode.get(I.node.index),L=Array(K.length);for(let S=0;S<K.length;S++){const M=K[S];M.attributes=J(S,I);L[S]=M.uid}this._graphicsCore.updateLabelingInfo(L)};H.applyFilterChange=function(I){var J=this._graphicsByNode.get(I.node.index);if(J)if(r.isNone(I.filteredIds))for(var K of J)K.visible||(K.visible=!0,t.graphic=K,t.property="visible",t.oldValue=
!1,t.newValue=!0,this._graphicsCore.graphicUpdateHandler(t));else{K=0;for(const L of J)J=L.visible,K<I.filteredIds.length&&L.objectId===I.filteredIds[K]?(L.visible=!0,K++):L.visible=!1,J!==L.visible&&(t.graphic=L,t.property="visible",t.oldValue=J,t.newValue=L.visible,this._graphicsCore.graphicUpdateHandler(t))}};H.removeNodeMeta=function(I){this.loadedGraphics.removeManyByObjectId(I.featureIds)};H.getRenderingInfo=function(){return this._renderingInfo};H.notifyGraphicUpdate=function(){};b._createClass(G,
[{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return G}(n);k.__decorate([d.property()],a.prototype,"view",void 0);k.__decorate([d.property()],a.prototype,"layer",void 0);k.__decorate([d.property()],a.prototype,"collection",void 0);k.__decorate([d.property()],a.prototype,"loadedGraphics",void 0);k.__decorate([d.property({aliasOf:"_graphicsCore.updating"})],
a.prototype,"updating",void 0);k.__decorate([d.property()],a.prototype,"slicePlaneEnabled",void 0);k.__decorate([d.property()],a.prototype,"_graphicsCore",void 0);a=k.__decorate([e.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],a);const t={graphic:null,property:null,oldValue:null,newValue:null},D=u.create();return a})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],
function(b,k,a,r,l){a=function(c){function e(g){var p=c.call(this)||this;p._limit=g;p._all=new l.GraphicsMap;p._active=new d(k._assertThisInitialized(p));p._pending=new Map;p._handle=p._all.on("change",n=>p._handleChanges(n));return p}k._inheritsLoose(e,c);var f=e.prototype;f.destroy=function(){this._handle.remove()};f.toArray=function(){return this._active.toArray()};f.find=function(g){return this._active.find(g)};f.forEach=function(g){this._active.forEach(g)};f.addMany=function(g){this._all.addMany(g)};
f.removeManyByObjectId=function(g){this._all.removeManyByObjectId(g)};f._handleChanges=function(g){let p=g.removed;if(0<this._pending.size){p=[];for(var n of g.removed)this._pending.delete(n.objectId)||p.push(n)}n=this._limit-this._active.length+p.length;n<g.added.length&&(this._active.removeMany(p),p=[],h.reset(1-this._limit/(this._active.length+g.added.length)),this._active.forEach(q=>{h.sample()&&(p.push(q),this._pending.set(q.objectId,q))}),n=this._limit-this._active.length+p.length);let w=g.added;
if(n<g.added.length){w=[];h.reset(n/g.added.length);for(const q of g.added)h.sample()?w.push(q):this._pending.set(q.objectId,q)}g=n-w.length;0<g&&0<this._pending.size&&(h.reset(g/this._pending.size),this._pending.forEach(q=>{h.sample()&&(w.push(q),this._pending.delete(q.objectId))}));this._active.addAndRemove(w,p)};k._createClass(e,[{key:"length",get:function(){return this._active.length}}]);return e}(a);const h=new (function(){function c(){this.percentage=1;this.last=-1;this.index=0}var e=c.prototype;
e.reset=function(f){this.percentage=f;this.last=-1};e.sample=function(){const f=Math.floor(this.index*this.percentage);++this.index;if(f===this.last)return!1;this.last=f;return!0};return c}());let d=function(){function c(f){this._parent=f;this._map=new Map}var e=c.prototype;e.forEach=function(f){this._map.forEach(g=>f(g))};e.find=function(f){let g;r.someMap(this._map,p=>f(p)?(g=p,!0):!1);return g};e.toArray=function(){return[...this._map.values()]};e.addAndRemove=function(f,g){for(const p of f)this._map.set(p.objectId,
p);for(const p of g)this._map.delete(p.objectId);(0<f.length||0<g.length)&&this._parent.emit("change",{added:f,removed:g})};e.removeMany=function(f){for(const g of f)this._map.delete(g.objectId);0<f.length&&this._parent.emit("change",{added:[],removed:f})};k._createClass(c,[{key:"length",get:function(){return this._map.size}}]);return c}();b.LimitGraphicsMap=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/support/GraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/Evented","../../../core/MapUtils"],function(b,k,a,r){a=function(l){function h(){var c=l.apply(this,arguments)||this;c._map=new Map;return c}k._inheritsLoose(h,l);var d=h.prototype;d.clear=function(){if(0<this._map.size){const c=this.toArray();this._map.clear();this.emit("change",{added:[],removed:c})}};d.get=function(c){return this._map.get(c)};d.addMany=function(c){if(0!==c.length){var e=new Set;for(let f=0;f<c.length;f++){const g=c[f],p=g.objectId,n=this._map.get(p);n?(e.add(p),g!==
n&&(c[f]=n),++n.refCount):(g.refCount=1,this._map.set(p,g))}c=0<e.size?c.filter(f=>!e.has(f.objectId)):c;0<c.length&&this.emit("change",{added:c,removed:[]})}};d.removeMany=function(c){const e=[];for(const f of c){c=f.objectId;const g=this._map.get(c);null!=g&&0>=--g.refCount&&(this._map.delete(c),e.push(f))}0<e.length&&this.emit("change",{added:[],removed:e})};d.removeManyByObjectId=function(c){const e=[];for(const f of c)c=this._map.get(f),null!=c&&0>=--c.refCount&&(this._map.delete(f),e.push(c));
0<e.length&&this.emit("change",{added:[],removed:e})};d.toArray=function(){return[...this._map.values()]};d.find=function(c){let e;r.someMap(this._map,f=>c(f)?(e=f,!0):!1);return e};d.forEach=function(c){this._map.forEach(e=>c(e))};k._createClass(h,[{key:"length",get:function(){return this._map.size}}]);return h}(a);b.GraphicsMap=a;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/PooledArray ../../../geometry/projection ../support/WorkerHandle".split(" "),
function(b,k,a,r,l,h){function d(g,p){e.clear();for(var n of g){var w="clip"===n.type?2:"mask"===n.type?1:0;const m=n.geometry;g=u=>u;if(m.spatialReference){if(!l.canProjectWithoutEngine(m.spatialReference,p)){c.warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}g=u=>{l.projectVectorToVector(u,m.spatialReference,f,p);return f}}else m.hasZ||(f[2]=0,g=u=>{f[0]=u[0];f[1]=u[1];return f});e.push(w);e.push(m.rings.length);for(var q of m.rings){e.push(q.length);
for(const u of q)w=g(u),e.push(w[0]),e.push(w[1]),e.push(w[2])}}e.push(3);n=new Float64Array(e.length);for(q=0;q<e.length;++q)n[q]=e.getItemAt(q);return n}const c=a.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");a=function(g){function p(w){return g.call(this,"SceneLayerWorker","process",w,{hasInitialize:!0})||this}k._inheritsLoose(p,g);var n=p.prototype;n.getTransferList=function(w){return[w.geometryBuffer]};n.setModifications=function(w,q,m){w={context:w,modifications:d(q,m),isGeodetic:m.isGeographic};
this.broadcast(w,"setModifications")};n.setLegacySchema=function(w,q){q=JSON.stringify(q);this.broadcast({context:w,jsonSchema:q},"setLegacySchema")};n.destroyContext=function(w){return this.broadcast(w,"destroyContext")};return p}(h.WorkerHandle);const e=new r({deallocator:null}),f=[0,0,0];b.I3SMeshWorkerHandle=a;b.toWasmModification=d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerWorker":function(){define(["exports","../../../core/typedArrayUtil","../../../core/maybe",
"../../../core/promiseUtils","../../../libs/i3s/I3SWorker"],function(b,k,a,r,l){function h(q){const m=q.modifications,u=n._malloc(8*m.length),v=new Float64Array(n.HEAPU8.buffer,u,m.length);for(let y=0;y<m.length;++y)v[y]=m[y];n.setModifications(q.context,u,m.length,q.isGeodetic);n._free(u)}function d(q,m){if(!n)return null;const {context:u,localOrigin:v,globalTrafo:y,mbs:B,obb:x,elevationOffset:C,geometryBuffer:z,geometryDescriptor:A,indexToVertexProjector:t,vertexToRenderProjector:D}=q;var E=n._malloc(z.byteLength),
G=n._malloc(33*Float64Array.BYTES_PER_ELEMENT),H=new Uint8Array(n.HEAPU8.buffer,E,z.byteLength);H.set(new Uint8Array(z));var I=new Float64Array(n.HEAPU8.buffer,G,33);f(I,v);var J=I.byteOffset+3*I.BYTES_PER_ELEMENT,K=new Float64Array(I.buffer,J);f(K,y);J+=16*I.BYTES_PER_ELEMENT;K=new Float64Array(I.buffer,J);f(K,B);J+=4*I.BYTES_PER_ELEMENT;a.isSome(x)&&(K=new Float64Array(I.buffer,J),f(K,x.center),J+=3*I.BYTES_PER_ELEMENT,K=new Float64Array(I.buffer,J),f(K,x.halfSize),J+=3*I.BYTES_PER_ELEMENT,K=new Float64Array(I.buffer,
J),f(K,x.quaternion));I={isDraco:!1,isLegacy:!1,color:q.layouts.some(S=>S.some(M=>"color"===M.name)),normal:q.needNormals&&q.layouts.some(S=>S.some(M=>"normalCompressed"===M.name)),uv0:q.layouts.some(S=>S.some(M=>"uv0"===M.name)),uvRegion:q.layouts.some(S=>S.some(M=>"uvRegion"===M.name)),featureIndex:A.featureIndex};H=n.process(u,!!q.obb,E,H.byteLength,A,I,G,C,t,D,q.normalReferenceFrame);n._free(G);n._free(E);if(0<H.error.length)throw`i3s.wasm: ${H.error}`;if(H.discarded)return null;E=0<H.componentOffsets.length?
k.slice(H.componentOffsets):null;G=0<H.featureIds.length?k.slice(H.featureIds):null;I=k.slice(H.interleavedVertedData).buffer;J=1===H.indicesType?k.slice(new Uint16Array(H.indices.buffer,H.indices.byteOffset,H.indices.byteLength/2)):k.slice(new Uint32Array(H.indices.buffer,H.indices.byteOffset,H.indices.byteLength/4));K=k.slice(H.positions);const L=1===H.positionIndicesType?k.slice(new Uint16Array(H.positionIndices.buffer,H.positionIndices.byteOffset,H.positionIndices.byteLength/2)):k.slice(new Uint32Array(H.positionIndices.buffer,
H.positionIndices.byteOffset,H.positionIndices.byteLength/4));q={layout:q.layouts[0],interleavedVertexData:I,indices:J,hasColors:H.hasColors,hasModifications:H.hasModifications,positionData:{data:K,indices:L}};G&&m.push(G.buffer);E&&m.push(E.buffer);m.push(I);m.push(J.buffer);m.push(K.buffer);m.push(L.buffer);return{componentOffsets:E,featureIds:G,transformedGeometry:q,obb:H.obb}}function c(q){const {context:m,buffer:u}=q;q=n._malloc(u.byteLength);const v=u.byteLength/Float64Array.BYTES_PER_ELEMENT,
y=new Float64Array(n.HEAPU8.buffer,q,v),B=new Float64Array(u);y.set(B);n.filterOBBs(m,q,v);B.set(y);n._free(q)}function e(q){n&&n.destroy(q)}function f(q,m){for(let u=0;u<m.length;++u)q[u]=m[u]}function g(){if(n)return r.resolve();p||(p=l.getWorkerModule().then(q=>{n=q;p=null}));return p}let p,n;const w={transform:d,destroy:e};b.destroyContext=function(q){e(q)};b.dracoDecompressPointCloudData=async function(q){var m;await g();const u=[q.geometryBuffer];var {geometryBuffer:v}=q,y=v.byteLength;q=n._malloc(y);
y=new Uint8Array(n.HEAPU8.buffer,q,y);y.set(new Uint8Array(v));v=n.dracoDecompressPointCloudData(q,y.byteLength);n._free(q);if(0<v.error.length)throw`i3s.wasm: ${v.error}`;q=0<(null==(m=v.featureIds)?void 0:m.length)?k.slice(v.featureIds):null;m=k.slice(v.positions);q&&u.push(q.buffer);u.push(m.buffer);return{result:{positions:m,featureIds:q},transferList:u}};b.filterObbsForModifications=async function(q){await g();c(q);q={buffer:q.buffer};return{result:q,transferList:[q.buffer]}};b.filterObbsForModificationsSync=
c;b.initialize=g;b.interpretObbModificationResults=function(q){return 0===q?0:1===q?1:2===q?2:3};b.process=async function(q){await g();const m=[q.geometryBuffer];return{result:d(q,m),transferList:m}};b.setLegacySchema=async function(q){await g();n.setLegacySchema(q.context,q.jsonSchema)};b.setModifications=async function(q){await g();h(q)};b.setModificationsSync=h;b.test=w;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/libs/i3s/I3SWorker":function(){define(["require","exports","../../core/promiseUtils",
"../../assets"],function(b,k,a,r){function l(d){return r.getAssetUrl(`esri/libs/i3s/${d}`)}let h;k.getWorkerModule=function(){h||(h=a.create(d=>(new Promise(function(c,e){b(["../../chunks/i3s"],c,e)})).then(function(c){return c.i3s}).then(({default:c})=>{const e=c({locateFile:l,onRuntimeInitialized:()=>d(e)});delete e.then})).catch(d=>a.reject(d)));return h};Object.defineProperty(k,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils"],
function(b){let k=function(){this.ids=new Set;this.paused=!1};return function(){function a(l){this.highlights=[];this.collection=l.collection;this.forAllFeatures=l.forAllFeatures;this.forAllFeaturesOfNode=l.forAllFeaturesOfNode}var r=a.prototype;r.destroy=function(){this.highlights.forEach(l=>this.releaseSet(l));this.highlights=null};r.acquireSet=function(){const l=new k;this.highlights.push(l);return{set:l,handle:{remove:()=>{this.releaseSet(l);b.removeUnordered(this.highlights,l)},pause:()=>{this.releaseSet(l);
l.paused=!0},resume:()=>{l.paused=!1;this.initializeSet(l)}}}};r.setFeatureIds=function(l,h){h.forEach(d=>l.ids.add(d));this.initializeSet(l)};r.initializeSet=function(l){this.forAllFeatures((h,d,c)=>{l.ids.has(h)&&this.collection.addComponentHighlight(c.objectHandle,d);return 1})};r.releaseSet=function(l){this.forAllFeatures((h,d,c)=>{l.ids.has(h)&&this.collection.removeComponentHighlight(c.objectHandle,d);return 1})};r.objectCreated=function(l){this.highlights.forEach(h=>{h.paused||this.forAllFeaturesOfNode(l,
(d,c)=>{h.ids.has(d)&&this.collection.addComponentHighlight(l.objectHandle,c);return 1})})};r.objectDeleted=function(l){this.collection.clearHighlights(l.objectHandle)};return a}()})},"esri/views/3d/layers/i3s/I3SAttributeOverrides":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/Logger ../../../../core/arrayUtils ../../../../core/promiseUtils ../../../../intl/number ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../layers/support/featureQueryAll".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g){const p=r.getLogger("esri.views.3d.layers.i3s.I3SAttributeOverrides");r=function(){function w(m,u){this.layer=m;this.warnMaximumChangedObjectsExceeded=!1;this.changedObjectIds=new Set;this.pendingFetchAbortController=h.createAbortController();this.interactiveEditingSessions=null;this.memCache=u.getMemCache(`${m.uid}-attribute-overrides`);this.pendingFetchChangedObjectIds=this.fetchChangedObjectIds(this.pendingFetchAbortController.signal);this.pendingFetchChangedObjectIds.then(()=>
this.pendingFetchAbortController=null)}var q=w.prototype;q.destroy=function(){this.layer=null;this.memCache.destroy();this.memCache=null;this.pendingFetchAbortController&&(this.pendingFetchAbortController.abort(),this.pendingFetchAbortController=null);this.pendingFetchChangedObjectIds=null};q.createInteractiveEditSession=function(m){this.changedObjectIds.add(m);a.isNone(this.interactiveEditingSessions)&&(this.interactiveEditingSessions=[]);const u=this.interactiveEditingSessions,v=new n(m,{rollback:()=>
{l.remove(u,v);0===u.length&&(this.interactiveEditingSessions=null)},commit:y=>{for(const [B,x]of y)this.updateValue(m,B,x)}});u.unshift(v);return v};q.apply=async function(m,u,v){if(!a.isNone(u)){var {loadedAttributes:y,attributeData:B}=u;if(!a.isNone(y)&&0!==y.length&&!a.isNone(B)&&(await h.whenOrAbort(this.pendingFetchChangedObjectIds,v),0!==this.changedObjectIds.size)){u={loadedAttributes:y,attributeData:B};var x=this.getOverridesFromCache(m,u,this.changedObjectIds),{objectIds:C,fieldNames:z}=
x;v=await this.queryOverridesFromAssociatedLayer(C,z,v);a.isNone(v)||this.processOverridesFromAssociatedLayer(m,v,z,u)}}};q.updateValue=function(m,u,v){this.changedObjectIds.add(m);this.cacheValue(m,u,v)};q.cacheValue=function(m,u,v){this.memCache.put(this.getCacheKey(m,u),v,this.memCacheValueSize(v))};q.getOverridesFromCache=function(m,{loadedAttributes:u,attributeData:v},y){const B=new Set,x=[];for(var C of u)x[C.index]=v[C.name];v=new Set;for(C=0;C<m.length;C++){const z=m[C];if(y.has(z))for(const A of u){const t=
this.fromCache(z,A.index);void 0!==t?x[A.index][C]=t:(B.add(z),v.add(A.name))}}return{objectIds:Array.from(B),fieldNames:Array.from(v)}};q.fromCache=function(m,u){const v=this.fromInteractiveEditingSession(m,u);if(void 0!==v)return v;m=this.getCacheKey(m,u);return this.memCache.get(m)};q.fromInteractiveEditingSession=function(m,u){if(!a.isNone(this.interactiveEditingSessions))for(const v of this.interactiveEditingSessions){if(v.objectId!==m)continue;const y=v.get(u);if(void 0!==y)return y}};q.getCacheKey=
function(m,u){return`${m}-${u}`};q.queryOverridesFromAssociatedLayer=async function(m,u,v){if(0===m.length||0===u.length)return null;m=m.sort((x,C)=>x-C);this.warnMaximumChangedObjectsExceeded&&(this.warnMaximumChangedObjectsExceeded=!1,this.logMaximumObjectsExceededWarning());const y=a.unwrap(this.layer.associatedLayer),B=y.createQuery();B.where="1\x3d1";B.returnGeometry=!1;B.outFields=[y.objectIdField,...u];B.cacheHint=!0;B.objectIds=m;u=g.getMaximumQuerySize(y);m=m.length>u?l.splitIntoChunks(m,
u).map(x=>{const C=B.clone();C.objectIds=x;return e.resultOrAbort(g.queryAllJSON(y,C,{signal:v}))}):[e.resultOrAbort(g.queryAllJSON(y,B,{signal:v}))];return(await h.all(m)).reduce((x,C)=>x.concat(C.ok?C.value.features:[]),[])};q.logMaximumObjectsExceededWarning=function(){let m=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${d.formatNumber(5E4)} objects. Please consider re-caching the scene service`;
const u=this.layer.portalItem;m=u&&u.loaded?m+` (${u.portal.url}/home/item.html?id=${u.id}#settings)`:m+` (${this.layer.parsedUrl.path})`;p.warn(`("${this.layer.title}"):`,`${m}.`)};q.processOverridesFromAssociatedLayer=function(m,u,v,{loadedAttributes:y,attributeData:B}){const x=a.unwrap(this.layer.associatedLayer).objectIdField,C=v.map(A=>B[A]),z=new Map(y.map(A=>[A.name,A.index]));y=v.map(A=>z.get(A));m=new Map(Array.from(m,(A,t)=>[A,t]));for(const A of u){u=A.attributes[x];for(let t=0;t<v.length;t++){const D=
y[t],E=m.get(u),G=A.attributes[v[t]];C[t][E]=G;this.cacheValue(u,D,G)}}};q.memCacheValueSize=function(m){return"string"===typeof m?f.estimateStringByteSize(m):f.estimateNumberByteSize()};q.fetchChangedObjectIds=async function(m){var u,v,y,B=this.layer;this.changedObjectIds.clear();if(!a.isNone(B.associatedLayer)&&null!=(u=B.associatedLayer.capabilities)&&null!=(v=u.operations)&&v.supportsChangeTracking){u=this.getFetchChangedObjectIdsServerGen();if(a.isNone(u))return null;v=B.associatedLayer.layerId;
m=await e.result(c(`${B.associatedLayer.url}/extractChanges`,{method:"post",query:{f:"json",returnIdsOnly:!0,layers:`${v}`,returnUpdates:!0,returnDeletes:!1,returnInserts:!1,layerServerGens:JSON.stringify([{id:v,serverGen:u}])},timeout:1E4,signal:m}));m=m.ok&&null!=(y=m.value.data)&&y.edits?a.get(m.value.data.edits[0],"objectIds","updates"):null;if(a.isSome(m))for(y=Math.min(5E4,m.length),y<m.length&&(this.warnMaximumChangedObjectsExceeded=!0),m=m.sort((x,C)=>x-C),B=0;B<y;B++)this.changedObjectIds.add(m[B])}};
q.getFetchChangedObjectIdsServerGen=function(){var m=this.layer;if(a.isSome(m.serviceUpdateTimeStamp)&&a.isSome(m.serviceUpdateTimeStamp.lastUpdate))return m.serviceUpdateTimeStamp.lastUpdate;m=m.associatedLayer;return a.isSome(m)&&a.isSome(m.serverGens)&&a.isSome(m.serverGens.minServerGen)?m.serverGens.minServerGen:null};return w}();let n=function(){function w(m,u){this.objectId=m;this.options=u;this.updates=new Map;this.state=0}var q=w.prototype;q.get=function(m){return this.updates.get(m)};q.set=
function(m,u){this.isActive&&this.updates.set(m,u)};q.rollback=function(){this.isActive&&(this.state=2,this.options.rollback())};q.commit=function(){this.isActive&&(this.state=1,this.options.commit(this.updates),this.updates.clear())};k._createClass(w,[{key:"isActive",get:function(){return 0===this.state}}]);return w}();b.I3SAttributeOverrides=r;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/layers/support/featureQueryAll":function(){define(["exports","../../core/maybe","../../tasks/support/Query"],
function(b,k,a){function r(d){return h(d)*l(d)}function l(d){return d.capabilities.query.maxRecordCount||2E3}function h(d){return d.capabilities.query.supportsMaxRecordCountFactor?a.MAX_MAX_RECORD_COUNT_FACTOR:1}b.getMaxRecordCountFactor=h;b.getMaximumQuerySize=r;b.getMaximumRecordCount=l;b.queryAllJSON=async function(d,c,e){c=c.clone();d.capabilities.query.supportsMaxRecordCountFactor&&(c.maxRecordCountFactor=h(d));const f=r(d),g=d.capabilities.query.supportsPagination;c.start=0;c.num=f;let p=null;
for(;;){const n=await d.source.queryFeaturesJSON(c,e);k.isNone(p)?p=n:p.features=p.features.concat(n.features);p.exceededTransferLimit=n.exceededTransferLimit;if(!g||!n.exceededTransferLimit)break;c.start+=f}return p};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/scheduling"],function(b,k,a,r){let l=function(){function h(c){this.view=
c;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}var d=h.prototype;d.stopNodeFading=function(c){null!=c.lodCrossfadeProgress&&(this._numFadingNodes--,c.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=a.removeMaybe(this._preRenderFrameTaskHandle)),this.view.notifyLODUpdate(),this.view.notifyUpdate()))};d._startNodeFading=function(c,e,f){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=
r.addFrameTask({preRender:g=>this._updateAllNodeFading(g)}),this.view.notifyLODUpdate());null==c.lodCrossfadeProgress&&(this._numFadingNodes++,this.view.notifyUpdate());c.lodCrossfadeSignedDuration=f;c.lodCrossfadeProgress=e};d._updateAllNodeFading=function(c){const e=this.view.nodeCrossfadingEnabled;this.view.foreachCrossfadeNode((f,g)=>{if(a.isSome(g)&&a.isSome(g.lodCrossfadeProgress)){const p=g.lodCrossfadeSignedDuration,n=g.lodCrossfadeProgress+Math.abs(c.deltaTime/p),w=!e||1<=n||0===p,q=(0<p?
this.view.fullOpacity:0)-(w?0:0<p?1:-1)*(1-n);w?(this.stopNodeFading(g),0>p&&this.view.markNodeToRemove(f)):g.lodCrossfadeProgress=n;this.view.setNodeOpacityByIndex(f,q)}});this.view.removeMarkedNodes()};d.stopAllNodeFading=function(){this.view.foreachCrossfadeNode((c,e)=>{a.isSome(e)&&a.isSome(e.lodCrossfadeProgress)&&(this.stopNodeFading(e),e=e.lodCrossfadeSignedDuration,0>e&&this.view.markNodeToRemove(c),this.view.setNodeOpacityByIndex(c,0<e?this.view.fullOpacity:0))});this.view.removeMarkedNodes()};
d.fadeNode=function(c,e,f,g){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var p=this.view;const n=p.nodeCrossfadingEnabled,w=0===f?p.fullOpacity:0;g=n?g?0===f?p.lodCrossfadeinDuration:p.lodCrossfadeoutDuration:p.lodCrossfadeUncoveredDuration:0;p=this.view.getNodeOpacityByIndex(c);n&&p!==w&&0<g?this._startNodeFading(e,1-Math.abs(w-p),(0===f?1:-1)*g):(this.stopNodeFading(e),this.view.setNodeOpacityByIndex(c,w),0!==w&&1!==f||this.view.removeNode(c))};d.isNodeFullyFadedIn=
function(c){const e=this.view.getNodeCrossfadeMetaData(c);return a.isSome(e)&&null==e.lodCrossfadeProgress&&this.view.getNodeOpacityByIndex(c)===this.view.fullOpacity};k._createClass(h,[{key:"updating",get:function(){return 0<this._numFadingNodes}}]);return h}();b.I3SCrossfadeHelper=l;b.NodeCrossfadeMetaData=function(){this.lodCrossfadeSignedDuration=0};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../chunks/vec3f64 ../../../../chunks/vec3 ../../../../chunks/mat4 ../../../../geometry/support/aaBoundingRect ../../../../chunks/mat4f64 ../../webgl-engine/lib/Intersector".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){const x=v.empty(),C=y.create(),z=q.create(),A=q.create(),t=q.create(),D=l.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");a=function(E){function G(I){I=E.call(this,I)||this;I.tmpEvent={spatialReference:null,extent:x,context:"scene"};return I}b._inheritsLoose(G,E);var H=G.prototype;H.initialize=function(){this.view=this.layerView.view;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersector=new B.Intersector(this.view.state.mode);
this.intersector.options.store=0;const I=this.layerView.i3slayer.fullExtent;this.zmin=I.zmin;this.zmax=I.zmax;this.tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};H.getElevation=function(I,J,K,L){z[0]=I;z[1]=J;z[2]=K;if(!this.renderCoordsHelper.toRenderCoords(z,L,z))return D.error("could not project point to compute elevation"),null;J=this.layerView.elevationOffset;I=this.zmin+J;J=this.zmax+J;m.copy(A,z);m.copy(t,z);this.renderCoordsHelper.setAltitude(J,A);this.renderCoordsHelper.setAltitude(I,
t);this.intersector.reset(A,t);this.intersectionHandler.intersect(this.intersector,null,A,t);return this.intersector.results.min.getIntersectionPoint(z)?this.renderCoordsHelper.getAltitude(z):null};H.layerChanged=function(){this.spatialReference&&(this.tmpEvent.extent=this.computeLayerExtent(),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};H.objectChanged=function(I){this.spatialReference&&(this.tmpEvent.extent=this.computeObjectExtent(I),this.tmpEvent.spatialReference=
this.spatialReference,this.emit("elevation-change",this.tmpEvent))};H.computeObjectExtent=function(I){v.empty(x);this._expandExtent(I,x);return x};H.computeLayerExtent=function(){v.empty(x);for(const I of this.layerView.getVisibleNodes())this._expandExtent(I,x);return x};H._expandExtent=function(I,J){var K=I.visibilityObb||I.serviceObbInRenderSR;if(r.isSome(K))for(u.fromQuat(C,K.quaternion),C[12]=K.center[0],C[13]=K.center[1],C[14]=K.center[2],I=0;8>I;++I)z[0]=I&1?K.halfSize[0]:-K.halfSize[0],z[1]=
I&2?K.halfSize[1]:-K.halfSize[1],z[2]=I&4?K.halfSize[2]:-K.halfSize[2],m.transformMat4(z,z,C),this.renderCoordsHelper.fromRenderCoords(z,z,this.spatialReference),v.expand(J,z);else{var L=I.renderMbs[3];K=m.copy(A,I.renderMbs);K[0]-=L;K[1]-=L;K[2]-=L;I=m.copy(t,I.renderMbs);I[0]+=L;I[1]+=L;I[2]+=L;for(L=0;8>L;++L)z[0]=L&1?K[0]:I[0],z[1]=L&2?K[1]:I[1],z[2]=L&4?K[2]:I[2],this.renderCoordsHelper.fromRenderCoords(z,z,this.spatialReference),v.expand(J,z)}};return G}(w.EventedMixin(n));k.__decorate([d.property({constructOnly:!0})],
a.prototype,"layerView",void 0);k.__decorate([d.property({constructOnly:!0})],a.prototype,"intersectionHandler",void 0);k.__decorate([d.property()],a.prototype,"view",void 0);k.__decorate([d.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],a.prototype,"spatialReference",void 0);return a=k.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],a)})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../webgl-engine/lib/intersectorUtils ../../support/orientedBoundingBox".split(" "),
function(b,k,a,r,l,h){function d(e,f,g,p=0){p=e[3]+p;const n=f[0]-e[0],w=f[1]-e[1];e=f[2]-e[2];f=g[0];const q=g[1];g=g[2];const m=f*n+q*w+g*e;return 0<=m*m-(f*f+q*q+g*g)*(n*n+w*w+e*e-p*p)}let c=function(){function e(f){this.type="I3S";this.layerUid=f.layerUid;this.sublayerUid=f.sublayerUid;this.collection=f.collection;this.forEach=f.forEach;this.slicePlane=f.slicePlaneEnabled;this.isGround=f.isGround}e.prototype.intersect=function(f,g,p,n){const w=f.results,q=2===f.options.store,m=f.ray.direction,
u=f.tolerance;let v=x=>x,y=x=>x;const B=l.getVerticalOffsetI3S(f.verticalOffset);a.isSome(B)&&(v=x=>B.applyToMbs(x),y=x=>B.applyToObb(x));this.forEach((x,C)=>{if(a.isSome(x.geometryObb)){if(!h.intersectLine(y(x.geometryObb),p,m,u))return}else if(a.isSome(x.serviceObbInRenderSR)){if(!h.intersectLine(y(x.serviceObbInRenderSR),p,m,u))return}else if(!d(v(x.renderMbs),p,m,u))return;this.collection.intersect(C,p,n,u,B,(z,A,t,D)=>{if(0<=A&&(null==g||g(p,n,A))){var E=G=>{G.intersector=this.type;G.target=
{type:"external",metadata:{layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:x.index,componentIndex:z}};G.dist=A;r.copy(G.normal,t);G.triangleNr=D};this.isGround&&(null==w.ground.dist||A<w.ground.dist)&&E(w.ground);if(!f.options.isFiltered&&((null==w.min.dist||A<w.min.dist)&&E(w.min),(null==w.max.dist||A>w.max.dist)&&E(w.max),q)){const G=new l.IntersectorResult(f.ray);E(G);f.results.all.push(G)}}})})};k._createClass(e,[{key:"intersectionHandlerId",get:function(){return this.layerUid}}]);
return e}();b.I3SIntersectionHandler=c;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/Error","../../../../core/promiseUtils"],function(b,k,a,r,l){function h(e){return l.create((f,g)=>{e.oncomplete=()=>f();e.onerror=()=>g(e.error);e.onabort=()=>g(e.error)})}function d(e){return l.create((f,g)=>{"done"===e.readyState?null!=e.error?g(e.error):
f(e.result):(e.onsuccess=()=>f(e.result),e.onerror=()=>g(e.error))})}let c=function(){function e(g,p,n=14){this._version=n;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=.2;this._dbName=g;this._storeName=p}var f=e.prototype;f.init=function(){return l.resolve().then(()=>{const g=indexedDB.open(this._dbName,this._version);g.onupgradeneeded=p=>{var n=g.result;const w=g.transaction,
q=n.objectStoreNames.contains(this._storeName)?w.objectStore(this._storeName):n.createObjectStore(this._storeName);n=n.objectStoreNames.contains("last_access")?w.objectStore("last_access"):n.createObjectStore("last_access");n.indexNames.contains("date")||n.createIndex("date","date",{unique:!1});n.indexNames.contains("byteSize")||n.createIndex("byteSize","byteSize",{unique:!1});p.oldVersion<this._version&&(q.clear(),n.clear())};return d(g)}).then(g=>{this._destroyed?g.close():this._db=g})};f.destroy=
function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};f.getHitRate=function(){return this._hit/(this._hit+this._miss)};f.put=function(g,p){return null==this._db?l.reject(new r("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:l.resolve()).then(()=>this._put(g,p)).catch(n=>{if(n&&"QuotaExceededError"===n.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(w=>
this._removeLeastRecentlyAccessed(p.byteSize+Math.ceil(w*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(g,p));throw n;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=this.gcFrequency,this._getCacheSize().then(n=>this._removeLeastRecentlyAccessed(n-this.maxByteSize)))})};f.get=function(g,p){if(null==this._db)return l.resolve(null);
let n=null;return l.resolve().then(()=>{const w=this._db.transaction(this._storeName,"readonly");n=l.onAbort(p,()=>{w.abort()});const q=w.objectStore(this._storeName).get(g);return d(q)}).then(w=>{null==w?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),byteSize:w.byteSize},g));a.isSome(n)&&n.remove();return w}).catch(()=>{++this._miss;l.throwIfAborted(p);a.isSome(n)&&n.remove();return null})};f.remove=function(g){return null==
this._db?l.resolve():l.resolve().then(()=>{const p=this._db.transaction([this._storeName,"last_access"],"readwrite");var n=p.objectStore(this._storeName),w=p.objectStore("last_access");n=n.delete(g);w=w.delete(g);return l.all([d(n),d(w),h(p)])})};f._put=function(g,p){const n=this._db.transaction([this._storeName,"last_access"],"readwrite");var w=n.objectStore(this._storeName);const q=n.objectStore("last_access");w=w.put(p,g);g=q.put({date:Date.now(),byteSize:p.byteSize},g);return l.all([d(w),d(g),
h(n)])};f._removeLeastRecentlyAccessed=function(g){if(!(0>=g)){var p=this._db.transaction([this._storeName,"last_access"],"readwrite"),n=p.objectStore(this._storeName),w=p.objectStore("last_access"),q=0,m=w.index("date").openCursor(null,"next");m.onsuccess=()=>{const u=m.result;null!=u&&(null!=u.value.byteSize&&(q+=u.value.byteSize),n.delete(u.primaryKey),w.delete(u.primaryKey),q<g&&u.continue())};return h(p)}};f._getCacheSize=function(){const g=this._db.transaction("last_access");let p=0;const n=
g.objectStore("last_access").index("byteSize").openKeyCursor();n.onsuccess=()=>{const w=n.result;if(w){var q=w.key;null!=q&&(p+=q);w.continue()}};return h(g).then(()=>p)};k._createClass(e,[{key:"initialized",get:function(){return null!=this._db}}]);return e}();b.IDBCache=c;b.whenRequest=d;b.whenTransaction=h;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports","../../../../../core/maybe"],function(b,k){let a=function(){function r(h,
d){this._textureRep=h;this._textureId=d;this._textureRef=k.applySome(this._textureId,c=>this._textureRep.acquire(c))}var l=r.prototype;l.dispose=function(){this._textureRef=k.applySome(this._textureId,h=>{this._textureRep.release(h)})};l.bind=function(h,d,c,e,f){k.isSome(this._textureRef)&&(d.setUniform1i(c,e),h.bindTexture(this._textureRef.glTexture,e),f&&(h=this._textureRef.glTexture,d.setUniform2f(f,h.descriptor.width,h.descriptor.height)))};return r}();b.RenderTexture=a;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(b,k){b.getEllipsoidMode=function(a){return a&&k.isMars(a)?2:a&&k.isMoon(a)?3:1};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/arrayUtils ../../../../core/Accessor ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils ../../../../geometry ../../../../chunks/vec3 ../../../../core/unitUtils ../../../../core/watchUtils ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../../core/sql/WhereClause ../../../../geometry/support/aaBoundingBox ../../../layers/support/FeatureFilter ./I3SUtil".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G){async function H(){return F?F:F=await new Promise(function(W,X){b(["../../../../geometry/geometryEngine"],W,X)})}function I(W,X){if(!W)return null;if("disjoint"===X&&"polygon"===W.type){const R=Array(W.rings.length);for(X=0;X<W.rings.length;++X){var ca=z.fromValues(Infinity,Infinity,-Infinity,-Infinity);z.expandWithNestedArray(ca,W.rings[X]);R[X]={type:"polygon",rings:[W.rings[X]],spatialReference:W.spatialReference,aabr:ca}}R.sort((da,
fa)=>da.aabr[0]-fa.aabr[0]);const aa=new Set,ka=new q.PositionHint;for(W=0;W<R.length;++W){const da=R[W];for(X=W+1;X<R.length;++X){ca=R[X];if(ca.aabr[0]>=da.aabr[2])break;aa.add(ca)}aa.forEach(fa=>{da!==fa&&(fa.aabr[2]<=da.aabr[0]?aa.delete(fa):F.intersects(da,fa)&&(da.rings=da.rings.concat(fa.rings),z.expand(da.aabr,fa.aabr),delete da._geVersion,aa.delete(fa),fa=q.indexOf(R,fa,R.length,ka),R.splice(fa,1)))});aa.add(da)}for(const da of R)delete da.aabr;return R}return[W]}function J(W,X,ca,R,aa,ka,
da){const fa=ka[0].spatialReference||R.spatialReference;if(A.projectBoundingSphere(X.node.mbs,aa,P,fa)){var ea=K(da,R,fa,ca,X.objectHandle);ca=L(P,ea);for(const Y of ka){if(0===W.length)break;switch(S(Y,ca,da)){case 1:W.length=0;return;case 0:continue}G.filterInPlace(W,X.featureIds,Z=>O(Y,Z,ea))}}else Q.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}function K(W,X,ca,R,aa){X=X.renderSpatialReference;const ka=new Map,da={rings:[[[0,0,0],[0,
0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:ca};da.rings[0][3]=da.rings[0][0];let fa,ea;switch(W){case "intersects":fa=(Y,Z)=>F.intersects(Y,Z)?0:2;ea=M;break;case "contains":fa=(Y,Z)=>F.contains(Y,Z)?2:1;ea=M;break;default:fa=(Y,Z)=>F.disjoint(Y,Z)?2:1,ea=T}return{collection:R,object:aa,type:W,maskSR:ca,renderSR:X,aabbCache:ka,triangle:da,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},triangleTest:fa,geometryTest:ea}}function L(W,X){const ca={x:W[0],
y:W[1],hasZ:!1,hasM:!1,type:"point",spatialReference:X.maskSR};W=X.maskSR.isWGS84||X.maskSR.isWebMercator?F.geodesicBuffer(ca,W[3],1):F.buffer(ca,W[3],1);W.type="polygon";return W}function S(W,X,ca){switch(ca){case "intersects":case "contains":return M(W,X);case "disjoint":return T(W,X)}}function M(W,X){return F.intersects(W,X)?F.contains(W,X)?0:2:1}function T(W,X){return F.intersects(W,X)?F.contains(W,X)?1:2:0}function O(W,X,ca){const {collection:R,object:aa,renderSR:ka,maskSR:da,geometryTest:fa,
aabbCache:ea}=ca;var Y=ea.get(X);if(!Y){Y=R.getObjectTransform(aa);R.getComponentAabb(aa,X,V);var Z=[[V[0],V[1],0],[V[0],V[4],0],[V[3],V[4],0],[V[3],V[1],0]];for(var ba=0;4>ba;++ba)B.transformMat3(Z[ba],Z[ba],Y.rotationScale),B.add(Z[ba],Z[ba],Y.position),A.projectVectorToVector(Z[ba],ka,Z[ba],da);Y={rings:[Z],hasZ:!1,hasM:!1,type:"polygon",spatialReference:da};Y.rings[0][4]=Y.rings[0][0];ea.set(X,Y)}switch(fa(W,Y)){case 1:return!1;case 0:return!0}const {triangle:ia,triangleTest:ja,positions:la}=
ca;Y=ia.rings[0][0];Z=ia.rings[0][1];ba=ia.rings[0][2];const qa=R.getObjectTransform(aa);R.getComponentPositions(aa,X,la);const {indices:na,data:oa,stride:ua,startIndex:za,endIndex:Fa}=la;for(X=za;X<Fa;X+=3){const La=ua*na[X+0],Sa=ua*na[X+1],Ia=ua*na[X+2];B.set(Y,oa[La+0],oa[La+1],oa[La+2]);B.set(Z,oa[Sa+0],oa[Sa+1],oa[Sa+2]);B.set(ba,oa[Ia+0],oa[Ia+1],oa[Ia+2]);B.transformMat3(Y,Y,qa.rotationScale);B.transformMat3(Z,Z,qa.rotationScale);B.transformMat3(ba,ba,qa.rotationScale);B.add(Y,Y,qa.position);
B.add(Z,Z,qa.position);B.add(ba,ba,qa.position);A.projectVectorToVector(Y,ka,Y,da);A.projectVectorToVector(Z,ka,Z,da);A.projectVectorToVector(ba,ka,ba,da);if(!(Math.abs((Z[0]-Y[0])*(ba[1]-Y[1])-(Z[1]-Y[1])*(ba[0]-Y[0]))<U))switch(delete ia._geVersion,ja(W,ia)){case 1:return!1;case 0:return!0}}switch(ca.type){case "intersects":return!1;default:return!0}}const Q=d.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");k.I3SMeshViewFilter=function(W){function X(R){R=W.call(this,R)||this;R._projectionEngineLoaded=
!1;return R}a._inheritsLoose(X,W);var ca=X.prototype;ca.initialize=function(){C.whenOnce(this,"filter.geometry").then(()=>this.loadAsyncModule(H().then(R=>{this.destroyed||(this._geometryEngine=R,this.applyFilters())})))};ca.addFilters=function(R,aa,ka,da){const fa=this.sortedObjectIds;h.isSome(fa)&&R.push(Y=>G.objectIdFilter(fa,!0,Y));this.addSqlFilter(R,this.parsedWhereClause);const ea=this.parsedGeometry;if(h.isSome(ea)){const Y=this.spatialRelationship;R.push((Z,ba)=>J(Z,ba,da,aa,ka,ea,Y))}};
X.checkSupport=function(R){if(R.timeExtent)return Q.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1;R=R.spatialRelationship;return null!=R&&0<=N.indexOf(R)?!0:(Q.warn(`Filters with spatialRelationship other than ${N.join(", ")} are not supported for mesh scene layers`),!1)};a._createClass(X,[{key:"sortedObjectIds",get:function(){if(h.isNone(this.filter.objectIds))return null;const R=new Float64Array(this.filter.objectIds);R.sort();return R}},{key:"parsedWhereClause",get:function(){const R=
h.isSome(this.filter)?this.filter.where:null;if(h.isNone(R)||!R)return null;try{return t.WhereClause.create(R,this.layerFieldsIndex)}catch(aa){Q.error(`Failed to parse filter where clause: ${aa}`)}return null}},{key:"parsedGeometry",get:function(){if(h.isNone(this.filter)||!this._geometryEngine)return null;var {geometry:R}=this.filter;if(h.isNone(R))return null;const {distance:aa,units:ka}=this.filter,da=this.spatialRelationship;R="mesh"===R.type?R.extent:R;if(h.isNone(aa)||0===aa)return I(R,da);
const fa=ka||x.getUnitString(R.spatialReference);if(R.spatialReference.isWGS84)return R=this._geometryEngine.geodesicBuffer(R,aa,fa),I(R,da);if(v.canProject(R,u.WGS84))return R=v.project(this._geometryEngine.geodesicBuffer(v.project(R,u.WGS84),aa,fa),R.spatialReference),I(R,da);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(A.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;let ea=null;try{ea=A.project(R,u.WGS84)}catch(Y){}if(ea)try{ea=A.project(this._geometryEngine.geodesicBuffer(ea,
aa,fa),R.spatialReference)}catch(Y){ea=null}ea||Q.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${R.spatialReference.wkid}) to WGS84.`);return I(ea,da)}},{key:"spatialRelationship",get:function(){return h.isSome(this.filter)?this.filter.spatialRelationship:"intersects"}}]);return X}(m);r.__decorate([e.property({type:E})],k.I3SMeshViewFilter.prototype,"filter",void 0);r.__decorate([e.property()],k.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);r.__decorate([e.property()],
k.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);r.__decorate([e.property()],k.I3SMeshViewFilter.prototype,"applyFilters",void 0);r.__decorate([e.property()],k.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);r.__decorate([e.property({readOnly:!0})],k.I3SMeshViewFilter.prototype,"sortedObjectIds",null);r.__decorate([e.property({readOnly:!0})],k.I3SMeshViewFilter.prototype,"parsedWhereClause",null);r.__decorate([e.property({readOnly:!0})],k.I3SMeshViewFilter.prototype,"parsedGeometry",null);
r.__decorate([e.property({readOnly:!0})],k.I3SMeshViewFilter.prototype,"spatialRelationship",null);r.__decorate([e.property({})],k.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);r.__decorate([e.property({})],k.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);k.I3SMeshViewFilter=r.__decorate([g.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],k.I3SMeshViewFilter);let F;const N=["contains","intersects","disjoint"],P=[0,0,0,0],U=2**-32,V=D.create();Object.defineProperty(k,
"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/Error ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../geometry/Extent ../../../../core/Handles ../../../../tasks/support/FeatureSet ../../../../tasks/support/Query ../../../../layers/graphics/data/QueryEngine".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B){const x=B["default"];b.I3SQueryEngine=function(C){function z(t){t=C.call(this,t)||this;t._dataQueryEngineInstance=null;t._handles=new u;return t}k._inheritsLoose(z,C);var A=z.prototype;A.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};A.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&
(this._handles.destroy(),this._handles=null);this._set("layerView",null)};A.executeQueryForCount=async function(t,D){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(t),D)};A.executeQueryForExtent=async function(t,D){const {count:E,extent:G}=await this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(t),D);t=m.fromJSON(G);return{count:E,extent:t}};A.executeQueryForIds=async function(t,D){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(t),D)};A.executeQuery=
async function(t,D){t=this._ensureQueryJSON(t);if(t.returnGeometry)throw new g("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(t.returnCentroid)throw new g("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");D=await this.dataQueryEngine.executeQuery(t,D);D=v.fromJSON(D);D.features.forEach(E=>{E.geometry=null});return D};A._ensureQueryJSON=function(t){if(l.isNone(t))return this.defaultQueryJSON;
const D=t.toJSON();D.outSpatialReference||(t.outSpatialReference=this.spatialReference);return D};A.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const t=this.layer.objectIdField||"OBJECTID",D=this.layer.fields.map(H=>H.toJSON()),E=this.layerView.view.resourceController.scheduler,G=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new x({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:D,timeInfo:null,spatialReference:G,
objectIdField:t,featureStore:this.spatialIndex,scheduler:E,task:this.task})};k._createClass(z,[{key:"defaultQueryJSON",get:function(){return(new y({outSpatialReference:this.spatialReference})).toJSON()}},{key:"dataQueryEngine",get:function(){return this.ensureDataQueryEngine()}}]);return z}(q);a.__decorate([c.property({constructOnly:!0})],b.I3SQueryEngine.prototype,"layerView",void 0);a.__decorate([c.property({constructOnly:!0})],b.I3SQueryEngine.prototype,"task",void 0);a.__decorate([c.property({constructOnly:!0})],
b.I3SQueryEngine.prototype,"spatialIndex",void 0);a.__decorate([c.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],b.I3SQueryEngine.prototype,"spatialReference",void 0);a.__decorate([c.property({readOnly:!0,aliasOf:"layerView.i3slayer"})],b.I3SQueryEngine.prototype,"layer",void 0);a.__decorate([c.property({readOnly:!0,dependsOn:["spatialReference"]})],b.I3SQueryEngine.prototype,"defaultQueryJSON",null);b.I3SQueryEngine=a.__decorate([f.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],
b.I3SQueryEngine);b.default=b.I3SQueryEngine;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("exports ../../../../core/maybe ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/centroid ../../../../geometry/support/aaBoundingBox ./I3SUtil".split(" "),function(b,k,a,r,l,h){let d=function(){function e(g){this.objectIdField=g.objectIdField;this.getFeatureExtent=g.getFeatureExtent}var f=e.prototype;f.getObjectId=
function(g){return g.id};f.getAttributes=function(g){const {meta:p,index:n}=g,w={};this.objectIdField&&(w[this.objectIdField]=g.id);g=k.isSome(p.attributeInfo)&&p.attributeInfo.attributeData;if(k.isSome(g))for(const q of Object.keys(g))w[q]=h.getCachedAttributeValue(g[q],n);return w};f.getAttribute=function(g,p){if(p===this.objectIdField)return g.id;const {meta:n,index:w}=g;g=k.isSome(n.attributeInfo)&&n.attributeInfo.attributeData;return k.isSome(g)?h.getCachedAttributeValue(g[p],w):null};f.getGeometry=
function(g){if(g.geometry)return g.geometry;const [p,n,w,q,m]=this.getFeatureExtent(g,c);return new a([5],[p,n,w,q,n,w,q,m,w,p,m,w,p,n,w])};f.getCentroid=function(g,p){if(g.geometry)return r.getCentroidOptimizedGeometry(new a,g.geometry,p.hasZ,p.hasM);const [n,w,q,m,u,v]=this.getFeatureExtent(g,c);return new a([0],[(n+m)/2,(w+u)/2,(q+v)/2])};f.cloneWithGeometry=function(g,p){const {id:n,index:w,meta:q}=g;return{id:n,index:w,meta:q,geometry:p}};return e}();const c=l.create();b.I3SQueryFeatureAdapter=
d;Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/Accessor ../../../../core/Evented ../../../../geometry/support/aaBoundingRect ../../../../geometry/projection ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v){b.I3SQueryFeatureStore=function(C){function z(t){t=C.call(this,t)||this;t.events=new w;return t}k._inheritsLoose(z,C);var A=z.prototype;A.destroy=function(){};A.forEach=function(t){this.forAllFeatures(D=>{t(D);return 1})};A.forEachBounds=function(t,D,E){const G=this.getFeatureExtent;for(const H of t)D(G(H,E))};A.forEachInBounds=function(t,D){this.forAllFeatures(E=>{const G=this.getFeatureExtent(E,B);q.intersects(t,v.toRect(G,x))&&D(E);return 1},E=>{m.projectBoundingSphere(E.node.mbs,
this.sourceSpatialReference,y,this.viewSpatialReference);if(y[0]>=t[0]&&y[2]<=t[2]&&y[1]>=t[1]&&y[3]<=t[3])return 1;E=y[0]-Math.max(t[0],Math.min(y[0],t[2]));const G=y[1]-Math.max(t[1],Math.min(y[1],t[3]));return E*E+G*G<=y[3]*y[3]?1:2})};return z}(n);a.__decorate([d.property({constructOnly:!0})],b.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);a.__decorate([d.property({constructOnly:!0})],b.I3SQueryFeatureStore.prototype,"forAllFeatures",void 0);a.__decorate([d.property({constructOnly:!0})],
b.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);a.__decorate([d.property({constructOnly:!0})],b.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);a.__decorate([d.property({constructOnly:!0})],b.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);b.I3SQueryFeatureStore=a.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],b.I3SQueryFeatureStore);const y=u.create(),B=v.create(),x=q.create();b.default=b.I3SQueryFeatureStore;Object.defineProperty(b,
"__esModule",{value:!0})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/property ../../../../core/jsonMap ../../../../core/accessorSupport/decorators/subclass ../../../../core/urlUtils ../../../../core/uuid ../../../../portal/support/resourceExtension ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w){const q=l.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");b.DefinitionExpressionSceneLayerView=m=>{m=function(u){function v(){var B=u.apply(this,arguments)||this;B._definitionExpressionErrors=0;B._maxDefinitionExpressionErrors=20;B.logError=x=>{B._definitionExpressionErrors<B._maxDefinitionExpressionErrors&&q.error("Error while evaluating definitionExpression: "+x);B._definitionExpressionErrors++;B._definitionExpressionErrors===B._maxDefinitionExpressionErrors&&
q.error("Further errors are ignored")};return B}k._inheritsLoose(v,u);var y=v.prototype;y._evaluateClause=function(B,x){try{return B.testFeature(x)}catch(C){return this.logError(C),!1}};y._addDefinitionExpressionToQuery=function(B){if(!this.parsedDefinitionExpression)return B;const x=this.i3slayer.definitionExpression;B=B.clone();B.where=B.where?`(${x}) AND (${B.where})`:x;return B};k._createClass(v,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;
try{const B=n.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!B.isStandardized)return q.error("definitionExpression is using non standard function"),null;const x=[];w.findFieldsCaseInsensitive(B.fieldNames,this.i3slayer.fields,{missingFields:x});if(0<x.length)return q.error(`definitionExpression references unknown fields: ${x.join(", ")}`),null;this._definitionExpressionErrors=0;return B}catch(B){return q.error("Failed to parse definitionExpression: "+B),null}}},
{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}}]);return v}(m);a.__decorate([d.property()],m.prototype,"i3slayer",void 0);a.__decorate([d.property({readOnly:!0,dependsOn:["i3slayer.definitionExpression","i3slayer.fieldsIndex"]})],m.prototype,"parsedDefinitionExpression",null);a.__decorate([d.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],m.prototype,"definitionExpressionFields",null);return m=
a.__decorate([e.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],m)};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/i3s/attributeEditing":function(){define(["exports","../../../../core/lang","../../../../core/maybe","../support/attributeUtils"],function(b,k,a,r){function l(f,g){const p=g.edits.updateFeatures;if(!p||0===p.length)return new e;const n=h(g),w=new e;g=new Map;for(let v=0;v<f.attributeStorageInfo.length;v++)g.set(f.attributeStorageInfo[v].name,
v);const q=f.fieldsIndex,m=f.objectIdField,u=p.filter(v=>{v=r.attributeLookup(q,v.attributes,m);return n.has(v)});f.forEachNode((v,y)=>{const B=new Set(y);for(const t of u){const D=r.attributeLookup(q,t.attributes,m);if(!B.has(D))continue;const E=y.indexOf(D);for(const G in t.attributes){var x=f.fieldsIndex.normalizeFieldName(G);var C=w;var z=v.index,A=C.get(z);A?C=A:(A=new c,C.set(z,A),C=A);(z=C.get(x))?x=z:(z=[],C.set(x,z),x=z);x.push({featureIndex:E,featureId:D,value:t.attributes[G]})}}});return w}
function h(f){const g=new Set;if(!f.updatedFeatures)return g;for(const p of f.updatedFeatures)null!=p.objectId&&null==p.error&&g.add(p.objectId);return g}const d={setAttribute(){},rollback(){},commit(){}},c=Map,e=Map;b.createInteractiveEditSession=function(f,g){const p=k.clone(g.attributes),n=new Set,w=p[f.objectIdField];if(null==w)return d;const q=f.attributeOverrides.createInteractiveEditSession(w),m=new Map;let u=0;return{setAttribute(v,y){if(0===u){var B=f.fieldsIndex.get(v);if(!a.isNone(B)){var x=
f.attributeStorageInfo.findIndex(A=>A.name===B.name);if(!(0>x)){q.set(x,y);var C=f.attributeStorageInfo[x],z=!1;n.add(v);f.forEachNode((A,t)=>{var D=m.get(A);null==D?(t=t.indexOf(w),m.set(A,t)):t=D;if(-1!==t&&(D=f.getAttributeData(A.index))){const E=D[C.name];E&&(E[t]=y,f.setAttributeData(A.index,D,g),z=!0)}});z&&f.clearMemCache()}}}},rollback(){if(0===u){for(const v of n)this.setAttribute(v,p[v]);q.rollback();u=1}},commit(){q.commit();u=2}}};b.processAttributeEdits=function(f,g){g=l(f,g);if(0!==
g.size){var p=new Map;for(let w=0;w<f.attributeStorageInfo.length;w++)p.set(f.attributeStorageInfo[w].name,w);var n=!1;g.forEach((w,q)=>{const m=f.getAttributeData(q);let u=!1;w.forEach((v,y)=>{const B=a.isSome(m)?m[y]:null;y=p.get(y);for(const {featureIndex:x,value:C,featureId:z}of v)B&&(B[x]=C,n=u=!0),f.attributeOverrides.updateValue(z,y,C)});u&&f.setAttributeData(q,m,null)});n&&f.clearMemCache()}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports",
"../../../../layers/support/fieldUtils"],function(b,k){b.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,dependsOn:["layer.fields","layer.outFields","requiredFields"],get:function(){const {layer:a,layer:{fields:r},requiredFields:l}=this;return a.outFields?k.fixFields(r,[...k.unpackFieldNames(r,a.outFields),...l]):k.fixFields(r,l)}}}};Object.defineProperty(b,"__esModule",{value:!0})})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/jsonMap ../../../core/accessorSupport/decorators/subclass ../../../core/urlUtils ../../../core/uuid ../../../portal/support/resourceExtension ../../../core/promiseUtils ../../../geometry/support/contains ../../../layers/support/fieldUtils ../../../Graphic ../../../chunks/vec3f64 ../../../chunks/vec3 ../../../core/watchUtils ../../../geometry/support/aaBoundingRect ../../../geometry/projection ../../support/Scheduler ../../../tasks/operations/zscale ../../../tasks/support/Query ../../../layers/graphics/dehydratedFeatures ../support/debugFlags ../../../layers/graphics/hydratedFeatures ../../../renderers/support/renderingInfoUtils ./LayerView3D ./support/layerViewUpdatingProperties ../support/orientedBoundingBox ../../layers/support/FeatureFilter ../../layers/SceneLayerView ./i3s/I3SUtil ../../../layers/graphics/controllers/I3SOnDemandController ../support/GraphicsMap ./i3s/I3SAttributeOverrides ./support/DefinitionExpressionSceneLayerView ./graphics/QueryEngine ./graphics/Graphics3DFeatureLikeLayerView ./I3SPointsWorkerHandle ./support/PopupSceneLayerView ./i3s/attributeEditing ./support/fieldProperties".split(" "),
function(b,k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q,F,N,P,U,V,W,X){function ca(ea){const Y=ea.attributeInfo;for(let Z=0;Z<ea.graphics.length;Z++){const ba=ea.graphics[Z];ba.attributes||(ba.attributes={});if(l.isSome(Y)&&l.isSome(Y.loadedAttributes))for(const {name:ia}of Y.loadedAttributes)Y.attributeData[ia]&&(ba.attributes[ia]=M.getCachedAttributeValue(Y.attributeData[ia],Z))}}const R=h.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D");r=X.defineFieldProperties();
I=function(ea){function Y(){var ba=ea.apply(this,arguments)||this;ba._nodesAddedToStage=new Map;ba.drapeSourceType=1;ba._queryEngine=null;ba._memCache=null;ba.loadedGraphics=new O.GraphicsMap;ba.holeFilling="always";ba.progressiveLoadFactor=1;ba.supportsHeightUnitConversion=!0;ba._coordinatesOutsideExtentErrors=0;ba._maxCoordinatesOutsideExtentErrors=20;return ba}k._inheritsLoose(Y,ea);var Z=Y.prototype;Z.initialize=function(){var ba;const ia=this.layer;this._attributeOverrides=new Q.I3SAttributeOverrides(this.layer,
null==(ba=this.view.resourceController)?void 0:ba.memoryController);M.checkSpatialReferences(ia,this.view.spatialReference,this.view.viewingMode);for(const ja of["layer.renderer","layer.labelingInfo","layer.labelsVisible","definitionExpressionFields","filter"])this.updatingHandles.add(this,ja,()=>this._updateRequiredFields());this.updatingHandles.add(ia,"rangeInfos",ja=>this._rangeInfosChanged(ja),2);this.updatingHandles.add(ia,"renderer",(ja,la)=>this._rendererChange(ja,la));this.updatingHandles.add(this,
"parsedDefinitionExpression",()=>this._filterChange());this.handles.add(B.init(E,"I3S_TREE_SHOW_TILES",ja=>{if(ja&&!this._treeDebugger){const la=this._controller.crsIndex;(new Promise(function(qa,na){b(["./support/I3STreeDebugger"],qa,na)})).then(({I3STreeDebugger:qa})=>{!this._treeDebugger&&E.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new qa({lv:this,view:this.view,nodeSR:la}))})}else ja||!this._treeDebugger||E.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)}));this._updateRequiredFields();
this._set("graphics3d",new P({owner:this,layer:ia,preferredUpdatePolicy:1,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:ia.fullExtent,updateClippingExtent:ja=>this._updateClippingExtent(ja)}));if(this.graphics3d.elevationAlignment)this.graphics3d.elevationAlignment.events.on("invalidate-elevation",ja=>this._invalidateElevation(ja));
this.supportsHeightUnitConversion&&(this._verticalScale=A.getGeometryZScaler("point",ia.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.graphics3d.setup());this._memCache=this.view.resourceController.memoryController.getMemCache(ia.uid);this._controller=new T({layerView:this,scaleVisibilityEnabled:!1});M.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new U.I3SPointsWorkerHandle(this.view.resourceController.scheduler));this.handles.add(this.layer.on("apply-edits",
ja=>this.updatingHandles.addPromise(ja.result)));this.handles.add(this.layer.on("edits",ja=>this._handleEdits(ja)));this.when(()=>{this._queryEngine=new N["default"]({layerView:this,task:z.Task.FEATURE_QUERY_ENGINE});this.updatingHandles.add(this,"maximumNumberOfFeatures",ja=>this._controller.featureTarget=ja,2);this.updatingHandles.add(this,"suspended",ja=>{ja&&this._removeAllNodeData()})})};Z.destroy=function(){this._treeDebugger=l.destroyMaybe(this._treeDebugger);this._attributeOverrides=l.destroyMaybe(this._attributeOverrides);
this._set("graphics3d",l.destroyMaybe(this.graphics3d));this._controller=l.destroyMaybe(this._controller);this._queryEngine=l.destroyMaybe(this._queryEngine);this._worker=l.destroyMaybe(this._worker);this._memCache=l.destroyMaybe(this._memCache);this._nodesAddedToStage.clear()};Z.notifyGraphicUpdate=function(ba,ia){this.graphics3d.graphicsCore.notifyGraphicUpdate(ba,ia)};Z.whenGraphicAttributes=async function(ba,ia){return M.whenGraphicAttributes(this.layer,ba,this._getObjectIdField(),ia,()=>[...this._nodesAddedToStage.values()],
{populateObjectId:!0})};Z.getGraphicFromGraphicUid=function(ba){if(!this.loadedGraphics)return null;const ia=G.hydrateGraphic(this.loadedGraphics.find(la=>la.uid===ba),this.layer),ja=this._getObjectIdField();if(!ia||!ia.attributes||!ia.attributes[ja])return null;ia.layer=this.layer;ia.sourceLayer=this.layer;return ia};Z.whenGraphicBounds=function(ba,ia){return this.graphics3d.graphicsCore.whenGraphicBounds(ba,ia)};Z.computeAttachmentOrigin=function(ba,ia){return this.graphics3d.graphicsCore.computeAttachmentOrigin(ba,
ia)};Z.canResume=function(){return ea.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};Z.isUpdating=function(){return!!(this._controller&&this._controller.updating||this.graphics3d&&this.graphics3d.updating)};Z.getRenderingInfo=function(ba,ia,ja){(ba=H.getRenderingInfo(ba,{renderer:ia,arcade:ja}))&&ba.color&&(ia=ba.color,ia[0]/=255,ia[1]/=255,ia[2]/=255);return ba};Z.getRenderingInfoAsync=async function(ba,ia,ja,la){return H.getRenderingInfoAsync(ba,{renderer:ia,
arcade:ja,...la})};Z.highlight=function(ba){return this.graphics3d.highlight(ba,this.layer.objectIdField)};Z.createInteractiveEditSession=function(ba){return W.createInteractiveEditSession(this.attributeEditingContext,ba)};Z.extractBinaryPointData=async function(ba,ia){ba={geometryBuffer:ba.geometryBuffer};l.isNone(this._worker)&&(this._worker=new U.I3SPointsWorkerHandle(this.view.resourceController.scheduler));return this._worker.invoke(ba,ia).then(ja=>{if(l.isSome(ja))return{positionData:ja.positions,
featureIds:ja.featureIds};throw Error("Failed to decompress Draco point data");})};Z.checkExtent=function(ba,ia){ba&&!q.extentContainsCoords3D(ba,ia)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&R.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&R.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++)};Z.addNode=async function(ba,
ia,ja){if(!("geometryBuffer"in ia&&null!==ia.geometryBuffer||"pointData"in ia))return w.reject();if(this._nodesAddedToStage.has(ba.index))R.error("I3S node "+ba.id+" already added");else{var la;if(la=this.layer.fullExtent)la=this.layer.fullExtent.clone(),la.xmin-=.5,la.ymin-=.5,la.xmax+=.5,la.ymax+=.5,la.hasZ&&(la.zmin-=.5,la.zmax+=.5),la.hasM&&(la.mmin-=.5,la.mmax+=.5);var qa=this._controller.crsVertex,na=[],oa={graphics:null,featureIds:null,attributeInfo:ia.attributeDataInfo,node:ba};"geometryBuffer"in
ia&&null!==ia.geometryBuffer?await this._addNodeBinaryPointData(ba,oa,ia,la,na,ja):"pointData"in ia&&this._addNodeLegacyPointData(ba,oa,ia,la,na);await this._attributeOverrides.apply(oa.featureIds,ia.attributeDataInfo,ja);ba.numFeatures=oa.graphics.length;this._updateNodeMemory(ba);ca(oa);0<na.length&&(this.computeObb(ba,na,qa),this._controller.updateVisibility(ba.index));if(!this._controller.isGeometryVisible(ba))return this._cacheNodeData(oa),w.resolve();if(this._verticalScale)for(const ua of oa.graphics)this._verticalScale(ua.geometry);
this._nodesAddedToStage.set(ba.index,oa);this.loadedGraphics.addMany(oa.graphics);this._filterNode(oa);this._treeDebugger&&this._treeDebugger.update();return w.resolve()}};Z.computeObb=function(ba,ia,ja){const la=this._controller.crsIndex,qa=la.isGeographic?this.view.renderSpatialReference:la;C.projectBuffer(ia,ja,0,ia,qa,0,ia.length/3);ba.serviceObb=K.compute({data:ia,size:3,offsetIdx:0,strideIdx:3});la.isGeographic&&C.projectVectorToVector(ba.serviceObb.center,qa,ba.serviceObb.center,la)};Z.isNodeLoaded=
function(ba){return this._nodesAddedToStage.has(ba)};Z.isNodeReloading=function(){return!1};Z.updateNodeState=function(){};Z._addNodeBinaryPointData=async function(ba,ia,ja,la,qa,na){var oa=await this.extractBinaryPointData(ja,na);if(null==oa)return w.reject();ja=this._getObjectIdField();na=this._controller.crsVertex;const ua=this.view.spatialReference,za=this.graphics3d.graphicsCore,{positionData:Fa,featureIds:La}=oa;oa=Fa.length/3;const Sa=[];for(let Ga=0;Ga<oa;Ga++){var Ia=l.isSome(ba.serviceObb)?
ba.serviceObb.center:[0,0,0],Qa=3*Ga,Pa=v.fromValues(Fa[Qa+0],Fa[Qa+1],Fa[Qa+2]);y.add(Pa,Pa,Ia);ba.serviceObb||qa.push(Pa[0],Pa[1],Pa[2]);la&&this.checkExtent(la,Pa);Qa=La[Ga];Ia={};null!=Qa&&(Ia[ja]=Qa);Qa=null==Qa?u.generateUID():Qa;C.projectBuffer(Pa,na,0,ka,ua,0,1);Pa=D.makeDehydratedPoint(ka[0],ka[1],ka[2],ua);var sa=this.loadedGraphics.get(Qa);l.isSome(sa)?(sa.level<ba.level&&(da.property="geometry",da.graphic=sa,da.oldValue=l.unwrap(sa.geometry),da.newValue=Pa,sa.geometry=Pa,za.graphicUpdateHandler(da)),
Sa.push(sa)):(sa=u.generateUID(),Sa.push({objectId:Qa,uid:sa,geometry:Pa,attributes:Ia,visible:!0,level:ba.level}))}ia.graphics=Sa;ia.featureIds=La};Z._addNodeLegacyPointData=function(ba,ia,ja,la,qa){const na=this._getObjectIdField(),oa=this._controller.crsVertex,ua=this.view.spatialReference,za=[0,0,0],Fa=[],La=[];for(const Qa of ja.pointData){ja=Qa.featureDataPosition;const Pa=ja.length;var Sa=Qa.geometries&&Qa.geometries[0]||aa[Pa];const sa=Qa.featureIds[0];if("points"!==Sa.params.type)continue;
la&&this.checkExtent(la,ja);const Ga={};null!=sa&&(Ga[na]=sa);const Ra=null==sa?u.generateUID():sa;let Ua;"Embedded"===Sa.type&&(Ua=Sa.params.vertexAttributes.position);for(Sa=0;Sa<Ua.length;Sa+=Pa){for(var Ia=0;Ia<Pa;Ia++)za[Ia]=ja[Ia]+Ua[Sa+Ia];Ia=3===Pa;ba.serviceObb||qa.push(za[0],za[1],Ia?za[2]:0);C.projectBuffer(za,oa,0,ka,ua,0,1);Ia=D.makeDehydratedPoint(ka[0],ka[1],Ia?ka[2]:void 0,ua);const ha=this.loadedGraphics.get(Ra);l.isSome(ha)?La.push(ha):La.push({objectId:Ra,uid:u.generateUID(),geometry:Ia,
attributes:Ga,visible:!0})}Fa.push(sa)}ia.graphics=La;ia.featureIds=Fa};Z._updateNodeMemory=function(ba){ba.memory=4096+(l.isSome(ba.numFeatures)?ba.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic:0)};Z._cacheNodeData=function(ba){const ia=ba.graphics.reduce((ja,la)=>D.estimateSize(la)+ja,8*ba.featureIds.length+1536);this._memCache.put(this._getMemCacheKey(ba.node),ba,ia)};Z._getMemCacheKey=function(ba){return`${ba.index}`};Z._removeAllNodeData=function(){this._nodesAddedToStage.forEach(ba=>
{ba&&(this._updateNodeMemory(ba.node),this._cacheNodeData(ba))});this._nodesAddedToStage.clear();this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};Z.removeNode=function(ba){if(ba=this._removeNodeStageData(ba))this._updateNodeMemory(ba.node),this._cacheNodeData(ba)};Z._removeNodeStageData=function(ba){const ia=this._nodesAddedToStage.get(ba);if(!ia)return null;this.loadedGraphics.removeMany(ia.graphics);this._nodesAddedToStage.delete(ba);this._treeDebugger&&this._treeDebugger.update();
return ia};Z.loadCachedNodeData=async function(ba){return this._memCache.pop(this._getMemCacheKey(ba))};Z.addCachedNodeData=async function(ba,ia,ja,la){if(this._nodesAddedToStage.has(ba.index))R.error("I3S node "+ba.id+" already added");else return this.loadedGraphics.addMany(ia.graphics),this._nodesAddedToStage.set(ba.index,ia),this._updateNodeMemory(ba),await this.updateAttributes(ba.index,ja,la),this._filterNode(ia),this._treeDebugger&&this._treeDebugger.update(),w.resolve()};Z.getLoadedNodeIds=
function(){const ba=[];this._nodesAddedToStage.forEach(ia=>ba.push(ia.node.id));return ba.sort()};Z.getVisibleNodes=function(){const ba=[];this._nodesAddedToStage.forEach(ia=>ba.push(ia.node));return ba};Z.getLoadedNodeIndices=function(ba){this._nodesAddedToStage.forEach((ia,ja)=>ba.push(ja))};Z.getLoadedAttributes=function(ba){if((ba=this._nodesAddedToStage.get(ba))&&l.isSome(ba.attributeInfo))return ba.attributeInfo.loadedAttributes};Z.getAttributeData=function(ba){if((ba=this._nodesAddedToStage.get(ba))&&
l.isSome(ba.attributeInfo))return ba.attributeInfo.attributeData};Z.setAttributeData=function(ba,ia){(ba=this._nodesAddedToStage.get(ba))&&!l.isNone(ba.attributeInfo)&&(ba.attributeInfo.attributeData=ia,this._attributeValuesChanged(ba))};Z.updateAttributes=async function(ba,ia,ja){if(ba=this._nodesAddedToStage.get(ba))await this._attributeOverrides.apply(ba.featureIds,ia,ja),ba.attributeInfo=ia,this._attributeValuesChanged(ba)};Z._attributeValuesChanged=function(ba){ca(ba);this._filterNode(ba);this.graphics3d.graphicsCore.labelsEnabled&&
(ba=ba.graphics.map(ia=>ia.uid),this.graphics3d.graphicsCore.updateLabelingInfo(ba))};Z._updateClippingExtent=function(ba){this._controller&&this._controller.updateClippingArea(ba);return!1};Z._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};Z._rendererChange=async function(ba,ia){const {layer:{fields:ja}}=this,la=new Set;let qa;ba?(await ba.collectRequiredFields(la,ja),qa=Array.from(la).sort()):qa=[];la.clear();let na;ia?(await ia.collectRequiredFields(la,ja),na=Array.from(la).sort()):
na=[];qa.length===na.length&&qa.every((oa,ua)=>qa[ua]===na[ua])||this._reloadAllNodes()};Z._rangeInfosChanged=function(ba){null!=ba&&0<ba.length&&R.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};Z._filterChange=function(){this._nodesAddedToStage.forEach(ba=>this._filterNode(ba))};Z._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};Z._filterNode=function(ba){const ia=
this.parsedDefinitionExpression;for(const ja of ba.graphics)ba=ja.visible,ja.visible=ia?this._evaluateClause(ia,ja):!0,ba!==ja.visible&&(da.graphic=ja,da.property="visible",da.oldValue=ba,da.newValue=ja.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(da))};Z._updateRequiredFields=async function(){const {layer:ba,layer:{fields:ia,renderer:ja,labelsVisible:la},filter:qa,definitionExpressionFields:na}=this,oa=new Set;ja&&await ja.collectRequiredFields(oa,ia);la&&await m.collectLabelingFields(oa,
ba);l.isSome(qa)&&await m.collectFilterFields(oa,ba,qa);m.collectFields(oa,ia,na);this._set("requiredFields",Array.from(oa).sort())};Z._invalidateElevation=function(ba){const ia=this._controller.crsIndex;C.projectBoundingRect(ba.extent,ba.spatialReference,fa,ia);this._controller.updateElevationChanged(fa,ia)};Z.createQuery=function(){const ba={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return l.isSome(this.filter)?this.filter.createQuery(ba):new t(ba)};Z.queryFeatures=
function(ba,ia){return this._queryEngine.executeQuery(this._ensureQuery(ba),null==ia?void 0:ia.signal)};Z.queryObjectIds=function(ba,ia){return this._queryEngine.executeQueryForIds(this._ensureQuery(ba),null==ia?void 0:ia.signal)};Z.queryFeatureCount=function(ba,ia){return this._queryEngine.executeQueryForCount(this._ensureQuery(ba),null==ia?void 0:ia.signal)};Z.queryExtent=function(ba,ia){return this._queryEngine.executeQueryForExtent(this._ensureQuery(ba),null==ia?void 0:ia.signal)};Z._ensureQuery=
function(ba){return this._addDefinitionExpressionToQuery(l.isNone(ba)?this.createQuery():t.from(ba))};Z.getUsedMemory=function(){const ba=this.graphics3d&&this.graphics3d.graphicsCore;return ba?ba.usedMemory:0};Z.getUnloadedMemory=function(){const ba=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(ba?ba.unprocessedMemoryEstimate:0))};Z.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};
Z._handleEdits=function(ba){W.processAttributeEdits(this.attributeEditingContext,ba)};k._createClass(Y,[{key:"maximumNumberOfFeatures",get:function(){const ba=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return ba?ba.maximumNumberOfFeatures:0},set:function(ba){null!=ba?(this._override("maximumNumberOfFeatures",ba),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",
get:function(){return this.suspended?!1:!!this._controller&&!this._controller.leavesReached}},{key:"hasM",get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"symbolUpdateType",get:function(){return this.graphics3d.graphicsCore.symbolUpdateType}},{key:"attributeEditingContext",get:function(){const ba=this._getObjectIdField();return{fieldsIndex:this.layer.fieldsIndex,objectIdField:ba,forEachNode:ia=>this._nodesAddedToStage.forEach(ja=>ia(ja.node,ja.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo,
attributeOverrides:this._attributeOverrides,getAttributeData:ia=>this.getAttributeData(ia),setAttributeData:(ia,ja,la)=>{this.setAttributeData(ia,ja);ia=this._nodesAddedToStage.get(ia);l.isSome(la)?(la=this.loadedGraphics.get(la.attributes[ba]),l.isSome(la)&&this.graphics3d.graphicsCore.recreateGraphics([la])):l.isSome(ia)&&this.graphics3d.graphicsCore.recreateGraphics(ia.graphics)},clearMemCache:()=>{}}}},{key:"performanceInfo",get:function(){const ba={displayedNumberOfFeatures:this.loadedGraphics.length,
maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.graphics3d.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(ba);return ba}},{key:"test",get:function(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,numFeatures:this.loadedGraphics.length}}}]);return Y}(F.DefinitionExpressionSceneLayerView(V.PopupSceneLayerView(I.LayerView3D(S))));a.__decorate([c.property()],I.prototype,"graphics3d",
void 0);a.__decorate([c.property({type:L})],I.prototype,"filter",void 0);a.__decorate([c.property()],I.prototype,"loadedGraphics",void 0);a.__decorate([c.property()],I.prototype,"layer",void 0);a.__decorate([c.property({aliasOf:"layer"})],I.prototype,"i3slayer",void 0);a.__decorate([c.property()],I.prototype,"_controller",void 0);a.__decorate([c.property({dependsOn:["_controller.updating","graphics3d.updating"]})],I.prototype,"updating",void 0);a.__decorate([c.property({dependsOn:["_controller.rootNodeVisible"]})],
I.prototype,"suspended",void 0);a.__decorate([c.property()],I.prototype,"holeFilling",void 0);a.__decorate([c.property(J.updatingProgress)],I.prototype,"updatingProgress",void 0);a.__decorate([c.property({aliasOf:"_controller.updatingProgress"})],I.prototype,"updatingProgressValue",void 0);a.__decorate([c.property(r.requiredFields)],I.prototype,"requiredFields",void 0);a.__decorate([c.property(r.availableFields)],I.prototype,"availableFields",void 0);a.__decorate([c.property({type:Number,dependsOn:["graphics3d.graphicsCore.displayFeatureLimit"]})],
I.prototype,"maximumNumberOfFeatures",null);a.__decorate([c.property({readOnly:!0,dependsOn:["suspended","_controller.leavesReached"]})],I.prototype,"maximumNumberOfFeaturesExceeded",null);a.__decorate([c.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],I.prototype,"lodFactor",void 0);a.__decorate([c.property({readOnly:!0})],I.prototype,"hasM",null);a.__decorate([c.property({readOnly:!0})],I.prototype,"hasZ",null);a=I=a.__decorate([f.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],
I);const aa={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},ka=v.create(),da={graphic:null,property:null,oldValue:null,newValue:null},fa=x.create();return a})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../support/WorkerHandle"],function(b,k,a){a=function(r){function l(h){return r.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",
h,{hasInitialize:!0})||this}k._inheritsLoose(l,r);l.prototype.getTransferList=function(h){return[h.geometryBuffer]};return l}(a.WorkerHandle);b.I3SPointsWorkerHandle=a;Object.defineProperty(b,"__esModule",{value:!0})})},"*noref":1}});
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/maybe ../core/Logger ../core/accessorSupport/ensureType ../core/handleUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/events ../core/promiseUtils ../core/scheduling ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../geometry/Point ../geometry/Extent ../geometry ../core/Collection ../core/screenUtils ../Graphic ../chunks/vec3f64 ../Camera ../Ground ../geometry/projectionEllipsoid ../Viewpoint ../core/watchUtils ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/projection ./support/spatialReferenceSupport ../webscene/Environment ../core/workers/workers ../core/domUtils ./support/screenshotUtils ../geometry/support/scaleUtils ./support/layerViewUtils ./DOMContainer ./support/screenUtils ./View ../layers/support/layerUtils ./BreakpointsOwner ./3d/support/ElevationProvider ./GroundView ./PopupView ./ViewAnimation ./support/WebGLRequirements ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ../chunks/boundedPlane ./3d/support/geometryUtils ./3d/environment/SceneViewEnvironmentManager ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/Intersector ./3d/input/SceneInputManager ./3d/support/debugFlags ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/graphics/ObjectResourceCache ./3d/layers/support/FeatureTileTree3D ./3d/support/PropertiesPool ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/DisplayQualityProfile ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/terrain/terrainUtils ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/webgl-engine/Stage ./support/hitTestSelectUtils ./ui/3d/DefaultUI3D".split(" "),function(b,
k,a,r,l,h,d,c,e,f,g,p,n,w,q,m,u,v,y,B,x,C,z,A,t,D,E,G,H,I,J,K,L,S,M,T,O,Q,F,N,P,U,V,W,X,ca,R,aa,ka,da,fa,ea,Y,Z,ba,ia,ja,la,qa,na,oa,ua,za,Fa,La,Sa,Ia,Qa,Pa,sa,Ga,Ra,Ua,ha,Ya,Wa,db,mb,Ea,ya,xa,wa,ma,ta,Da,Oa,Ja){function ra(ab,gb){ab.layerUids||(ab.layerUids=new Set);ab.layerUids.add(gb)}function Ca(ab,gb){ab.graphicUids||(ab.graphicUids=new Set);ab.graphicUids.add(gb)}const Ma=h.getLogger("esri.views.SceneView");h=function(ab){function gb(Ha){var Na=ab.call(this,Ha)||this;Na._clippingArea=null;Na._userClippingArea=
null;Na._initialDefaultSpatialReference=null;Na._defaults={};Na._externallySet={environment:!1};Na._createGraphicsViewController=null;Na._resolveWhenReady=[];Na.propertiesPool=new Pa.PropertiesPool({slicePlane:la.BoundedPlaneClass},k._assertThisInitialized(Na));Na._resourceController=Ea.newResourceController(k._assertThisInitialized(Na));Na._defaultToMapOptions={include:new Set};Na._defaultHitTestOptions={exclude:new Set};Na.deconflictor=new La.GraphicsDeconflictor({view:k._assertThisInitialized(Na)});
Na.labeler=new Sa.Labeler({view:k._assertThisInitialized(Na),deconflictor:Na.deconflictor.labels});Na.sharedSymbolResources=null;Na.basemapTerrain=null;Na.elevationProvider=null;Na.camera=null;Na.canvas=null;Na.center=null;Na.constraints=new ia["default"];Na.environmentManager=new na["default"];Na.extent=null;Na.windowDevicePixelRatio=1;Na.fullOpacity=1;Na.graphicsView=null;Na.groundView=null;Na.navigating=!1;Na.map=null;Na.screenSizePerspectiveEnabled=!0;Na.state=new sa;Na.scale=null;Na.spatialReference=
null;Na.isHeightModelInfoRequired=!0;Na.alphaCompositingEnabled=!1;Na.supersampleScreenhotsEnabled=!0;Na.type="3d";Na.ui=new Ja;Na._numUpdating=0;Na._lastUpdateTime=0;Na.updatingProgress=.5;Na.viewpoint=null;Na.zoom=null;Na.highlightOptions=new Ya;F.initialize();Ha&&Ha.environment||(Na._defaults.environment=new ja,Na.environment=Na._defaults.environment);Ha=()=>{Na.notifyChange("dataExtent");Na.updatingChanged();Na.map&&Na.map.allLayers.forEach(async $a=>{try{await $a.when()}catch{}Na.updatingChanged()})};
Na.handles.add([L.on(k._assertThisInitialized(Na),"map.allLayers","after-changes",Ha,Ha,Ha,!0),Na.allLayerViews.on("after-changes",()=>Na._updateUpdatingMonitors()),Na.watch("map",$a=>{$a&&$a.load&&$a.load().catch(()=>{})})]);Na.inputManager=new za({view:k._assertThisInitialized(Na)});Na.stateManager=new Ga({view:k._assertThisInitialized(Na),updateDevicePixelRatio:()=>{const $a=window.devicePixelRatio;$a!==Na.windowDevicePixelRatio&&(Na.windowDevicePixelRatio=$a,Na.notifyChange("pixelRatio"))}});
return Na}k._inheritsLoose(gb,ab);var bb=gb.prototype;bb.initialize=function(){this.groundView=new da({view:this});this._updateUpdatingMonitors();const Ha=()=>this._updateDefaultToMapOptions();this.handles.add(L.on(this,"map.allLayers","after-changes",Ha,Ha,Ha));this.updatingHandles.add(this.qualitySettings,"memoryLimit",Na=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=Na)},2);this.updatingHandles.add(this.qualitySettings,"additionalCacheMemory",Na=>{this.resourceController&&
(this.resourceController.memoryController.additionalCacheMemory=Na)},2);this.updatingHandles.add(this.qualitySettings,"frameRate",Na=>y.setFrameDuration(0<Na?1E3/Math.ceil(Na):0),2);this.updatingHandles.add(Fa,"SCENEVIEW_LOCKING_LOG",Na=>this.defaultsFromMap.logDebugInformation=Na,2);this.updatingHandles.add(this,"map.ground",Ha,3);this.updatingHandles.add(this,"map.ground.opacity",()=>this._updateDefaultHitTestOptions(),3);this.handles.add(this.watch("spatialReference",()=>this.notifyChange("clippingArea"),
!0))};bb.destroy=function(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController.destroy(),this._resourceController=null,this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),
this._set("inputManager",null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView.destroy(),this.groundView=null)};bb.castEnvironment=function(Ha){return Ha?Ha instanceof ja?Ha:Ha instanceof Q?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(Ha):ja.fromWebsceneEnvironment(Ha):d.ensureType(ja,Ha):new ja};bb.on=function(Ha,Na,$a,cb){return($a=this.viewEvents.on(Ha,Na,$a,cb))?
$a:ab.prototype.on.call(this,Ha,Na)};bb.hasEventListener=function(Ha){return ab.prototype.hasEventListener.call(this,Ha)||this.viewEvents.hasHandler(Ha)};bb.toMap=function(Ha,Na){if(!this.ready)return Ma.error("#toMap()","Scene view cannot be used before it is ready"),null;Na=Na?this.externalToInternalIntersectOptions(Na):this._defaultToMapOptions;var $a=l.isSome(Na.graphics)&&(l.isSome(Na.graphics.include)||l.isSome(Na.graphics.exclude));Ha=X.isSupportedScreenPointEvent(Ha)?X.createScreenPointFromSupportedEvent(this,
Ha):Ha;Ha=D.screenPointObjectToArray(Ha);Na.enableDraped=Na.include&&!Na.include.has(oa.TERRAIN_ID)||Na.exclude&&Na.exclude.has(oa.TERRAIN_ID);const cb=this.sceneIntersectionHelper,eb=new ua.Intersector(this.state.mode);eb.options.selectionMode=!0;eb.options.store=$a?2:0;cb.intersectIntersectorScreen(Ha,eb,Na);if($a){for(const hb of eb.results.all)if($a=hb.toGraphic(this),l.isNone($a)||this._testGraphicUidFilter(Na.graphics,$a))return this._intersectResultToMapPoint(hb);return null}return this._intersectResultToMapPoint(eb.results.min)};
bb.toScreen=function(Ha){if(!this.ready)return Ma.error("#toScreen()","Scene view cannot be used before it is ready"),null;const Na=null==Ha.z&&ka.getElevationAtPoint(this.elevationProvider,Ha)||0;T.projectPointToVector(Ha,Ta,this.renderSpatialReference,Na);this.state.camera.projectToScreen(Ta,Xa);return D.createScreenPoint(Xa[0],Xa[1])};bb.pixelSizeAt=function(Ha){if(!this.ready)return Ma.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!Ha)return 0;T.projectPointToVector(Ha,
Ta,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(Ta)};bb.overlayPixelSizeInMapUnits=function(Ha){const Na=this.basemapTerrain.overlayManager;return Na?Na.overlayPixelSizeInMapUnits(Ha):1};bb.hitTest=function(Ha,Na){if(!this.ready)return Ma.error("#hitTest()","Scene view cannot be used before it is ready"),null;Ha=X.isSupportedScreenPointEvent(Ha)?X.createScreenPointFromSupportedEvent(this,Ha):Ha;var $a=D.createScreenPointArray(Ha.x,Ha.y),cb=Na?this.externalToInternalIntersectOptions(Na):
this._defaultHitTestOptions;cb.requiresGroundFeedback=!0;cb.enableDraped=!0;Na=new ua.Intersector(this.state.mode);Na.options.selectionMode=!0;Na.options.store=2;this.sceneIntersectionHelper.intersectIntersectorScreen($a,Na,cb);$a=this._intersectResultsToHits(Na.results.all,cb.graphics);cb=Na.results.ground;var eb=cb.toOwner(this);eb=l.isSome(eb)&&"type"in eb&&"integrated-mesh"===eb.type?eb:null;Ha={screenPoint:Ha,results:$a,ground:{mapPoint:this._intersectResultToMapPoint(cb),distance:cb.hasIntersectionPoint?
cb.distanceInRenderSpace:0,layer:eb}};Fa.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(Ha.intersector=Na);return v.resolve(Ha)};bb.popupHitTest=function(Ha){return Oa.hitTestSelectSameDistance(this,Ha).then(({results:Na,ground:$a})=>{let cb=null;!(0===Na.length||1E-5>Math.abs(Na[0].distance-$a.distance))||$a.layer&&"integrated-mesh"===$a.layer.type||(cb=$a.mapPoint);return{results:Na,screenPoint:Ha,mapPoint:cb}})};bb.goTo=function(Ha,Na){return this.updatingHandles.addPromise(this.stateManager.goTo(Ha,Na))};
bb.whenLayerView=function(Ha){return ab.prototype.whenLayerView.call(this,Ha)};bb.takeScreenshot=function(Ha){return this.whenReady().then(()=>{const Na=P.toRenderSettings(Ha,this);Na.pixelRatio/=this.pixelRatio;return this._stage.renderView.takeScreenshot(P.screenshotSuperSampleSettings(Na,this.supersampleScreenhotsEnabled,this.padding))})};bb.importLayerView=function(Ha){return ba.layerView3DImporter.importLayerView(Ha)};bb.hasLayerViewModule=function(Ha){return ba.layerView3DImporter.hasLayerViewModule(Ha)};
bb.forceDOMReadyCycle=function(){this.forceReadyCycle()};bb.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null};bb.validate=async function(){let Ha=Y.check();r("safari")&&9>r("safari")&&(Ha=new n("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,
detectedVersion:r("safari")}));if(l.isSome(Ha))throw Ma.warn("#validate()",Ha.message),Ha;};bb.isSpatialReferenceSupported=function(Ha,Na,$a){var cb=Ha.isGeographic;const eb=Ha.isWebMercator,hb=O.isSpatialReferenceSupported(Ha,"global"),kb="local"===this.viewingMode,lb=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(lb){if(kb&&cb)return $a&&$a(`Layer ${Na.id} is ignored because it is GCS and viewing mode is local`),!1;if(!kb&&!hb)return $a&&$a(`Layer ${Na.id} is ignored because its spatial reference is not supported in global viewing mode`),
!1}else if(cb&&!hb)return $a&&$a(`Layer ${Na.id} is ignored because its spatial reference is geographic but unsupported`),!1;if(Na)if(R.isTiledLayer(Na)){if(lb?Ha=null!=ya.getTiledLayerInfo(Na,Ha,Z.viewingModeFromString(this.viewingMode)).tileInfo:(cb=ya.getTiledLayerInfo(Na,Ha,1),null==cb.tileInfo&&(cb=ya.getTiledLayerInfo(Na,Ha,2),null!=cb.tileInfo&&eb&&!this.ready&&(this.viewingMode="local")),Ha=null!=cb.tileInfo),!Ha)return $a&&$a(`Layer ${Na.id} is ignored because it is tiled but
            its tiling scheme is not supported or compatible with the viewing mode`),!1}else if((Ha.isWGS84||eb)&&!kb)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=Ha),lb||this.ready||(this.viewingMode="global",$a&&$a(`Viewing mode locked to global due to reprojectable layer ${Na.id}`)),$a&&$a(`Layer ${Na.id} is ignored because it supports server-side reprojection`),!1;return!0};bb.whenReady=function(){return v.create(Ha=>{this.ready?Ha(this):this._resolveWhenReady.push(Ha)})};
bb.computeMapPointFromVec3d=function(Ha,Na){let $a=this.spatialReference||B.WGS84;T.projectVectorToVector(Ha,this.renderSpatialReference,Ha,$a)||($a=B.WGS84,T.projectVectorToVector(Ha,this.renderSpatialReference,Ha,$a));Na?(Na.x=Ha[0],Na.y=Ha[1],Na.z=Ha[2],Na.spatialReference=$a):Na=new C(Ha,$a);return Na};bb.flushDisplayModifications=function(){this._stage.processDirty()};bb.trackGraphicState=function(Ha){if(!Ha.graphic)return Ma.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),
null;const Na=this.getViewForGraphic(Ha.graphic);let $a=null,cb=!1;const eb=hb=>{!cb&&l.isSome(hb)&&"graphics3d"in hb&&hb.graphics3d&&hb.graphics3d.graphicsCore&&($a=hb.graphics3d.graphicsCore.trackGraphicState(Ha))};l.isSome(Na)?eb(Na):this.whenViewForGraphic(Ha.graphic,{waitForLayer:!0}).then(hb=>eb(hb),()=>{}).catch(()=>{});return{remove:()=>{cb=!0;l.isSome($a)&&($a.remove(),$a=null)}}};bb.highlight=function(Ha){if(Array.isArray(Ha))return c.handlesGroup(Ha.map($a=>this.highlight($a)));if(t.isCollection(Ha))return c.handlesGroup(Ha.toArray().map($a=>
this.highlight($a)));const Na=this.getViewForGraphic(Ha);return Na&&"highlight"in Na?Na.highlight(Ha):c.makeHandle()};bb.maskOccludee=function(Ha){if(!Ha)return Ma.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Na=this.getViewForGraphic(Ha);let $a=null,cb=!1;const eb=hb=>{!cb&&l.isSome(hb)&&"graphics3d"in hb&&V.occludeesSupported(hb)&&($a=hb.maskOccludee(Ha))};l.isSome(Na)?eb(Na):this.whenViewForGraphic(Ha,{waitForLayer:!0}).then(hb=>eb(hb),
()=>{}).catch(()=>{});return{remove:()=>{cb=!0;l.isSome($a)&&($a.remove(),$a=null)}}};bb.getViewForGraphic=function(Ha){return Ha.layer===this.graphics?this.graphicsView:Ha.layer?this.allLayerViews.find(Na=>Na.layer===Ha.layer):null};bb.graphicChanged=function(Ha){l.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(Ha)};bb.whenViewForGraphic=async function(Ha,Na){if(Ha.layer===this)return await L.whenOnce(this,"graphicsView"),this.graphicsView;if(!Ha.layer||!this.map)throw new n("no-view-for-graphic");
return Na&&Na.waitForLayer&&!this.map.allLayers.includes(Ha.layer)?v.create(($a,cb)=>{const eb=this.map.allLayers.on("change",hb=>{-1!==hb.added.indexOf(Ha.layer)&&(eb.remove(),this.whenLayerView(Ha.layer).then($a,cb))})}):this.whenLayerView(Ha.layer)};bb.externalToInternalIntersectOptions=function(Ha){const Na=this._externalToInternalRenderItems(Ha.include,0);Ha=this._externalToInternalRenderItems(Ha.exclude,1);return{include:Na.layerUids,exclude:Ha.layerUids,graphics:{include:Na.graphicUids,exclude:Ha.graphicUids}}};
bb._intersectResultToMapPoint=function(Ha,Na){if(Ha.getIntersectionPoint(Ta)){Na=this.computeMapPointFromVec3d(Ta,Na);const $a=this.basemapTerrain;"TerrainRenderer"===Ha.intersector&&$a&&(Na.z=ka.getElevationAtPoint($a,Na)||0);return Na}return null};bb._intersectResultsToHits=function(Ha,Na){const $a=[];let cb=null;for(let kb=0;kb<Ha.length;kb++){const lb=Ha[kb];var eb=lb.toOwner(this);if(l.isSome(eb)&&(eb===this.map.ground||"type"in eb&&"integrated-mesh"===eb.type))break;eb=lb.toGraphic(this);if(l.isSome(eb)){l.isNone(cb)&&
kb!==Ha.length-1&&(cb=new Set);if(l.isSome(cb)){var hb=this._getGraphicFilterUid(eb);if(cb.has(hb))continue;cb.add(hb)}this._testGraphicUidFilter(Na,eb)&&(hb=this._intersectResultToMapPoint(lb),$a.push({graphic:eb,mapPoint:hb,distance:lb.distanceInRenderSpace}))}}return $a};bb._getGraphicFilterUid=function(Ha){if(Ha.layer&&"objectIdField"in Ha.layer){const Na=Ha.attributes[Ha.layer.objectIdField];if(Na)return`o-${Ha.layer.id}-${Na}`}return`u-${Ha.uid}`};bb._testGraphicUidFilter=function(Ha,Na){Na=
this._getGraphicFilterUid(Na);return l.isNone(Ha)||(l.isNone(Ha.include)||Ha.include.has(Na))&&(l.isNone(Ha.exclude)||!Ha.exclude.has(Na))};bb._externalToInternalRenderItems=function(Ha,Na,$a={layerUids:null,graphicUids:null}){if(!Ha)return $a;Ha instanceof E?(Ca($a,this._getGraphicFilterUid(Ha)),0===Na&&(l.isSome(this.graphicsView)&&Ha.layer===this?ra($a,this.graphicsView.mockLayerId):Ha.layer&&ra($a,Ha.layer.uid))):"forEach"in Ha?Ha.forEach(cb=>{Array.isArray(cb)?this._externalToInternalRenderItems(cb,
Na,$a):t.isCollection(cb)?cb===this.graphics&&l.isSome(this.graphicsView)?ra($a,this.graphicsView.mockLayerId):this._externalToInternalRenderItems(cb,Na,$a):cb instanceof I?cb===this.map.ground&&ra($a,oa.TERRAIN_ID):this._externalToInternalRenderItems(cb,Na,$a)}):ra($a,Ha.uid);return $a};bb._viewingModeToManifold=function(Ha){switch(Ha){case 1:return"spherical";case 2:return"planar"}};bb._initBasemapTerrain=function(Ha){this._set("basemapTerrain",new ta({view:this,manifold:this._viewingModeToManifold(Ha)}));
this._set("elevationProvider",new Ua.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)};bb._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};bb._initGlobe=function(Ha){this._initCoordinateSystem(Ha);this.state.init(Ha,this.spatialReference);this._initBasemapTerrain(Ha);
this._set("pointsOfInterest",new ma["default"]({view:this}));this._set("featureTiles",new Qa["default"]({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler}));Ha=()=>{var Na=this.basemapTerrain&&this.basemapTerrain.extent;this.clippingArea||Na?Na&&this.basemapTerrain.spatialReference?(Na=M.toExtent(this.basemapTerrain.extent,
this.basemapTerrain.spatialReference),this.featureTiles.filterExtent=this.clippingArea?Na.intersection(this.clippingArea):Na):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(Fa,"FEATURE_TILE_TREE_SHOW_TILES",Na=>{Na&&this.featureTiles&&!this.featureTreeDebugger?this.updatingHandles.addPromise(new Promise(function($a,cb){b(["./3d/layers/support/FeatureTileTree3DDebugger"],$a,cb)})).then(({FeatureTileTree3DDebugger:$a})=>
{!this.featureTreeDebugger&&Fa.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new $a({view:this}))}):Na||!this.featureTreeDebugger||Fa.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},3),this.updatingHandles.add(this,"clippingArea",Ha,3),this.updatingHandles.add(this,"basemapTerrain.extent",Ha,3)],"feature-tiles");this.stateManager.init()};bb._exitGlobe=function(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),
this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};bb._initCoordinateSystem=function(Ha){if(this.spatialReference){var Na=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Na)||this._set("mapCoordsHelper",new Wa.MapCoordsHelper(this.map,Na));const $a=1===Ha;Na=$a?J.getSphericalPCPF(Na):
Na;Na!==this.renderSpatialReference&&(this._set("renderCoordsHelper",mb.RenderCoordsHelper.createMode(Ha,Na)),$a||this.handles.add(this.watch("basemapTerrain.extent",cb=>{if(0!==cb[0]||0!==cb[1]||0!==cb[2]||0!==cb[3])this.renderCoordsHelper.extent=cb},!0),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(ua.Intersector.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};
bb._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};bb.updatingChanged=function(){this.notifyChange("updating")};bb._updateUpdatingMonitors=function(){this.handles.remove("updatingMonitors");this.allLayerViews.forEach(Ha=>{Ha.destroyed||(this.handles.add([Ha.watch(["updating","updatingProgress"],()=>this.updatingChanged(),!0)],"updatingMonitors"),Ha.when(()=>this.updatingChanged(),
()=>this.updatingChanged()))});this.updatingChanged()};bb._renderScreenshotOverlay=function(Ha,Na){if(this.overlay&&this.overlay.hasVisibleItems){var $a=Ha.getContext("2d");$a.putImageData(Na,0,0);this.overlay.renderCanvas(Ha);Ha=$a.getImageData(0,0,Na.width,Na.height);for($a=0;$a<Ha.data.length;$a++)Na.data[$a]=Ha.data[$a]}};bb._initStage=function(Ha){const Na={renderContext:this.renderContext,deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,
viewingMode:Ha,alpha:this.alphaCompositingEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(eb,hb)=>this._renderScreenshotOverlay(eb,hb)}},$a=new Ra.SceneIntersectionHelper(Ha,{forEachLayer:eb=>{this._stage.getLayers().forEach(eb)}},this);this._set("sceneIntersectionHelper",$a);const cb=N.byId(this.surface);this._stage=new Da.Stage({scheduler:this.resourceController.scheduler,viewingMode:Ha,container:cb,options:Na,sceneIntersectionHelper:$a});this._lostWebGLContextHandle=u.on(this._stage.renderView.getCanvas(),
"webglcontextlost",()=>this.fatalError=new n("webgl-context-lost"));this.handles.add([this.updatingHandles.add(this.qualitySettings,"antialiasingEnabled",()=>{this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled})},2),this.updatingHandles.add(this.qualitySettings,"orderIndependentTransparencyEnabled",()=>{this._stage.renderView.setRenderParameters({orderIndependentTransparencyEnabled:this.qualitySettings.orderIndependentTransparencyEnabled})},2),
L.init(this,"magnifier",eb=>this._stage.renderView.magnifier=eb,!0)],"stage");Ha=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:Ya.toEngineOptions(this.highlightOptions)})};for(const eb of["highlightOptions","highlightOptions.color","highlightOptions.haloColor","highlightOptions.haloOpacity","highlightOptions.fillOpacity"])this.handles.add(this.updatingHandles.add(this,eb,Ha),"stage");Ha();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(ua.Intersector.DEFAULT_TOLERANCE/
this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.getCanvas())};bb._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");this._set("canvas",null)};bb._initSurface=function(Ha){this._exitSurface();this._initStage(Ha);this._initGlobe(Ha);this.sharedSymbolResources=new wa.SharedSymbolResources({view:this,viewingMode:Ha,resourceController:this._resourceController,
pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Ia.ObjectResourceCache})};bb._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};bb._createGraphicsViewIfNeeded=function(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=
v.createAbortController();var Ha=()=>{this._createGraphicsViewController=null;this.updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Ha,Ha);this.updatingChanged()}};bb._createGraphicsViewAsync=async function(Ha){const Na=(await new Promise(function($a,cb){b(["./3d/layers/GraphicsView3D"],function(eb){$a(Object.freeze({__proto__:null,"default":eb}))},cb)})).default;v.throwIfAborted(Ha);await L.whenTrueOnce(this.basemapTerrain,"ready",Ha);this._set("graphicsView",
new Na({view:this}))};bb._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.handles.remove("graphics-view");l.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.mockLayerId),this.graphicsView.destroy(),this._set("graphicsView",null))};bb._startup=function(){var Ha=Z.viewingModeFromString(this.viewingMode);1===Ha&&(this._clippingArea=null);this._set("ready",!0);this._initSurface(Ha);
this.handles.add(L.on(this,"graphics","after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(Ha=this.get("map.initialViewProperties.environment"))&&(this.environment=Ha);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();Ha=this._resolveWhenReady;this._resolveWhenReady=[];Ha.forEach(Na=>Na(this))};bb._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();
this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};bb._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(oa.TERRAIN_ID);for(const Ha of this.map.allLayers.items)"integrated-mesh"===Ha.type&&this._defaultToMapOptions.include.add(Ha.uid)}};bb._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();
if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(oa.TERRAIN_ID);for(const Ha of this.map.allLayers.items)"integrated-mesh"===Ha.type&&1>Ha.opacity&&this._defaultToMapOptions.exclude.add(Ha.uid)}};k._createClass(gb,[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},{key:"basemapSpatialReference",get:function(){return this.basemapTerrain&&this.basemapTerrain.spatialReference}},{key:"clippingArea",
get:function(){if("global"===this.viewingMode)return null;let Ha=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||!Ha)return this._clippingArea=null;if(!(Ha instanceof z))return Ma.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference){if(!x.canProject(Ha.spatialReference,this.spatialReference))return Ma.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),
this._clippingArea;Ha=x.project(Ha,this.spatialReference)}return this._clippingArea&&Ha&&this._clippingArea.equals(Ha)?this._clippingArea:this._clippingArea=Ha},set:function(Ha){this.ready&&"global"===this.viewingMode&&Ha?Ma.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=Ha,this.notifyChange("clippingArea"))}},{key:"dataExtent",get:function(){const Ha=[],Na=this.spatialReference||B.WGS84;let $a=this.clippingArea;$a&&($a=x.project($a,Na));
const cb=hb=>{if(hb&&(hb=x.project(hb,Na))){if($a&&(hb=hb.intersection($a),!hb))return;Ha.push(hb)}};var eb=this.basemapTerrain;eb&&eb.spatialReference&&cb(new z({xmin:eb.extent[0],ymin:eb.extent[1],zmin:0,xmax:eb.extent[2],ymax:eb.extent[3],zmax:0,spatialReference:eb.spatialReference}));this.map&&this.map.allLayers.forEach(hb=>cb(hb.fullExtent));if(0===Ha.length)return new z({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:Na});eb=Ha.reduce((hb,kb)=>hb.union(kb));eb.hasZ?(eb.zmin=Math.min(0,
eb.zmin),eb.zmax=Math.max(0,eb.zmax)):(eb.zmin=0,eb.zmax=0);return eb}},{key:"environment",set:function(Ha){Ha!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",Ha)}},{key:"pixelRatio",get:function(){return Math.min(this.windowDevicePixelRatio,this.maximumPixelRatio)},set:function(Ha){l.isSome(Ha)?this._override("pixelRatio",Ha):this._clearOverride("pixelRatio")}},{key:"maximumPixelRatio",get:function(){let Ha=Infinity;const {maximumPixelRatio:Na,maximumRenderResolution:$a}=
this.qualitySettings;null!=Na&&(Ha=Math.min(Ha,Na));null!=$a&&(Ha=Math.min(Ha,$a/Math.max(this.width,this.height)));return Ha},set:function(Ha){l.isSome(Ha)?this._override("maximumPixelRatio",Ha):this._clearOverride("maximumPixelRatio")}},{key:"groundExtent",get:function(){const Ha=this._get("basemapTerrain");if(Ha&&Ha.spatialReference){const Na=Ha.extent;return new z({xmin:Na[0],ymin:Na[1],xmax:Na[2],ymax:Na[3],spatialReference:Ha.spatialReference})}return new z({spatialReference:this.spatialReference||
B.WGS84})}},{key:"initialExtentRequired",get:function(){return this.stateManager&&!this.stateManager.hasInitialView}},{key:"interacting",get:function(){return this.navigating||l.isSome(this.activeTool)}},{key:"stationary",get:function(){return!this.animation&&!this.resizing&&(l.isNone(this.state)||this.state.stationary)}},{key:"qualityProfile",set:function(Ha){ha.isValidProfile(Ha)&&(ha.apply(Ha,this.qualitySettings),this._set("qualityProfile",Ha))},get:function(){return this._get("qualityProfile")||
ha.getDefaultProfile()}},{key:"slicePlane",set:function(Ha){this._stage.renderView.setRenderParameters({slicePlane:Ha});if(l.isNone(Ha))this._set("slicePlane",null);else{var Na=this.propertiesPool.get("slicePlane");qa.boundedPlane.copy(Ha,Na);this._set("slicePlane",Na)}}},{key:"resolution",get:function(){return null!=this.spatialReference?U.getResolutionForScale(this.scale,this.spatialReference):0}},{key:"heightModelInfo",get:function(){const Ha=this.getDefaultHeightModelInfo();return null!=Ha?S.deriveUnitFromSR(Ha,
this.spatialReference):null}},{key:"updating",get:function(){var Ha,Na,$a;let cb=0,eb=0,hb=!1;this.allLayerViews.forEach(lb=>{lb.isFulfilled()?lb.updating&&(hb=!0,lb.suspended||(++eb,cb="updatingProgress"in lb?cb+lb.updatingProgress:cb+.5)):++eb});for(const lb of[this.graphicsView,this.basemapView,this.basemapTerrain,this.layerViewManager,this._resourceController,null==(kb=this._stage)?void 0:kb.renderView,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.updatingHandles,
this.featureTreeDebugger]){var kb;l.isSome(lb)&&lb.updating&&(eb+=.1,cb+=.05)}for(const lb of[this.deconflictor,this.labeler])l.isSome(lb)&&lb.updating&&(++eb,cb+=lb.updatingProgress);(hb=!!(hb||0<eb||!this.ready||!this.stationary||this._createGraphicsViewController||null!=(Ha=this.inputManager)&&Ha.hasPendingInputs||null!=(Na=this.map)&&null!=($a=Na.allLayers)&&$a.some(lb=>!lb.isFulfilled())))?(this._numUpdating=Math.max(eb,this._numUpdating),cb+=this._numUpdating-eb):this._numUpdating=0;cb=0<this._numUpdating?
cb/this._numUpdating:hb?.5:1;this._get("updatingProgress")!==cb&&(Ha=this._resourceController.scheduler.now,1>cb&&(Na=Math.min((Ha-this._lastUpdateTime)/2E3,1),cb=this.updatingProgress*(1-Na)+cb*Na),this._set("updatingProgress",cb),this._lastUpdateTime=hb&&1>cb?Ha:0);return hb}},{key:"viewingMode",get:function(){var Ha=this.get("map.initialViewProperties.viewingMode");if(Ha)return Ha;Ha=this.spatialReference;return!Ha||O.isSpatialReferenceSupported(Ha,"global")?"global":"local"},set:function(Ha){this.ready?
Ma.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(Ha)?this._override("viewingMode",Ha):void 0===Ha&&this._clearOverride("viewingMode")}},{key:"resourceController",get:function(){return this._resourceController}},{key:"performanceInfo",get:function(){return new xa(this)}}]);return gb}(aa.BreakpointsOwner(W.DOMContainer(fa.PopupView(ca))));a.__decorate([e.property()],h.prototype,"_resourceController",void 0);a.__decorate([e.property()],h.prototype,
"_stage",void 0);a.__decorate([e.property({readOnly:!0})],h.prototype,"deconflictor",void 0);a.__decorate([e.property({readOnly:!0})],h.prototype,"labeler",void 0);a.__decorate([e.property({type:ea,readOnly:!0,aliasOf:"state.animation"})],h.prototype,"animation",void 0);a.__decorate([e.property({readOnly:!0})],h.prototype,"basemapTerrain",void 0);a.__decorate([e.property({readOnly:!0})],h.prototype,"elevationProvider",void 0);a.__decorate([e.property({type:H,aliasOf:"stateManager.camera"})],h.prototype,
"camera",void 0);a.__decorate([e.property({readOnly:!0})],h.prototype,"canvas",void 0);a.__decorate([e.property({type:C,aliasOf:"stateManager.center"})],h.prototype,"center",void 0);a.__decorate([e.property({type:z,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"],autoTracked:!1})],h.prototype,"clippingArea",null);a.__decorate([e.property({type:ia["default"]})],h.prototype,"constraints",void 0);a.__decorate([e.property({type:z,dependsOn:["basemapTerrain.extent","clippingArea","map"],
autoTracked:!1,readOnly:!0})],h.prototype,"dataExtent",null);a.__decorate([e.property({value:null,type:ja})],h.prototype,"environment",null);a.__decorate([f.cast("environment")],h.prototype,"castEnvironment",null);a.__decorate([e.property({readOnly:!0})],h.prototype,"environmentManager",void 0);a.__decorate([e.property({type:z,aliasOf:"stateManager.extent"})],h.prototype,"extent",void 0);a.__decorate([e.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],h.prototype,"screenCenter",void 0);
a.__decorate([e.property({type:Number,dependsOn:["maximumPixelRatio"]})],h.prototype,"pixelRatio",null);a.__decorate([e.property({type:Number,dependsOn:["qualitySettings.maximumPixelRatio","qualitySettings.maximumRenderResolution","size"],autoTracked:!1})],h.prototype,"maximumPixelRatio",null);a.__decorate([e.property({aliasOf:"stateManager.frustum"})],h.prototype,"frustum",void 0);a.__decorate([e.property({type:Number,readOnly:!0})],h.prototype,"fullOpacity",void 0);a.__decorate([e.property({readOnly:!0})],
h.prototype,"graphicsView",void 0);a.__decorate([e.property({type:z,dependsOn:["basemapTerrain.extent"],autoTracked:!1,readOnly:!0})],h.prototype,"groundExtent",null);a.__decorate([e.property()],h.prototype,"groundView",void 0);a.__decorate([e.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],h.prototype,"initialExtentRequired",null);a.__decorate([e.property({type:Boolean,dependsOn:["navigating","activeTool"],readOnly:!0})],h.prototype,"interacting",null);a.__decorate([e.property({dependsOn:["animation",
"resizing","state.stationary"]})],h.prototype,"stationary",null);a.__decorate([e.property({aliasOf:"state.navigating"})],h.prototype,"navigating",void 0);a.__decorate([e.property()],h.prototype,"map",void 0);a.__decorate([e.property({readOnly:!0})],h.prototype,"mapCoordsHelper",void 0);a.__decorate([e.property({aliasOf:"stateManager.padding"})],h.prototype,"padding",void 0);a.__decorate([e.property({type:ma["default"],readOnly:!0})],h.prototype,"pointsOfInterest",void 0);a.__decorate([e.property({type:Qa["default"],
readOnly:!0})],h.prototype,"featureTiles",void 0);a.__decorate([e.property()],h.prototype,"featureTreeDebugger",void 0);a.__decorate([e.property({type:Boolean})],h.prototype,"screenSizePerspectiveEnabled",void 0);a.__decorate([e.property({constructOnly:!0})],h.prototype,"deactivatedWebGLExtensions",void 0);a.__decorate([e.property({constructOnly:!0})],h.prototype,"debugWebGLExtensions",void 0);a.__decorate([e.property({constructOnly:!0})],h.prototype,"renderCanvas",void 0);a.__decorate([e.property({constructOnly:!0})],
h.prototype,"state",void 0);a.__decorate([e.property({readOnly:!0})],h.prototype,"inputManager",void 0);a.__decorate([e.property({readOnly:!0})],h.prototype,"stateManager",void 0);a.__decorate([e.property({type:["low","medium","high"]})],h.prototype,"qualityProfile",null);a.__decorate([e.property({type:db,get(){let ab=this._get("qualitySettings");ab||(ab=new db,ha.apply(this.qualityProfile,ab));return ab}})],h.prototype,"qualitySettings",void 0);a.__decorate([e.property()],h.prototype,"slicePlane",
null);a.__decorate([e.property({dependsOn:["viewingMode"],autoTracked:!1})],h.prototype,"preconditionsReady",void 0);a.__decorate([e.property({readOnly:!0})],h.prototype,"renderCoordsHelper",void 0);a.__decorate([e.property({readOnly:!0})],h.prototype,"sceneIntersectionHelper",void 0);a.__decorate([e.property({type:Number,dependsOn:["scale","spatialReference"],autoTracked:!1,readOnly:!0})],h.prototype,"resolution",null);a.__decorate([e.property({type:Number,aliasOf:"stateManager.scale"})],h.prototype,
"scale",void 0);a.__decorate([e.property({dependsOn:[],autoTracked:!1})],h.prototype,"heightModelInfo",null);a.__decorate([e.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"],autoTracked:!1})],h.prototype,"spatialReference",void 0);a.__decorate([e.property({type:Boolean,constructOnly:!0})],h.prototype,"alphaCompositingEnabled",void 0);a.__decorate([e.property({type:Boolean})],h.prototype,"supersampleScreenhotsEnabled",void 0);a.__decorate([e.property({readOnly:!0})],
h.prototype,"type",void 0);a.__decorate([e.property({type:Ja})],h.prototype,"ui",void 0);a.__decorate([e.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating _resourceController.updating _stage.renderView.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs".split(" "),
autoTracked:!1})],h.prototype,"updating",null);a.__decorate([e.property({type:Number,readOnly:!0,dependsOn:["updating"],autoTracked:!1})],h.prototype,"updatingProgress",void 0);a.__decorate([e.property({type:["global","local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"],autoTracked:!1})],h.prototype,"viewingMode",null);a.__decorate([e.property({type:K,aliasOf:"stateManager.viewpoint"})],h.prototype,"viewpoint",void 0);a.__decorate([e.property({type:Number,aliasOf:"stateManager.zoom"})],
h.prototype,"zoom",void 0);a.__decorate([e.property({type:Ya})],h.prototype,"highlightOptions",void 0);h=a.__decorate([p.subclass("esri.views.SceneView")],h);const Ta=G.create(),Xa=D.createScreenPointArray();return h});
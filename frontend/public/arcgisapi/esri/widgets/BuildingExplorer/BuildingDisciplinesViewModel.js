// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/maybe ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../core/Accessor ../../core/Collection ../../core/collectionUtils ../../core/Handles ./support/buildingLayerUtils ./support/LayerTreeNode ./support/layerUtils".split(" "),
function(p,h,d,q,C,D,m,E,v,F,G,H,w,x,r,y,z,A,n,B){d=function(t){function k(a){a=t.call(this,a)||this;a.root=new n.LayerTreeNode;a.state="disabled";a._handles=new z;a._loadLayers=B.createLoadLayersFunction();a.layers=new r;return a}p._inheritsLoose(k,t);var e=k.prototype;e.initialize=function(){this._handles.add(this.layers.on("change",()=>this._onLayersChange()));this._onLayersChange()};e.destroy=function(){this._set("state","disabled");this._handles.destroy();this.root.destroy()};e._updateLayerTree=
function(){this.root.destroy();this._set("root",new n.LayerTreeNode({collapsed:!1}));const a=new Map,c=1<this.layers.length?"modelName":"id";this.layers.forEach(b=>{b=A.findFullModelSublayer(b);q.isSome(b)&&this._addNodesForSublayers(b,this.root,a,c)});return this};e._addNodeForLayer=function(a,c,b,l){const g=String(a.get(l)).toLowerCase();if(q.isSome(g)&&!a.isEmpty){var u=`${c.id}/${g}`,f=b.get(u);f||(f=new n.LayerTreeNode({id:g,level:c.level+1}),b.set(u,f));f.layers.push(a);c.children.push(f);this._addNodesForSublayers(a,
f,b,l)}};e._addNodesForSublayers=function(a,c,b,l){"building-group"!==a.type||a.isEmpty||a.sublayers.forEach(g=>this._addNodeForLayer(g,c,b,l))};e._onLayersChange=async function(){this._set("state","loading");if(0!==this.layers.length)try{await this._loadLayers(this.layers),this._updateLayerTree(),this._set("state","ready")}catch(a){w.isAbortError(a)||this._set("state","failed")}};p._createClass(k,[{key:"layers",set:function(a){const c=this._get("layers");this._set("layers",y.referenceSetter(a,c))}}]);
return k}(x);h.__decorate([m.property({readOnly:!0})],d.prototype,"root",void 0);h.__decorate([m.property({type:r,nonNullable:!0})],d.prototype,"layers",null);h.__decorate([m.property({readOnly:!0,nonNullable:!0})],d.prototype,"state",void 0);return d=h.__decorate([v.subclass("esri.widgets.BuildingExplorer.BuildingDisciplineViewModel")],d)});
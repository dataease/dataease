// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/ObjectPool ../../core/Evented ../../core/watchUtils ../../core/HandleOwner ./TemplateItem ./TemplateItemGroup".split(" "),function(t,m,h,D,E,n,F,w,G,H,I,u,x,y,z,
v,A){const B=({layer:l})=>({key:l,label:l.title}),C=({layer:l})=>l.geometryType;h=function(l){function p(a){a=l.call(this,a)||this;a._templateToLayer=new Map;a._itemPool=new u(v);a._groupPool=new u(A);a.filterFunction=null;a.groupBy="layer";return a}t._inheritsLoose(p,l);var g=p.prototype;g.destroy=function(){this._templateToLayer.clear();this._templateToLayer=null};g.refresh=function(){this.notifyChange("items")};g.select=function(a){a=a.clone();this.emit("select",{item:a,template:a.template})};
g._getTemplatesForLayer=function(a){const c=a.templates||[];a=(a.types||[]).map(f=>f.templates).reduce((f,q)=>[...f,...q],[]);return[...c,...a]};g._createItem=function(a){const c=this._itemPool.acquire();c.set({template:a,layer:this._templateToLayer.get(a)});return c};g._createGroup=function(a,c){const f=this._groupPool.acquire();f.set("label",a);f.items=c;return f};g._destroyItems=function(a){a&&(a[0]instanceof v?a.forEach(c=>this._destroyItem(c)):a.forEach(c=>this._destroyGroup(c)))};g._destroyGroup=
function(a){a.items.forEach(c=>this._destroyItem(c));a.items.length=0;this._groupPool.release(a)};g._destroyItem=function(a){a.layer=null;a.template=null;this._itemPool.release(a)};t._createClass(p,[{key:"layers",set:function(a){this.handles.removeAll();if(a){const c=()=>this.notifyChange("state");this.handles.add(a.map(f=>y.when(f,"loadStatus",c)))}this._set("layers",a)},get:function(){return this._get("layers")}},{key:"state",get:function(){const {layers:a}=this;return a&&0!==a.length?a.some(c=>
"loading"===c.loadStatus||"not-loaded"===c.loadStatus)?"loading":"ready":"disabled"}},{key:"items",get:function(){var {layers:a}=this;this._destroyItems(this._get("items"));if(!a||0===a.length)return[];this._templateToLayer.clear();a=a.filter(({capabilities:b,loaded:d})=>d&&b.operations.supportsEditing&&b.operations.supportsAdd).map(b=>{const d=this._getTemplatesForLayer(b);if(0<d.length)return d.forEach(k=>this._templateToLayer.set(k,b)),d}).filter(b=>null!=b);const {groupBy:c}=this;if("none"===
c)return a.map(b=>b.filter(({name:d})=>!this.filterFunction||this.filterFunction({label:d}))).map(b=>b.map(d=>this._createItem(d))).reduce((b,d)=>[...b,...d],[]);a=a.reduce((b,d)=>{d.forEach(k=>{var e=("layer"===c?B:"geometry"===c?C:c)({template:k,layer:this._templateToLayer.get(k)});if(e){const r="string"===typeof e?e:e.key;e="string"===typeof e?e:e.label;b.has(r)||b.set(r,{label:e,templates:[]});b.get(r).templates.push(k)}});return b},new Map);if(0===a.size)return[];const f=[],{filterFunction:q}=
this;a.forEach(b=>{const {label:d,templates:k}=b;!q||this.filterFunction(b)?f.push(this._createGroup(d,k.map(e=>this._createItem(e)))):(b=k.filter(({name:e})=>this.filterFunction({label:e})).map(e=>this._createItem(e)),0<b.length&&f.push(this._createGroup(d,b)))});return f}}]);return p}(z.HandleOwnerMixin(x.EventedAccessor));m.__decorate([n.property()],h.prototype,"filterFunction",void 0);m.__decorate([n.property()],h.prototype,"groupBy",void 0);m.__decorate([n.property()],h.prototype,"layers",null);
m.__decorate([n.property({dependsOn:["layers"]})],h.prototype,"state",null);m.__decorate([n.property({dependsOn:["filterFunction","groupBy","layers","state"],readOnly:!0})],h.prototype,"items",null);return h=m.__decorate([w.subclass("esri.widgets.FeatureTemplates.FeatureTemplatesViewModel")],h)});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/Accessor ../../geometry/support/WKIDUnitConversion ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ../../geometry/Point ../../geometry/Polyline ../../geometry ../../core/screenUtils ../../geometry/support/normalizeUtils ../../geometry/support/geodesicUtils".split(" "),
function(t,n,l,F,G,q,H,x,I,J,K,y,p,z,A,u,B,L,r,C,D){function v(m,h){const {x:g,y:a}="decimal-degrees"===m?A.webMercatorToGeographic(h,!0):h;return[g,a]}function w({state:{paddedViewState:m},spatialReference:h,width:g}){return h.isWrappable&&m.worldScreenWidth<g}l=function(m){function h(a){a=m.call(this,a)||this;a.scaleComputedFrom=r.createScreenPoint();a.view=null;return a}t._inheritsLoose(h,m);var g=h.prototype;g.getScaleBarProperties=function(a,b){if("disabled"===this.state||isNaN(a)||!b)return null;
const d=this._getDistanceInKm(this.view,this.scaleComputedFrom);return"metric"===b?this._getScaleBarProps(a,d,"metric"):this._getScaleBarProps(a,d/1.609,"non-metric")};g._getLocationUnit=function(){const a=this.get("view.spatialReference"),{isWebMercator:b,wkid:d,wkt:c}=a;return b||c&&-1<c.indexOf("WGS_1984_Web_Mercator")?"decimal-degrees":null!=p[d]||c&&-1<c.indexOf("PROJCS")?"linear-unit":"unknown"};g._getDistanceInKm=function(a,b){const {state:d,spatialReference:c}=a;var e=this._getLocationUnit();
if("linear-unit"===e){a=d.extent.width;({wkid:b}=c);if(null!=p[b])b=p.values[p[b]];else{({wkt:b}=c);e=b.lastIndexOf(",")+1;var k=b.lastIndexOf("]]");b=parseFloat(b.substring(e,k))}return a*b/1E3}const [f,E]=this._getScaleMeasuringPoints(a,b);a=new B({paths:[[v(e,f),v(e,E)]],spatialReference:4326});a=C.straightLineDensify(a,10);[a]=D.geodesicLengths([a],"kilometers");return a};g._getScaleMeasuringPoints=function(a,b){const {width:d,height:c,position:e,spatialReference:k}=a;if(w(a))return{valid:b}=
z.getInfo(k),a=new u(b[0],0,k),b=new u(b[1],0,k),[a,b];var f=b.y-e[1];f>c?f=c:0>f&&(f=0);b=r.createScreenPoint(0,f);f=r.createScreenPoint(d,f);b=a.toMap(b);a=a.toMap(f);return[b,a]};g._getScaleBarProps=function(a,b,d){var {view:c}=this;c=w(c)?c.state.paddedViewState.worldScreenWidth:c.width;b=a*b/c;d="metric"===d?"km":"mi";.1>b&&("mi"===d?(b*=5280,d="ft"):"km"===d&&(b*=1E3,d="m"));for(c=0;1<=b;)b/=10,c++;var e=this._getConstraints(b);if(!e)return null;const {min:k,max:f}=e;e=f/b>=b/k?k:f;return{length:e/
b*a,value:Math.pow(10,c)*e,unit:d}};g._getConstraints=function(a){if(.5<a)return{min:.5,max:1};if(.3<a)return{min:.3,max:.5};if(.2<a)return{min:.2,max:.3};if(.15<a)return{min:.15,max:.2};if(.1<=a)return{min:.15,max:.1}};t._createClass(h,[{key:"state",get:function(){return this.get("view.ready")&&"2d"===this.get("view.type")?"ready":"disabled"}}]);return h}(y);n.__decorate([q.property()],l.prototype,"scaleComputedFrom",void 0);n.__decorate([q.property({readOnly:!0,dependsOn:["scaleComputedFrom","view.ready",
"view.scale"]})],l.prototype,"state",null);n.__decorate([q.property()],l.prototype,"view",void 0);return l=n.__decorate([x.subclass("esri.widgets.Scalebar.ScaleBarViewModel")],l)});
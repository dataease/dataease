// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/jsonMap ../../core/accessorSupport/decorators/subclass ../../core/Error ../../core/urlUtils ../../core/uuid ../../portal/support/resourceExtension ../../core/promiseUtils ../../intl/locale ../../PopupTemplate ../../intl/messages ../../intl ../../core/Handles ../../core/watchUtils ../Popup/actions ../support/geolocationUtils ../support/GeolocationPositioning".split(" "),
function(l,e,d,A,B,g,C,p,m,D,E,F,q,r,t,u,G,v,w,n,x,y){async function z(){const b=await u.fetchMessageBundle("esri/widgets/Locate/t9n/Locate");return new t({title:b.currentLocation,fieldInfos:[{fieldName:"timestamp",label:b.timestamp,format:{dateFormat:"short-date-short-time"}},{fieldName:"latitude",label:b.latitude,format:{places:4,digitSeparator:!0}},{fieldName:"longitude",label:b.longitude,format:{places:4,digitSeparator:!0}},{fieldName:"accuracy",label:b.accuracy,format:{places:0,digitSeparator:!0}},
{fieldName:"altitude",label:b.altitude,format:{places:0,digitSeparator:!0}},{fieldName:"altitudeAccuracy",label:b.altitudeAccuracy,format:{places:0,digitSeparator:!0}},{fieldName:"heading",label:b.heading,format:{places:0,digitSeparator:!0}},{fieldName:"speed",label:b.speed,format:{places:0,digitSeparator:!0}}],actions:[n.removeSelectedFeature.clone()],content:[{type:"fields"}]})}d=function(b){function h(a){a=b.call(this,a)||this;a._locateController=null;a._handles=new v;a.locate=a.locate.bind(l._assertThisInitialized(a));
return a}l._inheritsLoose(h,b);var f=h.prototype;f.initialize=function(){this._handles.add([w.on(this,"view.popup","trigger-action",a=>n.triggerAction({event:a,view:this.view})),r.onLocaleChange(()=>{var a;const {graphic:c,view:k}=this;(null==k?0:null==(a=k.graphics)?0:a.includes(c))&&this._updatePopupTemplate(c)})])};f.destroy=function(){this.cancelLocate();this._handles.destroy();this._handles=null};f.locate=async function(){this.cancelLocate();if("disabled"===this.state)throw new m("locate:disabled-state",
"Cannot locate when disabled.");if("feature-unsupported"===this.state)throw new m("locate:feature-unsupported-state","Cannot locate in unsecure domain.");const a=q.createAbortController();this._locateController=a;try{let c=await x.getCurrentPosition(this.geolocationOptions);c=await this._setPosition(c,{signal:a.signal});if(this._locateController!==a)return null;this.graphic&&(this.graphic=this.graphic.clone(),await this._updatePopupTemplate(this.graphic),this.view.graphics.push(this.graphic));this.emit("locate",
{position:c});this._locateController=null;return c}catch(c){throw this._locateController=null,this.emit("locate-error",{error:c}),c;}};f.cancelLocate=function(){this._clear();this._locateController&&this._locateController.abort();this._locateController=null};f._updatePopupTemplate=async function(a){const c=await z(),k=a!==this.graphic;this.destroyed||k||(a.popupTemplate=c)};l._createClass(h,[{key:"state",get:function(){return this._geolocationUsable?this.get("view.ready")?this._locateController?"locating":
"ready":"disabled":"feature-unsupported"}}]);return h}(y);e.__decorate([g.property()],d.prototype,"_locateController",void 0);e.__decorate([g.property({dependsOn:["view.ready","_locateController","_geolocationUsable"],readOnly:!0})],d.prototype,"state",null);e.__decorate([g.property()],d.prototype,"locate",null);e.__decorate([g.property()],d.prototype,"cancelLocate",null);return d=e.__decorate([p.subclass("esri.widgets.Locate.LocateViewModel")],d)});
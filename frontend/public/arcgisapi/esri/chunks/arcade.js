// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("require exports ../core/has ../core/promiseUtils ./languageUtils ../arcade/treeAnalysis ../arcade/arcadeCompiler ../arcade/arcadeRuntime ../arcade/parser ../intl/moment".split(" "),function(f,c,v,q,Z,r,g,l,m,aa){function L(a,b){return!0===b.useAsync||!0===a.isAsync?ba(a,b):v("csp-restrictions")?function(d){return l.executeScript(a,d)}:g.compileScript(a,b)}function ba(a,b){if(null===e)throw Error("Async Arcade must be enabled for this script");return v("csp-restrictions")||!1===ca?function(d){return e.executeScript(a,
d)}:g.compileScript(a,b,!0)}function M(a){l.extend(a);g.extend(a,"sync");null===e?w.push(a):(g.extend(a,"async"),e.extend(a))}function x(a,b=[]){return m.parseScript(a,b)}function N(a,b,d=""){return m.validateScript(a,b,d)}function O(a,b,d,h=""){return m.scriptCheck(a,b,d,h)}function P(a,b,d=[]){a=m.parseScript(a,d);return y(a,b)}function y(a,b){if(!0===b.useAsync||!0===a.isAsync){if(null===e)throw Error("Async Arcade must be enabled for this script");return e.executeScript(a,b)}return l.executeScript(a,
b)}function z(a,b){return l.referencesMember(a,b)}function Q(a,b){return l.referencesFunction(a,b)}function R(a,b){return m.extractFieldLiterals(a)}function t(a,b=[]){void 0===a.usesGeometry&&r.findScriptDependencies(a,b);return!0===a.usesGeometry}function A(){return B?B:B=q.all([new Promise(function(a,b){f(["../geometry/geometryEngine"],a,b)}),new Promise(function(a,b){f(["../arcade/functions/geomsync"],a,b)})]).then(([a,b])=>{C=!0;b.setGeometryEngine(a);return!0})}function u(){return null!==D?D:
D=g.enableAsyncSupport().then(()=>new Promise(function(a,b){f(["../arcade/arcadeAsyncRuntime"],a,b)})).then(a=>{e=a;for(const b of w)e.extend(b),g.extend(b,"async");w=null;return!0})}function S(){return E}function F(){return e?!0:!1}function T(){return C}function G(){return H?H:H=u().then(()=>q.all([new Promise(function(a,b){f(["../arcade/featureSetUtils"],a,b)}),new Promise(function(a,b){f(["../arcade/functions/featuresetbase"],a,b)}),new Promise(function(a,b){f(["../arcade/functions/featuresetgeom"],
a,b)}),new Promise(function(a,b){f(["../arcade/functions/featuresetstats"],a,b)}),new Promise(function(a,b){f(["../arcade/functions/featuresetstring"],a,b)})]).then(([a,b,d,h,n])=>{U=a;e.extend([b,d,h,n]);g.extend([b,d,h,n],"async");return E=!0}))}function I(a,b=[]){void 0===a.usesFeatureSet&&r.findScriptDependencies(a,b);return!0===a.usesFeatureSet}function V(a,b=[]){void 0===a.isAsync&&r.findScriptDependencies(a,b);return!0===a.isAsync}function da(a,b){if(b)for(const d of b)if(z(a,d))return!0;return!1}
function W(a,b,d=[],h=!1){return q.create((n,ea)=>{const p="string"===typeof a?x(a):a,k=[];k.push(J());p&&(!1===C&&(t(p)||h)&&k.push(A()),!1===F()&&(!0===p.isAsync||b)&&k.push(u()),!1===E&&(I(p)||da(p,d))&&k.push(G()));k?q.all(k).then(()=>{n(!0)},ea):n(!0)})}function X(a){if(t(a))return!0;a=r.findFunctionCalls(a);return-1<a.indexOf("geometry")||-1<a.indexOf("feature")?!0:!1}function Y(){return U}function J(){return null!==K?K:K=aa.loadMoment().then(a=>{Z.MomentLibrary.Moment=a;return!0})}const ca=
function(){if(v("csp-restrictions"))return!1;try{return(new Function("function* test() {}; return true"))()}catch(a){return!1}}();let E=!1,C=!1,e=null,w=[],B=null,D=null,H=null,U=null,K=null;var fa=Object.freeze({__proto__:null,compileScript:L,extend:M,parseScript:x,validateScript:N,scriptCheck:O,parseAndExecuteScript:P,executeScript:y,referencesMember:z,referencesFunction:Q,extractFieldLiterals:R,scriptUsesGeometryEngine:t,enableGeometrySupport:A,enableAsyncSupport:u,isFeatureSetSupportEnabled:S,
isAsyncEnabled:F,isGeometryEnabled:T,enableFeatureSetSupport:G,scriptUsesFeatureSet:I,scriptIsAsync:V,loadScriptDependencies:W,scriptTouchesGeometry:X,featureSetUtils:Y,load:J});c.arcade=fa;c.compileScript=L;c.enableAsyncSupport=u;c.enableFeatureSetSupport=G;c.enableGeometrySupport=A;c.executeScript=y;c.extend=M;c.extractFieldLiterals=R;c.featureSetUtils=Y;c.isAsyncEnabled=F;c.isFeatureSetSupportEnabled=S;c.isGeometryEnabled=T;c.load=J;c.loadScriptDependencies=W;c.parseAndExecuteScript=P;c.parseScript=
x;c.referencesFunction=Q;c.referencesMember=z;c.scriptCheck=O;c.scriptIsAsync=V;c.scriptTouchesGeometry=X;c.scriptUsesFeatureSet=I;c.scriptUsesGeometryEngine=t;c.validateScript=N});
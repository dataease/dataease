// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/Logger ../../geometry/support/webMercatorUtils ../../geometry/Point ../../geometry/support/contains ../../geometry ../../core/unitUtils ../../geometry/support/aaBoundingRect".split(" "),function(m,n,p,q,v,z,A,D,B,r){function w(d,e){const c=x(d,e.spatialReference);if(!c)return null;switch(d.type){case "point":d.z=e.elevationAt(c)||0;break;case "polyline":h.spatialReference=c.spatialReference;var a=d.hasM&&!d.hasZ;for(var f=
0;f<d.paths.length;f++){var b=d.paths[f],g=c.paths[f];for(let l=0;l<b.length;l++){const t=b[l];var k=g[l];h.x=k[0];h.y=k[1];k=e.elevationAt(h)||0;a&&(t[3]=t[2]);t[2]=k}}d.hasZ=!0;break;case "multipoint":h.spatialReference=c.spatialReference;a=d.hasM&&!d.hasZ;for(f=0;f<d.points.length;f++)b=d.points[f],g=c.points[f],h.x=g[0],h.y=g[1],g=e.elevationAt(h)||0,a&&(b[3]=b[2]),b[2]=g;d.hasZ=!0}return d}function x(d,e){const c=d.spatialReference;return c.equals(e)?d:v.canProject(c,e)?v.project(d,e):(u.error(`Cannot project geometry spatial reference (wkid:${c.wkid}) to elevation sampler spatial reference (wkid:${e.wkid})`),
null)}const u=q.getLogger("esri.layers.support.ElevationSampler");p=function(){function d(){}var e=d.prototype;e.queryElevation=function(c){return w(c.clone(),this)};e.on=function(){return C};e.projectIfRequired=function(c,a){return x(c,a)};return d}();let y=function(d){function e(a,f,b){var g=d.call(this)||this;g.tile=a;g.noDataValue=b;g.extent=r.toExtent(a.tile.extent,f.spatialReference);b=B.getMetersPerUnitForSR(f.spatialReference);a=f.lodAt(a.tile.level).resolution*b;g.demResolution={min:a,max:a};
return g}n._inheritsLoose(e,d);var c=e.prototype;c.contains=function(a){a=this.projectIfRequired(a,this.spatialReference);return A.extentContainsPoint(this.extent,a)};c.elevationAt=function(a){const f=this.projectIfRequired(a,this.spatialReference);if(!f)return null;if(!this.contains(a)){const b=this.extent;u.warn("#elevationAt()",`Point used to sample elevation (${a.x}, ${a.y}) is outside of the sampler extent (${`${b.xmin}, ${b.ymin}, ${b.xmax}, ${b.ymax}`})`)}return this.tile.sample(f.x,f.y)};
n._createClass(e,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return e}(p);q=function(d){function e(c,a,f){var b=d.call(this)||this;let g;"number"===typeof a?(b.noDataValue=a,g=null):(g=a,b.noDataValue=f);b.samplers=g?c.map(k=>new y(k,g,b.noDataValue)):c;if(c=b.samplers[0]){b.extent=c.extent.clone();const {min:k,max:l}=c.demResolution;b.demResolution={min:k,max:l};for(c=1;c<b.samplers.length;c++)a=b.samplers[c],b.extent.union(a.extent),b.demResolution.min=Math.min(b.demResolution.min,
a.demResolution.min),b.demResolution.max=Math.max(b.demResolution.max,a.demResolution.max)}else b.extent=r.toExtent(r.create(),g.spatialReference),b.demResolution={min:0,max:0};return b}n._inheritsLoose(e,d);e.prototype.elevationAt=function(c){const a=this.projectIfRequired(c,this.spatialReference);if(!a)return null;for(const f of this.samplers)if(f.contains(a))return f.elevationAt(a);u.warn("#elevationAt()",`Point used to sample elevation (${c.x}, ${c.y}) is outside of the sampler`);return null};
n._createClass(e,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return e}(p);const h=new z,C={remove(){}};m.ElevationSamplerBase=p;m.MultiTileElevationSampler=q;m.TileElevationSampler=y;m.updateGeometryElevation=w;Object.defineProperty(m,"__esModule",{value:!0})});
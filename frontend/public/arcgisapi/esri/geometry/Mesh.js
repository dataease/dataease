// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/has ../core/lang ../core/Logger ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/jsonMap ../core/accessorSupport/decorators/subclass ../core/Error ../core/urlUtils ../core/uuid ../portal/support/resourceExtension ../core/promiseUtils ./Geometry ./Point ./Extent ./Polygon ../chunks/vec3f64 ../chunks/vec4f64 ./support/MeshVertexAttributes ./support/MeshComponent ./support/triangulationUtils ./support/meshUtils/centerAt ./support/meshUtils/merge ./support/meshUtils/offset ./support/meshUtils/primitives ./support/meshUtils/rotate ./support/meshUtils/scale".split(" "),
function(E,F,p,h,M,N,X,r,Y,O,G,Z,aa,ba,H,P,w,B,Q,x,C,I,y,R,S,T,U,m,t,V){var k;const q=N.getLogger("esri.geometry.Mesh");h=k=function(J){function l(a){a=J.call(this,a)||this;a.components=null;a.hasZ=!0;a.hasM=!1;a.vertexAttributes=new I.MeshVertexAttributes;a.type="mesh";return a}F._inheritsLoose(l,J);var g=l.prototype;g.addComponent=function(a){this.components||(this.components=[]);this.components.push(y.from(a));this.clearCache()};g.removeComponent=function(a){if(this.components&&(a=this.components.indexOf(a),
-1!==a)){this.components=this.components.splice(a,1);return}q.error("removeComponent()","Provided component is not part of the list of components")};g.rotate=function(a,b,c,d){t.axisAngleFrom(D.x,a/180*Math.PI,u);t.axisAngleFrom(D.y,b/180*Math.PI,K);t.axisAngleFrom(D.z,c/180*Math.PI,L);t.axisAngleMultiply(u,K,u);t.axisAngleMultiply(u,L,u);t.rotate(this,u,d);return this};g.offset=function(a,b,c,d){z[0]=a;z[1]=b;z[2]=c;U.offset(this,z,d);return this};g.scale=function(a,b){V.scale(this,a,b);return this};
g.centerAt=function(a,b){S.centerAt(this,a,b);return this};g.clone=function(){const a=this.components?new Map:null,b=this.components?new Map:null,c=this.components?this.components.map(d=>d.cloneWithDeduplication(a,b)):null;return new k({components:c,spatialReference:this.spatialReference,vertexAttributes:M.clone(this.vertexAttributes)})};g.vertexAttributesChanged=function(){this.clearCache()};g.toJSON=function(a){return this.write(null,a)};g.forEachVertex=function(a,b,c){if(b)for(let d=0;d<b.length;d++){const e=
3*b[d];c(a[e+0],a[e+1],a[e+2])}else for(b=0;b<a.length;b+=3)c(a[b+0],a[b+1],a[b+2])};g.extendExtent=function(a,b,c){this.forEachVertex(b,c,(d,e,f)=>{a.xmin=Math.min(a.xmin,d);a.xmax=Math.max(a.xmax,d);a.ymin=Math.min(a.ymin,e);a.ymax=Math.max(a.ymax,e);a.zmin=Math.min(a.zmin,f);a.zmax=Math.max(a.zmax,f)});return a};g.toBinaryGLTF=async function(a){const {toBinaryGLTF:b}=await new Promise(function(c,d){E(["./support/meshUtils/exporters/gltf/gltfexport"],c,d)});return b(this,a)};l.createBox=function(a,
b){if(!(a instanceof w))return q.error(".createBox()","expected location to be a Point instance"),null;a=new k(m.convertUnitGeometry(m.createUnitSizeBox(),a,b));if(b&&b.imageFace&&"all"!==b.imageFace){{const n=a.components[0];var c=n.faces,d=m.boxFaceOrder[b.imageFace],e=6*d;b=new Uint32Array(6);const A=new Uint32Array(c.length-6);var f=0;let W=0;for(let v=0;v<c.length;v++)v>=e&&v<e+6?b[f++]=c[v]:A[W++]=c[v];c=new Float32Array(a.vertexAttributes.uv);d*=8;e=[0,1,1,1,1,0,0,0];for(f=0;f<e.length;f++)c[d+
f]=e[f];a.vertexAttributes.uv=c;a.components=[new y({faces:b,material:n.material}),new y({faces:A})]}}return a};l.createSphere=function(a,b){return a instanceof w?new k(m.convertUnitGeometry(m.createUnitSizeSphere(b&&b.densificationFactor||0),a,b)):(q.error(".createSphere()","expected location to be a Point instance"),null)};l.createCylinder=function(a,b){return a instanceof w?new k(m.convertUnitGeometry(m.createUnitSizeCylinder(b&&b.densificationFactor||0),a,b)):(q.error(".createCylinder()","expected location to be a Point instance"),
null)};l.createPlane=function(a,b){return a instanceof w?new k(m.convertUnitGeometry(m.createUnitSizePlane(b&&b.facing||"up"),a,b)):(q.error(".createPlane()","expected location to be a Point instance"),null)};l.createFromPolygon=function(a,b){if(!(a instanceof Q))return q.error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const c=R.triangulate(a);return new k({vertexAttributes:{position:c.position},components:[{faces:c.faces,shading:"flat",material:b&&b.material||null}],
spatialReference:a.spatialReference})};l.createFromGLTF=async function(a,b,c){if(!(a instanceof w))throw q.error(".createfromGLTF()","expected location to be a Point instance"),new G("invalid-input","Expected location to be a Point instance");return H.create((d,e)=>{(new Promise(function(f,n){E(["./support/loadGLTFMesh"],f,n)})).then(async f=>{try{H.throwIfAborted(c);const n=await f.loadGLTFMesh(a,b,c);d(new k(T.merge(n.map(A=>new k(A)),{reuseMaterials:!0})))}catch(n){e(new G("gltf-loader-error",
"Failed to load glTF.",`[${n.name}] ${n.message}`))}})})};F._createClass(l,[{key:"extent",get:function(){var a=this.spatialReference;const b=this.vertexAttributes&&this.vertexAttributes.position;if(!b||0===b.length||this.components&&0===this.components.length)return new B({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:a});a={xmin:Infinity,xmax:-Infinity,ymin:Infinity,ymax:-Infinity,zmin:Infinity,zmax:-Infinity,spatialReference:a};if(!this.components)return new B(this.extendExtent(a,b,
null));for(const c of this.components)if(c.faces)this.extendExtent(a,b,c.faces);else{this.extendExtent(a,b,null);break}return new B(a)}}]);return l}(P);p.__decorate([r.property({dependsOn:["vertexAttributes","vertexAttributes.position","components"],json:{read:!1}})],h.prototype,"cache",void 0);p.__decorate([r.property({type:[y]})],h.prototype,"components",void 0);p.__decorate([r.property({readOnly:!0,dependsOn:["cache"],autoTracked:!1,json:{read:!1}})],h.prototype,"extent",null);p.__decorate([r.property({readOnly:!0,
json:{read:!1,write:!1}})],h.prototype,"hasZ",void 0);p.__decorate([r.property({readOnly:!0,json:{read:!1,write:!1}})],h.prototype,"hasM",void 0);p.__decorate([r.property({type:I.MeshVertexAttributes,nonNullable:!0,json:{write:!0}})],h.prototype,"vertexAttributes",void 0);h=k=p.__decorate([O.subclass("esri.geometry.Mesh")],h);h.prototype.toJSON.isDefaultToJSON=!0;const D={x:x.fromValues(1,0,0),y:x.fromValues(0,1,0),z:x.fromValues(0,0,1)},z=x.create(),u=C.create(),K=C.create(),L=C.create();return h});
// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define(["exports","./spatialReferenceUtils","./boundsUtils","./jsonUtils","./aaBoundingRect"],function(G,M,r,H,w){function I(b){const d={rings:[]};for(;0<b.length;){const e=b[0];var a=!1;const [n,k]=e[0],[h,t]=e[e.length-1];if(n!==h||k!==t)for(let f=1;f<b.length;f++){const c=b[f],[l,m]=c[0],[g,p]=c[c.length-1];if(t===m&&h===l){for(a=1;a<c.length;a++)e.push([c[a][0],c[a][1]]);a=!0}else if(t===p&&h===g){for(a=c.length-2;0<=a;a--)e.push([c[a][0],c[a][1]]);a=!0}else if(k===p&&n===g){for(a=0;a<c.length-
1;a++)e.splice(a,0,[c[a][0],c[a][1]]);a=!0}else if(k===m&&n===l){for(a=1;a<c.length;a++)e.unshift([c[a][0],c[a][1]]);a=!0}if(a){b.splice(f,1);N(e[0],e[e.length-1])&&(b.shift(),0<r.getPointsBoundsWidth(e)&&d.rings.push(e));break}}a||(b.shift(),d.rings.push(e))}return d}function A([b],d){return b<d}function J([b,d],[a,e],n){return[n,d+(e-d)/(a-b)*(n-b)]}function K(b,d){b=(b+d)/(2*d);1===b%2&&b--;return Math.floor(b)}function N([b,d],[a,e]){return b===a&&d===e}const L=w.create();G.normalize=function(b){if(!b)return null;
if(!b.spatialReference)return b;var d=M.getInfo(b.spatialReference);if(!d)return b;d=d.valid[1];if(H.isPolygon(b)){{var a=b,e={rings:[],spatialReference:a.spatialReference};const [B,,x]=r.getBoundsXY(w.create(),a);var n=2*Math.ceil((B-d)/(2*d))*d+d;if(n>x)e=a;else{for(var k,h;n<x;){{var t=k=void 0,f=a;a=n;const [C,,D]=r.getBoundsXY(w.create(),f);if(D<=a)t=f;else if(C>=a)k=f;else{h=[];var c=[];b=[];for(var l of f.rings){const [E,,F]=r.getPointsBounds(w.create(),l);if(F<=a)h.push(l);else if(E>=a)c.push(l);
else{var m=l[l.length-1];f=A(m,a);var g=[];for(var p of l){var y=A(p,a);y===f?g.push(p):(m=J(m,p,a),g.push(m),f?h.push(g):c.push(g),b.push(m[1]),g=[],g.push([m[0],m[1]]),g.push(p),f=y);m=p}f?h.push(g):c.push(g)}}b.sort();for(f=0;f<b.length-1;f+=2)g=[],g.push([a,b[f]]),g.push([a,b[f+1]]),0<h.length&&h.push(g),0<c.length&&c.push(g);0<h.length&&(t=I(h));0<c.length&&(k=I(c))}k=[t,k]}[k,h]=k;if(k)for(var q of k.rings)e.rings.push(q);if(null==h)break;a=h;n+=2*d}if(h)for(var z of h.rings)e.rings.push(z)}for(var v of e.rings){n=
K(r.getPointsBoundsCenterX(v),d);for(var u of v)u[0]-=2*n*d}d=e}return d}if(H.isPolyline(b)){{q=b;v={paths:[],spatialReference:q.spatialReference};const [B,,x]=r.getBoundsXY(w.create(),q);u=2*Math.ceil((B-d)/(2*d))*d+d;if(u>x)v=q;else{for(;u<x;){{p=l=void 0;c=q;q=u;const [C,,D]=r.getBoundsXY(L,c);if(D<=q)p=c;else if(C>=q)l=c;else{p={paths:[]};l={paths:[]};z=p.paths;h=l.paths;for(k of c.paths){const [E,,F]=r.getPointsBounds(L,k);if(F<=q)z.push(k);else if(E>=q)h.push(k);else{m=k[0];c=A(m,q);b=[];b.push(m);
for(f=1;f<k.length;f++)g=k[f],y=A(g,q),y===c?b.push(g):(m=J(m,g,q),b.push(m),c?z.push(b):h.push(b),b=[m,g],c=y),m=g;c?z.push(b):h.push(b)}}}l=[p,l]}p=l;l=p[0];c=p[1];if(l)for(t of l.paths)v.paths.push(t);if(null==c)break;q=c;u+=2*d}if(c)for(a of c.paths)v.paths.push(a)}for(e of v.paths){u=K(r.getPointsBoundsCenterX(e),d);for(n of e)n[0]-=2*u*d}d=v}return d}return b};Object.defineProperty(G,"__esModule",{value:!0})});
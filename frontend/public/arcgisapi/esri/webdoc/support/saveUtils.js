// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.18/esri/copyright.txt for details.
//>>built
define("exports ../../core/Error ../../core/uuid ../../core/promiseUtils ../../core/asyncUtils ../../portal/support/resourceUtils".split(" "),function(h,q,r,k,l,t){async function m(b,c){c=await l.result(b.resource.portalItem.addResource(b.resource,b.content,c));if(!0===c.ok)b.finish&&b.finish(b.resource);else throw b.error&&b.error(c.error),c.error;}async function u(b,c){c=await l.result(b.resource.update(b.content,c));if(!0===c.ok)b.finish(b.resource);else throw b.error(c.error),c.error;}h.saveResources=
async function(b,c,d){if(c&&c.resources){var g=c.portalItem===b.portalItem?new Set(b.paths):new Set;b.paths.length=0;b.portalItem=c.portalItem;var f=new Set(c.resources.toKeep.map(a=>a.resource.path)),n=new Set,e=[];f.forEach(a=>{g.delete(a);b.paths.push(a)});for(const a of c.resources.toUpdate)if(g.delete(a.resource.path),f.has(a.resource.path)||n.has(a.resource.path)){const {resource:v,content:w,finish:x,error:y}=a,p=t.getSiblingOfSameTypeI(v,r.generateUUID());b.paths.push(p.path);e.push(m({resource:p,
content:w,finish:x,error:y},d))}else b.paths.push(a.resource.path),e.push(u(a,d)),n.add(a.resource.path);for(const a of c.resources.toAdd)e.push(m(a,d)),b.paths.push(a.resource.path);g.forEach(a=>{a=c.portalItem.resourceFromPath(a);e.push(a.portalItem.removeResource(a).catch(()=>{}))});if(0!==e.length&&(f=await k.eachAlways(e),k.throwIfAborted(d),d=f.filter(a=>"error"in a).map(a=>a.error),0<d.length))throw new q("save:resources","Failed to save one or more resources",{errors:d});}};Object.defineProperty(h,
"__esModule",{value:!0})});
//>>built
define(["dojo/_base/lang","../_base"],function(l,n){var h=l.getObject("tag.logic",!0,n);h.IfNode=l.extend(function(b,a,c,d){this.bools=b;this.trues=a;this.falses=c;this.type=d},{render:function(b,a){var c,d;if("or"==this.type){for(c=0;d=this.bools[c];c++){var e=d[0];d=d[1];if((d=d.resolve(b))&&!e||e&&!d)return this.falses&&(a=this.falses.unrender(b,a)),this.trues?this.trues.render(b,a,this):a}this.trues&&(a=this.trues.unrender(b,a));return this.falses?this.falses.render(b,a,this):a}for(c=0;d=this.bools[c];c++)if(e=
d[0],d=d[1],d=d.resolve(b),d==e)return this.trues&&(a=this.trues.unrender(b,a)),this.falses?this.falses.render(b,a,this):a;this.falses&&(a=this.falses.unrender(b,a));return this.trues?this.trues.render(b,a,this):a},unrender:function(b,a){a=this.trues?this.trues.unrender(b,a):a;return a=this.falses?this.falses.unrender(b,a):a},clone:function(b){var a=this.trues?this.trues.clone(b):null;b=this.falses?this.falses.clone(b):null;return new this.constructor(this.bools,a,b,this.type)}});h.IfEqualNode=l.extend(function(b,
a,c,d,e){this.var1=new n._Filter(b);this.var2=new n._Filter(a);this.trues=c;this.falses=d;this.negate=e},{render:function(b,a){var c=this.var1.resolve(b),d=this.var2.resolve(b);c="undefined"!=typeof c?c:"";d="undefined"!=typeof c?d:"";if(this.negate&&c!=d||!this.negate&&c==d)return this.falses&&(a=this.falses.unrender(b,a,this)),this.trues?this.trues.render(b,a,this):a;this.trues&&(a=this.trues.unrender(b,a,this));return this.falses?this.falses.render(b,a,this):a},unrender:function(b,a){return h.IfNode.prototype.unrender.call(this,
b,a)},clone:function(b){var a=this.trues?this.trues.clone(b):null;b=this.falses?this.falses.clone(b):null;return new this.constructor(this.var1.getExpression(),this.var2.getExpression(),a,b,this.negate)}});h.ForNode=l.extend(function(b,a,c,d){this.assign=b;this.loop=new n._Filter(a);this.reversed=c;this.nodelist=d;this.pool=[]},{render:function(b,a){var c,d,e,g=!1,f=this.assign;for(e=0;e<f.length;e++)if("undefined"!=typeof b[f[e]]){g=!0;b=b.push();break}!g&&b.forloop&&(g=!0,b=b.push());e=this.loop.resolve(b)||
[];var k=[];if(l.isObject(e)&&!l.isArrayLike(e))for(c in e)k.push([c,e[c]]);else k=e;for(c=k.length;c<this.pool.length;c++)this.pool[c].unrender(b,a,this);this.reversed&&(k=k.slice(0).reverse());var m=b.forloop={parentloop:b.get("forloop",{})};for(c=d=0;c<k.length;c++){var p=k[c];m.counter0=d;m.counter=d+1;m.revcounter0=k.length-d-1;m.revcounter=k.length-d;m.first=!d;m.last=d==k.length-1;if(l.isArrayLike(p))if(1<f.length){g||(g=!0,b=b.push());var q={};for(e=0;e<p.length&&e<f.length;e++)q[f[e]]=p[e];
l.mixin(b,q)}else b[f[0]]=p[1];else b[f[0]]=p;d+1>this.pool.length&&this.pool.push(this.nodelist.clone(a));a=this.pool[d++].render(b,a,this)}delete b.forloop;if(g)b=b.pop();else for(e=0;e<f.length;e++)delete b[f[e]];return a},unrender:function(b,a){for(var c=0,d;d=this.pool[c];c++)a=d.unrender(b,a);return a},clone:function(b){return new this.constructor(this.assign,this.loop.getExpression(),this.reversed,this.nodelist.clone(b))}});l.mixin(h,{if_:function(b,a){var c,d=[],e=a.contents.split();e.shift();
a=e.join(" ");e=a.split(" and ");if(1==e.length){var g="or";e=a.split(" or ")}else for(g="and",a=0;a<e.length;a++)if(-1!=e[a].indexOf(" or "))throw Error("'if' tags can't mix 'and' and 'or'");for(a=0;c=e[a];a++){var f=!1;0==c.indexOf("not ")&&(c=c.slice(4),f=!0);d.push([f,new n._Filter(c)])}e=b.parse(["else","endif"]);c=!1;a=b.next_token();"else"==a.contents&&(c=b.parse(["endif"]),b.next_token());return new h.IfNode(d,e,c,g)},_ifequal:function(b,a,c){var d=a.split_contents();if(3!=d.length)throw Error(d[0]+
" takes two arguments");var e="end"+d[0],g=b.parse(["else",e]),f=!1;a=b.next_token();"else"==a.contents&&(f=b.parse([e]),b.next_token());return new h.IfEqualNode(d[1],d[2],g,f,c)},ifequal:function(b,a){return h._ifequal(b,a)},ifnotequal:function(b,a){return h._ifequal(b,a,!0)},for_:function(b,a){var c=a.contents.split();if(4>c.length)throw Error("'for' statements should have at least four words: "+a.contents);var d="reversed"==c[c.length-1],e=d?-3:-2;if("in"!=c[c.length+e])throw Error("'for' tag received an invalid argument: "+
a.contents);for(var g=c.slice(1,e).join(" ").split(/ *, */),f=0;f<g.length;f++)if(!g[f]||-1!=g[f].indexOf(" "))throw Error("'for' tag received an invalid argument: "+a.contents);a=b.parse(["endfor"]);b.next_token();return new h.ForNode(g,c[c.length+e+1],d,a)}});return h});
//>>built
define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/has ./CartesianBase ./_PlotEvents ./common dojox/lang/functional dojox/lang/utils dojox/gfx/fx".split(" "),function(v,B,F,G,H,I,w,J,C,K){return F("dojox.charting.plot2d.OHLC",[H,I],{defaultParams:{gap:2,animate:null},optionalParams:{minBarSize:1,maxBarSize:1,stroke:{},outline:{},shadow:{},fill:{},font:"",fontColor:""},constructor:function(c,a){this.opt=v.clone(this.defaultParams);C.updateWithObject(this.opt,a);C.updateWithPattern(this.opt,
a,this.optionalParams);this.animate=this.opt.animate},collectStats:function(c){for(var a=v.delegate(w.defaultStats),h=0;h<c.length;h++){var d=c[h];if(d.data.length){var x=a.vmin,p=a.vmax;"ymin"in d&&"ymax"in d||B.forEach(d.data,function(e,b){this.isNullValue(e)||(b=e.x||b+1,a.hmin=Math.min(a.hmin,b),a.hmax=Math.max(a.hmax,b),a.vmin=Math.min(a.vmin,e.open,e.close,e.high,e.low),a.vmax=Math.max(a.vmax,e.open,e.close,e.high,e.low))},this);"ymin"in d&&(a.vmin=Math.min(x,d.ymin));"ymax"in d&&(a.vmax=Math.max(p,
d.ymax))}}return a},getSeriesStats:function(){var c=this.collectStats(this.series);c.hmin-=.5;c.hmax+=.5;return c},render:function(c,a){if(this.zoom&&!this.isDataDirty())return this.performZoom(c,a);this.resetEvents();if(this.dirty=this.isDirty()){B.forEach(this.series,w.purgeGroup);this._eventSeries={};this.cleanGroup();var h=this.getGroup();J.forEachRev(this.series,function(L){L.cleanGroup(h)})}var d=this.chart.theme,x=this._hScaler.scaler.getTransformerFromModel(this._hScaler),p=this._vScaler.scaler.getTransformerFromModel(this._vScaler),
e=this.events();var b=w.calculateBarSize(this._hScaler.bounds.scale,this.opt);var M=b.gap;b=b.size;for(var y=0;y<this.series.length;y++){var f=this.series[y];if(this.dirty||f.dirty){f.cleanGroup();var N=d.next("candlestick",[this.opt,f]);h=f.group;for(var D=Array(f.data.length),q=0;q<f.data.length;++q){var g=f.data[q];if(!this.isNullValue(g)){var n=d.addMixin(N,"candlestick",g,!0),E=x(g.x||q+.5)+a.l+M,m=c.height-a.b,k=p(g.open),l=p(g.close),t=p(g.high),r=p(g.low);if(r>t){var z=t;t=r;r=z}if(1<=b){z=
{x1:b/2,x2:b/2,y1:m-t,y2:m-r};var O={x1:0,x2:b/2+(n.series.stroke?n.series.stroke.width||1:1)/2,y1:m-k,y2:m-k},P={x1:b/2-(n.series.stroke?n.series.stroke.width||1:1)/2,x2:b,y1:m-l,y2:m-l},A=h.createGroup();A.setTransform({dx:E,dy:0});var u=A.createGroup();u.createLine(z).setStroke(n.series.stroke);u.createLine(O).setStroke(n.series.stroke);u.createLine(P).setStroke(n.series.stroke);f.dyn.stroke=n.series.stroke;e&&(g={element:"candlestick",index:q,run:f,shape:u,x:E,y:m-Math.max(k,l),cx:b/2,cy:m-Math.max(k,
l)+Math.max(k>l?k-l:l-k,1)/2,width:b,height:Math.max(k>l?k-l:l-k,1),data:g},this._connectEvents(g),D[q]=g)}this.animate&&this._animateOHLC(A,m-r,t-r)}}this._eventSeries[f.name]=D;f.dirty=!1}else d.skip(),this._reconnectEvents(f.name)}this.dirty=!1;G("dojo-bidi")&&this._checkOrientation(this.group,c,a);return this},_animateOHLC:function(c,a,h){K.animateTransform(v.delegate({shape:c,duration:1200,transform:[{name:"translate",start:[0,a-a/h],end:[0,0]},{name:"scale",start:[1,1/h],end:[1,1]},{name:"original"}]},
this.animate)).play()}})});
//>>built
define("dojo/_base/lang dojo/_base/array dojo/_base/declare dojo/dom-geometry dojo/_base/Color ./Base ./_PlotEvents ./common dojox/gfx dojox/gfx/matrix dojox/lang/functional dojox/lang/utils dojo/has".split(" "),function(Q,N,ia,Z,ja,ka,la,ma,K,aa,D,ba,ca){return ia("dojox.charting.plot2d.Pie",[ka,la],{defaultParams:{labels:!0,ticks:!1,fixed:!0,precision:1,labelOffset:20,labelStyle:"default",htmlLabels:!0,radGrad:"native",fanSize:5,startAngle:0,innerRadius:0,minWidth:0,zeroDataMessage:""},optionalParams:{radius:0,
omitLabels:!1,stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",labelWiring:{}},constructor:function(h,b){this.opt=Q.clone(this.defaultParams);ba.updateWithObject(this.opt,b);ba.updateWithPattern(this.opt,b,this.optionalParams);this.axes=[];this.run=null;this.dyn=[];this.runFilter=[];b&&b.hasOwnProperty("innerRadius")&&(this._plotSetInnerRadius=!0)},clear:function(){this.inherited(arguments);this.dyn=[];this.run=null;return this},setAxis:function(h){return this},
addSeries:function(h){this.run=h;return this},getSeriesStats:function(){return Q.delegate(ma.defaultStats)},getRequiredColors:function(){return this.run?this.run.data.length:0},render:function(h,b){if(!this.dirty)return this;this.resetEvents();this.dirty=!1;this._eventSeries={};this.cleanGroup();var e=this.group,p=this.chart.theme;!this._plotSetInnerRadius&&p&&p.pieInnerRadius&&(this.opt.innerRadius=p.pieInnerRadius);var r=(h.width-b.l-b.r)/2,q=(h.height-b.t-b.b)/2,f=Math.min(r,q),t="font"in this.opt?
this.opt.font:p.axis.tick.titleFont||"",A=t?K.normalizedLength(K.splitFontString(t).size):0,z=this.opt.hasOwnProperty("fontColor")?this.opt.fontColor:p.axis.tick.fontColor,L=aa._degToRad(this.opt.startAngle),B=L,E,M=this.run.data,U=this.events(),O=Q.hitch(this,function(){var a=p.clone(),d=D.map(M,function(u){var x=[this.opt,this.run];null!==u&&"number"!=typeof u&&x.push(u);this.opt.styleFunc&&x.push(this.opt.styleFunc(u));return a.next("slice",x,!0)},this);"radius"in this.opt&&(f=this.opt.radius<
f?this.opt.radius:f);var g={cx:b.l+r,cy:b.t+q,r:f},l=new ja(z);this.opt.innerRadius&&(l.a=.1);var w=this._createRing(e,g).setStroke(l);this.opt.innerRadius&&w.setFill(l);this.opt.zeroDataMessage&&this.renderLabel(e,g.cx,g.cy+A/3,this.opt.zeroDataMessage,{series:{font:t,fontColor:z}},null,"middle");this.dyn=[];N.forEach(M,function(u,x){this.dyn.push({fill:this._plotFill(d[x].series.fill,h,b),stroke:d[x].series.stroke})},this)});if(!this.run&&!this.run.data.ength)return O(),this;if("number"==typeof M[0]){var y=
D.map(M,"x ? Math.max(x, 0) : 0");if(D.every(y,"\x3c\x3d 0"))return O(),this;var C=D.map(y,"/this",D.foldl(y,"+",0));this.opt.labels&&(E=N.map(C,function(a){return 0<a?this._getLabel(100*a)+"%":""},this))}else{y=D.map(M,"x ? Math.max(x.y, 0) : 0");if(!y.length||D.every(y,"\x3c\x3d 0"))return O(),this;C=D.map(y,"/this",D.foldl(y,"+",0));this.opt.labels&&(E=N.map(C,function(a,d){if(0>a)return"";d=M[d];return d.hasOwnProperty("text")?d.text:this._getLabel(100*a)+"%"},this))}var P=D.map(M,function(a){var d=
[this.opt,this.run];null!==a&&"number"!=typeof a&&d.push(a);this.opt.styleFunc&&d.push(this.opt.styleFunc(a));return p.next("slice",d,!0)},this);this.opt.labels&&(y=D.foldl1(D.map(E,function(a,d){return K._base._getTextBox(a,{font:P[d].series.font}).w},this),"Math.max(a, b)")/2,0>this.opt.labelOffset&&(f=Math.min(r-2*y,q-A)+this.opt.labelOffset));this.opt.hasOwnProperty("radius")&&(f=this.opt.radius<.9*f?this.opt.radius:.9*f);!this.opt.radius&&this.opt.labels&&"columns"==this.opt.labelStyle?(f/=2,
r>q&&r>2*f&&(f*=r/(2*f)),f>=.8*q&&(f=.8*q)):f>=.9*q&&(f=.9*q);var da=f-this.opt.labelOffset;var c={cx:b.l+r,cy:b.t+q,r:f};this.dyn=[];var S=Array(C.length),m=[],n=B,V=this.opt.minWidth;N.forEach(C,function(a,d){if(0===a)m[d]={step:0,end:n,start:n,weak:!1};else{a=n+2*a*Math.PI;d===C.length-1&&(a=L+2*Math.PI);var g=a-n;m[d]={step:g,start:n,end:a,weak:g*f<V};n=a}});if(0<V){y=0;var H=V/f;O=0;var k;for(k=m.length-1;0<=k;k--)m[k].weak&&(++y,O+=m[k].step,m[k].step=H);H*=y;if(H>Math.PI){H=Math.PI/y;for(k=
0;k<m.length;++k)m[k].weak&&(m[k].step=H);H=Math.PI}if(0<y)for(H=1-(H-O)/2/Math.PI,k=0;k<m.length;++k)m[k].weak||(m[k].step*=H);for(k=0;k<m.length;++k)m[k].start=k?m[k].end:n,m[k].end=m[k].start+m[k].step;for(k=m.length-1;0<=k;--k)if(0!==m[k].step){m[k].end=n+2*Math.PI;break}}n=B;var I,v;N.some(C,function(a,d){var g=M[d],l=P[d];if(1<=a){v=this._plotFill(l.series.fill,h,b);v=this._shapeFill(v,{x:c.cx-c.r,y:c.cy-c.r,width:2*c.r,height:2*c.r});v=this._pseudoRadialFill(v,{x:c.cx,y:c.cy},c.r);var w=this._createRing(e,
c).setFill(v).setStroke(l.series.stroke);this.dyn.push({fill:v,stroke:l.series.stroke});U&&(I={element:"slice",index:d,run:this.run,shape:w,x:d,y:"number"==typeof g?g:g.y,cx:c.cx,cy:c.cy,cr:f},this._connectEvents(I),S[d]=I);for(d+=1;d<C.length;d++)l=P[d],this.dyn.push({fill:l.series.fill,stroke:l.series.stroke});return!0}if(0===m[d].step)return this.dyn.push({fill:l.series.fill,stroke:l.series.stroke}),!1;a=m[d].step;w=c.cx+f*Math.cos(n);var u=c.cy+f*Math.sin(n),x=c.cx+f*Math.cos(n+a),J=c.cy+f*Math.sin(n+
a),F=aa._degToRad(this.opt.fanSize);if(l.series.fill&&"radial"===l.series.fill.type&&"fan"===this.opt.radGrad&&a>F){var W=e.createGroup();F=Math.ceil(a/F);var R=a/F;v=this._shapeFill(l.series.fill,{x:c.cx-c.r,y:c.cy-c.r,width:2*c.r,height:2*c.r});var G;for(G=0;G<F;++G){var X=n+(G-.2)*R;var T=n+(G+1+.2)*R;var na=0==G?w:c.cx+f*Math.cos(X);var oa=0==G?u:c.cy+f*Math.sin(X);var pa=G==F-1?x:c.cx+f*Math.cos(T);T=G==F-1?J:c.cy+f*Math.sin(T);this._createSlice(W,c,f,na,oa,pa,T,X,R).setFill(this._pseudoRadialFill(v,
{x:c.cx,y:c.cy},f,n+(G+.5)*R,n+(G+.5)*R))}F=l.series.stroke;this._createSlice(W,c,f,w,u,x,J,n,a).setStroke(F);w=W}else{F=l.series.stroke;w=this._createSlice(e,c,f,w,u,x,J,n,a).setStroke(F);if((v=l.series.fill)&&"radial"===v.type)v=this._shapeFill(v,{x:c.cx-c.r,y:c.cy-c.r,width:2*c.r,height:2*c.r}),"linear"===this.opt.radGrad&&(v=this._pseudoRadialFill(v,{x:c.cx,y:c.cy},f,n,n+a));else if(v&&"linear"===v.type){u=Q.clone(w.getBoundingBox());if("svg"===K.renderer){x={w:0,h:0};try{x=Z.position(w.rawNode)}catch(ua){}x.h>
u.height&&(u.height=x.h);x.w>u.width&&(u.width=x.w)}v=this._plotFill(v,h,b);v=this._shapeFill(v,u)}w.setFill(v)}this.dyn.push({fill:v,stroke:l.series.stroke});U&&(I={element:"slice",index:d,run:this.run,shape:w,x:d,y:"number"==typeof g?g:g.y,cx:c.cx,cy:c.cy,cr:f},this._connectEvents(I),S[d]=I);n+=a;return!1},this);if(this.opt.labels){var qa=ca("dojo-bidi")&&this.chart.isRightToLeft();if("default"==this.opt.labelStyle)n=B=L,N.some(C,function(a,d){if(0>=a&&!this.opt.minWidth)return!1;var g=P[d];if(1<=
a)return this.renderLabel(e,c.cx,c.cy+A/2,E[d],g,0<this.opt.labelOffset),!0;a=B+2*a*Math.PI;d+1==C.length&&(a=L+2*Math.PI);if(this.opt.omitLabels&&.001>a-B)return!1;var l=n+m[d].step/2,w=c.cx+da*Math.cos(l);this.renderLabel(e,qa?h.width-w:w,c.cy+da*Math.sin(l)+A/2,E[d],g,0<this.opt.labelOffset);n+=m[d].step;B=a;return!1},this);else if("columns"==this.opt.labelStyle){var ra=this.opt.omitLabels;n=B=L;var Y=[],ea=0;for(y=C.length-1;0<=y;--y)C[y]&&++ea;N.forEach(C,function(a,d){a=B+2*a*Math.PI;d+1==C.length&&
(a=L+2*Math.PI);if(0!==this.minWidth||.001<=a-B){var g=n+m[d].step/2;1!==ea||this.opt.minWidth||(g=(B+a)/2);Y.push({angle:g,left:0>Math.cos(g),theme:P[d],index:d,omit:ra?.001>a-B:!1})}B=a;n+=m[d].step},this);var fa=K._base._getTextBox("a",{font:t,whiteSpace:"nowrap"}).h;this._getProperLabelRadius(Y,fa,1.1*c.r);var ha=c.cx-2*c.r,sa=c.cx+2*c.r;N.forEach(Y,function(a){if(!a.omit){var d=P[a.index],g=0;d&&d.axis&&d.axis.tick&&d.axis.tick.labelGap&&(g=d.axis.tick.labelGap);var l=K._base._getTextBox(E[a.index],
{font:d.series.font,whiteSpace:"nowrap",paddingLeft:g+"px"}).w,w=c.cx+a.labelR*Math.cos(a.angle),u=c.cy+a.labelR*Math.sin(a.angle),x=a.left?ha+l:sa-l;g=a.left?ha:x+g;var J=c.r;J=e.createPath().moveTo(c.cx+J*Math.cos(a.angle),c.cy+J*Math.sin(a.angle));Math.abs(a.labelR*Math.cos(a.angle))<2*c.r-l&&J.lineTo(w,u);J.lineTo(x,u).setStroke(a.theme.series.labelWiring);J.moveToBack();w=this.renderLabel(e,g,fa/3+u||0,E[a.index],d,!1,"left");U&&!this.opt.htmlLabels&&(d=K._base._getTextBox(E[a.index],{font:a.theme.series.font}).w||
0,l=K.normalizedLength(K.splitFontString(a.theme.series.font).size),I={element:"labels",index:a.index,run:this.run,shape:w,x:g,y:u,label:E[a.index]},g=w.getShape(),u=Z.position(this.chart.node,!0),g=Q.mixin({type:"rect"},{x:g.x,y:g.y-2*l}),g.x+=u.x,g.y+=u.y,g.x=Math.round(g.x),g.y=Math.round(g.y),g.width=Math.ceil(d),g.height=Math.ceil(l),I.aroundRect=g,this._connectEvents(I),S[C.length+a.index]=I)}},this)}}var ta=0;this._eventSeries[this.run.name]=D.map(M,function(a){return 0>=a?null:S[ta++]});ca("dojo-bidi")&&
this._checkOrientation(this.group,h,b);return this},_getProperLabelRadius:function(h,b,e){if(1==h.length)h[0].labelR=e;else{var p={},r={},q=2,f=2,t;for(t=0;t<h.length;++t){var A=Math.abs(Math.sin(h[t].angle));h[t].left?q>A&&(q=A,p=h[t]):f>A&&(f=A,r=h[t])}p.labelR=r.labelR=e;this._caculateLabelR(p,h,b);this._caculateLabelR(r,h,b)}},_caculateLabelR:function(h,b,e){var p,r=b.length,q=h.labelR,f=b[h.index].left?-e:e;var t=0;e=h.index;for(p=(e+1)%r;t<r&&b[e].left===b[p].left;++t)q=(Math.sin(b[e].angle)*
q+f)/Math.sin(b[p].angle),q=Math.max(h.labelR,q),b[p].labelR=q,e=(e+1)%r,p=(p+1)%r;t>=r&&(b[0].labelR=h.labelR);t=0;e=h.index;for(p=(e||r)-1;t<r&&b[e].left===b[p].left;++t)q=(Math.sin(b[e].angle)*q-f)/Math.sin(b[p].angle),q=Math.max(h.labelR,q),b[p].labelR=q,e=(e||r)-1,p=(p||r)-1},_createRing:function(h,b){var e=this.opt.innerRadius;0<e?e=e/100*b.r:0>e&&(e=-e);return e?h.createPath({}).setAbsoluteMode(!0).moveTo(b.cx,b.cy-b.r).arcTo(b.r,b.r,0,!1,!0,b.cx+b.r,b.cy).arcTo(b.r,b.r,0,!0,!0,b.cx,b.cy-b.r).closePath().moveTo(b.cx,
b.cy-e).arcTo(e,e,0,!1,!0,b.cx+e,b.cy).arcTo(e,e,0,!0,!0,b.cx,b.cy-e).closePath():h.createCircle(b)},_createSlice:function(h,b,e,p,r,q,f,t,A){var z=this.opt.innerRadius;0<z?z=z/100*b.r:0>z&&(z=-z);if(z){var L=b.cx+z*Math.cos(t),B=b.cy+z*Math.sin(t),E=b.cx+z*Math.cos(t+A);b=b.cy+z*Math.sin(t+A);return h.createPath({}).setAbsoluteMode(!0).moveTo(L,B).lineTo(p,r).arcTo(e,e,0,A>Math.PI,!0,q,f).lineTo(E,b).arcTo(z,z,0,A>Math.PI,!1,L,B).closePath()}return h.createPath({}).setAbsoluteMode(!0).moveTo(b.cx,
b.cy).lineTo(p,r).arcTo(e,e,0,A>Math.PI,!0,q,f).lineTo(b.cx,b.cy).closePath()}})});
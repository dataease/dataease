//>>built
define("dojo/_base/lang dojo/_base/array dojo/_base/declare ./CartesianBase ./_PlotEvents ./common ../axis2d/common dojox/gfx dojox/lang/utils dojox/gfx/fx dojo/has".split(" "),function(B,J,E,O,P,u,Q,F,M,R,K){var S=function(c,a){a=c.declaredClass;if(-1!=a.indexOf("svg"))try{return B.mixin({},c.rawNode.getBBox())}catch(h){}else{if(-1!=a.indexOf("vml")){var e=c.rawNode,b=e.style.display;e.style.display="inline";a=F.pt2px(parseFloat(e.currentStyle.width));var d=F.pt2px(parseFloat(e.currentStyle.height));
a={x:0,y:0,width:a,height:d};L(c,a);e.style.display=b;return a}if(-1!=a.indexOf("silverlight"))return L(c,{width:c.rawNode.actualWidth,height:c.rawNode.actualHeight},.75);if(c.getTextWidth)return a=c.getTextWidth(),e=c.getFont(),d=F.normalizedLength(e?e.size:F.defaultFont.size),a={width:a,height:d},L(c,a,.75),a}return null},L=function(c,a,e){var b=a.width,d=a.height;c=c.getShape();switch(c.align){case "end":a.x=c.x-b;break;case "middle":a.x=c.x-b/2;break;default:a.x=c.x}a.y=c.y-d*(e||1);return a};
E=E("dojox.charting.plot2d.Indicator",[O,P],{defaultParams:{vertical:!0,fixed:!0,precision:0,lines:!0,labels:"line",markers:!0},optionalParams:{lineStroke:{},outlineStroke:{},shadowStroke:{},lineFill:{},stroke:{},outline:{},shadow:{},fill:{},fillFunc:null,labelFunc:null,font:"",fontColor:"",markerStroke:{},markerOutline:{},markerShadow:{},markerFill:{},markerSymbol:"",values:[],offset:{},start:!1,animate:!1},constructor:function(c,a){this.opt=B.clone(this.defaultParams);M.updateWithObject(this.opt,
a);"number"==typeof a.values&&(a.values=[a.values]);M.updateWithPattern(this.opt,a,this.optionalParams);this.animate=this.opt.animate},render:function(c,a){if(this.zoom)return this.performZoom(c,a);if(!this.isDirty())return this;this.cleanGroup(null,!0);if(!this.opt.values)return this;this._updateIndicator();return this},_updateIndicator:function(){var c=this.chart.theme,a=this._hAxis.name,e=this._vAxis.name,b=this._hAxis.getScaler().bounds,d=this._vAxis.getScaler().bounds,h={};h[a]=b.from;h[e]=d.from;
var C=this.toPage(h);h[a]=b.to;h[e]=d.to;var x=this.toPage(h),l=this.events();b=J.map(this.opt.values,function(p,f){return this._renderIndicator(p,f,a,e,C,x,l,this.animate)},this);d=b.length;if("trend"==this.opt.labels){h=this.opt.vertical;var g=this._data[0][0],k=this._data[d-1][0]-g;g=this.opt.labelFunc?this.opt.labelFunc(-1,this.values,this._data,this.opt.fixed,this.opt.precision):u.getLabel(k,this.opt.fixed,this.opt.precision)+" ("+u.getLabel(100*k/g,!0,2)+"%)";this._renderText(this.getGroup(),
g,this.chart.theme,h?(b[0].x+b[d-1].x)/2:b[1].x,h?b[0].y:(b[1].y+b[d-1].y)/2,-1,this.opt.values,this._data)}(c=void 0!=this.opt.lineFill?this.opt.lineFill:c.indicator.lineFill)&&1<d&&(h=Math.min(b[0].x1,b[d-1].x1),g=Math.min(b[0].y1,b[d-1].y1),this.getGroup().createRect({x:h,y:g,width:Math.max(b[0].x2,b[d-1].x2)-h,height:Math.max(b[0].y2,b[d-1].y2)-g}).setFill(c).moveToBack())},_renderIndicator:function(c,a,e,b,d,h,C,x){var l=this.chart.theme,g=this.chart.getCoords(),k=this.opt.vertical,p=this.getGroup().createGroup(),
f={};f[e]=k?c:0;f[b]=k?0:c;K("dojo-bidi")&&(f.x=this._getMarkX(f.x));f=this.toPage(f);var q=k?f.x>=d.x&&f.x<=h.x:f.y>=h.y&&f.y<=d.y,G=f.x-g.x,H=f.y-g.y,r=k?G:d.x-g.x,t=k?d.y-g.y:H,y=k?r:h.x-g.x,v=k?h.y-g.y:t;if(this.opt.lines&&q){var n=this.opt.hasOwnProperty("lineShadow")?this.opt.lineShadow:l.indicator.lineShadow,w=this.opt.hasOwnProperty("lineStroke")?this.opt.lineStroke:l.indicator.lineStroke,m=this.opt.hasOwnProperty("lineOutline")?this.opt.lineOutline:l.indicator.lineOutline;n&&p.createLine({x1:r+
n.dx,y1:t+n.dy,x2:y+n.dx,y2:v+n.dy}).setStroke(n);m&&(m=u.makeStroke(m),m.width=2*m.width+(w?w.width:0),p.createLine({x1:r,y1:t,x2:y,y2:v}).setStroke(m));p.createLine({x1:r,y1:t,x2:y,y2:v}).setStroke(w)}var N;if(this.opt.markers&&q){var z=this._data[a],T=this;z&&(N=J.map(z,function(D,A){f[e]=k?c:D;f[b]=k?D:c;K("dojo-bidi")&&(f.x=T._getMarkX(f.x));f=this.toPage(f);if(k?f.y<=d.y&&f.y>=h.y:f.x>=d.x&&f.x<=h.x){G=f.x-g.x;H=f.y-g.y;A=this.opt.markerSymbol?this.opt.markerSymbol:l.indicator.markerSymbol;
var I="M"+G+" "+H+" "+A;n=void 0!=this.opt.markerShadow?this.opt.markerShadow:l.indicator.markerShadow;w=void 0!=this.opt.markerStroke?this.opt.markerStroke:l.indicator.markerStroke;m=void 0!=this.opt.markerOutline?this.opt.markerOutline:l.indicator.markerOutline;n&&p.createPath("M"+(G+n.dx)+" "+(H+n.dy)+" "+A).setFill(n.color).setStroke(n);m&&(m=u.makeStroke(m),m.width=2*m.width+(w?w.width:0),p.createPath(I).setStroke(m));A=p.createPath(I);I=this._shapeFill(void 0!=this.opt.markerFill?this.opt.markerFill:
l.indicator.markerFill,A.getBoundingBox());A.setFill(I).setStroke(w)}return D},this))}z=this.opt.start?{x:r,y:k?t:v}:{x:k?r:y,y:k?v:t};this.opt.labels&&"trend"!=this.opt.labels&&q&&(this.opt.labelFunc?q=this.opt.labelFunc(a,this.opt.values,this._data,this.opt.fixed,this.opt.precision,this.opt.labels):"markers"==this.opt.labels?(q=J.map(N,function(D){return u.getLabel(D,this.opt.fixed,this.opt.precision)},this),q=1!=q.length?"[ "+q.join(", ")+" ]":q[0]):q=u.getLabel(c,this.opt.fixed,this.opt.precision),
this._renderText(p,q,l,z.x,z.y,a,this.opt.values,this._data));C&&this._connectEvents({element:"indicator",run:this.run?this.run[a]:void 0,shape:p,value:c});x&&this._animateIndicator(p,k,k?t:r,k?t+v:r+y,x);return B.mixin(z,{x1:r,y1:t,x2:y,y2:v})},_animateIndicator:function(c,a,e,b,d){R.animateTransform(B.delegate({shape:c,duration:1200,transform:[{name:"translate",start:a?[0,e]:[e,0],end:[0,0]},{name:"scale",start:a?[1,1/b]:[1/b,1],end:[1,1]},{name:"original"}]},d)).play()},clear:function(){this.inherited(arguments);
this._data=[]},addSeries:function(c){this.inherited(arguments);this._data.push(c.data)},_renderText:function(c,a,e,b,d,h,C,x){this.opt.offset&&(b+=this.opt.offset.x,d+=this.opt.offset.y);a=Q.createText.gfx(this.chart,c,b,d,this.opt.vertical?"middle":this.opt.start?"start":"end",a,this.opt.font?this.opt.font:e.indicator.font,this.opt.fontColor?this.opt.fontColor:e.indicator.fontColor);b=S(a,a.getShape().text);this.opt.vertical&&!this.opt.start&&(b.y+=b.height/2,a.setShape({y:d+b.height/2}));b.x-=2;
--b.y;b.width+=4;b.height+=2;b.r=this.opt.radius?this.opt.radius:e.indicator.radius;var l=void 0!=this.opt.shadow?this.opt.shadow:e.indicator.shadow;d=void 0!=this.opt.stroke?this.opt.stroke:e.indicator.stroke;var g=void 0!=this.opt.outline?this.opt.outline:e.indicator.outline;l&&c.createRect(b).setFill(l.color).setStroke(l);g&&(g=u.makeStroke(g),g.width=2*g.width+(d?d.width:0),c.createRect(b).setStroke(g));e=this.opt.fillFunc?this.opt.fillFunc(h,C,x):void 0!=this.opt.fill?this.opt.fill:e.indicator.fill;
c.createRect(b).setFill(this._shapeFill(e,b)).setStroke(d);a.moveToFront()},getSeriesStats:function(){return B.delegate(u.defaultStats)}});K("dojo-bidi")&&E.extend({_getMarkX:function(c){return this.chart.isRightToLeft()?this.chart.axes.x.scaler.bounds.to+this.chart.axes.x.scaler.bounds.from-c:c}});return E});
//>>built
define("dojo/_base/lang dojo/_base/declare dojo/_base/array dojo/has ./CartesianBase ./_PlotEvents ./common dojox/lang/functional dojox/lang/utils dojox/gfx/fx".split(" "),function(t,C,m,D,E,F,x,G,y,H){return C("dojox.charting.plot2d.Bubble",[E,F],{defaultParams:{animate:null},optionalParams:{stroke:{},outline:{},shadow:{},fill:{},filter:{},styleFunc:null,font:"",fontColor:"",labelFunc:null},constructor:function(e,d){this.opt=t.clone(t.mixin(this.opt,this.defaultParams));y.updateWithObject(this.opt,
d);y.updateWithPattern(this.opt,d,this.optionalParams);this.opt.labelFunc||(this.opt.labelFunc=function(f,l,u){return this._getLabel(f.size,l,u)});this.animate=this.opt.animate},render:function(e,d){if(this.zoom&&!this.isDataDirty())return this.performZoom(e,d);this.resetEvents();if(this.dirty=this.isDirty()){m.forEach(this.series,x.purgeGroup);this._eventSeries={};this.cleanGroup();var f=this.getGroup();G.forEachRev(this.series,function(a){a.cleanGroup(f)})}for(var l=this.chart.theme,u=this._hScaler.scaler.getTransformerFromModel(this._hScaler),
I=this._vScaler.scaler.getTransformerFromModel(this._vScaler),J=this.events(),v=0;v<this.series.length;v++){var c=this.series[v];if(this.dirty||c.dirty)if(c.cleanGroup(),c.data.length)if("number"==typeof c.data[0])console.warn("dojox.charting.plot2d.Bubble: the data in the following series cannot be rendered as a bubble chart; ",c);else{var g=l.next("circle",[this.opt,c]),n=m.map(c.data,function(a){return a?{x:u(a.x)+d.l,y:e.height-d.b-I(a.y),radius:a.size/2*this._vScaler.bounds.scale}:null},this);
if(c.hidden)c.dyn.fill=g.series.fill,c.dyn.stroke=g.series.stroke;else{f=c.group;var h=null,p=null,q=null,z=this.opt.styleFunc,w=function(a){return z?l.addMixin(g,"circle",[a,z(a)],!0):l.addMixin(g,"circle",a,!0)};g.series.shadow&&(q=m.map(n,function(a,b){return this.isNullValue(a)?null:(b=w(c.data[b]).series.shadow,b=f.createCircle({cx:a.x+b.dx,cy:a.y+b.dy,r:a.radius}).setStroke(b).setFill(b.color),this.animate&&this._animateBubble(b,e.height-d.b,a.radius),b)},this),q.length&&(c.dyn.shadow=q[q.length-
1].getStroke()));g.series.outline&&(p=m.map(n,function(a,b){return this.isNullValue(a)?null:(b=w(c.data[b]),b=x.makeStroke(b.series.outline),b.width=2*b.width+(g.series.stroke&&g.series.stroke.width||0),b=f.createCircle({cx:a.x,cy:a.y,r:a.radius}).setStroke(b),this.animate&&this._animateBubble(b,e.height-d.b,a.radius),b)},this),p.length&&(c.dyn.outline=p[p.length-1].getStroke()));h=m.map(n,function(a,b){if(!this.isNullValue(a)){var r=w(c.data[b]),A={x:a.x-a.radius,y:a.y-a.radius,width:2*a.radius,
height:2*a.radius},k=this._plotFill(r.series.fill,e,d);k=this._shapeFill(k,A);k=f.createCircle({cx:a.x,cy:a.y,r:a.radius}).setFill(k).setStroke(r.series.stroke);k.setFilter&&r.series.filter&&k.setFilter(r.series.filter);this.animate&&this._animateBubble(k,e.height-d.b,a.radius);this.createLabel(f,c.data[b],A,r);return k}return null},this);h.length&&(c.dyn.fill=h[h.length-1].getFill(),c.dyn.stroke=h[h.length-1].getStroke());if(J){var B=Array(h.length);m.forEach(h,function(a,b){null!==a&&(a={element:"circle",
index:b,run:c,shape:a,outline:p&&p[b]||null,shadow:q&&q[b]||null,x:c.data[b].x,y:c.data[b].y,r:c.data[b].size/2,cx:n[b].x,cy:n[b].y,cr:n[b].radius},this._connectEvents(a),B[b]=a)},this);this._eventSeries[c.name]=B}else delete this._eventSeries[c.name];c.dirty=!1}}else c.dirty=!1,l.skip();else l.skip(),this._reconnectEvents(c.name)}this.dirty=!1;D("dojo-bidi")&&this._checkOrientation(this.group,e,d);return this},_animateBubble:function(e,d,f){H.animateTransform(t.delegate({shape:e,duration:1200,transform:[{name:"translate",
start:[0,d],end:[0,0]},{name:"scale",start:[0,1/f],end:[1,1]},{name:"original"}]},this.animate)).play()}})});
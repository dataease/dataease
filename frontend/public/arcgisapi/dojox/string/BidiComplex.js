//>>built
define("dojo/_base/kernel dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/sniff dojo/keys".split(" "),function(t,u,p,m,l,k){t.experimental("dojox.string.BidiComplex");var f=u.getObject("string.BidiComplex",!0,dojox),q=[];f.attachInput=function(a,b){a.alt=b;m.connect(a,"onkeydown",this,"_ceKeyDown");m.connect(a,"onkeyup",this,"_ceKeyUp");m.connect(a,"oncut",this,"_ceCutText");m.connect(a,"oncopy",this,"_ceCopyText");a.value=f.createDisplayString(a.value,a.alt)};f.createDisplayString=
function(a,b){a=f.stripSpecialCharacters(a);b=f._parse(a,b);var d="\u202a"+a,c=1;p.forEach(b,function(g){if(null!=g){var e=d.substring(0,g+c);g=d.substring(g+c,d.length);d=e+"\u200e"+g;c++}});return d};f.stripSpecialCharacters=function(a){return a.replace(/[\u200E\u200F\u202A-\u202E]/g,"")};f._ceKeyDown=function(a){q=(l("ie")?a.srcElement:a.target).value};f._ceKeyUp=function(a){var b=l("ie")?a.srcElement:a.target,d=b.value,c=a.keyCode;if(c!=k.HOME&&c!=k.END&&c!=k.SHIFT){if(a=f._getCaretPos(a,b)){var g=
a[0];var e=a[1]}if(l("ie")){a=g;var h=e;if(c==k.LEFT_ARROW){"\u200e"==d.charAt(e-1)&&g==e&&f._setSelectedRange(b,g-1,e-1);return}if(c==k.RIGHT_ARROW){"\u200e"==d.charAt(e-1)&&(h=e+1,g==e&&(a=g+1));f._setSelectedRange(b,a,h);return}}else{if(c==k.LEFT_ARROW){"\u200e"==d.charAt(e-1)&&f._setSelectedRange(b,g-1,e-1);return}if(c==k.RIGHT_ARROW){"\u200e"==d.charAt(e-1)&&f._setSelectedRange(b,g+1,e+1);return}}a=f.createDisplayString(d,b.alt);d!=a&&(window.status=d+" c\x3d"+e,b.value=a,c==k.DELETE&&"\u200e"==
a.charAt(e)&&(b.value=a.substring(0,e)+a.substring(e+2,a.length)),c==k.DELETE?f._setSelectedRange(b,g,e):c==k.BACKSPACE?q.length>=e&&"\u200e"==q.charAt(e-1)?f._setSelectedRange(b,g-1,e-1):f._setSelectedRange(b,g,e):"\u200e"!=b.value.charAt(e)&&f._setSelectedRange(b,g+1,e+1))}};f._processCopy=function(a,b,d){null==b&&(b=l("ie")?document.selection.createRange().text:a.value.substring(a.selectionStart,a.selectionEnd));a=f.stripSpecialCharacters(b);l("ie")&&window.clipboardData.setData("Text",a);return!0};
f._ceCopyText=function(a){l("ie")&&(a.returnValue=!1);return f._processCopy(a,null,!1)};f._ceCutText=function(a){if(!f._processCopy(a,null,!1))return!1;if(l("ie"))document.selection.clear();else{var b=a.selectionStart;a.value=a.value.substring(0,b)+a.value.substring(a.selectionEnd);a.setSelectionRange(b,b)}return!0};f._getCaretPos=function(a,b){if(l("ie")){a=0;var d=document.selection.createRange().duplicate(),c=d.duplicate(),g=d.text.length;for("textarea"==b.type?c.moveToElementText(b):c.expand("textedit");0<
d.compareEndPoints("StartToStart",c);)d.moveStart("character",-1),++a;return[a,a+g]}return[a.target.selectionStart,a.target.selectionEnd]};f._setSelectedRange=function(a,b,d){if(l("ie")){var c=a.createTextRange();c&&("textarea"==a.type?c.moveToElementText(a):c.expand("textedit"),c.collapse(),c.moveEnd("character",d),c.moveStart("character",b),c.select())}else a.selectionStart=b,a.selectionEnd=d};var n=function(a,b,d){for(;0<b&&b!=d;){b--;var c=a.charAt(b);if("0"<=c&&"9">=c||"\u00ff"<c)return!0;c=
a.charAt(b);if("A"<=c&&"Z">=c||"a"<=c&&"z">=c)break}return!1};f._parse=function(a,b){var d=-1,c=[],g={FILE_PATH:"/\\:.",URL:"/:.?\x3d\x26#",XPATH:"/\\:.\x3c\x3e\x3d[]",EMAIL:"\x3c\x3e@.,;"}[b];switch(b){case "FILE_PATH":case "URL":case "XPATH":p.forEach(a,function(e,h){0<=g.indexOf(e)&&n(a,h,d)&&(d=h,c.push(h))});break;case "EMAIL":p.forEach(a,function(e,h){if('"'==e){n(a,h,d)&&(d=h,c.push(h));h++;var r=a.indexOf('"',h);r>=h&&(h=r);n(a,h,d)&&(d=h,c.push(h))}0<=g.indexOf(e)&&n(a,h,d)&&(d=h,c.push(h))})}return c};
return f});
//>>built
define(["dojo","dijit","dojox","dojo/require!dojox/grid/DataGrid,dojox/data/ItemExplorer,dijit/layout/BorderContainer,dijit/layout/ContentPane"],function(e,q,r){e.provide("dojox.data.StoreExplorer");e.require("dojox.grid.DataGrid");e.require("dojox.data.ItemExplorer");e.require("dijit.layout.BorderContainer");e.require("dijit.layout.ContentPane");e.declare("dojox.data.StoreExplorer",q.layout.BorderContainer,{constructor:function(b){e.mixin(this,b)},store:null,columnWidth:"",stringQueries:!1,showAllColumns:!1,
postCreate:function(){function b(a,g){a=new q.form.Button({label:a});h.containerNode.appendChild(a.domNode);a.onClick=g;return a}var d=this;this.inherited(arguments);var h=(new q.layout.ContentPane({region:"top"})).placeAt(this),f=h.containerNode.appendChild(document.createElement("span"));f.innerHTML="Enter query: \x26nbsp;";f.id="queryText";var n=h.containerNode.appendChild(document.createElement("input"));n.type="text";n.id="queryTextBox";b("Query",function(){var a=n.value;d.setQuery(d.stringQueries?
a:e.fromJson(a))});h.containerNode.appendChild(document.createElement("span")).innerHTML="\x26nbsp;\x26nbsp;\x26nbsp;";var p=b("Create New",e.hitch(this,"createNew")),t=b("Delete",function(){for(var a=c.selection.getSelected(),g=0;g<a.length;g++)d.store.deleteItem(a[g])});this.setItemName=function(a){p.attr("label","\x3cimg style\x3d'width:12px; height:12px' src\x3d'"+e.moduleUrl("dijit.themes.tundra.images","dndCopy.png")+"' /\x3e Create New "+a);t.attr("label","Delete "+a)};b("Save",function(){d.store.save({onError:function(a){alert(a)}});
d.tree.refreshItem()});b("Revert",function(){d.store.revert()});b("Add Column",function(){var a=prompt("Enter column name:","property");a&&(d.gridLayout.push({field:a,name:a,formatter:e.hitch(d,"_formatCell"),editable:!0}),d.grid.attr("structure",d.gridLayout))});f=(new q.layout.ContentPane({region:"center"})).placeAt(this);var c=this.grid=new r.grid.DataGrid({store:this.store});f.attr("content",c);c.canEdit=function(a,g){a=this._copyAttr(g,a.field);return!(a&&"object"==typeof a)||a instanceof Date};
f=(new q.layout.ContentPane({region:"trailing",splitter:!0,style:"width: 300px"})).placeAt(this);var k=this.tree=new r.data.ItemExplorer({store:this.store});f.attr("content",k);e.connect(c,"onCellClick",function(){var a=c.selection.getSelected()[0];k.setItem(a)});this.gridOnFetchComplete=c._onFetchComplete;this.setStore(this.store)},setQuery:function(b,d){this.grid.setQuery(b,d)},_formatCell:function(b){return this.store.isItem(b)?this.store.getLabel(b)||this.store.getIdentity(b):b},setStore:function(b){function d(p){return h._formatCell(p)}
this.store=b;var h=this,f=this.grid;f._pending_requests[0]=!1;var n=this.gridOnFetchComplete;f._onFetchComplete=function(p,t){var c=h.gridLayout=[],k,a,g;var l=b.getIdentityAttributes();for(k=0;k<l.length;k++){var m=l[k];c.push({field:m,name:m,_score:100,formatter:d,editable:!1})}for(k=0;m=p[k++];){var v=b.getAttributes(m);for(g=0;m=v[g++];){var u=!1;for(a=0;l=c[a++];)if(l.field==m){l._score++;u=!0;break}u||c.push({field:m,name:m,_score:1,formatter:d,styles:"white-space:nowrap; ",editable:!0})}}c=
c.sort(function(w,x){return x._score-w._score});if(!h.showAllColumns)for(a=0;l=c[a];a++)if(l._score<p.length/40*a){c.splice(a,c.length-a);break}for(a=0;l=c[a++];)l.width=h.columnWidth||Math.round(100/c.length)+"%";f._onFetchComplete=n;f.attr("structure",c);n.apply(this,arguments)};f.setStore(b);this.queryOptions={cache:!0};this.tree.setStore(b)},createNew:function(){var b=prompt("Enter any properties (in JSON literal form) to put in the new item (passed to the newItem constructor):","{ }");if(b)try{this.store.newItem(e.fromJson(b))}catch(d){alert(d)}}})});
//>>built
define("dojo/_base/kernel dojo/_base/lang dojo/_base/declare dojo/_base/query dojo/dom-construct dojo/io/script".split(" "),function(q,A,h,E,F,G){q.experimental("dojox.data.GoogleSearchStore");var n=h("dojox.data.GoogleSearchStore",null,{constructor:function(a){a&&(a.label&&(this.label=a.label),a.key&&(this._key=a.key),a.lang&&(this._lang=a.lang),"urlPreventCache"in a&&(this.urlPreventCache=a.urlPreventCache?!0:!1));this._id=dojox.data.GoogleSearchStore.prototype._id++},_id:0,_requestCount:0,_googleUrl:"http://ajax.googleapis.com/ajax/services/search/",
_storeRef:"_S",_attributes:"unescapedUrl url visibleUrl cacheUrl title titleNoFormatting content estimatedResultCount".split(" "),_aggregatedAttributes:{estimatedResultCount:"cursor.estimatedResultCount"},label:"titleNoFormatting",_type:"web",urlPreventCache:!0,_queryAttrs:{text:"q"},_assertIsItem:function(a){if(!this.isItem(a))throw Error("dojox.data.GoogleSearchStore: a function was passed an item argument that was not an item");},_assertIsAttribute:function(a){if("string"!==typeof a)throw Error("dojox.data.GoogleSearchStore: a function was passed an attribute argument that was not an attribute name string");
},getFeatures:function(){return{"dojo.data.api.Read":!0}},getValue:function(a,b,d){return(a=this.getValues(a,b))&&0<a.length?a[0]:d},getAttributes:function(a){return this._attributes},hasAttribute:function(a,b){return this.getValue(a,b)?!0:!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(a){},getLabel:function(a){return this.getValue(a,this.label)},getLabelAttributes:function(a){return[this.label]},containsValue:function(a,b,d){a=this.getValues(a,b);for(b=0;b<a.length;b++)if(a[b]===
d)return!0;return!1},getValues:function(a,b){this._assertIsItem(a);this._assertIsAttribute(b);a=a[b];return A.isArray(a)?a:void 0!==a?[a]:[]},isItem:function(a){return a&&a[this._storeRef]===this?!0:!1},close:function(a){},_format:function(a,b){return a},fetch:function(a){function b(c){B++;w.content.context=w.content.start=c.start;c=G.get(w);x.push(c.ioArgs.id);c.addErrback(function(f){a.onError&&a.onError.call(d,f,a)})}a=a||{};var d=a.scope||q.global;if(!a.query&&a.onError)a.onError.call(d,Error(this.declaredClass+
": A query must be specified."));else{var k={};for(r in this._queryAttrs)k[r]=a.query[r];a={query:k,onComplete:a.onComplete,onError:a.onError,onItem:a.onItem,onBegin:a.onBegin,start:a.start,count:a.count};var u="GoogleSearchStoreCallback_"+this._id+"_"+ ++this._requestCount;k=this._createContent(k,u,a);if("undefined"===typeof a.start||null===a.start)a.start=0;a.count||(a.count=8);var r={start:a.start-a.start%8};var y=this,w={url:this._googleUrl+this._type,preventCache:this.urlPreventCache,content:k},
p=[],z=0,C=!1,t=a.start-1,B=0,x=[],D=function(c,f){0<x.length&&E("#"+x.splice(0,1)).forEach(F.destroy);if(!C){var g=y._getItems(f),e=f?f.cursor:null;if(g){for(var l=0;l<g.length&&l+c<a.count+a.start;l++)y._processItem(g[l],f),p[l+c]=g[l];z++;if(1==z)for(f=(c=e?e.pages:null)?Number(c[c.length-1].start):0,a.onBegin&&(e=e?e.estimatedResultCount:g.length,a.onBegin.call(d,e?Math.min(e,f+g.length):f+g.length,a)),g=a.start-a.start%8+8,e=1;c&&c[e]&&!(Number(c[e].start)>=a.start+a.count);)Number(c[e].start)>=
g&&b({start:c[e].start}),e++;if(a.onItem&&p[t+1]){do t++,a.onItem.call(d,p[t],a);while(p[t+1]&&t<a.start+a.count)}z==B&&(C=!0,q.global[u]=null,a.onItem?a.onComplete.call(d,null,a):(p=p.slice(a.start,a.start+a.count),a.onComplete.call(d,p,a)))}}},m=[],v=r.start-1;q.global[u]=function(c,f,g,e){try{if(200!=g)a.onError&&a.onError.call(d,Error("Response from Google was: "+g),a),q.global[u]=function(){};else if(c==v+1){if(D(Number(c),f),v+=8,0<m.length)for(m.sort(y._getSort());0<m.length&&m[0].start==v+
1;)D(Number(m[0].start),m[0].data),m.splice(0,1),v+=8}else m.push({start:c,data:f})}catch(l){a.onError.call(d,l,a)}};b(r)}},_getSort:function(){return function(a,b){return a.start<b.start?-1:b.start<a.start?1:0}},_processItem:function(a,b){a[this._storeRef]=this;for(var d in this._aggregatedAttributes)a[d]=A.getObject(this._aggregatedAttributes[d],!1,b)},_getItems:function(a){return a.results||a},_createContent:function(a,b,d){b={v:"1.0",rsz:"large",callback:b,key:this._key,hl:this._lang};for(var k in this._queryAttrs)b[this._queryAttrs[k]]=
a[k];return b}}),H=h("dojox.data.GoogleWebSearchStore",n,{}),I=h("dojox.data.GoogleBlogSearchStore",n,{_type:"blogs",_attributes:"blogUrl postUrl title titleNoFormatting content author publishedDate".split(" "),_aggregatedAttributes:{}}),J=h("dojox.data.GoogleLocalSearchStore",n,{_type:"local",_attributes:"title titleNoFormatting url lat lng streetAddress city region country phoneNumbers ddUrl ddUrlToHere ddUrlFromHere staticMapUrl viewport".split(" "),_aggregatedAttributes:{viewport:"viewport"},
_queryAttrs:{text:"q",centerLatLong:"sll",searchSpan:"sspn"}}),K=h("dojox.data.GoogleVideoSearchStore",n,{_type:"video",_attributes:"title titleNoFormatting content url published publisher duration tbWidth tbHeight tbUrl playUrl".split(" "),_aggregatedAttributes:{}}),L=h("dojox.data.GoogleNewsSearchStore",n,{_type:"news",_attributes:"title titleNoFormatting content url unescapedUrl publisher clusterUrl location publishedDate relatedStories".split(" "),_aggregatedAttributes:{}}),M=h("dojox.data.GoogleBookSearchStore",
n,{_type:"books",_attributes:"title titleNoFormatting authors url unescapedUrl bookId pageCount publishedYear".split(" "),_aggregatedAttributes:{}});h=h("dojox.data.GoogleImageSearchStore",n,{_type:"images",_attributes:"title titleNoFormatting visibleUrl url unescapedUrl originalContextUrl width height tbWidth tbHeight tbUrl content contentNoFormatting".split(" "),_aggregatedAttributes:{}});return{Search:n,ImageSearch:h,BookSearch:M,NewsSearch:L,VideoSearch:K,LocalSearch:J,BlogSearch:I,WebSearch:H}});
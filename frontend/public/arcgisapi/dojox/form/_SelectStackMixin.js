//>>built
define(["dojo/_base/lang","dojo/_base/array","dijit/_base/manager","dojo/_base/connect","dojo/_base/declare"],function(h,g,l,k,p){return p("dojox.form._SelectStackMixin",null,{stackId:"",stackPrefix:"",_paneIdFromOption:function(a){return(this.stackPrefix||"")+a},_optionValFromPane:function(a){var b=this.stackPrefix;return b&&0===a.indexOf(b)?a.substring(b.length):a},_togglePane:function(a,b){if(void 0==a._shown||a._shown!=b){var f=g.filter(a.getDescendants(),"return item.name;");if(b){var d=a._savedStates||
{};g.forEach(f,function(e){var c=d[e.id];void 0==c&&(c=!1);e.set("disabled",c)});delete a._savedStates}else d={},g.forEach(f,function(e){d[e.id]=e.disabled;e.set("disabled",!0)}),a._savedStates=d;a._shown=b}},_connectTitle:function(a,b){var f=h.hitch(this,function(d){this.updateOption({value:b,label:d})});a._setTitleAttr?this.connect(a,"_setTitleAttr",f):this.connect(a,"attr",function(d,e){"title"==d&&1<arguments.length&&f(e)})},onAddChild:function(a,b){this._panes[a.id]||(this._panes[a.id]=a,b=this._optionValFromPane(a.id),
this.addOption({value:b,label:a.title}),this._connectTitle(a,b));a.onShow&&a.onHide&&void 0!=a._shown||(a.onShow=h.hitch(this,"_togglePane",a,!0),a.onHide=h.hitch(this,"_togglePane",a,!1),a.onHide())},_setValueAttr:function(a){"_savedValue"in this||this.inherited(arguments)},attr:function(a,b){"value"==a&&2==arguments.length&&"_savedValue"in this&&(this._savedValue=b);return this.inherited(arguments)},onRemoveChild:function(a){this._panes[a.id]&&(delete this._panes[a.id],this.removeOption(this._optionValFromPane(a.id)))},
onSelectChild:function(a){this._setValueAttr(this._optionValFromPane(a.id))},onStartup:function(a){var b=a.selected;this.addOption(g.filter(g.map(a.children,function(c){var m=this._optionValFromPane(c.id);this._connectTitle(c,m);var n=null;this._panes[c.id]||(this._panes[c.id]=c,n={value:m,label:c.title});c.onShow&&c.onHide&&void 0!=c._shown||(c.onShow=h.hitch(this,"_togglePane",c,!0),c.onHide=h.hitch(this,"_togglePane",c,!1),c.onHide());"_savedValue"in this&&m===this._savedValue&&(b=c);return n},
this),function(c){return c}));var f=this,d=function(){delete f._savedValue;f.onSelectChild(b);b._shown||f._togglePane(b,!0)};if(b!==a.selected){a=l.byId(this.stackId);var e=this.connect(a,"_showChild",function(c){this.disconnect(e);d()})}else d()},postMixInProperties:function(){this._savedValue=this.value;this.inherited(arguments);this.connect(this,"onChange","_handleSelfOnChange")},postCreate:function(){this.inherited(arguments);this._panes={};this._subscriptions=[k.subscribe(this.stackId+"-startup",
this,"onStartup"),k.subscribe(this.stackId+"-addChild",this,"onAddChild"),k.subscribe(this.stackId+"-removeChild",this,"onRemoveChild"),k.subscribe(this.stackId+"-selectChild",this,"onSelectChild")];var a=l.byId(this.stackId);if(a&&a._started)this.onStartup({children:a.getChildren(),selected:a.selectedChildWidget})},destroy:function(){g.forEach(this._subscriptions,k.unsubscribe);delete this._panes;this.inherited("destroy",arguments)},_handleSelfOnChange:function(a){if(a=this._panes[this._paneIdFromOption(a)]){var b=
l.byId(this.stackId);a==b.selectedChildWidget?b._transition(a):b.selectChild(a)}}})});
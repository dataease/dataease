//>>built
require({cache:{"url:dojox/grid/resources/Expando.html":'\x3cdiv class\x3d"dojoxGridExpando"\r\n\t\x3e\x3cdiv class\x3d"dojoxGridExpandoNode" dojoAttachEvent\x3d"onclick:onToggle"\r\n\t\t\x3e\x3cdiv class\x3d"dojoxGridExpandoNodeInner" dojoAttachPoint\x3d"expandoInner"\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n'}});
define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/event dojo/_base/array dojo/query dojo/parser dojo/dom-construct dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/dom dojo/keys dojo/text!./resources/Expando.html dijit/_Widget dijit/_TemplatedMixin ./TreeGrid ./_Builder ./_View ./_Layout ./cells/tree ./_RowManager ./_FocusManager ./_EditManager ./DataSelection ./util".split(" "),function(G,n,k,H,u,B,I,C,v,J,r,K,L,x,M,N,D,O,y,P,Q,R,S,T,U,V){var W=n("dojox.grid._LazyExpando",
[M,N],{grid:null,view:null,rowIdx:-1,cellIdx:-1,level:0,itemId:"",templateString:x,onToggle:function(a){if(this.grid._treeCache.items[this.rowIdx]){this.grid.focus.setFocusIndex(this.rowIdx,this.cellIdx);this.setOpen(!this.grid._treeCache.items[this.rowIdx].opened);try{H.stop(a)}catch(b){}}},setOpen:function(a){var b=this.grid,c=b._by_idx[this.rowIdx].item;c&&b.treeModel.mayHaveChildren(c)&&!b._loading&&b._treeCache.items[this.rowIdx].opened!==a&&(b._treeCache.items[this.rowIdx].opened=a,b.expandoFetch(this.rowIdx,
a),this._updateOpenState(c))},_updateOpenState:function(a){var b=this.grid;a&&b.treeModel.mayHaveChildren(a)?(a=b._treeCache.items[this.rowIdx].opened,this.expandoInner.innerHTML=a?"-":"+",v.toggle(this.domNode,"dojoxGridExpandoOpened",a),this.domNode.parentNode.setAttribute("aria-expanded",a)):v.remove(this.domNode,"dojoxGridExpandoOpened")},setRowNode:function(a,b,c){if(0>this.cellIdx||!this.itemId)return!1;this.view=c;this.grid=c.grid;this.rowIdx=a;a=this.grid.isLeftToRight()?"marginLeft":"marginRight";
J.set(this.domNode.parentNode,a,1.125*this.level+"em");this._updateOpenState(this.grid._by_idx[this.rowIdx].item);return!0}});x=n("dojox.grid._TreeGridContentBuilder",O._ContentBuilder,{generateHtml:function(a,b){a=this.getTableArray();var c=this.grid,d=this.view.structure.cells,f=c.getItem(b),e=0,g="",h=c._treeCache.items[b]?c._treeCache.items[b].treePath:null;V.fire(this.view,"onBeforeRow",[b,d]);f&&k.isArray(h)&&(e=h.length,g=c.treeModel.mayHaveChildren(f)?"":"dojoxGridNoChildren");var l=0;c=0;
for(var t,m,z=0,E=[];t=d[c];c++)if(!t.hidden&&!t.header){a.push('\x3ctr class\x3d"'+g+'"\x3e');(h=this._getColSpans(e))&&u.forEach(h,function(F){for(l=0;m=t[l];l++)l>=F.start&&l<=F.end&&(z+=this._getCellWidth(t,l));E.push(z);z=0},this);var p=0;for(l=0;m=t[l];l++){var q=m.markup;var w=m.customClasses=[];var A=m.customStyles=[];h&&h[p]&&l>=h[p].start&&l<=h[p].end?l==(h[p].primary||h[p].start)?(q[5]=m.formatAtLevel(f,e,b),q[1]=w.join(" "),w=r.getMarginBox(m.getHeaderNode()).w-r.getContentBox(m.getHeaderNode()).w,
A=m.customStyles=["width:"+(E[p]-w)+"px"],q[3]=A.join(";"),a.push.apply(a,q)):l==h[p].end&&p++:(q[5]=m.formatAtLevel(f,e,b),q[1]=w.join(" "),q[3]=A.join(";"),a.push.apply(a,q))}a.push("\x3c/tr\x3e")}a.push("\x3c/table\x3e");return a.join("")},_getColSpans:function(a){var b=this.grid.colSpans;return b&&b[a]?b[a]:null},_getCellWidth:function(a,b){var c=a[b],d=c.getHeaderNode();if(c.hidden)return 0;if(b==a.length-1||u.every(a.slice(b+1),function(f){return f.hidden}))return a=r.position(a[b].view.headerContentNode.firstChild),
a.x+a.w-r.position(d).x;do c=a[++b];while(c.hidden);return r.position(c.getHeaderNode()).x-r.position(d).x}});n("dojox.grid._TreeGridView",y,{_contentBuilderClass:x,postCreate:function(){this.inherited(arguments);this._expandos={};this.connect(this.grid,"_onCleanupExpandoCache","_cleanupExpandoCache")},destroy:function(){this._cleanupExpandoCache();this.inherited(arguments)},_cleanupExpandoCache:function(a){if(a&&this._expandos[a])this._expandos[a].destroy(),delete this._expandos[a];else{for(var b in this._expandos)this._expandos[b].destroy();
this._expandos={}}},onAfterRow:function(a,b,c){B("span.dojoxGridExpando",c).forEach(function(d){if(d&&d.parentNode){var f=this.grid._by_idx;if(f&&f[a]&&f[a].idty){var e=f[a].idty;var g=this._expandos[e]}g?(C.place(g.domNode,d,"replace"),g.itemId=d.getAttribute("itemId"),g.cellIdx=parseInt(d.getAttribute("cellIdx"),10),isNaN(g.cellIdx)&&(g.cellIdx=-1)):(g=I.parse(d.parentNode)[0],e&&(this._expandos[e]=g));g.setRowNode(a,c,this)||g.domNode.parentNode.removeChild(g.domNode);C.destroy(d)}},this);this.inherited(arguments)},
updateRow:function(a){var b=this.grid,c;b.keepSelection&&(c=b.getItem(a))&&b.selection.preserver._reSelectById(c,a);this.inherited(arguments)}});var X=k.mixin(k.clone(Q),{formatAtLevel:function(a,b,c){if(!a)return this.formatIndexes(c,a,b);var d="";this.isCollapsable&&this.grid.store.isItem(a)&&(d="\x3cspan "+G._scopeName+'Type\x3d"dojox.grid._LazyExpando" level\x3d"'+b+'" class\x3d"dojoxGridExpando" itemId\x3d"'+this.grid.store.getIdentity(a)+'" cellIdx\x3d"'+this.index+'"\x3e\x3c/span\x3e');a=this.formatIndexes(c,
a,b);return""!==d?"\x3cdiv\x3e"+d+a+"\x3c/div\x3e":a},formatIndexes:function(a,b,c){var d=this.grid.edit.info;b=this.get?this.get(a,b):this.value||this.defaultValue;if(this.editable&&(this.alwaysEditing||d.rowIndex===a&&d.cell===this))return this.formatEditing(b,a);d=this.textDir||this.grid.textDir;a=this._defaultFormat(b,[b,a,c,this]);d&&this._enforceTextDirWithUcc&&(a=this._enforceTextDirWithUcc(d,a));return a}});y=n("dojox.grid._LazyTreeLayout",P,{setStructure:function(a){var b=a;this.grid&&!u.every(b,
function(c){return!!c.cells})&&(b=arguments[0]=[{cells:[b]}]);1===b.length&&1===b[0].cells.length&&(b[0].type="dojox.grid._TreeGridView",this._isCollapsable=!0,b[0].cells[0][this.grid.expandoCell].isCollapsable=!0);this.inherited(arguments)},addCellDef:function(a,b,c){var d=this.inherited(arguments);return k.mixin(d,X)}});var Y=n("dojox.grid._LazyTreeGridCache",null,{constructor:function(){this.items=[]},getSiblingIndex:function(a,b){--a;for(var c=0,d;0<=a;a--)if(d=this.items[a]?this.items[a].treePath:
[],d.join("/")===b.join("/"))c++;else if(d.length<b.length)break;return c},removeChildren:function(a){for(var b=a+1,c,d=this.items[a]?this.items[a].treePath:[];b<this.items.length&&!(c=this.items[b]?this.items[b].treePath:[],c.join("/")===d.join("/")||c.length<=d.length);b++);b-=a+1;this.items.splice(a+1,b);return b}});n=n("dojox.grid.LazyTreeGrid",D,{_layoutClass:y,_size:0,treeModel:null,defaultState:null,colSpans:null,postCreate:function(){this._setState();this.inherited(arguments);this._treeCache||
(this._treeCache=new Y);if(!(this.treeModel&&this.treeModel instanceof dijit.tree.ForestStoreModel))throw Error("dojox.grid.LazyTreeGrid: must be used with a treeModel which is an instance of dijit.tree.ForestStoreModel");v.add(this.domNode,"dojoxGridTreeModel");K.setSelectable(this.domNode,this.selectable)},createManagers:function(){this.rows=new R(this);this.focus=new S(this);this.edit=new T(this)},createSelection:function(){this.selection=new U(this)},setModel:function(a){a&&(this._setModel(a),
this._cleanup(),this._refresh(!0))},setStore:function(a,b,c){a&&(this._setQuery(b,c),this.treeModel.query=b,this.treeModel.store=a,this.treeModel.root.children=[],this.setModel(this.treeModel))},onSetState:function(){},_setState:function(){this.defaultState&&(this._treeCache=this.defaultState.cache,this.sortInfo=this.defaultState.sortInfo||0,this.query=this.defaultState.query||this.query,this._lastScrollTop=this.defaultState.scrollTop,this.keepSelection?this.selection.preserver._selectedById=this.defaultState.selection:
this.selection.selected=this.defaultState.selection||[],this.onSetState())},getState:function(){var a=this.keepSelection?this.selection.preserver._selectedById:this.selection.selected;return{cache:k.clone(this._treeCache),query:k.clone(this.query),sortInfo:k.clone(this.sortInfo),scrollTop:k.clone(this.scrollTop),selection:k.clone(a)}},_setQuery:function(a,b){this.inherited(arguments);this.treeModel.query=a},filter:function(a,b){this._cleanup();this.inherited(arguments)},destroy:function(){this._cleanup();
this.inherited(arguments)},expand:function(a){this._fold(a,!0)},collapse:function(a){this._fold(a,!1)},refresh:function(a){a||this._cleanup();this._refresh(!0)},_cleanup:function(){this._treeCache.items=[];this._onCleanupExpandoCache()},setSortIndex:function(a,b){this.canSort(a+1)&&this._cleanup();this.inherited(arguments)},_refresh:function(a){this._clearData();this.updateRowCount(this._size);this._fetch(0,!0)},render:function(){this.inherited(arguments);this.setScrollTop(this.scrollTop)},_onNew:function(a,
b){var c=b&&this.store.isItem(b.item)&&u.some(this.treeModel.childrenAttrs,function(h){return h===b.attribute}),d=this._treeCache.items,f=this._by_idx;if(c){c=this.store.getIdentity(b.item);for(var e=-1,g=0;g<f.length;g++)if(c===f[g].idty){e=g;break}if(0<=e)if(d[e]&&d[e].opened){g=d[e].treePath;for(e+=1;e<d.length&&!(d[e].treePath.length<=g.length);e++);d=g.slice();d.push(c);this._treeCache.items.splice(e,0,{opened:!1,treePath:d});d=this.store.getIdentity(a);this._by_idty[d]={idty:d,item:a};f.splice(e,
0,this._by_idty[d]);this._size+=1;this.updateRowCount(this._size);this._updateRenderedRows(e)}else this.updateRow(e)}else d.push({opened:!1,treePath:[]}),this._size+=1,this.inherited(arguments)},_onDelete:function(a){var b=0,c=-1;for(a=this.store.getIdentity(a);b<this._by_idx.length;b++)if(a===this._by_idx[b].idty){c=b;break}if(0<=c){var d=this._treeCache.items,f=d[c]?d[c].treePath:[],e=1;for(b=c+1;b<this._size&&!(d[b].treePath.length<=f.length);b++,e++);d.splice(c,e);this._onCleanupExpandoCache(a);
this._by_idx.splice(c,e);this._size-=e;this.updateRowCount(this._size);this._updateRenderedRows(c)}},_onCleanupExpandoCache:function(a){},_fetch:function(a,b){this._loading||(this._loading=!0);a=a||0;b=0<this._size-a?Math.min(this.rowsPerPage,this._size-a):this.rowsPerPage;var c=0,d=[];for(this._reqQueueLen=0;c<b;c++)if(this._by_idx[a+c])d.push(this._by_idx[a+c].item);else break;if(d.length===b)this._reqQueueLen=1,this._onFetchBegin(this._size,{startRowIdx:a,count:b}),this._onFetchComplete(d,{startRowIdx:a,
count:b});else{var f=1,e=this._treeCache.items,g=e[a]?e[a].treePath:[];for(c=1;c<b;c++){d=e[a+f-1]?e[a+f-1].treePath.length:0;var h=e[a+f]?e[a+f].treePath.length:0;d!==h?(this._reqQueueLen++,this._fetchItems({startRowIdx:a,count:f,treePath:g}),a+=f,f=1,g=e[a]?e[a].treePath:0):f++}this._reqQueueLen++;this._fetchItems({startRowIdx:a,count:f,treePath:g})}},_fetchItems:function(a){if(!this._pending_requests[a.startRowIdx]){this.showMessage(this.loadingMessage);this._pending_requests[a.startRowIdx]=!0;
var b=k.hitch(this,"_onFetchError"),c=this._treeCache.getSiblingIndex(a.startRowIdx,a.treePath);if(0===a.treePath.length)this.store.fetch({start:c,startRowIdx:a.startRowIdx,treePath:a.treePath,count:a.count,query:this.query,sort:this.getSortProps(),queryOptions:this.queryOptions,onBegin:k.hitch(this,"_onFetchBegin"),onComplete:k.hitch(this,"_onFetchComplete"),onError:k.hitch(this,"_onFetchError")});else{var d=a.treePath[a.treePath.length-1],f={start:c,startRowIdx:a.startRowIdx,treePath:a.treePath,
count:a.count,parentId:d,sort:this.getSortProps()},e=this,g=function(){var h=k.hitch(e,"_onFetchComplete");1==arguments.length?h.apply(e,[arguments[0],f]):h.apply(e,arguments)};this._by_idty[d]?(a=this._by_idty[d].item,this.treeModel.getChildren(a,g,b,f)):this.store.fetchItemByIdentity({identity:d,onItem:function(h){e.treeModel.getChildren(h,g,b,f)},onError:b})}}},_onFetchBegin:function(a,b){0===this._treeCache.items.length&&(this._size=parseInt(a,10));a=this._size;this.inherited(arguments)},_onFetchComplete:function(a,
b){var c=b.startRowIdx,d=b.count,f=a.length<=d?0:b.start;b=b.treePath||[];if(k.isArray(a)&&0<a.length){var e=0;for(d=Math.min(d,a.length);e<d;e++)this._treeCache.items[c+e]||(this._treeCache.items[c+e]={opened:!1,treePath:b}),this._by_idx[c+e]||this._addItem(a[f+e],c+e,!0);this.updateRows(c,d)}0==this._size?this.showMessage(this.noDataMessage):this.showMessage();this._pending_requests[c]=!1;this._reqQueueLen--;this._loading&&0===this._reqQueueLen&&(this._loading=!1,this._lastScrollTop&&this.setScrollTop(this._lastScrollTop))},
expandoFetch:function(a,b){if(!this._loading&&this._by_idx[a]){this._loading=!0;this._toggleLoadingClass(a,!0);this.expandoRowIndex=a;var c=this._by_idx[a].item;b?(a={start:0,count:this.rowsPerPage,parentId:this.store.getIdentity(this._by_idx[a].item),sort:this.getSortProps()},this.treeModel.getChildren(c,k.hitch(this,"_onExpandoComplete"),k.hitch(this,"_onFetchError"),a)):(c=this._treeCache.removeChildren(a),this._by_idx.splice(a+1,c),this._bop=this._eop=-1,this._size-=c,this.updateRowCount(this._size),
this._updateRenderedRows(a+1),this._toggleLoadingClass(a,!1),this._loading&&(this._loading=!1),this.focus._delayedCellFocus())}},_onExpandoComplete:function(a,b,c){c=isNaN(c)?a.length:parseInt(c,10);var d=this._treeCache.items[this.expandoRowIndex].treePath.slice(0);d.push(this.store.getIdentity(this._by_idx[this.expandoRowIndex].item));for(b=1;b<=c;b++)this._treeCache.items.splice(this.expandoRowIndex+b,0,{treePath:d,opened:!1});this._size+=c;this.updateRowCount(this._size);for(b=0;b<c;b++)a[b]?
(d=this.store.getIdentity(a[b]),this._by_idty[d]={idty:d,item:a[b]},this._by_idx.splice(this.expandoRowIndex+1+b,0,this._by_idty[d])):this._by_idx.splice(this.expandoRowIndex+1+b,0,null);this._updateRenderedRows(this.expandoRowIndex+1);this._toggleLoadingClass(this.expandoRowIndex,!1);this.stateChangeNode=null;this._loading&&(this._loading=!1);!0===this.autoHeight&&this._resize();this.focus._delayedCellFocus()},styleRowNode:function(a,b){b&&this.rows.styleRowNode(a,b)},onStyleRow:function(a){this.layout._isCollapsable?
(a.customClasses+=(a.odd?" dojoxGridRowOdd":"")+(a.selected?" dojoxGridRowSelected":"")+(a.over?" dojoxGridRowOver":""),this.focus.styleRow(a),this.edit.styleRow(a)):this.inherited(arguments)},onKeyDown:function(a){if(!a.altKey&&!a.metaKey){var b=dijit.findWidgets(a.target)[0];if(a.keyCode===L.ENTER&&b instanceof W)b.onToggle();this.inherited(arguments)}},_toggleLoadingClass:function(a,b){var c=this.views.views;(a=c[c.length-1].getRowNode(a))&&(a=B(".dojoxGridExpando",a)[0])&&v.toggle(a,"dojoxGridExpandoLoading",
b)},_updateRenderedRows:function(a){u.forEach(this.scroller.stack,function(b){b*this.rowsPerPage>=a?this.updateRows(b*this.rowsPerPage,this.rowsPerPage):(b+1)*this.rowsPerPage>=a&&this.updateRows(a,(b+1)*this.rowsPerPage-a+1)},this)},_fold:function(a,b){var c=-1,d=0,f=this._by_idx,e=this._by_idty[a];if(e&&e.item&&this.treeModel.mayHaveChildren(e.item)){for(;d<f.length;d++)if(f[d]&&f[d].idty===a){c=d;break}0<=c&&(a=this.views.views[this.views.views.length-1].getRowNode(c))&&(a=dijit.findWidgets(a)[0])&&
a.setOpen(b)}}});n.markupFactory=function(a,b,c,d){return D.markupFactory(a,b,c,d)};return n});
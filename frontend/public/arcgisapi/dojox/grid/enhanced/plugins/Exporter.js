//>>built
define("dojo/_base/declare dojo/_base/array dojo/_base/lang ../_Plugin ../../_RowSelector ../../EnhancedGrid ../../cells/_base".split(" "),function(q,n,d,r,t,u){var v=d.getObject("dojox.grid.cells"),h=q("dojox.grid.enhanced.plugins.Exporter",r,{name:"exporter",constructor:function(a,b){this.grid=a;this.formatter=b&&d.isObject(b)&&b.exportFormatter;this._mixinGrid()},_mixinGrid:function(){var a=this.grid;a.exportTo=d.hitch(this,this.exportTo);a.exportGrid=d.hitch(this,this.exportGrid);a.exportSelected=
d.hitch(this,this.exportSelected);a.setExportFormatter=d.hitch(this,this.setExportFormatter)},setExportFormatter:function(a){this.formatter=a},exportGrid:function(a,b,c){d.isFunction(b)&&(c=b,b={});if(d.isString(a)&&d.isFunction(c)){b=b||{};var e=this.grid,f=this,g=this._getExportWriter(a,b.writerArgs);b=b.fetchArgs&&d.isObject(b.fetchArgs)?b.fetchArgs:{};var k=b.onComplete;if(e.store)b.onComplete=function(p,w){k&&k(p,w);c(f._goThroughGridData(p,g))},b.sort=b.sort||e.getSortProps(),e._storeLayerFetch(b);
else{a=b.start||0;b=b.count||-1;for(var l=[],m=a;m!=a+b&&m<e.rowCount;++m)l.push(e.getItem(m));c(this._goThroughGridData(l,g))}}},exportSelected:function(a,b,c){if(!d.isString(a))return"";a=this._getExportWriter(a,b);return c(this._goThroughGridData(this.grid.selection.getSelected(),a))},_buildRow:function(a,b){var c=this;n.forEach(a._views,function(e,f){a.view=e;a.viewIdx=f;b.beforeView(a)&&(n.forEach(e.structure.cells,function(g,k){a.subrow=g;a.subrowIdx=k;b.beforeSubrow(a)&&(n.forEach(g,function(l,
m){a.isHeader&&c._isSpecialCol(l)&&a.spCols.push(l.index);a.cell=l;a.cellIdx=m;b.handleCell(a)}),b.afterSubrow(a))}),b.afterView(a))})},_goThroughGridData:function(a,b){var c=this.grid,e=n.filter(c.views.views,function(g){return!(g instanceof t)}),f={grid:c,isHeader:!0,spCols:[],_views:e,colOffset:e.length<c.views.views.length?-1:0};b.beforeHeader(c)&&(this._buildRow(f,b),b.afterHeader());f.isHeader=!1;b.beforeContent(a)&&(n.forEach(a,function(g,k){f.row=g;f.rowIdx=k;b.beforeContentRow(f)&&(this._buildRow(f,
b),b.afterContentRow(f))},this),b.afterContent());return b.toString()},_isSpecialCol:function(a){return a.isRowSelector||a instanceof v.RowIndex},_getExportWriter:function(a,b){var c=h;if(c.writerNames){a=c.writerNames[a.toLowerCase()];if(c=d.getObject(a))return b=new c(b),b.formatter=this.formatter,b;throw Error('Please make sure class "'+a+'" is required.');}throw Error('The writer for "'+a+'" has not been registered.');}});h.registerWriter=function(a,b){h.writerNames=h.writerNames||{};h.writerNames[a]=
b};u.registerPlugin(h);return h});
//>>built
define(["dojo/_base/declare","dojo/_base/connect","dojo/_base/lang","dojo/_base/array"],function(g,c,e,h){return g("dojox.grid._SelectionPreserver",null,{constructor:function(b){this.selection=b;var a=this.grid=b.grid;this.reset();this._connects=[c.connect(a,"_setStore",this,"reset"),c.connect(a,"_addItem",this,"_reSelectById"),c.connect(b,"onSelected",e.hitch(this,"_selectById",!0)),c.connect(b,"onDeselected",e.hitch(this,"_selectById",!1)),c.connect(b,"deselectAll",this,"reset")]},destroy:function(){this.reset();
h.forEach(this._connects,c.disconnect);delete this._connects},reset:function(){this._selectedById={}},_reSelectById:function(b,a){b&&this.grid._hasIdentity&&(this.selection.selected[a]=this._selectedById[this.grid.store.getIdentity(b)])},_selectById:function(b,a){if("none"!=this.selection.mode&&this.grid._hasIdentity){var d=a,f=this.grid;if("number"==typeof a||"string"==typeof a)d=(a=f._by_idx[a])&&a.item;d&&(this._selectedById[f.store.getIdentity(d)]=!!b);return d}}})});
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/sniff dojo/dom-construct dojo/dom-class ./Selection".split(" "),function(k,h,l,m,n,p){return k(p,{postCreate:function(){this.inherited(arguments);this.on(".dgrid-selector:click,.dgrid-selector:keydown",h.hitch(this,"_handleSelectorClick"));this.on("dgrid-select",h.hitch(this,"_changeSelectorInput",!0));this.on("dgrid-deselect",h.hitch(this,"_changeSelectorInput",!1))},_defaultRenderSelectorInput:function(a,b,c,f){var d=a.grid;n.add(c,"dgrid-selector");
return c.input=m.create("input",{"aria-checked":b,checked:b,disabled:!d.allowSelect(d.row(f)),tabIndex:isNaN(a.tabIndex)?-1:a.tabIndex,type:a.selector},c)},_configureSelectorColumn:function(a){var b=this,c=a.selector;this._selectorColumns.push(a);this._selectorSingleRow=this._selectorSingleRow||"radio"===a.selector;var f="function"===typeof c?c:this._defaultRenderSelectorInput;a.sortable=!1;a.renderCell=function(d,e,g){e=(e=d&&b.row(d))&&b.selection[e.id];f(a,!!e,g,d)};a.renderHeaderCell=function(d){var e=
"label"in a?a.label:a.field||"";"radio"!==a.selector&&b.allowSelectAll?(a._selectorHeaderCheckbox=f(a,!1,d,{}),b._hasSelectorHeaderCheckbox=!0):d.appendChild(document.createTextNode(e))}},_handleSelectorClick:function(a){if("INPUT"!==a.target.nodeName||"keydown"!==a.type||32!==a.keyCode){var b=this.cell(a).row;if("click"===a.type||32===a.keyCode||!l("opera")&&13===a.keyCode||0===a.keyCode){this._selectionTriggerEvent=a;if(b){if(this.allowSelect(b)){var c=this._lastSelected&&this.row(this._lastSelected);
this._selectorSingleRow?c&&c.id===b.id||(this.clearSelection(),this.select(b,null,!0),this._lastSelected=b.element):b&&(a.shiftKey?this._changeSelectorInput(!0,{rows:[b]}):c=null,c=a.shiftKey?c:null,this.select(c||b,b,c?void 0:null),this._lastSelected=b.element)}}else this[this.allSelected?"clearSelection":"selectAll"]();this._selectionTriggerEvent=null}}},_changeSelectorInput:function(a,b){this._selectorColumns.length&&this._updateRowSelectors(a,b);this._hasSelectorHeaderCheckbox&&this._updateHeaderCheckboxes()},
_updateRowSelectors:function(a,b){b=b.rows;for(var c=b.length,f=this._selectorColumns.length,d=0;d<c;d++)for(var e=0;e<f;e++){var g=this.cell(b[d],this._selectorColumns[e].id).element;g&&(g=(g.contents||g).input)&&!g.disabled&&(g.checked=a,g.setAttribute("aria-checked",a))}},_updateHeaderCheckboxes:function(){for(var a=this._selectorColumns.length,b=0;b<a;b++){var c="false",f=this._selectorColumns[b]._selectorHeaderCheckbox;if(f){var d=this.selection;var e=!1;for(var g in d)if(d[g]!=this.allSelected){e=
!0;break}f.indeterminate=e;f.checked=this.allSelected;e?c="mixed":this.allSelected&&(c="true");f.setAttribute("aria-checked",c)}}},configStructure:function(){this.inherited(arguments);var a=this.columns;this._selectorColumns=[];this._hasSelectorHeaderCheckbox=this._selectorSingleRow=!1;for(var b in a)a[b].selector&&this._configureSelectorColumn(a[b])},_handleSelect:function(a){var b=this.cell(a).column;b&&b.selector||this.inherited(arguments)}})});
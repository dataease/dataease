//>>built
define("dojo/_base/declare dojo/_base/array dojo/on dojo/query dojo/_base/lang dojo/dom dojo/dom-construct dojo/dom-geometry dojo/has ../util/misc dojo/_base/html".split(" "),function(E,F,w,r,A,B,p,G,y,m){function C(a,b,c,d,k){for(var f=1;f<b;f++)a[c+f][d]=k}function D(a){for(var b=a.length,c=b,d=F.filter(a[0],function(H){return!H.hidden}).length,k=Array(b);b--;)k[b]=Array(d);var f={};for(b=0;b<c;b++)for(var g=k[b],l=a[b],h=0,x=0;h<d;h++){var e=l[x],t;if("undefined"===typeof g[h]){g[h]=e.id;e.rowSpan&&
1<e.rowSpan&&C(k,e.rowSpan,b,h,e.id);if(0<b&&e.colSpan&&1<e.colSpan)for(t=1;t<e.colSpan;t++)g[++h]=e.id,e.rowSpan&&1<e.rowSpan&&C(k,e.rowSpan,b,h,e.id);f[e.id]=a[0][h].id;x++}}return f}function u(a,b,c,d,k){if(!(0>=c)){var f=a.columns[b];if(f){var g={grid:a,columnId:b,width:c,bubbles:!0,cancelable:!0};d&&(g.parentType=d);if(!a._resizedColumns||w.emit(a.headerNode,"dgrid-columnresize",g))return"auto"===c?delete f.width:(f.width=c,c+="px"),(d=a._columnSizes[b])?d.set("width",c):d=m.addCssRule("#"+m.escapeCssIdentifier(a.domNode.id)+
" .dgrid-column-"+m.escapeCssIdentifier(b,"-"),"width: "+c+";"),a._columnSizes[b]=d,!1!==k&&a.resize(),!0}}}var n,q,z=0,v={create:function(){n=p.create("div",{className:"dgrid-column-resizer"});q=p.create("div",{className:"dgrid-resize-guard"})},destroy:function(){p.destroy(n);p.destroy(q);n=q=null},show:function(a){var b=G.position(a.domNode,!0);n.style.top=b.y+"px";n.style.height=b.h+"px";document.body.appendChild(n);a.domNode.appendChild(q)},move:function(a){n.style.left=a+"px"},hide:function(){n.parentNode.removeChild(n);
q.parentNode.removeChild(q)}};return E(null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments);z||v.create();z++},destroy:function(){this.inherited(arguments);for(var a in this._columnSizes)this._columnSizes[a].remove();--z||v.destroy()},resizeColumnWidth:function(a,b){return u(this,a,b)},configStructure:function(){var a=this._oldColumnSizes=A.mixin({},this._columnSizes),b;this._resizedColumns=!1;this._columnSizes={};this.inherited(arguments);
for(b in a)b in this._columnSizes||a[b].remove();delete this._oldColumnSizes},_configColumn:function(a){this.inherited(arguments);var b=a.id,c;"width"in a&&((c=this._oldColumnSizes[b])?c.set("width",a.width+"px"):c=m.addCssRule("#"+m.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+m.escapeCssIdentifier(b,"-"),"width: "+a.width+"px;"),this._columnSizes[b]=c)},renderHeader:function(){this.inherited(arguments);var a=this;if(this.columnSets&&this.columnSets.length)for(var b=this.columnSets.length;b--;)var c=
A.mixin(c||{},D(this.columnSets[b]));else this.subRows&&1<this.subRows.length&&(c=D(this.subRows));b=r(".dgrid-cell",a.headerNode);for(var d=b.length;d--;){var k=b[d],f=k.columnId,g=a.columns[f],l=k.childNodes;if(g&&!1!==g.resizable){g=p.create("div",{className:"dgrid-resize-header-container"});for(k.contents=g;0<l.length;)g.appendChild(l[0]);l=p.create("div",{className:"dgrid-resize-handle resizeNode-"+m.escapeCssIdentifier(f,"-")},g);k.appendChild(g);l.columnId=c&&c[f]||f}}a.mouseMoveListen||(w(a.headerNode,
".dgrid-resize-handle:mousedown"+(y("touch")?",.dgrid-resize-handle:touchstart":""),function(h){a._resizeMouseDown(h,this);a.mouseMoveListen.resume();a.mouseUpListen.resume()}),a._listeners.push(a.mouseMoveListen=w.pausable(document,"mousemove"+(y("touch")?",touchmove":""),m.throttleDelayed(function(h){a._updateResizerPosition(h)}))),a._listeners.push(a.mouseUpListen=w.pausable(document,"mouseup"+(y("touch")?",touchend":""),function(h){a._resizeMouseUp(h);a.mouseMoveListen.pause();a.mouseUpListen.pause()})),
a.mouseMoveListen.pause(),a.mouseUpListen.pause())},_resizeMouseDown:function(a,b){a.preventDefault();B.setSelectable(this.domNode,!1);this._startX=this._getResizeMouseLocation(a);this._targetCell=r(".dgrid-column-"+m.escapeCssIdentifier(b.columnId,"-"),this.headerNode)[0];this._updateResizerPosition(a);v.show(this)},_resizeMouseUp:function(a){var b=this._columnSizes,c;this.adjustLastColumn&&(c=this.headerNode.clientWidth-1);if(!this._resizedColumns){var d=r(".dgrid-cell",this.headerNode);this.columnSets&&
this.columnSets.length?d=d.filter(function(e){return"0"===e.columnId.split("-")[0]&&!(e.columnId in b)}):this.subRows&&1<this.subRows.length&&(d=d.filter(function(e){return"0"===e.columnId.charAt(0)&&!(e.columnId in b)}));var k=d.map(function(e){return e.offsetWidth});d.forEach(function(e,t){u(this,e.columnId,k[t],null,!1)},this);this._resizedColumns=!0}B.setSelectable(this.domNode,!0);d=this._targetCell;var f=this._getResizeMouseLocation(a)-this._startX,g=d.offsetWidth+f,l=this._getResizedColumnWidths(),
h=l.totalWidth;l=l.lastColId;var x=r(".dgrid-column-"+m.escapeCssIdentifier(l,"-"),this.headerNode)[0].offsetWidth;g<this.minWidth&&(g=this.minWidth);u(this,d.columnId,g,a.type)&&d.columnId!==l&&this.adjustLastColumn&&(h+f<c?u(this,l,"auto",a.type):x-f<=this.minWidth&&u(this,l,this.minWidth,a.type));v.hide();delete this._startX;delete this._targetCell},_updateResizerPosition:function(a){if(this._targetCell){a=this._getResizeMouseLocation(a);var b=this._targetCell.offsetWidth,c=a;b+(a-this._startX)<
this.minWidth&&(c=this._startX-(b-this.minWidth));v.move(c)}},_getResizeMouseLocation:function(a){var b=0;a.pageX?b=a.pageX:a.clientX&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft);return b},_getResizedColumnWidths:function(){var a=0,b=r((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),c=b.length;if(!c)return{};for(var d=b[c-1].columnId;c--;)a+=b[c].offsetWidth;return{totalWidth:a,lastColId:d}}})});
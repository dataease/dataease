//>>built
define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./List ./util/misc dojo/_base/sniff".split(" "),function(p,v,k,w,x,y,D,n){function r(a,b){b&&b.nodeType&&a.appendChild(b)}p=p(D,{columns:null,hasNeutralSort:!1,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!==typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,b){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{if(this._rowIdToObject[a.id])break;
var c=a.columnId;if(c){b=c;var e=a;break}a=a.parentNode}while(a&&a!==this.domNode)}if(!e&&"undefined"!==typeof b){var d=this.row(a);if(c=d&&d.element){c=c.getElementsByTagName("td");for(var f=0;f<c.length;f++)if(c[f].columnId===b){e=c[f];break}}}if(null!=a)return{row:d||this.row(a),column:b&&this.column(b),element:e}},createRowCells:function(a,b,c,e,d){var f=k.create("table",{className:"dgrid-row-table",role:"presentation"}),g=9>y("ie")?k.create("tbody",null,f):f,z,A,B;c=c||this.subRows;var t=0;for(z=
c.length;t<z;t++){var q=c[t];var C=k.create("tr",null,g);q.className&&(C.className=q.className);var u=0;for(A=q.length;u<A;u++){var h=q[u];var m=h.id;var l=h.field?" field-"+n.escapeCssIdentifier(h.field,"-"):"";(B="function"===typeof h.className?h.className(e):h.className)&&(l+=" "+B);l=k.create(a,{className:"dgrid-cell"+(m?" dgrid-column-"+n.escapeCssIdentifier(m,"-"):"")+l,role:"th"===a?"columnheader":"gridcell"});l.columnId=m;if(m=h.colSpan)l.colSpan=m;if(m=h.rowSpan)l.rowSpan=m;b(l,h,e,d);C.appendChild(l)}}return f},
_createBodyRowCell:function(a,b,c,e){var d=c;b.get?d=b.get(c):"field"in b&&"_item"!==b.field&&(d=c[b.field]);b.renderCell?r(a,b.renderCell(c,d,a,e)):this._defaultRenderCell.call(b,c,d,a,e)},_createHeaderRowCell:function(a,b){var c=b.headerNode=a,e=b.field;e&&(a.field=e);b.renderHeaderCell?r(c,b.renderHeaderCell(c)):("label"in b||b.field)&&c.appendChild(document.createTextNode("label"in b?b.label:b.field));!1!==b.sortable&&e&&"_item"!==e&&(a.sortable=!0,a.className+=" dgrid-sortable")},left:function(a,
b){a.element||(a=this.cell(a));return this.cell(this._move(a,-(b||1),"dgrid-cell"))},right:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,b||1,"dgrid-cell"))},_defaultRenderCell:function(a,b,c){if(this.formatter){var e=this.formatter,d=this.grid.formatterScope;a="string"===typeof e&&d?d[e](b,a):this.formatter(b,a);null!=a&&a.hasOwnProperty("html")?c.innerHTML=a.html:null!=a&&c.appendChild(document.createTextNode(a))}else null!=b&&c.appendChild(document.createTextNode(b))},
renderRow:function(a,b){a=this.createRowCells("td",v.hitch(this,"_createBodyRowCell"),b&&b.subRows,a,b);b=k.create("div",{role:"row"});b.appendChild(a);return b},renderHeader:function(){var a=this,b=this.headerNode;b.setAttribute("role","row");k.empty(b);var c=this.createRowCells("th",v.hitch(this,"_createHeaderRowCell"),this.subRows&&this.subRows.headerRows);this._rowIdToObject[c.id=this.id+"-header"]=this.columns;b.appendChild(c);this._sortListener&&this._sortListener.remove();this._sortListener=
x(c,"click,keydown",function(e){if("click"===e.type||32===e.keyCode||!y("opera")&&13===e.keyCode){var d=e.target;do if(d.sortable){var f=d.field||d.columnId;var g=a.sort[0];f=a.hasNeutralSort&&g&&g.property===f&&g.descending?[]:[{property:f,descending:g&&g.property===f&&!g.descending}];g={bubbles:!0,cancelable:!0,grid:a,parentType:e.type,sort:f};x.emit(e.target,"dgrid-sort",g)&&(a._sortNode=d,a.set("sort",f));break}while((d=d.parentNode)&&d!==b)}})},resize:function(){var a=this.headerNode.firstChild,
b=this.contentNode,c;this.inherited(arguments);b.style.width="";b&&a&&(c=a.offsetWidth)>b.offsetWidth&&(b.style.width=c+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(){this.inherited(arguments);this.updateSortArrow(this.sort)},_findSortArrowParent:function(a){var b=this.columns,c;for(c in b){var e=b[c];if(e.field===a)return e.headerNode}},updateSortArrow:function(a,b){this._lastSortedArrow&&(this._lastSortedArrow.parentNode&&
w.remove(this._lastSortedArrow.parentNode,"dgrid-sort-up dgrid-sort-down"),k.destroy(this._lastSortedArrow),delete this._lastSortedArrow);b&&(this.sort=a);a[0]&&(b=a[0].property,a=a[0].descending,b=this._sortNode||this._findSortArrowParent(b),delete this._sortNode,b&&(b=b.contents||b,this._lastSortedArrow=k.create("div",{className:"dgrid-sort-arrow ui-icon",innerHTML:"\x26nbsp;",role:"presentation"},b,"first"),w.add(b,"dgrid-sort-"+(a?"down":"up")),this.resize()))},styleColumn:function(a,b){return this.addCssRule("#"+
n.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+n.escapeCssIdentifier(a,"-"),b)},_configColumns:function(a,b){var c=[],e=b instanceof Array;n.each(b,function(d,f){"string"===typeof d&&(b[f]=d={label:d});e||d.field||(d.field=f);f=d.id=d.id||(isNaN(f)?f:a+f);this._configColumn&&(this._configColumn(d,b,a),f=d.id);e&&(this.columns[f]=d);d.grid?d.grid!==this&&console.warn("Sharing column definition objects with multiple grids is not supported.",d.grid,this):d.grid=this;c.push(d)},this);return e?
b:c},_destroyColumns:function(){this.cleanup()},configStructure:function(){var a=this.subRows,b=this._columns=this.columns;this.columns=!b||b instanceof Array?{}:b;if(a)for(b=0;b<a.length;b++)a[b]=this._configColumns(b+"-",a[b]);else this.subRows=[this._configColumns("",b)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns();this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this._destroyColumns();this.subRows=a;this._updateColumns()},
_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this.sort.length?(this._lastSortedArrow=null,this.updateSortArrow(this.sort)):this.resize())}});p.appendIfNode=r;return p});
/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as e}from"./tslib.es6.js";import"./object.js";import{L as t}from"./Logger.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import{isPromiseLike as s}from"../core/promiseUtils.js";import"./ensureType.js";import{subclass as o}from"../core/accessorSupport/decorators/subclass.js";import i from"../core/Collection.js";import{r as a}from"./collectionUtils.js";import"../core/urlUtils.js";import"./resourceExtension.js";import n from"../layers/Layer.js";function l(e){return e&&"group"===e.type}function d(e,t,r){let s,o;if(e)for(let i=0,a=e.length;i<a;i++){if(s=e.getItemAt(i),s[t]===r)return s;if(l(s)&&(o=d(s.layers,t,r),o))return o}}const p=t.getLogger("esri.support.LayersMixin"),y=t=>{let l=class extends t{constructor(...e){super(...e),this.layers=new i;const t=e=>{e.parent=this,this.layerAdded(e),"elevation"!==e.type&&"base-elevation"!==e.type||p.error(`Layer 'title:${e.title}, id:${e.id}' of type '${e.type}' is not supported as an operational layer and will therefore be ignored.`)},r=e=>{e.parent=null,this.layerRemoved(e)};this.layers.on("before-add",(e=>{var t;(t=e.item).parent&&"remove"in t.parent&&t.parent.remove(t)})),this.layers.on("after-add",(e=>t(e.item))),this.layers.on("after-remove",(e=>r(e.item)))}destroy(){const e=this.layers.removeAll();for(const t of e)this.layerRemoved(t),t.destroy();this.layers.destroy()}set layers(e){this._set("layers",a(e,this._get("layers")))}add(e,t){const r=this.layers;t=r.getNextIndex(t),e instanceof n?e.parent===this?this.reorder(e,t):r.add(e,t):s(e)?e.then((e=>{this.destroyed||this.add(e,t)})):p.error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(e,t){const r=this.layers;t=r.getNextIndex(t),e.slice().forEach((e=>{e.parent!==this?(r.add(e,t),t+=1):this.reorder(e,t)}))}findLayerById(e){return d(this.layers,"id",e)}findLayerByUid(e){return d(this.layers,"uid",e)}remove(e){return this.layers.remove(e)}removeMany(e){return this.layers.removeMany(e)}removeAll(){return this.layers.removeAll()}reorder(e,t){return this.layers.reorder(e,t)}layerAdded(e){}layerRemoved(e){}};return e([r()],l.prototype,"layers",null),l=e([o("esri.support.LayersMixin")],l),l},m=t.getLogger("esri.support.TablesMixin");function h(e){return e&&"group"===e.type}function u(e,t,r){if(e)for(let s=0,o=e.length;s<o;s++){const o=e.getItemAt(s);if(o[t]===r)return o;if(h(o)){const e=u(o.tables,t,r);if(e)return e}}}const c=t=>{let s=class extends t{constructor(...e){super(...e),this.tables=new i,this.tables.on("after-add",(e=>{const t=e.item;t.parent&&t.parent!==this&&"tables"in t.parent&&t.parent.tables.remove(t),t.parent=this,"feature"!==t.type&&m.error(`Layer 'title:${t.title}, id:${t.id}' of type '${t.type}' is not supported as a table and will therefore be ignored.`)})),this.tables.on("after-remove",(e=>{e.item.parent=null}))}destroy(){const e=this.tables.removeAll();for(const t of e)t.destroy();this.tables.destroy()}set tables(e){this._set("tables",a(e,this._get("tables")))}findTableById(e){return u(this.tables,"id",e)}findTableByUid(e){return u(this.tables,"uid",e)}};return e([r()],s.prototype,"tables",null),s=e([o("esri.support.TablesMixin")],s),s};export{y as L,c as T};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import"./tslib.es6.js";import"./ArrayPool.js";import"./object.js";import"./deprecate.js";import"../core/lang.js";import"../config.js";import"./Logger.js";import"./string.js";import"./metadata.js";import"../core/accessorSupport/decorators/property.js";import"../core/Accessor.js";import"./PropertyOrigin.js";import"../core/scheduling.js";import{resolve as t,all as r,reject as e}from"../core/promiseUtils.js";import"./Message.js";import"../core/Error.js";import"./ensureType.js";import"../core/accessorSupport/decorators/subclass.js";import"./JSONSupport.js";import"../core/urlUtils.js";import"../core/accessorSupport/decorators/cast.js";import"./jsonMap.js";import"./enumeration.js";import"./reader.js";import"./writer.js";import"./resourceExtension.js";import"../geometry/SpatialReference.js";import"./locale.js";import"../kernel.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"./Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Extent.js";import"./zmUtils.js";import"../geometry/Multipoint.js";import"../geometry/Polygon.js";import"./extentUtils.js";import"../geometry/Polyline.js";import"./typeUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./domains.js";import"./sizeVariableUtils.js";import"./fieldType.js";import{WhereClause as o}from"../core/sql/WhereClause.js";import"./_commonjsHelpers.js";import"../layers/support/Field.js";import"./OptimizedGeometry.js";import"./featureConversionUtils.js";import"./number3.js";import"./moment.js";import{p as n,z as s,u as i,w as a,x as m,aj as p,U as u}from"./arcadeUtils.js";import"./centroid.js";import"./FeatureSetReader.js";function c(r,e,n,a,c,l){if(1===a.length){if(i(a[0]))return t(p(r,a[0],u(a[1],-1)));if(m(a[0]))return t(p(r,a[0].toArray(),u(a[1],-1)))}else if(2===a.length){if(i(a[0]))return t(p(r,a[0],u(a[1],-1)));if(m(a[0]))return t(p(r,a[0].toArray(),u(a[1],-1)));if(s(a[0]))return a[0].load().then((t=>j(o.create(a[1],t.getFieldsIndex()),l,c).then((t=>a[0].calculateStatistic(r,t,u(a[2],1e3),e.abortSignal)))))}else if(3===a.length&&s(a[0]))return a[0].load().then((t=>j(o.create(a[1],t.getFieldsIndex()),l,c).then((t=>a[0].calculateStatistic(r,t,u(a[2],1e3),e.abortSignal)))));return t(p(r,a,-1))}function j(o,n,s){try{const e=o.getVariables();if(e.length>0){const t=[];for(let r=0;r<e.length;r++){const o={name:e[r]};t.push(n.evaluateIdentifier(s,o))}return r(t).then((t=>{const r={};for(let o=0;o<e.length;o++)r[e[o]]=t[o];return o.parameters=r,o}))}return t(o)}catch(t){return e(t)}}function l(t){"async"===t.mode&&(t.functions.stdev=function(r,e){return t.standardFunctionAsync(r,e,(function(e,o,n){return c("stdev",e,0,n,r,t)}))},t.functions.variance=function(r,e){return t.standardFunctionAsync(r,e,(function(e,o,n){return c("variance",e,0,n,r,t)}))},t.functions.average=function(r,e){return t.standardFunctionAsync(r,e,(function(e,o,n){return c("mean",e,0,n,r,t)}))},t.functions.mean=function(r,e){return t.standardFunctionAsync(r,e,(function(e,o,n){return c("mean",e,0,n,r,t)}))},t.functions.sum=function(r,e){return t.standardFunctionAsync(r,e,(function(e,o,n){return c("sum",e,0,n,r,t)}))},t.functions.min=function(r,e){return t.standardFunctionAsync(r,e,(function(e,o,n){return c("min",e,0,n,r,t)}))},t.functions.max=function(r,e){return t.standardFunctionAsync(r,e,(function(e,o,n){return c("max",e,0,n,r,t)}))},t.functions.count=function(r,e){return t.standardFunctionAsync(r,e,(function(t,r,e){if(n(e,1,1),s(e[0]))return e[0].count(t.abortSignal);if(i(e[0])||a(e[0]))return e[0].length;if(m(e[0]))return e[0].length();throw new Error("Invalid Parameters for Count")}))})}export{l as registerFunctions};

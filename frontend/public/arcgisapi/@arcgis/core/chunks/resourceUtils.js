/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import"./object.js";import"../core/lang.js";import"../config.js";import{g as e,i as t,b as r}from"./Logger.js";import"./string.js";import"../core/promiseUtils.js";import"./Message.js";import a from"../core/Error.js";import{join as o,getPathExtension as s}from"../core/urlUtils.js";import"../kernel.js";import n from"../request.js";async function i(t,r={},a){await t.load(a);const s=o(t.itemUrl,"resources"),{start:n=1,num:i=10,sortOrder:c="asc",sortField:l="created"}=r,u={query:{start:n,num:i,sortOrder:c,sortField:l},signal:e(a,"signal")},p=await t.portal._request(s,u);return{total:p.total,nextStart:p.nextStart,resources:p.resources.map((({created:e,size:r,resource:a})=>({created:new Date(e),size:r,resource:t.resourceFromPath(a)})))}}async function c(r,s,n,i){if(!r.hasPath())throw new a(`portal-item-resource-${s}:invalid-path`,"Resource does not have a valid path");await r.portalItem.load(i);const c=o(r.portalItem.userItemUrl,"add"===s?"addResources":"updateResources"),[l,u]=p(r.path),m=await d(n),h=new FormData;return l&&"."!==l&&h.append("resourcesPrefix",l),h.append("fileName",u),h.append("file",m,u),h.append("f","json"),t(i)&&i.access&&h.append("access",i.access),await r.portalItem.portal._request(c,{method:"post",body:h,signal:e(i,"signal")}),r}async function l(t,r,s){if(!r.hasPath())throw new a("portal-item-resources-remove:invalid-path","Resource does not have a valid path");await t.load(s);const n=o(t.userItemUrl,"removeResources");await t.portal._request(n,{method:"post",query:{resource:r.path},signal:e(s,"signal")}),r.portalItem=null}async function u(t,r){await t.load(r);const a=o(t.userItemUrl,"removeResources");return t.portal._request(a,{method:"post",query:{deleteAll:!0},signal:e(r,"signal")})}function p(e){const t=e.lastIndexOf("/");return-1===t?[".",e]:[e.slice(0,t),e.slice(t+1)]}function m(e){const[t,a]=function(e){const t=s(e);if(r(t))return[e,""];return[e.slice(0,e.length-t.length-1),`.${t}`]}(e),[o,n]=p(t);return[o,n,a]}async function d(e){if(e instanceof Blob)return e;return(await n(e.url,{responseType:"blob"})).data}function h(e,t){if(!e.hasPath())return null;const[r,,a]=m(e.path);return e.portalItem.resourceFromPath(o(r,t+a))}function f(e,t){if(!e.hasPath())return null;const[r,,a]=m(e.path);return e.portalItem.resourceFromPath(o(r,t+a))}export{c as addOrUpdateResource,d as contentToBlob,i as fetchResources,h as getSiblingOfSameType,f as getSiblingOfSameTypeI,u as removeAllResources,l as removeResource,m as splitPrefixFileNameAndExtension};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{L as e}from"./Logger.js";import{c as t}from"./_commonjsHelpers.js";import{j as s}from"./definitions.js";import{b as i}from"./GeometryUtils2.js";class n{constructor(e,t){this.x=e,this.y=t}clone(){return new n(this.x,this.y)}equals(e,t){return e===this.x&&t===this.y}isEqual(e){return e.x===this.x&&e.y===this.y}setCoords(e,t){this.x=e,this.y=t}normalize(){const e=this.x,t=this.y,s=Math.sqrt(e*e+t*t);this.x/=s,this.y/=s}rightPerpendicular(){const e=this.x;this.x=this.y,this.y=-e}move(e,t){this.x+=e,this.y+=t}assign(e){this.x=e.x,this.y=e.y}assignAdd(e,t){this.x=e.x+t.x,this.y=e.y+t.y}assignSub(e,t){this.x=e.x-t.x,this.y=e.y-t.y}rotate(e,t){const s=this.x,i=this.y;this.x=s*e-i*t,this.y=s*t+i*e}scale(e){this.x*=e,this.y*=e}length(){const e=this.x,t=this.y;return Math.sqrt(e*e+t*t)}static distance(e,t){const s=t.x-e.x,i=t.y-e.y;return Math.sqrt(s*s+i*i)}static add(e,t){return new n(e.x+t.x,e.y+t.y)}static sub(e,t){return new n(e.x-t.x,e.y-t.y)}}var r=t((function(e){var t;void 0!==(t=function(){var e={DEBUG:!1,assert:function(t,s){if(e.DEBUG&&!t)throw new Error("Assertion failed"+(s?": "+s:""))},GLU_TESS_MAX_COORD:1e150,TRUE_PROJECT:!1,GLU_TESS_DEFAULT_TOLERANCE:0,windingRule:{GLU_TESS_WINDING_ODD:100130,GLU_TESS_WINDING_NONZERO:100131,GLU_TESS_WINDING_POSITIVE:100132,GLU_TESS_WINDING_NEGATIVE:100133,GLU_TESS_WINDING_ABS_GEQ_TWO:100134},primitiveType:{GL_LINE_LOOP:2,GL_TRIANGLES:4,GL_TRIANGLE_STRIP:5,GL_TRIANGLE_FAN:6},errorType:{GLU_TESS_MISSING_BEGIN_POLYGON:100151,GLU_TESS_MISSING_END_POLYGON:100153,GLU_TESS_MISSING_BEGIN_CONTOUR:100152,GLU_TESS_MISSING_END_CONTOUR:100154,GLU_TESS_COORD_TOO_LARGE:100155,GLU_TESS_NEED_COMBINE_CALLBACK:100156},gluEnum:{GLU_TESS_BEGIN:100100,GLU_TESS_VERTEX:100101,GLU_TESS_END:100102,GLU_TESS_ERROR:100103,GLU_TESS_EDGE_FLAG:100104,GLU_TESS_COMBINE:100105,GLU_TESS_BEGIN_DATA:100106,GLU_TESS_VERTEX_DATA:100107,GLU_TESS_END_DATA:100108,GLU_TESS_ERROR_DATA:100109,GLU_TESS_EDGE_FLAG_DATA:100110,GLU_TESS_COMBINE_DATA:100111,GLU_TESS_MESH:100112,GLU_TESS_TOLERANCE:100142,GLU_TESS_WINDING_RULE:100140,GLU_TESS_BOUNDARY_ONLY:100141,GLU_INVALID_ENUM:100900,GLU_INVALID_VALUE:100901},geom:{}};return e.geom.vertEq=function(e,t){return e.s===t.s&&e.t===t.t},e.geom.vertLeq=function(e,t){return e.s<t.s||e.s===t.s&&e.t<=t.t},e.geom.edgeEval=function(t,s,i){e.assert(e.geom.vertLeq(t,s)&&e.geom.vertLeq(s,i));var n=s.s-t.s,r=i.s-s.s;return n+r>0?n<r?s.t-t.t+(t.t-i.t)*(n/(n+r)):s.t-i.t+(i.t-t.t)*(r/(n+r)):0},e.geom.edgeSign=function(t,s,i){e.assert(e.geom.vertLeq(t,s)&&e.geom.vertLeq(s,i));var n=s.s-t.s,r=i.s-s.s;return n+r>0?(s.t-i.t)*n+(s.t-t.t)*r:0},e.geom.transLeq=function(e,t){return e.t<t.t||e.t===t.t&&e.s<=t.s},e.geom.transEval=function(t,s,i){e.assert(e.geom.transLeq(t,s)&&e.geom.transLeq(s,i));var n=s.t-t.t,r=i.t-s.t;return n+r>0?n<r?s.s-t.s+(t.s-i.s)*(n/(n+r)):s.s-i.s+(i.s-t.s)*(r/(n+r)):0},e.geom.transSign=function(t,s,i){e.assert(e.geom.transLeq(t,s)&&e.geom.transLeq(s,i));var n=s.t-t.t,r=i.t-s.t;return n+r>0?(s.s-i.s)*n+(s.s-t.s)*r:0},e.geom.edgeGoesLeft=function(t){return e.geom.vertLeq(t.dst(),t.org)},e.geom.edgeGoesRight=function(t){return e.geom.vertLeq(t.org,t.dst())},e.geom.vertL1dist=function(e,t){return Math.abs(e.s-t.s)+Math.abs(e.t-t.t)},e.geom.vertCCW=function(e,t,s){return e.s*(t.t-s.t)+t.s*(s.t-e.t)+s.s*(e.t-t.t)>=0},e.geom.interpolate_=function(e,t,s,i){return(e=e<0?0:e)<=(s=s<0?0:s)?0===s?(t+i)/2:t+e/(e+s)*(i-t):i+s/(e+s)*(t-i)},e.geom.edgeIntersect=function(t,s,i,n,r){var o,l,a;e.geom.vertLeq(t,s)||(a=t,t=s,s=a),e.geom.vertLeq(i,n)||(a=i,i=n,n=a),e.geom.vertLeq(t,i)||(a=t,t=i,i=a,a=s,s=n,n=a),e.geom.vertLeq(i,s)?e.geom.vertLeq(s,n)?((o=e.geom.edgeEval(t,i,s))+(l=e.geom.edgeEval(i,s,n))<0&&(o=-o,l=-l),r.s=e.geom.interpolate_(o,i.s,l,s.s)):((o=e.geom.edgeSign(t,i,s))+(l=-e.geom.edgeSign(t,n,s))<0&&(o=-o,l=-l),r.s=e.geom.interpolate_(o,i.s,l,n.s)):r.s=(i.s+s.s)/2,e.geom.transLeq(t,s)||(a=t,t=s,s=a),e.geom.transLeq(i,n)||(a=i,i=n,n=a),e.geom.transLeq(t,i)||(a=t,t=i,i=a,a=s,s=n,n=a),e.geom.transLeq(i,s)?e.geom.transLeq(s,n)?((o=e.geom.transEval(t,i,s))+(l=e.geom.transEval(i,s,n))<0&&(o=-o,l=-l),r.t=e.geom.interpolate_(o,i.t,l,s.t)):((o=e.geom.transSign(t,i,s))+(l=-e.geom.transSign(t,n,s))<0&&(o=-o,l=-l),r.t=e.geom.interpolate_(o,i.t,l,n.t)):r.t=(i.t+s.t)/2},e.mesh={},e.mesh.makeEdge=function(t){var s=e.mesh.makeEdgePair_(t.eHead);return e.mesh.makeVertex_(s,t.vHead),e.mesh.makeVertex_(s.sym,t.vHead),e.mesh.makeFace_(s,t.fHead),s},e.mesh.meshSplice=function(t,s){var i=!1,n=!1;t!==s&&(s.org!==t.org&&(n=!0,e.mesh.killVertex_(s.org,t.org)),s.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(s.lFace,t.lFace)),e.mesh.splice_(s,t),n||(e.mesh.makeVertex_(s,t.org),t.org.anEdge=t),i||(e.mesh.makeFace_(s,t.lFace),t.lFace.anEdge=t))},e.mesh.deleteEdge=function(t){var s=t.sym,i=!1;t.lFace!==t.rFace()&&(i=!0,e.mesh.killFace_(t.lFace,t.rFace())),t.oNext===t?e.mesh.killVertex_(t.org,null):(t.rFace().anEdge=t.oPrev(),t.org.anEdge=t.oNext,e.mesh.splice_(t,t.oPrev()),i||e.mesh.makeFace_(t,t.lFace)),s.oNext===s?(e.mesh.killVertex_(s.org,null),e.mesh.killFace_(s.lFace,null)):(t.lFace.anEdge=s.oPrev(),s.org.anEdge=s.oNext,e.mesh.splice_(s,s.oPrev())),e.mesh.killEdge_(t)},e.mesh.addEdgeVertex=function(t){var s=e.mesh.makeEdgePair_(t),i=s.sym;return e.mesh.splice_(s,t.lNext),s.org=t.dst(),e.mesh.makeVertex_(i,s.org),s.lFace=i.lFace=t.lFace,s},e.mesh.splitEdge=function(t){var s=e.mesh.addEdgeVertex(t).sym;return e.mesh.splice_(t.sym,t.sym.oPrev()),e.mesh.splice_(t.sym,s),t.sym.org=s.org,s.dst().anEdge=s.sym,s.sym.lFace=t.rFace(),s.winding=t.winding,s.sym.winding=t.sym.winding,s},e.mesh.connect=function(t,s){var i=!1,n=e.mesh.makeEdgePair_(t),r=n.sym;return s.lFace!==t.lFace&&(i=!0,e.mesh.killFace_(s.lFace,t.lFace)),e.mesh.splice_(n,t.lNext),e.mesh.splice_(r,s),n.org=t.dst(),r.org=s.org,n.lFace=r.lFace=t.lFace,t.lFace.anEdge=r,i||e.mesh.makeFace_(n,t.lFace),n},e.mesh.zapFace=function(t){var s,i=t.anEdge,n=i.lNext;do{if(n=(s=n).lNext,s.lFace=null,null===s.rFace()){s.oNext===s?e.mesh.killVertex_(s.org,null):(s.org.anEdge=s.oNext,e.mesh.splice_(s,s.oPrev()));var r=s.sym;r.oNext===r?e.mesh.killVertex_(r.org,null):(r.org.anEdge=r.oNext,e.mesh.splice_(r,r.oPrev())),e.mesh.killEdge_(s)}}while(s!==i);var o=t.prev,l=t.next;l.prev=o,o.next=l},e.mesh.meshUnion=function(e,t){var s=e.fHead,i=e.vHead,n=e.eHead,r=t.fHead,o=t.vHead,l=t.eHead;return r.next!==r&&(s.prev.next=r.next,r.next.prev=s.prev,r.prev.next=s,s.prev=r.prev),o.next!==o&&(i.prev.next=o.next,o.next.prev=i.prev,o.prev.next=i,i.prev=o.prev),l.next!==l&&(n.sym.next.sym.next=l.next,l.next.sym.next=n.sym.next,l.sym.next.sym.next=n,n.sym.next=l.sym.next),e},e.mesh.deleteMesh=function(e){},e.mesh.makeEdgePair_=function(t){var s=new e.GluHalfEdge,i=new e.GluHalfEdge,n=t.sym.next;return i.next=n,n.sym.next=s,s.next=t,t.sym.next=i,s.sym=i,s.oNext=s,s.lNext=i,i.sym=s,i.oNext=i,i.lNext=s,s},e.mesh.splice_=function(e,t){var s=e.oNext,i=t.oNext;s.sym.lNext=t,i.sym.lNext=e,e.oNext=i,t.oNext=s},e.mesh.makeVertex_=function(t,s){var i=s.prev,n=new e.GluVertex(s,i);i.next=n,s.prev=n,n.anEdge=t;var r=t;do{r.org=n,r=r.oNext}while(r!==t)},e.mesh.makeFace_=function(t,s){var i=s.prev,n=new e.GluFace(s,i);i.next=n,s.prev=n,n.anEdge=t,n.inside=s.inside;var r=t;do{r.lFace=n,r=r.lNext}while(r!==t)},e.mesh.killEdge_=function(e){var t=e.next,s=e.sym.next;t.sym.next=s,s.sym.next=t},e.mesh.killVertex_=function(e,t){var s=e.anEdge,i=s;do{i.org=t,i=i.oNext}while(i!==s);var n=e.prev,r=e.next;r.prev=n,n.next=r},e.mesh.killFace_=function(e,t){var s=e.anEdge,i=s;do{i.lFace=t,i=i.lNext}while(i!==s);var n=e.prev,r=e.next;r.prev=n,n.next=r},e.normal={},e.normal.S_UNIT_X_=1,e.normal.S_UNIT_Y_=0,e.normal.projectPolygon=function(t,s,i,n){var r=!1,o=[s,i,n];0===s&&0===i&&0===n&&(e.normal.computeNormal_(t,o),r=!0);var l,a=e.normal.longAxis_(o),h=t.mesh.vHead;if(e.TRUE_PROJECT){e.normal.normalize_(o);var _=[0,0,0],g=[0,0,0];_[a]=0,_[(a+1)%3]=e.normal.S_UNIT_X_,_[(a+2)%3]=e.normal.S_UNIT_Y_;var d=e.normal.dot_(_,o);for(_[0]-=d*o[0],_[1]-=d*o[1],_[2]-=d*o[2],e.normal.normalize_(_),g[0]=o[1]*_[2]-o[2]*_[1],g[1]=o[2]*_[0]-o[0]*_[2],g[2]=o[0]*_[1]-o[1]*_[0],e.normal.normalize_(g),l=h.next;l!==h;l=l.next)l.s=e.normal.dot_(l.coords,_),l.t=e.normal.dot_(l.coords,g)}else{var u=(a+1)%3,c=(a+2)%3,m=o[a]>0?1:-1;for(l=h.next;l!==h;l=l.next)l.s=l.coords[u],l.t=m*l.coords[c]}r&&e.normal.checkOrientation_(t)},e.normal.dot_=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},e.normal.normalize_=function(t){var s=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];e.assert(s>0),s=Math.sqrt(s),t[0]/=s,t[1]/=s,t[2]/=s},e.normal.longAxis_=function(e){var t=0;return Math.abs(e[1])>Math.abs(e[0])&&(t=1),Math.abs(e[2])>Math.abs(e[t])&&(t=2),t},e.normal.computeNormal_=function(t,s){var i,n=[-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD,-2*e.GLU_TESS_MAX_COORD],r=[2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD,2*e.GLU_TESS_MAX_COORD],o=[],l=[],a=t.mesh.vHead;for(i=a.next;i!==a;i=i.next)for(var h=0;h<3;++h){var _=i.coords[h];_<r[h]&&(r[h]=_,l[h]=i),_>n[h]&&(n[h]=_,o[h]=i)}var g=0;if(n[1]-r[1]>n[0]-r[0]&&(g=1),n[2]-r[2]>n[g]-r[g]&&(g=2),r[g]>=n[g])return s[0]=0,s[1]=0,void(s[2]=1);var d=0,u=l[g],c=o[g],m=[0,0,0],p=[u.coords[0]-c.coords[0],u.coords[1]-c.coords[1],u.coords[2]-c.coords[2]],x=[0,0,0];for(i=a.next;i!==a;i=i.next){x[0]=i.coords[0]-c.coords[0],x[1]=i.coords[1]-c.coords[1],x[2]=i.coords[2]-c.coords[2],m[0]=p[1]*x[2]-p[2]*x[1],m[1]=p[2]*x[0]-p[0]*x[2],m[2]=p[0]*x[1]-p[1]*x[0];var E=m[0]*m[0]+m[1]*m[1]+m[2]*m[2];E>d&&(d=E,s[0]=m[0],s[1]=m[1],s[2]=m[2])}d<=0&&(s[0]=s[1]=s[2]=0,s[e.normal.longAxis_(p)]=1)},e.normal.checkOrientation_=function(e){for(var t=0,s=e.mesh.fHead,i=s.next;i!==s;i=i.next){var n=i.anEdge;if(!(n.winding<=0))do{t+=(n.org.s-n.dst().s)*(n.org.t+n.dst().t),n=n.lNext}while(n!==i.anEdge)}if(t<0)for(var r=e.mesh.vHead,o=r.next;o!==r;o=o.next)o.t=-o.t},e.render={},e.render.renderMesh=function(t,s,i){for(var n=!1,r=-1,o=s.fHead.prev;o!==s.fHead;o=o.prev)if(o.inside){n||(t.callBeginCallback(e.primitiveType.GL_TRIANGLES),n=!0);var l=o.anEdge;e.assert(l.lNext.lNext.lNext===l,"renderMesh called with non-triangulated mesh");do{if(i){var a=l.rFace().inside?0:1;r!==a&&(r=a,t.callEdgeFlagCallback(!!r))}t.callVertexCallback(l.org.data),l=l.lNext}while(l!==o.anEdge)}n&&t.callEndCallback()},e.render.renderBoundary=function(t,s){for(var i=s.fHead.next;i!==s.fHead;i=i.next)if(i.inside){t.callBeginCallback(e.primitiveType.GL_LINE_LOOP);var n=i.anEdge;do{t.callVertexCallback(n.org.data),n=n.lNext}while(n!==i.anEdge);t.callEndCallback()}},e.sweep={},e.sweep.SENTINEL_COORD_=4*e.GLU_TESS_MAX_COORD,e.sweep.TOLERANCE_NONZERO_=!1,e.sweep.computeInterior=function(t){var s;for(t.fatalError=!1,e.sweep.removeDegenerateEdges_(t),e.sweep.initPriorityQ_(t),e.sweep.initEdgeDict_(t);null!==(s=t.pq.extractMin());){for(;;){var i=t.pq.minimum();if(null===i||!e.geom.vertEq(i,s))break;i=t.pq.extractMin(),e.sweep.spliceMergeVertices_(t,s.anEdge,i.anEdge)}e.sweep.sweepEvent_(t,s)}var n=t.dict.getMin().getKey();t.event=n.eUp.org,e.sweep.doneEdgeDict_(t),e.sweep.donePriorityQ_(t),e.sweep.removeDegenerateFaces_(t.mesh),t.mesh.checkMesh()},e.sweep.addWinding_=function(e,t){e.winding+=t.winding,e.sym.winding+=t.sym.winding},e.sweep.edgeLeq_=function(t,s,i){var n=t.event,r=s.eUp,o=i.eUp;return r.dst()===n?o.dst()===n?e.geom.vertLeq(r.org,o.org)?e.geom.edgeSign(o.dst(),r.org,o.org)<=0:e.geom.edgeSign(r.dst(),o.org,r.org)>=0:e.geom.edgeSign(o.dst(),n,o.org)<=0:o.dst()===n?e.geom.edgeSign(r.dst(),n,r.org)>=0:e.geom.edgeEval(r.dst(),n,r.org)>=e.geom.edgeEval(o.dst(),n,o.org)},e.sweep.deleteRegion_=function(t,s){s.fixUpperEdge&&e.assert(0===s.eUp.winding),s.eUp.activeRegion=null,t.dict.deleteNode(s.nodeUp),s.nodeUp=null},e.sweep.fixUpperEdge_=function(t,s){e.assert(t.fixUpperEdge),e.mesh.deleteEdge(t.eUp),t.fixUpperEdge=!1,t.eUp=s,s.activeRegion=t},e.sweep.topLeftRegion_=function(t){var s=t.eUp.org;do{t=t.regionAbove()}while(t.eUp.org===s);if(t.fixUpperEdge){var i=e.mesh.connect(t.regionBelow().eUp.sym,t.eUp.lNext);e.sweep.fixUpperEdge_(t,i),t=t.regionAbove()}return t},e.sweep.topRightRegion_=function(e){var t=e.eUp.dst();do{e=e.regionAbove()}while(e.eUp.dst()===t);return e},e.sweep.addRegionBelow_=function(t,s,i){var n=new e.ActiveRegion;return n.eUp=i,n.nodeUp=t.dict.insertBefore(s.nodeUp,n),i.activeRegion=n,n},e.sweep.isWindingInside_=function(t,s){switch(t.windingRule){case e.windingRule.GLU_TESS_WINDING_ODD:return 0!=(1&s);case e.windingRule.GLU_TESS_WINDING_NONZERO:return 0!==s;case e.windingRule.GLU_TESS_WINDING_POSITIVE:return s>0;case e.windingRule.GLU_TESS_WINDING_NEGATIVE:return s<0;case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return s>=2||s<=-2}return e.assert(!1),!1},e.sweep.computeWinding_=function(t,s){s.windingNumber=s.regionAbove().windingNumber+s.eUp.winding,s.inside=e.sweep.isWindingInside_(t,s.windingNumber)},e.sweep.finishRegion_=function(t,s){var i=s.eUp,n=i.lFace;n.inside=s.inside,n.anEdge=i,e.sweep.deleteRegion_(t,s)},e.sweep.finishLeftRegions_=function(t,s,i){for(var n=s,r=s.eUp;n!==i;){n.fixUpperEdge=!1;var o=n.regionBelow(),l=o.eUp;if(l.org!==r.org){if(!o.fixUpperEdge){e.sweep.finishRegion_(t,n);break}l=e.mesh.connect(r.lPrev(),l.sym),e.sweep.fixUpperEdge_(o,l)}r.oNext!==l&&(e.mesh.meshSplice(l.oPrev(),l),e.mesh.meshSplice(r,l)),e.sweep.finishRegion_(t,n),r=o.eUp,n=o}return r},e.sweep.addRightEdges_=function(t,s,i,n,r,o){var l=!0,a=i;do{e.assert(e.geom.vertLeq(a.org,a.dst())),e.sweep.addRegionBelow_(t,s,a.sym),a=a.oNext}while(a!==n);null===r&&(r=s.regionBelow().eUp.rPrev());for(var h,_=s,g=r;(a=(h=_.regionBelow()).eUp.sym).org===g.org;)a.oNext!==g&&(e.mesh.meshSplice(a.oPrev(),a),e.mesh.meshSplice(g.oPrev(),a)),h.windingNumber=_.windingNumber-a.winding,h.inside=e.sweep.isWindingInside_(t,h.windingNumber),_.dirty=!0,!l&&e.sweep.checkForRightSplice_(t,_)&&(e.sweep.addWinding_(a,g),e.sweep.deleteRegion_(t,_),e.mesh.deleteEdge(g)),l=!1,_=h,g=a;_.dirty=!0,e.assert(_.windingNumber-a.winding===h.windingNumber),o&&e.sweep.walkDirtyRegions_(t,_)},e.sweep.callCombine_=function(t,s,i,n,r){var o=[s.coords[0],s.coords[1],s.coords[2]];s.data=null,s.data=t.callCombineCallback(o,i,n),null===s.data&&(r?t.fatalError||(t.callErrorCallback(e.errorType.GLU_TESS_NEED_COMBINE_CALLBACK),t.fatalError=!0):s.data=i[0])},e.sweep.spliceMergeVertices_=function(t,s,i){var n=[null,null,null,null],r=[.5,.5,0,0];n[0]=s.org.data,n[1]=i.org.data,e.sweep.callCombine_(t,s.org,n,r,!1),e.mesh.meshSplice(s,i)},e.sweep.vertexWeights_=function(t,s,i,n,r){var o=e.geom.vertL1dist(s,t),l=e.geom.vertL1dist(i,t),a=r,h=r+1;n[a]=.5*l/(o+l),n[h]=.5*o/(o+l),t.coords[0]+=n[a]*s.coords[0]+n[h]*i.coords[0],t.coords[1]+=n[a]*s.coords[1]+n[h]*i.coords[1],t.coords[2]+=n[a]*s.coords[2]+n[h]*i.coords[2]},e.sweep.getIntersectData_=function(t,s,i,n,r,o){var l=[0,0,0,0],a=[i.data,n.data,r.data,o.data];s.coords[0]=s.coords[1]=s.coords[2]=0,e.sweep.vertexWeights_(s,i,n,l,0),e.sweep.vertexWeights_(s,r,o,l,2),e.sweep.callCombine_(t,s,a,l,!0)},e.sweep.checkForRightSplice_=function(t,s){var i=s.regionBelow(),n=s.eUp,r=i.eUp;if(e.geom.vertLeq(n.org,r.org)){if(e.geom.edgeSign(r.dst(),n.org,r.org)>0)return!1;e.geom.vertEq(n.org,r.org)?n.org!==r.org&&(t.pq.remove(n.org.pqHandle),e.sweep.spliceMergeVertices_(t,r.oPrev(),n)):(e.mesh.splitEdge(r.sym),e.mesh.meshSplice(n,r.oPrev()),s.dirty=i.dirty=!0)}else{if(e.geom.edgeSign(n.dst(),r.org,n.org)<0)return!1;s.regionAbove().dirty=s.dirty=!0,e.mesh.splitEdge(n.sym),e.mesh.meshSplice(r.oPrev(),n)}return!0},e.sweep.checkForLeftSplice_=function(t,s){var i,n=s.regionBelow(),r=s.eUp,o=n.eUp;if(e.assert(!e.geom.vertEq(r.dst(),o.dst())),e.geom.vertLeq(r.dst(),o.dst())){if(e.geom.edgeSign(r.dst(),o.dst(),r.org)<0)return!1;s.regionAbove().dirty=s.dirty=!0,i=e.mesh.splitEdge(r),e.mesh.meshSplice(o.sym,i),i.lFace.inside=s.inside}else{if(e.geom.edgeSign(o.dst(),r.dst(),o.org)>0)return!1;s.dirty=n.dirty=!0,i=e.mesh.splitEdge(o),e.mesh.meshSplice(r.lNext,o.sym),i.rFace().inside=s.inside}return!0},e.sweep.checkForIntersect_=function(t,s){var i=s.regionBelow(),n=s.eUp,r=i.eUp,o=n.org,l=r.org,a=n.dst(),h=r.dst(),_=new e.GluVertex;if(e.assert(!e.geom.vertEq(h,a)),e.assert(e.geom.edgeSign(a,t.event,o)<=0),e.assert(e.geom.edgeSign(h,t.event,l)>=0),e.assert(o!==t.event&&l!==t.event),e.assert(!s.fixUpperEdge&&!i.fixUpperEdge),o===l)return!1;if(Math.min(o.t,a.t)>Math.max(l.t,h.t))return!1;if(e.geom.vertLeq(o,l)){if(e.geom.edgeSign(h,o,l)>0)return!1}else if(e.geom.edgeSign(a,l,o)<0)return!1;e.geom.edgeIntersect(a,o,h,l,_),e.assert(Math.min(o.t,a.t)<=_.t),e.assert(_.t<=Math.max(l.t,h.t)),e.assert(Math.min(h.s,a.s)<=_.s),e.assert(_.s<=Math.max(l.s,o.s)),e.geom.vertLeq(_,t.event)&&(_.s=t.event.s,_.t=t.event.t);var g=e.geom.vertLeq(o,l)?o:l;if(e.geom.vertLeq(g,_)&&(_.s=g.s,_.t=g.t),e.geom.vertEq(_,o)||e.geom.vertEq(_,l))return e.sweep.checkForRightSplice_(t,s),!1;if(!e.geom.vertEq(a,t.event)&&e.geom.edgeSign(a,t.event,_)>=0||!e.geom.vertEq(h,t.event)&&e.geom.edgeSign(h,t.event,_)<=0){if(h===t.event)return e.mesh.splitEdge(n.sym),e.mesh.meshSplice(r.sym,n),n=(s=e.sweep.topLeftRegion_(s)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,s.regionBelow(),i),e.sweep.addRightEdges_(t,s,n.oPrev(),n,n,!0),!0;if(a===t.event){e.mesh.splitEdge(r.sym),e.mesh.meshSplice(n.lNext,r.oPrev()),i=s;var d=(s=e.sweep.topRightRegion_(s)).regionBelow().eUp.rPrev();return i.eUp=r.oPrev(),r=e.sweep.finishLeftRegions_(t,i,null),e.sweep.addRightEdges_(t,s,r.oNext,n.rPrev(),d,!0),!0}return e.geom.edgeSign(a,t.event,_)>=0&&(s.regionAbove().dirty=s.dirty=!0,e.mesh.splitEdge(n.sym),n.org.s=t.event.s,n.org.t=t.event.t),e.geom.edgeSign(h,t.event,_)<=0&&(s.dirty=i.dirty=!0,e.mesh.splitEdge(r.sym),r.org.s=t.event.s,r.org.t=t.event.t),!1}return e.mesh.splitEdge(n.sym),e.mesh.splitEdge(r.sym),e.mesh.meshSplice(r.oPrev(),n),n.org.s=_.s,n.org.t=_.t,n.org.pqHandle=t.pq.insert(n.org),e.sweep.getIntersectData_(t,n.org,o,a,l,h),s.regionAbove().dirty=s.dirty=i.dirty=!0,!1},e.sweep.walkDirtyRegions_=function(t,s){for(var i=s.regionBelow();;){for(;i.dirty;)s=i,i=i.regionBelow();if(!s.dirty&&(i=s,null===(s=s.regionAbove())||!s.dirty))return;s.dirty=!1;var n=s.eUp,r=i.eUp;if(n.dst()!==r.dst()&&e.sweep.checkForLeftSplice_(t,s)&&(i.fixUpperEdge?(e.sweep.deleteRegion_(t,i),e.mesh.deleteEdge(r),r=(i=s.regionBelow()).eUp):s.fixUpperEdge&&(e.sweep.deleteRegion_(t,s),e.mesh.deleteEdge(n),n=(s=i.regionAbove()).eUp)),n.org!==r.org)if(n.dst()===r.dst()||s.fixUpperEdge||i.fixUpperEdge||n.dst()!==t.event&&r.dst()!==t.event)e.sweep.checkForRightSplice_(t,s);else if(e.sweep.checkForIntersect_(t,s))return;n.org===r.org&&n.dst()===r.dst()&&(e.sweep.addWinding_(r,n),e.sweep.deleteRegion_(t,s),e.mesh.deleteEdge(n),s=i.regionAbove())}},e.sweep.connectRightVertex_=function(t,s,i){var n,r=i.oNext,o=s.regionBelow(),l=s.eUp,a=o.eUp,h=!1;l.dst()!==a.dst()&&e.sweep.checkForIntersect_(t,s),e.geom.vertEq(l.org,t.event)&&(e.mesh.meshSplice(r.oPrev(),l),r=(s=e.sweep.topLeftRegion_(s)).regionBelow().eUp,e.sweep.finishLeftRegions_(t,s.regionBelow(),o),h=!0),e.geom.vertEq(a.org,t.event)&&(e.mesh.meshSplice(i,a.oPrev()),i=e.sweep.finishLeftRegions_(t,o,null),h=!0),h?e.sweep.addRightEdges_(t,s,i.oNext,r,r,!0):(n=e.geom.vertLeq(a.org,l.org)?a.oPrev():l,n=e.mesh.connect(i.lPrev(),n),e.sweep.addRightEdges_(t,s,n,n.oNext,n.oNext,!1),n.sym.activeRegion.fixUpperEdge=!0,e.sweep.walkDirtyRegions_(t,s))},e.sweep.connectLeftDegenerate_=function(t,s,i){var n=s.eUp;if(e.geom.vertEq(n.org,i))return e.assert(e.sweep.TOLERANCE_NONZERO_),void(e.sweep.TOLERANCE_NONZERO_&&e.sweep.spliceMergeVertices_(t,n,i.anEdge));if(!e.geom.vertEq(n.dst(),i))return e.mesh.splitEdge(n.sym),s.fixUpperEdge&&(e.mesh.deleteEdge(n.oNext),s.fixUpperEdge=!1),e.mesh.meshSplice(i.anEdge,n),void e.sweep.sweepEvent_(t,i);if(e.assert(e.sweep.TOLERANCE_NONZERO_),e.sweep.TOLERANCE_NONZERO_){var r=(s=e.sweep.topRightRegion_(s)).regionBelow(),o=r.eUp.sym,l=o.oNext,a=l;r.fixUpperEdge&&(e.assert(l!==o),e.sweep.deleteRegion_(t,r),e.mesh.deleteEdge(o),o=l.oPrev()),e.mesh.meshSplice(i.anEdge,o),e.geom.edgeGoesLeft(l)||(l=null),e.sweep.addRightEdges_(t,s,o.oNext,a,l,!0)}},e.sweep.connectLeftVertex_=function(t,s){var i=new e.ActiveRegion;i.eUp=s.anEdge.sym;var n=t.dict.search(i).getKey(),r=n.regionBelow(),o=n.eUp,l=r.eUp;if(0!==e.geom.edgeSign(o.dst(),s,o.org)){var a,h=e.geom.vertLeq(l.dst(),o.dst())?n:r;n.inside||h.fixUpperEdge?(a=h===n?e.mesh.connect(s.anEdge.sym,o.lNext):e.mesh.connect(l.dNext(),s.anEdge).sym,h.fixUpperEdge?e.sweep.fixUpperEdge_(h,a):e.sweep.computeWinding_(t,e.sweep.addRegionBelow_(t,n,a)),e.sweep.sweepEvent_(t,s)):e.sweep.addRightEdges_(t,n,s.anEdge,s.anEdge,null,!0)}else e.sweep.connectLeftDegenerate_(t,n,s)},e.sweep.sweepEvent_=function(t,s){t.event=s;for(var i=s.anEdge;null===i.activeRegion;)if((i=i.oNext)===s.anEdge)return void e.sweep.connectLeftVertex_(t,s);var n=e.sweep.topLeftRegion_(i.activeRegion),r=n.regionBelow(),o=r.eUp,l=e.sweep.finishLeftRegions_(t,r,null);l.oNext===o?e.sweep.connectRightVertex_(t,n,l):e.sweep.addRightEdges_(t,n,l.oNext,o,o,!0)},e.sweep.addSentinel_=function(t,s){var i=new e.ActiveRegion,n=e.mesh.makeEdge(t.mesh);n.org.s=e.sweep.SENTINEL_COORD_,n.org.t=s,n.dst().s=-e.sweep.SENTINEL_COORD_,n.dst().t=s,t.event=n.dst(),i.eUp=n,i.windingNumber=0,i.inside=!1,i.fixUpperEdge=!1,i.sentinel=!0,i.dirty=!1,i.nodeUp=t.dict.insert(i)},e.sweep.initEdgeDict_=function(t){t.dict=new e.Dict(t,e.sweep.edgeLeq_),e.sweep.addSentinel_(t,-e.sweep.SENTINEL_COORD_),e.sweep.addSentinel_(t,e.sweep.SENTINEL_COORD_)},e.sweep.doneEdgeDict_=function(t){for(var s,i=0;null!==(s=t.dict.getMin().getKey());)s.sentinel||(e.assert(s.fixUpperEdge),e.assert(1==++i)),e.assert(0===s.windingNumber),e.sweep.deleteRegion_(t,s);t.dict=null},e.sweep.removeDegenerateEdges_=function(t){for(var s,i=t.mesh.eHead,n=i.next;n!==i;n=s){s=n.next;var r=n.lNext;e.geom.vertEq(n.org,n.dst())&&n.lNext.lNext!==n&&(e.sweep.spliceMergeVertices_(t,r,n),e.mesh.deleteEdge(n),r=(n=r).lNext),r.lNext===n&&(r!==n&&(r!==s&&r!==s.sym||(s=s.next),e.mesh.deleteEdge(r)),n!==s&&n!==s.sym||(s=s.next),e.mesh.deleteEdge(n))}},e.sweep.initPriorityQ_=function(t){var s=new e.PriorityQ;t.pq=s;var i,n=t.mesh.vHead;for(i=n.next;i!==n;i=i.next)i.pqHandle=s.insert(i);s.init()},e.sweep.donePriorityQ_=function(e){e.pq.deleteQ(),e.pq=null},e.sweep.removeDegenerateFaces_=function(t){for(var s,i=t.fHead.next;i!==t.fHead;i=s){s=i.next;var n=i.anEdge;e.assert(n.lNext!==n),n.lNext.lNext===n&&(e.sweep.addWinding_(n.oNext,n),e.mesh.deleteEdge(n))}},e.tessmono={},e.tessmono.tessellateMonoRegion_=function(t){var s=t.anEdge;for(e.assert(s.lNext!==s&&s.lNext.lNext!==s);e.geom.vertLeq(s.dst(),s.org);s=s.lPrev());for(;e.geom.vertLeq(s.org,s.dst());s=s.lNext);for(var i,n=s.lPrev();s.lNext!==n;)if(e.geom.vertLeq(s.dst(),n.org)){for(;n.lNext!==s&&(e.geom.edgeGoesLeft(n.lNext)||e.geom.edgeSign(n.org,n.dst(),n.lNext.dst())<=0);)n=(i=e.mesh.connect(n.lNext,n)).sym;n=n.lPrev()}else{for(;n.lNext!==s&&(e.geom.edgeGoesRight(s.lPrev())||e.geom.edgeSign(s.dst(),s.org,s.lPrev().org)>=0);)i=e.mesh.connect(s,s.lPrev()),s=i.sym;s=s.lNext}for(e.assert(n.lNext!==s);n.lNext.lNext!==s;)n=(i=e.mesh.connect(n.lNext,n)).sym},e.tessmono.tessellateInterior=function(t){for(var s,i=t.fHead.next;i!==t.fHead;i=s)s=i.next,i.inside&&e.tessmono.tessellateMonoRegion_(i)},e.tessmono.discardExterior=function(t){for(var s,i=t.fHead.next;i!==t.fHead;i=s)s=i.next,i.inside||e.mesh.zapFace(i)},e.tessmono.setWindingNumber=function(t,s,i){for(var n,r=t.eHead.next;r!==t.eHead;r=n)n=r.next,r.rFace().inside!==r.lFace.inside?r.winding=r.lFace.inside?s:-s:i?e.mesh.deleteEdge(r):r.winding=0},e.Dict=function(t,s){this.head_=new e.DictNode,this.frame_=t,this.leq_=s},e.Dict.prototype.deleteDict_=function(){},e.Dict.prototype.insertBefore=function(t,s){do{t=t.prev}while(null!==t.key&&!this.leq_(this.frame_,t.key,s));var i=new e.DictNode(s,t.next,t);return t.next.prev=i,t.next=i,i},e.Dict.prototype.insert=function(e){return this.insertBefore(this.head_,e)},e.Dict.prototype.deleteNode=function(e){e.next.prev=e.prev,e.prev.next=e.next},e.Dict.prototype.search=function(e){var t=this.head_;do{t=t.next}while(null!==t.key&&!this.leq_(this.frame_,e,t.key));return t},e.Dict.prototype.getMin=function(){return this.head_.next},e.Dict.prototype.getMax=function(){return this.head_.prev},e.DictNode=function(e,t,s){this.key=e||null,this.next=t||this,this.prev=s||this},e.DictNode.prototype.getKey=function(){return this.key},e.DictNode.prototype.getSuccessor=function(){return this.next},e.DictNode.prototype.getPredecessor=function(){return this.prev},e.GluTesselator=function(){this.state_=e.GluTesselator.tessState_.T_DORMANT,this.lastEdge_=null,this.mesh=null,this.errorCallback_=null,this.normal_=[0,0,0],this.windingRule=e.windingRule.GLU_TESS_WINDING_ODD,this.fatalError=!1,this.dict=null,this.pq=null,this.event=null,this.combineCallback_=null,this.boundaryOnly_=!1,this.beginCallback_=null,this.edgeFlagCallback_=null,this.vertexCallback_=null,this.endCallback_=null,this.meshCallback_=null,this.polygonData_=null},e.GluTesselator.tessState_={T_DORMANT:0,T_IN_POLYGON:1,T_IN_CONTOUR:2},e.GluTesselator.prototype.gluDeleteTess=function(){this.requireState_(e.GluTesselator.tessState_.T_DORMANT)},e.GluTesselator.prototype.gluTessProperty=function(t,s){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return;case e.gluEnum.GLU_TESS_WINDING_RULE:var i=s;switch(i){case e.windingRule.GLU_TESS_WINDING_ODD:case e.windingRule.GLU_TESS_WINDING_NONZERO:case e.windingRule.GLU_TESS_WINDING_POSITIVE:case e.windingRule.GLU_TESS_WINDING_NEGATIVE:case e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO:return void(this.windingRule=i)}break;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return void(this.boundaryOnly_=!!s);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}this.callErrorCallback(e.gluEnum.GLU_INVALID_VALUE)},e.GluTesselator.prototype.gluGetTessProperty=function(t){switch(t){case e.gluEnum.GLU_TESS_TOLERANCE:return 0;case e.gluEnum.GLU_TESS_WINDING_RULE:var s=this.windingRule;return e.assert(s===e.windingRule.GLU_TESS_WINDING_ODD||s===e.windingRule.GLU_TESS_WINDING_NONZERO||s===e.windingRule.GLU_TESS_WINDING_POSITIVE||s===e.windingRule.GLU_TESS_WINDING_NEGATIVE||s===e.windingRule.GLU_TESS_WINDING_ABS_GEQ_TWO),s;case e.gluEnum.GLU_TESS_BOUNDARY_ONLY:return e.assert(!0===this.boundaryOnly_||!1===this.boundaryOnly_),this.boundaryOnly_;default:this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}return!1},e.GluTesselator.prototype.gluTessNormal=function(e,t,s){this.normal_[0]=e,this.normal_[1]=t,this.normal_[2]=s},e.GluTesselator.prototype.gluTessCallback=function(t,s){var i=s||null;switch(t){case e.gluEnum.GLU_TESS_BEGIN:case e.gluEnum.GLU_TESS_BEGIN_DATA:return void(this.beginCallback_=i);case e.gluEnum.GLU_TESS_EDGE_FLAG:case e.gluEnum.GLU_TESS_EDGE_FLAG_DATA:return void(this.edgeFlagCallback_=i);case e.gluEnum.GLU_TESS_VERTEX:case e.gluEnum.GLU_TESS_VERTEX_DATA:return void(this.vertexCallback_=i);case e.gluEnum.GLU_TESS_END:case e.gluEnum.GLU_TESS_END_DATA:return void(this.endCallback_=i);case e.gluEnum.GLU_TESS_ERROR:case e.gluEnum.GLU_TESS_ERROR_DATA:return void(this.errorCallback_=i);case e.gluEnum.GLU_TESS_COMBINE:case e.gluEnum.GLU_TESS_COMBINE_DATA:return void(this.combineCallback_=i);case e.gluEnum.GLU_TESS_MESH:return void(this.meshCallback_=i);default:return void this.callErrorCallback(e.gluEnum.GLU_INVALID_ENUM)}},e.GluTesselator.prototype.gluTessVertex=function(t,s){var i=!1,n=[0,0,0];this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR);for(var r=0;r<3;++r){var o=t[r];o<-e.GLU_TESS_MAX_COORD&&(o=-e.GLU_TESS_MAX_COORD,i=!0),o>e.GLU_TESS_MAX_COORD&&(o=e.GLU_TESS_MAX_COORD,i=!0),n[r]=o}i&&this.callErrorCallback(e.errorType.GLU_TESS_COORD_TOO_LARGE),this.addVertex_(n,s)},e.GluTesselator.prototype.gluTessBeginPolygon=function(t){this.requireState_(e.GluTesselator.tessState_.T_DORMANT),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON,this.mesh=new e.GluMesh,this.polygonData_=t},e.GluTesselator.prototype.gluTessBeginContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_IN_CONTOUR,this.lastEdge_=null},e.GluTesselator.prototype.gluTessEndContour=function(){this.requireState_(e.GluTesselator.tessState_.T_IN_CONTOUR),this.state_=e.GluTesselator.tessState_.T_IN_POLYGON},e.GluTesselator.prototype.gluTessEndPolygon=function(){if(this.requireState_(e.GluTesselator.tessState_.T_IN_POLYGON),this.state_=e.GluTesselator.tessState_.T_DORMANT,e.normal.projectPolygon(this,this.normal_[0],this.normal_[1],this.normal_[2]),e.sweep.computeInterior(this),!this.fatalError){var t=this.mesh;if(this.boundaryOnly_?e.tessmono.setWindingNumber(t,1,!0):e.tessmono.tessellateInterior(t),this.mesh.checkMesh(),this.beginCallback_||this.endCallback_||this.vertexCallback_||this.edgeFlagCallback_)if(this.boundaryOnly_)e.render.renderBoundary(this,this.mesh);else{var s=!!this.edgeFlagCallback_;e.render.renderMesh(this,this.mesh,s)}if(this.meshCallback_)return e.tessmono.discardExterior(this.mesh),this.meshCallback_(this.mesh),this.mesh=null,void(this.polygonData_=null)}e.mesh.deleteMesh(this.mesh),this.polygonData_=null,this.mesh=null},e.GluTesselator.prototype.requireState_=function(e){this.state_!==e&&this.gotoState_(e)},e.GluTesselator.prototype.gotoState_=function(t){for(;this.state_!==t;)if(this.state_<t)switch(this.state_){case e.GluTesselator.tessState_.T_DORMANT:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_POLYGON),this.gluTessBeginPolygon(null);break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_BEGIN_CONTOUR),this.gluTessBeginContour()}else switch(this.state_){case e.GluTesselator.tessState_.T_IN_CONTOUR:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_CONTOUR),this.gluTessEndContour();break;case e.GluTesselator.tessState_.T_IN_POLYGON:this.callErrorCallback(e.errorType.GLU_TESS_MISSING_END_POLYGON),this.gluTessEndPolygon()}},e.GluTesselator.prototype.addVertex_=function(t,s){var i=this.lastEdge_;null===i?(i=e.mesh.makeEdge(this.mesh),e.mesh.meshSplice(i,i.sym)):(e.mesh.splitEdge(i),i=i.lNext),i.org.data=s,i.org.coords[0]=t[0],i.org.coords[1]=t[1],i.org.coords[2]=t[2],i.winding=1,i.sym.winding=-1,this.lastEdge_=i},e.GluTesselator.prototype.callBeginCallback=function(e){this.beginCallback_&&this.beginCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callVertexCallback=function(e){this.vertexCallback_&&this.vertexCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callEdgeFlagCallback=function(e){this.edgeFlagCallback_&&this.edgeFlagCallback_(e,this.polygonData_)},e.GluTesselator.prototype.callEndCallback=function(){this.endCallback_&&this.endCallback_(this.polygonData_)},e.GluTesselator.prototype.callCombineCallback=function(e,t,s){return this.combineCallback_&&this.combineCallback_(e,t,s,this.polygonData_)||null},e.GluTesselator.prototype.callErrorCallback=function(e){this.errorCallback_&&this.errorCallback_(e,this.polygonData_)},e.GluFace=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.inside=!1},e.GluHalfEdge=function(e){this.next=e||this,this.sym=null,this.oNext=null,this.lNext=null,this.org=null,this.lFace=null,this.activeRegion=null,this.winding=0},e.GluHalfEdge.prototype.rFace=function(){return this.sym.lFace},e.GluHalfEdge.prototype.dst=function(){return this.sym.org},e.GluHalfEdge.prototype.oPrev=function(){return this.sym.lNext},e.GluHalfEdge.prototype.lPrev=function(){return this.oNext.sym},e.GluHalfEdge.prototype.dPrev=function(){return this.lNext.sym},e.GluHalfEdge.prototype.rPrev=function(){return this.sym.oNext},e.GluHalfEdge.prototype.dNext=function(){return this.rPrev().sym},e.GluHalfEdge.prototype.rNext=function(){return this.oPrev().sym},e.GluMesh=function(){this.vHead=new e.GluVertex,this.fHead=new e.GluFace,this.eHead=new e.GluHalfEdge,this.eHeadSym=new e.GluHalfEdge,this.eHead.sym=this.eHeadSym,this.eHeadSym.sym=this.eHead},e.GluMesh.prototype.checkMesh=function(){if(e.DEBUG){var t,s,i,n=this.fHead,r=this.vHead,o=this.eHead,l=n;for(l=n;(s=l.next)!==n;l=s){e.assert(s.prev===l),t=s.anEdge;do{e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t),e.assert(t.lFace===s),t=t.lNext}while(t!==s.anEdge)}e.assert(s.prev===l&&null===s.anEdge);var a=r;for(a=r;(i=a.next)!==r;a=i){e.assert(i.prev===a),t=i.anEdge;do{e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t),e.assert(t.org===i),t=t.oNext}while(t!==i.anEdge)}e.assert(i.prev===a&&null===i.anEdge&&null===i.data);var h=o;for(h=o;(t=h.next)!==o;h=t)e.assert(t.sym.next===h.sym),e.assert(t.sym!==t),e.assert(t.sym.sym===t),e.assert(null!==t.org),e.assert(null!==t.dst()),e.assert(t.lNext.oNext.sym===t),e.assert(t.oNext.sym.lNext===t);e.assert(t.sym.next===h.sym&&t.sym===this.eHeadSym&&t.sym.sym===t&&null===t.org&&null===t.dst()&&null===t.lFace&&null===t.rFace())}},e.GluVertex=function(e,t){this.next=e||this,this.prev=t||this,this.anEdge=null,this.data=null,this.coords=[0,0,0],this.s=0,this.t=0,this.pqHandle=0},e.PriorityQ=function(){this.verts_=[],this.order_=null,this.size_=0,this.initialized_=!1,this.heap_=new e.PriorityQHeap},e.PriorityQ.prototype.deleteQ=function(){this.heap_=null,this.order_=null,this.verts_=null},e.PriorityQ.prototype.init=function(){this.order_=[];for(var t=0;t<this.size_;t++)this.order_[t]=t;var s,i=(s=this.verts_,function(t,i){return e.geom.vertLeq(s[t],s[i])?1:-1});if(this.order_.sort(i),this.initialized_=!0,this.heap_.init(),e.DEBUG){var n=0,r=n+this.size_-1;for(t=n;t<r;++t)e.assert(e.geom.vertLeq(this.verts_[this.order_[t+1]],this.verts_[this.order_[t]]))}},e.PriorityQ.prototype.insert=function(e){if(this.initialized_)return this.heap_.insert(e);var t=this.size_++;return this.verts_[t]=e,-(t+1)},e.PriorityQ.prototype.extractMin=function(){if(0===this.size_)return this.heap_.extractMin();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var s=this.heap_.minimum();if(e.geom.vertLeq(s,t))return this.heap_.extractMin()}do{--this.size_}while(this.size_>0&&null===this.verts_[this.order_[this.size_-1]]);return t},e.PriorityQ.prototype.minimum=function(){if(0===this.size_)return this.heap_.minimum();var t=this.verts_[this.order_[this.size_-1]];if(!this.heap_.isEmpty()){var s=this.heap_.minimum();if(e.geom.vertLeq(s,t))return s}return t},e.PriorityQ.prototype.remove=function(t){if(t>=0)this.heap_.remove(t);else for(t=-(t+1),e.assert(t<this.verts_.length&&null!==this.verts_[t]),this.verts_[t]=null;this.size_>0&&null===this.verts_[this.order_[this.size_-1]];)--this.size_},e.PriorityQHeap=function(){this.heap_=e.PriorityQHeap.reallocNumeric_([0],e.PriorityQHeap.INIT_SIZE_+1),this.verts_=[null,null],this.handles_=[0,0],this.size_=0,this.max_=e.PriorityQHeap.INIT_SIZE_,this.freeList_=0,this.initialized_=!1,this.heap_[1]=1},e.PriorityQHeap.INIT_SIZE_=32,e.PriorityQHeap.reallocNumeric_=function(e,t){for(var s=new Array(t),i=0;i<e.length;i++)s[i]=e[i];for(;i<t;i++)s[i]=0;return s},e.PriorityQHeap.prototype.init=function(){for(var e=this.size_;e>=1;--e)this.floatDown_(e);this.initialized_=!0},e.PriorityQHeap.prototype.insert=function(t){var s,i=++this.size_;return 2*i>this.max_&&(this.max_*=2,this.handles_=e.PriorityQHeap.reallocNumeric_(this.handles_,this.max_+1)),0===this.freeList_?s=i:(s=this.freeList_,this.freeList_=this.handles_[this.freeList_]),this.verts_[s]=t,this.handles_[s]=i,this.heap_[i]=s,this.initialized_&&this.floatUp_(i),s},e.PriorityQHeap.prototype.isEmpty=function(){return 0===this.size_},e.PriorityQHeap.prototype.minimum=function(){return this.verts_[this.heap_[1]]},e.PriorityQHeap.prototype.extractMin=function(){var e=this.heap_,t=this.verts_,s=this.handles_,i=e[1],n=t[i];return this.size_>0&&(e[1]=e[this.size_],s[e[1]]=1,t[i]=null,s[i]=this.freeList_,this.freeList_=i,--this.size_>0&&this.floatDown_(1)),n},e.PriorityQHeap.prototype.remove=function(t){var s=this.heap_,i=this.verts_,n=this.handles_;e.assert(t>=1&&t<=this.max_&&null!==i[t]);var r=n[t];if(s[r]=s[this.size_],n[s[r]]=r,r<=--this.size_)if(r<=1)this.floatDown_(r);else{var o=i[s[r]],l=i[s[r>>1]];e.geom.vertLeq(l,o)?this.floatDown_(r):this.floatUp_(r)}i[t]=null,n[t]=this.freeList_,this.freeList_=t},e.PriorityQHeap.prototype.floatDown_=function(t){for(var s=this.heap_,i=this.verts_,n=this.handles_,r=t,o=s[r];;){var l=r<<1;l<this.size_&&e.geom.vertLeq(i[s[l+1]],i[s[l]])&&(l+=1),e.assert(l<=this.max_);var a=s[l];if(l>this.size_||e.geom.vertLeq(i[o],i[a]))return s[r]=o,void(n[o]=r);s[r]=a,n[a]=r,r=l}},e.PriorityQHeap.prototype.floatUp_=function(t){for(var s=this.heap_,i=this.verts_,n=this.handles_,r=t,o=s[r];;){var l=r>>1,a=s[l];if(0===l||e.geom.vertLeq(i[a],i[o]))return s[r]=o,void(n[o]=r);s[r]=a,n[a]=r,r=l}},e.ActiveRegion=function(){this.eUp=null,this.nodeUp=null,this.windingNumber=0,this.inside=!1,this.sentinel=!1,this.dirty=!1,this.fixUpperEdge=!1},e.ActiveRegion.prototype.regionBelow=function(){return this.nodeUp.getPredecessor().getKey()},e.ActiveRegion.prototype.regionAbove=function(){return this.nodeUp.getSuccessor().getKey()},e}())&&(e.exports=t)}));const o=e.getLogger("esri.views.2d.engine.webgl.mesh.templates.Tesselator");class l{constructor(){this._currentVertexIndex=0,this._indexCounter=0,this._triangleIndices=[-1,-1,-1],this.glu=new r.GluTesselator,this.glu.gluTessCallback(r.gluEnum.GLU_TESS_BEGIN,this._begincallback.bind(this)),this.glu.gluTessCallback(r.gluEnum.GLU_TESS_VERTEX_DATA,this._vertexCallback.bind(this)),this.glu.gluTessCallback(r.gluEnum.GLU_TESS_END,this._endcallback.bind(this)),this.glu.gluTessCallback(r.gluEnum.GLU_TESS_COMBINE,this._combinecallback.bind(this)),this.glu.gluTessCallback(r.gluEnum.GLU_TESS_ERROR,this._errorcallback.bind(this)),this.glu.gluTessCallback(r.gluEnum.GLU_TESS_EDGE_FLAG,this._edgeCallback.bind(this)),this.glu.gluTessProperty(r.gluEnum.GLU_TESS_WINDING_RULE,r.windingRule.GLU_TESS_WINDING_ODD)}beginPolygon(e,t){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0,this._indexCounter=0,this.glu.gluTessBeginPolygon(e),this._indices=t}endPolygon(){this.glu.gluTessEndPolygon()}beginContour(){this.glu.gluTessBeginContour()}endContour(){this.glu.gluTessEndContour()}addVertex(e,t){this.glu.gluTessVertex(e,t)}_vertexCallback(e,t){if(t[t.length]=e[0],t[t.length]=e[1],this._triangleIndices[this._currentVertexIndex]=-1,this._currentVertexIndex>=2){for(let e=0;e<3;e++)-1===this._triangleIndices[e]&&(this._triangleIndices[e]=this._indexCounter++),this._indices[this._indices.length]=this._triangleIndices[e];this._currentVertexIndex=0}else this._currentVertexIndex++}_begincallback(){this._triangleIndices[0]=-1,this._triangleIndices[1]=-1,this._triangleIndices[2]=-1,this._currentVertexIndex=0}_endcallback(){this._currentVertexIndex=0}_errorcallback(e){o.error(`Encountered error during tesselation: ${e}`)}_combinecallback(e){return[e[0],e[1],e[2]]}_edgeCallback(){}}class a{constructor(e,t,s){this.ratio=e,this.x=t,this.y=s}}class h{constructor(e,t,i,n=8,r=8){this.lines=[],this.starts=[],this.validateTessellation=!0,this.pixelRatio=n,this.pixelMargin=r,this.tileSize=s*n,this.dz=e,this.yPos=t,this.xPos=i}setExtent(e){this.finalRatio=this.tileSize/e*(1<<this.dz);let t=this.pixelRatio*this.pixelMargin;t/=this.finalRatio;const s=e>>this.dz;t>s&&(t=s),this.margin=t,this.xmin=s*this.xPos-t,this.ymin=s*this.yPos-t,this.xmax=this.xmin+s+2*t,this.ymax=this.ymin+s+2*t}reset(e){this.type=e,this.lines=[],this.starts=[],this.line=null,this.start=0}moveTo(e,t){this._pushLine(),this._prevIsIn=this._isIn(e,t),this._moveTo(e,t,this._prevIsIn),this._prevPt=new n(e,t),this._firstPt=new n(e,t),this._dist=0}lineTo(e,t){const s=this._isIn(e,t),i=new n(e,t),r=n.distance(this._prevPt,i);let o,l,h,_,g,d,u,c;if(s)this._prevIsIn?this._lineTo(e,t,!0):(o=this._prevPt,l=i,h=this._intersect(l,o),this.start=this._dist+r*(1-this._r),this._lineTo(h.x,h.y,!0),this._lineTo(l.x,l.y,!0));else if(this._prevIsIn)l=this._prevPt,o=i,h=this._intersect(l,o),this._lineTo(h.x,h.y,!0),this._lineTo(o.x,o.y,!1);else{const e=this._prevPt,t=i;if(e.x<=this.xmin&&t.x<=this.xmin||e.x>=this.xmax&&t.x>=this.xmax||e.y<=this.ymin&&t.y<=this.ymin||e.y>=this.ymax&&t.y>=this.ymax)this._lineTo(t.x,t.y,!1);else{const s=[];if((e.x<this.xmin&&t.x>this.xmin||e.x>this.xmin&&t.x<this.xmin)&&(_=(this.xmin-e.x)/(t.x-e.x),c=e.y+_*(t.y-e.y),c<=this.ymin?d=!1:c>=this.ymax?d=!0:s.push(new a(_,this.xmin,c))),(e.x<this.xmax&&t.x>this.xmax||e.x>this.xmax&&t.x<this.xmax)&&(_=(this.xmax-e.x)/(t.x-e.x),c=e.y+_*(t.y-e.y),c<=this.ymin?d=!1:c>=this.ymax?d=!0:s.push(new a(_,this.xmax,c))),(e.y<this.ymin&&t.y>this.ymin||e.y>this.ymin&&t.y<this.ymin)&&(_=(this.ymin-e.y)/(t.y-e.y),u=e.x+_*(t.x-e.x),u<=this.xmin?g=!1:u>=this.xmax?g=!0:s.push(new a(_,u,this.ymin))),(e.y<this.ymax&&t.y>this.ymax||e.y>this.ymax&&t.y<this.ymax)&&(_=(this.ymax-e.y)/(t.y-e.y),u=e.x+_*(t.x-e.x),u<=this.xmin?g=!1:u>=this.xmax?g=!0:s.push(new a(_,u,this.ymax))),0===s.length)g?d?this._lineTo(this.xmax,this.ymax,!0):this._lineTo(this.xmax,this.ymin,!0):d?this._lineTo(this.xmin,this.ymax,!0):this._lineTo(this.xmin,this.ymin,!0);else if(s.length>1&&s[0].ratio>s[1].ratio)this.start=this._dist+r*s[1].ratio,this._lineTo(s[1].x,s[1].y,!0),this._lineTo(s[0].x,s[0].y,!0);else{this.start=this._dist+r*s[0].ratio;for(let e=0;e<s.length;e++)this._lineTo(s[e].x,s[e].y,!0)}this._lineTo(t.x,t.y,!1)}}this._dist+=r,this._prevIsIn=s,this._prevPt=i}close(){if(this.line.length>2){const e=this._firstPt,t=this._prevPt;e.x===t.x&&e.y===t.y||this.lineTo(e.x,e.y);const s=this.line;let i=s.length;for(;i>=4&&(s[0].x===s[1].x&&s[0].x===s[i-2].x||s[0].y===s[1].y&&s[0].y===s[i-2].y);)s.pop(),s[0].x=s[i-2].x,s[0].y=s[i-2].y,--i}}result(e=!0){return this._pushLine(),0===this.lines.length?null:(3===this.type&&e&&g.simplify(this.tileSize,this.margin*this.finalRatio,this.lines),this.lines)}resultWithStarts(){if(2!==this.type)throw new Error("Only valid for lines");this._pushLine();const e=this.lines,t=e.length;if(0===t)return null;const s=[];for(let i=0;i<t;i++)s.push({line:e[i],start:this.starts[i]||0});return s}_isIn(e,t){return e>=this.xmin&&e<=this.xmax&&t>=this.ymin&&t<=this.ymax}_intersect(e,t){let s,i,r;if(t.x>=this.xmin&&t.x<=this.xmax)i=t.y<=this.ymin?this.ymin:this.ymax,r=(i-e.y)/(t.y-e.y),s=e.x+r*(t.x-e.x);else if(t.y>=this.ymin&&t.y<=this.ymax)s=t.x<=this.xmin?this.xmin:this.xmax,r=(s-e.x)/(t.x-e.x),i=e.y+r*(t.y-e.y);else{i=t.y<=this.ymin?this.ymin:this.ymax,s=t.x<=this.xmin?this.xmin:this.xmax;const n=(s-e.x)/(t.x-e.x),o=(i-e.y)/(t.y-e.y);n<o?(r=n,i=e.y+n*(t.y-e.y)):(r=o,s=e.x+o*(t.x-e.x))}return this._r=r,new n(s,i)}_pushLine(){this.line&&(1===this.type?this.line.length>0&&(this.lines.push(this.line),this.starts.push(this.start)):2===this.type?this.line.length>1&&(this.lines.push(this.line),this.starts.push(this.start)):3===this.type&&this.line.length>3&&(this.lines.push(this.line),this.starts.push(this.start))),this.line=[],this.start=0}_moveTo(e,t,s){3!==this.type?s&&(e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.push(new n(e,t))):(s||(e<this.xmin&&(e=this.xmin),e>this.xmax&&(e=this.xmax),t<this.ymin&&(t=this.ymin),t>this.ymax&&(t=this.ymax)),e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.push(new n(e,t)),this._is_h=!1,this._is_v=!1)}_lineTo(e,t,s){let i,r;if(3!==this.type)if(s){if(e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line.length>0&&(i=this.line[this.line.length-1],i.equals(e,t)))return;this.line.push(new n(e,t))}else this.line&&this.line.length>0&&this._pushLine();else if(s||(e<this.xmin&&(e=this.xmin),e>this.xmax&&(e=this.xmax),t<this.ymin&&(t=this.ymin),t>this.ymax&&(t=this.ymax)),e=Math.round((e-(this.xmin+this.margin))*this.finalRatio),t=Math.round((t-(this.ymin+this.margin))*this.finalRatio),this.line&&this.line.length>0){i=this.line[this.line.length-1];const s=i.x===e,o=i.y===t;if(s&&o)return;this._is_h&&s||this._is_v&&o?(i.x=e,i.y=t,r=this.line[this.line.length-2],r.x===e&&r.y===t?(this.line.pop(),this.line.length<=1?(this._is_h=!1,this._is_v=!1):(r=this.line[this.line.length-2],this._is_h=r.x===e,this._is_v=r.y===t)):(this._is_h=r.x===e,this._is_v=r.y===t)):(this.line.push(new n(e,t)),this._is_h=s,this._is_v=o)}else this.line.push(new n(e,t))}}class _{setExtent(e){this._ratio=4096===e?1:4096/e}get validateTessellation(){return this._ratio<1}reset(e){this.lines=[],this.line=null}moveTo(e,t){this.line&&this.lines.push(this.line),this.line=[];const s=this._ratio;this.line.push(new n(e*s,t*s))}lineTo(e,t){const s=this._ratio;this.line.push(new n(e*s,t*s))}close(){const e=this.line;e&&!e[0].isEqual(e[e.length-1])&&e.push(e[0])}result(){return this.line&&this.lines.push(this.line),0===this.lines.length?null:this.lines}}class g{static simplify(e,t,s){if(!s)return;const i=-t,n=e+t,r=-t,o=e+t,l=[],a=[],h=s.length;for(let e=0;e<h;++e){const t=s[e];if(!t||t.length<2)continue;let h,_=t[0];const g=t.length;for(let s=1;s<g;++s)h=t[s],_.x===h.x&&(_.x<=i&&(_.y>h.y?(l.push(e),l.push(s),l.push(0),l.push(-1)):(a.push(e),a.push(s),a.push(0),a.push(-1))),_.x>=n&&(_.y<h.y?(l.push(e),l.push(s),l.push(1),l.push(-1)):(a.push(e),a.push(s),a.push(1),a.push(-1)))),_.y===h.y&&(_.y<=r&&(_.x<h.x?(l.push(e),l.push(s),l.push(2),l.push(-1)):(a.push(e),a.push(s),a.push(2),a.push(-1))),_.y>=o&&(_.x>h.x?(l.push(e),l.push(s),l.push(3),l.push(-1)):(a.push(e),a.push(s),a.push(3),a.push(-1)))),_=h}if(0===l.length||0===a.length)return;g.fillParent(s,a,l),g.fillParent(s,l,a);const _=[];g.calcDeltas(_,a,l),g.calcDeltas(_,l,a),g.addDeltas(_,s)}static fillParent(e,t,s){const n=s.length,r=t.length;for(let o=0;o<r;o+=4){const r=t[o],l=t[o+1],a=t[o+2],h=e[r][l-1],_=e[r][l];let g=8092,d=-1;for(let t=0;t<n;t+=4){if(s[t+2]!==a)continue;const n=s[t],r=s[t+1],o=e[n][r-1],l=e[n][r];switch(a){case 0:case 1:if(i(h.y,o.y,l.y)&&i(_.y,o.y,l.y)){const e=Math.abs(l.y-o.y);e<g&&(g=e,d=t)}break;case 2:case 3:if(i(h.x,o.x,l.x)&&i(_.x,o.x,l.x)){const e=Math.abs(l.x-o.x);e<g&&(g=e,d=t)}}}t[o+3]=d}}static calcDeltas(e,t,s){const i=t.length;for(let n=0;n<i;n+=4){const i=[],r=g.calcDelta(n,t,s,i);e.push(t[n]),e.push(t[n+1]),e.push(t[n+2]),e.push(r)}}static calcDelta(e,t,s,i){const n=t[e+3];if(-1===n)return 0;const r=i.length;return r>1&&i[r-2]===n?0:(i.push(n),g.calcDelta(n,s,t,i)+1)}static addDeltas(e,t){const s=e.length;let i=0;for(let t=0;t<s;t+=4){const s=e[t+3];s>i&&(i=s)}for(let n=0;n<s;n+=4){const s=t[e[n]],r=e[n+1],o=i-e[n+3];switch(e[n+2]){case 0:s[r-1].x-=o,s[r].x-=o,1===r&&(s[s.length-1].x-=o),r===s.length-1&&(s[0].x-=o);break;case 1:s[r-1].x+=o,s[r].x+=o,1===r&&(s[s.length-1].x+=o),r===s.length-1&&(s[0].x+=o);break;case 2:s[r-1].y-=o,s[r].y-=o,1===r&&(s[s.length-1].y-=o),r===s.length-1&&(s[0].y-=o);break;case 3:s[r-1].y+=o,s[r].y+=o,1===r&&(s[s.length-1].y+=o),r===s.length-1&&(s[0].y+=o)}}}}export{n as P,_ as S,l as T,h as a};

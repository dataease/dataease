/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as r}from"../../chunks/tslib.es6.js";import"../../chunks/ArrayPool.js";import"../../chunks/object.js";import"../../chunks/deprecate.js";import{clone as t}from"../../core/lang.js";import"../../config.js";import{L as o}from"../../chunks/Logger.js";import"../../chunks/string.js";import"../../chunks/metadata.js";import{property as e}from"../../core/accessorSupport/decorators/property.js";import s from"../../core/Accessor.js";import"../../chunks/PropertyOrigin.js";import"../../core/scheduling.js";import"../../core/promiseUtils.js";import"../../chunks/Message.js";import"../../core/Error.js";import{k as i}from"../../chunks/ensureType.js";import{subclass as n}from"../../core/accessorSupport/decorators/subclass.js";import{a}from"../../chunks/JSONSupport.js";import"../../core/urlUtils.js";import{cast as l}from"../../core/accessorSupport/decorators/cast.js";import"../../chunks/reader.js";import"../../chunks/writer.js";import"../../chunks/resourceExtension.js";import"../../chunks/persistableUrlUtils.js";import"../../chunks/mathUtils2.js";import"../../chunks/colorUtils.js";import"../../Color.js";import"../../chunks/screenshotUtils.js";import"./MeshTexture.js";import c from"./MeshMaterial.js";import p from"./MeshMaterialMetallicRoughness.js";var u;const m=o.getLogger("esri.geometry.support.MeshVertexAttributes");let h=u=class extends a{constructor(r){super(r),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(r){return y(r,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},m)}castPosition(r){r&&r instanceof Float32Array&&m.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return y(r,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},m)}castUv(r){return y(r,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},m)}castNormal(r){return y(r,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},m)}castTangent(r){return y(r,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},m)}clone(){const r={position:t(this.position),uv:t(this.uv),normal:t(this.normal),tangent:t(this.tangent),color:t(this.color)};return new u(r)}};function g(r,t,o,e){const{loggerTag:s,stride:i}=t;return r.length%i!=0?(e.error(s,`Invalid array length, expected a multiple of ${i}`),new o([])):r}function y(r,t,o,e,s){if(!r)return r;if(r instanceof t)return g(r,e,t,s);for(const i of o)if(r instanceof i)return g(new t(r),e,t,s);if(Array.isArray(r))return g(new t(r),e,t,s);{const e=o.map((r=>`'${r.name}'`));return s.error(`Failed to set property, expected one of ${e}, but got ${r.constructor.name}`),new t([])}}function j(r,t,o){t[o]=function(r){const t=new Array(r.length);for(let o=0;o<r.length;o++)t[o]=r[o];return t}(r)}var d;r([e({json:{write:j}})],h.prototype,"color",void 0),r([l("color")],h.prototype,"castColor",null),r([e({nonNullable:!0,json:{write:j}})],h.prototype,"position",void 0),r([l("position")],h.prototype,"castPosition",null),r([e({json:{write:j}})],h.prototype,"uv",void 0),r([l("uv")],h.prototype,"castUv",null),r([e({json:{write:j}})],h.prototype,"normal",void 0),r([l("normal")],h.prototype,"castNormal",null),r([e({json:{write:j}})],h.prototype,"tangent",void 0),r([l("tangent")],h.prototype,"castTangent",null),h=u=r([n("esri.geometry.support.MeshVertexAttributes")],h);const f=o.getLogger("esri.geometry.support.MeshComponent");let A=d=class extends s{constructor(r){super(r),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(r){return i(d,r)}castFaces(r){return y(r,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},f)}castMaterial(r){return i(r&&"object"==typeof r&&("metallic"in r||"roughness"in r||"metallicRoughnessTexture"in r)?p:c,r)}clone(){return new d({faces:t(this.faces),shading:this.shading,material:t(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(r,o){return new d({faces:t(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(r,o):null,trustSourceNormals:this.trustSourceNormals})}};r([e({json:{write:!0}})],A.prototype,"faces",void 0),r([l("faces")],A.prototype,"castFaces",null),r([e({type:c,json:{write:!0}})],A.prototype,"material",void 0),r([l("material")],A.prototype,"castMaterial",null),r([e({type:String,json:{write:!0}})],A.prototype,"shading",void 0),r([e({type:Boolean})],A.prototype,"trustSourceNormals",void 0),A=d=r([n("esri.geometry.support.MeshComponent")],A);var v=A;export default v;export{h as M};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.18/esri/copyright.txt for details.
*/
import{_ as t}from"../chunks/tslib.es6.js";import"../chunks/ArrayPool.js";import{h as e}from"../chunks/object.js";import"../chunks/deprecate.js";import"../core/lang.js";import"../config.js";import{i as s,d as o,e as i,c as r,b as n}from"../chunks/Logger.js";import"../chunks/string.js";import{h as a,f as l}from"../chunks/metadata.js";import{property as c}from"../core/accessorSupport/decorators/property.js";import p from"../core/Accessor.js";import"../chunks/PropertyOrigin.js";import{l as m,j as h}from"../core/scheduling.js";import{o as u,throwIfAborted as d,createTask as v}from"../core/promiseUtils.js";import"../chunks/Message.js";import"../core/Error.js";import"../chunks/compilerUtils.js";import"../chunks/ensureType.js";import{subclass as g}from"../core/accessorSupport/decorators/subclass.js";import"../chunks/Evented.js";import"../core/Collection.js";import"../chunks/collectionUtils.js";import"../chunks/JSONSupport.js";import"../chunks/Promise.js";import"../chunks/Loadable.js";import"../chunks/asyncUtils.js";import"../core/urlUtils.js";import{aliasOf as _}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/jsonMap.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../chunks/writer.js";import"../chunks/resourceExtension.js";import"../chunks/persistableUrlUtils.js";import"../geometry/SpatialReference.js";import"../chunks/locale.js";import"../chunks/number.js";import{substitute as j}from"../intl.js";import"../kernel.js";import"../request.js";import"../chunks/assets.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../chunks/Ellipsoid.js";import"../geometry/support/webMercatorUtils.js";import"../geometry/Extent.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../portal/PortalUser.js";import"../portal/Portal.js";import"../chunks/mathUtils2.js";import"../chunks/vec3f64.js";import"../chunks/common.js";import"../chunks/vec3.js";import"../chunks/mathUtils.js";import"../chunks/colorUtils.js";import"../Color.js";import"../chunks/zmUtils.js";import"../geometry/Multipoint.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../geometry.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/domains.js";import"../chunks/arcadeOnDemand.js";import"../layers/support/fieldUtils.js";import"../popup/content/Content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/CustomContent.js";import"../chunks/date.js";import"../popup/support/FieldInfoFormat.js";import"../popup/FieldInfo.js";import"../popup/content/FieldsContent.js";import"../chunks/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/MediaContent.js";import"../popup/content/TextContent.js";import"../popup/content.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../popup/RelatedRecordsInfo.js";import"../chunks/Identifiable.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../PopupTemplate.js";import"../symbols/Symbol.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol3DLayer.js";import"../chunks/screenUtils.js";import"../chunks/opacityUtils.js";import"../chunks/materialUtils.js";import"../symbols/edges/Edges3D.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/utils.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/FillSymbol.js";import"../symbols/patterns/StylePattern3D.js";import"../symbols/FillSymbol3DLayer.js";import"../chunks/colors.js";import"../chunks/Symbol3DOutline.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../symbols/Symbol3D.js";import"../chunks/Thumbnail.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/LabelSymbol3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../chunks/urlUtils.js";import"../symbols/PictureFillSymbol.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../symbols/support/jsonUtils.js";import"../chunks/uid.js";import"../Graphic.js";import"../core/Handles.js";import"../layers/Layer.js";import{s as b}from"../chunks/unitUtils.js";import"../chunks/lengthUtils.js";import"../geometry/support/normalizeUtils.js";import"../chunks/MemCache.js";import"../chunks/LRUCache.js";import"../chunks/timeUtils.js";import"../TimeExtent.js";import{init as k}from"../core/watchUtils.js";import"../chunks/fieldType.js";import"../chunks/mat4.js";import"../chunks/pe.js";import"../chunks/aaBoundingRect.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformationStep.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/projection.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../core/HandleOwner.js";import"../chunks/_commonjsHelpers.js";import"../chunks/Scheduler.js";import"../geometry/support/geodesicUtils.js";import"../geometry/Circle.js";import"../chunks/geometryEngineBase.js";import"../chunks/hydrated.js";import"../geometry/geometryEngine.js";import"../chunks/vec4f64.js";import"../chunks/quatf64.js";import"../chunks/mat3.js";import"../chunks/BufferView.js";import"../chunks/vec2.js";import"../chunks/vec4.js";import"../chunks/quat.js";import"../chunks/domUtils.js";import{i as y}from"../chunks/widgetUtils.js";import"../chunks/projector.js";import"../chunks/accessibleHandler.js";import{m as f}from"../chunks/messageBundle.js";import{r as C}from"../chunks/renderable.js";import"../chunks/vmEvent.js";import{j as w}from"../chunks/index.js";import"./support/widget.js";import P from"./Widget.js";import"../chunks/zscale.js";import"../chunks/queryZScale.js";import"../layers/support/Field.js";import"../tasks/support/FeatureSet.js";import"../chunks/BlendLayer.js";import"../chunks/ScaleRangeLayer.js";import"../chunks/DataLayerSource.js";import"../tasks/support/AttachmentQuery.js";import"../tasks/support/Query.js";import"../tasks/support/StatisticDefinition.js";import"../tasks/support/RelationshipQuery.js";import"../chunks/GraphicsCollection.js";import"../layers/GraphicsLayer.js";import"../tasks/Task.js";import"../chunks/OptimizedGeometry.js";import"../chunks/featureConversionUtils.js";import"../tasks/QueryTask.js";import"../chunks/pbf.js";import"../chunks/pbfQueryUtils.js";import"../chunks/query.js";import"../layers/support/AttachmentInfo.js";import"../chunks/aaBoundingBox.js";import"../chunks/Queue.js";import"../chunks/InputManager.js";import"../chunks/interactiveToolUtils.js";import"../chunks/throttle.js";import{f as S,i as x}from"./Attachments.js";import"./Attachments/AttachmentsViewModel.js";import"./Feature/FeatureViewModel.js";import{l as M}from"./Feature.js";import"../chunks/AnchorElementViewModel.js";import"./Spinner/SpinnerViewModel.js";import"./Popup.js";import"../chunks/layerViewUtils.js";import"../chunks/actions.js";import"../chunks/GoTo.js";import"./Popup/PopupViewModel.js";import"../chunks/screenUtils2.js";import"../layers/support/ElevationSampler.js";import"../chunks/quantizationUtils.js";import"../chunks/mat2d.js";import"../chunks/dehydratedFeatures.js";import"../chunks/ElevationProvider.js";import"../chunks/mat2df64.js";import"../chunks/vec2f64.js";import"../chunks/QueueProcessor.js";import"../chunks/PointerClickHoldAndDrag.js";import"../chunks/requestImageUtils.js";import"../chunks/PiUtils.glsl.js";import"../chunks/Program.js";import"../chunks/isWebGL2Context.js";import"../chunks/glUtil.js";import"../chunks/InterleavedLayout.js";import"../chunks/mat4f32.js";import"../chunks/vec3f32.js";import"../chunks/geometryUtils.js";import"../chunks/ColorMaterial.js";import"../chunks/Util.js";import"../chunks/Geometry.js";import"../chunks/VertexArrayObject.js";import"../chunks/sdfPrimitives.js";import"../chunks/Object3D.js";import"../chunks/intersectorUtils.js";import"../chunks/Intersector.js";import"../chunks/DefaultTextureUnits.js";import"../chunks/GLMaterialTexture.js";import"../chunks/VerticalOffset.glsl.js";import"../chunks/elevationAlignmentUtils.js";import"../chunks/RenderingContext.js";import"../chunks/CameraSpace.glsl.js";import"../chunks/Texture.js";import"../chunks/vec4f32.js";import"../views/draw/DrawAction.js";import"../chunks/Keys.js";import"../views/draw/MultipointDrawAction.js";import"../chunks/DrawTool.js";import"../chunks/elevationInfoUtils.js";import"../chunks/InteractiveToolBase.js";import"../chunks/RightAngleQuadVisualElement.js";import"../chunks/LaserLineRenderer.js";import"../views/draw/PointDrawAction.js";import"../views/draw/PolygonDrawAction.js";import"../views/draw/PolylineDrawAction.js";import"../views/draw/SegmentDrawAction.js";import"../views/draw/Draw.js";import"../chunks/commonProperties3.js";import{P as U}from"../chunks/Popover.js";import"./Sketch/SketchViewModel.js";import E,{N as D,F as A,E as B,P as O}from"./ElevationProfile/ElevationProfileViewModel.js";import"../chunks/ElevationProfileLine.js";import"../chunks/elevationQuerySourceUtils.js";import"./ElevationProfile/ElevationProfileLineGround.js";import"../chunks/ElevationQuery.js";import"./ElevationProfile/ElevationProfileLineInput.js";import"./ElevationProfile/ElevationProfileLineQuery.js";import"./ElevationProfile/ElevationProfileLineView.js";const V="esri-elevation-profile",L={esriWidget:"esri-widget--panel esri-widget",esriWidgetDisabled:"esri-widget--disabled",buttonDisabled:"esri-button--disabled",widgetIcon:"",base:`${V}`,portrait:`${V}--portrait`,progressBar:`${V}__progress-bar`,progressBarVisible:`${V}__progress-bar--visible`,promptContainer:`${V}__prompt-container`,header:`${V}__header`,headerSpacer:`${V}__header-spacer`,loadingMessage:`${V}__loading-message`,actionButton:`${V}__action-button esri-button`,sketchButton:`${V}__sketch-button`,sketchCancelButton:`${V}__sketch-cancel-button esri-button--secondary`,sketchDoneButton:`${V}__sketch-done-button`,selectButton:`${V}__select-button esri-button--secondary`,selectCancelButton:`${V}__select-cancel-button esri-button--secondary`,chartContainer:`${V}__chart-container`,footer:`${V}__footer`,legendContainer:`${V}__legend-container`,actionsContainer:`${V}__actions-container`},I="esri-elevation-profile-statistics",$={base:I,noStatistics:`${I}--no-statistics`,statistic:`${I}__statistic`,statisticNotAvailable:`${I}__statistic--not-available`,statisticHidden:`${I}__statistic--hidden`,statisticLabel:`${I}__statistic-label`,statisticValue:`${I}__statistic-value`,slopeValue:`${I}__slope-value `,slopeValueNotAvailable:`${I}__slope-value--not-available`,slopeUpIcon:"esri-icon-arrow-up",slopeDownIcon:"esri-icon-arrow-down",popoverToggle:`${I}__popover-toggle esri-icon-handle-horizontal esri-button esri-button--tertiary`,popoverContent:`${I}__popover-content`,popoverStatistic:`${I}__popover-statistic`},T="esri-elevation-profile-settings",F={base:`${T} esri-icon-settings2 esri-button esri-button--tertiary`,popoverContent:`${T}__popover-content`,select:`${T}__select esri-select`,selectLabel:`${T}__select-label`},z="esri-elevation-profile-legend",R={base:z,label:`${z}__label`,labelActive:`${z}__label--active`,labelContent:`${z}__label-content`,checkbox:`${z}__checkbox`,checkboxChecked:`${z}__checkbox--checked esri-icon-check-mark`,colorIndicator:`${z}__color-indicator`};function H(t,{profiles:e}){const o=t.title;if(s(o))return o;switch(t.type){case"ground":return e.ground;case"input":return e.input;case"query":return e.query;case"view":return e.view;default:return""}}let N=class extends P{constructor(t,e){super(t,e)}render(){return w("div",{key:this,class:R.base},this.viewModel.profiles.items.map((t=>this._renderLabel(t))))}_renderLabel(t){const e=`${R.base}__check-${t.id}`;return w("label",{key:e,for:e,class:this.classes(R.label,{[R.labelActive]:t.visible})},this._renderCheckbox(t,e),w("span",{key:"color-indicator",class:R.colorIndicator,styles:{background:t.color.toCss()}}),w("span",{key:"label-content",class:R.labelContent},H(t,this._messages)))}_renderCheckbox(t,e){const s=t.visible,o=this._messages,i=s?o.hideProfile:o.showProfile,r=H(t,this._messages),n=j(i,{name:r});return w("button",{id:e,bind:this,class:this.classes(R.checkbox,{[R.checkboxChecked]:s}),onclick:e=>this._onCheckboxToggle(e,t),role:"checkbox","aria-checked":s?"true":"false","aria-label":n,title:n,type:"button"})}_onCheckboxToggle(t,e){t.stopPropagation(),e.toggleVisibility()}};t([c(),C(["viewModel.chartData"])],N.prototype,"viewModel",void 0),t([c(),C(),f("esri/widgets/ElevationProfile/t9n/ElevationProfile")],N.prototype,"_messages",void 0),N=t([g("esri.widgets.ElevationProfile.ElevationProfileLegend")],N);var W=N;let G=class extends p{constructor(){super(...arguments),this.statistics=!0,this.legend=!0,this.sketchButton=!0,this.selectButton=!0}};t([c()],G.prototype,"statistics",void 0),t([c()],G.prototype,"legend",void 0),t([c()],G.prototype,"sketchButton",void 0),t([c()],G.prototype,"selectButton",void 0),G=t([g("esri.widgets.ElevationProfile.ElevationProfileVisibleElements")],G);var q=G;let Q=class extends P{constructor(t,e){super(t,e),this._messagesUnits=null,this._popover=null,this._buttonElement=null,this._clickOutsideHandle=null,this._requestFocusOnCreate=!1}destroy(){this._destroyPopover()}render(){const t=s(this._popover)&&this._popover.open?this._messages.hideSettings:this._messages.showSettings;return w("button",{class:this.classes(F.base),title:t,bind:this,afterCreate:this._initializePopover,onclick:this._togglePopover,"aria-label":t})}_initializePopover(t){this._destroyPopover(),this._buttonElement=t;const e=parseInt(getComputedStyle(t).getPropertyValue("--button-offset"),10);this._popover=new U({owner:this,placement:"bottom-end",offset:[e,0],anchorElement:t,renderContentFunction:()=>this._renderPopoverContent()})}_destroyPopover(){o(this._clickOutsideHandle,(t=>t.remove())),i(this._popover)}_renderPopoverContent(){const t=this._messagesUnits,{unit:e,unitOptions:s}=this.viewModel;return w("div",{class:F.popoverContent,bind:this,onkeydown:this._onPopoverKeyDown,afterCreate:this._onPopoverContentAfterCreate},w("label",{class:F.selectLabel},this._messages.unitSelectLabel),w("select",{class:F.select,value:e,bind:this,onchange:this._onUnitChange,afterCreate:this._onUnitSelectAfterCreate},s.map((e=>w("option",{key:e,value:e},b(e)?t.systems[e]:t.units[e].pluralCapitalized)))))}_onUnitChange(t){const e=t.target;this.viewModel.unit=e.value,this._closePopover()}_onUnitSelectAfterCreate(t){this._requestFocusOnCreate&&(this._requestFocusOnCreate=!1,t.focus())}_onPopoverKeyDown(t){switch(t.key){case"Enter":case"Escape":t.stopPropagation(),t.preventDefault(),this._closePopover()}}_togglePopover(t){s(this._popover)&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){o(this._popover,(t=>t.open=!0)),this._requestFocusOnCreate=!0}_closePopover({focusOnButton:t=!0}={}){o(this._popover,(t=>t.open=!1)),o(this._clickOutsideHandle,(t=>t.remove())),t&&o(this._buttonElement,(t=>t.focus()))}_onPopoverContentAfterCreate(t){o(this._clickOutsideHandle,(t=>t.remove())),this._clickOutsideHandle=a([u(t,"click",(t=>t.stopPropagation())),u(window,"click",(()=>this._closePopover({focusOnButton:!1})))])}};t([c(),C(["unit","unitOptions"])],Q.prototype,"viewModel",void 0),t([c(),C(),f("esri/widgets/ElevationProfile/t9n/ElevationProfile")],Q.prototype,"_messages",void 0),t([c(),C(),f("esri/core/t9n/Units")],Q.prototype,"_messagesUnits",void 0),Q=t([g("esri.widgets.ElevationProfile.SettingsButton")],Q);const K=(t,e)=>Number(e.available)-Number(t.available);let X=class extends P{constructor(t,e){super(t,e),this._messagesUnits=null,this._resizeObserver=null,this._maxNumStatistics=null,this._clickOutsideHandle=null,this._popover=null}destroy(){s(this._resizeObserver)&&(this._resizeObserver.disconnect(),this._resizeObserver=null),this._destroyPopover()}render(){const t=this._allStatistics,e=r(this._maxNumStatistics,1/0);return 0===t.length?w("div",{class:this.classes($.base)}):w("div",{class:$.base,bind:this,afterCreate:this._onContainerAfterCreate,afterUpdate:this._onContainerResize},t.map(((t,s)=>this._renderStatistic(t,{hidden:s>=e,inPopover:!1}))),e<t.length&&w("button",{class:$.popoverToggle,bind:this,onclick:this._togglePopover,afterCreate:this._initializePopover,afterRemoved:this._destroyPopover}))}get _allStatistics(){const t=this.viewModel.statistics;if(n(t))return[];const o=this._messages.statistics,i=[{label:o.maxDistance,available:s(t.maxDistance),renderValue:()=>this._renderDistanceValue(t.maxDistance)},{label:o.minElevation,available:s(t.minElevation),renderValue:()=>this._renderElevationValue(t.minElevation)},{label:o.maxElevation,available:s(t.maxElevation),renderValue:()=>this._renderElevationValue(t.maxElevation)},{label:o.avgElevation,available:s(t.avgElevation),renderValue:()=>this._renderElevationValue(t.avgElevation)},{label:o.gain,available:s(t.elevationGain),renderValue:()=>this._renderElevationValue(t.elevationGain)},{label:o.loss,available:s(t.elevationLoss),renderValue:()=>this._renderElevationValue(t.elevationLoss)}];return e("elevation-profile-slope-stats")&&i.push({label:o.maxSlope,available:s(t.maxPositiveSlope)||s(t.maxNegativeSlope),renderValue:()=>this._renderSlopeValue(t.maxPositiveSlope,t.maxNegativeSlope)},{label:o.avgSlope,available:s(t.avgPositiveSlope)||s(t.avgNegativeSlope),renderValue:()=>this._renderSlopeValue(t.avgPositiveSlope,t.avgNegativeSlope)}),i.sort(K)}_renderDistanceValue(t){const e=this._messagesUnits,o=this.viewModel.effectiveUnits.distance;return w("div",{class:$.statisticValue},s(t)?S(e,t,o,A):D)}_renderElevationValue(t){const e=this._messagesUnits,o=this.viewModel.effectiveUnits.elevation;return w("div",{class:$.statisticValue},s(t)?S(e,t,o,A):D)}_renderSlopeValue(t,e){return w("div",{class:$.statisticValue},w("div",{key:"slope-up",class:this.classes($.slopeValue,{[$.slopeValueNotAvailable]:n(t)})},w("div",{class:$.slopeUpIcon}),s(t)?x(t,"degrees",A):D),w("div",{key:"slope-down",class:this.classes($.slopeValue,{[$.slopeValueNotAvailable]:n(e)})},w("div",{class:$.slopeDownIcon}),s(e)?x(e,"degrees",A):D))}_renderStatistic({label:t,available:e,renderValue:s},{hidden:o,inPopover:i}){return w("div",{key:t,class:this.classes($.statistic,{[$.statistic]:!i,[$.statisticHidden]:o,[$.statisticNotAvailable]:!e,[$.popoverStatistic]:i})},w("h5",{class:$.statisticLabel},t),s())}_initializePopover(t){this._destroyPopover(),this._popover=new U({owner:this,placement:"bottom-end",anchorElement:t,renderContentFunction:()=>this._renderPopoverContent()})}_destroyPopover(){i(this._popover),o(this._clickOutsideHandle,(t=>t.remove()))}_renderPopoverContent(){const t=this._allStatistics,e=s(this._maxNumStatistics)?t.slice(this._maxNumStatistics,t.length):[];return w("div",{class:$.popoverContent,bind:this,afterCreate:this._onPopoverContentAfterCreate},e.map((t=>this._renderStatistic(t,{hidden:!1,inPopover:!0}))))}_togglePopover(){s(this._popover)&&this._popover.open?this._closePopover():this._openPopover()}_openPopover(){o(this._popover,(t=>t.open=!0))}_closePopover(){o(this._clickOutsideHandle,(t=>t.remove())),o(this._popover,(t=>t.open=!1))}_onPopoverContentAfterCreate(t){o(this._clickOutsideHandle,(t=>t.remove())),this._clickOutsideHandle=a([u(t,"click",(t=>t.stopPropagation())),u(window,"click",(()=>this._closePopover()))])}_onContainerAfterCreate(t){this._resizeObserver=new ResizeObserver((()=>this._onContainerResize(t))),this._resizeObserver.observe(t)}_onContainerResize(t){const{width:e}=t.getBoundingClientRect();let s=0;const o=Array.from(t.querySelectorAll(`.${$.statistic}`)),i=o.length;for(let t=0;t<i;++t){const i=o[t];if(!(i instanceof HTMLElement))continue;const r=i.classList.contains($.statisticHidden);i.classList.remove($.statisticHidden);const n=i.offsetWidth+15;if(s+=n,i.classList.toggle($.statisticHidden,r),s>e)return s-=n,s+=49,void(this._maxNumStatistics=s>e?Math.max(0,t-1):t)}this._maxNumStatistics=i}};t([c(),C(["unit","unitOptions","statistics","effectiveUnits"])],X.prototype,"viewModel",void 0),t([c(),C(),f("esri/widgets/ElevationProfile/t9n/ElevationProfile")],X.prototype,"_messages",void 0),t([c(),C(),f("esri/core/t9n/Units")],X.prototype,"_messagesUnits",void 0),t([c(),C()],X.prototype,"_maxNumStatistics",void 0),t([c({readOnly:!0}),C()],X.prototype,"_allStatistics",null),X=t([g("esri.widgets.ElevationProfile.Statistics")],X);async function Y(t){const e=await M();d(t.abortOptions);const{am4core:i,am4charts:l}=e;i.options.minPolylineStep=2,i.options.autoSetClassName=!0;const c=i.create(t.container,l.XYChart);y()?(c.rtl=!0,c.padding(20,-10,0,1)):c.padding(20,1,0,-10),c.cursor=function(t){const e=new t.am4charts.XYCursor;return e.trackable=!0,e.lineY.disabled=!0,e}(e);const p=c.plotContainer.background;p.strokeWidth=1,p.strokeOpacity=1,p.stroke=i.color("#e0e0e0");const h=c.xAxes.push(new l.ValueAxis),u=c.yAxes.push(new l.ValueAxis),v={params:t,amChart:c,xAxis:h,yAxis:u,series:new Map,data:null,elevationUnitsPerPixel:null,messages:null};!function(t,{am4core:e}){const s=t.amChart.zoomOutButton.background;s.fill=e.color("#0079c1"),s.states.getKey("hover").properties.fill=e.color("#00598e"),s.states.getKey("down").properties.fill=e.color("#00598e")}(v,e),function({amChart:{tooltip:t}},{am4core:e}){t.zIndex=-1,t.pointerOrientation="down",t.getFillFromObject=!1,t.label.fill=e.color("#323232"),t.background.cornerRadius=0,t.background.stroke=null,t.background.fill=e.color("#ffffff"),y()&&(t.label.textAlign="middle")}(v,e),function(t,e){const{am4core:s}=e,{xAxis:o}=t;o.numberFormatter=ot(t,"distance"),o.strictMinMax=!0,o.title.visible=!1;const i=o.renderer;i.line.visible=!1,i.minGridDistance=80,i.maxLabelPosition=.98,i.fontWeight="400",i.fontSize=10;const r=i.labels.template;r.fontSize=8,r.fontWeight="400",r.paddingTop=5,r.horizontalCenter="left",r.paddingLeft=0;const n=i.grid.template;n.strokeOpacity=1,n.stroke=s.color("#e0e0e0"),y()&&(i.inversed=!0,o.tooltip.label.textAlign="middle",r.textAlign="middle")}(v,e),function(t,e){const{am4core:s}=e,{yAxis:o}=t;o.numberFormatter=ot(t,"elevation"),o.title.visible=!1,o.cursorTooltipEnabled=!1,o.strictMinMax=!1,o.extraMax=.02,o.extraMin=.02;const i=o.renderer;i.line.visible=!1,i.minGridDistance=30,i.maxLabelPosition=.98,i.fontWeight="400",i.fontSize=10;const r=i.labels.template;r.fontSize=8,r.fontWeight="400",r.paddingRight=5,r.verticalCenter="bottom",r.paddingBottom=0;const n=i.grid.template;n.strokeOpacity=1,n.stroke=s.color("#e0e0e0"),y()&&(i.opposite=!0,r.textAlign="middle")}(v,e);const g=[tt(v,t.onCursorPositionChange),et(v),st(v)];let _=null;const j=()=>{s(_)&&(clearTimeout(_),_=null)};return{...v,update(t){t.data===v.data&&t.messages===v.messages||(j(),_=setTimeout((()=>{_=null,function(t,e,{data:i,elevationUnitsPerPixel:a,messages:l}){const{amChart:c}=e;c.tooltip.hide();const p=e.data!==i,h=e.elevationUnitsPerPixel!==a;e.data=i,e.elevationUnitsPerPixel=a,e.messages=l,p&&function({xAxis:t,data:e}){if(n(e))return;let o=0;for(const t of e.lines){var i;const e=r(t.samples,[]),n=null==(i=m(e))?void 0:i.distance;s(n)&&n>o&&(o=n)}t.min=0,t.max=o,t.invalidateLabels()}(e);(p||h)&&function({yAxis:t,data:e,elevationUnitsPerPixel:i}){if(n(e))return;const r=o(e.statistics,(t=>t.minElevation)),a=o(e.statistics,(t=>t.maxElevation));if(s(i)&&s(r)&&s(a)){const e=a-r,s=Math.max(0,i-e)/2;t.min=Math.round(r-s),t.max=Math.round(a+s)}else t.min=void 0,t.max=void 0;t.invalidateLabels()}(e);p&&function(t,e){const{amChart:s,data:i}=e;if(n(i)||0===i.lines.length)return void s.series.clear();const r=new Map,a=new Set(s.series.values),l=i.lines.length;for(let n=0;n<l;n++){const c=i.lines[n];let p=e.series.get(c.id);p?(o(p.fill,(t=>a.delete(t))),a.delete(p.line)):(p=Z(t,c),o(p.fill,(t=>s.series.push(t))),s.series.push(p.line)),r.set(p.id,p);const m=l-n-1;o(p.fill,(t=>t.zIndex=m)),p.line.zIndex=l+m,J(t,p,c)}e.series=r;for(const t of a)s.series.removeValue(t)}(t,e)}(e,v,t)})))},destroy(){j(),a(g).remove(),c.dispose()}}}function J(t,{line:e,fill:s},i){const{r:n,g:a,b:l,a:c}=i.color,p=t.am4core.color({r:n,g:a,b:l,a:c}),m=r(i.samples,[]),h=m.length>0;e.data=m,e.stroke=p,e.visible=h,o(s,(t=>{t.data=m,t.visible=h,t.fill=p.lighten(.9)}))}function Z(t,{id:e,showFill:s}){const{am4charts:o}=t,i=new o.LineSeries;i.id=`line-${e}`,i.showOnInit=!1,i.simplifiedProcessing=!0,i.connect=!1,i.strokeWidth=1.5,i.fillOpacity=0;i.dataFields.valueX="distance";i.dataFields.valueY="elevation";let r=null;return s&&(r=i.clone(),r.id=`fill-${e}`,r.strokeWidth=0,r.fillOpacity=1),{id:e,line:i,fill:r}}function tt(t,e){const{amChart:s,xAxis:o,yAxis:i}=t,r=s.cursor,n=r.events.on("cursorpositionchanged",(()=>{const t=o.toAxisPosition(r.xPosition),s=i.toAxisPosition(r.yPosition);e(t,s)})),a=u(s.chartContainer.htmlContainer,["mouseleave","pointerleave"],(()=>{e(null,null)}));return l((()=>{n.dispose(),a.remove()}))}function et(t){const{amChart:e,xAxis:i}=t,r=e.cursor.events.on("cursorpositionchanged",(()=>{if(1!==o(t.data,(t=>t.progress)))return;const r=e.tooltip,a=function(t){const{amChart:e,yAxis:i,data:r,messages:a}=t;if(n(r)||n(a))return null;const l=r.effectiveUnits.elevation,c=[];let p=null;for(const e of r.lines){const i=it(t,e),r=o(i,(t=>t.elevation));(n(p)||s(r)&&r>p)&&(p=r);const m=j(a.chartTooltip,{name:H(e,a),elevation:s(r)?S(a,r,l,A):D});c.push(`[${e.color.toHex()}]â—[/] ${m}`)}if(n(p))return null;const m=e.cursor,h=i.measuredHeight,u=h+e.pixelPaddingTop;return{text:c.join("\n"),point:{x:m.point.x+m.parent.pixelX+e.pixelPaddingLeft,y:u-i.valueToPosition(p)*h-10}}}(t);s(a)?(r.text=a.text,r.pointTo(a.point,!0),r.show()):r.hide(),i.tooltip.text=function(t){const{data:e,messages:o}=t;if(n(e)||n(o))return"";const i=e.lines[0],r=i?it(t,i):null;return s(r)?S(o,r.distance,e.effectiveUnits.distance,A):"-"}(t),i.showTooltip()}));return l((()=>r.dispose()))}function st({amChart:t,xAxis:e}){return u(t.chartContainer.htmlContainer,["mouseleave","pointerleave"],(()=>{t.tooltip.hide(),e.hideTooltip()}))}function ot(t,e){const o=t.xAxis.numberFormatter.clone();return o.format=(o,i,r)=>{const{messages:n,data:a}=t;return s(n)&&s(a)&&"string"!=typeof o?S(n,o,a.effectiveUnits[e],r):""},o}function it({amChart:t,xAxis:e},s){const o=r(s.samples,[]);if(0===o.length)return null;const i=e.toAxisPosition(t.cursor.xPosition),n=e.positionToValue(i);return h(o,n,(t=>t.distance))}const rt=[4,0];let nt=class extends P{constructor(t,e){super(t,e),this.viewModel=null,this.view=null,this.input=null,this.profiles=null,this.unitOptions=[],this.unit="metric",this.geodesicDistanceThreshold=1e5,this.visibleElements=new q,this.iconClass=L.widgetIcon,this.label=void 0,this.messages=null,this.messagesCommon=null,this.messagesUnits=null,this._chartContainer=null,this._chart=null,this._settingsButton=new Q({viewModel:this.viewModel}),this._statisticsWidget=new X({viewModel:this.viewModel}),this._legend=new W({viewModel:this.viewModel}),this._resizeObserver=null,this._portrait=!1,this._chartInitTask=null,t.viewModel||(this._defaultViewModel=new E({view:t.view}),this.viewModel=this._defaultViewModel)}postInitialize(){this.own([k(this,"_chartContainer",(()=>{this._destroyChart();const t=this._chartContainer;n(t)||(this._chartInitTask=v((e=>this._initializeChart(t,e))))})),k(this,"viewModel",(t=>{this._settingsButton.viewModel=t,this._statisticsWidget.viewModel=t,this._legend.viewModel=t})),k(this,"_chartUpdateParams",(()=>this._updateChart()))])}destroy(){this._destroyChart(),s(this._defaultViewModel)&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy(),this._statisticsWidget.destroy(),this._statisticsWidget=null,this._legend.destroy(),this._legend=null,this._settingsButton.destroy(),this._settingsButton=null,s(this._resizeObserver)&&(this._resizeObserver.disconnect(),this._resizeObserver=null)}get _chartUpdateParams(){return{chart:this._chart,data:this.viewModel.chartData,stationary:this.view.stationary,elevationUnitsPerPixel:this.viewModel.elevationUnitsPerPixel,messages:{...this.messagesUnits,...this.messages}}}render(){const{viewModel:t}=this,e=t.progress;return w("div",{key:this,class:this.classes(L.base,L.esriWidget,{[L.esriWidgetDisabled]:"disabled"===t.state,[L.portrait]:this._portrait}),"aria-label":this.messages.widgetLabel,bind:this,afterCreate:this._onAfterCreate},w("div",{key:"progress-bar",class:this.classes(L.progressBar,{[L.progressBarVisible]:e<1}),styles:{width:100*e+"%"},role:"presentation","aria-hidden":"true",title:this.messagesCommon.loading}),this._renderContentForState())}_renderContentForState(){switch(this.viewModel.state){case B.Ready:return this._renderContentForReadyState();case B.Selecting:return this._renderContentForSelectingState();case B.Creating:return this._renderContentForCreatingState();case B.Selected:case B.Created:return this._renderContentForCreatedState();case B.Disabled:return null}}_renderContentForReadyState(){return this._renderContent({prompt:this.messages.readyPrompt,statistics:!1,chart:!1,legend:!1,actions:rt})}_renderContentForSelectingState(){return this._renderContent({prompt:this.messages.selectingPrompt,statistics:!1,chart:!1,legend:!1,actions:[5]})}_renderContentForCreatingState(){const t={statistics:!1,chart:!1,legend:!1,actions:[1,3]};switch(this.viewModel.errorState){case 0:return this._renderContent({...t,prompt:this.messages.creatingPrompt});case 1:return this._renderContent({...t,prompt:this.messages.noMultiPathSupport});case 2:case 3:return this._renderContent({...t,prompt:this.messages.noProfile,legend:!0});case 4:{const t=this.viewModel.canStopCreating?2:3;return this._renderContent({statistics:!0,chart:!0,legend:!0,actions:[1,t]})}}}_renderContentForCreatedState(){const t={statistics:!1,chart:!1,legend:!1,actions:rt};switch(this.viewModel.errorState){case 0:return this._renderContent({...t,prompt:this.messages.noProfile});case 1:return this._renderContent({...t,prompt:this.messages.noMultiPathSupport});case 2:case 3:return this._renderContent({...t,prompt:this.messages.noProfile,legend:!0});case 4:return this._renderContent({statistics:!0,chart:!0,legend:!0,actions:rt})}}_renderContent({statistics:t,prompt:e,chart:o,legend:i,actions:r}){return[this._renderHeader({statistics:t}),s(e)?this._renderPrompt(e):o&&this._renderChart(),this._renderActions({legend:i,actions:r})]}_renderHeader(t){const{progress:e}=this.viewModel,s=1===e&&t.statistics&&this.visibleElements.statistics;return w("header",{key:"header",class:L.header},e>0&&e<1&&w("div",{key:"loading-message",class:L.loadingMessage},this.messages.loading),s?this._statisticsWidget.render():w("div",{key:"header-spacer",class:L.headerSpacer}),this._settingsButton.render())}_renderPrompt(t){return w("div",{key:"prompt-container",bind:this,class:L.promptContainer},w("p",null,t))}_renderChart(){return w("div",{key:"chart-container",bind:this,class:L.chartContainer,afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved})}_renderActions({legend:t,actions:e}){const s=e.map((t=>{switch(t){case 0:return this.visibleElements.sketchButton&&w("button",{key:"sketch",class:this.classes(L.actionButton,L.sketchButton),bind:this,onclick:this._onSketchButtonClick},this.messages.sketchButtonLabel);case 1:return this.visibleElements.sketchButton&&w("button",{key:"sketch-cancel",class:this.classes(L.actionButton,L.sketchCancelButton),bind:this,onclick:this._onCancelButtonClick},this.messagesCommon.cancel);case 2:return this.visibleElements.sketchButton&&w("button",{key:"sketch-done",class:this.classes(L.actionButton,L.sketchDoneButton),bind:this,onclick:this._onDoneButtonClick},this.messagesCommon.done);case 3:return this.visibleElements.sketchButton&&w("button",{key:"sketch-done-disabled",class:this.classes(L.actionButton,L.sketchDoneButton,L.buttonDisabled),bind:this,disabled:!0},this.messagesCommon.done);case 4:return this.visibleElements.selectButton&&w("button",{key:"select",class:this.classes(L.actionButton,L.selectButton),bind:this,onclick:this._onSelectButtonClick},this.messages.selectButtonLabel);case 5:return this.visibleElements.selectButton&&w("button",{key:"select-cancel",class:this.classes(L.actionButton,L.selectCancelButton),bind:this,onclick:this._onCancelButtonClick},this.messagesCommon.cancel)}}));return w("div",{class:L.footer},w("div",{class:L.legendContainer},this.visibleElements.legend&&t&&this._legend.render()),w("div",{class:L.actionsContainer},s))}_onSketchButtonClick(){this.viewModel.start({mode:"sketch"})}_onSelectButtonClick(){this.viewModel.start({mode:"select"})}_onCancelButtonClick(){this.viewModel.cancel()}_onDoneButtonClick(){this.viewModel.stop()}_updateChart(){const t=this._chartUpdateParams;t.stationary&&s(t.chart)&&t.messages&&t.chart.update(t)}_onChartContainerAfterCreate(t){this._chartContainer=t}_onChartContainerRemoved(){this._chartContainer=null}async _initializeChart(t,e){this._chart=await Y({container:t,abortOptions:{signal:e},onCursorPositionChange:t=>{this.viewModel.hoveredChartPosition=t}}),this._updateChart()}_destroyChart(){s(this._chartInitTask)&&(this._chartInitTask.abort(),this._chartInitTask=null),s(this._chart)&&(this._chart.destroy(),this._chart=null)}_onAfterCreate(t){const e=()=>{this._portrait=t.getBoundingClientRect().width<O};e(),this._resizeObserver=new ResizeObserver((()=>e())),this._resizeObserver.observe(t)}};t([c({type:E}),C(["chartData","progress","statistics","canStopCreating"])],nt.prototype,"viewModel",void 0),t([_("viewModel.view"),C()],nt.prototype,"view",void 0),t([_("viewModel.input"),C()],nt.prototype,"input",void 0),t([_("viewModel.profiles"),C()],nt.prototype,"profiles",void 0),t([_("viewModel.unitOptions"),C()],nt.prototype,"unitOptions",void 0),t([_("viewModel.unit"),C()],nt.prototype,"unit",void 0),t([_("viewModel.geodesicDistanceThreshold"),C()],nt.prototype,"geodesicDistanceThreshold",void 0),t([c({type:q}),C()],nt.prototype,"visibleElements",void 0),t([c(),C()],nt.prototype,"iconClass",void 0),t([_("messages.widgetLabel",{overridable:!0}),C()],nt.prototype,"label",void 0),t([c(),C(),f("esri/widgets/ElevationProfile/t9n/ElevationProfile")],nt.prototype,"messages",void 0),t([c(),C(),f("esri/t9n/common")],nt.prototype,"messagesCommon",void 0),t([c(),C(),f("esri/core/t9n/Units")],nt.prototype,"messagesUnits",void 0),t([c()],nt.prototype,"_chartContainer",void 0),t([c()],nt.prototype,"_chart",void 0),t([c(),C()],nt.prototype,"_portrait",void 0),t([c()],nt.prototype,"_chartUpdateParams",null),nt=t([g("esri.widgets.ElevationProfile")],nt);var at=nt;export default at;

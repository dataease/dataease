//>>built
define("dojo/_base/array dojo/dom dojo/_base/lang dojo/topic dojo/_base/window ../focus ../selection ../main".split(" "),function(q,l,m,h,d,c,g,e){c.focus=function(a){if(a){var b="node"in a?a.node:a,f=a.bookmark;a=a.openedForWindow;var n=f?f.isCollapsed:!1;if(b){var k="iframe"==b.tagName.toLowerCase()?b.contentWindow:b;if(k&&k.focus)try{k.focus()}catch(p){}c._onFocusNode(b)}if(f&&d.withGlobal(a||d.global,e.isCollapsed)&&!n){a&&a.focus();try{d.withGlobal(a||d.global,e.moveToBookmark,null,[f])}catch(p){}}}};
c.watch("curNode",function(a,b,f){e._curFocus=f;e._prevFocus=b;f&&h.publish("focusNode",f)});c.watch("activeStack",function(a,b,f){e._activeStack=f});c.on("widget-blur",function(a,b){h.publish("widgetBlur",a,b)});c.on("widget-focus",function(a,b){h.publish("widgetFocus",a,b)});m.mixin(e,{_curFocus:null,_prevFocus:null,isCollapsed:function(){return e.getBookmark().isCollapsed},getBookmark:function(){return(d.global==window?g:new g.SelectionManager(d.global)).getBookmark()},moveToBookmark:function(a){return(d.global==
window?g:new g.SelectionManager(d.global)).moveToBookmark(a)},getFocus:function(a,b){a=!c.curNode||a&&l.isDescendant(c.curNode,a.domNode)?e._prevFocus:c.curNode;return{node:a,bookmark:a&&a==c.curNode&&d.withGlobal(b||d.global,e.getBookmark),openedForWindow:b}},_activeStack:[],registerIframe:function(a){return c.registerIframe(a)},unregisterIframe:function(a){a&&a.remove()},registerWin:function(a,b){return c.registerWin(a,b)},unregisterWin:function(a){a&&a.remove()}});return e});
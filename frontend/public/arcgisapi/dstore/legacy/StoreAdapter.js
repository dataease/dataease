//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/when ../Store ../QueryResults".split(" "),function(t,g,p,k,u,v){g=function(a){return function(){var b=this.objectStore;return b[a].apply(b,arguments)}};return t(u,{objectStore:null,get:function(){var a=this,b=this.objectStore;return k(b.get.apply(b,arguments),function(f){return a._restore(f)})},put:g("put"),add:g("add"),remove:g("remove"),getIdentity:g("getIdentity"),_setIdentity:function(a,b){return a[this.objectStore.idProperty]=b},
fetch:function(){return this.fetchRange()},fetchRange:function(a){function b(l){for(var c=0;c<l.length;c++){var d=l[c],e=d.type;d=d.args;if("and"===e)b(d);else if("eq"===e||"match"===e)m[d[0]]=d[1];else if("string"===e||"function"===e)m=d[0];else if(e)throw Error('"'+e+" operator can not be converted to a legacy store query");}}var f={},w=this.queryLog,q=function(l){return p.map(p.filter(w,function(c){return c.type===l}),function(c){return c.normalizedArguments[0]})},h=q("sort").pop();if(h&&(f.sort=
h,h instanceof Array))for(var n=0;n<h.length;n++){var r=h[n];r.attribute=r.property}a&&(f.count=a.end-((f.start=a.start)||0));var m={};b(q("filter"));return(a=this.objectStore.query(m,f))?new v(k(a.map(this._restore,this)),{totalLength:k(a.total)}):k(a)}})});
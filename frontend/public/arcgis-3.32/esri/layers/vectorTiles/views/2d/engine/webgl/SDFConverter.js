// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/2d/engine/webgl/SDFConverter",["require","exports","../../../../core/promiseUtils","../../../../core/promiseUtils","./packingUtils"],function(m,n,q,p,r){Object.defineProperty(n,"__esModule",{value:!0});m=function(){function l(b){this.size=b;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=b;this.context=this.canvas.getContext("2d");this._gridOuter=new Float64Array(b*b);this._gridInner=new Float64Array(b*b);this._f=new Float64Array(b);
this._d=new Float64Array(b);this._z=new Float64Array(b+1);this._v=new Int16Array(b);b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttribute("style","position: absolute;");b.setAttribute("width","0");b.setAttribute("height","0");document.body.appendChild(b);this._svg=b}l.prototype.draw=function(b,h,f){var a=this;void 0===f&&(f=31);var k=this._createSVGString(b);return q.create(function(b,c){var d=new Image;d.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(k);d.onload=
function(){a.context.clearRect(0,0,a.size,a.size);a.context.drawImage(d,0,0,a.size,a.size);for(var c=a.context.getImageData(0,0,a.size,a.size),h=new Uint8Array(a.size*a.size*4),e=0;e<a.size*a.size;e++){var g=c.data[4*e+3]/255;a._gridOuter[e]=1===g?0:0===g?1E20:Math.pow(Math.max(0,.5-g),2);a._gridInner[e]=1===g?1E20:0===g?0:Math.pow(Math.max(0,g-.5),2)}a._edt(a._gridOuter,a.size,a.size);a._edt(a._gridInner,a.size,a.size);for(e=0;e<a.size*a.size;e++)r.packFloatRGBA(.5-(a._gridOuter[e]-a._gridInner[e])/
(2*f),h,4*e);b(h)};var g=h&&h.signal;if(g)p.onAbort(g,function(){return c(p.createAbortError())})})};l.prototype._createSVGString=function(b){var h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",b);this._svg.appendChild(h);b=h.getBBox();var f=b.width/b.height,a=this.size/2,k,d,c;1<f?(d=k=a/b.width,c=this.size/4,f=a-1/f*a/2):(k=d=a/b.height,c=a-a*f/2,f=this.size/4);h.setAttribute("style","transform: matrix("+k+", 0, 0, "+d+", "+(-b.x*k+c)+", "+(-b.y*d+f)+")");b='\x3csvg style\x3d"fill:red;" height\x3d"'+
this.size+'" width\x3d"'+this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(h);return b};l.prototype._edt=function(b,h,f){for(var a=this._f,k=this._d,d=this._v,c=this._z,e=0;e<h;e++){for(var g=0;g<f;g++)a[g]=b[g*h+e];this._edt1d(a,k,d,c,f);for(g=0;g<f;g++)b[g*h+e]=k[g]}for(g=0;g<f;g++){for(e=0;e<h;e++)a[e]=b[g*h+e];this._edt1d(a,k,d,c,h);for(e=0;e<h;e++)b[g*h+e]=Math.sqrt(k[e])}};l.prototype._edt1d=function(b,h,f,a,k){f[0]=0;a[0]=-1E20;
a[1]=1E20;for(var d=1,c=0;d<k;d++){for(var e=(b[d]+d*d-(b[f[c]]+f[c]*f[c]))/(2*d-2*f[c]);e<=a[c];)c--,e=(b[d]+d*d-(b[f[c]]+f[c]*f[c]))/(2*d-2*f[c]);c++;f[c]=d;a[c]=e;a[c+1]=1E20}for(c=d=0;d<k;d++){for(;a[c+1]<d;)c++;h[d]=(d-f[c])*(d-f[c])+b[f[c]]}};return l}();n.default=m});
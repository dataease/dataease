// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/3d/webgl-engine/lib/Util",["require","exports","../../support/geometryUtils","./gl-matrix"],function(Y,c,t,e){function A(a,b){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new H(b);}function p(a,b,d){return a<b?b:a>d?d:a}function B(a){return a/180*Math.PI}function C(a){return 180*a/Math.PI}function I(a,b,d){e.mat4d.multiply(b,a,D);e.mat4d.inverse(D);for(a=0;8>a;++a)e.mat4d.multiplyVec4(D,Q[a],g),e.vec3d.set3(g[0]/g[3],g[1]/g[3],g[2]/g[3],d[a])}function J(a,
b){t.plane.fromPoints(a[4],a[0],a[3],b[0]);t.plane.fromPoints(a[1],a[5],a[6],b[1]);t.plane.fromPoints(a[4],a[5],a[1],b[2]);t.plane.fromPoints(a[3],a[2],a[6],b[3]);t.plane.fromPoints(a[0],a[1],a[2],b[4]);t.plane.fromPoints(a[5],a[4],a[7],b[5])}function K(a,b,d,f){var k=6378137/Math.sqrt(1-c.ECCENTRICITY_SQUARED*Math.pow(Math.sin(a),2)),e=Math.cos(a);f[0]=(k+d)*Math.cos(b)*e;f[1]=(k*(1-c.ECCENTRICITY_SQUARED)+d)*Math.sin(a);f[2]=-(k+d)*Math.sin(b)*e}function L(a){for(var b in a)return b}function M(a,
b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}function N(a,b){void 0===b&&(b=0);for(var d=0,f=0;4>f;f++)d+=a[b+f]*R[f];return d}function S(a){return a-Math.floor(a)}Object.defineProperty(c,"__esModule",{value:!0});var D=e.mat4d.create(),Q=[e.vec4d.createFrom(-1,-1,-1,1),e.vec4d.createFrom(1,-1,-1,1),e.vec4d.createFrom(1,1,-1,1),e.vec4d.createFrom(-1,1,-1,1),e.vec4d.createFrom(-1,-1,1,1),e.vec4d.createFrom(1,-1,1,1),e.vec4d.createFrom(1,1,1,1),e.vec4d.createFrom(-1,1,1,1)],g=e.vec4d.create(),T=[e.vec3d.create(),
e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create(),e.vec3d.create()],U=e.vec3d.create(),O=e.vec3d.create(),q=e.vec3d.create(),h=e.vec3d.create(),l=e.vec3d.create(),x=e.vec3d.create(),y=e.vec3d.create(),E=e.vec3d.create(),F=e.vec3d.create(),v=e.vec3d.create(),n=e.vec3d.create(),w=e.vec3d.create(),z=e.vec3d.create(),V=e.vec3d.createFrom(0,0,0),H=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};
return a}();c.AssertException=H;c.EARTH_RADIUS=6378137;c.METER2FEET=3.28084;c.ECCENTRICITY_SQUARED=.0066943799901414;c.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"};c.assert=A;c.verify=function(a,b){a||(console.log("Verify failed: "+b),console.log(Error("dummy").stack))};c.isPowerOfTwo=function(a){return 0===
(a&a-1)};c.lerp=function(a,b,d){return a+(b-a)*d};c.clamp=p;c.encodeInt16=function(a){return p(Math.round(32767*a),-32767,32767)};c.encodeNormal=function(a,b){var d=Math.abs(a[0]),f=Math.abs(a[1]),k=1/(d+f+Math.abs(a[2])),d=d*k,f=f*k,k=Math.min(a[2]*k,0);b[0]=P(a[0])*(d-k);b[1]=P(a[1])*(f-k)};var P="function"===typeof Math.sign?Math.sign:function(a){return+(0<a)-+(0>a)||0};c.fallbackIfUndefined=function(a,b){return void 0===a?b:a};c.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&
255)/255,(a&255)/255]};c.rgb2hex=function(a){var b=p(Math.round(255*a[0]),0,255),d=p(Math.round(255*a[1]),0,255);a=p(Math.round(255*a[2]),0,255);return"0x"+((b<<16)+(d<<8)+a).toString(16)};c.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};c.deg2rad=B;c.rad2deg=C;c.azimuthElevationAngle2Direction=function(a,b){a=1.5*Math.PI-a;b=.5*Math.PI-b;return[Math.cos(a)*Math.sin(b),Math.cos(b),Math.sin(a)*Math.sin(b)]};c.raySphere=function(a,b,d,f,k){d=d||V;var c=e.vec3d.subtract(a,
d,U);d=e.vec3d.dot(b,b);var m=2*e.vec3d.dot(b,c);f=e.vec3d.dot(c,c)-f*f;f=m*m-4*d*f;if(0>f)return!1;c=Math.sqrt(f);f=(-m-c)/(2*d);d=(-m+c)/(2*d);if(0>f||d<f&&0<d)f=d;return 0<f?(k&&e.vec3d.add(a,e.vec3d.scale(b,f,z),k),!0):!1};c.rayTriangle3D=function(a,b,d,f,k,c,m,r,g){void 0===g&&(g=e.vec3d.create());var u=f[m]-d[c],h=f[m+1]-d[c+1],l=f[m+2]-d[c+2];f=k[r]-d[c];m=k[r+1]-d[c+1];k=k[r+2]-d[c+2];var p=b[1]*k-m*b[2],n=b[2]*f-k*b[0],q=b[0]*m-f*b[1];r=u*p+h*n+l*q;if(-1E-5<r&&1E-5>r)return!1;r=1/r;var G=
a[0]-d[c],t=a[1]-d[c+1];a=a[2]-d[c+2];g[1]=r*(G*p+t*n+a*q);if(0>g[1]||1<g[1])return!1;d=t*l-h*a;a=a*u-l*G;u=G*h-u*t;g[2]=r*(b[0]*d+b[1]*a+b[2]*u);if(0>g[2]||1<g[1]+g[2])return!1;g[0]=r*(f*d+m*a+k*u);return!0};c.rayBoxTest=function(a,b,d,f){var c,e=(d[0]-a[0])/b[0],m=(f[0]-a[0])/b[0];e>m&&(c=e,e=m,m=c);var g=(d[1]-a[1])/b[1],h=(f[1]-a[1])/b[1];g>h&&(c=g,g=h,h=c);if(e>h||g>m)return!1;g>e&&(e=g);h<m&&(m=h);d=(d[2]-a[2])/b[2];a=(f[2]-a[2])/b[2];d>a&&(c=d,d=a,a=c);if(e>a||d>m)return!1;a<m&&(m=a);return 0>
m?!1:!0};c.rayRay2D=function(a,b,d,f,c,g){void 0===g&&(g=e.vec2d.create());var k=(f[c]-d[c])*(b[0]-a[0])-(f[0]-d[0])*(b[c]-a[c]);if(0===k)return!1;d=((f[0]-d[0])*(a[c]-d[c])-(f[c]-d[c])*(a[0]-d[0]))/k;g[0]=a[0]+d*(b[0]-a[0]);g[1]=a[c]+d*(b[c]-a[c]);return!0};c.matrixToFrustumPoints=I;c.matrixToFrustumPlanes=function(a,b,d,f){void 0===f&&(f=d,d=T);I(a,b,d);J(d,f)};c.frustumPointsToPlanes=J;c.project=function(a,b,d,f,c){c||(c=a);g[0]=a[0];g[1]=a[1];g[2]=a[2];g[3]=1;e.mat4d.multiplyVec4(b,g);2<c.length&&
(c[2]=-g[2]);e.mat4d.multiplyVec4(d,g);A(0!==g[3]);c[0]=g[0]/g[3];c[1]=g[1]/g[3];c[2]=g[2]/g[3];c[0]=(.5*c[0]+.5)*f[2]+f[0];c[1]=(.5*c[1]+.5)*f[3]+f[1]};c.geodeticToGeocentricLatidude=function(a){return Math.atan((1-c.ECCENTRICITY_SQUARED)*Math.tan(a))};c.latLon2positionWGS84Ellipsoid=K;c.pos2latLon=function(a,b){var d=e.vec3d.length(a);b[0]=Math.asin(p(a[1]/d,-1,1));b[1]=(0>a[2]?1:-1)*Math.acos(p(a[0]/(Math.cos(b[0])*d),-1,1));b[0]=C(b[0]);b[1]=C(b[1]);b[2]=d};c.pos2latLonWGS84Ellipsoid=function(a,
b){var d=a[0],f=-a[2],e=a[1],g=Math.sqrt(Math.pow(6378137,2)*(1-c.ECCENTRICITY_SQUARED));a=Math.sqrt(Math.pow(d,2)+Math.pow(f,2));var m=Math.atan2(6378137*e,g*a),d=Math.atan2(f,d),f=Math.atan2(e+Math.pow(Math.sqrt((Math.pow(6378137,2)-Math.pow(g,2))/Math.pow(g,2)),2)*g*Math.pow(Math.sin(m),3),a-6378137*c.ECCENTRICITY_SQUARED*Math.pow(Math.cos(m),3));a=a/Math.cos(f)-6378137/Math.sqrt(1-c.ECCENTRICITY_SQUARED*Math.pow(Math.sin(f),2))+c.EARTH_RADIUS;b[0]=f;b[1]=d;b[2]=a};c.computeGlobeTransformation=
function(a,b,d){var c=B(a[0]);a=B(a[1]);K(c,a,b,O);e.mat4d.translate(d,O);e.mat4d.rotateY(d,.5*Math.PI+a);e.mat4d.rotateX(d,.5*Math.PI-c);return d};c.readUInt16=function(a,b){return a[b]+(a[b+1]<<8)};c.readUInt32=function(a,b){return a[b]+(a[b+1]<<8)+(a[b+2]<<16)+(a[b+3]<<24)};c.setIfDefined=function(a,b,d){void 0!==b[a]&&(d[a]=b[a])};c.array2object=function(a,b){var d={};if(void 0!==b)for(var c=0;c<a.length;c++){var e=a[c];d[b(e)]=e}else for(b=0;b<a.length;b++)e=a[b],d[e]=e;return d};c.object2array=
function(a){var b=[],d;for(d in a)b.push(a[d]);return b};c.mergeObjects=function(a,b,d){void 0===d&&(d={});if(d!==a)for(var c in a)d[c]=a[c];if(d!==b)for(var e in b)d[e]=b[e];return d};c.subtractObjects=function(a,b){var d={},c;for(c in a)void 0===b[c]&&(d[c]=a[c]);return d};c.intersectObjects=function(a,b){var d={},c;for(c in a)void 0!==b[c]&&(d[c]=a[c]);return d};c.getFirstObjectKey=L;c.getFirstObjectValue=function(a){return a[L(a)]};c.objectEmpty=function(a){for(var b in a)return!1;return!0};c.byteBuffer2base64image=
function(a,b,d,c,e){var f=4*b;A(a.length===f*d,"buffer length must match image resolution");var g=document.createElement("canvas");g.width=b;g.height=d;var k=g.getContext("2d");b=k.getImageData(0,0,b,d);for(var h=b.data,l=0;l<d;++l)for(var p=l*f,n=(d-1-l)*f,q=0;q<f;++q)h[p++]=a[n++];k.putImageData(b,0,0);return g.toDataURL(c,e)};c.cround=function(a){return Math.round(100*a)/100};c.logWithBase=function(a,b){return Math.log(a)/Math.log(b)};c.setMatrixTranslation=M;c.setMatrixTranslation3=function(a,
b,d,c){a[12]=b;a[13]=d;a[14]=c};c.getMatrixTranslation=function(a,b){void 0===b&&(b=e.vec3d.create());b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};c.createTranslationMatrix=function(a,b){a=e.mat4d.identity(a);M(a,b);return a};c.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};c.fovx2fovy=function(a,b,d){return 2*Math.atan(d*Math.tan(.5*a)/b)};c.fovy2fovx=function(a,b,d){return 2*
Math.atan(b*Math.tan(.5*a)/d)};c.fovx2fovd=function(a,b,d){return 2*Math.atan(Math.sqrt(b*b+d*d)*Math.tan(.5*a)/b)};c.fovy2fovd=function(a,b,d){return 2*Math.atan(Math.sqrt(b*b+d*d)*Math.tan(.5*a)/d)};c.fovd2fovx=function(a,b,d){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+d*d))};c.fovd2fovy=function(a,b,d){return 2*Math.atan(d*Math.tan(.5*a)/Math.sqrt(b*b+d*d))};c.nextHighestPowerOfTwo=function(a){--a;for(var b=1;32>b;b<<=1)a|=a>>b;return a+1};c.nextHighestPowerOfTen=function(a){return Math.pow(10,
Math.ceil(Math.LOG10E*Math.log(a)))};c.lineLineDistanceSquared3D=function(a,b,d,c,g){q[0]=a[0]-d[0];q[1]=a[1]-d[1];q[2]=a[2]-d[2];h[0]=c[0]-d[0];h[1]=c[1]-d[1];h[2]=c[2]-d[2];if(1E-4>Math.abs(h[0])&&1E-4>Math.abs(h[1])&&1E-4>Math.abs(h[2]))return g.success=!1,g;l[0]=b[0]-a[0];l[1]=b[1]-a[1];l[2]=b[2]-a[2];if(1E-4>Math.abs(l[0])&&1E-4>Math.abs(l[1])&&1E-4>Math.abs(l[2]))return g.success=!1,g;b=q[0]*h[0]+q[1]*h[1]+q[2]*h[2];c=h[0]*l[0]+h[1]*l[1]+h[2]*l[2];var f=q[0]*l[0]+q[1]*l[1]+q[2]*l[2],k=h[0]*
h[0]+h[1]*h[1]+h[2]*h[2],n=(l[0]*l[0]+l[1]*l[1]+l[2]*l[2])*k-c*c;if(1E-4>Math.abs(n))return g.success=!1,g;f=p((b*c-f*k)/n,0,1);b=p((b+c*f)/k,0,1);x[0]=a[0]+f*l[0];x[1]=a[1]+f*l[1];x[2]=a[2]+f*l[2];y[0]=d[0]+b*h[0];y[1]=d[1]+b*h[1];y[2]=d[2]+b*h[2];a=e.vec3d.dist2(x,y);g.success=!0;g.dist2=a;g.pa=x;g.pb=y;return g};c.pointLineSegmentDistanceSquared2D=function(a,b,d){n[0]=b[0]-a[0];n[1]=b[1]-a[1];n[2]=0;w[0]=d[0]-a[0];w[1]=d[1]-a[1];w[2]=0;z[0]=d[0];z[1]=d[1];z[2]=0;b=e.vec2d.dot(w,n);d=e.vec2d.dot(n,
n);b=p(b/d,0,1);v[0]=n[0]*b;v[1]=n[1]*b;E[0]=a[0]+v[0];E[1]=a[1]+v[1];e.vec2d.subtract(z,E,F);a=e.vec2d.dot(F,F);b=e.vec2d.dot(w,w);d=e.vec2d.dot(n,n);var c=e.vec2d.dot(v,v);if(c>b||c>d)a=Number.MAX_VALUE;return a};c.packFloatRGBA=function(a,b,d){void 0===d&&(d=0);a=p(a,0,W);for(var c=0;4>c;c++)b[d+c]=Math.floor(256*S(a*X[c]))};c.unpackFloatRGBA=N;var X=[1,256,65536,16777216],R=[1/256,1/65536,1/16777216,1/4294967296],W=N(new Uint8ClampedArray([255,255,255,255]));c.inverseProjectionInfo=function(a,
b,c,f,g){0===a[11]?(f[0]=2/(b*a[0]),f[1]=2/(c*a[5]),f[2]=(1+a[12])/a[0],f[3]=(1+a[13])/a[5],e.vec2d.set2(0,1,g)):(f[0]=-2/(b*a[0]),f[1]=-2/(c*a[5]),f[2]=(1-a[8])/a[0],f[3]=(1-a[9])/a[5],e.vec2d.set2(1,0,g))}});
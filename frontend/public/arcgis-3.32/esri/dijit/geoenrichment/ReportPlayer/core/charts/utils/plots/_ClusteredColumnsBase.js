// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/ReportPlayer/core/charts/utils/plots/_ClusteredColumnsBase","dojo/_base/lang dojo/_base/array dojo/_base/declare dojox/charting/plot2d/CartesianBase dojox/charting/plot2d/_PlotEvents dojox/charting/plot2d/common dojox/lang/functional dojox/lang/functional/reversed dojox/lang/utils ./labelsRendering/_ColumnsLabelRenderingFix ./animation/_ClusteredColumnsAnimation ./_MinVisibleColumn".split(" "),function(n,y,C,D,E,t,F,G,w,H,I,J){var K=G.lambda("item.purgeGroup()");return C("dojox.charting.plot2d.Columns",
[D,E,H,I,J],{_mainShapes:null,_animationInfos:null,_noCrispEdges:!1,defaultParams:{gap:0,animate:null},optionalParams:{minBarSize:1,maxBarSize:1},constructor:function(a,b){this.opt=n.clone(n.mixin(this.opt,this.defaultParams));w.updateWithObject(this.opt,b);w.updateWithPattern(this.opt,b,this.optionalParams);this.animate=this.opt.animate;this.renderingOptions=this._noCrispEdges?null:{"shape-rendering":"crispEdges"}},getSeriesStats:function(){var a=t.collectSimpleStats(this.series,function(a){return null==
a});a.hmin-=.5;a.hmax+=.5;return a},render:function(a,b){if(!this.chart.isPreRenderMode){this.resetEvents();this.dirty=this.isDirty();var e;this.dirty&&(y.forEach(this.series,K),this._eventSeries={},this.cleanGroup(),e=this.getGroup(),F.forEachRev(this.series,function(a){a.cleanGroup(e)}));var d=this.chart.theme,m=this._hScaler.scaler.getTransformerFromModel(this._hScaler),c=this._vScaler.scaler.getTransformerFromModel(this._vScaler),g=Math.max(d.series.baseLineValue||0,this._vScaler.bounds.lower),
h=c(g),B=this.events(),x=this.getBarProperties();this._mainShapes=[];this._animationInfos=[];for(var z=this.extractValues(this._hScaler),z=this.rearrangeValues(z,c,h),c=this.series.length-1;0<=c;--c){var f=this.series[c];if(this.dirty||f.dirty){f.cleanGroup();var n=d.next("column",[this.opt,f]),t=Array(f.data.length);e=f.group;for(var u=y.some(f.data,function(a){return"number"===typeof a||a&&!a.hasOwnProperty("x")}),w=u?Math.min(f.data.length,Math.ceil(this._hScaler.bounds.to)):f.data.length,k=u?
Math.max(0,Math.floor(this._hScaler.bounds.from-1)):0;k<w;++k){var l=f.data[k];if(null!=l){var q=this.getValue(l,k,c,u),A=z[c][k],p;this.opt.styleFunc||"number"!==typeof l?(p="number"!==typeof l?[l]:[],this.opt.styleFunc&&p.push(this.opt.styleFunc(l)),p=d.addMixin(n,"column",p,!0)):p=d.post(n,"column");if(1<=x.width){var r={x:b.l+m(q.x+.5)+x.gap+x.thickness*this._getXShift(c,d),y:a.height-b.b-h-Math.max(A,0),width:x.width,height:Math.abs(A)},r=this._drawColumn(e,l,r,p,a,b,f,h,k),v=r.shape;d.series.isEditMode&&
(v.rawNode.style.cursor="pointer");v.value=l;this._mainShapes.push(v);r=r.rect;B&&(q={element:"column",index:k,run:f,shape:v,cx:q.x+.5,cy:q.y,x:u?k:f.data[k].x,y:u?f.data[k]:f.data[k].y},this._connectEvents(q),t[k]=q);this.createLabel(e,l,r,p,a,b,g);this.animate&&(l={shape:v,voffset:a.height-b.b-h,vsize:A},this._animationInfos.push(l),this._animateColumn(l))}}}this._eventSeries[f.name]=t;f.dirty=!1}else d.skip(),this._reconnectEvents(f.name)}this._renderLabels(p,a,b,e);this.dirty=!1;return this}},
getMainShapes:function(){return this._mainShapes},_drawColumn:function(a,b,e,d,m,c,g,h,B){},getValue:function(a,b,e,d){d?(e="number"===typeof a?a:a.y,a=b):(e=a.y,a=a.x-1);return{x:a,y:e}},extractValues:function(a){for(var b=[],e=this.series.length-1;0<=e;--e){var d=this.series[e];if(this.dirty||d.dirty){var m=y.some(d.data,function(a){return"number"==typeof a||a&&!a.hasOwnProperty("x")}),c=m?Math.max(0,Math.floor(a.bounds.from-1)):0,m=m?Math.min(d.data.length,Math.ceil(a.bounds.to)):d.data.length,
g=b[e]=[];g.min=c;for(g.max=m;c<m;++c){var h=d.data[c];g[c]=this.isNullValue(h)?0:"number"==typeof h?h:h.y}}}return b},rearrangeValues:function(a,b,e){for(var d=0,m=a.length;d<m;++d){var c=a[d];if(c)for(var g=c.min,h=c.max;g<h;++g){var n=c[g];c[g]=this.isNullValue(n)?0:b(n)-e}}return a},getBarProperties:function(){var a=this._getClusterSize(),b=t.calculateBarSize(this._hScaler.bounds.scale,this.opt,a);return{gap:b.gap,width:b.size,thickness:b.size,clusterSize:a}},_getClusterSize:function(){var a=
this.series.length;return this.chart.theme.series.renderColumnBarsInOppositeDirections?Math.round(a/2):a},_getXShift:function(a,b){return b.series.renderColumnBarsInOppositeDirections?a>=this.series.length/2?a-this.series.length/2:a:a}})});
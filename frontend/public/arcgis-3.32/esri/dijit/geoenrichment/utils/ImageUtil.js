// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.32/esri/copyright.txt for details.
//>>built
define("esri/dijit/geoenrichment/utils/ImageUtil",["esri/dijit/geoenrichment/Deferred","esri/dijit/geoenrichment/when","./UrlUtil"],function(l,m,n){var f={base64DataToDataURL:function(a,b){if(/^data:image/.test(a))return a;b||(b=atob(a.substr(0,16)),b=f.getImageContentType(b));return"data:"+(b||"image/png")+";base64,"+a},getImageContentType:function(a){if("\u00ff\u00d8\u00ff"===a.substr(0,3)&&"JFIF"===a.substr(6,4))return"image/jpeg";if("\u0089PNG\r\n\u001a\n"===a.substr(0,8))return"image/png";if("GIF89a"===
a.substr(0,6)||"GIF87a"===a.substr(0,6))return"image/gif"},base64DataFromDataURL:function(a){0==a.indexOf("data:")&&(a=a.substr(a.indexOf(",")+1));return a},getBase64DataIndex:function(a){a=0==a.indexOf("data:")?a.indexOf(";base64,"):-1;return 0<a?a+8:0},getContentType:function(a){var b=f.getBase64DataIndex(a);return b?a.substring(5,b-8):null},checkBase64FileSize:function(a,b){return f.getBase64FileSize(a)<=b},getBase64FileSize:function(a){return.75*a.length},imageToDataURL:function(a,b){b=b||{};
var c=document.createElement("canvas"),d=c.getContext("2d");c.width=b.width||a.width;c.height=b.height||a.height;var e=b.opacity;null!=e&&!isNaN(e)&&0<=e&&1>e&&(d.globalAlpha=+e,b.format="image/png");(e=b.pos)?d.drawImage(a,e.x||0,e.y||0):d.drawImage(a,0,0,c.width,c.height);return c.toDataURL(b.format)},imageFromUrl:function(a,b){var c=new l,d=new Image;0!==a.indexOf("data:")&&b&&b.crossOrigin&&d.setAttribute("crossOrigin",b.crossOrigin);d.onload=function(){if(d.width&&d.height)c.resolve(d);else{var a=
Error("Error of reading an image from URL.");b&&b.ignoreError?c.resolve(null):c.reject(a)}d.onload=d.onerror=null};d.onerror=function(a){b&&b.ignoreError?c.resolve(null):c.reject(a);d.onload=d.onerror=null};a=require.toUrl(a);/^http:/i.test(a)&&/^https/i.test(window.location.protocol)&&(a=n.toHttpsUrl(a));d.src=a;return c.promise},scaleImage:function(a,b){if("string"===typeof a)var c=f.base64DataToDataURL(a),d=f.getContentType(c),c=f.imageFromUrl(c);return m(c||a).then(function(a){var c=1,e=a.width,
g=a.height;if(b.factor)c=b.factor;else if(b.maxDim)c=b.maxDim/Math.max(e,g);else if(b.imageDim){var h=b.imageDim.w,k=b.imageDim.h;b.imageDim.preserveRatio?(c=Math.min(h/e,k/g),b.imageDim.reduceOnly&&1<c&&(c=1)):b.imageDim.reduceOnly?(e=Math.min(e,h),g=Math.min(g,k)):(e=h,g=k)}return f.imageToDataURL(a,{width:e*c,height:g*c,format:b.format||d,opacity:b.opacity})})}};return f});